"use strict";(self["webpackChunk_frontend_evo_r2_"]=self["webpackChunk_frontend_evo_r2_"]||[]).push([[82689,86448],{854236:(u,x,s)=>{s.d(x,{A:()=>U});const U={footerContentWrapper:"footerContentWrapper--24329",mobile:"mobile--5a6b8"}},355087:(u,x,s)=>{s.d(x,{A:()=>U});const U={indented:"indented--d520e",doubleIndented:"doubleIndented--68144",bold:"bold--37d87",bet:"bet--7d654",betLimits:"betLimits--3cf27",payout:"payout--46826",ranksAndSuits:"ranksAndSuits--7b0b6",mobileRanksAndSuits:"mobileRanksAndSuits--7a895",cardsDelimiter:"cardsDelimiter--55498",disabled:"disabled--fc044",topPadding:"topPadding--64914",rtl:"rtl--1eee5",mobile:"mobile--a40d9",cellContent:"cellContent--e7e92",sectionHeader:"sectionHeader--a6eff",hasContent:"hasContent--7f13d",middleDataCell:"middleDataCell--a2446",fixedColumnWidths:"fixedColumnWidths--a60d9",hasBottomBorder:"hasBottomBorder--87313",hasIncreasedNotch:"hasIncreasedNotch--5fff3",hasNotch:"hasNotch--42e7b",legacyMenuMode:"legacyMenuMode--041c5"}},399074:(u,x,s)=>{s.d(x,{A:()=>U});const U={red:"red--3ffaa",black:"black--f01d3"}},911495:(u,x,s)=>{s.d(x,{A:()=>U});const U={multiButton:"multiButton--78c91",disabled:"disabled--bd075",pulse:"pulse--e28e6",buttonInner:"buttonInner--35b98",arrows:"arrows--50449",arrowsContainer:"arrowsContainer--2fdf2",pulsing:"pulsing--c9b2d",pulseKeyframes:"pulseKeyframes--f7e79",scaleDisabled:"scaleDisabled--6eb9c",pressed:"pressed--4a2fd",hovered:"hovered--97e62",arrowsRotateDisabled:"arrowsRotateDisabled--b65e0",spinning:"spinning--38e30",arrowsSpinKeyframes:"arrowsSpinKeyframes--4ca74",flipArrows:"flipArrows--356a5",sparks:"sparks--877d6",sparksXKeyframes:"sparksXKeyframes--b6078",sparksYKeyframes:"sparksYKeyframes--810ac",oval:"oval--9a837",ovalSparksXKeyframes:"ovalSparksXKeyframes--16c94",ovalSparksYKeyframes:"ovalSparksYKeyframes--0867a",isMobile:"isMobile--f2f94",lowPerformanceDevice:"lowPerformanceDevice--c601e",label:"label--7947e",useLabelCorrection:"useLabelCorrection--9f4f1",circle:"circle--07c5b",timer:"timer--8282e",contentContainer:"contentContainer--8eb0f",icon:"icon--44b2c",labelText:"labelText--447dc",pulseOvalKeyframes:"pulseOvalKeyframes--5ba6e",smallRimXPathLength:"smallRimXPathLength--6039c",smallAspectRatio:"smallAspectRatio--2ae10"}},451175:(u,x,s)=>{s.d(x,{A:()=>U});const U={border:"border--296e9",progress:"progress--f7fab"}},426782:(u,x,s)=>{s.d(x,{A:()=>U});const U={container:"container--727e8",maxSizeFull:"maxSizeFull--3c948",useMediaContainer:"useMediaContainer--c1a8b"}},36195:(u,x,s)=>{var U;s.d(x,{M:()=>U}),function(u){u["AZLCasinoPrive"]="azlcasinoprive",u["Adjarabet"]="adjarabet",u["AdmiralCasino"]="admiralcasino",u["AglcOilers"]="aglcoilers",u["Aglconca"]="aglconca",u["Apuesta"]="apuesta",u["Atg"]="atg",u["BabylonSTK"]="babylonstk",u["Bet88"]="bet88",u["BetCity"]="betcity",u["BetClipPt"]="betclippt",u["BetVictor"]="betvictor",u["Betamo"]="betamo",u["BetandWork"]="betandwork",u["Betcart"]="betcart",u["Betebet"]="betebet",u["Betfun"]="betfun",u["Betmgm"]="betmgm",u["Bets10"]="bets10",u["Betsson"]="betsson",u["Betti"]="betti",u["Betwarrior"]="betwarrior",u["BetwaySA"]="betwaysa",u["Betwiz"]="betwiz",u["BillyBets"]="billyBets",u["BingoPlus"]="bingoplus",u["Bingoal"]="bingoal",u["Bingobonga"]="bingobonga",u["Bk8"]="bk8",u["Blaze"]="blaze",u["Bluechip"]="bluechip",u["Boldt"]="boldt",u["Boomerang"]="boomerang",u["Brandable"]="brandable",u["Buenas"]="buenas",u["Buenos"]="buenos",u["BuenosAires"]="buenosaires",u["Bwin"]="bwin",u["CaesarsCZR"]="caesarsczr",u["CaesarsdtLions"]="caesarsdtlions",u["Casibom"]="casibom",u["Casino777"]="casino777",u["Casino777es"]="casino777es",u["Casino888"]="casino888",u["CasinoMaxi"]="casinomaxi",u["CasinoPrive"]="casinoprive",u["CasinoRoom"]="casinoroom",u["CasinoSecret"]="casinosecret",u["Casinobsasar"]="casinobsasar",u["Casumo"]="casumo",u["Cazador"]="cazador",u["ChipsGG"]="chipsgg",u["CityCenterOnline"]="citycenteronline",u["ClubHouse"]="clubhouse",u["Codere"]="codere",u["Coolbet"]="coolbet",u["Crazywin"]="crazywin",u["Cresus"]="cresus",u["DanskeSpil"]="danskespil",u["DragonMoney"]="dragonmoney",u["DuelBits"]="duelBits",u["Dunder"]="dunder",u["EBingo"]="ebingo",u["ElexBet"]="elexbet",u["Estrelabet"]="estrelabet",u["Ezugi"]="ezugi",u["F12"]="f12",u["FairplayCasino"]="fairplaycasino",u["Fanduel"]="fanduel",u["FanduelNBA"]="fanduelNBA",u["FanduelOntario"]="fanduelOntario",u["FanduelRacing"]="fanduelRacing",u["Fastpay"]="fastpay",u["Fastwin"]="fastwin",u["Fomo7"]="fomo7",u["Fonbet"]="fonbet",u["Frank"]="frank",u["Fun88"]="fun88",u["GCasino"]="gcasino",u["GGBet"]="ggbet",u["GVC"]="gvc",u["GVCMLB"]="gvcMLB",u["GVCNJ"]="gvcnj",u["GVCNJ76ERS"]="gvcnj76ers",u["GVCNJSteelers"]="gvcnjsteelers",u["GVCNYKnicks"]="gvcnyknicks",u["GVCNYRangers"]="gvcnyrangers",u["GVCPA"]="gvcpa",u["Gamdom"]="gamdom",u["Gammix888zch"]="gammix888zch",u["GammixBtz"]="gammixbtz",u["Gammixv88zch"]="gammixv88zch",u["GoldSaloon"]="goldsaloon",u["Goldbet"]="goldbet",u["Goldenpark"]="goldenpark",u["Goodman"]="goodman",u["GrandMadridEs"]="grandmadrides",u["Gslot"]="gslot",u["HappyCasinose"]="happyCasinose",u["HighRoller"]="highroller",u["Hollywoodbets"]="hollywoodbets",u["HpiPh"]="hpiph",u["Hunnyplay"]="hunnyplay",u["Imajbet"]="imajbet",u["Inplay"]="inplay",u["InterWetten"]="interwetten",u["Invicta"]="invicta",u["Jackpocket"]="jackpocket",u["Jacks"]="jacks",u["Jets"]="jets",u["Jugadon"]="jugadon",u["Kazoom"]="kazoom",u["Kindrednl"]="kindrednl",u["Konibet"]="konibet",u["Kwiff"]="kwiff",u["LeoVegas"]="leovegas",u["Lions"]="lions",u["LiveCasino"]="livecasino",u["LiveScoreBet"]="livescorebet",u["LottoLand"]="lottoland",u["Lottomatica"]="lottomatica",u["LoyalCasino"]="loyalcasino",u["LuckMagnumBet"]="luckmagnumbet",u["Luckcom"]="luckcom",u["Luckia"]="luckia",u["Lucky8"]="lucky8",u["Lucky8eu"]="lucky8eu",u["LuckyDreams"]="luckyDreams",u["MadridBet"]="madridbet",u["Magnumbet"]="magnumbet",u["Mansion"]="mansion",u["MarathonBet"]="marathonbet",u["Marsbahis"]="marsbahis",u["MaviGaming"]="mavigaming",u["Metropol"]="metropol",u["MobilBahis"]="mobilbahis",u["Mondo"]="mondo",u["Mostbet"]="mostbet",u["MrGreen"]="mrgreen",u["MrPacho"]="mrpacho",u["N1Casino"]="n1Casino",u["NFLCaesars"]="NFLCaesars",u["NHL"]="NHL",u["NHLCaesars"]="NHLCaesars",u["Napoleon"]="napoleon",u["NetRoulette"]="netroulette",u["NewCastle"]="newcastle",u["NineCasino"]="ninecasino",u["Novibet"]="novibet",u["Okbet"]="okbet",u["Olimpobet"]="olimpobet",u["OlimpobetDotless"]="olimpobetDotless",u["OneXBet"]="1xBet",u["OrangeEntertainm"]="orangeentertainm",u["PaddyPower"]="paddyPower",u["Paston"]="paston",u["PhoneCasino"]="phonecasino",u["PinUp"]="pinup",u["PlayFortuna"]="playFortuna",u["PlayStar"]="playstar",u["Playcet"]="playcet",u["PokerStars"]="pokerstars",u["PokerStarsRedWings"]="pokerstarsredwings",u["PokerStarsUSA"]="pokerstarsusa",u["Pokerdom"]="pokerdom",u["PrincessCasino"]="princesscasino",u["PrincesscasinoCashpot"]="princesscasinoCashpot",u["PublicWin"]="publicwin",u["Rizk"]="rizk",u["Rollbit"]="rollbit",u["Roobet"]="roobet",u["Rox"]="rox",u["RoyalPanda"]="royalpanda",u["RushStreet"]="rushStreet",u["S5"]="s5",u["Samcasino"]="samcasino",u["Sisal"]="sisal",u["Sks365"]="sks365",u["SkyLounge"]="skyLounge",u["Skyline"]="skyline",u["SkylineHny"]="skylineHny",u["SkylineNBG"]="skylinenbg",u["Skylinecubeiab81"]="skylinecubeiab81",u["Skylinesplus"]="skylinesplus",u["SlotV"]="slotv",u["Slotegrator"]="slotegrator",u["SolCasino"]="solCasino",u["Stake"]="stake",u["Standard"]="standard",u["StandardRevamp"]="standard_new",u["Stanleybet"]="stanleybet",u["StanleybetGWC"]="stanleybetGWC",u["StarCasino"]="starcasino",u["Starfishmedia"]="starfishmedia",u["SuperSport"]="supersport",u["SvenskaSpel"]="svenskaspel",u["Tempobet"]="tempobet",u["Tipico"]="tipico",u["TodoSlots"]="todoslots",u["Tonybet"]="tonybet",u["Unibet"]="unibet",u["UnibetSteelers"]="unibetsteelers",u["Vavada"]="vavada",u["VirginBet"]="virginbet",u["VolcanoBet"]="volcanobet",u["Wanabet"]="wanabet",u["WilliamHill"]="williamhill",u["WilliamHillVegas"]="williamhillvegas",u["Win2Day"]="win2day",u["Win2dayAt"]="win2dayat",u["Winbet"]="winbet",u["Winbetro"]="winbetro",u["Winmasters"]="winmasters",u["WorldSportsBetting"]="worldsportsbetting",u["WynnbetMiUs"]="wynnbetmius",u["Y3"]="Y3",u["Yaass"]="yaass",u["YoBingo"]="yobingo",u["YoCasino"]="yocasino",u["Yyycasino"]="yyycasino",u["ZambaCo"]="zambaco"}(U||(U={}))},157355:(u,x,s)=>{s.d(x,{A1:()=>k,AE:()=>Q,Ab:()=>uu,Ap:()=>l,E7:()=>f,EM:()=>o,Fr:()=>I,Gl:()=>E,H5:()=>p,HB:()=>t,Hc:()=>X,JC:()=>h,KD:()=>d,L0:()=>$,Lu:()=>Z,MB:()=>S,M_:()=>w,N$:()=>Uu,Np:()=>L,Pt:()=>R,Tu:()=>G,Tz:()=>n,Xu:()=>A,YB:()=>i,_5:()=>N,_B:()=>q,_o:()=>b,aE:()=>z,b7:()=>H,bp:()=>D,c7:()=>B,cd:()=>_u,dF:()=>T,fX:()=>K,gI:()=>M,gu:()=>y,gv:()=>a,hD:()=>P,i3:()=>J,lG:()=>xu,ob:()=>Y,oj:()=>j,pJ:()=>su,q3:()=>g,q9:()=>r,tp:()=>W,uA:()=>F,uv:()=>e,v1:()=>c,vX:()=>v,wJ:()=>O,xl:()=>_,yg:()=>m,z8:()=>V,zV:()=>C});var U=s(170877);const _=u=>u.ds.IS_DESKTOP,W=u=>u.ds.IS_PHONE,c=u=>u.ds.IS_TABLET,I=u=>!u.ds.IS_DESKTOP,L=()=>!0,J=u=>_(u)||c(u);function k(u){return!u.ds.IS_IPHONE||![U.TP.Iphone5,U.TP.Iphone6,U.TP.IphonePlus,U.TP.IphonePlusZoomed].includes(u.ds.DeviceProperties.appleScreenType)}const i=u=>"sq"===u.languageCode,d=u=>"ar"===u.languageCode,j=u=>"b5"===u.languageCode,r=u=>"bg"===u.languageCode,D=u=>"bn"===u.languageCode,$=u=>"bp"===u.languageCode,H=u=>"ca"===u.languageCode,f=u=>"cf"===u.languageCode,O=u=>"zh"===u.languageCode,t=u=>"mk"===u.languageCode,V=u=>"cs"===u.languageCode,N=u=>"de"===u.languageCode,m=u=>"da"===u.languageCode,b=u=>"el"===u.languageCode,n=u=>"es"===u.languageCode||"s1"===u.languageCode||"s2"===u.languageCode,F=u=>"et"===u.languageCode,B=u=>"fi"===u.languageCode,Z=u=>"fl"===u.languageCode,v=u=>"fr"===u.languageCode,y=u=>"he"===u.languageCode,e=u=>"hi"===u.languageCode,T=u=>"hr"===u.languageCode,Q=u=>"hu"===u.languageCode,E=u=>"hy"===u.languageCode,l=u=>"id"===u.languageCode,z=u=>"it"===u.languageCode,S=u=>"ja"===u.languageCode,R=u=>"ka"===u.languageCode,X=u=>"ko"===u.languageCode,p=u=>"lt"===u.languageCode,G=u=>"lv"===u.languageCode,w=u=>"mn"===u.languageCode,h=u=>"ms"===u.languageCode,P=u=>"nl"===u.languageCode,o=u=>"no"===u.languageCode,C=u=>"pl"===u.languageCode,K=u=>"pt"===u.languageCode,q=u=>"ro"===u.languageCode,Y=u=>"ru"===u.languageCode,g=u=>"te"===u.languageCode,A=u=>"sk"===u.languageCode,M=u=>"sl"===u.languageCode,a=u=>"sr"===u.languageCode,uu=u=>"sv"===u.languageCode,xu=u=>"th"===u.languageCode,su=u=>"tr"===u.languageCode,Uu=u=>"uk"===u.languageCode,_u=u=>"vi"===u.languageCode},235805:(u,x,s)=>{var U=s(881880);s.o(U,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return U.AnimationFrameRate}}),s.o(U,"ArcCamera")&&s.d(x,{ArcCamera:function(){return U.ArcCamera}}),s.o(U,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return U.CHIP_MARGIN}}),s.o(U,"CameraManager")&&s.d(x,{CameraManager:function(){return U.CameraManager}}),s.o(U,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return U.CameraPositionProps}}),s.o(U,"ChipGroup")&&s.d(x,{ChipGroup:function(){return U.ChipGroup}}),s.o(U,"ChipSelector")&&s.d(x,{ChipSelector:function(){return U.ChipSelector}}),s.o(U,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return U.ChipSelectorEvent}}),s.o(U,"ChipStack")&&s.d(x,{ChipStack:function(){return U.ChipStack}}),s.o(U,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return U.ChipStackLabel}}),s.o(U,"CursorHover")&&s.d(x,{CursorHover:function(){return U.CursorHover}}),s.o(U,"DragState")&&s.d(x,{DragState:function(){return U.DragState}}),s.o(U,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return U.ExtendedAction}}),s.o(U,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return U.FakeChipStack}}),s.o(U,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return U.FlickeringLightning}}),s.o(U,"FullCircle")&&s.d(x,{FullCircle:function(){return U.FullCircle}}),s.o(U,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return U.GatheringLightning}}),s.o(U,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return U.GhostChipStack}}),s.o(U,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return U.HTMLMesh}}),s.o(U,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return U.HTMLMeshContainer}}),s.o(U,"Hover")&&s.d(x,{Hover:function(){return U.Hover}}),s.o(U,"HoverState")&&s.d(x,{HoverState:function(){return U.HoverState}}),s.o(U,"LightningStrike")&&s.d(x,{LightningStrike:function(){return U.LightningStrike}}),s.o(U,"LongPress")&&s.d(x,{LongPress:function(){return U.LongPress}}),s.o(U,"LongPressState")&&s.d(x,{LongPressState:function(){return U.LongPressState}}),s.o(U,"Tap")&&s.d(x,{Tap:function(){return U.Tap}}),s.o(U,"TapDrag")&&s.d(x,{TapDrag:function(){return U.TapDrag}}),s.o(U,"TapState")&&s.d(x,{TapState:function(){return U.TapState}}),s.o(U,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return U.TapWithMovement}}),s.o(U,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return U.TapWithMovementState}}),s.o(U,"Timeline")&&s.d(x,{Timeline:function(){return U.Timeline}}),s.o(U,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return U.TimelineDelay}}),s.o(U,"Tooltip")&&s.d(x,{Tooltip:function(){return U.Tooltip}}),s.o(U,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return U.TooltipContainer}}),s.o(U,"TooltipManager")&&s.d(x,{TooltipManager:function(){return U.TooltipManager}}),s.o(U,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return U.TooltipsSystem}}),s.o(U,"Tween")&&s.d(x,{Tween:function(){return U.Tween}}),s.o(U,"TweenGroup")&&s.d(x,{TweenGroup:function(){return U.TweenGroup}}),s.o(U,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return U.TweenGroupParallel}}),s.o(U,"addAction")&&s.d(x,{addAction:function(){return U.addAction}}),s.o(U,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return U.addConstantDelta}}),s.o(U,"addEasing")&&s.d(x,{addEasing:function(){return U.addEasing}}),s.o(U,"addEventAt")&&s.d(x,{addEventAt:function(){return U.addEventAt}}),s.o(U,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return U.addEventAtEnd}}),s.o(U,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return U.addEventAtStart}}),s.o(U,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return U.addMeshToShadowGenerator}}),s.o(U,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return U.addSceneShadowTexture}}),s.o(U,"addShadowTextureTask")&&s.d(x,{addShadowTextureTask:function(){return U.addShadowTextureTask}}),s.o(U,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return U.addShadowUpdateFor}}),s.o(U,"autoPositioningTask")&&s.d(x,{autoPositioningTask:function(){return U.autoPositioningTask}}),s.o(U,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return U.betMeshPrefix}}),s.o(U,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return U.betMeshRegex}}),s.o(U,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return U.calculateChipsForAmount}}),s.o(U,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return U.changeChildOpacity}}),s.o(U,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return U.changeChildVisibility}}),s.o(U,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return U.changeTransparencyModeForPBR}}),s.o(U,"changeVisibility")&&s.d(x,{changeVisibility:function(){return U.changeVisibility}}),s.o(U,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return U.chipStackHeightLimit}}),s.o(U,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return U.convertRotationSpace}}),s.o(U,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return U.convertToPositiveAngle}}),s.o(U,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return U.copyInfoFromMesh}}),s.o(U,"createAnimation")&&s.d(x,{createAnimation:function(){return U.createAnimation}}),s.o(U,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return U.createAssetsManager}}),s.o(U,"createChip")&&s.d(x,{createChip:function(){return U.createChip}}),s.o(U,"createDefaultEngineFeatures")&&s.d(x,{createDefaultEngineFeatures:function(){return U.createDefaultEngineFeatures}}),s.o(U,"createDefaultEngineOptions")&&s.d(x,{createDefaultEngineOptions:function(){return U.createDefaultEngineOptions}}),s.o(U,"createDefaultMaterialFeatures")&&s.d(x,{createDefaultMaterialFeatures:function(){return U.createDefaultMaterialFeatures}}),s.o(U,"createDefaultSceneFeatures")&&s.d(x,{createDefaultSceneFeatures:function(){return U.createDefaultSceneFeatures}}),s.o(U,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return U.createDynamicChip}}),s.o(U,"createEngine")&&s.d(x,{createEngine:function(){return U.createEngine}}),s.o(U,"createEngineTask")&&s.d(x,{createEngineTask:function(){return U.createEngineTask}}),s.o(U,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return U.createGoLiveDoor}}),s.o(U,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return U.createGoLiveParticles}}),s.o(U,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return U.createHTMLMeshTransport}}),s.o(U,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return U.createLightningGlowLayer}}),s.o(U,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return U.createMirrorInstance}}),s.o(U,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return U.createMultiStepAnimation}}),s.o(U,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return U.createNamePatternExcludesTest}}),s.o(U,"createRenderManager")&&s.d(x,{createRenderManager:function(){return U.createRenderManager}}),s.o(U,"createRendererTask")&&s.d(x,{createRendererTask:function(){return U.createRendererTask}}),s.o(U,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return U.createSVGTexture}}),s.o(U,"createScene")&&s.d(x,{createScene:function(){return U.createScene}}),s.o(U,"createSceneTask")&&s.d(x,{createSceneTask:function(){return U.createSceneTask}}),s.o(U,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return U.createStandardDoorAnimation}}),s.o(U,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return U.createTooltipFactory}}),s.o(U,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return U.createTweenGroup}}),s.o(U,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return U.cullingStrategy}}),s.o(U,"debugToolsTask")&&s.d(x,{debugToolsTask:function(){return U.debugToolsTask}}),s.o(U,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return U.differenceBetweenAngles}}),s.o(U,"disableAntiAliasing")&&s.d(x,{disableAntiAliasing:function(){return U.disableAntiAliasing}}),s.o(U,"disableMesh")&&s.d(x,{disableMesh:function(){return U.disableMesh}}),s.o(U,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return U.distributeChipAmounts}}),s.o(U,"durationToFrames")&&s.d(x,{durationToFrames:function(){return U.durationToFrames}}),s.o(U,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return U.enableManualShadowRender}}),s.o(U,"enhanceMeshesTask")&&s.d(x,{enhanceMeshesTask:function(){return U.enhanceMeshesTask}}),s.o(U,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return U.findChildrenAndWrap}}),s.o(U,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return U.forceShadowUpdate}}),s.o(U,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return U.freezeAllActiveMeshes}}),s.o(U,"freezeMesh")&&s.d(x,{freezeMesh:function(){return U.freezeMesh}}),s.o(U,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return U.freezeRecursive}}),s.o(U,"get2dRadius")&&s.d(x,{get2dRadius:function(){return U.get2dRadius}}),s.o(U,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return U.getAbsoluteRotationQuaternion}}),s.o(U,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return U.getAbsoluteScaling}}),s.o(U,"getAngle")&&s.d(x,{getAngle:function(){return U.getAngle}}),s.o(U,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return U.getAnimationLength}}),s.o(U,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return U.getAnimationsFirstPosition}}),s.o(U,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return U.getAvailableAmounts}}),s.o(U,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return U.getBaseChipsByGroup}}),s.o(U,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return U.getBreathingAnimationFrames}}),s.o(U,"getChildByName")&&s.d(x,{getChildByName:function(){return U.getChildByName}}),s.o(U,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return U.getConstantDelta}}),s.o(U,"getDirection")&&s.d(x,{getDirection:function(){return U.getDirection}}),s.o(U,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return U.getLightningPositionWithOffset}}),s.o(U,"getLosingChips")&&s.d(x,{getLosingChips:function(){return U.getLosingChips}}),s.o(U,"getMeshByName")&&s.d(x,{getMeshByName:function(){return U.getMeshByName}}),s.o(U,"getMeshSize")&&s.d(x,{getMeshSize:function(){return U.getMeshSize}}),s.o(U,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return U.getMeshesToLoad}}),s.o(U,"getNodeByName")&&s.d(x,{getNodeByName:function(){return U.getNodeByName}}),s.o(U,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return U.getPointWhereRayIntersectsPlane}}),s.o(U,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return U.getPositionFromAngle}}),s.o(U,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return U.getRadiusToFit}}),s.o(U,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return U.getRegexFromPrefix}}),s.o(U,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return U.getShadowGenerator}}),s.o(U,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return U.getSkeletonAnimationLength}}),s.o(U,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return U.getStandardChipDimensions}}),s.o(U,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return U.getTimeBasedValue}}),s.o(U,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return U.getVisibleArea}}),s.o(U,"globalToLocal")&&s.d(x,{globalToLocal:function(){return U.globalToLocal}}),s.o(U,"hasLight")&&s.d(x,{hasLight:function(){return U.hasLight}}),s.o(U,"initChips")&&s.d(x,{initChips:function(){return U.initChips}}),s.o(U,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return U.interpolateRGB}}),s.o(U,"isBetMesh")&&s.d(x,{isBetMesh:function(){return U.isBetMesh}}),s.o(U,"isMouseInput")&&s.d(x,{isMouseInput:function(){return U.isMouseInput}}),s.o(U,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return U.iterateAncestorsUntil}}),s.o(U,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return U.lightningMeshesDefaultOptions}}),s.o(U,"loadEnvironmentTextureTask")&&s.d(x,{loadEnvironmentTextureTask:function(){return U.loadEnvironmentTextureTask}}),s.o(U,"loadEnvironmentTexturesTask")&&s.d(x,{loadEnvironmentTexturesTask:function(){return U.loadEnvironmentTexturesTask}}),s.o(U,"loadFontTask")&&s.d(x,{loadFontTask:function(){return U.loadFontTask}}),s.o(U,"loadImagesTask")&&s.d(x,{loadImagesTask:function(){return U.loadImagesTask}}),s.o(U,"loadMeshesTask")&&s.d(x,{loadMeshesTask:function(){return U.loadMeshesTask}}),s.o(U,"loadTexturesTask")&&s.d(x,{loadTexturesTask:function(){return U.loadTexturesTask}}),s.o(U,"localToGlobal")&&s.d(x,{localToGlobal:function(){return U.localToGlobal}}),s.o(U,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return U.makeMeshDisable}}),s.o(U,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return U.makeMeshNonPickable}}),s.o(U,"meshExists")&&s.d(x,{meshExists:function(){return U.meshExists}}),s.o(U,"mirrorMeshesTask")&&s.d(x,{mirrorMeshesTask:function(){return U.mirrorMeshesTask}}),s.o(U,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return U.normalizeAngle}}),s.o(U,"pauseRendererTask")&&s.d(x,{pauseRendererTask:function(){return U.pauseRendererTask}}),s.o(U,"pickMesh")&&s.d(x,{pickMesh:function(){return U.pickMesh}}),s.o(U,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return U.pickTopMesh}}),s.o(U,"randomFromArray")&&s.d(x,{randomFromArray:function(){return U.randomFromArray}}),s.o(U,"randomWithSign")&&s.d(x,{randomWithSign:function(){return U.randomWithSign}}),s.o(U,"removeAction")&&s.d(x,{removeAction:function(){return U.removeAction}}),s.o(U,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return U.removeMeshFromShadowGenerator}}),s.o(U,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return U.removeShadowUpdateFor}}),s.o(U,"renderFramesTask")&&s.d(x,{renderFramesTask:function(){return U.renderFramesTask}}),s.o(U,"replaceMaterialTexturesTask")&&s.d(x,{replaceMaterialTexturesTask:function(){return U.replaceMaterialTexturesTask}}),s.o(U,"roundTo")&&s.d(x,{roundTo:function(){return U.roundTo}}),s.o(U,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return U.roundVectorTo}}),s.o(U,"runScriptTask")&&s.d(x,{runScriptTask:function(){return U.runScriptTask}}),s.o(U,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return U.scalarToVector3}}),s.o(U,"setMaterialFeatures")&&s.d(x,{setMaterialFeatures:function(){return U.setMaterialFeatures}}),s.o(U,"setMaterialFeaturesTask")&&s.d(x,{setMaterialFeaturesTask:function(){return U.setMaterialFeaturesTask}}),s.o(U,"skipAnimations")&&s.d(x,{skipAnimations:function(){return U.skipAnimations}}),s.o(U,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return U.stopAnimationFor}}),s.o(U,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return U.swapSubMaterial}}),s.o(U,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return U.syncBoundingInfoOff}}),s.o(U,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return U.toScreenSpace}}),s.o(U,"tweenTo")&&s.d(x,{tweenTo:function(){return U.tweenTo}}),s.o(U,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return U.tweenToPromise}}),s.o(U,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return U.unfreezeAllActiveMeshes}}),s.o(U,"union")&&s.d(x,{union:function(){return U.union}}),s.o(U,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return U.updatePivotPointFor}}),s.o(U,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return U.updateRenderingGroup}}),s.o(U,"useDiffuseTextureAsEmissiveTask")&&s.d(x,{useDiffuseTextureAsEmissiveTask:function(){return U.useDiffuseTextureAsEmissiveTask}}),s.o(U,"wait")&&s.d(x,{wait:function(){return U.wait}}),s.o(U,"waitAsync")&&s.d(x,{waitAsync:function(){return U.waitAsync}}),s.o(U,"waitForSceneReadyTask")&&s.d(x,{waitForSceneReadyTask:function(){return U.waitForSceneReadyTask}}),s.o(U,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return U.waitRenderFrames}})},881880:()=>{},320148:(u,x,s)=>{s.d(x,{A:()=>L,KD:()=>k,_V:()=>J,dl:()=>I,oK:()=>c,q1:()=>j});var U=s(948733),_=s(36195),W=s(484802);function c(u){return(null==u?void 0:u.hasOwnProperty("resource3dPath"))&&u.resource3dPath}function I(u,x){return r(u,x)||{}}function L(u){return"string"!=typeof u}function J(u){return u instanceof W.L?J(u.value):"string"==typeof u||"string"==typeof u.path}function k(u){return u&&Object.values(_.M).includes(u)}function i(u){return(null==u?void 0:u.hasOwnProperty("value"))&&"function"==typeof u.condition}function d(u){return Array.isArray(u)&&u.length>0&&u.every(i)}function j(u,x,s){if(!x)throw new Error("Cannot modify undefined material");if(d(x))throw new Error(`Cannot modify configurable material with ${u} property`);const U=x[u];if(U)return d(U)?U:"string"==typeof U?{path:U,...s}:U instanceof W.L?{path:U.value,...s}:{...U,...s}}function r(u,x){if(d(u))return function(u,x){if(d(u)){const s=u.find((u=>u.condition(x)));return s?"function"==typeof s.value?s.value():s.value:void 0}return u}(u,x);if(null!==u&&!Array.isArray(u)&&!function(u){return u instanceof U.Pq||u instanceof U.v9||u instanceof U.ov||u instanceof W.L}(u)&&"object"==typeof u){let s;return Object.keys(u).forEach((U=>{const _=r(u[U],x);void 0!==_&&(void 0===s&&(s={}),s[U]=r(_,x))})),s}return u}},600239:(u,x,s)=>{s.d(x,{P:()=>d,_:()=>j});var U=s(371020),_=s(654550),W=s(948733),c=s(600962),I=s(898973),L=s(131208),J=s(557295),k=s(16633);const i={alpha:I.S0.ToRadians(198),beta:I.S0.ToRadians(0),radius:250,target:W.Pq.Zero()},d="ArcCamera";class j{constructor(u,x={}){this.scene=u,this.defaultTweenDuration=.5;const s={...i,...x};this.camera=new _.L(d,0,0,0,W.Pq.Zero(),this.scene),this.cameraTarget=c.Jo.CreateBox("cameraTarget",{size:1e-4},this.scene),this.cameraTarget.visibility=1e-4,this.cameraTarget.isPickable=!1,this.camera.setTarget(this.cameraTarget),this.camera.alpha=s.alpha,this.camera.beta=s.beta,this.camera.radius=s.radius,void 0!==s.fov&&(this.camera.fov=s.fov),this.scene.setActiveCameraByName(d)}focusCameraOn(u){this.stopAnimations(),void 0!==u.target&&(this.camera.setTarget(u.target.clone()),this.cameraTarget.position=u.target.clone()),void 0!==u.alpha&&(this.camera.alpha=u.alpha),void 0!==u.beta&&(this.camera.beta=u.beta),void 0!==u.radius&&(this.camera.radius=u.radius),void 0!==u.fov&&(this.camera.fov=u.fov),this.camera.computeWorldMatrix()}flyTo({delay:u,duration:x,easingFunc:s,easingMode:_=U.KA.EASINGMODE_EASEINOUT,onStart:W,onComplete:c,onCancel:I,constantDelta:J,...i}){this.stopAnimations();const d=Object.values(k.D).reduce(((u,x)=>{const s=x===k.D.Target,U=i[x];return void 0===U||U===this.camera[x]||s&&this.cameraTarget.position.equalsWithEpsilon(U)?u:s?(this.camera.setTarget(this.cameraTarget),u.concat({target:this.cameraTarget,props:{position:U},settings:{inTangent:i.inTangent,outTangent:i.outTangent}})):u.concat({target:this.camera,props:{[x]:U}})}),[]);d.length>0?this.cameraAnimations=[L.Zs(d,x||this.defaultTweenDuration,{delay:u,easingFunc:s,easingMode:_,onComplete:c,onStart:W,onCancel:I||c,constantDelta:J})]:(W&&W(),c&&c())}flyThroughWaypoints(u,x){this.stopAnimations(),this.camera.setTarget(this.cameraTarget);const s=[],{target:U,..._}=u.props;return U&&s.push({target:this.cameraTarget,props:{position:U}}),s.push({target:this.camera,props:_}),J.C(s,u.duration,this.camera.getScene(),x)}setTargetPosition(u){const x=this.alpha,s=this.beta,U=this.camera.radius;this.cameraTarget.position=u,this.camera.setTarget(this.cameraTarget),this.camera.alpha=x,this.camera.beta=s,this.camera.radius=U,this.camera.computeWorldMatrix()}getTargetPosition(){return this.cameraTarget.position}setRadius(u){this.camera.radius=u}setMinZ(u){this.camera.minZ=u}get fov(){return this.camera.fov}get beta(){return this.camera.beta}set beta(u){this.camera.beta=u}get alpha(){return this.camera.alpha}set alpha(u){this.camera.alpha=u}get aspectRatio(){return this.scene.getEngine().getAspectRatio(this.camera)}dispose(){this.stopAnimations(),this.camera.dispose()}stopAnimations(){if(this.cameraAnimations){for(const u of this.cameraAnimations)u.stop();this.cameraAnimations=void 0}}}},104128:(u,x,s)=>{s.d(x,{v:()=>_});var U=s(615473);function _(u){return U.X.Clamp(16*Math.round(u.getAnimationRatio()),16,64)}},976160:(u,x,s)=>{if(s.d(x,{D7:()=>W.D,Xj:()=>_.X,_q:()=>U._,v2:()=>c.v}),94988!=s.j)var U=s(600239);if(!/^(14232|49135|81052|94988)$/.test(s.j))var _=s(210166);if(!/^(49135|81052|94988)$/.test(s.j))var W=s(16633);if(!/^(18036|27272|49135|68901|81052|94988)$/.test(s.j))var c=s(104128)},16633:(u,x,s)=>{var U;s.d(x,{D:()=>U}),function(u){u["Alpha"]="alpha",u["Beta"]="beta",u["Radius"]="radius",u["Fov"]="fov",u["Target"]="target"}(U||(U={}))},879042:(u,x,s)=>{if(s.d(x,{ArcCamera:()=>U._q,CHIP_MARGIN:()=>_.UQ,CameraManager:()=>U.Xj,CameraPositionProps:()=>U.D7,ChipGroup:()=>_.Iy,ChipSelector:()=>_.IW,ChipSelectorEvent:()=>_.ed,ChipStack:()=>_.XB,ChipStackLabel:()=>_.Xp,FakeChipStack:()=>_.yl,FlickeringLightning:()=>L.hs,GatheringLightning:()=>L.Mn,GhostChipStack:()=>_.CR,HTMLMesh:()=>c.vh,HTMLMeshContainer:()=>c.Eh,LightningStrike:()=>L.$0,Tooltip:()=>I.Tooltip,TooltipContainer:()=>I.TooltipContainer,TooltipManager:()=>I.TooltipManager,TooltipsSystem:()=>I.TooltipsSystem,chipStackHeightLimit:()=>_.$N,createChip:()=>_.zk,createDynamicChip:()=>_._O,createGoLiveDoor:()=>W.D3,createGoLiveParticles:()=>W.Mh,createHTMLMeshTransport:()=>c.e$,createLightningGlowLayer:()=>L.xQ,createStandardDoorAnimation:()=>W.Wp,createTooltipFactory:()=>I.createTooltipFactory,getAvailableAmounts:()=>_.Dg,getBaseChipsByGroup:()=>_.d9,getConstantDelta:()=>U.v2,getLightningPositionWithOffset:()=>L.fk,getLosingChips:()=>_.i6,getStandardChipDimensions:()=>_.hU,initChips:()=>_.WN,lightningMeshesDefaultOptions:()=>L.dA}),94988!=s.j)var U=s(976160);if(!/^(27272|49135|68901|81052)$/.test(s.j))var _=s(631693);if(/^(1(1123|4232|8036)|4832|49135|77899|94988)$/.test(s.j))var W=s(618357);if(!/^(18036|49135|68901|81052|94988)$/.test(s.j))var c=s(662519);if(81052!=s.j)var I=s(384698);if(81052!=s.j&&s.o(I,"CursorHover")&&s.d(x,{CursorHover:function(){return I.CursorHover}}),81052!=s.j&&s.o(I,"DragState")&&s.d(x,{DragState:function(){return I.DragState}}),81052!=s.j&&s.o(I,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return I.ExtendedAction}}),81052!=s.j&&s.o(I,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return I.FlickeringLightning}}),81052!=s.j&&s.o(I,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return I.GatheringLightning}}),81052!=s.j&&s.o(I,"Hover")&&s.d(x,{Hover:function(){return I.Hover}}),81052!=s.j&&s.o(I,"HoverState")&&s.d(x,{HoverState:function(){return I.HoverState}}),81052!=s.j&&s.o(I,"LightningStrike")&&s.d(x,{LightningStrike:function(){return I.LightningStrike}}),81052!=s.j&&s.o(I,"LongPress")&&s.d(x,{LongPress:function(){return I.LongPress}}),81052!=s.j&&s.o(I,"LongPressState")&&s.d(x,{LongPressState:function(){return I.LongPressState}}),81052!=s.j&&s.o(I,"Tap")&&s.d(x,{Tap:function(){return I.Tap}}),81052!=s.j&&s.o(I,"TapDrag")&&s.d(x,{TapDrag:function(){return I.TapDrag}}),81052!=s.j&&s.o(I,"TapState")&&s.d(x,{TapState:function(){return I.TapState}}),81052!=s.j&&s.o(I,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return I.TapWithMovement}}),81052!=s.j&&s.o(I,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return I.TapWithMovementState}}),81052!=s.j&&s.o(I,"addAction")&&s.d(x,{addAction:function(){return I.addAction}}),81052!=s.j&&s.o(I,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return I.createLightningGlowLayer}}),81052!=s.j&&s.o(I,"createRenderManager")&&s.d(x,{createRenderManager:function(){return I.createRenderManager}}),81052!=s.j&&s.o(I,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return I.getLightningPositionWithOffset}}),81052!=s.j&&s.o(I,"isMouseInput")&&s.d(x,{isMouseInput:function(){return I.isMouseInput}}),81052!=s.j&&s.o(I,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return I.lightningMeshesDefaultOptions}}),81052!=s.j&&s.o(I,"removeAction")&&s.d(x,{removeAction:function(){return I.removeAction}}),/^((831|949)88|14232|21167|60297|68901|90066)$/.test(s.j))var L=s(729899)},384698:(u,x,s)=>{if(s.d(x,{Tooltip:()=>_.m,TooltipContainer:()=>L.h,TooltipManager:()=>c.J,TooltipsSystem:()=>I.M,createTooltipFactory:()=>W.k}),81052!=s.j)var U=s(986219);if(81052!=s.j&&s.o(U,"CursorHover")&&s.d(x,{CursorHover:function(){return U.CursorHover}}),81052!=s.j&&s.o(U,"DragState")&&s.d(x,{DragState:function(){return U.DragState}}),81052!=s.j&&s.o(U,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return U.ExtendedAction}}),81052!=s.j&&s.o(U,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return U.FlickeringLightning}}),81052!=s.j&&s.o(U,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return U.GatheringLightning}}),81052!=s.j&&s.o(U,"Hover")&&s.d(x,{Hover:function(){return U.Hover}}),81052!=s.j&&s.o(U,"HoverState")&&s.d(x,{HoverState:function(){return U.HoverState}}),81052!=s.j&&s.o(U,"LightningStrike")&&s.d(x,{LightningStrike:function(){return U.LightningStrike}}),81052!=s.j&&s.o(U,"LongPress")&&s.d(x,{LongPress:function(){return U.LongPress}}),81052!=s.j&&s.o(U,"LongPressState")&&s.d(x,{LongPressState:function(){return U.LongPressState}}),81052!=s.j&&s.o(U,"Tap")&&s.d(x,{Tap:function(){return U.Tap}}),81052!=s.j&&s.o(U,"TapDrag")&&s.d(x,{TapDrag:function(){return U.TapDrag}}),81052!=s.j&&s.o(U,"TapState")&&s.d(x,{TapState:function(){return U.TapState}}),81052!=s.j&&s.o(U,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return U.TapWithMovement}}),81052!=s.j&&s.o(U,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return U.TapWithMovementState}}),81052!=s.j&&s.o(U,"addAction")&&s.d(x,{addAction:function(){return U.addAction}}),81052!=s.j&&s.o(U,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return U.createLightningGlowLayer}}),81052!=s.j&&s.o(U,"createRenderManager")&&s.d(x,{createRenderManager:function(){return U.createRenderManager}}),81052!=s.j&&s.o(U,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return U.getLightningPositionWithOffset}}),81052!=s.j&&s.o(U,"isMouseInput")&&s.d(x,{isMouseInput:function(){return U.isMouseInput}}),81052!=s.j&&s.o(U,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return U.lightningMeshesDefaultOptions}}),81052!=s.j&&s.o(U,"removeAction")&&s.d(x,{removeAction:function(){return U.removeAction}}),/^(11123|21167|4832|60297|77899|83188|90066)$/.test(s.j))var _=s(678489);if(!/^(11123|18036|49135|68901|77899|81052|94988)$/.test(s.j))var W=s(152103);if(!/^(18036|49135|68901|81052|94988)$/.test(s.j))var c=s(887374);if(/^(14232|40457)$/.test(s.j))var I=s(700690);if(!/^(18036|49135|68901|81052|94988)$/.test(s.j))var L=s(244853)},986219:()=>{},670459:(u,x,s)=>{s.d(x,{P:()=>V});var U=s(548949),_=s(738759),W=s(136685),c=s(332290),I=s(604910),L=s(384511);const J={copy:u=>u.clone(),lerp:(u,x,s,U)=>{c.v9.LerpToRef(u,x,s,U)}},k={copy:u=>u.clone(),lerp:(u,x,s,U)=>{c.ov.LerpToRef(u,x,s,U)}},i={copy:u=>u.clone(),lerp:(u,x,s,U)=>{I.uq.LerpToRef(u,x,s,U)}},d={copy:u=>u.clone(),lerp:(u,x,s,U)=>{I.PT.SlerpToRef(u,x,s,U)}},j={copy:u=>u.clone(),lerp:(u,x,s,U)=>{U.set(L.Cc(u.x,x.x,s),L.Cc(u.y,x.y,s))}},r={copy:u=>u.clone(),lerp:(u,x,s,U)=>{I.Pq.LerpToRef(u,x,s,U)}},D=[u=>{if(u instanceof c.v9)return J},u=>{if(u instanceof c.ov)return k},u=>{if(u instanceof I.PT)return d},u=>{if(u instanceof I.uq)return i},u=>{if(u instanceof I.I9)return j},u=>{if(u instanceof I.Pq)return r}],$="__BABYLONJS__";var H=s(412067),f=s(277082),O=s(328910);class t extends H.N{getHardwareScalingLevel(u=!0){const x=u?f.getReverseScale():1;return super.getHardwareScalingLevel()*x}dispose(){O.tx(),super.dispose()}}function V(u,x,s){const c=new t(u,void 0,x,s.adaptToDeviceRatio);return c.enableOfflineSupport=s.enableOfflineSupport,c.renderEvenInBackground=s.renderEvenInBackground,c.disableManifestCheck=s.disableManifestCheck,c.disablePerformanceMonitorInBackground=s.disablePerformanceMonitorInBackground,U.cn.ForceFullSceneLoadingForIncremental=s.forceFullSceneLoadingForIncremental,U.cn.ShowLoadingScreen=!1,s.highPrecisionShaderSupported||(c.getCaps().highPrecisionShaderSupported=!1),s.disableHardwareScaling||c.setHardwareScalingLevel(s.hardwareScale),_.KC(c.webGLVersion),W.ui($,D),c.onDisposeObservable.addOnce((()=>{W.Xv($)})),c._features.forceBitmapOverHTMLImageElement="function"==typeof createImageBitmap,c}},217057:(u,x,s)=>{s.d(x,{D:()=>_});var U=s(615473);function _(u){return{disableManifestCheck:!0,enableOfflineSupport:!1,renderEvenInBackground:!1,adaptToDeviceRatio:!1,highPrecisionShaderSupported:!u.IS_HIGH_PRECISION_SHADER_DISABLED,disableHardwareScaling:!1,forceFullSceneLoadingForIncremental:!0,hardwareScale:W(u),disablePerformanceMonitorInBackground:!0}}function W(u){const x=window.devicePixelRatio||1;if(u.IS_PHONE){const u=.7;return U.X.Clamp(1/x,u,.9)}return U.X.Clamp(1/x,.6,.8)}},787170:(u,x,s)=>{function U(u){return{audioEngine:!1,antialias:!W(u),disableWebGL2Support:_(u),xrCompatible:!1}}function _(u){return u.IS_ANDROID&&(!u.IS_ANDROID8_0_0_PLUS&&u.IS_SAMSUNG_NATIVE_BROWSER||u.IS_UCBROWSER||u.IS_QQBROWSER||u.IS_MEIZUBROWSER||u.IS_CHROME120)}function W(u){return u.IS_IOS&&u.cmpVersions(u.DeviceProperties.osVersion,"15.4")>=0&&u.cmpVersions(u.DeviceProperties.osVersion,"15.5")<0||u.IS_SAFARI&&u.cmpVersions(u.DeviceProperties.browserVersion,"15.4")>=0&&u.cmpVersions(u.DeviceProperties.browserVersion,"15.5")<0}s.d(x,{XI:()=>W,k_:()=>U})},929139:(u,x,s)=>{s.d(x,{createDefaultEngineFeatures:()=>L.D,createDefaultEngineOptions:()=>J.k_,createDefaultMaterialFeatures:()=>_.u,createDefaultSceneFeatures:()=>c.t,createEngine:()=>I.P,createScene:()=>W.B,disableAntiAliasing:()=>J.XI,setMaterialFeatures:()=>_.P});var U=s(328617);s.o(U,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return U.AnimationFrameRate}}),s.o(U,"ArcCamera")&&s.d(x,{ArcCamera:function(){return U.ArcCamera}}),s.o(U,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return U.CHIP_MARGIN}}),s.o(U,"CameraManager")&&s.d(x,{CameraManager:function(){return U.CameraManager}}),s.o(U,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return U.CameraPositionProps}}),s.o(U,"ChipGroup")&&s.d(x,{ChipGroup:function(){return U.ChipGroup}}),s.o(U,"ChipSelector")&&s.d(x,{ChipSelector:function(){return U.ChipSelector}}),s.o(U,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return U.ChipSelectorEvent}}),s.o(U,"ChipStack")&&s.d(x,{ChipStack:function(){return U.ChipStack}}),s.o(U,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return U.ChipStackLabel}}),s.o(U,"CursorHover")&&s.d(x,{CursorHover:function(){return U.CursorHover}}),s.o(U,"DragState")&&s.d(x,{DragState:function(){return U.DragState}}),s.o(U,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return U.ExtendedAction}}),s.o(U,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return U.FakeChipStack}}),s.o(U,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return U.FlickeringLightning}}),s.o(U,"FullCircle")&&s.d(x,{FullCircle:function(){return U.FullCircle}}),s.o(U,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return U.GatheringLightning}}),s.o(U,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return U.GhostChipStack}}),s.o(U,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return U.HTMLMesh}}),s.o(U,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return U.HTMLMeshContainer}}),s.o(U,"Hover")&&s.d(x,{Hover:function(){return U.Hover}}),s.o(U,"HoverState")&&s.d(x,{HoverState:function(){return U.HoverState}}),s.o(U,"LightningStrike")&&s.d(x,{LightningStrike:function(){return U.LightningStrike}}),s.o(U,"LongPress")&&s.d(x,{LongPress:function(){return U.LongPress}}),s.o(U,"LongPressState")&&s.d(x,{LongPressState:function(){return U.LongPressState}}),s.o(U,"Tap")&&s.d(x,{Tap:function(){return U.Tap}}),s.o(U,"TapDrag")&&s.d(x,{TapDrag:function(){return U.TapDrag}}),s.o(U,"TapState")&&s.d(x,{TapState:function(){return U.TapState}}),s.o(U,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return U.TapWithMovement}}),s.o(U,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return U.TapWithMovementState}}),s.o(U,"Timeline")&&s.d(x,{Timeline:function(){return U.Timeline}}),s.o(U,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return U.TimelineDelay}}),s.o(U,"Tooltip")&&s.d(x,{Tooltip:function(){return U.Tooltip}}),s.o(U,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return U.TooltipContainer}}),s.o(U,"TooltipManager")&&s.d(x,{TooltipManager:function(){return U.TooltipManager}}),s.o(U,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return U.TooltipsSystem}}),s.o(U,"Tween")&&s.d(x,{Tween:function(){return U.Tween}}),s.o(U,"TweenGroup")&&s.d(x,{TweenGroup:function(){return U.TweenGroup}}),s.o(U,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return U.TweenGroupParallel}}),s.o(U,"addAction")&&s.d(x,{addAction:function(){return U.addAction}}),s.o(U,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return U.addConstantDelta}}),s.o(U,"addEasing")&&s.d(x,{addEasing:function(){return U.addEasing}}),s.o(U,"addEventAt")&&s.d(x,{addEventAt:function(){return U.addEventAt}}),s.o(U,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return U.addEventAtEnd}}),s.o(U,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return U.addEventAtStart}}),s.o(U,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return U.addMeshToShadowGenerator}}),s.o(U,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return U.addSceneShadowTexture}}),s.o(U,"addShadowTextureTask")&&s.d(x,{addShadowTextureTask:function(){return U.addShadowTextureTask}}),s.o(U,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return U.addShadowUpdateFor}}),s.o(U,"autoPositioningTask")&&s.d(x,{autoPositioningTask:function(){return U.autoPositioningTask}}),s.o(U,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return U.betMeshPrefix}}),s.o(U,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return U.betMeshRegex}}),s.o(U,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return U.calculateChipsForAmount}}),s.o(U,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return U.changeChildOpacity}}),s.o(U,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return U.changeChildVisibility}}),s.o(U,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return U.changeTransparencyModeForPBR}}),s.o(U,"changeVisibility")&&s.d(x,{changeVisibility:function(){return U.changeVisibility}}),s.o(U,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return U.chipStackHeightLimit}}),s.o(U,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return U.convertRotationSpace}}),s.o(U,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return U.convertToPositiveAngle}}),s.o(U,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return U.copyInfoFromMesh}}),s.o(U,"createAnimation")&&s.d(x,{createAnimation:function(){return U.createAnimation}}),s.o(U,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return U.createAssetsManager}}),s.o(U,"createChip")&&s.d(x,{createChip:function(){return U.createChip}}),s.o(U,"createDefaultEngineFeatures")&&s.d(x,{createDefaultEngineFeatures:function(){return U.createDefaultEngineFeatures}}),s.o(U,"createDefaultEngineOptions")&&s.d(x,{createDefaultEngineOptions:function(){return U.createDefaultEngineOptions}}),s.o(U,"createDefaultMaterialFeatures")&&s.d(x,{createDefaultMaterialFeatures:function(){return U.createDefaultMaterialFeatures}}),s.o(U,"createDefaultSceneFeatures")&&s.d(x,{createDefaultSceneFeatures:function(){return U.createDefaultSceneFeatures}}),s.o(U,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return U.createDynamicChip}}),s.o(U,"createEngine")&&s.d(x,{createEngine:function(){return U.createEngine}}),s.o(U,"createEngineTask")&&s.d(x,{createEngineTask:function(){return U.createEngineTask}}),s.o(U,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return U.createGoLiveDoor}}),s.o(U,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return U.createGoLiveParticles}}),s.o(U,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return U.createHTMLMeshTransport}}),s.o(U,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return U.createLightningGlowLayer}}),s.o(U,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return U.createMirrorInstance}}),s.o(U,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return U.createMultiStepAnimation}}),s.o(U,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return U.createNamePatternExcludesTest}}),s.o(U,"createRenderManager")&&s.d(x,{createRenderManager:function(){return U.createRenderManager}}),s.o(U,"createRendererTask")&&s.d(x,{createRendererTask:function(){return U.createRendererTask}}),s.o(U,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return U.createSVGTexture}}),s.o(U,"createScene")&&s.d(x,{createScene:function(){return U.createScene}}),s.o(U,"createSceneTask")&&s.d(x,{createSceneTask:function(){return U.createSceneTask}}),s.o(U,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return U.createStandardDoorAnimation}}),s.o(U,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return U.createTooltipFactory}}),s.o(U,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return U.createTweenGroup}}),s.o(U,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return U.cullingStrategy}}),s.o(U,"debugToolsTask")&&s.d(x,{debugToolsTask:function(){return U.debugToolsTask}}),s.o(U,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return U.differenceBetweenAngles}}),s.o(U,"disableAntiAliasing")&&s.d(x,{disableAntiAliasing:function(){return U.disableAntiAliasing}}),s.o(U,"disableMesh")&&s.d(x,{disableMesh:function(){return U.disableMesh}}),s.o(U,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return U.distributeChipAmounts}}),s.o(U,"durationToFrames")&&s.d(x,{durationToFrames:function(){return U.durationToFrames}}),s.o(U,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return U.enableManualShadowRender}}),s.o(U,"enhanceMeshesTask")&&s.d(x,{enhanceMeshesTask:function(){return U.enhanceMeshesTask}}),s.o(U,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return U.findChildrenAndWrap}}),s.o(U,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return U.forceShadowUpdate}}),s.o(U,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return U.freezeAllActiveMeshes}}),s.o(U,"freezeMesh")&&s.d(x,{freezeMesh:function(){return U.freezeMesh}}),s.o(U,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return U.freezeRecursive}}),s.o(U,"get2dRadius")&&s.d(x,{get2dRadius:function(){return U.get2dRadius}}),s.o(U,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return U.getAbsoluteRotationQuaternion}}),s.o(U,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return U.getAbsoluteScaling}}),s.o(U,"getAngle")&&s.d(x,{getAngle:function(){return U.getAngle}}),s.o(U,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return U.getAnimationLength}}),s.o(U,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return U.getAnimationsFirstPosition}}),s.o(U,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return U.getAvailableAmounts}}),s.o(U,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return U.getBaseChipsByGroup}}),s.o(U,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return U.getBreathingAnimationFrames}}),s.o(U,"getChildByName")&&s.d(x,{getChildByName:function(){return U.getChildByName}}),s.o(U,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return U.getConstantDelta}}),s.o(U,"getDirection")&&s.d(x,{getDirection:function(){return U.getDirection}}),s.o(U,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return U.getLightningPositionWithOffset}}),s.o(U,"getLosingChips")&&s.d(x,{getLosingChips:function(){return U.getLosingChips}}),s.o(U,"getMeshByName")&&s.d(x,{getMeshByName:function(){return U.getMeshByName}}),s.o(U,"getMeshSize")&&s.d(x,{getMeshSize:function(){return U.getMeshSize}}),s.o(U,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return U.getMeshesToLoad}}),s.o(U,"getNodeByName")&&s.d(x,{getNodeByName:function(){return U.getNodeByName}}),s.o(U,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return U.getPointWhereRayIntersectsPlane}}),s.o(U,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return U.getPositionFromAngle}}),s.o(U,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return U.getRadiusToFit}}),s.o(U,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return U.getRegexFromPrefix}}),s.o(U,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return U.getShadowGenerator}}),s.o(U,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return U.getSkeletonAnimationLength}}),s.o(U,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return U.getStandardChipDimensions}}),s.o(U,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return U.getTimeBasedValue}}),s.o(U,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return U.getVisibleArea}}),s.o(U,"globalToLocal")&&s.d(x,{globalToLocal:function(){return U.globalToLocal}}),s.o(U,"hasLight")&&s.d(x,{hasLight:function(){return U.hasLight}}),s.o(U,"initChips")&&s.d(x,{initChips:function(){return U.initChips}}),s.o(U,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return U.interpolateRGB}}),s.o(U,"isBetMesh")&&s.d(x,{isBetMesh:function(){return U.isBetMesh}}),s.o(U,"isMouseInput")&&s.d(x,{isMouseInput:function(){return U.isMouseInput}}),s.o(U,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return U.iterateAncestorsUntil}}),s.o(U,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return U.lightningMeshesDefaultOptions}}),s.o(U,"loadEnvironmentTextureTask")&&s.d(x,{loadEnvironmentTextureTask:function(){return U.loadEnvironmentTextureTask}}),s.o(U,"loadEnvironmentTexturesTask")&&s.d(x,{loadEnvironmentTexturesTask:function(){return U.loadEnvironmentTexturesTask}}),s.o(U,"loadFontTask")&&s.d(x,{loadFontTask:function(){return U.loadFontTask}}),s.o(U,"loadImagesTask")&&s.d(x,{loadImagesTask:function(){return U.loadImagesTask}}),s.o(U,"loadMeshesTask")&&s.d(x,{loadMeshesTask:function(){return U.loadMeshesTask}}),s.o(U,"loadTexturesTask")&&s.d(x,{loadTexturesTask:function(){return U.loadTexturesTask}}),s.o(U,"localToGlobal")&&s.d(x,{localToGlobal:function(){return U.localToGlobal}}),s.o(U,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return U.makeMeshDisable}}),s.o(U,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return U.makeMeshNonPickable}}),s.o(U,"meshExists")&&s.d(x,{meshExists:function(){return U.meshExists}}),s.o(U,"mirrorMeshesTask")&&s.d(x,{mirrorMeshesTask:function(){return U.mirrorMeshesTask}}),s.o(U,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return U.normalizeAngle}}),s.o(U,"pauseRendererTask")&&s.d(x,{pauseRendererTask:function(){return U.pauseRendererTask}}),s.o(U,"pickMesh")&&s.d(x,{pickMesh:function(){return U.pickMesh}}),s.o(U,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return U.pickTopMesh}}),s.o(U,"randomFromArray")&&s.d(x,{randomFromArray:function(){return U.randomFromArray}}),s.o(U,"randomWithSign")&&s.d(x,{randomWithSign:function(){return U.randomWithSign}}),s.o(U,"removeAction")&&s.d(x,{removeAction:function(){return U.removeAction}}),s.o(U,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return U.removeMeshFromShadowGenerator}}),s.o(U,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return U.removeShadowUpdateFor}}),s.o(U,"renderFramesTask")&&s.d(x,{renderFramesTask:function(){return U.renderFramesTask}}),s.o(U,"replaceMaterialTexturesTask")&&s.d(x,{replaceMaterialTexturesTask:function(){return U.replaceMaterialTexturesTask}}),s.o(U,"roundTo")&&s.d(x,{roundTo:function(){return U.roundTo}}),s.o(U,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return U.roundVectorTo}}),s.o(U,"runScriptTask")&&s.d(x,{runScriptTask:function(){return U.runScriptTask}}),s.o(U,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return U.scalarToVector3}}),s.o(U,"setMaterialFeatures")&&s.d(x,{setMaterialFeatures:function(){return U.setMaterialFeatures}}),s.o(U,"setMaterialFeaturesTask")&&s.d(x,{setMaterialFeaturesTask:function(){return U.setMaterialFeaturesTask}}),s.o(U,"skipAnimations")&&s.d(x,{skipAnimations:function(){return U.skipAnimations}}),s.o(U,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return U.stopAnimationFor}}),s.o(U,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return U.swapSubMaterial}}),s.o(U,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return U.syncBoundingInfoOff}}),s.o(U,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return U.toScreenSpace}}),s.o(U,"tweenTo")&&s.d(x,{tweenTo:function(){return U.tweenTo}}),s.o(U,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return U.tweenToPromise}}),s.o(U,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return U.unfreezeAllActiveMeshes}}),s.o(U,"union")&&s.d(x,{union:function(){return U.union}}),s.o(U,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return U.updatePivotPointFor}}),s.o(U,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return U.updateRenderingGroup}}),s.o(U,"useDiffuseTextureAsEmissiveTask")&&s.d(x,{useDiffuseTextureAsEmissiveTask:function(){return U.useDiffuseTextureAsEmissiveTask}}),s.o(U,"wait")&&s.d(x,{wait:function(){return U.wait}}),s.o(U,"waitAsync")&&s.d(x,{waitAsync:function(){return U.waitAsync}}),s.o(U,"waitForSceneReadyTask")&&s.d(x,{waitForSceneReadyTask:function(){return U.waitForSceneReadyTask}}),s.o(U,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return U.waitRenderFrames}});var _=s(534565);if(!/^((1423|2727|8105)2|18036|40457|49135|68901)$/.test(s.j))var W=s(934724);var c=s(168111);if(94988==s.j)var I=s(670459);var L=s(217057),J=s(787170)},534565:(u,x,s)=>{s.d(x,{P:()=>_,u:()=>W});var U=s(32138);function _(u){U.F.LightmapTextureEnabled=u.LightmapTextureEnabled,U.F.AmbientTextureEnabled=u.AmbientTextureEnabled,U.F.RefractionTextureEnabled=u.RefractionTextureEnabled,U.F.ReflectionTextureEnabled=u.ReflectionTextureEnabled,U.F.ColorGradingTextureEnabled=u.ColorGradingTextureEnabled,U.F.FresnelEnabled=u.FresnelEnabled,U.F.SpecularTextureEnabled=u.SpecularTextureEnabled}function W(){return{AmbientTextureEnabled:!1,RefractionTextureEnabled:!0,ReflectionTextureEnabled:!0,ColorGradingTextureEnabled:!1,LightmapTextureEnabled:!0,FresnelEnabled:!1,SpecularTextureEnabled:!0}}},934724:(u,x,s)=>{s.d(x,{B:()=>I});var U=s(889460),_=s(898973),W=s(706211),c=s(968556);function I(u,x){const s=new U.Z(u);return x.pointerMovePredicate&&(s.pointerMovePredicate=x.pointerMovePredicate),x.pointerDownPredicate&&(s.pointerDownPredicate=x.pointerDownPredicate),x.pointerUpPredicate&&(s.pointerUpPredicate=x.pointerUpPredicate),x.clearColor&&(s.clearColor=x.clearColor),s.collisionsEnabled=x.collisionsEnabled,s.autoClear=x.autoClear,s.autoClearDepthAndStencil=x.autoClearDepthAndStencil,s.fogEnabled=x.fogEnabled,s.lensFlaresEnabled=x.lensFlaresEnabled,s.postProcessesEnabled=x.postProcessesEnabled,s.probesEnabled=x.probesEnabled,s.proceduralTexturesEnabled=x.proceduralTexturesEnabled,s.spritesEnabled=x.spritesEnabled,s.skeletonsEnabled=x.skeletonsEnabled,s.shadowsEnabled=x.shadowsEnabled,s.physicsEnabled=x.physicsEnabled,s.particlesEnabled=x.particlesEnabled,x.needInput?(function(u){const x=`${_.S0.GetPointerPrefix(u.getEngine())}cancel`,s=x=>{u._inputManager._onPointerUp(x)};window.addEventListener(x,s,!1),u.onDisposeObservable.addOnce((()=>{window.removeEventListener(x,s,!1)}))}(s),function(u){const x=x=>{u.onPointerObservable.notifyObservers(new W.mx(c.S.POINTER_LEAVE,x,null))},s=u.getEngine().getRenderingCanvas();s&&(s.addEventListener("pointerout",x,!1),u.onDisposeObservable.addOnce((()=>{s.removeEventListener("pointerout",x,!1)})))}(s)):s.detachControl(),s}},168111:(u,x,s)=>{function U(){return{pointerDownPredicate:u=>u.isPickable&&u.isVisible,pointerMovePredicate:u=>u.isPickable&&u.isVisible&&u.enablePointerMoveEvents,pointerUpPredicate:u=>u.isPickable&&u.isVisible,needInput:!0,collisionsEnabled:!1,autoClear:!1,autoClearDepthAndStencil:!1,fogEnabled:!1,lensFlaresEnabled:!1,probesEnabled:!1,proceduralTexturesEnabled:!1,spritesEnabled:!1,skeletonsEnabled:!1,postProcessesEnabled:!1,shadowsEnabled:!0,renderTargetsEnabled:!1,physicsEnabled:!1,particlesEnabled:!0}}s.d(x,{t:()=>U})},328617:()=>{},83193:(u,x,s)=>{s.d(x,{AnimationFrameRate:()=>I.AnimationFrameRate,ArcCamera:()=>L.ArcCamera,CHIP_MARGIN:()=>L.CHIP_MARGIN,CameraManager:()=>L.CameraManager,CameraPositionProps:()=>L.CameraPositionProps,ChipGroup:()=>L.ChipGroup,ChipSelector:()=>L.ChipSelector,ChipSelectorEvent:()=>L.ChipSelectorEvent,ChipStack:()=>L.ChipStack,ChipStackLabel:()=>L.ChipStackLabel,CursorHover:()=>J.CursorHover,DragState:()=>J.DragState,ExtendedAction:()=>J.ExtendedAction,FakeChipStack:()=>L.FakeChipStack,FlickeringLightning:()=>L.FlickeringLightning,FullCircle:()=>I.FullCircle,GatheringLightning:()=>L.GatheringLightning,GhostChipStack:()=>L.GhostChipStack,HTMLMesh:()=>L.HTMLMesh,HTMLMeshContainer:()=>L.HTMLMeshContainer,Hover:()=>J.Hover,HoverState:()=>J.HoverState,LightningStrike:()=>L.LightningStrike,LongPress:()=>J.LongPress,LongPressState:()=>J.LongPressState,Tap:()=>J.Tap,TapDrag:()=>J.TapDrag,TapState:()=>J.TapState,TapWithMovement:()=>J.TapWithMovement,TapWithMovementState:()=>J.TapWithMovementState,Timeline:()=>I.Timeline,TimelineDelay:()=>I.TimelineDelay,Tween:()=>I.Tween,TweenGroup:()=>I.TweenGroup,TweenGroupParallel:()=>I.TweenGroupParallel,addAction:()=>J.addAction,addConstantDelta:()=>I.addConstantDelta,addEasing:()=>I.addEasing,addEventAt:()=>I.addEventAt,addEventAtEnd:()=>I.addEventAtEnd,addEventAtStart:()=>I.addEventAtStart,addMeshToShadowGenerator:()=>I.addMeshToShadowGenerator,addSceneShadowTexture:()=>I.addSceneShadowTexture,addShadowTextureTask:()=>W.addShadowTextureTask,addShadowUpdateFor:()=>I.addShadowUpdateFor,autoPositioningTask:()=>W.autoPositioningTask,betMeshPrefix:()=>I.betMeshPrefix,betMeshRegex:()=>I.betMeshRegex,calculateChipsForAmount:()=>I.calculateChipsForAmount,changeChildOpacity:()=>I.changeChildOpacity,changeChildVisibility:()=>I.changeChildVisibility,changeTransparencyModeForPBR:()=>I.changeTransparencyModeForPBR,changeVisibility:()=>I.changeVisibility,chipStackHeightLimit:()=>L.chipStackHeightLimit,convertRotationSpace:()=>I.convertRotationSpace,convertToPositiveAngle:()=>I.convertToPositiveAngle,copyInfoFromMesh:()=>I.copyInfoFromMesh,createAnimation:()=>I.createAnimation,createAssetsManager:()=>I.createAssetsManager,createChip:()=>L.createChip,createDefaultEngineFeatures:()=>_.createDefaultEngineFeatures,createDefaultEngineOptions:()=>_.createDefaultEngineOptions,createDefaultMaterialFeatures:()=>_.createDefaultMaterialFeatures,createDefaultSceneFeatures:()=>_.createDefaultSceneFeatures,createDynamicChip:()=>L.createDynamicChip,createEngine:()=>_.createEngine,createEngineTask:()=>W.createEngineTask,createGoLiveDoor:()=>L.createGoLiveDoor,createGoLiveParticles:()=>L.createGoLiveParticles,createHTMLMeshTransport:()=>L.createHTMLMeshTransport,createLightningGlowLayer:()=>L.createLightningGlowLayer,createMirrorInstance:()=>I.createMirrorInstance,createMultiStepAnimation:()=>I.createMultiStepAnimation,createNamePatternExcludesTest:()=>c.createNamePatternExcludesTest,createRendererTask:()=>W.createRendererTask,createSVGTexture:()=>I.createSVGTexture,createScene:()=>_.createScene,createSceneTask:()=>W.createSceneTask,createStandardDoorAnimation:()=>L.createStandardDoorAnimation,createTweenGroup:()=>I.createTweenGroup,cullingStrategy:()=>c.cullingStrategy,debugToolsTask:()=>W.debugToolsTask,differenceBetweenAngles:()=>I.differenceBetweenAngles,disableAntiAliasing:()=>_.disableAntiAliasing,disableMesh:()=>I.disableMesh,distributeChipAmounts:()=>I.distributeChipAmounts,durationToFrames:()=>I.durationToFrames,enableManualShadowRender:()=>I.enableManualShadowRender,enhanceMeshesTask:()=>W.enhanceMeshesTask,findChildrenAndWrap:()=>I.findChildrenAndWrap,forceShadowUpdate:()=>I.forceShadowUpdate,freezeAllActiveMeshes:()=>I.freezeAllActiveMeshes,freezeMesh:()=>c.freezeMesh,freezeRecursive:()=>I.freezeRecursive,get2dRadius:()=>I.get2dRadius,getAbsoluteRotationQuaternion:()=>I.getAbsoluteRotationQuaternion,getAbsoluteScaling:()=>I.getAbsoluteScaling,getAngle:()=>I.getAngle,getAnimationLength:()=>I.getAnimationLength,getAnimationsFirstPosition:()=>I.getAnimationsFirstPosition,getAvailableAmounts:()=>L.getAvailableAmounts,getBaseChipsByGroup:()=>L.getBaseChipsByGroup,getBreathingAnimationFrames:()=>I.getBreathingAnimationFrames,getChildByName:()=>I.getChildByName,getConstantDelta:()=>L.getConstantDelta,getDirection:()=>I.getDirection,getLightningPositionWithOffset:()=>L.getLightningPositionWithOffset,getLosingChips:()=>L.getLosingChips,getMeshByName:()=>I.getMeshByName,getMeshSize:()=>I.getMeshSize,getMeshesToLoad:()=>I.getMeshesToLoad,getNodeByName:()=>I.getNodeByName,getPointWhereRayIntersectsPlane:()=>I.getPointWhereRayIntersectsPlane,getPositionFromAngle:()=>I.getPositionFromAngle,getRadiusToFit:()=>I.getRadiusToFit,getRegexFromPrefix:()=>I.getRegexFromPrefix,getShadowGenerator:()=>I.getShadowGenerator,getSkeletonAnimationLength:()=>I.getSkeletonAnimationLength,getStandardChipDimensions:()=>L.getStandardChipDimensions,getTimeBasedValue:()=>I.getTimeBasedValue,getVisibleArea:()=>I.getVisibleArea,globalToLocal:()=>I.globalToLocal,hasLight:()=>I.hasLight,initChips:()=>L.initChips,interpolateRGB:()=>I.interpolateRGB,isBetMesh:()=>I.isBetMesh,isMouseInput:()=>J.isMouseInput,iterateAncestorsUntil:()=>I.iterateAncestorsUntil,lightningMeshesDefaultOptions:()=>L.lightningMeshesDefaultOptions,loadEnvironmentTextureTask:()=>W.loadEnvironmentTextureTask,loadEnvironmentTexturesTask:()=>W.loadEnvironmentTexturesTask,loadFontTask:()=>W.loadFontTask,loadImagesTask:()=>W.loadImagesTask,loadMeshesTask:()=>W.loadMeshesTask,loadTexturesTask:()=>W.loadTexturesTask,localToGlobal:()=>I.localToGlobal,makeMeshDisable:()=>c.makeMeshDisable,makeMeshNonPickable:()=>c.makeMeshNonPickable,meshExists:()=>I.meshExists,mirrorMeshesTask:()=>W.mirrorMeshesTask,normalizeAngle:()=>I.normalizeAngle,pauseRendererTask:()=>W.pauseRendererTask,pickMesh:()=>I.pickMesh,pickTopMesh:()=>I.pickTopMesh,randomFromArray:()=>I.randomFromArray,randomWithSign:()=>I.randomWithSign,removeAction:()=>J.removeAction,removeMeshFromShadowGenerator:()=>I.removeMeshFromShadowGenerator,removeShadowUpdateFor:()=>I.removeShadowUpdateFor,renderFramesTask:()=>W.renderFramesTask,replaceMaterialTexturesTask:()=>W.replaceMaterialTexturesTask,roundTo:()=>I.roundTo,roundVectorTo:()=>I.roundVectorTo,runScriptTask:()=>W.runScriptTask,scalarToVector3:()=>I.scalarToVector3,setMaterialFeatures:()=>_.setMaterialFeatures,setMaterialFeaturesTask:()=>W.setMaterialFeaturesTask,skipAnimations:()=>W.skipAnimations,stopAnimationFor:()=>I.stopAnimationFor,swapSubMaterial:()=>I.swapSubMaterial,syncBoundingInfoOff:()=>c.syncBoundingInfoOff,toScreenSpace:()=>I.toScreenSpace,tweenTo:()=>I.tweenTo,tweenToPromise:()=>I.tweenToPromise,unfreezeAllActiveMeshes:()=>I.unfreezeAllActiveMeshes,union:()=>I.union,updatePivotPointFor:()=>I.updatePivotPointFor,updateRenderingGroup:()=>I.updateRenderingGroup,useDiffuseTextureAsEmissiveTask:()=>W.useDiffuseTextureAsEmissiveTask,wait:()=>I.wait,waitAsync:()=>I.waitAsync,waitForSceneReadyTask:()=>W.waitForSceneReadyTask,waitRenderFrames:()=>I.waitRenderFrames});var U=s(235805);s.o(U,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return U.AnimationFrameRate}}),s.o(U,"ArcCamera")&&s.d(x,{ArcCamera:function(){return U.ArcCamera}}),s.o(U,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return U.CHIP_MARGIN}}),s.o(U,"CameraManager")&&s.d(x,{CameraManager:function(){return U.CameraManager}}),s.o(U,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return U.CameraPositionProps}}),s.o(U,"ChipGroup")&&s.d(x,{ChipGroup:function(){return U.ChipGroup}}),s.o(U,"ChipSelector")&&s.d(x,{ChipSelector:function(){return U.ChipSelector}}),s.o(U,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return U.ChipSelectorEvent}}),s.o(U,"ChipStack")&&s.d(x,{ChipStack:function(){return U.ChipStack}}),s.o(U,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return U.ChipStackLabel}}),s.o(U,"CursorHover")&&s.d(x,{CursorHover:function(){return U.CursorHover}}),s.o(U,"DragState")&&s.d(x,{DragState:function(){return U.DragState}}),s.o(U,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return U.ExtendedAction}}),s.o(U,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return U.FakeChipStack}}),s.o(U,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return U.FlickeringLightning}}),s.o(U,"FullCircle")&&s.d(x,{FullCircle:function(){return U.FullCircle}}),s.o(U,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return U.GatheringLightning}}),s.o(U,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return U.GhostChipStack}}),s.o(U,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return U.HTMLMesh}}),s.o(U,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return U.HTMLMeshContainer}}),s.o(U,"Hover")&&s.d(x,{Hover:function(){return U.Hover}}),s.o(U,"HoverState")&&s.d(x,{HoverState:function(){return U.HoverState}}),s.o(U,"LightningStrike")&&s.d(x,{LightningStrike:function(){return U.LightningStrike}}),s.o(U,"LongPress")&&s.d(x,{LongPress:function(){return U.LongPress}}),s.o(U,"LongPressState")&&s.d(x,{LongPressState:function(){return U.LongPressState}}),s.o(U,"Tap")&&s.d(x,{Tap:function(){return U.Tap}}),s.o(U,"TapDrag")&&s.d(x,{TapDrag:function(){return U.TapDrag}}),s.o(U,"TapState")&&s.d(x,{TapState:function(){return U.TapState}}),s.o(U,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return U.TapWithMovement}}),s.o(U,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return U.TapWithMovementState}}),s.o(U,"Timeline")&&s.d(x,{Timeline:function(){return U.Timeline}}),s.o(U,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return U.TimelineDelay}}),s.o(U,"Tooltip")&&s.d(x,{Tooltip:function(){return U.Tooltip}}),s.o(U,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return U.TooltipContainer}}),s.o(U,"TooltipManager")&&s.d(x,{TooltipManager:function(){return U.TooltipManager}}),s.o(U,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return U.TooltipsSystem}}),s.o(U,"Tween")&&s.d(x,{Tween:function(){return U.Tween}}),s.o(U,"TweenGroup")&&s.d(x,{TweenGroup:function(){return U.TweenGroup}}),s.o(U,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return U.TweenGroupParallel}}),s.o(U,"addAction")&&s.d(x,{addAction:function(){return U.addAction}}),s.o(U,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return U.addConstantDelta}}),s.o(U,"addEasing")&&s.d(x,{addEasing:function(){return U.addEasing}}),s.o(U,"addEventAt")&&s.d(x,{addEventAt:function(){return U.addEventAt}}),s.o(U,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return U.addEventAtEnd}}),s.o(U,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return U.addEventAtStart}}),s.o(U,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return U.addMeshToShadowGenerator}}),s.o(U,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return U.addSceneShadowTexture}}),s.o(U,"addShadowTextureTask")&&s.d(x,{addShadowTextureTask:function(){return U.addShadowTextureTask}}),s.o(U,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return U.addShadowUpdateFor}}),s.o(U,"autoPositioningTask")&&s.d(x,{autoPositioningTask:function(){return U.autoPositioningTask}}),s.o(U,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return U.betMeshPrefix}}),s.o(U,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return U.betMeshRegex}}),s.o(U,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return U.calculateChipsForAmount}}),s.o(U,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return U.changeChildOpacity}}),s.o(U,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return U.changeChildVisibility}}),s.o(U,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return U.changeTransparencyModeForPBR}}),s.o(U,"changeVisibility")&&s.d(x,{changeVisibility:function(){return U.changeVisibility}}),s.o(U,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return U.chipStackHeightLimit}}),s.o(U,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return U.convertRotationSpace}}),s.o(U,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return U.convertToPositiveAngle}}),s.o(U,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return U.copyInfoFromMesh}}),s.o(U,"createAnimation")&&s.d(x,{createAnimation:function(){return U.createAnimation}}),s.o(U,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return U.createAssetsManager}}),s.o(U,"createChip")&&s.d(x,{createChip:function(){return U.createChip}}),s.o(U,"createDefaultEngineFeatures")&&s.d(x,{createDefaultEngineFeatures:function(){return U.createDefaultEngineFeatures}}),s.o(U,"createDefaultEngineOptions")&&s.d(x,{createDefaultEngineOptions:function(){return U.createDefaultEngineOptions}}),s.o(U,"createDefaultMaterialFeatures")&&s.d(x,{createDefaultMaterialFeatures:function(){return U.createDefaultMaterialFeatures}}),s.o(U,"createDefaultSceneFeatures")&&s.d(x,{createDefaultSceneFeatures:function(){return U.createDefaultSceneFeatures}}),s.o(U,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return U.createDynamicChip}}),s.o(U,"createEngine")&&s.d(x,{createEngine:function(){return U.createEngine}}),s.o(U,"createEngineTask")&&s.d(x,{createEngineTask:function(){return U.createEngineTask}}),s.o(U,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return U.createGoLiveDoor}}),s.o(U,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return U.createGoLiveParticles}}),s.o(U,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return U.createHTMLMeshTransport}}),s.o(U,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return U.createLightningGlowLayer}}),s.o(U,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return U.createMirrorInstance}}),s.o(U,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return U.createMultiStepAnimation}}),s.o(U,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return U.createNamePatternExcludesTest}}),s.o(U,"createRenderManager")&&s.d(x,{createRenderManager:function(){return U.createRenderManager}}),s.o(U,"createRendererTask")&&s.d(x,{createRendererTask:function(){return U.createRendererTask}}),s.o(U,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return U.createSVGTexture}}),s.o(U,"createScene")&&s.d(x,{createScene:function(){return U.createScene}}),s.o(U,"createSceneTask")&&s.d(x,{createSceneTask:function(){return U.createSceneTask}}),s.o(U,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return U.createStandardDoorAnimation}}),s.o(U,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return U.createTooltipFactory}}),s.o(U,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return U.createTweenGroup}}),s.o(U,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return U.cullingStrategy}}),s.o(U,"debugToolsTask")&&s.d(x,{debugToolsTask:function(){return U.debugToolsTask}}),s.o(U,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return U.differenceBetweenAngles}}),s.o(U,"disableAntiAliasing")&&s.d(x,{disableAntiAliasing:function(){return U.disableAntiAliasing}}),s.o(U,"disableMesh")&&s.d(x,{disableMesh:function(){return U.disableMesh}}),s.o(U,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return U.distributeChipAmounts}}),s.o(U,"durationToFrames")&&s.d(x,{durationToFrames:function(){return U.durationToFrames}}),s.o(U,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return U.enableManualShadowRender}}),s.o(U,"enhanceMeshesTask")&&s.d(x,{enhanceMeshesTask:function(){return U.enhanceMeshesTask}}),s.o(U,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return U.findChildrenAndWrap}}),s.o(U,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return U.forceShadowUpdate}}),s.o(U,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return U.freezeAllActiveMeshes}}),s.o(U,"freezeMesh")&&s.d(x,{freezeMesh:function(){return U.freezeMesh}}),s.o(U,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return U.freezeRecursive}}),s.o(U,"get2dRadius")&&s.d(x,{get2dRadius:function(){return U.get2dRadius}}),s.o(U,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return U.getAbsoluteRotationQuaternion}}),s.o(U,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return U.getAbsoluteScaling}}),s.o(U,"getAngle")&&s.d(x,{getAngle:function(){return U.getAngle}}),s.o(U,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return U.getAnimationLength}}),s.o(U,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return U.getAnimationsFirstPosition}}),s.o(U,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return U.getAvailableAmounts}}),s.o(U,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return U.getBaseChipsByGroup}}),s.o(U,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return U.getBreathingAnimationFrames}}),s.o(U,"getChildByName")&&s.d(x,{getChildByName:function(){return U.getChildByName}}),s.o(U,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return U.getConstantDelta}}),s.o(U,"getDirection")&&s.d(x,{getDirection:function(){return U.getDirection}}),s.o(U,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return U.getLightningPositionWithOffset}}),s.o(U,"getLosingChips")&&s.d(x,{getLosingChips:function(){return U.getLosingChips}}),s.o(U,"getMeshByName")&&s.d(x,{getMeshByName:function(){return U.getMeshByName}}),s.o(U,"getMeshSize")&&s.d(x,{getMeshSize:function(){return U.getMeshSize}}),s.o(U,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return U.getMeshesToLoad}}),s.o(U,"getNodeByName")&&s.d(x,{getNodeByName:function(){return U.getNodeByName}}),s.o(U,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return U.getPointWhereRayIntersectsPlane}}),s.o(U,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return U.getPositionFromAngle}}),s.o(U,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return U.getRadiusToFit}}),s.o(U,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return U.getRegexFromPrefix}}),s.o(U,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return U.getShadowGenerator}}),s.o(U,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return U.getSkeletonAnimationLength}}),s.o(U,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return U.getStandardChipDimensions}}),s.o(U,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return U.getTimeBasedValue}}),s.o(U,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return U.getVisibleArea}}),s.o(U,"globalToLocal")&&s.d(x,{globalToLocal:function(){return U.globalToLocal}}),s.o(U,"hasLight")&&s.d(x,{hasLight:function(){return U.hasLight}}),s.o(U,"initChips")&&s.d(x,{initChips:function(){return U.initChips}}),s.o(U,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return U.interpolateRGB}}),s.o(U,"isBetMesh")&&s.d(x,{isBetMesh:function(){return U.isBetMesh}}),s.o(U,"isMouseInput")&&s.d(x,{isMouseInput:function(){return U.isMouseInput}}),s.o(U,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return U.iterateAncestorsUntil}}),s.o(U,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return U.lightningMeshesDefaultOptions}}),s.o(U,"loadEnvironmentTextureTask")&&s.d(x,{loadEnvironmentTextureTask:function(){return U.loadEnvironmentTextureTask}}),s.o(U,"loadEnvironmentTexturesTask")&&s.d(x,{loadEnvironmentTexturesTask:function(){return U.loadEnvironmentTexturesTask}}),s.o(U,"loadFontTask")&&s.d(x,{loadFontTask:function(){return U.loadFontTask}}),s.o(U,"loadImagesTask")&&s.d(x,{loadImagesTask:function(){return U.loadImagesTask}}),s.o(U,"loadMeshesTask")&&s.d(x,{loadMeshesTask:function(){return U.loadMeshesTask}}),s.o(U,"loadTexturesTask")&&s.d(x,{loadTexturesTask:function(){return U.loadTexturesTask}}),s.o(U,"localToGlobal")&&s.d(x,{localToGlobal:function(){return U.localToGlobal}}),s.o(U,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return U.makeMeshDisable}}),s.o(U,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return U.makeMeshNonPickable}}),s.o(U,"meshExists")&&s.d(x,{meshExists:function(){return U.meshExists}}),s.o(U,"mirrorMeshesTask")&&s.d(x,{mirrorMeshesTask:function(){return U.mirrorMeshesTask}}),s.o(U,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return U.normalizeAngle}}),s.o(U,"pauseRendererTask")&&s.d(x,{pauseRendererTask:function(){return U.pauseRendererTask}}),s.o(U,"pickMesh")&&s.d(x,{pickMesh:function(){return U.pickMesh}}),s.o(U,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return U.pickTopMesh}}),s.o(U,"randomFromArray")&&s.d(x,{randomFromArray:function(){return U.randomFromArray}}),s.o(U,"randomWithSign")&&s.d(x,{randomWithSign:function(){return U.randomWithSign}}),s.o(U,"removeAction")&&s.d(x,{removeAction:function(){return U.removeAction}}),s.o(U,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return U.removeMeshFromShadowGenerator}}),s.o(U,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return U.removeShadowUpdateFor}}),s.o(U,"renderFramesTask")&&s.d(x,{renderFramesTask:function(){return U.renderFramesTask}}),s.o(U,"replaceMaterialTexturesTask")&&s.d(x,{replaceMaterialTexturesTask:function(){return U.replaceMaterialTexturesTask}}),s.o(U,"roundTo")&&s.d(x,{roundTo:function(){return U.roundTo}}),s.o(U,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return U.roundVectorTo}}),s.o(U,"runScriptTask")&&s.d(x,{runScriptTask:function(){return U.runScriptTask}}),s.o(U,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return U.scalarToVector3}}),s.o(U,"setMaterialFeatures")&&s.d(x,{setMaterialFeatures:function(){return U.setMaterialFeatures}}),s.o(U,"setMaterialFeaturesTask")&&s.d(x,{setMaterialFeaturesTask:function(){return U.setMaterialFeaturesTask}}),s.o(U,"skipAnimations")&&s.d(x,{skipAnimations:function(){return U.skipAnimations}}),s.o(U,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return U.stopAnimationFor}}),s.o(U,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return U.swapSubMaterial}}),s.o(U,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return U.syncBoundingInfoOff}}),s.o(U,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return U.toScreenSpace}}),s.o(U,"tweenTo")&&s.d(x,{tweenTo:function(){return U.tweenTo}}),s.o(U,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return U.tweenToPromise}}),s.o(U,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return U.unfreezeAllActiveMeshes}}),s.o(U,"union")&&s.d(x,{union:function(){return U.union}}),s.o(U,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return U.updatePivotPointFor}}),s.o(U,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return U.updateRenderingGroup}}),s.o(U,"useDiffuseTextureAsEmissiveTask")&&s.d(x,{useDiffuseTextureAsEmissiveTask:function(){return U.useDiffuseTextureAsEmissiveTask}}),s.o(U,"wait")&&s.d(x,{wait:function(){return U.wait}}),s.o(U,"waitAsync")&&s.d(x,{waitAsync:function(){return U.waitAsync}}),s.o(U,"waitForSceneReadyTask")&&s.d(x,{waitForSceneReadyTask:function(){return U.waitForSceneReadyTask}}),s.o(U,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return U.waitRenderFrames}});var _=s(929139);s.o(_,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return _.AnimationFrameRate}}),s.o(_,"ArcCamera")&&s.d(x,{ArcCamera:function(){return _.ArcCamera}}),s.o(_,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return _.CHIP_MARGIN}}),s.o(_,"CameraManager")&&s.d(x,{CameraManager:function(){return _.CameraManager}}),s.o(_,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return _.CameraPositionProps}}),s.o(_,"ChipGroup")&&s.d(x,{ChipGroup:function(){return _.ChipGroup}}),s.o(_,"ChipSelector")&&s.d(x,{ChipSelector:function(){return _.ChipSelector}}),s.o(_,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return _.ChipSelectorEvent}}),s.o(_,"ChipStack")&&s.d(x,{ChipStack:function(){return _.ChipStack}}),s.o(_,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return _.ChipStackLabel}}),s.o(_,"CursorHover")&&s.d(x,{CursorHover:function(){return _.CursorHover}}),s.o(_,"DragState")&&s.d(x,{DragState:function(){return _.DragState}}),s.o(_,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return _.ExtendedAction}}),s.o(_,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return _.FakeChipStack}}),s.o(_,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return _.FlickeringLightning}}),s.o(_,"FullCircle")&&s.d(x,{FullCircle:function(){return _.FullCircle}}),s.o(_,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return _.GatheringLightning}}),s.o(_,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return _.GhostChipStack}}),s.o(_,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return _.HTMLMesh}}),s.o(_,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return _.HTMLMeshContainer}}),s.o(_,"Hover")&&s.d(x,{Hover:function(){return _.Hover}}),s.o(_,"HoverState")&&s.d(x,{HoverState:function(){return _.HoverState}}),s.o(_,"LightningStrike")&&s.d(x,{LightningStrike:function(){return _.LightningStrike}}),s.o(_,"LongPress")&&s.d(x,{LongPress:function(){return _.LongPress}}),s.o(_,"LongPressState")&&s.d(x,{LongPressState:function(){return _.LongPressState}}),s.o(_,"Tap")&&s.d(x,{Tap:function(){return _.Tap}}),s.o(_,"TapDrag")&&s.d(x,{TapDrag:function(){return _.TapDrag}}),s.o(_,"TapState")&&s.d(x,{TapState:function(){return _.TapState}}),s.o(_,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return _.TapWithMovement}}),s.o(_,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return _.TapWithMovementState}}),s.o(_,"Timeline")&&s.d(x,{Timeline:function(){return _.Timeline}}),s.o(_,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return _.TimelineDelay}}),s.o(_,"Tooltip")&&s.d(x,{Tooltip:function(){return _.Tooltip}}),s.o(_,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return _.TooltipContainer}}),s.o(_,"TooltipManager")&&s.d(x,{TooltipManager:function(){return _.TooltipManager}}),s.o(_,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return _.TooltipsSystem}}),s.o(_,"Tween")&&s.d(x,{Tween:function(){return _.Tween}}),s.o(_,"TweenGroup")&&s.d(x,{TweenGroup:function(){return _.TweenGroup}}),s.o(_,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return _.TweenGroupParallel}}),s.o(_,"addAction")&&s.d(x,{addAction:function(){return _.addAction}}),s.o(_,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return _.addConstantDelta}}),s.o(_,"addEasing")&&s.d(x,{addEasing:function(){return _.addEasing}}),s.o(_,"addEventAt")&&s.d(x,{addEventAt:function(){return _.addEventAt}}),s.o(_,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return _.addEventAtEnd}}),s.o(_,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return _.addEventAtStart}}),s.o(_,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return _.addMeshToShadowGenerator}}),s.o(_,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return _.addSceneShadowTexture}}),s.o(_,"addShadowTextureTask")&&s.d(x,{addShadowTextureTask:function(){return _.addShadowTextureTask}}),s.o(_,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return _.addShadowUpdateFor}}),s.o(_,"autoPositioningTask")&&s.d(x,{autoPositioningTask:function(){return _.autoPositioningTask}}),s.o(_,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return _.betMeshPrefix}}),s.o(_,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return _.betMeshRegex}}),s.o(_,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return _.calculateChipsForAmount}}),s.o(_,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return _.changeChildOpacity}}),s.o(_,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return _.changeChildVisibility}}),s.o(_,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return _.changeTransparencyModeForPBR}}),s.o(_,"changeVisibility")&&s.d(x,{changeVisibility:function(){return _.changeVisibility}}),s.o(_,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return _.chipStackHeightLimit}}),s.o(_,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return _.convertRotationSpace}}),s.o(_,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return _.convertToPositiveAngle}}),s.o(_,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return _.copyInfoFromMesh}}),s.o(_,"createAnimation")&&s.d(x,{createAnimation:function(){return _.createAnimation}}),s.o(_,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return _.createAssetsManager}}),s.o(_,"createChip")&&s.d(x,{createChip:function(){return _.createChip}}),s.o(_,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return _.createDynamicChip}}),s.o(_,"createEngineTask")&&s.d(x,{createEngineTask:function(){return _.createEngineTask}}),s.o(_,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return _.createGoLiveDoor}}),s.o(_,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return _.createGoLiveParticles}}),s.o(_,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return _.createHTMLMeshTransport}}),s.o(_,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return _.createLightningGlowLayer}}),s.o(_,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return _.createMirrorInstance}}),s.o(_,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return _.createMultiStepAnimation}}),s.o(_,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return _.createNamePatternExcludesTest}}),s.o(_,"createRenderManager")&&s.d(x,{createRenderManager:function(){return _.createRenderManager}}),s.o(_,"createRendererTask")&&s.d(x,{createRendererTask:function(){return _.createRendererTask}}),s.o(_,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return _.createSVGTexture}}),s.o(_,"createSceneTask")&&s.d(x,{createSceneTask:function(){return _.createSceneTask}}),s.o(_,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return _.createStandardDoorAnimation}}),s.o(_,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return _.createTooltipFactory}}),s.o(_,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return _.createTweenGroup}}),s.o(_,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return _.cullingStrategy}}),s.o(_,"debugToolsTask")&&s.d(x,{debugToolsTask:function(){return _.debugToolsTask}}),s.o(_,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return _.differenceBetweenAngles}}),s.o(_,"disableMesh")&&s.d(x,{disableMesh:function(){return _.disableMesh}}),s.o(_,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return _.distributeChipAmounts}}),s.o(_,"durationToFrames")&&s.d(x,{durationToFrames:function(){return _.durationToFrames}}),s.o(_,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return _.enableManualShadowRender}}),s.o(_,"enhanceMeshesTask")&&s.d(x,{enhanceMeshesTask:function(){return _.enhanceMeshesTask}}),s.o(_,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return _.findChildrenAndWrap}}),s.o(_,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return _.forceShadowUpdate}}),s.o(_,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return _.freezeAllActiveMeshes}}),s.o(_,"freezeMesh")&&s.d(x,{freezeMesh:function(){return _.freezeMesh}}),s.o(_,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return _.freezeRecursive}}),s.o(_,"get2dRadius")&&s.d(x,{get2dRadius:function(){return _.get2dRadius}}),s.o(_,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return _.getAbsoluteRotationQuaternion}}),s.o(_,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return _.getAbsoluteScaling}}),s.o(_,"getAngle")&&s.d(x,{getAngle:function(){return _.getAngle}}),s.o(_,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return _.getAnimationLength}}),s.o(_,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return _.getAnimationsFirstPosition}}),s.o(_,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return _.getAvailableAmounts}}),s.o(_,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return _.getBaseChipsByGroup}}),s.o(_,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return _.getBreathingAnimationFrames}}),s.o(_,"getChildByName")&&s.d(x,{getChildByName:function(){return _.getChildByName}}),s.o(_,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return _.getConstantDelta}}),s.o(_,"getDirection")&&s.d(x,{getDirection:function(){return _.getDirection}}),s.o(_,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return _.getLightningPositionWithOffset}}),s.o(_,"getLosingChips")&&s.d(x,{getLosingChips:function(){return _.getLosingChips}}),s.o(_,"getMeshByName")&&s.d(x,{getMeshByName:function(){return _.getMeshByName}}),s.o(_,"getMeshSize")&&s.d(x,{getMeshSize:function(){return _.getMeshSize}}),s.o(_,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return _.getMeshesToLoad}}),s.o(_,"getNodeByName")&&s.d(x,{getNodeByName:function(){return _.getNodeByName}}),s.o(_,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return _.getPointWhereRayIntersectsPlane}}),s.o(_,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return _.getPositionFromAngle}}),s.o(_,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return _.getRadiusToFit}}),s.o(_,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return _.getRegexFromPrefix}}),s.o(_,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return _.getShadowGenerator}}),s.o(_,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return _.getSkeletonAnimationLength}}),s.o(_,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return _.getStandardChipDimensions}}),s.o(_,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return _.getTimeBasedValue}}),s.o(_,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return _.getVisibleArea}}),s.o(_,"globalToLocal")&&s.d(x,{globalToLocal:function(){return _.globalToLocal}}),s.o(_,"hasLight")&&s.d(x,{hasLight:function(){return _.hasLight}}),s.o(_,"initChips")&&s.d(x,{initChips:function(){return _.initChips}}),s.o(_,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return _.interpolateRGB}}),s.o(_,"isBetMesh")&&s.d(x,{isBetMesh:function(){return _.isBetMesh}}),s.o(_,"isMouseInput")&&s.d(x,{isMouseInput:function(){return _.isMouseInput}}),s.o(_,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return _.iterateAncestorsUntil}}),s.o(_,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return _.lightningMeshesDefaultOptions}}),s.o(_,"loadEnvironmentTextureTask")&&s.d(x,{loadEnvironmentTextureTask:function(){return _.loadEnvironmentTextureTask}}),s.o(_,"loadEnvironmentTexturesTask")&&s.d(x,{loadEnvironmentTexturesTask:function(){return _.loadEnvironmentTexturesTask}}),s.o(_,"loadFontTask")&&s.d(x,{loadFontTask:function(){return _.loadFontTask}}),s.o(_,"loadImagesTask")&&s.d(x,{loadImagesTask:function(){return _.loadImagesTask}}),s.o(_,"loadMeshesTask")&&s.d(x,{loadMeshesTask:function(){return _.loadMeshesTask}}),s.o(_,"loadTexturesTask")&&s.d(x,{loadTexturesTask:function(){return _.loadTexturesTask}}),s.o(_,"localToGlobal")&&s.d(x,{localToGlobal:function(){return _.localToGlobal}}),s.o(_,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return _.makeMeshDisable}}),s.o(_,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return _.makeMeshNonPickable}}),s.o(_,"meshExists")&&s.d(x,{meshExists:function(){return _.meshExists}}),s.o(_,"mirrorMeshesTask")&&s.d(x,{mirrorMeshesTask:function(){return _.mirrorMeshesTask}}),s.o(_,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return _.normalizeAngle}}),s.o(_,"pauseRendererTask")&&s.d(x,{pauseRendererTask:function(){return _.pauseRendererTask}}),s.o(_,"pickMesh")&&s.d(x,{pickMesh:function(){return _.pickMesh}}),s.o(_,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return _.pickTopMesh}}),s.o(_,"randomFromArray")&&s.d(x,{randomFromArray:function(){return _.randomFromArray}}),s.o(_,"randomWithSign")&&s.d(x,{randomWithSign:function(){return _.randomWithSign}}),s.o(_,"removeAction")&&s.d(x,{removeAction:function(){return _.removeAction}}),s.o(_,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return _.removeMeshFromShadowGenerator}}),s.o(_,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return _.removeShadowUpdateFor}}),s.o(_,"renderFramesTask")&&s.d(x,{renderFramesTask:function(){return _.renderFramesTask}}),s.o(_,"replaceMaterialTexturesTask")&&s.d(x,{replaceMaterialTexturesTask:function(){return _.replaceMaterialTexturesTask}}),s.o(_,"roundTo")&&s.d(x,{roundTo:function(){return _.roundTo}}),s.o(_,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return _.roundVectorTo}}),s.o(_,"runScriptTask")&&s.d(x,{runScriptTask:function(){return _.runScriptTask}}),s.o(_,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return _.scalarToVector3}}),s.o(_,"setMaterialFeaturesTask")&&s.d(x,{setMaterialFeaturesTask:function(){return _.setMaterialFeaturesTask}}),s.o(_,"skipAnimations")&&s.d(x,{skipAnimations:function(){return _.skipAnimations}}),s.o(_,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return _.stopAnimationFor}}),s.o(_,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return _.swapSubMaterial}}),s.o(_,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return _.syncBoundingInfoOff}}),s.o(_,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return _.toScreenSpace}}),s.o(_,"tweenTo")&&s.d(x,{tweenTo:function(){return _.tweenTo}}),s.o(_,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return _.tweenToPromise}}),s.o(_,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return _.unfreezeAllActiveMeshes}}),s.o(_,"union")&&s.d(x,{union:function(){return _.union}}),s.o(_,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return _.updatePivotPointFor}}),s.o(_,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return _.updateRenderingGroup}}),s.o(_,"useDiffuseTextureAsEmissiveTask")&&s.d(x,{useDiffuseTextureAsEmissiveTask:function(){return _.useDiffuseTextureAsEmissiveTask}}),s.o(_,"wait")&&s.d(x,{wait:function(){return _.wait}}),s.o(_,"waitAsync")&&s.d(x,{waitAsync:function(){return _.waitAsync}}),s.o(_,"waitForSceneReadyTask")&&s.d(x,{waitForSceneReadyTask:function(){return _.waitForSceneReadyTask}}),s.o(_,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return _.waitRenderFrames}});var W=s(543344);s.o(W,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return W.AnimationFrameRate}}),s.o(W,"ArcCamera")&&s.d(x,{ArcCamera:function(){return W.ArcCamera}}),s.o(W,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return W.CHIP_MARGIN}}),s.o(W,"CameraManager")&&s.d(x,{CameraManager:function(){return W.CameraManager}}),s.o(W,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return W.CameraPositionProps}}),s.o(W,"ChipGroup")&&s.d(x,{ChipGroup:function(){return W.ChipGroup}}),s.o(W,"ChipSelector")&&s.d(x,{ChipSelector:function(){return W.ChipSelector}}),s.o(W,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return W.ChipSelectorEvent}}),s.o(W,"ChipStack")&&s.d(x,{ChipStack:function(){return W.ChipStack}}),s.o(W,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return W.ChipStackLabel}}),s.o(W,"CursorHover")&&s.d(x,{CursorHover:function(){return W.CursorHover}}),s.o(W,"DragState")&&s.d(x,{DragState:function(){return W.DragState}}),s.o(W,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return W.ExtendedAction}}),s.o(W,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return W.FakeChipStack}}),s.o(W,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return W.FlickeringLightning}}),s.o(W,"FullCircle")&&s.d(x,{FullCircle:function(){return W.FullCircle}}),s.o(W,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return W.GatheringLightning}}),s.o(W,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return W.GhostChipStack}}),s.o(W,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return W.HTMLMesh}}),s.o(W,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return W.HTMLMeshContainer}}),s.o(W,"Hover")&&s.d(x,{Hover:function(){return W.Hover}}),s.o(W,"HoverState")&&s.d(x,{HoverState:function(){return W.HoverState}}),s.o(W,"LightningStrike")&&s.d(x,{LightningStrike:function(){return W.LightningStrike}}),s.o(W,"LongPress")&&s.d(x,{LongPress:function(){return W.LongPress}}),s.o(W,"LongPressState")&&s.d(x,{LongPressState:function(){return W.LongPressState}}),s.o(W,"Tap")&&s.d(x,{Tap:function(){return W.Tap}}),s.o(W,"TapDrag")&&s.d(x,{TapDrag:function(){return W.TapDrag}}),s.o(W,"TapState")&&s.d(x,{TapState:function(){return W.TapState}}),s.o(W,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return W.TapWithMovement}}),s.o(W,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return W.TapWithMovementState}}),s.o(W,"Timeline")&&s.d(x,{Timeline:function(){return W.Timeline}}),s.o(W,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return W.TimelineDelay}}),s.o(W,"Tooltip")&&s.d(x,{Tooltip:function(){return W.Tooltip}}),s.o(W,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return W.TooltipContainer}}),s.o(W,"TooltipManager")&&s.d(x,{TooltipManager:function(){return W.TooltipManager}}),s.o(W,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return W.TooltipsSystem}}),s.o(W,"Tween")&&s.d(x,{Tween:function(){return W.Tween}}),s.o(W,"TweenGroup")&&s.d(x,{TweenGroup:function(){return W.TweenGroup}}),s.o(W,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return W.TweenGroupParallel}}),s.o(W,"addAction")&&s.d(x,{addAction:function(){return W.addAction}}),s.o(W,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return W.addConstantDelta}}),s.o(W,"addEasing")&&s.d(x,{addEasing:function(){return W.addEasing}}),s.o(W,"addEventAt")&&s.d(x,{addEventAt:function(){return W.addEventAt}}),s.o(W,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return W.addEventAtEnd}}),s.o(W,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return W.addEventAtStart}}),s.o(W,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return W.addMeshToShadowGenerator}}),s.o(W,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return W.addSceneShadowTexture}}),s.o(W,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return W.addShadowUpdateFor}}),s.o(W,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return W.betMeshPrefix}}),s.o(W,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return W.betMeshRegex}}),s.o(W,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return W.calculateChipsForAmount}}),s.o(W,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return W.changeChildOpacity}}),s.o(W,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return W.changeChildVisibility}}),s.o(W,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return W.changeTransparencyModeForPBR}}),s.o(W,"changeVisibility")&&s.d(x,{changeVisibility:function(){return W.changeVisibility}}),s.o(W,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return W.chipStackHeightLimit}}),s.o(W,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return W.convertRotationSpace}}),s.o(W,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return W.convertToPositiveAngle}}),s.o(W,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return W.copyInfoFromMesh}}),s.o(W,"createAnimation")&&s.d(x,{createAnimation:function(){return W.createAnimation}}),s.o(W,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return W.createAssetsManager}}),s.o(W,"createChip")&&s.d(x,{createChip:function(){return W.createChip}}),s.o(W,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return W.createDynamicChip}}),s.o(W,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return W.createGoLiveDoor}}),s.o(W,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return W.createGoLiveParticles}}),s.o(W,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return W.createHTMLMeshTransport}}),s.o(W,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return W.createLightningGlowLayer}}),s.o(W,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return W.createMirrorInstance}}),s.o(W,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return W.createMultiStepAnimation}}),s.o(W,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return W.createNamePatternExcludesTest}}),s.o(W,"createRenderManager")&&s.d(x,{createRenderManager:function(){return W.createRenderManager}}),s.o(W,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return W.createSVGTexture}}),s.o(W,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return W.createStandardDoorAnimation}}),s.o(W,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return W.createTooltipFactory}}),s.o(W,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return W.createTweenGroup}}),s.o(W,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return W.cullingStrategy}}),s.o(W,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return W.differenceBetweenAngles}}),s.o(W,"disableMesh")&&s.d(x,{disableMesh:function(){return W.disableMesh}}),s.o(W,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return W.distributeChipAmounts}}),s.o(W,"durationToFrames")&&s.d(x,{durationToFrames:function(){return W.durationToFrames}}),s.o(W,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return W.enableManualShadowRender}}),s.o(W,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return W.findChildrenAndWrap}}),s.o(W,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return W.forceShadowUpdate}}),s.o(W,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return W.freezeAllActiveMeshes}}),s.o(W,"freezeMesh")&&s.d(x,{freezeMesh:function(){return W.freezeMesh}}),s.o(W,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return W.freezeRecursive}}),s.o(W,"get2dRadius")&&s.d(x,{get2dRadius:function(){return W.get2dRadius}}),s.o(W,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return W.getAbsoluteRotationQuaternion}}),s.o(W,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return W.getAbsoluteScaling}}),s.o(W,"getAngle")&&s.d(x,{getAngle:function(){return W.getAngle}}),s.o(W,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return W.getAnimationLength}}),s.o(W,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return W.getAnimationsFirstPosition}}),s.o(W,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return W.getAvailableAmounts}}),s.o(W,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return W.getBaseChipsByGroup}}),s.o(W,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return W.getBreathingAnimationFrames}}),s.o(W,"getChildByName")&&s.d(x,{getChildByName:function(){return W.getChildByName}}),s.o(W,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return W.getConstantDelta}}),s.o(W,"getDirection")&&s.d(x,{getDirection:function(){return W.getDirection}}),s.o(W,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return W.getLightningPositionWithOffset}}),s.o(W,"getLosingChips")&&s.d(x,{getLosingChips:function(){return W.getLosingChips}}),s.o(W,"getMeshByName")&&s.d(x,{getMeshByName:function(){return W.getMeshByName}}),s.o(W,"getMeshSize")&&s.d(x,{getMeshSize:function(){return W.getMeshSize}}),s.o(W,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return W.getMeshesToLoad}}),s.o(W,"getNodeByName")&&s.d(x,{getNodeByName:function(){return W.getNodeByName}}),s.o(W,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return W.getPointWhereRayIntersectsPlane}}),s.o(W,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return W.getPositionFromAngle}}),s.o(W,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return W.getRadiusToFit}}),s.o(W,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return W.getRegexFromPrefix}}),s.o(W,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return W.getShadowGenerator}}),s.o(W,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return W.getSkeletonAnimationLength}}),s.o(W,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return W.getStandardChipDimensions}}),s.o(W,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return W.getTimeBasedValue}}),s.o(W,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return W.getVisibleArea}}),s.o(W,"globalToLocal")&&s.d(x,{globalToLocal:function(){return W.globalToLocal}}),s.o(W,"hasLight")&&s.d(x,{hasLight:function(){return W.hasLight}}),s.o(W,"initChips")&&s.d(x,{initChips:function(){return W.initChips}}),s.o(W,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return W.interpolateRGB}}),s.o(W,"isBetMesh")&&s.d(x,{isBetMesh:function(){return W.isBetMesh}}),s.o(W,"isMouseInput")&&s.d(x,{isMouseInput:function(){return W.isMouseInput}}),s.o(W,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return W.iterateAncestorsUntil}}),s.o(W,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return W.lightningMeshesDefaultOptions}}),s.o(W,"localToGlobal")&&s.d(x,{localToGlobal:function(){return W.localToGlobal}}),s.o(W,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return W.makeMeshDisable}}),s.o(W,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return W.makeMeshNonPickable}}),s.o(W,"meshExists")&&s.d(x,{meshExists:function(){return W.meshExists}}),s.o(W,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return W.normalizeAngle}}),s.o(W,"pickMesh")&&s.d(x,{pickMesh:function(){return W.pickMesh}}),s.o(W,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return W.pickTopMesh}}),s.o(W,"randomFromArray")&&s.d(x,{randomFromArray:function(){return W.randomFromArray}}),s.o(W,"randomWithSign")&&s.d(x,{randomWithSign:function(){return W.randomWithSign}}),s.o(W,"removeAction")&&s.d(x,{removeAction:function(){return W.removeAction}}),s.o(W,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return W.removeMeshFromShadowGenerator}}),s.o(W,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return W.removeShadowUpdateFor}}),s.o(W,"roundTo")&&s.d(x,{roundTo:function(){return W.roundTo}}),s.o(W,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return W.roundVectorTo}}),s.o(W,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return W.scalarToVector3}}),s.o(W,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return W.stopAnimationFor}}),s.o(W,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return W.swapSubMaterial}}),s.o(W,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return W.syncBoundingInfoOff}}),s.o(W,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return W.toScreenSpace}}),s.o(W,"tweenTo")&&s.d(x,{tweenTo:function(){return W.tweenTo}}),s.o(W,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return W.tweenToPromise}}),s.o(W,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return W.unfreezeAllActiveMeshes}}),s.o(W,"union")&&s.d(x,{union:function(){return W.union}}),s.o(W,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return W.updatePivotPointFor}}),s.o(W,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return W.updateRenderingGroup}}),s.o(W,"wait")&&s.d(x,{wait:function(){return W.wait}}),s.o(W,"waitAsync")&&s.d(x,{waitAsync:function(){return W.waitAsync}}),s.o(W,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return W.waitRenderFrames}});var c=s(760102);s.o(c,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return c.AnimationFrameRate}}),s.o(c,"ArcCamera")&&s.d(x,{ArcCamera:function(){return c.ArcCamera}}),s.o(c,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return c.CHIP_MARGIN}}),s.o(c,"CameraManager")&&s.d(x,{CameraManager:function(){return c.CameraManager}}),s.o(c,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return c.CameraPositionProps}}),s.o(c,"ChipGroup")&&s.d(x,{ChipGroup:function(){return c.ChipGroup}}),s.o(c,"ChipSelector")&&s.d(x,{ChipSelector:function(){return c.ChipSelector}}),s.o(c,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return c.ChipSelectorEvent}}),s.o(c,"ChipStack")&&s.d(x,{ChipStack:function(){return c.ChipStack}}),s.o(c,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return c.ChipStackLabel}}),s.o(c,"CursorHover")&&s.d(x,{CursorHover:function(){return c.CursorHover}}),s.o(c,"DragState")&&s.d(x,{DragState:function(){return c.DragState}}),s.o(c,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return c.ExtendedAction}}),s.o(c,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return c.FakeChipStack}}),s.o(c,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return c.FlickeringLightning}}),s.o(c,"FullCircle")&&s.d(x,{FullCircle:function(){return c.FullCircle}}),s.o(c,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return c.GatheringLightning}}),s.o(c,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return c.GhostChipStack}}),s.o(c,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return c.HTMLMesh}}),s.o(c,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return c.HTMLMeshContainer}}),s.o(c,"Hover")&&s.d(x,{Hover:function(){return c.Hover}}),s.o(c,"HoverState")&&s.d(x,{HoverState:function(){return c.HoverState}}),s.o(c,"LightningStrike")&&s.d(x,{LightningStrike:function(){return c.LightningStrike}}),s.o(c,"LongPress")&&s.d(x,{LongPress:function(){return c.LongPress}}),s.o(c,"LongPressState")&&s.d(x,{LongPressState:function(){return c.LongPressState}}),s.o(c,"Tap")&&s.d(x,{Tap:function(){return c.Tap}}),s.o(c,"TapDrag")&&s.d(x,{TapDrag:function(){return c.TapDrag}}),s.o(c,"TapState")&&s.d(x,{TapState:function(){return c.TapState}}),s.o(c,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return c.TapWithMovement}}),s.o(c,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return c.TapWithMovementState}}),s.o(c,"Timeline")&&s.d(x,{Timeline:function(){return c.Timeline}}),s.o(c,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return c.TimelineDelay}}),s.o(c,"Tooltip")&&s.d(x,{Tooltip:function(){return c.Tooltip}}),s.o(c,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return c.TooltipContainer}}),s.o(c,"TooltipManager")&&s.d(x,{TooltipManager:function(){return c.TooltipManager}}),s.o(c,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return c.TooltipsSystem}}),s.o(c,"Tween")&&s.d(x,{Tween:function(){return c.Tween}}),s.o(c,"TweenGroup")&&s.d(x,{TweenGroup:function(){return c.TweenGroup}}),s.o(c,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return c.TweenGroupParallel}}),s.o(c,"addAction")&&s.d(x,{addAction:function(){return c.addAction}}),s.o(c,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return c.addConstantDelta}}),s.o(c,"addEasing")&&s.d(x,{addEasing:function(){return c.addEasing}}),s.o(c,"addEventAt")&&s.d(x,{addEventAt:function(){return c.addEventAt}}),s.o(c,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return c.addEventAtEnd}}),s.o(c,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return c.addEventAtStart}}),s.o(c,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return c.addMeshToShadowGenerator}}),s.o(c,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return c.addSceneShadowTexture}}),s.o(c,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return c.addShadowUpdateFor}}),s.o(c,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return c.betMeshPrefix}}),s.o(c,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return c.betMeshRegex}}),s.o(c,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return c.calculateChipsForAmount}}),s.o(c,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return c.changeChildOpacity}}),s.o(c,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return c.changeChildVisibility}}),s.o(c,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return c.changeTransparencyModeForPBR}}),s.o(c,"changeVisibility")&&s.d(x,{changeVisibility:function(){return c.changeVisibility}}),s.o(c,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return c.chipStackHeightLimit}}),s.o(c,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return c.convertRotationSpace}}),s.o(c,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return c.convertToPositiveAngle}}),s.o(c,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return c.copyInfoFromMesh}}),s.o(c,"createAnimation")&&s.d(x,{createAnimation:function(){return c.createAnimation}}),s.o(c,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return c.createAssetsManager}}),s.o(c,"createChip")&&s.d(x,{createChip:function(){return c.createChip}}),s.o(c,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return c.createDynamicChip}}),s.o(c,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return c.createGoLiveDoor}}),s.o(c,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return c.createGoLiveParticles}}),s.o(c,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return c.createHTMLMeshTransport}}),s.o(c,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return c.createLightningGlowLayer}}),s.o(c,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return c.createMirrorInstance}}),s.o(c,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return c.createMultiStepAnimation}}),s.o(c,"createRenderManager")&&s.d(x,{createRenderManager:function(){return c.createRenderManager}}),s.o(c,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return c.createSVGTexture}}),s.o(c,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return c.createStandardDoorAnimation}}),s.o(c,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return c.createTooltipFactory}}),s.o(c,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return c.createTweenGroup}}),s.o(c,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return c.differenceBetweenAngles}}),s.o(c,"disableMesh")&&s.d(x,{disableMesh:function(){return c.disableMesh}}),s.o(c,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return c.distributeChipAmounts}}),s.o(c,"durationToFrames")&&s.d(x,{durationToFrames:function(){return c.durationToFrames}}),s.o(c,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return c.enableManualShadowRender}}),s.o(c,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return c.findChildrenAndWrap}}),s.o(c,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return c.forceShadowUpdate}}),s.o(c,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return c.freezeAllActiveMeshes}}),s.o(c,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return c.freezeRecursive}}),s.o(c,"get2dRadius")&&s.d(x,{get2dRadius:function(){return c.get2dRadius}}),s.o(c,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return c.getAbsoluteRotationQuaternion}}),s.o(c,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return c.getAbsoluteScaling}}),s.o(c,"getAngle")&&s.d(x,{getAngle:function(){return c.getAngle}}),s.o(c,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return c.getAnimationLength}}),s.o(c,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return c.getAnimationsFirstPosition}}),s.o(c,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return c.getAvailableAmounts}}),s.o(c,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return c.getBaseChipsByGroup}}),s.o(c,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return c.getBreathingAnimationFrames}}),s.o(c,"getChildByName")&&s.d(x,{getChildByName:function(){return c.getChildByName}}),s.o(c,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return c.getConstantDelta}}),s.o(c,"getDirection")&&s.d(x,{getDirection:function(){return c.getDirection}}),s.o(c,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return c.getLightningPositionWithOffset}}),s.o(c,"getLosingChips")&&s.d(x,{getLosingChips:function(){return c.getLosingChips}}),s.o(c,"getMeshByName")&&s.d(x,{getMeshByName:function(){return c.getMeshByName}}),s.o(c,"getMeshSize")&&s.d(x,{getMeshSize:function(){return c.getMeshSize}}),s.o(c,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return c.getMeshesToLoad}}),s.o(c,"getNodeByName")&&s.d(x,{getNodeByName:function(){return c.getNodeByName}}),s.o(c,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return c.getPointWhereRayIntersectsPlane}}),s.o(c,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return c.getPositionFromAngle}}),s.o(c,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return c.getRadiusToFit}}),s.o(c,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return c.getRegexFromPrefix}}),s.o(c,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return c.getShadowGenerator}}),s.o(c,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return c.getSkeletonAnimationLength}}),s.o(c,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return c.getStandardChipDimensions}}),s.o(c,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return c.getTimeBasedValue}}),s.o(c,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return c.getVisibleArea}}),s.o(c,"globalToLocal")&&s.d(x,{globalToLocal:function(){return c.globalToLocal}}),s.o(c,"hasLight")&&s.d(x,{hasLight:function(){return c.hasLight}}),s.o(c,"initChips")&&s.d(x,{initChips:function(){return c.initChips}}),s.o(c,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return c.interpolateRGB}}),s.o(c,"isBetMesh")&&s.d(x,{isBetMesh:function(){return c.isBetMesh}}),s.o(c,"isMouseInput")&&s.d(x,{isMouseInput:function(){return c.isMouseInput}}),s.o(c,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return c.iterateAncestorsUntil}}),s.o(c,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return c.lightningMeshesDefaultOptions}}),s.o(c,"localToGlobal")&&s.d(x,{localToGlobal:function(){return c.localToGlobal}}),s.o(c,"meshExists")&&s.d(x,{meshExists:function(){return c.meshExists}}),s.o(c,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return c.normalizeAngle}}),s.o(c,"pickMesh")&&s.d(x,{pickMesh:function(){return c.pickMesh}}),s.o(c,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return c.pickTopMesh}}),s.o(c,"randomFromArray")&&s.d(x,{randomFromArray:function(){return c.randomFromArray}}),s.o(c,"randomWithSign")&&s.d(x,{randomWithSign:function(){return c.randomWithSign}}),s.o(c,"removeAction")&&s.d(x,{removeAction:function(){return c.removeAction}}),s.o(c,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return c.removeMeshFromShadowGenerator}}),s.o(c,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return c.removeShadowUpdateFor}}),s.o(c,"roundTo")&&s.d(x,{roundTo:function(){return c.roundTo}}),s.o(c,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return c.roundVectorTo}}),s.o(c,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return c.scalarToVector3}}),s.o(c,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return c.stopAnimationFor}}),s.o(c,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return c.swapSubMaterial}}),s.o(c,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return c.toScreenSpace}}),s.o(c,"tweenTo")&&s.d(x,{tweenTo:function(){return c.tweenTo}}),s.o(c,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return c.tweenToPromise}}),s.o(c,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return c.unfreezeAllActiveMeshes}}),s.o(c,"union")&&s.d(x,{union:function(){return c.union}}),s.o(c,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return c.updatePivotPointFor}}),s.o(c,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return c.updateRenderingGroup}}),s.o(c,"wait")&&s.d(x,{wait:function(){return c.wait}}),s.o(c,"waitAsync")&&s.d(x,{waitAsync:function(){return c.waitAsync}}),s.o(c,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return c.waitRenderFrames}});var I=s(557807);s.o(I,"ArcCamera")&&s.d(x,{ArcCamera:function(){return I.ArcCamera}}),s.o(I,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return I.CHIP_MARGIN}}),s.o(I,"CameraManager")&&s.d(x,{CameraManager:function(){return I.CameraManager}}),s.o(I,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return I.CameraPositionProps}}),s.o(I,"ChipGroup")&&s.d(x,{ChipGroup:function(){return I.ChipGroup}}),s.o(I,"ChipSelector")&&s.d(x,{ChipSelector:function(){return I.ChipSelector}}),s.o(I,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return I.ChipSelectorEvent}}),s.o(I,"ChipStack")&&s.d(x,{ChipStack:function(){return I.ChipStack}}),s.o(I,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return I.ChipStackLabel}}),s.o(I,"CursorHover")&&s.d(x,{CursorHover:function(){return I.CursorHover}}),s.o(I,"DragState")&&s.d(x,{DragState:function(){return I.DragState}}),s.o(I,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return I.ExtendedAction}}),s.o(I,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return I.FakeChipStack}}),s.o(I,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return I.FlickeringLightning}}),s.o(I,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return I.GatheringLightning}}),s.o(I,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return I.GhostChipStack}}),s.o(I,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return I.HTMLMesh}}),s.o(I,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return I.HTMLMeshContainer}}),s.o(I,"Hover")&&s.d(x,{Hover:function(){return I.Hover}}),s.o(I,"HoverState")&&s.d(x,{HoverState:function(){return I.HoverState}}),s.o(I,"LightningStrike")&&s.d(x,{LightningStrike:function(){return I.LightningStrike}}),s.o(I,"LongPress")&&s.d(x,{LongPress:function(){return I.LongPress}}),s.o(I,"LongPressState")&&s.d(x,{LongPressState:function(){return I.LongPressState}}),s.o(I,"Tap")&&s.d(x,{Tap:function(){return I.Tap}}),s.o(I,"TapDrag")&&s.d(x,{TapDrag:function(){return I.TapDrag}}),s.o(I,"TapState")&&s.d(x,{TapState:function(){return I.TapState}}),s.o(I,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return I.TapWithMovement}}),s.o(I,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return I.TapWithMovementState}}),s.o(I,"Tooltip")&&s.d(x,{Tooltip:function(){return I.Tooltip}}),s.o(I,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return I.TooltipContainer}}),s.o(I,"TooltipManager")&&s.d(x,{TooltipManager:function(){return I.TooltipManager}}),s.o(I,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return I.TooltipsSystem}}),s.o(I,"addAction")&&s.d(x,{addAction:function(){return I.addAction}}),s.o(I,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return I.chipStackHeightLimit}}),s.o(I,"createChip")&&s.d(x,{createChip:function(){return I.createChip}}),s.o(I,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return I.createDynamicChip}}),s.o(I,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return I.createGoLiveDoor}}),s.o(I,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return I.createGoLiveParticles}}),s.o(I,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return I.createHTMLMeshTransport}}),s.o(I,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return I.createLightningGlowLayer}}),s.o(I,"createRenderManager")&&s.d(x,{createRenderManager:function(){return I.createRenderManager}}),s.o(I,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return I.createStandardDoorAnimation}}),s.o(I,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return I.createTooltipFactory}}),s.o(I,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return I.getAvailableAmounts}}),s.o(I,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return I.getBaseChipsByGroup}}),s.o(I,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return I.getConstantDelta}}),s.o(I,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return I.getLightningPositionWithOffset}}),s.o(I,"getLosingChips")&&s.d(x,{getLosingChips:function(){return I.getLosingChips}}),s.o(I,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return I.getStandardChipDimensions}}),s.o(I,"initChips")&&s.d(x,{initChips:function(){return I.initChips}}),s.o(I,"isMouseInput")&&s.d(x,{isMouseInput:function(){return I.isMouseInput}}),s.o(I,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return I.lightningMeshesDefaultOptions}}),s.o(I,"removeAction")&&s.d(x,{removeAction:function(){return I.removeAction}});var L=s(879042);if(s.o(L,"CursorHover")&&s.d(x,{CursorHover:function(){return L.CursorHover}}),s.o(L,"DragState")&&s.d(x,{DragState:function(){return L.DragState}}),s.o(L,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return L.ExtendedAction}}),s.o(L,"Hover")&&s.d(x,{Hover:function(){return L.Hover}}),s.o(L,"HoverState")&&s.d(x,{HoverState:function(){return L.HoverState}}),s.o(L,"LongPress")&&s.d(x,{LongPress:function(){return L.LongPress}}),s.o(L,"LongPressState")&&s.d(x,{LongPressState:function(){return L.LongPressState}}),s.o(L,"Tap")&&s.d(x,{Tap:function(){return L.Tap}}),s.o(L,"TapDrag")&&s.d(x,{TapDrag:function(){return L.TapDrag}}),s.o(L,"TapState")&&s.d(x,{TapState:function(){return L.TapState}}),s.o(L,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return L.TapWithMovement}}),s.o(L,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return L.TapWithMovementState}}),s.o(L,"Tooltip")&&s.d(x,{Tooltip:function(){return L.Tooltip}}),s.o(L,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return L.TooltipContainer}}),s.o(L,"TooltipManager")&&s.d(x,{TooltipManager:function(){return L.TooltipManager}}),s.o(L,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return L.TooltipsSystem}}),s.o(L,"addAction")&&s.d(x,{addAction:function(){return L.addAction}}),s.o(L,"createRenderManager")&&s.d(x,{createRenderManager:function(){return L.createRenderManager}}),s.o(L,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return L.createTooltipFactory}}),s.o(L,"isMouseInput")&&s.d(x,{isMouseInput:function(){return L.isMouseInput}}),s.o(L,"removeAction")&&s.d(x,{removeAction:function(){return L.removeAction}}),81052!=s.j)var J=s(153802);81052!=s.j&&s.o(J,"Tooltip")&&s.d(x,{Tooltip:function(){return J.Tooltip}}),81052!=s.j&&s.o(J,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return J.TooltipContainer}}),81052!=s.j&&s.o(J,"TooltipManager")&&s.d(x,{TooltipManager:function(){return J.TooltipManager}}),81052!=s.j&&s.o(J,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return J.TooltipsSystem}}),81052!=s.j&&s.o(J,"createRenderManager")&&s.d(x,{createRenderManager:function(){return J.createRenderManager}}),81052!=s.j&&s.o(J,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return J.createTooltipFactory}})},517323:(u,x,s)=>{s.d(x,{q:()=>_});var U=s(299123);class _ extends U.r{constructor(u){super(u.triggerOptions,u.condition),this.paused=!1,this.DS=u.DS,this.ignoreEventsWithoutPointerId=u.DS.IS_QQBROWSER,this.handlePointerEvent=this.handlePointerEvent.bind(this)}setPaused(u){this.paused=u}isPaused(){return this.paused}stop(){}_executeCurrent(u){this.paused||super._executeCurrent(u)}destroy(){}onPointer(u){}handlePointerEvent(u){this.isValidPointerEvent(u.event)&&this.onPointer(u)}getPointerId(u){return"pointerId"in u?u.pointerId:0}isValidPointerEvent(u){return!this.ignoreEventsWithoutPointerId||"pointerId"in u&&void 0!==u.pointerId}}},76748:(u,x,s)=>{s.d(x,{A:()=>U,t:()=>J});var U,_=s(938480),W=s(938868),c=s(968556),I=s(517323),L=s(913239);(function(u){u[u["Over"]=1]="Over",u[u["Out"]=2]="Out"})(U||(U={}));class J extends I.q{constructor(u){super({triggerOptions:_.m.NothingTrigger,DS:u.DS}),this.lastHoverState=U.Out,this.callback=u.callback,this.toHover=u.target,this.onPointer=this.onPointer.bind(this),this.currentHovers={},this.currentTouches=[]}_prepare(){super._prepare(),this.scene=this._actionManager.getScene();let u=null;if("string"==typeof this.toHover){if(u=this.scene.getMeshByName(this.toHover),!u)throw new Error(`HoverAction: Mesh not found ${this.toHover}`)}else this.toHover instanceof W.u?u=this.toHover:this.picker=this.toHover;u&&(u.enablePointerMoveEvents=!0,this.picker=x=>!!x&&!!u&&x.name===u.name),this.observer=this.scene.onPointerObservable.add(this.handlePointerEvent)}getLastHoverState(){return this.lastHoverState}setPaused(u){if(super.setPaused(u),u){this.currentTouches.length=0,this.lastHoverState=U.Out;for(const u of Object.keys(this.currentHovers)){const x=this.currentHovers[u];x&&this.callback(this.lastHoverState,x),this.currentHovers[u]=void 0}}else if(!0===this.isMouseInputEnabled){const u=this._actionManager.getScene();this.handleMove(new PointerEvent("pointermove",{pointerId:1,pointerType:"mouse"}),u.pick(u.pointerX,u.pointerY))}}destroy(){this.observer&&this.scene&&this.scene.onPointerObservable.remove(this.observer)}onPointer(u){switch(u.type){case c.S.POINTERMOVE:this.handleMove(u.event,u.pickInfo);break;case c.S.POINTERUP:this.handleUp(u.event,u.pickInfo);break;case c.S.POINTERDOWN:this.handleDown(u.event,u.pickInfo);break;case c.S.POINTER_LEAVE:this.handlePointerLeave(u.event)}}handleDown(u,x){const s=this.getPointerId(u);if(this.picker&&!L.s(u)&&!this.paused&&!this.currentTouches.includes(s)){const u=!!x&&this.picker(x.pickedMesh),_=x&&u?x.pickedMesh:null;_&&(this.currentTouches.push(s),this.currentHovers[s]=_,this.callback(this.lastHoverState=U.Over,_))}}handleMove(u,x){const s=this.getPointerId(u),_=this.currentTouches.includes(s),W=L.s(u);if((!this.DS.IS_IOS||!W)&&(this.isMouseInputEnabled=W,this.picker&&(W||_)&&!this.paused)){const u=!!x&&this.picker(x.pickedMesh),_=x&&u?x.pickedMesh:null,W=this.currentHovers[s];_?(W&&W.name!==_.name&&(this.callback(this.lastHoverState=U.Out,W),this.currentHovers[s]=void 0),W&&W.name===_.name||(this.currentHovers[s]=_,this.callback(this.lastHoverState=U.Over,_))):W&&(this.callback(this.lastHoverState=U.Out,W),this.currentHovers[s]=void 0)}}handleUp(u,x){const s=this.getPointerId(u);if(this.currentTouches.includes(s)){if(L.s(u)){const u=!(!x||!this.picker)&&this.picker(x.pickedMesh),_=x&&u?x.pickedMesh:null,W=this.currentHovers[s];_?(W&&W.name!==_.name&&(this.callback(this.lastHoverState=U.Out,W),this.currentHovers[s]=void 0),this.paused||W&&W.name===_.name||(this.currentHovers[s]=_,this.callback(this.lastHoverState=U.Over,_))):W&&(this.callback(this.lastHoverState=U.Out,W),this.currentHovers[s]=void 0)}else{const u=this.currentHovers[s];u&&(this.callback(this.lastHoverState=U.Out,u),this.currentHovers[s]=void 0)}this.clearTouch(s)}}clearTouch(u){this.currentTouches.splice(this.currentTouches.indexOf(u),1),delete this.currentHovers[u]}handlePointerLeave(u){const x=this.getPointerId(u),s=this.currentTouches.includes(x);if(this.picker&&(L.s(u)||s)&&!this.paused){const u=this.currentHovers[x];u&&(this.callback(this.lastHoverState=U.Out,u),this.currentHovers[x]=void 0)}}}},56195:(u,x,s)=>{s.d(x,{C:()=>k,z:()=>U});var U,_=s(938480),W=s(706211),c=s(938868),I=s(609859),L=s(74643),J=s(517323);(function(u){u[u["Start"]=1]="Start",u[u["End"]=2]="End",u[u["Cancel"]=3]="Cancel"})(U||(U={}));class k extends J.q{constructor(u){super({triggerOptions:_.m.NothingTrigger,DS:u.DS}),this.currentTouch=-1,this.callback=u.callback,this.target=u.target,this.onPointer=this.onPointer.bind(this)}_prepare(){super._prepare(),this.scene=this._actionManager.getScene();let u=null;if("string"==typeof this.target){if(u=this.scene.getMeshByName(this.target),!u)throw new Error(`Tap: Mesh not found ${this.target}`)}else this.target instanceof c.u?u=this.target:this.target&&(this.picker=this.target);u&&(this.picker=()=>this.scene?L.lm(this.scene,u):null),this.observer=this.scene.onPointerObservable.add(this.handlePointerEvent)}stop(){this.currentTouch>=0&&this.tapTarget&&this.callback(U.Cancel,this.tapTarget),this.clearTouch()}destroy(){this.observer&&this.scene&&this.scene.onPointerObservable.remove(this.observer)}onPointer(u){u.type===W.Zp.POINTERMOVE?this.handleMove(u.event):u.type===W.Zp.POINTERUP?this.handleUp(u.event):u.type===W.Zp.POINTERDOWN&&this.handleDown(u.event)}handleDown(u){const x=this.getPointerId(u);if(this.resetTouch(x),!this.paused){const s=this.picker?this.picker(u):void 0;!s&&this.picker||(this.currentTouch=x,this.startPosition={x:u.clientX,y:u.clientY},s&&(this.tapTarget=s),this.callback(U.Start,s||void 0))}}handleMove(u){this.currentTouch===this.getPointerId(u)&&this.startPosition&&I.PC(this.startPosition.x,this.startPosition.y,u.clientX,u.clientY)>10&&(this.callback(U.Cancel,this.tapTarget),this.clearTouch())}handleUp(u){this.currentTouch===this.getPointerId(u)&&(this.callback(U.End,this.tapTarget),this.clearTouch())}clearTouch(){this.currentTouch=-1,this.startPosition=void 0,this.tapTarget=void 0}resetTouch(u=this.currentTouch){this.scene&&-1!==this.currentTouch&&!this.scene.isPointerCaptured(u)&&(this.callback(U.Cancel,this.tapTarget),this.clearTouch())}}},153802:(u,x,s)=>{if(s.d(x,{CursorHover:()=>U.r,DragState:()=>L.m,ExtendedAction:()=>_.q,Hover:()=>W.t,HoverState:()=>W.A,LongPress:()=>c._,LongPressState:()=>c.N,Tap:()=>I.C,TapDrag:()=>L.Y,TapState:()=>I.z,TapWithMovement:()=>J.N,TapWithMovementState:()=>J.c,addAction:()=>k.i,isMouseInput:()=>d.s,removeAction:()=>k.V}),!/^(18036|27272|49135|68901|81052|94988)$/.test(s.j))var U=s(601662);if(94988==s.j)var _=s(517323);if(!/^(68901|81052)$/.test(s.j))var W=s(76748);if(94988==s.j)var c=s(309227);if(!/^(68901|81052)$/.test(s.j))var I=s(56195);if(!/^((1423|2727|8105)2|40457|49135|68901|94988)$/.test(s.j))var L=s(880453);if(94988==s.j)var J=s(893566);if(!/^(68901|81052)$/.test(s.j))var k=s(949642);if(!/^(18036|81052)$/.test(s.j))var i=s(850715);if(/^(18036|81052)$/.test(s.j)||s.o(i,"Tooltip")&&s.d(x,{Tooltip:function(){return i.Tooltip}}),/^(18036|81052)$/.test(s.j)||s.o(i,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return i.TooltipContainer}}),/^(18036|81052)$/.test(s.j)||s.o(i,"TooltipManager")&&s.d(x,{TooltipManager:function(){return i.TooltipManager}}),/^(18036|81052)$/.test(s.j)||s.o(i,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return i.TooltipsSystem}}),/^(18036|81052)$/.test(s.j)||s.o(i,"createRenderManager")&&s.d(x,{createRenderManager:function(){return i.createRenderManager}}),/^(18036|81052)$/.test(s.j)||s.o(i,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return i.createTooltipFactory}}),/^(18036|81052)$/.test(s.j)||s.o(i,"isMouseInput")&&s.d(x,{isMouseInput:function(){return i.isMouseInput}}),94988==s.j)var d=s(913239)},949642:(u,x,s)=>{s.d(x,{V:()=>c,i:()=>W});var U=s(938480),_=(s(988514),s(889460));function W(u,x){return I(u,x,!0)}function c(u,x){return I(u,x,!1)}function I(u,x,s){let W;return W=u instanceof _.Z?u:u.getScene(),u.actionManager||(u.actionManager=new U.m(W)),s?u.actionManager.registerAction(x):u.actionManager.unregisterAction(x),x}},850715:()=>{},913239:(u,x,s)=>{function U(u){return"pointerType"in u&&"mouse"===u.pointerType||!("pointerType"in u)}s.d(x,{s:()=>U})},760102:(u,x,s)=>{if(s.d(x,{createNamePatternExcludesTest:()=>L.$A,cullingStrategy:()=>c.G,freezeMesh:()=>U.t,makeMeshDisable:()=>I.s,makeMeshNonPickable:()=>_.i,syncBoundingInfoOff:()=>W.r}),!/^((1423|2727|8105)2|11123|68901|77899|94988)$/.test(s.j))var U=s(512521);if(!/^(14232|27272|40457|94988)$/.test(s.j))var _=s(677735);if(49135==s.j)var W=s(587753);if(49135==s.j)var c=s(399677);if(/^(11123|21167|4832|60297|77899|83188|90066)$/.test(s.j))var I=s(497568);if(/^(18036|40457|49135)$/.test(s.j))var L=s(886451);var J=s(67375);s.o(J,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return J.AnimationFrameRate}}),s.o(J,"ArcCamera")&&s.d(x,{ArcCamera:function(){return J.ArcCamera}}),s.o(J,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return J.CHIP_MARGIN}}),s.o(J,"CameraManager")&&s.d(x,{CameraManager:function(){return J.CameraManager}}),s.o(J,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return J.CameraPositionProps}}),s.o(J,"ChipGroup")&&s.d(x,{ChipGroup:function(){return J.ChipGroup}}),s.o(J,"ChipSelector")&&s.d(x,{ChipSelector:function(){return J.ChipSelector}}),s.o(J,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return J.ChipSelectorEvent}}),s.o(J,"ChipStack")&&s.d(x,{ChipStack:function(){return J.ChipStack}}),s.o(J,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return J.ChipStackLabel}}),s.o(J,"CursorHover")&&s.d(x,{CursorHover:function(){return J.CursorHover}}),s.o(J,"DragState")&&s.d(x,{DragState:function(){return J.DragState}}),s.o(J,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return J.ExtendedAction}}),s.o(J,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return J.FakeChipStack}}),s.o(J,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return J.FlickeringLightning}}),s.o(J,"FullCircle")&&s.d(x,{FullCircle:function(){return J.FullCircle}}),s.o(J,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return J.GatheringLightning}}),s.o(J,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return J.GhostChipStack}}),s.o(J,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return J.HTMLMesh}}),s.o(J,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return J.HTMLMeshContainer}}),s.o(J,"Hover")&&s.d(x,{Hover:function(){return J.Hover}}),s.o(J,"HoverState")&&s.d(x,{HoverState:function(){return J.HoverState}}),s.o(J,"LightningStrike")&&s.d(x,{LightningStrike:function(){return J.LightningStrike}}),s.o(J,"LongPress")&&s.d(x,{LongPress:function(){return J.LongPress}}),s.o(J,"LongPressState")&&s.d(x,{LongPressState:function(){return J.LongPressState}}),s.o(J,"Tap")&&s.d(x,{Tap:function(){return J.Tap}}),s.o(J,"TapDrag")&&s.d(x,{TapDrag:function(){return J.TapDrag}}),s.o(J,"TapState")&&s.d(x,{TapState:function(){return J.TapState}}),s.o(J,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return J.TapWithMovement}}),s.o(J,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return J.TapWithMovementState}}),s.o(J,"Timeline")&&s.d(x,{Timeline:function(){return J.Timeline}}),s.o(J,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return J.TimelineDelay}}),s.o(J,"Tooltip")&&s.d(x,{Tooltip:function(){return J.Tooltip}}),s.o(J,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return J.TooltipContainer}}),s.o(J,"TooltipManager")&&s.d(x,{TooltipManager:function(){return J.TooltipManager}}),s.o(J,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return J.TooltipsSystem}}),s.o(J,"Tween")&&s.d(x,{Tween:function(){return J.Tween}}),s.o(J,"TweenGroup")&&s.d(x,{TweenGroup:function(){return J.TweenGroup}}),s.o(J,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return J.TweenGroupParallel}}),s.o(J,"addAction")&&s.d(x,{addAction:function(){return J.addAction}}),s.o(J,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return J.addConstantDelta}}),s.o(J,"addEasing")&&s.d(x,{addEasing:function(){return J.addEasing}}),s.o(J,"addEventAt")&&s.d(x,{addEventAt:function(){return J.addEventAt}}),s.o(J,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return J.addEventAtEnd}}),s.o(J,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return J.addEventAtStart}}),s.o(J,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return J.addMeshToShadowGenerator}}),s.o(J,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return J.addSceneShadowTexture}}),s.o(J,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return J.addShadowUpdateFor}}),s.o(J,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return J.betMeshPrefix}}),s.o(J,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return J.betMeshRegex}}),s.o(J,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return J.calculateChipsForAmount}}),s.o(J,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return J.changeChildOpacity}}),s.o(J,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return J.changeChildVisibility}}),s.o(J,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return J.changeTransparencyModeForPBR}}),s.o(J,"changeVisibility")&&s.d(x,{changeVisibility:function(){return J.changeVisibility}}),s.o(J,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return J.chipStackHeightLimit}}),s.o(J,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return J.convertRotationSpace}}),s.o(J,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return J.convertToPositiveAngle}}),s.o(J,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return J.copyInfoFromMesh}}),s.o(J,"createAnimation")&&s.d(x,{createAnimation:function(){return J.createAnimation}}),s.o(J,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return J.createAssetsManager}}),s.o(J,"createChip")&&s.d(x,{createChip:function(){return J.createChip}}),s.o(J,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return J.createDynamicChip}}),s.o(J,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return J.createGoLiveDoor}}),s.o(J,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return J.createGoLiveParticles}}),s.o(J,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return J.createHTMLMeshTransport}}),s.o(J,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return J.createLightningGlowLayer}}),s.o(J,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return J.createMirrorInstance}}),s.o(J,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return J.createMultiStepAnimation}}),s.o(J,"createRenderManager")&&s.d(x,{createRenderManager:function(){return J.createRenderManager}}),s.o(J,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return J.createSVGTexture}}),s.o(J,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return J.createStandardDoorAnimation}}),s.o(J,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return J.createTooltipFactory}}),s.o(J,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return J.createTweenGroup}}),s.o(J,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return J.differenceBetweenAngles}}),s.o(J,"disableMesh")&&s.d(x,{disableMesh:function(){return J.disableMesh}}),s.o(J,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return J.distributeChipAmounts}}),s.o(J,"durationToFrames")&&s.d(x,{durationToFrames:function(){return J.durationToFrames}}),s.o(J,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return J.enableManualShadowRender}}),s.o(J,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return J.findChildrenAndWrap}}),s.o(J,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return J.forceShadowUpdate}}),s.o(J,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return J.freezeAllActiveMeshes}}),s.o(J,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return J.freezeRecursive}}),s.o(J,"get2dRadius")&&s.d(x,{get2dRadius:function(){return J.get2dRadius}}),s.o(J,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return J.getAbsoluteRotationQuaternion}}),s.o(J,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return J.getAbsoluteScaling}}),s.o(J,"getAngle")&&s.d(x,{getAngle:function(){return J.getAngle}}),s.o(J,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return J.getAnimationLength}}),s.o(J,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return J.getAnimationsFirstPosition}}),s.o(J,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return J.getAvailableAmounts}}),s.o(J,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return J.getBaseChipsByGroup}}),s.o(J,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return J.getBreathingAnimationFrames}}),s.o(J,"getChildByName")&&s.d(x,{getChildByName:function(){return J.getChildByName}}),s.o(J,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return J.getConstantDelta}}),s.o(J,"getDirection")&&s.d(x,{getDirection:function(){return J.getDirection}}),s.o(J,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return J.getLightningPositionWithOffset}}),s.o(J,"getLosingChips")&&s.d(x,{getLosingChips:function(){return J.getLosingChips}}),s.o(J,"getMeshByName")&&s.d(x,{getMeshByName:function(){return J.getMeshByName}}),s.o(J,"getMeshSize")&&s.d(x,{getMeshSize:function(){return J.getMeshSize}}),s.o(J,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return J.getMeshesToLoad}}),s.o(J,"getNodeByName")&&s.d(x,{getNodeByName:function(){return J.getNodeByName}}),s.o(J,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return J.getPointWhereRayIntersectsPlane}}),s.o(J,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return J.getPositionFromAngle}}),s.o(J,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return J.getRadiusToFit}}),s.o(J,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return J.getRegexFromPrefix}}),s.o(J,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return J.getShadowGenerator}}),s.o(J,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return J.getSkeletonAnimationLength}}),s.o(J,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return J.getStandardChipDimensions}}),s.o(J,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return J.getTimeBasedValue}}),s.o(J,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return J.getVisibleArea}}),s.o(J,"globalToLocal")&&s.d(x,{globalToLocal:function(){return J.globalToLocal}}),s.o(J,"hasLight")&&s.d(x,{hasLight:function(){return J.hasLight}}),s.o(J,"initChips")&&s.d(x,{initChips:function(){return J.initChips}}),s.o(J,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return J.interpolateRGB}}),s.o(J,"isBetMesh")&&s.d(x,{isBetMesh:function(){return J.isBetMesh}}),s.o(J,"isMouseInput")&&s.d(x,{isMouseInput:function(){return J.isMouseInput}}),s.o(J,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return J.iterateAncestorsUntil}}),s.o(J,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return J.lightningMeshesDefaultOptions}}),s.o(J,"localToGlobal")&&s.d(x,{localToGlobal:function(){return J.localToGlobal}}),s.o(J,"meshExists")&&s.d(x,{meshExists:function(){return J.meshExists}}),s.o(J,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return J.normalizeAngle}}),s.o(J,"pickMesh")&&s.d(x,{pickMesh:function(){return J.pickMesh}}),s.o(J,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return J.pickTopMesh}}),s.o(J,"randomFromArray")&&s.d(x,{randomFromArray:function(){return J.randomFromArray}}),s.o(J,"randomWithSign")&&s.d(x,{randomWithSign:function(){return J.randomWithSign}}),s.o(J,"removeAction")&&s.d(x,{removeAction:function(){return J.removeAction}}),s.o(J,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return J.removeMeshFromShadowGenerator}}),s.o(J,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return J.removeShadowUpdateFor}}),s.o(J,"roundTo")&&s.d(x,{roundTo:function(){return J.roundTo}}),s.o(J,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return J.roundVectorTo}}),s.o(J,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return J.scalarToVector3}}),s.o(J,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return J.stopAnimationFor}}),s.o(J,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return J.swapSubMaterial}}),s.o(J,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return J.toScreenSpace}}),s.o(J,"tweenTo")&&s.d(x,{tweenTo:function(){return J.tweenTo}}),s.o(J,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return J.tweenToPromise}}),s.o(J,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return J.unfreezeAllActiveMeshes}}),s.o(J,"union")&&s.d(x,{union:function(){return J.union}}),s.o(J,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return J.updatePivotPointFor}}),s.o(J,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return J.updateRenderingGroup}}),s.o(J,"wait")&&s.d(x,{wait:function(){return J.wait}}),s.o(J,"waitAsync")&&s.d(x,{waitAsync:function(){return J.waitAsync}}),s.o(J,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return J.waitRenderFrames}})},67375:()=>{},204389:(u,x,s)=>{s.d(x,{Q:()=>c});var U=s(540362),_=s(714806),W=s(670459);function c(u,x,s){return U.U({taskName:"createEngineTask",execute:(U,c,I)=>{try{c({engine:W.P(u,x,s)})}catch(u){I({errorId:_.Q.DeviceNotSupported})}}})}},168877:(u,x,s)=>{s.d(x,{a:()=>W});var U=s(540362),_=s(357117);function W(u){return U.U({taskName:"debugToolsTask",execute:(x,U)=>{1&&_.ZQ()&&s.e(94003).then(s.bind(s,816747)).then((s=>s.DebugToolsPlugin({scene:x.scene,transport3D:u}))),U()}})}},295766:(u,x,s)=>{s.d(x,{J:()=>_});var U=s(540362);function _(u){return U.U({taskName:"enhanceMeshesTask",execute:(x,s)=>{for(const s of x.scene.meshes)for(const x of u)void 0!==x.test&&x.test(s)||x.enhance(s);s()}})}},543344:(u,x,s)=>{if(s.d(x,{addShadowTextureTask:()=>U.I,autoPositioningTask:()=>_.q,createEngineTask:()=>W.Q,createRendererTask:()=>O.p,createSceneTask:()=>c.O,debugToolsTask:()=>N.a,enhanceMeshesTask:()=>r.J,loadEnvironmentTextureTask:()=>J.e,loadEnvironmentTexturesTask:()=>J.d,loadFontTask:()=>L.F,loadImagesTask:()=>d.I,loadMeshesTask:()=>I.p,loadTexturesTask:()=>f.U,mirrorMeshesTask:()=>H.o,pauseRendererTask:()=>t.B,renderFramesTask:()=>k.C,replaceMaterialTexturesTask:()=>$.B,runScriptTask:()=>m.G,setMaterialFeaturesTask:()=>j.k,skipAnimations:()=>D.l,useDiffuseTextureAsEmissiveTask:()=>V.Z,waitForSceneReadyTask:()=>i.f}),/^(1(1123|4232|8036)|77899)$/.test(s.j))var U=s(599961);if(14232==s.j)var _=s(510341);if(94988!=s.j)var W=s(204389);if(/^((1423|2727|8105)2|18036|40457|49135|68901)$/.test(s.j))var c=s(336545);if(94988!=s.j)var I=s(455658);if(/^(2727|8105)2$/.test(s.j))var L=s(317534);if(94988!=s.j)var J=s(605191);if(/^(14232|18036|49135|68901|81052|94988)$/.test(s.j))var k=s(571493);if(94988!=s.j)var i=s(968242);if(!/^(27272|49135|94988)$/.test(s.j))var d=s(503521);if(/^((1423|2727|8105)2|18036|40457|49135|68901)$/.test(s.j))var j=s(922419);if(!/^(14232|27272|94988)$/.test(s.j))var r=s(295766);if(!/^((1423|2727|8105)2|18036|40457|68901|94988)$/.test(s.j))var D=s(706726);if(!/^((2727|483|8105)2|21167|60297|83188|90066)$/.test(s.j))var $=s(637596);if(/^(14232|77899)$/.test(s.j))var H=s(607782);if(!/^((831|949)88|18036|21167|40457|81052|90066)$/.test(s.j))var f=s(814907);if(!/^((1423|2727|8105)2|18036|94988)$/.test(s.j))var O=s(674324);if(!/^((1423|2727|8105)2|18036|40457|68901|94988)$/.test(s.j))var t=s(571928);if(27272==s.j)var V=s(316400);if(81052!=s.j)var N=s(168877);if(4832==s.j)var m=s(809039);var b=s(644329);s.o(b,"AnimationFrameRate")&&s.d(x,{AnimationFrameRate:function(){return b.AnimationFrameRate}}),s.o(b,"ArcCamera")&&s.d(x,{ArcCamera:function(){return b.ArcCamera}}),s.o(b,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return b.CHIP_MARGIN}}),s.o(b,"CameraManager")&&s.d(x,{CameraManager:function(){return b.CameraManager}}),s.o(b,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return b.CameraPositionProps}}),s.o(b,"ChipGroup")&&s.d(x,{ChipGroup:function(){return b.ChipGroup}}),s.o(b,"ChipSelector")&&s.d(x,{ChipSelector:function(){return b.ChipSelector}}),s.o(b,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return b.ChipSelectorEvent}}),s.o(b,"ChipStack")&&s.d(x,{ChipStack:function(){return b.ChipStack}}),s.o(b,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return b.ChipStackLabel}}),s.o(b,"CursorHover")&&s.d(x,{CursorHover:function(){return b.CursorHover}}),s.o(b,"DragState")&&s.d(x,{DragState:function(){return b.DragState}}),s.o(b,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return b.ExtendedAction}}),s.o(b,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return b.FakeChipStack}}),s.o(b,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return b.FlickeringLightning}}),s.o(b,"FullCircle")&&s.d(x,{FullCircle:function(){return b.FullCircle}}),s.o(b,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return b.GatheringLightning}}),s.o(b,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return b.GhostChipStack}}),s.o(b,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return b.HTMLMesh}}),s.o(b,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return b.HTMLMeshContainer}}),s.o(b,"Hover")&&s.d(x,{Hover:function(){return b.Hover}}),s.o(b,"HoverState")&&s.d(x,{HoverState:function(){return b.HoverState}}),s.o(b,"LightningStrike")&&s.d(x,{LightningStrike:function(){return b.LightningStrike}}),s.o(b,"LongPress")&&s.d(x,{LongPress:function(){return b.LongPress}}),s.o(b,"LongPressState")&&s.d(x,{LongPressState:function(){return b.LongPressState}}),s.o(b,"Tap")&&s.d(x,{Tap:function(){return b.Tap}}),s.o(b,"TapDrag")&&s.d(x,{TapDrag:function(){return b.TapDrag}}),s.o(b,"TapState")&&s.d(x,{TapState:function(){return b.TapState}}),s.o(b,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return b.TapWithMovement}}),s.o(b,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return b.TapWithMovementState}}),s.o(b,"Timeline")&&s.d(x,{Timeline:function(){return b.Timeline}}),s.o(b,"TimelineDelay")&&s.d(x,{TimelineDelay:function(){return b.TimelineDelay}}),s.o(b,"Tooltip")&&s.d(x,{Tooltip:function(){return b.Tooltip}}),s.o(b,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return b.TooltipContainer}}),s.o(b,"TooltipManager")&&s.d(x,{TooltipManager:function(){return b.TooltipManager}}),s.o(b,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return b.TooltipsSystem}}),s.o(b,"Tween")&&s.d(x,{Tween:function(){return b.Tween}}),s.o(b,"TweenGroup")&&s.d(x,{TweenGroup:function(){return b.TweenGroup}}),s.o(b,"TweenGroupParallel")&&s.d(x,{TweenGroupParallel:function(){return b.TweenGroupParallel}}),s.o(b,"addAction")&&s.d(x,{addAction:function(){return b.addAction}}),s.o(b,"addConstantDelta")&&s.d(x,{addConstantDelta:function(){return b.addConstantDelta}}),s.o(b,"addEasing")&&s.d(x,{addEasing:function(){return b.addEasing}}),s.o(b,"addEventAt")&&s.d(x,{addEventAt:function(){return b.addEventAt}}),s.o(b,"addEventAtEnd")&&s.d(x,{addEventAtEnd:function(){return b.addEventAtEnd}}),s.o(b,"addEventAtStart")&&s.d(x,{addEventAtStart:function(){return b.addEventAtStart}}),s.o(b,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return b.addMeshToShadowGenerator}}),s.o(b,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return b.addSceneShadowTexture}}),s.o(b,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return b.addShadowUpdateFor}}),s.o(b,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return b.betMeshPrefix}}),s.o(b,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return b.betMeshRegex}}),s.o(b,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return b.calculateChipsForAmount}}),s.o(b,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return b.changeChildOpacity}}),s.o(b,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return b.changeChildVisibility}}),s.o(b,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return b.changeTransparencyModeForPBR}}),s.o(b,"changeVisibility")&&s.d(x,{changeVisibility:function(){return b.changeVisibility}}),s.o(b,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return b.chipStackHeightLimit}}),s.o(b,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return b.convertRotationSpace}}),s.o(b,"convertToPositiveAngle")&&s.d(x,{convertToPositiveAngle:function(){return b.convertToPositiveAngle}}),s.o(b,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return b.copyInfoFromMesh}}),s.o(b,"createAnimation")&&s.d(x,{createAnimation:function(){return b.createAnimation}}),s.o(b,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return b.createAssetsManager}}),s.o(b,"createChip")&&s.d(x,{createChip:function(){return b.createChip}}),s.o(b,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return b.createDynamicChip}}),s.o(b,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return b.createGoLiveDoor}}),s.o(b,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return b.createGoLiveParticles}}),s.o(b,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return b.createHTMLMeshTransport}}),s.o(b,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return b.createLightningGlowLayer}}),s.o(b,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return b.createMirrorInstance}}),s.o(b,"createMultiStepAnimation")&&s.d(x,{createMultiStepAnimation:function(){return b.createMultiStepAnimation}}),s.o(b,"createNamePatternExcludesTest")&&s.d(x,{createNamePatternExcludesTest:function(){return b.createNamePatternExcludesTest}}),s.o(b,"createRenderManager")&&s.d(x,{createRenderManager:function(){return b.createRenderManager}}),s.o(b,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return b.createSVGTexture}}),s.o(b,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return b.createStandardDoorAnimation}}),s.o(b,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return b.createTooltipFactory}}),s.o(b,"createTweenGroup")&&s.d(x,{createTweenGroup:function(){return b.createTweenGroup}}),s.o(b,"cullingStrategy")&&s.d(x,{cullingStrategy:function(){return b.cullingStrategy}}),s.o(b,"differenceBetweenAngles")&&s.d(x,{differenceBetweenAngles:function(){return b.differenceBetweenAngles}}),s.o(b,"disableMesh")&&s.d(x,{disableMesh:function(){return b.disableMesh}}),s.o(b,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return b.distributeChipAmounts}}),s.o(b,"durationToFrames")&&s.d(x,{durationToFrames:function(){return b.durationToFrames}}),s.o(b,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return b.enableManualShadowRender}}),s.o(b,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return b.findChildrenAndWrap}}),s.o(b,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return b.forceShadowUpdate}}),s.o(b,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return b.freezeAllActiveMeshes}}),s.o(b,"freezeMesh")&&s.d(x,{freezeMesh:function(){return b.freezeMesh}}),s.o(b,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return b.freezeRecursive}}),s.o(b,"get2dRadius")&&s.d(x,{get2dRadius:function(){return b.get2dRadius}}),s.o(b,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return b.getAbsoluteRotationQuaternion}}),s.o(b,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return b.getAbsoluteScaling}}),s.o(b,"getAngle")&&s.d(x,{getAngle:function(){return b.getAngle}}),s.o(b,"getAnimationLength")&&s.d(x,{getAnimationLength:function(){return b.getAnimationLength}}),s.o(b,"getAnimationsFirstPosition")&&s.d(x,{getAnimationsFirstPosition:function(){return b.getAnimationsFirstPosition}}),s.o(b,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return b.getAvailableAmounts}}),s.o(b,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return b.getBaseChipsByGroup}}),s.o(b,"getBreathingAnimationFrames")&&s.d(x,{getBreathingAnimationFrames:function(){return b.getBreathingAnimationFrames}}),s.o(b,"getChildByName")&&s.d(x,{getChildByName:function(){return b.getChildByName}}),s.o(b,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return b.getConstantDelta}}),s.o(b,"getDirection")&&s.d(x,{getDirection:function(){return b.getDirection}}),s.o(b,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return b.getLightningPositionWithOffset}}),s.o(b,"getLosingChips")&&s.d(x,{getLosingChips:function(){return b.getLosingChips}}),s.o(b,"getMeshByName")&&s.d(x,{getMeshByName:function(){return b.getMeshByName}}),s.o(b,"getMeshSize")&&s.d(x,{getMeshSize:function(){return b.getMeshSize}}),s.o(b,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return b.getMeshesToLoad}}),s.o(b,"getNodeByName")&&s.d(x,{getNodeByName:function(){return b.getNodeByName}}),s.o(b,"getPointWhereRayIntersectsPlane")&&s.d(x,{getPointWhereRayIntersectsPlane:function(){return b.getPointWhereRayIntersectsPlane}}),s.o(b,"getPositionFromAngle")&&s.d(x,{getPositionFromAngle:function(){return b.getPositionFromAngle}}),s.o(b,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return b.getRadiusToFit}}),s.o(b,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return b.getRegexFromPrefix}}),s.o(b,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return b.getShadowGenerator}}),s.o(b,"getSkeletonAnimationLength")&&s.d(x,{getSkeletonAnimationLength:function(){return b.getSkeletonAnimationLength}}),s.o(b,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return b.getStandardChipDimensions}}),s.o(b,"getTimeBasedValue")&&s.d(x,{getTimeBasedValue:function(){return b.getTimeBasedValue}}),s.o(b,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return b.getVisibleArea}}),s.o(b,"globalToLocal")&&s.d(x,{globalToLocal:function(){return b.globalToLocal}}),s.o(b,"hasLight")&&s.d(x,{hasLight:function(){return b.hasLight}}),s.o(b,"initChips")&&s.d(x,{initChips:function(){return b.initChips}}),s.o(b,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return b.interpolateRGB}}),s.o(b,"isBetMesh")&&s.d(x,{isBetMesh:function(){return b.isBetMesh}}),s.o(b,"isMouseInput")&&s.d(x,{isMouseInput:function(){return b.isMouseInput}}),s.o(b,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return b.iterateAncestorsUntil}}),s.o(b,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return b.lightningMeshesDefaultOptions}}),s.o(b,"localToGlobal")&&s.d(x,{localToGlobal:function(){return b.localToGlobal}}),s.o(b,"makeMeshDisable")&&s.d(x,{makeMeshDisable:function(){return b.makeMeshDisable}}),s.o(b,"makeMeshNonPickable")&&s.d(x,{makeMeshNonPickable:function(){return b.makeMeshNonPickable}}),s.o(b,"meshExists")&&s.d(x,{meshExists:function(){return b.meshExists}}),s.o(b,"normalizeAngle")&&s.d(x,{normalizeAngle:function(){return b.normalizeAngle}}),s.o(b,"pickMesh")&&s.d(x,{pickMesh:function(){return b.pickMesh}}),s.o(b,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return b.pickTopMesh}}),s.o(b,"randomFromArray")&&s.d(x,{randomFromArray:function(){return b.randomFromArray}}),s.o(b,"randomWithSign")&&s.d(x,{randomWithSign:function(){return b.randomWithSign}}),s.o(b,"removeAction")&&s.d(x,{removeAction:function(){return b.removeAction}}),s.o(b,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return b.removeMeshFromShadowGenerator}}),s.o(b,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return b.removeShadowUpdateFor}}),s.o(b,"roundTo")&&s.d(x,{roundTo:function(){return b.roundTo}}),s.o(b,"roundVectorTo")&&s.d(x,{roundVectorTo:function(){return b.roundVectorTo}}),s.o(b,"scalarToVector3")&&s.d(x,{scalarToVector3:function(){return b.scalarToVector3}}),s.o(b,"stopAnimationFor")&&s.d(x,{stopAnimationFor:function(){return b.stopAnimationFor}}),s.o(b,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return b.swapSubMaterial}}),s.o(b,"syncBoundingInfoOff")&&s.d(x,{syncBoundingInfoOff:function(){return b.syncBoundingInfoOff}}),s.o(b,"toScreenSpace")&&s.d(x,{toScreenSpace:function(){return b.toScreenSpace}}),s.o(b,"tweenTo")&&s.d(x,{tweenTo:function(){return b.tweenTo}}),s.o(b,"tweenToPromise")&&s.d(x,{tweenToPromise:function(){return b.tweenToPromise}}),s.o(b,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return b.unfreezeAllActiveMeshes}}),s.o(b,"union")&&s.d(x,{union:function(){return b.union}}),s.o(b,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return b.updatePivotPointFor}}),s.o(b,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return b.updateRenderingGroup}}),s.o(b,"wait")&&s.d(x,{wait:function(){return b.wait}}),s.o(b,"waitAsync")&&s.d(x,{waitAsync:function(){return b.waitAsync}}),s.o(b,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return b.waitRenderFrames}})},605191:(u,x,s)=>{s.d(x,{d:()=>k,e:()=>J}),s(882689);var U=s(948733),_=s(501650),W=s(540362),c=s(714806),I=s(21882);const L="environment";function J(u){return W.U({taskName:"loadEnvironmentTextureTask",execute:(x,s,U)=>{const W=I.N(x.scene);W.addCubeTextureTask(L,u.texturePath),W.onTaskSuccess=s=>{s.name===L&&s instanceof _.aI&&(i(s.texture,u.rotation),d(s.texture,u.level),j(s.texture,x.scene))},W.loadAsync().then(s).catch((()=>{U({errorId:c.Q.AssetNotLoaded})}))}})}function k(u,x){return W.U({taskName:"loadEnvironmentTextureTask",execute:(s,U,W)=>{const L=I.N(s.scene),J={},k=Object.keys(u);for(const x of k)L.addCubeTextureTask(x,u[x].texturePath);L.onTaskSuccess=U=>{var W;U instanceof _.aI&&(W=U.name,k.includes(W))&&(i(U.texture,u[U.name].rotation),d(U.texture,u[U.name].level),U.name===x&&j(U.texture,s.scene),J[U.name]=U.texture)},L.loadAsync().then((()=>{U({envTextures:J})})).catch((()=>{W({errorId:c.Q.AssetNotLoaded})}))}})}function i(u,x){x&&u.setReflectionTextureMatrix(U.uq.RotationYawPitchRoll(x[1],x[0],x[2]))}function d(u,x){void 0!==x&&(u.level=x)}function j(u,x){x.environmentTexture=u}},503521:(u,x,s)=>{s.d(x,{I:()=>c});var U=s(540362),_=s(714806),W=s(21882);function c(u={}){return U.U({taskName:"loadImagesTask",execute:(x,s,U)=>{const c=W.N(x.scene);Object.keys(u).forEach((x=>{const s=u[x];c.addImageTask(x,s)})),c.onFinish=u=>{const x=u.reduce(((u,x)=>(u[x.name]=x.image,u)),{});s({images:x})},c.onTaskError=()=>{U({errorId:_.Q.AssetNotLoaded})},c.load()}})}},455658:(u,x,s)=>{s.d(x,{p:()=>I}),s(197501);var U=s(898973),_=s(540362),W=s(714806),c=s(21882);function I(u){return _.U({taskName:"loadMeshesTask",execute:(x,s,_)=>{const I=c.N(x.scene);u.forEach((u=>{I.addMeshTask(U.S0.RandomId(),"",u,"")})),I.loadAsync().then(s).catch((()=>{_({errorId:W.Q.AssetNotLoaded})}))}})}},637596:(u,x,s)=>{s.d(x,{B:()=>k});var U=s(432050),_=s(540362),W=s(714806),c=s(484802),I=s(320148),L=s(21882),J=s(718113);function k(u){return _.U({taskName:"replaceMaterialTexturesTask",execute:(x,s,U)=>{const _=L.N(x.scene),c=new Set;for(const s of Object.values(u)){if(!I.oK(s)||!s.materials)continue;const u=Object.keys(s.materials);for(const U of u)d(U,s.materials[U],x.scene,_,c)}_.loadAsync().then(s).catch((()=>{U({errorId:W.Q.AssetNotLoaded})}))}})}function i(u,x,s,_,W){if(void 0===s)return;let L,k;if(I.A(s)){const{path:u,...x}=s;L=u,Object.keys(x).length&&(k=x)}else L=s;if(L){const s=`${u.name}|${x}`,I=c.L.unwrap(L);_.addTextureTask(s,I).onSuccess=s=>{k&&J.YE(s.texture,k),J.Aw({material:u,prop:x,value:s.texture})&&u.isFrozen&&!W.has(u)&&(u.markDirty(),W.add(u))},L instanceof c.L&&L.subscribe((s=>{const _=new U.g(s);k&&J.YE(_,k),J.Aw({material:u,prop:x,value:_})}),!1)}else if(k){const s=J.tD(u,x);s&&J.YE(s,k)}}function d(u,x,s,U,_){const W=s.getMaterialByName(u);if(!W)return;const I=Object.keys(x);for(const u of I)if(J.Zg(u)){const I=x[u]instanceof c.L?x[u].value:x[u];i(W,u,I,U,_),x[u]instanceof c.L&&x[u].subscribe((x=>{const U=L.N(s);i(W,u,x,U,new Set),U.loadAsync()}),!1)}else{const s=x[u]instanceof c.L?x[u].value:x[u];if(void 0===s)continue;J.Aw({material:W,prop:u,value:s})&&W.isFrozen&&!_.has(W)&&(W.markDirty(),_.add(W)),x[u]instanceof c.L&&x[u].subscribe((x=>{J.Aw({material:W,prop:u,value:x})}),!1)}}},644329:()=>{},968242:(u,x,s)=>{s.d(x,{f:()=>W});var U=s(540362),_=s(722726);function W(){return U.U({taskName:"waitForSceneReadyTask",execute:(u,x)=>{if(u.scene.meshes.length>0){const s=()=>{u.scene.render()},U=()=>u.scene.meshes.every((u=>u.isReady()&&(!u.material||u.material.isReady(u)))),W=()=>{U()&&(u.scene.unregisterBeforeRender(W),u.engine.stopRenderLoop(s),_.K(u.scene,(()=>{x()})))};u.scene.registerBeforeRender(W),u.engine.runRenderLoop(s)}else x()}})}},968556:(u,x,s)=>{s.d(x,{S:()=>_});var U=s(706211);class _ extends U.Zp{}_.POINTER_LEAVE=-1},204596:(u,x,s)=>{s.d(x,{GF:()=>V,JI:()=>$,Ov:()=>k,Qq:()=>f,SA:()=>i,aZ:()=>H,j8:()=>t,jN:()=>r,nL:()=>N,qf:()=>J,r9:()=>d,td:()=>j,vu:()=>L,xU:()=>O});var U=s(871539),_=s(340923),W=s(948733),c=s(898973),I=s(359767);function L(u){let x=0;for(const s of u){const u=s.getKeys();x=Math.max(x,u[u.length-1].frame)}return x}function J(u){let x=0;for(const s of u.bones)x=Math.max(L(s.animations),x);return x}function k(u,x=!0){return u&&(x||(u.onAnimationEnd=()=>{}),u.stop()),null}function i(u,x){k(u.getScene().getAnimatableByTarget(u),x)}function d(u){let x,s=W.Pq.Zero();return u.forEach((u=>{x=u.getKeys(),"position.x"===u.targetProperty?s.x=x[0].value:"position.y"===u.targetProperty?s.y=x[0].value:"position.z"===u.targetProperty?s.z=x[0].value:"position"===u.targetProperty&&(s=x[0].value.clone())})),s}function j(u){return u instanceof W.Pq?U.X5.ANIMATIONTYPE_VECTOR3:u instanceof W.I9?U.X5.ANIMATIONTYPE_VECTOR2:u instanceof W.or?U.X5.ANIMATIONTYPE_SIZE:u instanceof W.PT?U.X5.ANIMATIONTYPE_QUATERNION:u instanceof W.uq?U.X5.ANIMATIONTYPE_MATRIX:u instanceof W.v9?U.X5.ANIMATIONTYPE_COLOR3:u instanceof W.ov?U.X5.ANIMATIONTYPE_COLOR4:U.X5.ANIMATIONTYPE_FLOAT}function r(u){return u instanceof W.Pq||u instanceof W.I9||u instanceof W.or||u instanceof W.PT||u instanceof W.uq||u instanceof W.v9?u.clone():u}function D(u){switch(u){case U.X5.ANIMATIONTYPE_VECTOR3:case U.X5.ANIMATIONTYPE_VECTOR2:case U.X5.ANIMATIONTYPE_QUATERNION:return!0;default:return!1}}function $({prop:u,from:x,to:s,duration:_,frameRate:W=I.q,loopMode:L=U.X5.ANIMATIONLOOPMODE_CYCLE,easingFunc:J,easingMode:k,delay:i=0,inTangent:d,outTangent:r}){const $=j(x),H=new U.X5(`${u}-${c.S0.RandomId()}`,u,W,$,L),f=[{frame:Math.ceil(W*i),value:x},{frame:Math.ceil(W*(_+i)),value:s}];return r&&D($)&&(f[0].outTangent=r),d&&D($)&&(f[1].inTangent=d),i&&f.unshift({frame:0,value:x}),H.setKeys(f),void 0!==J&&void 0!==k&&(J.setEasingMode(k),H.setEasingFunction(J)),H}function H({prop:u,keys:x,easingFunc:s,easingMode:_,delay:W=0,frameRate:L=I.q,loopMode:J=U.X5.ANIMATIONLOOPMODE_CYCLE,inTangent:k,outTangent:i}){const d=j(x[0].value),r=new U.X5(`${c.S0.RandomId()}-${u}`,u,L,j(x[0].value),J);if(W){const u=Math.ceil(L*W);x.forEach((x=>{x.frame+=u})),x.unshift({frame:0,value:x[0].value})}return r.setKeys(x),s&&_&&(s.setEasingMode(_),r.setEasingFunction(s)),i&&D(d)&&(x[0].outTangent=i),k&&D(d)&&(x[x.length-1].inTangent=k),r}function f(u,x=I.q){return Math.round(u*x)}function O(u,x,s,U){u.addEvent(new _.p(x,s,U))}function t(u,x,s){O(u,0,x,s)}function V(u,x,s){O(u,u.getHighestFrame(),x,s)}function N(u,x,s){for(const U of u)x.setEasingMode(s),U.setEasingFunction(x);return u}},359767:(u,x,s)=>{s.d(x,{q:()=>U});const U=25},682618:(u,x,s)=>{s.d(x,{X:()=>_});var U=s(320148);function _(u){return Object.keys(u).reduce(((x,s)=>{const W=u[s];return U.oK(W)?x.push(W.resource3dPath):"object"==typeof W&&null!==W&&(x=x.concat(_(W))),x}),[])}},21882:(u,x,s)=>{s.d(x,{N:()=>W});var U=s(501650),_=s(729606);function W(u){let x;return x=u.getEngine()._features.forceBitmapOverHTMLImageElement?new c(u):new U.rw(u),x.useDefaultLoadingScreen=!1,x}class c extends U.rw{addTextureTask(...u){let x;return x=function(u){if(u.startsWith(`${"data:"}image/svg+xml;`))return!0;return u.split("?")[0].endsWith(".svg")}(u[1])?new I(...u):new U.F6(...u),this._tasks.push(x),x}}class I extends U.F6{runTask(u,x,s){this.texture=_.y(this.url,u,{noMipmap:this.noMipmap,invertY:this.invertY,samplingMode:this.samplingMode,onLoad:()=>{x()},onError:(u,x)=>{s(u,x)}})}}},729606:(u,x,s)=>{s.d(x,{y:()=>_});var U=s(432050);function _(u,x,s={}){const _=x.getEngine(),W=_._features.forceBitmapOverHTMLImageElement;W&&(_._features.forceBitmapOverHTMLImageElement=!1);const c=new U.g(u,x,s);return _._features.forceBitmapOverHTMLImageElement=W,c}},557807:(u,x,s)=>{if(s.d(x,{AnimationFrameRate:()=>c.q,FullCircle:()=>I.qy,Timeline:()=>k.K,TimelineDelay:()=>k.p,Tween:()=>i.K,TweenGroup:()=>d.F1,TweenGroupParallel:()=>d.qe,addConstantDelta:()=>i.Yi,addEasing:()=>U.nL,addEventAt:()=>U.xU,addEventAtEnd:()=>U.GF,addEventAtStart:()=>U.j8,addMeshToShadowGenerator:()=>N.jN,addSceneShadowTexture:()=>N.Lg,addShadowUpdateFor:()=>N.Al,betMeshPrefix:()=>O.Xf,betMeshRegex:()=>O.ak,calculateChipsForAmount:()=>V.xG,changeChildOpacity:()=>O.mj,changeChildVisibility:()=>O.py,changeTransparencyModeForPBR:()=>O.PP,changeVisibility:()=>O.BQ,convertRotationSpace:()=>O._U,convertToPositiveAngle:()=>I.$R,copyInfoFromMesh:()=>O.J_,createAnimation:()=>U.JI,createAssetsManager:()=>m.N,createMirrorInstance:()=>f.h,createMultiStepAnimation:()=>U.aZ,createRenderManager:()=>n.createRenderManager,createSVGTexture:()=>Z.y,createTweenGroup:()=>d.hL,differenceBetweenAngles:()=>I.e5,disableMesh:()=>O.WB,distributeChipAmounts:()=>V.h6,durationToFrames:()=>U.Qq,enableManualShadowRender:()=>N.Ku,findChildrenAndWrap:()=>O["if"],forceShadowUpdate:()=>N.NA,freezeAllActiveMeshes:()=>t.c,freezeRecursive:()=>O.iV,get2dRadius:()=>I.Nb,getAbsoluteRotationQuaternion:()=>O.El,getAbsoluteScaling:()=>O.NV,getAngle:()=>I._H,getAnimationLength:()=>U.vu,getAnimationsFirstPosition:()=>U.r9,getBreathingAnimationFrames:()=>_.f,getChildByName:()=>O.rx,getDirection:()=>I.u6,getMeshByName:()=>O._2,getMeshSize:()=>O.Ts,getMeshesToLoad:()=>$.X,getNodeByName:()=>O.hU,getPointWhereRayIntersectsPlane:()=>I.mF,getPositionFromAngle:()=>I.LW,getRadiusToFit:()=>F.n,getRegexFromPrefix:()=>O.sq,getShadowGenerator:()=>N.kV,getSkeletonAnimationLength:()=>U.qf,getTimeBasedValue:()=>W.Y,getVisibleArea:()=>B.I,globalToLocal:()=>I._t,hasLight:()=>N.BY,interpolateRGB:()=>b.t,isBetMesh:()=>O.di,iterateAncestorsUntil:()=>O.X,localToGlobal:()=>I.cs,meshExists:()=>O.sJ,normalizeAngle:()=>I.n0,pickMesh:()=>O.Nq,pickTopMesh:()=>O.Sz,randomFromArray:()=>L.th,randomWithSign:()=>I.ZT,removeMeshFromShadowGenerator:()=>N.PP,removeShadowUpdateFor:()=>N.tZ,roundTo:()=>L.GB,roundVectorTo:()=>I.$1,scalarToVector3:()=>I.e_,stopAnimationFor:()=>U.SA,swapSubMaterial:()=>H.V,toScreenSpace:()=>I._L,tweenTo:()=>i.Zs,tweenToPromise:()=>j.K,unfreezeAllActiveMeshes:()=>t.r,union:()=>L.KC,updatePivotPointFor:()=>O.RE,updateRenderingGroup:()=>O.B$,wait:()=>J.uk,waitAsync:()=>J.of,waitRenderFrames:()=>D.K}),!/^(40457|68901)$/.test(s.j))var U=s(204596);if(/^(14232|94988)$/.test(s.j))var _=s(447901);if(/^(14232|94988)$/.test(s.j))var W=s(275866);if(!/^(40457|49135|68901|81052)$/.test(s.j))var c=s(359767);if(!/^(68901|81052)$/.test(s.j))var I=s(609859);if(!/^(18036|27272|40457|68901|81052)$/.test(s.j))var L=s(850121);if(/^((1423|483|8105)2|18036|40457|68901|94988)$/.test(s.j))var J=s(515920);if(/^(14232|94988)$/.test(s.j))var k=s(566911);if(68901!=s.j)var i=s(131208);if(!/^(14232|18036|40457|68901|81052)$/.test(s.j))var d=s(595986);if(!/^(18036|27272|49135|68901|81052|94988)$/.test(s.j))var j=s(513024);var r=s(272726);if(s.o(r,"ArcCamera")&&s.d(x,{ArcCamera:function(){return r.ArcCamera}}),s.o(r,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return r.CHIP_MARGIN}}),s.o(r,"CameraManager")&&s.d(x,{CameraManager:function(){return r.CameraManager}}),s.o(r,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return r.CameraPositionProps}}),s.o(r,"ChipGroup")&&s.d(x,{ChipGroup:function(){return r.ChipGroup}}),s.o(r,"ChipSelector")&&s.d(x,{ChipSelector:function(){return r.ChipSelector}}),s.o(r,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return r.ChipSelectorEvent}}),s.o(r,"ChipStack")&&s.d(x,{ChipStack:function(){return r.ChipStack}}),s.o(r,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return r.ChipStackLabel}}),s.o(r,"CursorHover")&&s.d(x,{CursorHover:function(){return r.CursorHover}}),s.o(r,"DragState")&&s.d(x,{DragState:function(){return r.DragState}}),s.o(r,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return r.ExtendedAction}}),s.o(r,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return r.FakeChipStack}}),s.o(r,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return r.FlickeringLightning}}),s.o(r,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return r.GatheringLightning}}),s.o(r,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return r.GhostChipStack}}),s.o(r,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return r.HTMLMesh}}),s.o(r,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return r.HTMLMeshContainer}}),s.o(r,"Hover")&&s.d(x,{Hover:function(){return r.Hover}}),s.o(r,"HoverState")&&s.d(x,{HoverState:function(){return r.HoverState}}),s.o(r,"LightningStrike")&&s.d(x,{LightningStrike:function(){return r.LightningStrike}}),s.o(r,"LongPress")&&s.d(x,{LongPress:function(){return r.LongPress}}),s.o(r,"LongPressState")&&s.d(x,{LongPressState:function(){return r.LongPressState}}),s.o(r,"Tap")&&s.d(x,{Tap:function(){return r.Tap}}),s.o(r,"TapDrag")&&s.d(x,{TapDrag:function(){return r.TapDrag}}),s.o(r,"TapState")&&s.d(x,{TapState:function(){return r.TapState}}),s.o(r,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return r.TapWithMovement}}),s.o(r,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return r.TapWithMovementState}}),s.o(r,"Tooltip")&&s.d(x,{Tooltip:function(){return r.Tooltip}}),s.o(r,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return r.TooltipContainer}}),s.o(r,"TooltipManager")&&s.d(x,{TooltipManager:function(){return r.TooltipManager}}),s.o(r,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return r.TooltipsSystem}}),s.o(r,"addAction")&&s.d(x,{addAction:function(){return r.addAction}}),s.o(r,"addMeshToShadowGenerator")&&s.d(x,{addMeshToShadowGenerator:function(){return r.addMeshToShadowGenerator}}),s.o(r,"addSceneShadowTexture")&&s.d(x,{addSceneShadowTexture:function(){return r.addSceneShadowTexture}}),s.o(r,"addShadowUpdateFor")&&s.d(x,{addShadowUpdateFor:function(){return r.addShadowUpdateFor}}),s.o(r,"betMeshPrefix")&&s.d(x,{betMeshPrefix:function(){return r.betMeshPrefix}}),s.o(r,"betMeshRegex")&&s.d(x,{betMeshRegex:function(){return r.betMeshRegex}}),s.o(r,"calculateChipsForAmount")&&s.d(x,{calculateChipsForAmount:function(){return r.calculateChipsForAmount}}),s.o(r,"changeChildOpacity")&&s.d(x,{changeChildOpacity:function(){return r.changeChildOpacity}}),s.o(r,"changeChildVisibility")&&s.d(x,{changeChildVisibility:function(){return r.changeChildVisibility}}),s.o(r,"changeTransparencyModeForPBR")&&s.d(x,{changeTransparencyModeForPBR:function(){return r.changeTransparencyModeForPBR}}),s.o(r,"changeVisibility")&&s.d(x,{changeVisibility:function(){return r.changeVisibility}}),s.o(r,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return r.chipStackHeightLimit}}),s.o(r,"convertRotationSpace")&&s.d(x,{convertRotationSpace:function(){return r.convertRotationSpace}}),s.o(r,"copyInfoFromMesh")&&s.d(x,{copyInfoFromMesh:function(){return r.copyInfoFromMesh}}),s.o(r,"createAssetsManager")&&s.d(x,{createAssetsManager:function(){return r.createAssetsManager}}),s.o(r,"createChip")&&s.d(x,{createChip:function(){return r.createChip}}),s.o(r,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return r.createDynamicChip}}),s.o(r,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return r.createGoLiveDoor}}),s.o(r,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return r.createGoLiveParticles}}),s.o(r,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return r.createHTMLMeshTransport}}),s.o(r,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return r.createLightningGlowLayer}}),s.o(r,"createMirrorInstance")&&s.d(x,{createMirrorInstance:function(){return r.createMirrorInstance}}),s.o(r,"createRenderManager")&&s.d(x,{createRenderManager:function(){return r.createRenderManager}}),s.o(r,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return r.createSVGTexture}}),s.o(r,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return r.createStandardDoorAnimation}}),s.o(r,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return r.createTooltipFactory}}),s.o(r,"disableMesh")&&s.d(x,{disableMesh:function(){return r.disableMesh}}),s.o(r,"distributeChipAmounts")&&s.d(x,{distributeChipAmounts:function(){return r.distributeChipAmounts}}),s.o(r,"enableManualShadowRender")&&s.d(x,{enableManualShadowRender:function(){return r.enableManualShadowRender}}),s.o(r,"findChildrenAndWrap")&&s.d(x,{findChildrenAndWrap:function(){return r.findChildrenAndWrap}}),s.o(r,"forceShadowUpdate")&&s.d(x,{forceShadowUpdate:function(){return r.forceShadowUpdate}}),s.o(r,"freezeAllActiveMeshes")&&s.d(x,{freezeAllActiveMeshes:function(){return r.freezeAllActiveMeshes}}),s.o(r,"freezeRecursive")&&s.d(x,{freezeRecursive:function(){return r.freezeRecursive}}),s.o(r,"getAbsoluteRotationQuaternion")&&s.d(x,{getAbsoluteRotationQuaternion:function(){return r.getAbsoluteRotationQuaternion}}),s.o(r,"getAbsoluteScaling")&&s.d(x,{getAbsoluteScaling:function(){return r.getAbsoluteScaling}}),s.o(r,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return r.getAvailableAmounts}}),s.o(r,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return r.getBaseChipsByGroup}}),s.o(r,"getChildByName")&&s.d(x,{getChildByName:function(){return r.getChildByName}}),s.o(r,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return r.getConstantDelta}}),s.o(r,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return r.getLightningPositionWithOffset}}),s.o(r,"getLosingChips")&&s.d(x,{getLosingChips:function(){return r.getLosingChips}}),s.o(r,"getMeshByName")&&s.d(x,{getMeshByName:function(){return r.getMeshByName}}),s.o(r,"getMeshSize")&&s.d(x,{getMeshSize:function(){return r.getMeshSize}}),s.o(r,"getMeshesToLoad")&&s.d(x,{getMeshesToLoad:function(){return r.getMeshesToLoad}}),s.o(r,"getNodeByName")&&s.d(x,{getNodeByName:function(){return r.getNodeByName}}),s.o(r,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return r.getRadiusToFit}}),s.o(r,"getRegexFromPrefix")&&s.d(x,{getRegexFromPrefix:function(){return r.getRegexFromPrefix}}),s.o(r,"getShadowGenerator")&&s.d(x,{getShadowGenerator:function(){return r.getShadowGenerator}}),s.o(r,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return r.getStandardChipDimensions}}),s.o(r,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return r.getVisibleArea}}),s.o(r,"hasLight")&&s.d(x,{hasLight:function(){return r.hasLight}}),s.o(r,"initChips")&&s.d(x,{initChips:function(){return r.initChips}}),s.o(r,"interpolateRGB")&&s.d(x,{interpolateRGB:function(){return r.interpolateRGB}}),s.o(r,"isBetMesh")&&s.d(x,{isBetMesh:function(){return r.isBetMesh}}),s.o(r,"isMouseInput")&&s.d(x,{isMouseInput:function(){return r.isMouseInput}}),s.o(r,"iterateAncestorsUntil")&&s.d(x,{iterateAncestorsUntil:function(){return r.iterateAncestorsUntil}}),s.o(r,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return r.lightningMeshesDefaultOptions}}),s.o(r,"meshExists")&&s.d(x,{meshExists:function(){return r.meshExists}}),s.o(r,"pickMesh")&&s.d(x,{pickMesh:function(){return r.pickMesh}}),s.o(r,"pickTopMesh")&&s.d(x,{pickTopMesh:function(){return r.pickTopMesh}}),s.o(r,"removeAction")&&s.d(x,{removeAction:function(){return r.removeAction}}),s.o(r,"removeMeshFromShadowGenerator")&&s.d(x,{removeMeshFromShadowGenerator:function(){return r.removeMeshFromShadowGenerator}}),s.o(r,"removeShadowUpdateFor")&&s.d(x,{removeShadowUpdateFor:function(){return r.removeShadowUpdateFor}}),s.o(r,"swapSubMaterial")&&s.d(x,{swapSubMaterial:function(){return r.swapSubMaterial}}),s.o(r,"unfreezeAllActiveMeshes")&&s.d(x,{unfreezeAllActiveMeshes:function(){return r.unfreezeAllActiveMeshes}}),s.o(r,"updatePivotPointFor")&&s.d(x,{updatePivotPointFor:function(){return r.updatePivotPointFor}}),s.o(r,"updateRenderingGroup")&&s.d(x,{updateRenderingGroup:function(){return r.updateRenderingGroup}}),s.o(r,"waitRenderFrames")&&s.d(x,{waitRenderFrames:function(){return r.waitRenderFrames}}),!/^((1423|2727|8105)2|40457|68901)$/.test(s.j))var D=s(722726);if(94988!=s.j)var $=s(682618);if(/^(11123|21167|4832|60297|77899|83188|90066)$/.test(s.j))var H=s(346137);if(94988==s.j)var f=s(666121);var O=s(74643);if(18036==s.j)var t=s(374199);if(!/^(18036|27272|49135|68901|81052|94988)$/.test(s.j))var V=s(708018);if(!/^(27272|68901|81052)$/.test(s.j))var N=s(328910);if(!/^(18036|68901|81052|94988)$/.test(s.j))var m=s(21882);if(49135==s.j)var b=s(756295);var n=s(101015);if(s.o(n,"ArcCamera")&&s.d(x,{ArcCamera:function(){return n.ArcCamera}}),s.o(n,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return n.CHIP_MARGIN}}),s.o(n,"CameraManager")&&s.d(x,{CameraManager:function(){return n.CameraManager}}),s.o(n,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return n.CameraPositionProps}}),s.o(n,"ChipGroup")&&s.d(x,{ChipGroup:function(){return n.ChipGroup}}),s.o(n,"ChipSelector")&&s.d(x,{ChipSelector:function(){return n.ChipSelector}}),s.o(n,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return n.ChipSelectorEvent}}),s.o(n,"ChipStack")&&s.d(x,{ChipStack:function(){return n.ChipStack}}),s.o(n,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return n.ChipStackLabel}}),s.o(n,"CursorHover")&&s.d(x,{CursorHover:function(){return n.CursorHover}}),s.o(n,"DragState")&&s.d(x,{DragState:function(){return n.DragState}}),s.o(n,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return n.ExtendedAction}}),s.o(n,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return n.FakeChipStack}}),s.o(n,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return n.FlickeringLightning}}),s.o(n,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return n.GatheringLightning}}),s.o(n,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return n.GhostChipStack}}),s.o(n,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return n.HTMLMesh}}),s.o(n,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return n.HTMLMeshContainer}}),s.o(n,"Hover")&&s.d(x,{Hover:function(){return n.Hover}}),s.o(n,"HoverState")&&s.d(x,{HoverState:function(){return n.HoverState}}),s.o(n,"LightningStrike")&&s.d(x,{LightningStrike:function(){return n.LightningStrike}}),s.o(n,"LongPress")&&s.d(x,{LongPress:function(){return n.LongPress}}),s.o(n,"LongPressState")&&s.d(x,{LongPressState:function(){return n.LongPressState}}),s.o(n,"Tap")&&s.d(x,{Tap:function(){return n.Tap}}),s.o(n,"TapDrag")&&s.d(x,{TapDrag:function(){return n.TapDrag}}),s.o(n,"TapState")&&s.d(x,{TapState:function(){return n.TapState}}),s.o(n,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return n.TapWithMovement}}),s.o(n,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return n.TapWithMovementState}}),s.o(n,"Tooltip")&&s.d(x,{Tooltip:function(){return n.Tooltip}}),s.o(n,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return n.TooltipContainer}}),s.o(n,"TooltipManager")&&s.d(x,{TooltipManager:function(){return n.TooltipManager}}),s.o(n,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return n.TooltipsSystem}}),s.o(n,"addAction")&&s.d(x,{addAction:function(){return n.addAction}}),s.o(n,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return n.chipStackHeightLimit}}),s.o(n,"createChip")&&s.d(x,{createChip:function(){return n.createChip}}),s.o(n,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return n.createDynamicChip}}),s.o(n,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return n.createGoLiveDoor}}),s.o(n,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return n.createGoLiveParticles}}),s.o(n,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return n.createHTMLMeshTransport}}),s.o(n,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return n.createLightningGlowLayer}}),s.o(n,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return n.createSVGTexture}}),s.o(n,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return n.createStandardDoorAnimation}}),s.o(n,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return n.createTooltipFactory}}),s.o(n,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return n.getAvailableAmounts}}),s.o(n,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return n.getBaseChipsByGroup}}),s.o(n,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return n.getConstantDelta}}),s.o(n,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return n.getLightningPositionWithOffset}}),s.o(n,"getLosingChips")&&s.d(x,{getLosingChips:function(){return n.getLosingChips}}),s.o(n,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return n.getRadiusToFit}}),s.o(n,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return n.getStandardChipDimensions}}),s.o(n,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return n.getVisibleArea}}),s.o(n,"initChips")&&s.d(x,{initChips:function(){return n.initChips}}),s.o(n,"isMouseInput")&&s.d(x,{isMouseInput:function(){return n.isMouseInput}}),s.o(n,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return n.lightningMeshesDefaultOptions}}),s.o(n,"removeAction")&&s.d(x,{removeAction:function(){return n.removeAction}}),!/^((1423|2727|8105)2|40457|49135|68901|94988)$/.test(s.j))var F=s(909150);if(!/^((1423|2727|8105)2|40457|49135|68901|94988)$/.test(s.j))var B=s(696624);if(/^((831|949)88|14232)$/.test(s.j))var Z=s(729606)},718113:(u,x,s)=>{s.d(x,{Aw:()=>W,P3:()=>J,YE:()=>c,Zg:()=>L,tD:()=>I});var U=s(948733);const _=["diffuse","emissive","bump","metallic","opacity","specular"];function W(u){const{material:x,prop:s,value:_}=u;if(!J(x)&&!i(x)&&!k(x))return!1;if(L(s))return"object"==typeof(W=_)&&"name"in W&&!!I(x,s,_);var W;switch(s){case"diffuseColor":{if("string"!=typeof _)return!1;const u=U.v9.FromHexString(_);return k(x)?x.baseColor=u:J(x)?x.diffuseColor=u:i(x)&&(x.albedoColor=u),!0}case"emissiveColor":return"string"==typeof _&&(x.emissiveColor=U.v9.FromHexString(_),!0);case"metallicValue":if(k(x)&&"number"==typeof _)return x.metallic=_,!0;break;case"roughnessValue":if(k(x)&&"number"==typeof _)return x.roughness=_,!0;break;case"alpha":if(J(x)&&"number"==typeof _)return x.alpha=_,!0;break;default:return function(){throw new Error(`Unsupported material property name: "${s}"`)}()}return!1}function c(u,x){for(const s of Object.keys(x)){const U=x[s];"level"===s&&"number"==typeof U?u.level=U:"hasAlpha"===s&&"boolean"==typeof U&&(u.hasAlpha=U)}}function I(u,x,s){if(!J(u)&&!i(u)&&!k(u))return null;switch(x){case"diffuse":if(k(u))return s&&(u.baseTexture=s),u.baseTexture;if(J(u))return s&&(u.diffuseTexture=s),u.diffuseTexture;if(i(u))return s&&(u.albedoTexture=s),u.albedoTexture;break;case"emissive":return s&&(u.emissiveTexture=s),u.emissiveTexture;case"bump":if(J(u)||i(u))return s&&(u.bumpTexture=s),u.bumpTexture;if(k(u))return s&&(u.normalTexture=s),u.normalTexture;break;case"metallic":if(k(u))return s&&(u.metallicRoughnessTexture=s),u.metallicRoughnessTexture;if(i(u))return s&&(u.metallicTexture=s),u.metallicTexture;break;case"opacity":if(J(u)||i(u))return s&&(s.getAlphaFromRGB=!0,u.opacityTexture=s),u.opacityTexture;break;case"specular":if(J(u))return s&&(u.specularTexture=s),u.specularTexture}return null}function L(u){return _.includes(u)}function J(u){return!("metallicRoughnessTexture"in u)&&!("albedoTexture"in u)&&"diffuseTexture"in u}function k(u){return"roughness"in u&&"metallic"in u&&"metallicRoughnessTexture"in u}function i(u){return"refractionTexture"in u&&"albedoTexture"in u&&"reflectivityTexture"in u}},609859:(u,x,s)=>{s.d(x,{$1:()=>$,$R:()=>k,LW:()=>L,Nb:()=>c,PC:()=>r,ZT:()=>j,_H:()=>I,_L:()=>D,_t:()=>i,cs:()=>d,e5:()=>f,e_:()=>H,mF:()=>t,n0:()=>J,qy:()=>W,u6:()=>O});var U=s(948733),_=s(850121);const W=2*Math.PI;function c(u,x){const s=u.clone();return s.y=x.y,U.Pq.Distance(s,x)}function I(u,x){return Math.atan2(x.z-u.z,x.x-u.x)}function L(u,x,s,_){return new U.Pq(u.x+Math.cos(s)*x,_,u.z+Math.sin(s)*x)}function J(u){return u>=-W&&u<=W?u:u%W}function k(u){const x=J(u);return x<0?W+x:x}function i(u,x){if(null===x)return u.clone();const s=new U.uq;return x.getWorldMatrix().invertToRef(s),U.Pq.TransformCoordinates(u,s)}function d(u,x){return x?U.Pq.TransformCoordinates(u,x.getWorldMatrix()):u.clone()}function j(){return Math.cos(Math.PI*Math.random())}function r(u,x,s,U){return Math.sqrt((u-s)**2+(x-U)**2)}function D(u,x,s=!0,_=!0){if(x.activeCamera){const W=x.getEngine(),c=s?W.getHardwareScalingLevel(_):1,I=U.Pq.Project(u,U.uq.IdentityReadOnly,x.getTransformMatrix(),x.activeCamera.viewport.toGlobal(W.getRenderWidth(),W.getRenderHeight()));return I.x*=c,I.y*=c,I.z*=c,I}return U.Pq.Zero()}function $(u,x=0){return u.x=_.GB(u.x,x),u.y=_.GB(u.y,x),u.z=_.GB(u.z,x),u}function H(u){return new U.Pq(u,u,u)}function f(u,x){const s=J(u),U=J(x);return Math.abs(Math.min(W-Math.abs(s-U),Math.abs(s-U)))}function O(u,x){const s=U.uq.RotationYawPitchRoll(x.y,x.x,x.z);return U.Pq.TransformCoordinates(u,s)}function t(u,x,s){const _=U.Pq.Dot(s,x.subtract(u.origin)),W=U.Pq.Dot(s,u.direction),c=u.direction.scale(_/W);return u.origin.add(c)}},850121:(u,x,s)=>{s.d(x,{GB:()=>_,KC:()=>c,hH:()=>W,th:()=>I}),s(948733);var U=s(384511);function _(u,x){const s=10**(x<0?0:x);return Math.round(u*s)/s}function W(u,x,s,U,_){return U===_?U:(_-U)*(u-x)/(s-x)+U}function c(u,x){return u.concat(x.filter((x=>!u.includes(x))))}function I(u){return u[U.U4(0,u.length-1)]}},74643:(u,x,s)=>{s.d(x,{B$:()=>E,BQ:()=>t,El:()=>l,J_:()=>n,NV:()=>Q,Nq:()=>j,PP:()=>m,RE:()=>f,Sz:()=>D,Ts:()=>$,WB:()=>F,X:()=>y,Xf:()=>J,_2:()=>Z,_U:()=>z,ak:()=>k,di:()=>d,hU:()=>v,iV:()=>T,if:()=>e,lm:()=>r,mj:()=>V,py:()=>O,rx:()=>b,sJ:()=>B,sq:()=>i});var U=s(948733),_=s(615473),W=s(938868),c=s(789603),I=s(633727),L=s(809319);const J="bet-",k=i(J);function i(u){return new RegExp(`^${u}`)}function d(u){return k.test(u)}function j(u,x,{fastCheck:s,negativeCheck:U}={fastCheck:!0,negativeCheck:!1}){const _=u.pick(u.pointerX,u.pointerY,(u=>{const s=u.name.indexOf(x);return(U?0!==s:0===s)&&u.isPickable&&u.isEnabled()}),s);return _?_.pickedMesh:null}function r(u,x){if(!x.isPickable)return null;const s=u.pick(u.pointerX,u.pointerY,(u=>u===x));return s?s.pickedMesh:null}function D(u,x,s){const U=u.pick(u.pointerX,u.pointerY,s);return(null==U?void 0:U.pickedMesh)&&x===U.pickedMesh?U.pickedMesh:null}function $(u,x){let s;return void 0!==(_=u)&&"function"==typeof _.getNodeSize?u.getNodeSize(x):(u instanceof W.u&&(s=u.getBoundingInfo().boundingBox.extendSize.scale(x?2:1)),!s||s.equals(U.Pq.ZeroReadOnly)?(s=function(u){const x=new U.Pq(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new U.Pq(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),_=u.getChildMeshes(!1);for(const u of _)H(u,x,s);return s.subtractInPlace(x)}(u),s.scaleInPlace(x?1:.5)):(s.x*=u.scaling.x,s.y*=u.scaling.y,s.z*=u.scaling.z),s);var _}function H(u,x,s){u.computeWorldMatrix(!0);const U=u.getBoundingInfo(),_=U.boundingBox.minimumWorld,W=U.boundingBox.maximumWorld;x.x=Math.min(_.x,x.x),x.y=Math.min(_.y,x.y),x.z=Math.min(_.z,x.z),s.x=Math.max(W.x,s.x),s.y=Math.max(W.y,s.y),s.z=Math.max(W.z,s.z)}function f(u,x){const s=u.getAbsolutePosition().clone(),W=$(u),c=new U.Pq(W.x*_.X.Clamp(x.x,-1,1),-W.y*_.X.Clamp(x.y,-1,1),W.z*_.X.Clamp(x.z,-1,1));return u.setPivotMatrix(U.uq.Translation(-c.x,-c.y,-c.z),!1),u.setAbsolutePosition(s),u}function O(u,x,s=!1){for(const U of u.getChildMeshes(!s))U.isVisible=x}function t(u,x,s=!1){"isVisible"in u&&(u.isVisible=x),O(u,x,s)}function V(u,x,s=!1){for(const U of u.getChildMeshes(!s))U.visibility=x}function N(u){return"transparencyMode"in u}function m(u,x,s=!1){const U=u.getChildMeshes(!s);U.push(u);for(const u of U){const s=u.material;s&&N(s)&&(s.transparencyMode=x)}}function b(u,x){const s=u.getChildMeshes(!0,(u=>u.name===x));if(s.length>0)return s[0]}function n(u,x,s){let U=null,_=null;s&&!s.rotation||(U=u.rotation.clone()),s&&!s.scaling||(_=u.scaling.clone()),s&&!s.parent||x.setParent(u.parent),U&&(x.rotation=U),_&&(x.scaling=_),s&&!s.position||x.setAbsolutePosition(u.getAbsolutePosition())}function F(u,x){const s=x.getMeshByName(u);s&&s.setEnabled(!1)}function B(u,x){return!!x.getMeshByName(u)}function Z(u,x){const s=x.getMeshByName(u);if(!s)throw new Error(`Mesh with name ${u} not found`);return s}function v(u,x){const s=x.getNodeByName(u);if(!s)throw new Error(`Node with name ${u} not found`);return s}function y(u,x){if(u){const s=x(u);if(!0===s)return u;if(!1===s)return;return y(u.parent,x)}}function e(u,x){const s=x?u.getChildMeshes(!1,(u=>x.includes(u.name))):u.getChildMeshes();return u=>s.map(u)}function T(u,x=!0,s=!0){(function(u,x=!0,s=!0){x&&!u.isWorldMatrixFrozen&&u.freezeWorldMatrix(),s&&u.material&&u.material.freeze()})(u,x,s),u.getChildMeshes().forEach((u=>{T(u,x,s)}))}function Q(u){const x=u.scaling.clone();let s=u.parent;for(;s instanceof I.V;)x.multiplyInPlace(s.scaling),s=s.parent;return x}function E(u,x){if(L.m.MIN_RENDERINGGROUPS>x&&(L.m.MIN_RENDERINGGROUPS=x),u instanceof c.Z)u.sourceMesh.renderingGroupId!==x&&(u.sourceMesh.renderingGroupId=x);else if(u instanceof W.u){u.renderingGroupId=x;const s=u.getChildMeshes();for(const u of s)E(u,x)}else u.renderingGroupId=x}function l(u){const x=U.PT.Identity();return u.getWorldMatrix().decompose(void 0,x),x}function z(u,x){const s=l(u);return x?U.PT.Inverse(l(x)).multiplyInPlace(s).toEulerAngles():s.toEulerAngles()}},101015:(u,x,s)=>{s.d(x,{createRenderManager:()=>_.A});var U=s(157122);if(s.o(U,"ArcCamera")&&s.d(x,{ArcCamera:function(){return U.ArcCamera}}),s.o(U,"CHIP_MARGIN")&&s.d(x,{CHIP_MARGIN:function(){return U.CHIP_MARGIN}}),s.o(U,"CameraManager")&&s.d(x,{CameraManager:function(){return U.CameraManager}}),s.o(U,"CameraPositionProps")&&s.d(x,{CameraPositionProps:function(){return U.CameraPositionProps}}),s.o(U,"ChipGroup")&&s.d(x,{ChipGroup:function(){return U.ChipGroup}}),s.o(U,"ChipSelector")&&s.d(x,{ChipSelector:function(){return U.ChipSelector}}),s.o(U,"ChipSelectorEvent")&&s.d(x,{ChipSelectorEvent:function(){return U.ChipSelectorEvent}}),s.o(U,"ChipStack")&&s.d(x,{ChipStack:function(){return U.ChipStack}}),s.o(U,"ChipStackLabel")&&s.d(x,{ChipStackLabel:function(){return U.ChipStackLabel}}),s.o(U,"CursorHover")&&s.d(x,{CursorHover:function(){return U.CursorHover}}),s.o(U,"DragState")&&s.d(x,{DragState:function(){return U.DragState}}),s.o(U,"ExtendedAction")&&s.d(x,{ExtendedAction:function(){return U.ExtendedAction}}),s.o(U,"FakeChipStack")&&s.d(x,{FakeChipStack:function(){return U.FakeChipStack}}),s.o(U,"FlickeringLightning")&&s.d(x,{FlickeringLightning:function(){return U.FlickeringLightning}}),s.o(U,"GatheringLightning")&&s.d(x,{GatheringLightning:function(){return U.GatheringLightning}}),s.o(U,"GhostChipStack")&&s.d(x,{GhostChipStack:function(){return U.GhostChipStack}}),s.o(U,"HTMLMesh")&&s.d(x,{HTMLMesh:function(){return U.HTMLMesh}}),s.o(U,"HTMLMeshContainer")&&s.d(x,{HTMLMeshContainer:function(){return U.HTMLMeshContainer}}),s.o(U,"Hover")&&s.d(x,{Hover:function(){return U.Hover}}),s.o(U,"HoverState")&&s.d(x,{HoverState:function(){return U.HoverState}}),s.o(U,"LightningStrike")&&s.d(x,{LightningStrike:function(){return U.LightningStrike}}),s.o(U,"LongPress")&&s.d(x,{LongPress:function(){return U.LongPress}}),s.o(U,"LongPressState")&&s.d(x,{LongPressState:function(){return U.LongPressState}}),s.o(U,"Tap")&&s.d(x,{Tap:function(){return U.Tap}}),s.o(U,"TapDrag")&&s.d(x,{TapDrag:function(){return U.TapDrag}}),s.o(U,"TapState")&&s.d(x,{TapState:function(){return U.TapState}}),s.o(U,"TapWithMovement")&&s.d(x,{TapWithMovement:function(){return U.TapWithMovement}}),s.o(U,"TapWithMovementState")&&s.d(x,{TapWithMovementState:function(){return U.TapWithMovementState}}),s.o(U,"Tooltip")&&s.d(x,{Tooltip:function(){return U.Tooltip}}),s.o(U,"TooltipContainer")&&s.d(x,{TooltipContainer:function(){return U.TooltipContainer}}),s.o(U,"TooltipManager")&&s.d(x,{TooltipManager:function(){return U.TooltipManager}}),s.o(U,"TooltipsSystem")&&s.d(x,{TooltipsSystem:function(){return U.TooltipsSystem}}),s.o(U,"addAction")&&s.d(x,{addAction:function(){return U.addAction}}),s.o(U,"chipStackHeightLimit")&&s.d(x,{chipStackHeightLimit:function(){return U.chipStackHeightLimit}}),s.o(U,"createChip")&&s.d(x,{createChip:function(){return U.createChip}}),s.o(U,"createDynamicChip")&&s.d(x,{createDynamicChip:function(){return U.createDynamicChip}}),s.o(U,"createGoLiveDoor")&&s.d(x,{createGoLiveDoor:function(){return U.createGoLiveDoor}}),s.o(U,"createGoLiveParticles")&&s.d(x,{createGoLiveParticles:function(){return U.createGoLiveParticles}}),s.o(U,"createHTMLMeshTransport")&&s.d(x,{createHTMLMeshTransport:function(){return U.createHTMLMeshTransport}}),s.o(U,"createLightningGlowLayer")&&s.d(x,{createLightningGlowLayer:function(){return U.createLightningGlowLayer}}),s.o(U,"createSVGTexture")&&s.d(x,{createSVGTexture:function(){return U.createSVGTexture}}),s.o(U,"createStandardDoorAnimation")&&s.d(x,{createStandardDoorAnimation:function(){return U.createStandardDoorAnimation}}),s.o(U,"createTooltipFactory")&&s.d(x,{createTooltipFactory:function(){return U.createTooltipFactory}}),s.o(U,"getAvailableAmounts")&&s.d(x,{getAvailableAmounts:function(){return U.getAvailableAmounts}}),s.o(U,"getBaseChipsByGroup")&&s.d(x,{getBaseChipsByGroup:function(){return U.getBaseChipsByGroup}}),s.o(U,"getConstantDelta")&&s.d(x,{getConstantDelta:function(){return U.getConstantDelta}}),s.o(U,"getLightningPositionWithOffset")&&s.d(x,{getLightningPositionWithOffset:function(){return U.getLightningPositionWithOffset}}),s.o(U,"getLosingChips")&&s.d(x,{getLosingChips:function(){return U.getLosingChips}}),s.o(U,"getRadiusToFit")&&s.d(x,{getRadiusToFit:function(){return U.getRadiusToFit}}),s.o(U,"getStandardChipDimensions")&&s.d(x,{getStandardChipDimensions:function(){return U.getStandardChipDimensions}}),s.o(U,"getVisibleArea")&&s.d(x,{getVisibleArea:function(){return U.getVisibleArea}}),s.o(U,"initChips")&&s.d(x,{initChips:function(){return U.initChips}}),s.o(U,"isMouseInput")&&s.d(x,{isMouseInput:function(){return U.isMouseInput}}),s.o(U,"lightningMeshesDefaultOptions")&&s.d(x,{lightningMeshesDefaultOptions:function(){return U.lightningMeshesDefaultOptions}}),s.o(U,"removeAction")&&s.d(x,{removeAction:function(){return U.removeAction}}),!/^((1423|2727|8105)2|18036|94988)$/.test(s.j))var _=s(451336)},157122:()=>{},722726:(u,x,s)=>{function U(u,x,s=1){let U=s;U<1&&(U=1);const _=()=>{U--,U<=0&&(u.unregisterAfterRender(_),x())};u.registerAfterRender(_)}s.d(x,{K:()=>U})},328910:(u,x,s)=>{s.d(x,{Al:()=>d,BY:()=>D,Ku:()=>J,Lg:()=>$,NA:()=>I,PP:()=>i,dn:()=>H,jN:()=>L,kV:()=>c,tZ:()=>j,tx:()=>r}),s(625735);var U=s(432050),_=s(938868);const W={};function c(u,x){const s=u.getLightByName(x);let U=null;return s&&(U=s.getShadowGenerator()),U||null}function I(u,x){const s=c(u,x);s&&k(s.getShadowMap())}function L(u,x,s=!0){const U=c(u.getScene(),x);if(U){if(u instanceof _.u)U.addShadowCaster(u,s);else{const x=u.getChildMeshes(!s);for(const u of x)U.addShadowCaster(u,!1)}k(U.getShadowMap())}}function J(u){W.hasOwnProperty(u)||(W[u]=0)}function k(u){u&&u.refreshRate<=0&&u.resetRefreshCounter()}function i(u,x,s=!0){const U=c(u.getScene(),x);if(U){if(u instanceof _.u)U.removeShadowCaster(u,s);else{const x=u.getChildMeshes(!s);for(const u of x)U.removeShadowCaster(u,!1)}k(U.getShadowMap())}}function d(u,x){if(!W.hasOwnProperty(x))return;const s=c(u,x);if(s){const u=W[x];if(W[x]=u+1,0===u){const u=s.getShadowMap();u&&(u.refreshRate=1)}}}function j(u,x){if(!W.hasOwnProperty(x)||0===W[x])return;const s=c(u,x);if(s){const u=W[x];if(W[x]=u-1,0===W[x]){const u=s.getShadowMap();u&&(u.refreshRate=0)}}}function r(){for(const u of Object.keys(W))delete W[u]}function D(u,x){return null!==u.getLightByName(x)}function $(u,x,s,_){H(u,new U.g(x,u),s,_)}function H(u,x,s,U=1){x.coordinatesIndex=U;for(const U of s){const s=u.getMaterialByName(U);s&&f(s)&&(s.lightmapTexture=x,s.useLightmapAsShadowmap=!0,s.isFrozen&&s.markDirty())}}function f(u){return"lightmapTexture"in u&&"useLightmapAsShadowmap"in u}},515920:(u,x,s)=>{s.d(x,{Gu:()=>U,of:()=>W,uk:()=>_});class U{constructor(u,x,s){this.scene=u,this.time=x,this.callback=s,this.onUpdate=this.onUpdate.bind(this),this.scene.registerBeforeRender(this.onUpdate)}destroy(){this.scene&&this.scene.unregisterBeforeRender(this.onUpdate),this.scene=void 0,this.callback=void 0}onUpdate(){this.scene&&(this.time-=this.scene.getEngine().getDeltaTime()),this.time<=0&&this.callback&&(this.callback(),this.destroy())}}function _(u,x,s){return new U(u,x,s)}function W(u,x){return new Promise((s=>{_(u,x,s)}))}},566911:(u,x,s)=>{s.d(x,{K:()=>_,p:()=>U});class U{constructor(u){this.promise=new Promise((u=>{this.resolve=u})),this.resolve&&(0===u||_.isInstant())?this.resolve():(_.addRunningEvent(this),this.timeout=window.setTimeout((()=>{this.fastForward()}),u))}fastForward(){window.clearTimeout(this.timeout),_.removeRunningEvent(this),this.resolve&&this.resolve()}setSpeedRatio(u){}}class _{static toggleInstant(u,x=_.baseDuration){return window.clearTimeout(_.timeout),_.timeout=void 0,u?new Promise((u=>{_.timeout=window.setTimeout((()=>{_.toggleInstant(!1),u()}),x),[..._.runningEvents].forEach((u=>{u.fastForward()}))})):Promise.resolve()}static setGlobalSpeedRatio(u){_.globalSpeedRatio!==u&&(_.globalSpeedRatio=u,_.runningEvents.forEach((x=>{x.setSpeedRatio(u)})))}static getGlobalSpeedRatio(){return _.globalSpeedRatio}static addRunningEvent(u){_.runningEvents.push(u)}static removeRunningEvent(u){const x=_.runningEvents.indexOf(u);-1!==x&&_.runningEvents.splice(x,1)}static isInstant(){return void 0!==_.timeout}}_.baseDuration=400,_.runningEvents=[],_.globalSpeedRatio=1},131208:(u,x,s)=>{s.d(x,{K:()=>J,Yi:()=>i,Zs:()=>L});var U=s(676617),_=s(204596),W=s(609859),c=s(515920),I=s(566911);function L(u,x,s){return new J(Array.isArray(u)?u:[u],x,s).play()}class J{constructor(u,x,s){this.totalAnimations=0,this.readyAnimations=0,this.speedRatio=1,this.settings=s,this.duration=x,(0||J.SkipAnimations)&&(this.duration=0),u.forEach((u=>{Object.keys(u.props).forEach((x=>{u.props[x]=_.jN(u.props[x])}))})),this.animate=u}play(){return I.K.isInstant()?(this.playImmediate(this.animate,this.settings),this):(this.create(this.animate,this.duration,this.settings),this)}stop(){var u,x;this.clearDelayAndAnimations(),null===(x=null===(u=this.settings)||void 0===u?void 0:u.onCancel)||void 0===x||x.call(u),this.destroy()}fastForward(){this.clearDelayAndAnimations(),this.setPropsImmediate(this.animate),this.onComplete()}setSpeedRatio(u){this.speedRatio=u,this.animations&&this.animations.forEach((u=>{u.animationStarted&&(u.speedRatio=this.speedRatio)}))}playImmediate(u,x){var s;null===(s=null==x?void 0:x.onStart)||void 0===s||s.call(x),this.setPropsImmediate(u),this.onComplete()}create(u,x,s){if(null==s?void 0:s.delay){const U=u[0].target.getScene();this.delay=new c.Gu(U,1e3*s.delay,(()=>{this.delay=void 0,this.onDelayReady(u,x,s)}))}else this.onDelayReady(u,x,s)}onDelayReady(u,x,s){x>0?this.animations=this.createAnimations(u,x,s||{}):this.playImmediate(u,s)}setPropsImmediate(u){const x=u.length;let s,U;for(let _=0;_<x;_++)if(s=u[_],U=s.target,Array.isArray(U))for(const u of U)this.setPropsToTarget(u,s.props);else this.setPropsToTarget(U,s.props)}setPropsToTarget(u,x){const s=Object.keys(x),U=s.length;let _,W;for(let c=0;c<U;c++)W=s[c],_=x[W],k(W,_,u)}clearDelayAndAnimations(){I.K.removeRunningEvent(this),this.delay?(this.delay.destroy(),this.delay=void 0):this.animations&&(this.animations.forEach((u=>{_.Ov(u,!1)})),this.animations=void 0)}onComplete(){var u,x;null===(x=null===(u=this.settings)||void 0===u?void 0:u.onComplete)||void 0===x||x.call(u),this.destroy()}destroy(){this.settings=void 0}createAnimations(u,x,s){return s.onStart&&s.onStart(),I.K.addRunningEvent(this),this.totalAnimations=u.length,this.readyAnimations=0,u.map((u=>{const U=u.target.getScene(),c=Object.keys(u.props).reduce(((U,c)=>{const I=u.props[c];(function(u,x){switch(u){case"alpha":case"beta":x[u]=W.$R(x[u])}})(c,u.target);const L=u.settings||{},J=(k=c,i=u.target,k.split(".").reduce(((u,x)=>u[x]),i));var k,i;const d=_.JI({prop:c,from:J,to:I,duration:x,easingFunc:L.easingFunc||s.easingFunc,easingMode:void 0!==L.easingMode?L.easingMode:s.easingMode,inTangent:L.inTangent||s.inTangent,outTangent:L.outTangent||s.outTangent});return U.push(d),U}),[]);return i(U.beginDirectAnimation(u.target,c,0,_.vu(c),!!s.loop,this.speedRatio,(()=>{this.readyAnimations++,this.readyAnimations>=this.totalAnimations&&(I.K.removeRunningEvent(this),this.onComplete())})),s.constantDelta)}))}}function k(u,x,s){const U=u.split("."),_=U.length;U.reduce(((u,s,U)=>(U===_-1&&(u[s]=x),u[s])),s)}function i(u,x){if(void 0!==x){const s=U.r.prototype._animate.bind(u);u.__animationTime=0,u._animate=()=>(u.__animationTime+=x,s(u.__animationTime))}return u}J.SkipAnimations=!1},599912:(u,x,s)=>{s.d(x,{$:()=>U});class U{constructor(u){this.tweens=[],this.isRunning=!1,this.settings=u}add(u){return this.isRunning||this.tweens.push(u),this}stop(){var u,x;this.isRunning&&(null===(x=null===(u=this.settings)||void 0===u?void 0:u.onCancel)||void 0===x||x.call(u)),this.isRunning=!1;for(const u of this.tweens)u.stop();this.destroy()}playTween(u){u.settings||(u.settings={});const x=u.settings.onComplete,s=u.settings.onCancel;u.settings.onComplete=()=>{null==x||x(),this.onTweenReady()},u.settings.onCancel=()=>{null==s||s(),this.onTweenReady()},u.play()}destroy(){this.tweens.length=0,this.settings=void 0}}},814566:(u,x,s)=>{s.d(x,{F:()=>W,h:()=>_});var U=s(599912);function _(u){return new W(u)}class W extends U.${constructor(){super(...arguments),this.currentTween=0}play(){return this.isRunning||(this.isRunning=!0,this.playTween(this.tweens[this.currentTween])),this}fastForward(){for(let u=this.currentTween;u<this.tweens.length;u++)this.tweens[u].fastForward()}onTweenReady(){var u,x;this.currentTween++,this.currentTween<this.tweens.length?this.playTween(this.tweens[this.currentTween]):this.isRunning&&(this.isRunning=!1,null===(x=null===(u=this.settings)||void 0===u?void 0:u.onComplete)||void 0===x||x.call(u),this.destroy())}}},272726:()=>{},557295:(u,x,s)=>{s.d(x,{C:()=>i,o:()=>U});var U,_=s(871539),W=s(340923),c=s(371020),I=s(948733),L=s(615473),J=s(898973),k=s(204596);function i(u,x,s,L){var i,r;const D=null!==(i=null==L?void 0:L.frameRate)&&void 0!==i?i:60,$=_.X5.ANIMATIONLOOPMODE_CYCLE,H=null!==(r=null==L?void 0:L.loop)&&void 0!==r&&r,f=u.map((u=>{const L=u.target,i=Object.keys(u.props).map((s=>{const U=function(u,x,s){const U=u[0],_=u[u.length-1];0!==U.percentage&&(void 0===U.percentage?U.percentage=0:u.unshift({value:x,percentage:0})),100!==_.percentage&&(void 0===_.percentage?_.percentage=100:s?u.push({value:u[0].value,percentage:100}):u.push({value:_.value,percentage:100}));const W=[];for(let x=0;x<=u.length-1;x++){const s=u[x];if(void 0!==s.percentage){if(W.length){const U=u[x-W.length-1].percentage,_=(s.percentage-U)/(W.length+1);for(let u=0;u<W.length;u++)W[u].percentage=U+(u+1)*_;W.length=0}}else W.push(s)}return u}(function(u,x){return u.map((u=>({...u,value:void 0!==u.value?u.value instanceof I.Pq?u.value.clone():u.value:x instanceof I.Pq?x.clone():x})))}(u.props[s],L[s]),L[s],H),i=k.td(U[0].value),r=new _.X5(`${s}-${J.S0.RandomId()}`,s,D,i,$),f=D*x,{keys:O,events:t}=function(u,x,s){const U=[],_=[];for(let x=0;x<u.length-1;x++){const I=x===u.length-2?-1:0,L=Math.floor(s*(u[x].percentage/100)),J=Math.floor(s*(u[x+1].percentage/100)),k=u[x].easeOut,i=u[x+1].easeIn,r=u[x].event,D=k||i;D&&(k&&i?D.setEasingMode(c.KA.EASINGMODE_EASEINOUT):k?D.setEasingMode(c.KA.EASINGMODE_EASEIN):D.setEasingMode(c.KA.EASINGMODE_EASEOUT));const $=d(u,x);for(let u=L;u<J;u++){const x=j(L,J+I,u,D);_.push({frame:u,value:$(x)})}if(r&&U.push(new W.p(L,r)),x===u.length-2){const s=u[x+1].event;s&&U.push(new W.p(J,s))}}return{keys:_,events:U}}(U,0,f);r.setKeys(O);for(const u of t)r.addEvent(u);return r}));let r=()=>{};return{promise:new Promise((x=>{const _=s.beginDirectAnimation(u.target,i,0,k.vu(i),H,1,(()=>x(U.AnimationFinished)));r=()=>{x(U.AnimationCancelled),_.stop()}})),stop:r}}));return{promise:new Promise((u=>{Promise.all(f.map((u=>u.promise))).then((x=>{u(x[0])}))})),stop:()=>f.forEach((u=>u.stop()))}}function d(u,x){if(u[x].shouldAddCurves&&r(u)){const s=u[x-1]?u[x-1].value:u[x].value,U=u[x].value,_=u[x+1].value,W=u[x+2]?u[x+2].value:u[x+1].value;return u=>I.Pq.CatmullRom(s,U,_,W,u)}return r(u)?s=>I.Pq.Lerp(u[x].value,u[x+1].value,s):s=>L.X.Lerp(u[x].value,u[x+1].value,s)}function j(u,x,s,U){const _=L.X.Normalize(s,u,x);return U?U.ease(_):_}function r(u){return u[0].value instanceof I.Pq}(function(u){u[u["AnimationFinished"]=0]="AnimationFinished",u[u["AnimationCancelled"]=1]="AnimationCancelled"})(U||(U={}))},734065:(u,x,s)=>{s.d(x,{H:()=>I});var U=s(212429),_=s(346160),W=s(15621),c=s(17495);function I(u){return()=>x=>s=>{if(!W.RM(s)){if(s.type===c.ZE&&u.resolve(),s.type===c.bO){const x=_.Tl(s.payload.errorId);u.reject(new U.LS(s.payload.errorId,x))}x(s)}}}},427377:(u,x,s)=>{s.d(x,{Y:()=>L});var U=s(277082),_=s(13799),W=s(973580),c=s(17495);function I(){return{}}function L(u){const x={setApp3DLoaded:c.uC,app3DError:c.tz},{selectors:{selectInitialGameState:s=I}={}}=u;return W.gv((x=>({transport3D:u.transport3D,factory:u.factory,skip3D:u.skip3D,automaticallyDisposeGame:u.automaticallyDisposeGame,preloadedGame3d:u.preloadedGame3d,dimensions:_.Ay(x),paused:_.TH(x),orientation:_.V6(x),initialState:s(x),iosNativeWrapper:_.uD(x).IS_IN_IOS_WEB_VIEW})),x)(U.Overlay3DComponent)}},869558:(u,x,s)=>{s.d(x,{S:()=>_});var U=s(85);function _(u,x,s){return U.I({...u,game:{...u.game,mockTransports:x,gameFamily:"rng"}})}},714806:(u,x,s)=>{var U;s.d(x,{Q:()=>U}),function(u){u["BrowserNotSupported"]="message.unsupportedBrowserAdvice",u["DeviceNotSupported"]="mobile.unsupportedDevice_short",u["AssetNotLoaded"]="message.unableLoadGame",u["SomethingWentWrong"]="message.unableLoadGame"}(U||(U={}))},300895:(u,x,s)=>{function U(u){var x;null===(x=window.EvoPerformanceMonitor)||void 0===x||x.registerEvent(u)}s.d(x,{_:()=>U})},63912:(u,x,s)=>{s.d(x,{F:()=>W});const U="data:audio/x-wav;base64,UklGRioAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQYAAAAAAAAAAAA=",_=800;function W(u=_){const x=new Audio(U),s=new Promise(((u,s)=>{x.addEventListener("play",_),x.addEventListener("error",W);const U=x.play();function _(){c(),u()}function W(){c(),s("Audio playback is not supported")}function c(){x.removeEventListener("play",_),x.removeEventListener("error",W)}"undefined"!=typeof Promise&&(U instanceof Promise||"function"==typeof U.then)&&U.then(_,W)})),W=new Promise(((x,s)=>{window.setTimeout(s,u)}));return Promise.race([W,s]).then((()=>!0),(()=>!1))}},540362:(u,x,s)=>{s.d(x,{U:()=>W});var U=s(300895);const _=3e3;function W({execute:u,taskName:x}){return s=>new Promise(((W,c)=>{const I=window.EVO_VERBOSE();I&&performance.mark(x),u(s,((...u)=>{if(I&&(performance.measure(x,x),performance.getEntriesByName)){const u=performance.getEntriesByName(x,"measure");if(u.length>0){const x=u[u.length-1];x.duration>_&&U._({category:x.name,startTime:x.startTime,duration:x.duration,text:x.name,color:"gray"})}}W(...u)}),c)}))}},465636:(u,x,s)=>{function U(u,x,s,_){return new Promise(((W,c)=>{const I=u[s];I?Array.isArray(I)?Promise.all(I.map((u=>u(x)))).then((c=>{let I={...x};for(const u of c)u&&(I={...I,...u});W(U(u,I,s+1,_))})).catch((u=>{c(u)})):I(x).then((c=>{const I=c?{...x,...c}:x;W(U(u,I,s+1,_))})).catch((u=>{c(u)})):W(x)}))}function _(u,x={},s){return U(u,x,0,s)}s.d(x,{e:()=>_})},692913:(u,x,s)=>{s.d(x,{P:()=>U});class U{constructor(u){this.unsubscribeFromTopicTo3D=new Map,this.unsubscribeFromTopicFrom3D=new Map,this.props=u}dispose(){this.tryUnsubscribe(),this.props=void 0}onMessageReceived(u){}subscribeOnMessagesTo3D(u){if(0===this.unsubscribeFromTopicTo3D.size)for(const x of Object.keys(u)){const s=u[x];if(void 0===s)continue;const U=this.props.transport3D.onMessageTo3dWorld(s,x);this.unsubscribeFromTopicTo3D.set(x,U)}}subscribeOnMessagesFrom3D(u){if(0===this.unsubscribeFromTopicFrom3D.size)for(const x of Object.keys(u)){const s=u[x];if(void 0===s)continue;const U=this.props.transport3D.onMessageFrom3dWorld(s,x);this.unsubscribeFromTopicFrom3D.set(x,U)}}listenToTransport3D(){this.tryUnsubscribe(),this.unsubscribe=this.props.transport3D.onMessageTo3dWorld(this.onMessageReceived)}tryUnsubscribe(){this.unsubscribeFromTopicTo3D.forEach((u=>u())),this.unsubscribeFromTopicTo3D.clear(),this.unsubscribeFromTopicFrom3D.forEach((u=>u())),this.unsubscribeFromTopicFrom3D.clear(),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)}}},170014:(u,x,s)=>{s.d(x,{o:()=>W});var U=s(93199),_=s(212429);function W(){const u=new U.Z,x={},s={};let W=!1;u.onEnd((()=>{W=!0}));const c=U=>{if(void 0===x[U]&&!W){const _=u.filter((u=>U===u.type));x[U]=_,_.onValue((u=>{s[U]=u}))}};return{notify:x=>{c(x.type);try{u.emit(x)}catch(u){}},dispose:()=>{var U;u.end();for(const u of Object.keys(x))null===(U=x[u])||void 0===U||U.end(),x[u]=void 0;for(const u of Object.keys(s))s[u]=void 0},getValue:u=>s[u],on:(u,U)=>{c(u);const W=x[u];if(!W)throw new _.gE(`Stream is disposed. Error during subscribing on the topic ${u}`);return null==W||W.onValue(U),void 0!==s[u]&&U(s[u]),()=>null==W?void 0:W.offValue(U)},subscribe:x=>(u.onValue(x),()=>u.offValue(x))}}},9533:(u,x,s)=>{s.d(x,{d:()=>_});var U=s(170014);function _(u){const x=[],s=[],_=U.o(),W=U.o();let c=!1;const I=()=>{for(c=!0;x.length>0;){const u=x.shift();u&&_.notify(u)}s.length>0&&L()},L=()=>{for(c=!0;s.length>0;){const u=s.shift();u&&W.notify(u)}x.length>0&&I()};return{onMessageFrom3dWorld:(u,x)=>x?W.on(x,u):W.subscribe(u),onMessageTo3dWorld:(u,x)=>x?_.on(x,u):_.subscribe(u),getValueTo3d:u=>_.getValue(u),getValueFrom3d:u=>W.getValue(u),sendFrom3dWorld:x=>{u.log&&console.log("[FROM]",x),s.push(x),c||(L(),c=!1)},sendTo3dWorld:s=>{u.log&&console.log("[TO]",s),x.push(s),c||(I(),c=!1)},dispose:()=>{W.dispose(),_.dispose(),x.length=0,s.length=0}}}},676330:(u,x,s)=>{function U(){return(u,x,s=0)=>new Promise((U=>{const _=[];if(_.push(u.onMessageFrom3dWorld((u=>{x(u)&&(_.forEach((u=>u())),_.length=0,U(u))}))),s){const u=window.setTimeout(U,s);_.push((()=>window.clearTimeout(u)))}}))}function _(){return(u,x,s)=>new Promise((U=>{const _=u.onMessageFrom3dWorld((u=>{s(u)&&(_(),U(u))}));u.sendTo3dWorld(x)}))}s.d(x,{Y:()=>U,_:()=>_})},204908:(u,x,s)=>{s.d(x,{z:()=>I});var U=s(64922),_=s(699695),W=s(377810),c=s(854236);const I=W.memo((({children:u,isMobile:x})=>U.jsx("tr",{"data-role":"bet-limits-footer",children:U.jsx("td",{colSpan:3,className:_.A(c.A.footerContentWrapper,{[c.A.mobile]:x}),children:u})})));I.displayName="BetLimitsAndPayoutsFooter"},712269:(u,x,s)=>{s.d(x,{q:()=>D});var U=s(64922),_=s(699695),W=s(377810),c=s(837557),I=s(653677),L=s(587698),J=s(346160),k=s(671860),i=s(509407),d=s(808432),j=s(29726),r=s(355087);const D=W.memo((u=>{const{betKey:x,betTitle:s,min:D,max:$,payout:H,isIndented:f=!1,areLimitsInlined:O,cards:t,middleComponent:V,hasBottomBorder:N=!0,isMobile:m=!1,currencySymbol:b="",fixedColumnWidths:n=!0,showPayouts:F=!0,isSectionHeader:B=!1,hasSectionPadding:Z=!1,disabled:v=!1,legacyMenuMode:y}=u,e=f&&Z,T=_.A({[r.A.indented]:!e&&(f||Z),[r.A.doubleIndented]:e}),Q=void 0===s&&x?U.jsx(I.q,{className:T,"data-role":"title",children:x}):U.jsx("span",{"data-role":"title",className:T,children:null!=s?s:String.fromCharCode(8203)}),E=W.useMemo((()=>{if(D&&$)return i.Q({lowerLimit:D,upperLimit:$,currencySymbol:b});const u=null!=D?D:$;return u?L.ej(u,{currencySymbol:b}):void 0}),[D,$,b]),l=W.useMemo((()=>null==t?void 0:t.map(((u,x)=>function(u,x){const s=u.slice(0,-1);let _=null;switch(u.slice(-1)){case"C":_=d.KY.C;break;case"D":_=d.KY.D;break;case"H":_=d.KY.H;break;case"S":_=d.KY.S}return"|"===u?U.jsx("span",{className:r.A.cardsDelimiter,children:u}):s&&null!==_?U.jsx(j.B,{rank:s,suit:_},x):null}(u,x)))),[t]),z=!!(s||x||E||l||V||H);return U.jsxs("tr",{"data-role":`bet-limits_${x}`,className:_.A({[r.A.mobile]:m,[r.A.disabled]:v,[r.A.hasContent]:z,[r.A.hasBottomBorder]:N,[r.A.fixedColumnWidths]:n,[r.A.hasNotch]:c.DS.HAS_NOTCH,[r.A.hasIncreasedNotch]:c.DS.IS_IPHONE14_PRO}),children:[U.jsx("td",{className:_.A(r.A.bet,{[r.A.bold]:!f&&!m,[r.A.topPadding]:O,[r.A.sectionHeader]:B}),colSpan:O?2:1,children:U.jsxs("div",{className:r.A.cellContent,children:[Q,O&&!!E&&U.jsxs("span",{className:r.A.betLimits,"data-min":D,"data-max":$,"data-role":"limits",children:[k.be,E]})]})}),!O&&U.jsx("td",{className:r.A.middleDataCell,children:U.jsx("div",{className:r.A.cellContent,children:l?U.jsxs("div",{"data-role":"ranks-and-suits",className:_.A(r.A.ranksAndSuits,{[r.A.mobileRanksAndSuits]:m}),children:[...l]}):V||!O&&U.jsx("div",{"data-role":"min-max",className:r.A.betLimits,"data-min":D,"data-max":$,children:E})})}),F&&U.jsx("td",{className:_.A(r.A.payout,{[r.A.topPadding]:O}),children:U.jsx("div",{className:_.A(r.A.cellContent,{[r.A.legacyMenuMode]:y,[r.A.rtl]:J.sU()}),"data-role":"payout",children:H})})]})}));D.displayName="BetLimitsAndPayoutsRow"},29726:(u,x,s)=>{s.d(x,{B:()=>J});var U=s(64922),_=s(377810),W=s(808432),c=s(525019),I=s(399074);function L(u,x,s,_){return U.jsx("use",{xlinkHref:u,x,y:s,height:_})}c.z();const J=_.memo((({rank:u,suit:x})=>{let s;switch(u){case"2":case"6":s="36";break;case"3":case"9":s="35";break;case"4":s="34";break;case"5":case"J":s="38";break;case"7":s="40";break;case"8":s="39";break;case"10":s="0";break;case"Q":case"A":s="19";break;default:s="17"}const _=[W.KY.D,W.KY.H].includes(x)?I.A.red:I.A.black,c=L(`#rank-${u}`,s,"10","86"),J=L(`#suit-${W.KY[x]}`,"100","0","106");return U.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 184 106",preserveAspectRatio:"xMidYMid meet",className:_,children:[c,J]})}));J.displayName="RankAndSuit"},296693:(u,x,s)=>{s.d(x,{e:()=>d});var U=s(64922),_=s(699695),W=s(377810),c=s(346160),I=s(509407),L=s(132006),J=s(25581),k=s(897899),i=s(744327);const d=({betMinLimit:u,betMaxLimit:x,currencySymbol:s,tableMinLimit:d,tableMaxLimit:j,tableName:r,tBodyComponent:D,preSection:$,areLimitsInlined:H=!1,hideTitle:f=!1,isTablet:O=!1,showPayouts:t,legacyMenuMode:V})=>{const N=W.useContext(L.lv),m=W.useMemo((()=>I.Q({lowerLimit:u,upperLimit:x,currencySymbol:s})),[u,x,s]),b=W.useMemo((()=>{if(j&&d)return I.Q({lowerLimit:d,upperLimit:j,currencySymbol:s})}),[d,j,s]);return U.jsxs(U.Fragment,{children:[U.jsx(J.y,{className:i.A.container,useMobileScrollable:!0,dataRole:V?void 0:"drawer-scrollable",hasContentFadeOut:!V,refCallback:null==N?void 0:N.assignScrollable,children:U.jsxs("div",{className:i.A.scrollContainer,children:[!f&&U.jsxs("div",{className:_.A(i.A.tableInfo,{[i.A.tablet]:O}),children:[U.jsxs("div",{children:[`${c.Tl("table")}: `,U.jsx("span",{className:i.A.tableName,children:r})]}),U.jsxs("div",{children:[U.jsx("span",{children:c.Tl("betlimits3")})," ",U.jsx("span",{className:i.A.limits,children:m})]}),!!b&&U.jsxs("div",{"data-role":"table-limits",children:[U.jsx("span",{children:c.Tl("tableLimits3")})," ",U.jsx("span",{className:i.A.limits,children:b})]})]}),$,U.jsxs("table",{className:i.A.table,children:[U.jsx(k.V,{isMobile:!0,areLimitsInlined:H,showPayouts:t,legacyMenuMode:V}),D]})]})}),V&&U.jsx("div",{className:_.A(i.A.shadow,{[i.A.tablet]:O})})]})};d.displayName="MobileBetLimitsAndPayoutsTable"},231369:(u,x,s)=>{s.d(x,{KN:()=>t,XQ:()=>f,_i:()=>O,fl:()=>V,s$:()=>H});var U=s(64922),_=s(699695),W=s(263601),c=s(377810),I=s(762923),L=s(670723),J=s(462566),k=s(460791),i=s(776326),d=s(975507),j=s(851275),r=s(911495);const D=1e3,$=2e3,H={base:i.oy,moving:i.A5,arrowsStyle:{...k.F,opacity:.42},pulseColor:"#BBB",labelAlpha:.9,labelAlpha:.14,labelFillStyle:"#FFF",pulseColor:"#BBB"};var f,O;(function(u){u[u["Circle"]=0]="Circle",u[u["Oval"]=1]="Oval"})(f||(f={})),function(u){u[u["Default"]=0]="Default",u[u["Hovered"]=1]="Hovered",u[u["Disabled"]=2]="Disabled"}(O||(O={}));class t extends c.PureComponent{constructor(){super(...arguments),this.state={hovered:!1,spinning:!1,pulsing:!1},this.spaceButtonElement=c.createRef(),this.registerSpacebarEvents=()=>{const{spinOnSpacebarPress:u,isMobile:x}=this.props;u&&!x&&(this.debouncedKeyDownHandler=W.A(this.keyDownHandler,300,{leading:!0,trailing:!1}),document.addEventListener("keydown",this.debouncedKeyDownHandler),document.addEventListener("keyup",this.keyUpHandler))},this.unregisterSpacebarEvents=()=>{const{spinOnSpacebarPress:u,isMobile:x}=this.props,s=this.debouncedKeyDownHandler;s&&u&&!x&&(document.removeEventListener("keydown",s),document.removeEventListener("keyup",this.keyUpHandler))},this.keyDownHandler=u=>{var x;if(!I.gN(u)||!L.lu())return;const{disabled:s}=this.props;s||null===(x=this.spaceButtonElement.current)||void 0===x||x.focus()},this.keyUpHandler=u=>{var x;I.gN(u)&&L.lu()&&(null===(x=this.spaceButtonElement.current)||void 0===x||x.blur(),this.triggerSpin(!0))},this.clickHandler=u=>{u.preventDefault(),u.currentTarget&&u.currentTarget.blur(),this.triggerSpin()},this.triggerSpin=u=>{if(this.spaceButtonElement.current){const{showTooltipOnClickIfDisabled:x,disabled:s,isMobile:U,showTooltip:_,onClick:W,onDisabledClick:c}=this.props;x&&s&&!U&&(null==_||_(!0)),s?null==c||c():W(u)}this.startPulseAnimationIfEnabled()},this.handlePointerDown=u=>{u.currentTarget&&u.currentTarget.blur()},this.handlePointerUp=u=>{u.preventDefault(),this.props.onPointerUp&&this.props.onPointerUp(u)},this.onPointerEnter=u=>{this.props.onPointerEnter&&this.props.onPointerEnter(u),this.props.disabled||(this.setState({hovered:!0}),this.props.playArrowsAnimationOnHover&&this.startSpinAnimationIfEnabled())},this.onPointerLeave=u=>{this.props.onPointerLeave&&this.props.onPointerLeave(u),this.setState({hovered:!1})}}componentDidMount(){this.props.skipInitialAnimation||this.startSpinAnimationIfEnabled(),this.registerSpacebarEvents()}componentDidUpdate(u){var x,s;this.props.skipArrowsAnimationOnButtonStateChange||this.props.disabled===u.disabled&&this.props.theme===u.theme||this.startSpinAnimationIfEnabled(),(null===(s=(x=this.props).forceHideTooltip)||void 0===s?void 0:s.call(x))&&this.forcedHideTooltip()}render(){const{isMobile:u,tooltipComponent:x=null,disabled:s=!1,style:W=f.Circle,theme:c,label:I,icon:L=null,IconComponent:J=null,useTimer:i=!1,useLabelCorrection:D=!0,hasSmallAspectRatio:$=!1,isLowPerformanceDevice:H,timerDuration:O,timerInitialProgress:t,role:V="button",scaleDisabled:N=!1,disablePulsing:m=!1,hideArrows:b=!1,activeArrowsRotateDisabled:n=!1,playArrowsAnimationOnHover:F=!1,calculateMultilineText:B=!1,syncDraw:Z=!0}=this.props,v=this.getButtonThemeState(c,s,this.state.hovered),{base:y,moving:e,arrowsStyle:T,labelFillStyle:Q,labelAlpha:E,pulseColor:l,useSparkles:z=!0}=v,S=U.jsx("span",{className:_.A(r.A.pulse,this.state.pulsing&&r.A.pulsing),style:{backgroundColor:l}}),R=W===f.Oval;let X={};R&&(T.baseOpacity=1,X={canvasMinWidth:250,fontSize:45,textAlignX:0});const p=I&&D&&this.getIsLabelCorrectionNeeded(I),G=I?U.jsx("div",{className:_.A(r.A.label,{[r.A.useLabelCorrection]:p,[r.A.circle]:W===f.Circle}),children:U.jsx(d.M,{label:I,fillStyle:Q,alpha:E,...X,...c.labelSettings,calculateMultilineText:B,syncDraw:Z})}):null,w=z?U.jsx("div",{className:_.A(r.A.sparks,{[r.A.lowPerformanceDevice]:H,[r.A.isMobile]:u,[r.A.oval]:R})}):null,h=i?U.jsx(j.a,{animationDurationMs:O,animationInitialProgress:t,isAnimated:!0}):null,P=U.jsx("span",{className:r.A.arrowsContainer,children:U.jsx("span",{className:r.A.arrows,children:U.jsx(k.O,{...T})})}),o=!F&&this.state.hovered&&!this.state.spinning&&!s;return U.jsxs("button",{ref:this.spaceButtonElement,tabIndex:-1,"data-role":V,className:_.A(r.A.multiButton,{[r.A.flipArrows]:c.useFlippedArrows,[r.A.oval]:R,[r.A.smallRimXPathLength]:u,[r.A.smallAspectRatio]:$,[r.A.hovered]:o,[r.A.spinning]:this.state.spinning,[r.A.pressed]:s,[r.A.disabled]:s,[r.A.scaleDisabled]:N,[r.A.arrowsRotateDisabled]:n}),onPointerDown:this.handlePointerDown,onPointerUp:this.handlePointerUp,onClick:this.clickHandler,onPointerEnter:this.onPointerEnter,onPointerLeave:this.onPointerLeave,children:[!m&&S,U.jsx(y,{}),!R&&U.jsx("span",{className:r.A.timer,children:h}),U.jsxs("span",{className:_.A(r.A.buttonInner,{[r.A.oval]:R,[r.A.smallRimXPathLength]:u,[r.A.smallAspectRatio]:$}),children:[e&&U.jsx(e,{}),w,R?U.jsxs("div",{className:r.A.contentContainer,children:[L&&!J?U.jsx("div",{className:r.A.icon,children:L}):P,U.jsx("div",{className:r.A.labelText,children:I})]}):U.jsxs(U.Fragment,{children:[!b&&P,b&&J&&U.jsx(J,{hovered:o}),G,!b&&!J&&L]})]}),x]})}componentWillUnmount(){window.clearInterval(this.pulseTimeoutId),window.clearInterval(this.spinTimeoutId),this.unregisterSpacebarEvents()}getButtonThemeState(u,x,s){const U=u[O.Hovered],_=u[O.Disabled];return x&&_?_:s&&U?U:u[O.Default]}startSpinAnimationIfEnabled(){this.props.disabled||this.state.spinning||(this.setState({spinning:!0}),this.spinTimeoutId=window.setTimeout((()=>{this.setState({spinning:!1}),this.spinTimeoutId=void 0}),$))}startPulseAnimationIfEnabled(){this.props.disabled||this.props.disablePulsing||this.state.pulsing||(this.setState({pulsing:!0}),this.pulseTimeoutId=window.setTimeout((()=>{this.setState({pulsing:!1}),this.pulseTimeoutId=void 0}),D))}getIsLabelCorrectionNeeded(u){for(const x of u)if(x===x.toUpperCase())return!0;return!1}forcedHideTooltip(){var u,x;null===(x=(u=this.props).hideTooltip)||void 0===x||x.call(u,!1)}}t.displayName="MultiButton";const V=J.u(t);V.displayName="MultiButtonWithTooltip"},460791:(u,x,s)=>{s.d(x,{F:()=>c,O:()=>I});var U=s(64922),_=s(377810),W=s(148999);const c={gradient1Color1:"#FFF",gradient1Color2:"#FFF",gradient2Color1:"#FFF",gradient2Color2:"#FFF",baseOpacity:.45,opacity:1},I=_.memo((({ns:u=W.MZ(),gradient1Color1:x=c.gradient1Color1,gradient1Color2:s=c.gradient1Color2,gradient2Color1:_=c.gradient2Color1,gradient2Color2:I=c.gradient2Color2,baseOpacity:L=c.baseOpacity,opacity:J=c.opacity})=>U.jsxs("svg",{viewBox:"0 0 260 260",style:{width:"100%",height:"100%"},children:[U.jsxs("defs",{children:[U.jsxs("linearGradient",{x1:"103.37%",y1:"81%",x2:"42.16%",y2:"36%",id:`${u}-spinArrowsLinearGradient-1`,children:[U.jsx("stop",{stopColor:x,stopOpacity:"0",offset:"0%"}),U.jsx("stop",{stopColor:s,stopOpacity:L,offset:"99.97%"})]}),U.jsx("path",{d:"M50.42 18L18 61.1l50.87 12.33-4.7-13.67c13.78-2.93 31.7.29 53.76 9.66 22.06 9.37 34.2 30.33 36.44 62.86 7.55-31.23.08-57.82-22.42-79.78-18.54-18.09-44.5-25.07-77.87-20.95L50.42 18z",id:"spinArrowsPath-2"}),U.jsxs("filter",{x:"-1.4%",y:"-0.9%",width:"102.9%",height:"103.5%",filterUnits:"objectBoundingBox",id:"spinArrows-filter-3",children:[U.jsx("feOffset",{dx:"0",dy:"1",in:"SourceAlpha",result:"shadowOffsetOuter1"}),U.jsx("feGaussianBlur",{stdDeviation:"0.5",in:"shadowOffsetOuter1",result:"shadowBlurOuter1"}),U.jsx("feComposite",{in:"shadowBlurOuter1",in2:"SourceAlpha",operator:"out",result:"shadowBlurOuter1"}),U.jsx("feColorMatrix",{values:"0 0 0 0 0   0 0 0 0 0  0 0 0 0 0  0 0 0 0.0419 0",type:"matrix",in:"shadowBlurOuter1"})]}),U.jsxs("linearGradient",{x1:"103.38%",y1:"83.26%",x2:"42.1%",y2:"35.54%",id:`${u}-spinArrowsLinearGradient-2`,children:[U.jsx("stop",{stopColor:_,stopOpacity:"0",offset:"0%"}),U.jsx("stop",{stopColor:I,stopOpacity:L,offset:"100%"})]}),U.jsx("path",{d:"M47.73 107.62l-28.39 40.32 47.7 16.28-4.7-13.67c13.78-2.94 31.7.28 53.76 9.66 22.06 9.37 34.2 30.32 36.44 62.86 7.56-31.23.09-57.83-22.4-79.78-18.55-18.1-44.5-25.08-77.88-20.96l-4.53-14.7z",id:"spinArrows-path-5"}),U.jsxs("filter",{x:"-2.2%",y:"-1.7%",width:"102.9%",height:"103.5%",filterUnits:"objectBoundingBox",id:"spinArrows-path-5",children:[U.jsx("feOffset",{dx:"-1",dy:"0",in:"SourceAlpha",result:"shadowOffsetOuter1"}),U.jsx("feGaussianBlur",{stdDeviation:"0.5",in:"shadowOffsetOuter1",result:"shadowBlurOuter1"}),U.jsx("feComposite",{in:"shadowBlurOuter1",in2:"SourceAlpha",operator:"out",result:"shadowBlurOuter1"}),U.jsx("feColorMatrix",{values:"0 0 0 0 0   0 0 0 0 0  0 0 0 0 0  0 0 0 0.0413 0",type:"matrix",in:"shadowBlurOuter1"})]})]}),U.jsxs("g",{transform:"translate(42.36, 12.44)",opacity:J,children:[U.jsx("g",{transform:"translate(87.61, 75.14) rotate(-17) translate(-87.61, -75.14)",children:U.jsx("use",{fill:`url(#${u}-spinArrowsLinearGradient-1)`,fillRule:"evenodd",xlinkHref:"#spinArrowsPath-2"})}),U.jsx("g",{transform:"translate(87.37, 165.35) rotate(-206) translate(-87.37, -165.35)",children:U.jsx("use",{fill:`url(#${u}-spinArrowsLinearGradient-2)`,fillRule:"evenodd",xlinkHref:"#spinArrows-path-5"})})]})]})));I.displayName="MultiButtonArrows"},776326:(u,x,s)=>{s.d(x,{A5:()=>j,gO:()=>J,oy:()=>i});var U=s(64922),_=s(718284),W=s(377810),c=s(297413),I=s(379014);const L={width:"100%",height:"100%",position:"absolute",left:0,top:0},J=_.A((u=>W.memo((function(){return U.jsx("div",{style:L,dangerouslySetInnerHTML:{__html:u}})})))),k=c.C2(),i=J(k),d=I.Rt(),j=J(d)},975507:(u,x,s)=>{s.d(x,{M:()=>L});var U=s(64922),_=s(377810),W=s(775286),c=s(99369);function I(u){return u||"bold"}class L extends _.PureComponent{constructor(){super(...arguments),this.canvasElement=_.createRef(),this.ctx=null,this.wordWidths=[],this.hasFont=!1,this.updateCanvas=(u=!1)=>{const x=this.ctx;if(x){if(u){const u=this.props.label.split(" ");this.hasFont&&this.props.fontName===L.defaultProps.fontName||(x.font=`${I(this.props.fontWeight)} ${this.props.fontSize}px ${this.props.fontName}, Arial, sans-serif`,this.hasFont=!0),this.wordWidths=u.map((u=>x.measureText(u).width))}L.drawLabelForContext(x,this.props,this.wordWidths,this.previousProps)}}}static drawLabelForContext(u,x,s,U){const _={...L.defaultProps,...x},{label:W,fontSize:J,fontName:k,canvasMinWidth:i,alpha:d,fillStyle:j,textAlignX:r,calculateMultilineText:D,syncDraw:$=!0,lineHeight:H,fontWeight:f}=_,O=W.split(" "),t=`${I(f)} ${J}px/1 ${k}, Arial, sans-serif`;let V=s;V||(u.font=t,V=O.map((x=>u.measureText(x).width)));let N=u.canvas.height,m=u.canvas.width,b=!1;if(!U||U&&!L.hasChangedStyleProps(U,_)){if(m=Math.max(...V,i),N=2*J*H,L.hasChangedLabelProps(_,U,["calculateMultilineText","label"])&&D){const x=c.W(u,W,m,J,J*H);m=x.width,N=x.height}u.canvas.height===N&&u.canvas.width===m||(b=!0,u.canvas.height=N,u.canvas.width=m)}const{width:n,height:F}=u.canvas;(b||L.hasChangedLabelProps(_,U,["fontName","fontSize"]))&&(u.font=t),u.textBaseline="middle",u.fillStyle=j,u.globalAlpha=d,u.shadowBlur=4,u.shadowOffsetY=4,u.shadowColor="rgba(0, 0, 0, 0.4)";const B=J*O.length,Z=(x=0)=>{if(x===O.length)return;const s=O[x];if(V){const U=V[x];u.fillText(s,null!==r?r:(m-U)/2,J*x+(J+N-B)/2),Z(x+1)}},v=()=>u.clearRect(0,0,n,F);if($)v(),Z();else{const u=requestAnimationFrame((()=>(v(),Z(),()=>cancelAnimationFrame(u))))}}static hasChangedStyleProps(u,x){return L.hasChangedLabelProps(x,u,["fillStyle","alpha"])&&u.label===x.label&&u.calculateMultilineText===x.calculateMultilineText&&u.fontSize===x.fontSize&&u.fontName===x.fontName&&u.canvasMinWidth===x.canvasMinWidth&&u.textAlignX===x.textAlignX}static hasChangedLabelProps(u,x,s){if(!x)return!0;for(const U of s){const s=x[U]!==u[U];if(s)return s}return!1}render(){return U.jsx("canvas",{ref:this.canvasElement,width:this.props.canvasMinWidth,height:this.props.fontSize/.375})}async componentDidMount(){this.storeContextLink(),this.updateCanvas(!0),this.loadFont()}componentDidUpdate(u){this.storeContextLink();const{label:x,fontName:s}=u;this.previousProps=u;const U=this.props.label!==x;this.updateCanvas(U),this.props.fontName!==s&&this.loadFont()}async loadFont(){try{await W.Al(this.props.fontName,I(this.props.fontWeight)),this.updateCanvas(!0)}catch(u){}}storeContextLink(){this.canvasElement.current&&(this.ctx=this.canvasElement.current.getContext("2d"))}}L.displayName="MultiButtonLabel",L.defaultProps={fontSize:110,fillStyle:"white",canvasMinWidth:300,alpha:1,textAlignX:null,fontName:"Inter",lineHeight:1}},851275:(u,x,s)=>{s.d(x,{a:()=>I});var U=s(64922),_=s(699695),W=s(451175);const c="toastProgressKeyframes",I=({isAnimated:u=!1,animationDurationMs:x=0,animationInitialProgress:s=0,rimShadowColor:I="rgba(19, 14, 2, 0.9)"})=>U.jsxs(U.Fragment,{children:[U.jsx("style",{children:J(L(s),c)}),U.jsxs("svg",{viewBox:"0 0 120 120",className:W.A.border,children:[U.jsxs("defs",{children:[U.jsxs("filter",{id:"inset-shadow",children:[U.jsx("feFlood",{floodColor:"black"}),U.jsx("feComposite",{operator:"out",in2:"SourceGraphic"}),U.jsx("feGaussianBlur",{stdDeviation:"2"}),U.jsx("feComposite",{operator:"atop",in2:"SourceGraphic"})]}),U.jsxs("linearGradient",{x1:"50%",y1:"0%",x2:"-9.99%",y2:"25.78%",id:"timerBorderBg1",children:[U.jsx("stop",{stopColor:"#7ED321",offset:"0%"}),U.jsx("stop",{stopColor:"#F8E71C",offset:"50%"}),U.jsx("stop",{stopColor:"#FF001F",offset:"100%"})]}),U.jsxs("linearGradient",{x1:"50%",y1:"0%",x2:"50%",y2:"100%",id:"timerBorderBg2",children:[U.jsx("stop",{stopColor:"#9F041B",offset:"0%"}),U.jsx("stop",{stopColor:"#F5515F",stopOpacity:"0",offset:"100%"})]})]}),U.jsxs("g",{fillRule:"nonzero",fill:"none",children:[U.jsx("path",{d:"M60 120A60 60 0 1 0 60 0a60 60 0 0 0 0 120zm0-10a50 50 0 1 1 0-100 50 50 0 0 1 0 100z",fill:"url(#timerBorderBg1)",filter:"url(#inset-shadow)"}),U.jsx("path",{d:"M60 0a60 60 0 1 0 0 120m0-10a50 50 0 1 1 0-100",fill:"url(#timerBorderBg2)",filter:"url(#inset-shadow)"}),U.jsx("circle",{className:_.A(W.A.progress),r:"45.8%",cy:"50%",cx:"50%",strokeWidth:"8.5%",fill:"none",transform:"rotate(-90 60 60)",stroke:I,style:u?{animationDuration:`${x}ms`,animationName:c,animationTimingFunction:"linear"}:{}})]})]})]});function L(u=0){return Math.min(Math.max(Number(u),0),100)}function J(u,x){const s=288,U=`\n        0% {\n            stroke-dashoffset: ${2*s-s*u/100}%;\n        }\n\n        100% {\n            stroke-dashoffset: ${s}%;\n        }\n    `;return`\n        @keyframes ${x} {${U}}\n        @-moz-keyframes ${x} {${U}}\n        @-o-keyframes ${x} {${U}}\n        @keyframes ${x} {${U}}\n    `}I.displayName="TimerBorder"},99369:(u,x,s)=>{function U(u,x,s,U,_){const W={width:0,height:_},c=" ",I=x.split(c),L=1===I.length&&1===I[0].length;let J="",k=0;for(let x=0;x<I.length;x++){const U=J+I[x]+(x+1===I.length?"":c),i=u.measureText(U).width;i>s?(W.width=s,W.height+=_,J=I[x]+c):(J=U,k=i),0!==x||L||(W.height*=1.5)}return L&&(k*=1.15),W.width=Math.max(k,W.width),W}s.d(x,{W:()=>U})},297413:(u,x,s)=>{s.d(x,{C2:()=>I,gR:()=>W,o4:()=>_,tx:()=>c,u:()=>U});const U={ns:"default",rimGradientColor1:"#525252",rimGradientColor2:"#6F6F6F",rimGradientColor3:"#D3D3D3",rimGradientColor4:"#7F7F7F",rimGradientColor5:"#9D9D9D",rimGradientColor6:"#8B8B8B",innerRimGradientColor1:"#9F9F9F",innerRimGradientColor2:"#787878",rimFlareGradientColor1:"#898989",rimFlareGradientColor2:"#737373",rimFlareGradientColor3:"#EEE",rimFlareGradientColor4:"#626262",rimFlareGradientColor5:"#5F5F5F"},_={ns:"goldenRim",rimGradientColor1:"#876A27",rimGradientColor2:"#EFC558",rimGradientColor3:"#F8E39B",rimGradientColor4:"#C49F44",rimGradientColor5:"#EFC759",rimGradientColor6:"#FFFCD5",innerRimGradientColor1:"#463508",innerRimGradientColor2:"#2F2304",rimFlareGradientColor1:"#D1B65F",rimFlareGradientColor2:"#DFB755",rimFlareGradientColor3:"#FFED8E",rimFlareGradientColor4:"#CFA043",rimFlareGradientColor5:"#9B7827"},W={..._,ns:"goldenRimHover",rimGradientColor3:"#FFF7D9",rimGradientColor6:"#FFFDE6",innerRimGradientColor1:"#8B6400",innerRimGradientColor2:"#6C4E00"},c={ns:"goldenDisabledRngRim",rimGradientColor1:"#876A27",rimGradientColor2:"#EFC558",rimGradientColor3:"#F8E39B",rimGradientColor4:"#C49F44",rimGradientColor5:"#EFC759",rimGradientColor6:"#FFFCD5",innerRimGradientColor1:"#111",innerRimGradientColor2:"#111",rimFlareGradientColor1:"#F8E39B",rimFlareGradientColor2:"#EFC558",rimFlareGradientColor3:"#F8E39B",rimFlareGradientColor4:"#EFC558",rimFlareGradientColor5:"#876A27"};function I(u=U){const x=0?0:Math.random(),s="M152.53 247.86C87.44 260.3 24.6 217.62 12.16 152.53-.28 87.44 42.4 24.6 107.48 12.16c65.1-12.44 127.94 30.24 140.38 95.32 12.44 65.1-30.24 127.94-95.33 140.38z";return`<svg viewBox="0 0 260 260" width="100%" height="100%">\n    <defs>\n        <linearGradient x1="50%" y1="100%" x2="50%" y2="0%" id="${u.ns}-rim-gradient-${x}">\n            <stop stop-color="${u.rimGradientColor1}" offset="0%"/>\n            <stop stop-color="${u.rimGradientColor2}" offset="29.99%"/>\n            <stop stop-color="${u.rimGradientColor3}" offset="46.19%"/>\n            <stop stop-color="${u.rimGradientColor4}" offset="63.9%"/>\n            <stop stop-color="${u.rimGradientColor5}" offset="87.03%"/>\n            <stop stop-color="${u.rimGradientColor6}" offset="100%"/>\n        </linearGradient>\n        <linearGradient x1="52.97%" y1="98.6%" x2="51.94%" y2="-1.87%" id="${u.ns}-gradient-d-${x}">\n            <stop stop-color="${u.innerRimGradientColor1}" offset="0%"/>\n            <stop stop-color="${u.innerRimGradientColor2}" offset="100%"/>\n        </linearGradient>\n        <linearGradient x1="52.31%" y1="100%" x2="48.44%" y2=".44%" id="${u.ns}-rim-flares-gradient-${x}">\n            <stop stop-color="${u.rimFlareGradientColor1}" offset="0%"/>\n            <stop stop-color="${u.rimFlareGradientColor2}" offset="25.79%"/>\n            <stop stop-color="${u.rimFlareGradientColor3}" offset="48.11%"/>\n            <stop stop-color="${u.rimFlareGradientColor4}" offset="72.17%"/>\n            <stop stop-color="${u.rimFlareGradientColor5}" offset="100%"/>\n        </linearGradient>\n        <filter x="-1.3%" y="-1.3%" width="102.5%" height="102.5%" filterUnits="objectBoundingBox" id="shadow-gradient-${x}">\n            <feGaussianBlur stdDeviation="1" in="SourceAlpha" result="shadowBlurInner1"/>\n            <feOffset in="shadowBlurInner1" result="shadowOffsetInner1"/>\n            <feComposite in="shadowOffsetInner1" in2="SourceAlpha" operator="arithmetic" k2="-1" k3="1" result="shadowInnerInner1"/>\n            <feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.6 0" in="shadowInnerInner1"/>\n        </filter>\n    </defs>\n    <g fill="none">\n        <circle r="50%" cy="50%" cx="50%" fill="url(#${u.ns}-rim-gradient-${x})" />\n        <path fill="url(#${u.ns}-gradient-d-${x})" d="${s}"/>\n        <path stroke="url(#${u.ns}-rim-flares-gradient-${x})" stroke-width="2" d="M152.72 248.84c-65.63 12.55-129-30.49-141.55-96.12-12.54-65.63 30.5-129 96.13-141.55 65.63-12.54 129 30.5 141.54 96.13 12.55 65.63-30.49 129-96.12 141.54z"/>\n        <path fill="#000" filter="url(#shadow-gradient-${x})" d="${s}"/>\n    </g>\n</svg>`}},379014:(u,x,s)=>{s.d(x,{F8:()=>k,Go:()=>L,Hw:()=>J,Ix:()=>I,KQ:()=>j,LE:()=>i,Rt:()=>r,Tn:()=>d,ag:()=>_,l2:()=>U,pB:()=>W,v1:()=>c});const U={ns:"default",movingPartHighlightColor:"#A2A2A2",movingPartBaseColor:"#525252",movingRimTopColor:"#4E4E4E",movingRimBottomColor:"#6B6B6B"},_={ns:"disabled",movingPartHighlightColor:"#2B2B2B",movingPartBaseColor:"#2B2B2B",movingRimTopColor:"#393939",movingRimBottomColor:"#242424"},W={ns:"green",movingPartHighlightColor:"#67FC48",movingPartBaseColor:"#108600",movingRimTopColor:"#35A10F",movingRimBottomColor:"#6AC328"},c={ns:"greenHover",movingPartHighlightColor:"#97FF81",movingPartBaseColor:"#16BE00",movingRimBottomColor:"#84EF35",movingRimTopColor:"#3FAD19"},I={ns:"blue",movingPartHighlightColor:"#48E4FC",movingPartBaseColor:"#005986",movingRimBottomColor:"#287BC3",movingRimTopColor:"#0F6DA1"},L={ns:"blueHover",movingPartHighlightColor:"#88EFFF",movingPartBaseColor:"#0090D8",movingRimBottomColor:"#65B7FF",movingRimTopColor:"#2A8FC6"},J={ns:"silver",movingPartHighlightColor:"#BBBBBB",movingPartBaseColor:"#606060",movingRimBottomColor:"#A8A8A8",movingRimTopColor:"#ACACAC"},k={ns:"silverHover",movingPartHighlightColor:"#CDCDCD",movingPartBaseColor:"#8A8A8A",movingRimBottomColor:"#D7D7D7",movingRimTopColor:"#DED7D7"},i={ns:"golden",movingPartHighlightColor:"#FAEDB2",movingPartBaseColor:"#94762D",movingRimBottomColor:"#FBEDB1",movingRimTopColor:"#93742D"},d={ns:"goldenHover",movingPartHighlightColor:"#FFF8D9",movingPartBaseColor:"#BD9A47",movingRimBottomColor:"#FBEDB1",movingRimTopColor:"#93742D"},j={ns:"disabledRng",movingPartHighlightColor:"#1D1D1D",movingPartBaseColor:"#252525",movingRimBottomColor:"#1E1D1A",movingRimTopColor:"#3D3D3D"};function r(u=U,x=!1){const s=0?0:Math.random();return`<svg viewBox="0 0 260 260" width="100%" height="100%">\n    <defs>\n        <radialGradient cy="32.06%" fx="50%" fy="32.06%" r="57.34%" id="${u.ns}-gradient-k-${s}">\n            <stop stop-color="${u.movingPartHighlightColor}" offset="0%"/>\n            <stop stop-color="${u.movingPartBaseColor}" offset="100%"/>\n        </radialGradient>\n        <linearGradient x1="50%" y1="100%" x2="50%" y2=".39%" id="${u.ns}-gradient-j-${s}">\n            <stop stop-color="${u.movingRimBottomColor}" offset="0%"/>\n            <stop stop-color="${u.movingRimTopColor}" offset="100%"/>\n        </linearGradient>\n        <path d="M152.53 247.86C87.44 260.3 24.6 217.62 12.16 152.53-.28 87.44 42.4 24.6 107.48 12.16c65.1-12.44 127.94 30.24 140.38 95.32 12.44 65.1-30.24 127.94-95.33 140.38z" id="shape-c-${s}"/>\n        <path d="M151.1 240.41c-60.97 11.66-119.84-28.33-131.5-89.3C7.95 90.13 47.93 31.26 108.9 19.6c60.98-11.66 119.86 28.32 131.51 89.3 11.66 60.97-28.33 119.85-89.3 131.5z" id="shape-i-${s}"/>\n        <linearGradient x1="50%" y1="0%" x2="50%" y2="56.26%" id="gradient-l-${s}">\n            <stop stop-color="#FFF" stop-opacity=".7" offset="0%"/>\n            <stop stop-color="#FFF" stop-opacity="0" offset="100%"/>\n        </linearGradient>\n        <linearGradient x1="-23.75%" y1="-19.59%" x2="135.61%" y2="83.68%" id="gradient-m-${s}">\n            <stop stop-color="#FFF" offset="0%"/>\n            <stop stop-color="#FFF" stop-opacity=".61" offset="10.1%"/>\n            <stop stop-color="#FFF" stop-opacity=".73" offset="19.41%"/>\n            <stop stop-color="#FFF" stop-opacity="0" offset="28.13%"/>\n            <stop stop-color="#FFF" stop-opacity="0" offset="74.17%"/>\n            <stop stop-color="#FFF" offset="100%"/>\n        </linearGradient>\n        <filter x="-2.1%" y="-2.1%" width="104.2%" height="104.2%" filterUnits="objectBoundingBox" id="gradient-n-${s}">\n            <feGaussianBlur stdDeviation="1" in="SourceGraphic"/>\n        </filter>\n    </defs>\n    <g fill="none" fill-rule="evenodd">\n        <mask id="gradient-g-${s}" fill="#fff"><use xlink:href="#shape-c-${s}"/></mask>\n        <path d="M230.26 129.77c0 55.5-45 100.49-100.49 100.49-55.5 0-100.49-45-100.49-100.49 0-55.5 45-100.49 100.49-100.49a100.49 100.49 0 0 1 100.49 100.49z" fill="url(#${u.ns}-gradient-b-${s})" mask="url(#gradient-g-${s})"/>\n        <g fill-rule="nonzero" mask="url(#gradient-g-${s})">\n            <path stroke="url(#${u.ns}-gradient-j-${s})" stroke-width="2.8" d="M150.85 239.04c60.21-11.51 99.7-69.66 88.19-129.87-11.51-60.21-69.66-99.7-129.87-88.2-60.21 11.52-99.7 69.66-88.2 129.88 11.52 60.21 69.66 99.7 129.88 88.19z" stroke-linejoin="square" fill="url(#${u.ns}-gradient-k-${s})" fill-rule="evenodd"/>\n        </g>\n        ${x?"":`<path d="M125.29 144.76c70.8-17.43 106.66 39.87 106.66-16.36S186.37 26.6 130.14 26.6C73.9 26.6 28.33 72.16 28.33 128.4s26.15 33.8 96.96 16.36z" fill="url(#gradient-l-${s})" opacity=".8" mask="url(#gradient-g-${s})"/>`}\n        ${x?"":`<circle stroke="url(#gradient-m-${s})" stroke-width="2" filter="url(#gradient-n-${s})" mask="url(#gradient-g-${s})" cx="130.5" cy="130.5" r="95.5"/>`}\n    </g>\n</svg>`}},561143:(u,x,s)=>{s.d(x,{B:()=>r});var U=s(64922),_=s(699695),W=s(377810),c=s(714806),I=s(837557),L=s(993738);const J="container--092a4",k="allowPointerEvents--4d997",i="canvas--bf275",d="game-3D-canvas",j="game-3D-canvas";class r extends W.Component{constructor(){super(...arguments),this.resizeAfterAnimationFrame=()=>{window.requestAnimationFrame(this.resize)},this.resize=()=>{var u;null===(u=this.game)||void 0===u||u.resize(this.props.dimensions)},this.refCanvasContainer=u=>{const{preloadedGame3d:x}=this.props;!this.canvas&&x&&(this.props.skip3D?this.props.setApp3DLoaded():u&&x.then((x=>{x.canvas&&(this.canvas=x.canvas,this.canvas.setAttribute("key",d),this.canvas.setAttribute("data-role",j),this.canvas.className=i,u.appendChild(this.canvas)),this.onGame3dLoad(x)})).catch(this.onGame3dLoadError))},this.refCanvas=u=>{const x=this.factoryProps();!this.canvas&&x&&(this.props.skip3D?this.props.setApp3DLoaded():(this.canvas=u,x.factory({canvas:this.canvas,DS:I.DS,transport3D:x.transport3D,initialState:x.initialState,orientation:this.props.orientation}).then(this.onGame3dLoad).catch(this.onGame3dLoadError)))},this.onGame3dLoad=u=>{this.game=u,this.game.setOrientation(this.props.orientation),this.game.resize(this.props.dimensions),this.game.setPaused(this.props.paused),this.props.setApp3DLoaded(),this.setEventListeners()},this.onGame3dLoadError=u=>{this.props.app3DError({errorId:(null==u?void 0:u.errorId)||c.Q.SomethingWentWrong})}}shouldComponentUpdate(u){return!this.canvas||u.dimensions.width!==this.props.dimensions.width||u.dimensions.height!==this.props.dimensions.height||u.dimensions.containerHeight!==this.props.dimensions.containerHeight||u.orientation!==this.props.orientation||u.paused!==this.props.paused||u.allowPointerEvents!==this.props.allowPointerEvents}componentWillUnmount(){document.removeEventListener(L.Dd,this.resizeAfterAnimationFrame);const{automaticallyDisposeGame:u=!0}=this.props;this.game&&u&&this.game.dispose()}componentDidUpdate(u){this.game&&(this.props.orientation!==u.orientation&&this.game.setOrientation(this.props.orientation),u.dimensions.width===this.props.dimensions.width&&u.dimensions.height===this.props.dimensions.height&&this.props.orientation===u.orientation&&this.props.dimensions.containerHeight===u.dimensions.containerHeight||(this.props.iosNativeWrapper?this.resizeAfterAnimationFrame():this.resize()),this.props.paused!==u.paused&&this.game.setPaused(this.props.paused))}render(){if(!this.props.preloadedGame3d&&!this.factoryProps())return null;const u=!this.props.preloadedGame3d,{allowPointerEvents:x=!0,zIndex:s}=this.props;return U.jsxs("div",{className:_.A(J,{[k]:x}),style:{zIndex:s},ref:this.refCanvasContainer,children:[u&&U.jsx("canvas",{"data-role":j,className:i,ref:this.refCanvas},d),this.props.children]})}setEventListeners(){document.addEventListener(L.Dd,this.resizeAfterAnimationFrame)}factoryProps(){if(this.props.factory&&this.props.transport3D&&this.props.initialState)return{factory:this.props.factory,transport3D:this.props.transport3D,initialState:this.props.initialState}}}r.displayName="Overlay3DComponent"},600686:(u,x,s)=>{s.d(x,{pb:()=>l});var U=s(64922),_=s(699695),W=s(377810),c=s(680151),I=s(886490),L=s(328382),J=s(822381),k=s(872197),i=s(426782),d=s(306335),j=s(730375),r=s(963340),D=s(874965),$=s(422906),H=s(129517);const f=[];let O;const t=2.5,V=2*Math.PI,N=Math.PI/180,m=1200,b=300,n=400,F=150,B=18,Z=800,v=400,y=200,e=4,T=.25,Q=40,E=10;class l extends W.Component{constructor(u){super(u),this.canvasScale=1,this.coins=[],this.particles=[],this.stars=[],this.width=0,this.height=0,this.coinSize=0,this.updateTime=0,this.coinCount=0,this.starCount=0,this.isComponentMounted=!1,this.animationFrameRequestId=0,this.updateSizeDependantValues=()=>{if(!this.canvas||!this.ctx)return this.handleMountingException();const{width:u,height:x}=this.canvas.getBoundingClientRect();this.width=u,this.canvas.width=u,this.height=x,this.canvas.height=x,this.canvasScale=Math.round(this.width/Z*1e3)/1e3,this.coinSize=B*this.canvasScale,this.coinGradient=this.ctx.createLinearGradient(-this.coinSize,0,this.coinSize,0),this.coinGradient.addColorStop(.02,"#DE8A25"),this.coinGradient.addColorStop(.18,"#FED049"),this.coinGradient.addColorStop(.26,"#FBDA78"),this.coinGradient.addColorStop(.38,"#F8E8BF"),this.coinGradient.addColorStop(.4,"#F7E8B9"),this.coinGradient.addColorStop(.43,"#F7E8A9"),this.coinGradient.addColorStop(.47,"#F7E88F"),this.coinGradient.addColorStop(.48,"#F7E887"),this.coinGradient.addColorStop(.51,"#F7E581"),this.coinGradient.addColorStop(.55,"#F7DE71"),this.coinGradient.addColorStop(.6,"#F6D358"),this.coinGradient.addColorStop(.65,"#F5C239"),this.coinGradient.addColorStop(1,"#DA8022"),this.coinEdgeGradient=this.ctx.createLinearGradient(-this.coinSize,0,this.coinSize,0),this.coinEdgeGradient.addColorStop(0,"#794200"),this.coinEdgeGradient.addColorStop(.42,"#FFB40F"),this.coinEdgeGradient.addColorStop(.58,"#FFE2A3"),this.coinEdgeGradient.addColorStop(.73,"#FFB000"),this.coinEdgeGradient.addColorStop(1,"#936724")},this.renderFrame=()=>{const u=performance.now()/1e3;this.update(u-this.updateTime),this.updateTime=u,this.animationFrameRequestId=window.requestAnimationFrame(this.renderFrame)},this.drawMirrorImage=(u,x)=>{u.width<1||(x.save(),x.translate(Z*this.canvasScale,0),x.scale(-1,1),x.drawImage(u,0,0),x.restore())},this.drawStars=(u,x)=>{for(let s=0;s<this.starCount;s++)x.save(),this.updateStar(u,this.stars[s]),x.restore()},this.drawCoins=(u,x)=>{for(let s=0;s<this.coinCount;s++)x.save(),this.updateCoin(u,this.coins[s]),x.restore()},this.drawParticles=(u,x)=>{for(const s of this.particles)x.save(),this.updateParticle(u,s),x.restore()},this.drawEllipse=(u,x)=>{if(!this.ctx)return this.handleMountingException();this.ctx.ellipse?this.ctx.ellipse(0,u*this.canvasScale,this.coinSize,x,0,0,V):(this.ctx.save(),this.ctx.translate(0,u*this.canvasScale),this.ctx.scale(this.coinSize,x),this.ctx.arc(0,0,1,0,V,!1),this.ctx.restore())},this.setCanvas=this.setCanvas.bind(this),this.coinCount=u.useLiteRenderMode?15:Q,this.starCount=u.useLiteRenderMode?8:E}componentDidMount(){this.isComponentMounted=!0;const{displayStars:u,displayCoins:x}=this.props;if(!u)return null;if(this.updateTime=performance.now()/1e3,!this.canvas)return this.handleMountingException();const s=this.canvas.getContext("2d");if(!s)return c.M("Canvas context is empty");this.ctx=s,O||(O=[d,j,r,D,$,H].map(((u,x)=>new Promise((s=>{const U=new Image;0||(U.onload=()=>s()),U.onerror=()=>s(),U.src=u,f[x]=U}))))),I.w9(this.updateSizeDependantValues),this.updateSizeDependantValues();const U=(Z-y)/2/t,_=Z/2,W=v/2;if(x)for(let u=0;u<this.coinCount;u++){const x=W+(Math.random()>.5?1:-1)*Math.random()*v*.05,s=360*Math.random(),c=360*Math.random(),I=Math.random()*(n-b)+b,L=U*(.5*Math.random()+.5);let J,k,i,d=Math.random()*Z*.15;u%2?(d+=_+y/2,J=(Z-d)/L,x<W?(i=(-90+90*Math.random())*N,k=x/L):(k=(v-x)/L,i=90*Math.random()*N)):(d=_-y/2-d,J=d/L,x<W?(k=x/L,i=(180+90*Math.random())*N):(k=(v-x)/L,i=(90+90*Math.random())*N));const j=Math.min(J,k),r=m/j;this.coins.push({flipCount:0,lifeTime:0,x:d,y:x,flipDegrees:s,rotationOffset:c,distance:m,movementAngle:i,speedZ:r,speedXY:L,moveTime:j,flipSpeed:I})}for(let u=0;u<this.starCount;u++){const x=W+(Math.random()>.5?1:-1)*Math.random()*v*.15;let s=Math.random()*Z*.2;u%2?s+=_+y/2:s=_-y/2-s;const U=360*Math.random(),c=u<this.starCount/2?.5*Math.random()+.5:1*Math.random()+1,I=u<this.starCount/2?0:Math.random()*t*T,L=.3*Math.random()*t+.7*t;this.stars.push({x:s,y:x,lifeTime:0,scale:c,rotation:U,delay:I,animationTime:L,img:f[5]})}this.particles=[{x:.35*Z,y:.47*v,lifeTime:0,animationTime:1.1,img:f[0],scale:.6},{x:.335*Z,y:.54*v,lifeTime:0,animationTime:1.2,img:f[0],scale:.67},{x:.29*Z,y:.33*v,lifeTime:0,animationTime:1.3,img:f[0],scale:1.35},{x:.26*Z,y:.38*v,lifeTime:0,animationTime:1.2,img:f[0],scale:.7},{x:.245*Z,y:.44*v,lifeTime:0,animationTime:1.1,img:f[0],scale:.7},{x:.28*Z,y:.5*v,lifeTime:0,animationTime:1.1,img:f[0],scale:.7},{x:.26*Z,y:.55*v,lifeTime:0,animationTime:1.2,img:f[0],scale:1},{x:.21*Z,y:.33*v,lifeTime:0,animationTime:1.1,img:f[0],scale:.7},{x:.17*Z,y:.36*v,lifeTime:0,animationTime:1.2,img:f[0],scale:.7},{x:.18*Z,y:.51*v,lifeTime:0,animationTime:1.1,img:f[0],scale:1},{x:.15*Z,y:.3*v,lifeTime:0,animationTime:1.1,img:f[4],scale:1.3},{x:.19*Z,y:.455*v,lifeTime:0,animationTime:1.1,img:f[3],scale:1.35},{x:.205*Z,y:.41*v,lifeTime:0,animationTime:1.1,img:f[2],scale:1.3},{x:.26*Z,y:.29*v,lifeTime:0,animationTime:1.1,img:f[1],scale:1.3}],Promise.all(O).then((()=>{this.isComponentMounted&&(this.animationFrameRequestId=window.requestAnimationFrame(this.renderFrame))}))}componentWillUnmount(){this.isComponentMounted=!1,window.cancelAnimationFrame(this.animationFrameRequestId),I.Fu(this.updateSizeDependantValues)}render(){const{maxSizeFull:u,useMediaContainer:x,scale:s,displayStars:W}=this.props;if(!W)return null;const c=_.A(i.A.container,{[i.A.maxSizeFull]:u,[i.A.useMediaContainer]:x}),I=s||l.defaultProps.scale,k=Z/L.SG*I,d=v/L.SG*I;return U.jsx("canvas",{className:c,ref:this.setCanvas,"data-role":"coins-and-stars",style:{width:J.o1(k),height:J.o1(d)}})}setCanvas(u){u&&(this.canvas=u)}update(u){if(!this.canvas||!this.ctx)return this.handleMountingException();const{useLiteRenderMode:x,displayCoins:s,displayStars:U}=this.props;this.ctx.clearRect(0,0,this.width,this.height),U&&(this.drawParticles(u,this.ctx),x||this.drawMirrorImage(this.canvas,this.ctx),this.drawStars(u,this.ctx),s&&this.drawCoins(u,this.ctx),x&&this.drawMirrorImage(this.canvas,this.ctx))}updateCoin(u,x){if(x.lifeTime+=u,x.lifeTime>x.moveTime)return;x.flipDegrees+=Math.floor(x.flipSpeed*u),x.distance-=Math.floor(x.speedZ*u);const s=x.speedXY*u;x.x+=s*Math.cos(x.movementAngle),x.y+=s*Math.sin(x.movementAngle);const U=Math.min((m-x.distance)/m,1);if(!this.ctx||!this.coinEdgeGradient||!this.coinGradient)return this.handleMountingException();const{useLiteRenderMode:_}=this.props;if(!_){const u=k.X0(x.lifeTime,x.moveTime);if(0===u)return;u<1&&(this.ctx.globalAlpha=u)}const W=Math.floor(x.flipDegrees)%90?x.flipDegrees:x.flipDegrees+1;let c=Math.abs(Math.sin(W*N))*this.coinSize;c=Math.round(1e3*c)/1e3,this.ctx.translate(this.canvasScale*x.x,this.canvasScale*x.y),this.ctx.rotate((x.rotationOffset+W)/2*N),this.ctx.scale(this.canvasScale*U,this.canvasScale*U);const I=1-c/this.coinSize;if(this.ctx.beginPath(),this.ctx.fillStyle=_?"#FBDA78":this.coinEdgeGradient,!_){let u=-e;for(;u<=e;)this.drawEllipse(U*u*I*this.canvasScale,c),u+=T}this.ctx.fill(),this.ctx.beginPath(),_||(this.ctx.fillStyle=this.coinGradient);const L=x.flipCount%2?1:-1;this.drawEllipse(U*e*I*L,c),this.ctx.fill(),x.flipCount=Math.max(Math.floor(W/90),x.flipCount)}updateParticle(u,x){x.lifeTime+=u;const s=k.WD(x.lifeTime,x.animationTime);if(!s)return;if(!this.ctx)return this.handleMountingException();const U=x.scale*x.img.width*this.canvasScale,_=x.scale*x.img.height*this.canvasScale;this.ctx.globalAlpha=s,this.ctx.translate(x.x*this.canvasScale,x.y*this.canvasScale),this.ctx.drawImage(x.img,0,0,U,_)}updateStar(u,x){if(x.delay>0)return void(x.delay-=u);x.lifeTime+=u,x.rotation+=F*u;const s=k.WD(x.lifeTime,x.animationTime);if(!s)return;if(!this.ctx)return this.handleMountingException();const U=x.scale*k.zS(x.lifeTime,x.animationTime),_=U*x.img.width*this.canvasScale,W=U*x.img.height*this.canvasScale,c=_/2,I=W/2;this.ctx.globalAlpha=s,this.ctx.translate(x.x*this.canvasScale-c,x.y*this.canvasScale-I),this.ctx.translate(c,I),this.ctx.rotate(x.rotation*N),this.ctx.drawImage(x.img,-c,-I,_,W)}handleMountingException(){return c.M("Trying to access context before it was mounted")}}l.displayName="CoinsAndStars",l.defaultProps={displayCoins:!0,displayStars:!0,maxSizeFull:!1,useMediaContainer:!1,scale:1,useLiteRenderMode:!1}},872197:(u,x,s)=>{s.d(x,{D0:()=>I,WD:()=>W,X0:()=>_,il:()=>L,zS:()=>c});var U=s(981298);function _(u,x){const s=.7*x,U=.9*x;let _=1;if(u>s)if(u<U){const x=u-s;_=Math.max(1-x/(U-s),0)}else _=0;return _}function W(u,x){let s;const U=.3*x,_=.7*x;return s=u<U?u/U:u<_?1:Math.max(1-(u-_)/U,0),s}function c(u,x){let s=1;const U=.2*x;return u<U&&(s=u/U),s}function I(u){return u===U.R.Medium||u===U.R.Big}function L(u){return u===U.R.Big}},306335:u=>{u.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAMAAABF0y+mAAAASFBMVEW+mwAAAAChfAC8lgDDnwDFngDJowC1jADLpADIogDHoQDNpgDMpQDIogDKowDGoADLpQDMpQDLpADMpgDLpADLpQDMpgDNpwA8whaAAAAAGHRSTlMWAAYRHCA0DEctJG9PODAnWFI/XTpjYWWZkBniAAAA8ElEQVQoz53SV27DMBAE0PU29mYpzv1vGsqOiikhATx/xAMXIHfg9kd2RAMsAmTwhMhqrb33JE/4hghzs06YgaVoEnNAlBYdwxpJjjZEP1kPW4jYZbMiT1bgGALnzAsp1n5vUBVcEF3IMCKJmgWpNoGTQhbsKEHhjORzR9RQ4EJZTUf7JVcICjcwceJP8J+xmIK/Qk7Un1KCXqFX7AiPyFdT/YI4BwenyEzPj+epymicPD4RXbAyWFbzu0+TBmVdhi740up4o3KfAQ8FKzVE9cIs3t1tprdqIrn2/agtxmYV9mrunS5Zc2EaSr0Ge47nH/PICJioE/XSAAAAAElFTkSuQmCC"},730375:u=>{u.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFMAAABDCAMAAADXusmpAAAAmVBMVEUAAAAuLgDJyR/u3T3t5UXw4D3h0S6qqiuAgAD254f26Gnr4Tjp3Tjl1zba1y/253ry5lvy5Uzw5knv5FDu4kT79dX36p/3547154H26Hv16HD152X052H89+D57a747Kn254v16HX052zz5lv05VHy5E+ZmQD8+en58b3366P37Kf255T27Kr255T05mvz51vy5Wn05lX///8KzdSXAAAAMnRSTlMAAgkdJiAQBgSjbBkWEw2HSzozLyrkv7OWj3lkX+3Jxq2CdFJDOAXy1MG5tq6KclROSOzvFrEAAAElSURBVFjD7dTXboNAEAXQu4WlFxtsU1zjkt74/4/Lgx9ASsAYJiKR9zztSqPVzmh0MQqfgxxj0LT+PhmosZnAr+MgZ73i74gsULNWEuRYhxJPgdokywVonYrVeoIeAtto/meaG33myDeyudT10UW8nIIY391nCgN5AnVWMXc4Bko3AeoCqTBUHDE04AbIfcxcUFNH1rhv5ORcgZoIObT/yJRTcV6yfA8iyW7hnMPDvgMNdngs7Rg9NSRsEj6/CfS0/rk1M5kYDD1Z0LQbZz5wVJ4SUJCocVl19lxQ8+ytgctOyqwufHlAG3cxlx1GF4X7anj+bMvRxpBduklLW1QJFcXfn/FxJV4sHIU2LxmuFUj/QoEJTRvZ0REgxsLyHdSmjsCIvgA08QtzF1artgAAAABJRU5ErkJggg=="},963340:u=>{u.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGkAAABTCAMAAACrvdnDAAAAz1BMVEUAAACMjARVVQDa1i3w4UEAAACqqivt3T28vCXj1Svv3z/z6F7z6FXz51Pv5Eng0Tr57a3z5k3x5Unu40fr4Tj26Iv154H153D26Gr06F7z5lry5WDs40D365325of253n153L16G315mf05lT05VTt4ULw5EXo3DrS0i359M/48Lr57rL255T16HT154b152Py5Evw5Fb8+uz8+OT79tz58cL58sL255L37bH26Hz26Hz366X154bn2zf79dX58sn47p705Xbz51Px43n///+3xuR8AAAARHRSTlMABAMNIQIGHAcSH1VLQS8QyT00LBitmnpvWlFOJ72ki351Z0ZEKiUWC+DSzLeDZ2I3M/Xv6djRr6aSkXt7FOTc0EU/N0kQ5+4AAAIASURBVGje7dVnj+IwEAbg13acTkIJvXdY4IBtt/Xq/v/fdFpOOkVREiAKwx6b51OkyGPZM57Bp2DZIPKli4tl9G3QKH2rMJDgozE+CG0CGrycN0CjOeA4LaYgJbzjII74ml6XKOGyFUFEPuBkxtiH/c1mEYCZE0jsN/ZQfLW3um3gSByJ1DtH5/H5Q1S2AirPLaRKSBBhs7Ncn8r9p30rBf4OkArhwl0NdP+Zgm9giiQagSHtdR9Nc97WkA72apqu3H3d1wLdKH+/UXNbjjiqJn3BPCNmbA7X9YInd4tYIIjdENinmc/hn8JT1UQEY9RtL6ubGQ5hluJ3Ugc3iwIiaPXl9W3HNnCI/o8hdnq+NukrGFmo9BRE8Kzy/K4ydBFUC1nSvLOwIwF4nZBcaFNEEcVa5XE9VhHkhqRIar5M6lscx3BGuZYABV0IhmReQEXiP8RA5cECEc5xRoyDBG/ZBQMnJaZ459Xy5RzDKb20d7emPF0vGjrCaBKpeFXwzrUqPQdh9BsbqTJaJkMYWZohk7lkKqOaVOUu0qEsW4jV/IV0TPIOMuRkbQMa6lUfRHSeShSnKECiWG4PJQ4lBBLLLb7XGQ6kVVcTJDWtrxVE4VUHfoWruY3EmBpXdRb8tH5PAQ2mI3NePxuINKqCiGPhImggMnszQCR7oxlC7haH+gMolhyEpPrLPgAAAABJRU5ErkJggg=="},874965:u=>{u.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAABLCAMAAAD0x38HAAAAmVBMVEUAAAAAAABhYQDc1C7Cwh6qqiXy51jz51Hx5Ffp3Tv05l/y5Wju4kjk1jvMzBr16Zf153T152f15mb05lLv5Enw4Ubt3T78+uv79+D477f366H154T26Hr16HX15nj052Hz52Py5Vjv5V/s4kXv3z38+/P79df58sj58sf355H578D1537253j152/053T05m/y5k3s4IP///91k58SAAAAMnRSTlMAAgMOCAZOQTUWXEwqEgq5fmpmRS4hG/Ts0MCgjoRnYFQ6MCcf+ebb27WhlIp5YUc8KZAGwKkAAAEASURBVFjD7ZVHCsMwEEVHsiU77nFJ7723+x8uZJGAshBYn4QUv4XBSI8RjOaL3gND5Fp9JMxtZ9FpALX3nk3mcEYVhoguYnO/vDOuE4C/pT8mkYh9HNO3E1uIPamC4kPgSN5HXhKY27O46QG1011OJTgLNW4jJcygKHT9+/NJAGEzVP49tUaqHzj2VFvdPWjlyMkKTr+OTVocV7vaz5huxtproancv/S0vXUL0pD1JNAdFv1wayddSP/7N6rmnCxjmctO7DBTWwyXbeBeT9PhDAkDu1x0ILQC5Ko1bp9NQB/BIHkcS5a3g/wReCsLGVtBFa+hkEhjDvMMsKejkN7IFVI0CVRTnLcDAAAAAElFTkSuQmCC"},422906:u=>{u.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAAA9CAMAAAA9KQ86AAAAnFBMVEUAAAA3NwCiohfv5EfKyiTp3jbi1DHy5E3u4kDd1C/t3jzU1Cy6uiL254Xz51v26H3052z06F7y5lj05lX05lDx417254n16ID15nH06HD051ft4kTw4Dr79t369M/58sn58cL58b758L3253f9/Pb59Mv577H57a337Kj354/36Z316HX36qb15mf052Hz53fy5lny5XGSkib///+mKr4eAAAAM3RSTlMAAgUvCRYRNyYOHAsHoFSTc1lOR0I0qJZ8eUoqIOvg3NfVzYr73svIubSmhXtmX1ZQTwSDlyIfAAABIklEQVRYw+3W126EMBAF0GtjMJ2lLm17ei///2952yATFpmMlCBx3iwX2XMlazBzMmhBpD4YoOJgQVE0H5OIfQxFHiWYJLeheLk6cdAwYwMLhdcYFkjwbB0kAnqY6zL0OM/Xm8qEHmMd/ZAvT4v70Ous8jGKJbtdgj5Lyu6lnqQ6n6HHLksbRJzfJmXpXyUNB9J2oes1wmJ2/BpUrAdoCm0Q4ccVqLAPaBI3FqjkDH/FkyamEVC8bSbm4RxT9eMP6ok5vttQcMwQM0El3pKdxSXD/+HRJXtX6fQ3Lb80LXT6m0B+b7RdTJfut+E5nOa2cDDE9HFZu6qa88AtHgcfJA6r0Yyc7kBgUL408iO46YMGC4OYg4Q4fUYWaGRlxkCEqFRfojILLn7a+80AAAAASUVORK5CYII="},129517:(u,x,s)=>{u.exports=s.p+"images/star.529998ec.png"},668949:(u,x,s)=>{s.d(x,{A:()=>W});var U=s(510405),_="Expected a function";const W=function(u,x){var s;if("function"!=typeof x)throw new TypeError(_);return u=U.A(u),function(){return--u>0&&(s=x.apply(this,arguments)),u<=1&&(x=void 0),s}}},163095:(u,x,s)=>{s.d(x,{A:()=>_});var U=s(668949);const _=function(u){return U.A(2,u)}},806630:(u,x,s)=>{s.d(x,{G:()=>U});class U{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const u in U.Triggers)if(Object.prototype.hasOwnProperty.call(U.Triggers,u))return!0;return!1}static get HasPickTriggers(){for(const u in U.Triggers)if(Object.prototype.hasOwnProperty.call(U.Triggers,u)){const x=parseInt(u);if(x>=1&&x<=7)return!0}return!1}static HasSpecificTrigger(u){for(const x in U.Triggers)if(Object.prototype.hasOwnProperty.call(U.Triggers,x)&&parseInt(x)===u)return!0;return!1}}U.Triggers={}},299123:(u,x,s)=>{s.d(x,{r:()=>I});var U=s(638113),_=s(604910),W=s(332290),c=s(310035);class I{constructor(u,x){this.triggerOptions=u,this.onBeforeExecuteObservable=new U.cP,u.parameter?(this.trigger=u.trigger,this._triggerParameter=u.parameter):u.trigger?this.trigger=u.trigger:this.trigger=u,this._nextActiveAction=this,this._condition=x}_prepare(){}getTriggerParameter(){return this._triggerParameter}setTriggerParameter(u){this._triggerParameter=u}_evaluateConditionForCurrentFrame(){const u=this._condition;if(!u)return!0;const x=this._actionManager.getScene().getRenderId();return u._evaluationId!==x&&(u._evaluationId=x,u._currentResult=u.isValid()),u._currentResult}_executeCurrent(u){this._evaluateConditionForCurrentFrame()&&(this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(u),this.skipToNextActiveAction())}execute(u){}skipToNextActiveAction(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this}then(u){return this._child=u,u._actionManager=this._actionManager,u._prepare(),u}_getProperty(u){return this._actionManager._getProperty(u)}_getEffectiveTarget(u,x){return this._actionManager._getEffectiveTarget(u,x)}serialize(u){return null}_serialize(u,x){const s={type:1,children:[],name:u.name,properties:u.properties||[]};if(this._child&&this._child.serialize(s),this._condition){const u=this._condition.serialize();return u.children.push(s),x&&x.children.push(u),u}return x&&x.children.push(s),s}}I._SerializeValueAsString=u=>"number"==typeof u?u.toString():"boolean"==typeof u?u?"true":"false":u instanceof _.I9?u.x+", "+u.y:u instanceof _.Pq?u.x+", "+u.y+", "+u.z:u instanceof W.v9?u.r+", "+u.g+", "+u.b:u instanceof W.ov?u.r+", "+u.g+", "+u.b+", "+u.a:u,I._GetTargetProperty=u=>({name:"target",targetType:u._isMesh?"MeshProperties":u._isLight?"LightProperties":u._isCamera?"CameraProperties":u._isMaterial?"MaterialProperties":"SceneProperties",value:u._isScene?"Scene":u.name}),c.Y5("BABYLON.Action",I)},35259:(u,x,s)=>{s.d(x,{X:()=>U});class U{constructor(u,x,s,U,_,W){this.source=u,this.pointerX=x,this.pointerY=s,this.meshUnderPointer=U,this.sourceEvent=_,this.additionalData=W}static CreateNew(u,x,s){const _=u.getScene();return new U(u,_.pointerX,_.pointerY,_.meshUnderPointer||u,x,s)}static CreateNewFromSprite(u,x,s,_){return new U(u,x.pointerX,x.pointerY,x.meshUnderPointer,s,_)}static CreateNewFromScene(u,x){return new U(null,u.pointerX,u.pointerY,u.meshUnderPointer,x)}static CreateNewFromPrimitive(u,x,s,_){return new U(u,x.x,x.y,null,s,_)}}},938480:(u,x,s)=>{s.d(x,{m:()=>j});var U=s(604910),_=s(332290),W=s(582680),c=s(299123),I=s(635141),L=s(395726),J=s(706400),k=s(607552),i=s(310035),d=s(806630);class j extends d.G{constructor(u){super(),(u=u||L.q.LastCreatedScene)&&(this._scene=u,u.actionManagers.push(this))}dispose(){const u=this._scene.actionManagers.indexOf(this);for(let u=0;u<this.actions.length;u++){const x=this.actions[u];j.Triggers[x.trigger]--,0===j.Triggers[x.trigger]&&delete j.Triggers[x.trigger]}this.actions.length=0,u>-1&&this._scene.actionManagers.splice(u,1);const x=this._scene.meshes.filter((u=>u.actionManager===this));for(const u of x)u.actionManager=null}getScene(){return this._scene}hasSpecificTriggers(u){for(let x=0;x<this.actions.length;x++){const s=this.actions[x];if(u.indexOf(s.trigger)>-1)return!0}return!1}hasSpecificTriggers2(u,x){for(let s=0;s<this.actions.length;s++){const U=this.actions[s];if(u==U.trigger||x==U.trigger)return!0}return!1}hasSpecificTrigger(u,x){for(let s=0;s<this.actions.length;s++){const U=this.actions[s];if(U.trigger===u){if(!x)return!0;if(x(U.getTriggerParameter()))return!0}}return!1}get hasPointerTriggers(){for(let u=0;u<this.actions.length;u++){const x=this.actions[u];if(x.trigger>=j.OnPickTrigger&&x.trigger<=j.OnPointerOutTrigger)return!0}return!1}get hasPickTriggers(){for(let u=0;u<this.actions.length;u++){const x=this.actions[u];if(x.trigger>=j.OnPickTrigger&&x.trigger<=j.OnPickUpTrigger)return!0}return!1}registerAction(u){return u.trigger===j.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(J.V.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(u),this.getScene()._registeredActions++,j.Triggers[u.trigger]?j.Triggers[u.trigger]++:j.Triggers[u.trigger]=1,u._actionManager=this,u._prepare(),u)}unregisterAction(u){const x=this.actions.indexOf(u);return-1!==x&&(this.actions.splice(x,1),j.Triggers[u.trigger]-=1,0===j.Triggers[u.trigger]&&delete j.Triggers[u.trigger],u._actionManager=null,this.getScene()._registeredActions--,!0)}processTrigger(u,x){for(let s=0;s<this.actions.length;s++){const U=this.actions[s];if(U.trigger===u){if(x&&(u===j.OnKeyUpTrigger||u===j.OnKeyDownTrigger)){const u=U.getTriggerParameter();if("function"==typeof u){if(!u(x))continue}else if(u&&u!==x.sourceEvent.keyCode){if(!u.toLowerCase)continue;const s=u.toLowerCase();if(s!==x.sourceEvent.key){const u=x.sourceEvent.charCode?x.sourceEvent.charCode:x.sourceEvent.keyCode;if(String.fromCharCode(u).toLowerCase()!==s)continue}}}U._executeCurrent(x)}}}_getEffectiveTarget(u,x){const s=x.split(".");for(let x=0;x<s.length-1;x++)u=u[s[x]];return u}_getProperty(u){const x=u.split(".");return x[x.length-1]}serialize(u){const x={children:new Array,name:u,type:3,properties:new Array};for(let u=0;u<this.actions.length;u++){const s={type:0,children:new Array,name:j.GetTriggerName(this.actions[u].trigger),properties:new Array},U=this.actions[u].triggerOptions;if(U&&"number"!=typeof U)if(U.parameter instanceof Node)s.properties.push(c.r._GetTargetProperty(U.parameter));else if("object"==typeof U.parameter){const u={};k.r.DeepCopy(U.parameter,u,["mesh"]),U.parameter&&U.parameter.mesh&&(u._meshId=U.parameter.mesh.id),s.properties.push({name:"parameter",targetType:null,value:u})}else s.properties.push({name:"parameter",targetType:null,value:U.parameter});this.actions[u].serialize(s),x.children.push(s)}return x}static Parse(u,x,s){const c=new j(s);null===x?s.actionManager=c:x.actionManager=c;const L=(u,x,s,W)=>{if(null===W){const u=parseFloat(x);return"true"===x||"false"===x?"true"===x:isNaN(u)?x:u}const c=W.split("."),I=x.split(",");for(let u=0;u<c.length;u++)s=s[c[u]];if("boolean"==typeof s)return"true"===I[0];if("string"==typeof s)return I[0];const L=[];for(let u=0;u<I.length;u++)L.push(parseFloat(I[u]));return s instanceof U.Pq?U.Pq.FromArray(L):s instanceof U.IU?U.IU.FromArray(L):s instanceof _.v9?_.v9.FromArray(L):s instanceof _.ov?_.ov.FromArray(L):parseFloat(I[0])},J=(u,x,U,_,k=null)=>{if(u.detached)return;const d=[];let r=null,D=null;const $=u.combine&&u.combine.length>0;if(2===u.type?d.push(c):d.push(x),$){const x=[];for(let s=0;s<u.combine.length;s++)J(u.combine[s],j.NothingTrigger,U,_,x);d.push(x)}else for(let x=0;x<u.properties.length;x++){let U=u.properties[x].value;const _=u.properties[x].name,c=u.properties[x].targetType;"target"===_?U=r="SceneProperties"===c?s:"MaterialProperties"===c?s.getMaterialByName(U):s.getNodeByName(U):"parent"===_?U=s.getNodeByName(U):"sound"===_?s.getSoundByName&&(U=s.getSoundByName(U)):"propertyPath"!==_?U=2===u.type&&"operator"===_?W.TO[U]:L(0,U,r,"value"===_?D:null):D=U,d.push(U)}if(null===k?d.push(U):d.push(null),"InterpolateValueAction"===u.name){const u=d[d.length-2];d[d.length-1]=u,d[d.length-2]=U}let H=((u,x)=>{const s=i.n9("BABYLON."+u);return s&&new s(...x)})(u.name,d);if(H instanceof W.kW&&null!==U){const u=new I.tj(x,U);_?_.then(u):c.registerAction(u),_=u}null===k?H instanceof W.kW?(U=H,H=_):(U=null,_?_.then(H):c.registerAction(H)):k.push(H);for(let s=0;s<u.children.length;s++)J(u.children[s],x,U,H,null)};for(let x=0;x<u.children.length;x++){let U;const _=u.children[x];if(_.properties.length>0){const u=_.properties[0].value,x=null===_.properties[0].targetType?u:s.getMeshByName(u);x._meshId&&(x.mesh=s.getMeshById(x._meshId)),U={trigger:j[_.name],parameter:x}}else U=j[_.name];for(let u=0;u<_.children.length;u++)_.detached||J(_.children[u],U,null,null)}}static GetTriggerName(u){switch(u){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnDoublePickTrigger";case 7:return"OnPickUpTrigger";case 8:return"OnLongPressTrigger";case 9:return"OnPointerOverTrigger";case 10:return"OnPointerOutTrigger";case 11:return"OnEveryFrameTrigger";case 12:return"OnIntersectionEnterTrigger";case 13:return"OnIntersectionExitTrigger";case 14:return"OnKeyDownTrigger";case 15:return"OnKeyUpTrigger";case 16:return"OnPickOutTrigger";default:return""}}}j.NothingTrigger=0,j.OnPickTrigger=1,j.OnLeftPickTrigger=2,j.OnRightPickTrigger=3,j.OnCenterPickTrigger=4,j.OnPickDownTrigger=5,j.OnDoublePickTrigger=6,j.OnPickUpTrigger=7,j.OnPickOutTrigger=16,j.OnLongPressTrigger=8,j.OnPointerOverTrigger=9,j.OnPointerOutTrigger=10,j.OnEveryFrameTrigger=11,j.OnIntersectionEnterTrigger=12,j.OnIntersectionExitTrigger=13,j.OnKeyDownTrigger=14,j.OnKeyUpTrigger=15},582680:(u,x,s)=>{s.d(x,{$g:()=>L,Lk:()=>I,TO:()=>c,kW:()=>W});var U=s(299123),_=s(310035);class W{constructor(u){this._actionManager=u}isValid(){return!0}_getProperty(u){return this._actionManager._getProperty(u)}_getEffectiveTarget(u,x){return this._actionManager._getEffectiveTarget(u,x)}serialize(){}_serialize(u){return{type:2,children:[],name:u.name,properties:u.properties}}}class c extends W{static get IsEqual(){return c._IsEqual}static get IsDifferent(){return c._IsDifferent}static get IsGreater(){return c._IsGreater}static get IsLesser(){return c._IsLesser}constructor(u,x,s,U,_=c.IsEqual){super(u),this.propertyPath=s,this.value=U,this.operator=_,this._target=x,this._effectiveTarget=this._getEffectiveTarget(x,this.propertyPath),this._property=this._getProperty(this.propertyPath)}isValid(){switch(this.operator){case c.IsGreater:return this._effectiveTarget[this._property]>this.value;case c.IsLesser:return this._effectiveTarget[this._property]<this.value;case c.IsEqual:case c.IsDifferent:{let u;return u=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===c.IsEqual?u:!u}}return!1}serialize(){return this._serialize({name:"ValueCondition",properties:[U.r._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:U.r._SerializeValueAsString(this.value)},{name:"operator",value:c.GetOperatorName(this.operator)}]})}static GetOperatorName(u){switch(u){case c._IsEqual:return"IsEqual";case c._IsDifferent:return"IsDifferent";case c._IsGreater:return"IsGreater";case c._IsLesser:return"IsLesser";default:return""}}}c._IsEqual=0,c._IsDifferent=1,c._IsGreater=2,c._IsLesser=3;class I extends W{constructor(u,x){super(u),this.predicate=x}isValid(){return this.predicate()}}class L extends W{constructor(u,x,s){super(u),this.value=s,this._target=x}isValid(){return this._target.state===this.value}serialize(){return this._serialize({name:"StateCondition",properties:[U.r._GetTargetProperty(this._target),{name:"value",value:this.value}]})}}_.Y5("BABYLON.ValueCondition",c),_.Y5("BABYLON.PredicateCondition",I),_.Y5("BABYLON.StateCondition",L)},635141:(u,x,s)=>{s.d(x,{BG:()=>I,DL:()=>i,FH:()=>D,JI:()=>k,SQ:()=>r,Sj:()=>L,fO:()=>d,tj:()=>j,u$:()=>J,vP:()=>$});var U=s(706400),_=s(604910),W=s(299123),c=s(310035);class I extends W.r{constructor(u,x,s,U){super(u,U),this.propertyPath=s,this._target=this._effectiveTarget=x}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)}execute(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]}serialize(u){return super._serialize({name:"SwitchBooleanAction",properties:[W.r._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},u)}}class L extends W.r{constructor(u,x,s,U){super(u,U),this.value=s,this._target=x}execute(){this._target.state=this.value}serialize(u){return super._serialize({name:"SetStateAction",properties:[W.r._GetTargetProperty(this._target),{name:"value",value:this.value}]},u)}}class J extends W.r{constructor(u,x,s,U,_){super(u,_),this.propertyPath=s,this.value=U,this._target=this._effectiveTarget=x}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)}execute(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)}serialize(u){return super._serialize({name:"SetValueAction",properties:[W.r._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:W.r._SerializeValueAsString(this.value)}]},u)}}class k extends W.r{constructor(u,x,s,U,_){super(u,_),this.propertyPath=s,this.value=U,this._target=this._effectiveTarget=x}_prepare(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&U.V.Warn("Warning: IncrementValueAction can only be used with number values")}execute(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)}serialize(u){return super._serialize({name:"IncrementValueAction",properties:[W.r._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:W.r._SerializeValueAsString(this.value)}]},u)}}class i extends W.r{constructor(u,x,s,U,_,W){super(u,W),this.from=s,this.to=U,this.loop=_,this._target=x}_prepare(){}execute(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)}serialize(u){return super._serialize({name:"PlayAnimationAction",properties:[W.r._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:W.r._SerializeValueAsString(this.loop)||!1}]},u)}}class d extends W.r{constructor(u,x,s){super(u,s),this._target=x}_prepare(){}execute(){this._actionManager.getScene().stopAnimation(this._target)}serialize(u){return super._serialize({name:"StopAnimationAction",properties:[W.r._GetTargetProperty(this._target)]},u)}}class j extends W.r{constructor(u=0,x){super(u,x)}execute(){}serialize(u){return super._serialize({name:"DoNothingAction",properties:[]},u)}}class r extends W.r{constructor(u,x,s,U=!0){super(u,s),this.children=x,this.enableChildrenConditions=U}_prepare(){for(let u=0;u<this.children.length;u++)this.children[u]._actionManager=this._actionManager,this.children[u]._prepare()}execute(u){for(const x of this.children)this.enableChildrenConditions&&!x._evaluateConditionForCurrentFrame()||x.execute(u)}serialize(u){const x=super._serialize({name:"CombineAction",properties:[],combine:[]},u);for(let u=0;u<this.children.length;u++)x.combine.push(this.children[u].serialize(null));return x}}class D extends W.r{constructor(u,x,s){super(u,s),this.func=x}execute(u){this.func(u)}}class $ extends W.r{constructor(u,x,s,U){super(u,U),this._target=x,this._parent=s}_prepare(){}execute(){if(this._target.parent===this._parent)return;const u=this._parent.getWorldMatrix().clone();u.invert(),this._target.position=_.Pq.TransformCoordinates(this._target.position,u),this._target.parent=this._parent}serialize(u){return super._serialize({name:"SetParentAction",properties:[W.r._GetTargetProperty(this._target),W.r._GetTargetProperty(this._parent)]},u)}}c.Y5("BABYLON.SetParentAction",$),c.Y5("BABYLON.ExecuteCodeAction",D),c.Y5("BABYLON.DoNothingAction",j),c.Y5("BABYLON.StopAnimationAction",d),c.Y5("BABYLON.PlayAnimationAction",i),c.Y5("BABYLON.IncrementValueAction",k),c.Y5("BABYLON.SetValueAction",J),c.Y5("BABYLON.SetStateAction",L),c.Y5("BABYLON.SetParentAction",$),c.Y5("BABYLON.SwitchBooleanAction",I),c.Y5("BABYLON.CombineAction",r)},676617:(u,x,s)=>{s.d(x,{r:()=>k});var U=s(871539),_=s(573531),W=s(638113),c=s(889460),I=s(604910),L=s(488354),J=s(641531);class k{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(u){this._weight=-1!==u?Math.min(Math.max(u,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(u){for(let x=0;x<this._runtimeAnimations.length;x++)this._runtimeAnimations[x]._prepareForSpeedRatioChange(u);this._speedRatio=u,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(u,x,s=0,U=100,_=!1,c=1,I,L,J,k=!1,i=0){this.target=x,this.fromFrame=s,this.toFrame=U,this.loopAnimation=_,this.onAnimationEnd=I,this.onAnimationLoop=J,this.isAdditive=k,this.playOrder=i,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new W.cP,this.onAnimationLoopObservable=new W.cP,this._scene=u,L&&this.appendAnimations(x,L),this._speedRatio=c,u._activeAnimatables.push(this)}syncWith(u){if(this._syncRoot=u,u){const u=this._scene._activeAnimatables.indexOf(this);u>-1&&(this._scene._activeAnimatables.splice(u,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(u,x){for(let s=0;s<x.length;s++){const U=x[s],W=new _.x(u,U,this._scene,this);W._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(W)}}getAnimationByTargetProperty(u){const x=this._runtimeAnimations;for(let s=0;s<x.length;s++)if(x[s].animation.targetProperty===u)return x[s].animation;return null}getRuntimeAnimationByTargetProperty(u){const x=this._runtimeAnimations;for(let s=0;s<x.length;s++)if(x[s].animation.targetProperty===u)return x[s];return null}reset(){const u=this._runtimeAnimations;for(let x=0;x<u.length;x++)u[x].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(u){const x=this._runtimeAnimations;for(let s=0;s<x.length;s++)x[s].animation.enableBlending=!0,x[s].animation.blendingSpeed=u}disableBlending(){const u=this._runtimeAnimations;for(let x=0;x<u.length;x++)u[x].animation.enableBlending=!1}goToFrame(u){var x;const s=this._runtimeAnimations;if(s[0]){const U=s[0].animation.framePerSecond;this._frameToSyncFromJump=null!==(x=this._frameToSyncFromJump)&&void 0!==x?x:s[0].currentFrame;const _=0===this.speedRatio?0:(u-this._frameToSyncFromJump)/U*1e3/this.speedRatio;this._manualJumpDelay=-_}for(let x=0;x<s.length;x++)s[x].goToFrame(u,this._weight);this._goToFrame=u}get paused(){return this._paused}pause(){this._paused||(this._paused=!0)}restart(){this._paused=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(u,x,s=!1,U=!1){if(u||x){const _=this._scene._activeAnimatables.indexOf(this);if(_>-1){const W=this._runtimeAnimations;for(let s=W.length-1;s>=0;s--){const U=W[s];u&&U.animation.name!=u||x&&!x(U.target)||(U.dispose(),W.splice(s,1))}0==W.length&&(s||this._scene._activeAnimatables.splice(_,1),U||this._raiseOnAnimationEnd())}}else{const u=this._scene._activeAnimatables.indexOf(this);if(u>-1){s||this._scene._activeAnimatables.splice(u,1);const x=this._runtimeAnimations;for(let u=0;u<x.length;u++)x[u].dispose();this._runtimeAnimations.length=0,U||this._raiseOnAnimationEnd()}}}waitAsync(){return new Promise((u=>{this.onAnimationEndObservable.add((()=>{u(this)}),void 0,void 0,this,!0)}))}_animate(u){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=u),!0;if(null===this._localDelayOffset?(this._localDelayOffset=u,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=u-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight)return!0;let x=!1;const s=this._runtimeAnimations;let U;for(U=0;U<s.length;U++){const _=s[U].animate(u-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);x=x||_}if(this.animationStarted=x,!x){if(this.disposeOnEnd)for(U=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(U,1),U=0;U<s.length;U++)s[U].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return x}}c.Z.prototype._animate=function(u){if(!this.animationsEnabled)return;const x=L.j.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=x}this.deltaTime=void 0!==u?u:this.useConstantAnimationDeltaTime?16:(x-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=x;const s=this._activeAnimatables;if(0===s.length)return;this._animationTime+=this.deltaTime;const U=this._animationTime;for(let u=0;u<s.length;u++){const x=s[u];!x._animate(U)&&x.disposeOnEnd&&u--}this._processLateAnimationBindings()},c.Z.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((u,x)=>u.playOrder-x.playOrder))},c.Z.prototype.beginWeightedAnimation=function(u,x,s,U=1,_,W=1,c,I,L,J,k=!1){const i=this.beginAnimation(u,x,s,_,W,c,I,!1,L,J,k);return i.weight=U,i},c.Z.prototype.beginAnimation=function(u,x,s,U,_=1,W,c,I=!0,L,J,i=!1){if(_<0){const u=x;x=s,s=u,_=-_}x>s&&(_=-_),I&&this.stopAnimation(u,void 0,L),c||(c=new k(this,u,x,s,U,_,W,void 0,J,i));const d=!L||L(u);if(u.animations&&d&&c.appendAnimations(u,u.animations),u.getAnimatables){const k=u.getAnimatables();for(let u=0;u<k.length;u++)this.beginAnimation(k[u],x,s,U,_,W,c,I,L,J)}return c.reset(),c},c.Z.prototype.beginHierarchyAnimation=function(u,x,s,U,_,W=1,c,I,L=!0,J,k,i=!1){const d=u.getDescendants(x),j=[];j.push(this.beginAnimation(u,s,U,_,W,c,I,L,J,void 0,i));for(const u of d)j.push(this.beginAnimation(u,s,U,_,W,c,I,L,J,void 0,i));return j},c.Z.prototype.beginDirectAnimation=function(u,x,s,U,_,W=1,c,I,L=!1){if(W<0){const u=s;s=U,U=u,W=-W}return s>U&&(W=-W),new k(this,u,s,U,_,W,c,x,I,L)},c.Z.prototype.beginDirectHierarchyAnimation=function(u,x,s,U,_,W,c,I,L,J=!1){const k=u.getDescendants(x),i=[];i.push(this.beginDirectAnimation(u,s,U,_,W,c,I,L,J));for(const u of k)i.push(this.beginDirectAnimation(u,s,U,_,W,c,I,L,J));return i},c.Z.prototype.getAnimatableByTarget=function(u){for(let x=0;x<this._activeAnimatables.length;x++)if(this._activeAnimatables[x].target===u)return this._activeAnimatables[x];return null},c.Z.prototype.getAllAnimatablesByTarget=function(u){const x=[];for(let s=0;s<this._activeAnimatables.length;s++)this._activeAnimatables[s].target===u&&x.push(this._activeAnimatables[s]);return x},c.Z.prototype.stopAnimation=function(u,x,s){const U=this.getAllAnimatablesByTarget(u);for(const u of U)u.stop(x,s)},c.Z.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let u=0;u<this._activeAnimatables.length;u++)this._activeAnimatables[u].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const u of this.animationGroups)u.stop()},c.Z.prototype._registerTargetForLateAnimationBinding=function(u,x){const s=u.target;this._registeredForLateAnimationBindings.pushNoDuplicate(s),s._lateAnimationHolders||(s._lateAnimationHolders={}),s._lateAnimationHolders[u.targetPath]||(s._lateAnimationHolders[u.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:x}),u.isAdditive?(s._lateAnimationHolders[u.targetPath].additiveAnimations.push(u),s._lateAnimationHolders[u.targetPath].totalAdditiveWeight+=u.weight):(s._lateAnimationHolders[u.targetPath].animations.push(u),s._lateAnimationHolders[u.targetPath].totalWeight+=u.weight)},c.Z.prototype._processLateAnimationBindingsForMatrices=function(u){if(0===u.totalWeight&&0===u.totalAdditiveWeight)return u.originalValue;let x=1;const s=I.AA.Vector3[0],U=I.AA.Vector3[1],_=I.AA.Quaternion[0];let W=0;const c=u.animations[0],L=u.originalValue;let J=1,k=!1;if(u.totalWeight<1)J=1-u.totalWeight,L.decompose(U,_,s);else{if(W=1,x=u.totalWeight,J=c.weight/x,1==J){if(!u.totalAdditiveWeight)return c.currentValue;k=!0}c.currentValue.decompose(U,_,s)}if(!k){U.scaleInPlace(J),s.scaleInPlace(J),_.scaleInPlace(J);for(let c=W;c<u.animations.length;c++){const W=u.animations[c];if(0===W.weight)continue;J=W.weight/x;const L=I.AA.Vector3[2],k=I.AA.Vector3[3],i=I.AA.Quaternion[1];W.currentValue.decompose(k,i,L),k.scaleAndAddToRef(J,U),i.scaleAndAddToRef(I.PT.Dot(_,i)>0?J:-J,_),L.scaleAndAddToRef(J,s)}_.normalize()}for(let x=0;x<u.additiveAnimations.length;x++){const W=u.additiveAnimations[x];if(0===W.weight)continue;const c=I.AA.Vector3[2],L=I.AA.Vector3[3],J=I.AA.Quaternion[1];W.currentValue.decompose(L,J,c),L.multiplyToRef(U,L),I.Pq.LerpToRef(U,L,W.weight,U),_.multiplyToRef(J,J),I.PT.SlerpToRef(_,J,W.weight,_),c.scaleAndAddToRef(W.weight,s)}const i=c?c._animationState.workValue:I.AA.Matrix[0].clone();return I.uq.ComposeToRef(U,_,s,i),i},c.Z.prototype._processLateAnimationBindingsForQuaternions=function(u,x){if(0===u.totalWeight&&0===u.totalAdditiveWeight)return x;const s=u.animations[0],U=u.originalValue;let _=x;if(0===u.totalWeight&&u.totalAdditiveWeight>0)_.copyFrom(U);else if(1===u.animations.length){if(I.PT.SlerpToRef(U,s.currentValue,Math.min(1,u.totalWeight),_),0===u.totalAdditiveWeight)return _}else if(u.animations.length>1){let s,W,c=1;if(u.totalWeight<1){const x=1-u.totalWeight;s=[],W=[],s.push(U),W.push(x)}else{if(2===u.animations.length&&(I.PT.SlerpToRef(u.animations[0].currentValue,u.animations[1].currentValue,u.animations[1].weight/u.totalWeight,x),0===u.totalAdditiveWeight))return x;s=[],W=[],c=u.totalWeight}for(let x=0;x<u.animations.length;x++){const U=u.animations[x];s.push(U.currentValue),W.push(U.weight/c)}let L=0;for(let u=0;u<s.length;)u?(L+=W[u],I.PT.SlerpToRef(_,s[u],W[u]/L,_),u++):(I.PT.SlerpToRef(s[u],s[u+1],W[u+1]/(W[u]+W[u+1]),x),_=x,L=W[u]+W[u+1],u+=2)}for(let x=0;x<u.additiveAnimations.length;x++){const s=u.additiveAnimations[x];0!==s.weight&&(_.multiplyToRef(s.currentValue,I.AA.Quaternion[0]),I.PT.SlerpToRef(_,I.AA.Quaternion[0],s.weight,_))}return _},c.Z.prototype._processLateAnimationBindings=function(){if(this._registeredForLateAnimationBindings.length){for(let u=0;u<this._registeredForLateAnimationBindings.length;u++){const x=this._registeredForLateAnimationBindings.data[u];for(const u in x._lateAnimationHolders){const s=x._lateAnimationHolders[u],_=s.animations[0],W=s.originalValue;if(null==W)continue;const c=U.X5.AllowMatrixDecomposeForInterpolation&&W.m;let L=x[u];if(c)L=this._processLateAnimationBindingsForMatrices(s);else if(void 0!==W.w)L=this._processLateAnimationBindingsForQuaternions(s,L||I.PT.Identity());else{let u=0,x=1;const c=_&&_._animationState.loopMode===U.X5.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(s.totalWeight<1)L=c?W.clone?W.clone():W:_&&W.scale?W.scale(1-s.totalWeight):_?W*(1-s.totalWeight):W.clone?W.clone():W;else if(_){x=s.totalWeight;const U=_.weight/x;L=1!==U?_.currentValue.scale?_.currentValue.scale(U):_.currentValue*U:_.currentValue,c&&(L.addToRef?L.addToRef(W,L):L+=W),u=1}for(let U=u;U<s.animations.length;U++){const u=s.animations[U],_=u.weight/x;_&&(u.currentValue.scaleAndAddToRef?u.currentValue.scaleAndAddToRef(_,L):L+=u.currentValue*_)}for(let u=0;u<s.additiveAnimations.length;u++){const x=s.additiveAnimations[u],U=x.weight;U&&(x.currentValue.scaleAndAddToRef?x.currentValue.scaleAndAddToRef(U,L):L+=x.currentValue*U)}}x[u]=L}x._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},J.$.prototype.copyAnimationRange=function(u,x,s,_=!1,W=null){0===this.animations.length&&(this.animations.push(new U.X5(this.name,"_matrix",u.animations[0].framePerSecond,U.X5.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const c=u.animations[0].getRange(x);if(!c)return!1;const I=c.from,L=c.to,J=u.animations[0].getKeys(),k=u.length,i=u.getParent(),d=this.getParent(),j=_&&i&&k&&this.length&&k!==this.length,r=j&&d&&i?d.length/i.length:1,D=_&&!d&&W&&(1!==W.x||1!==W.y||1!==W.z),$=this.animations[0].getKeys();let H,f,O;for(let u=0,x=J.length;u<x;u++)H=J[u],H.frame>=I&&H.frame<=L&&(_?(O=H.value.clone(),j?(f=O.getTranslation(),O.setTranslation(f.scaleInPlace(r))):D&&W?(f=O.getTranslation(),O.setTranslation(f.multiplyInPlace(W))):O=H.value):O=H.value,$.push({frame:H.frame+s,value:O}));return this.animations[0].createRange(x,I+s,L+s),!0}},871539:(u,x,s)=>{s.d(x,{X5:()=>O,eA:()=>$,nl:()=>H,rq:()=>r,s$:()=>d,vF:()=>D,y4:()=>j});var U=s(604910),_=s(332290),W=s(615473),c=s(310035),I=s(454074),L=s(869581),J=s(500556),k=s(732259),i=s(337776);const d=Object.freeze(new U.PT(0,0,0,0)),j=Object.freeze(U.Pq.Zero()),r=Object.freeze(U.I9.Zero()),D=Object.freeze(J.o.Zero()),$=Object.freeze(_.v9.Black()),H=Object.freeze(new _.ov(0,0,0,0)),f={key:0,repeatCount:0,loopMode:2};class O{static _PrepareAnimation(u,x,s,W,c,I,L,k){let i;if(!isNaN(parseFloat(c))&&isFinite(c)?i=O.ANIMATIONTYPE_FLOAT:c instanceof U.PT?i=O.ANIMATIONTYPE_QUATERNION:c instanceof U.Pq?i=O.ANIMATIONTYPE_VECTOR3:c instanceof U.I9?i=O.ANIMATIONTYPE_VECTOR2:c instanceof _.v9?i=O.ANIMATIONTYPE_COLOR3:c instanceof _.ov?i=O.ANIMATIONTYPE_COLOR4:c instanceof J.o&&(i=O.ANIMATIONTYPE_SIZE),null==i)return null;const d=new O(u,x,s,i,L),j=[{frame:0,value:c},{frame:W,value:I}];return d.setKeys(j),void 0!==k&&d.setEasingFunction(k),d}static CreateAnimation(u,x,s,U){const _=new O(u+"Animation",u,s,x,O.ANIMATIONLOOPMODE_CONSTANT);return _.setEasingFunction(U),_}static CreateAndStartAnimation(u,x,s,U,_,W,c,I,L,J,k){const i=O._PrepareAnimation(u,s,U,_,W,c,I,L);return i?(x.getScene&&(k=x.getScene()),k?k.beginDirectAnimation(x,[i],0,_,1===i.loopMode,1,J):null):null}static CreateAndStartHierarchyAnimation(u,x,s,U,_,W,c,I,L,J,k){const i=O._PrepareAnimation(u,U,_,W,c,I,L,J);return i?x.getScene().beginDirectHierarchyAnimation(x,s,[i],0,W,1===i.loopMode,1,k):null}static CreateMergeAndStartAnimation(u,x,s,U,_,W,c,I,L,J){const k=O._PrepareAnimation(u,s,U,_,W,c,I,L);return k?(x.animations.push(k),x.getScene().beginAnimation(x,0,_,1===k.loopMode,1,J)):null}static MakeAnimationAdditive(u,x,s,_=!1,W){var c,I;let L;L="object"==typeof x?x:{referenceFrame:null!=x?x:0,range:s,cloneOriginalAnimation:_,clonedAnimationName:W};let J=u;if(L.cloneOriginalAnimation&&(J=u.clone(),J.name=L.clonedAnimationName||J.name),!J._keys.length)return J;const k=L.referenceFrame&&L.referenceFrame>=0?L.referenceFrame:0;let i=0;const d=J._keys[0];let j=J._keys.length-1;const r=J._keys[j],D={referenceValue:d.value,referencePosition:U.AA.Vector3[0],referenceQuaternion:U.AA.Quaternion[0],referenceScaling:U.AA.Vector3[1],keyPosition:U.AA.Vector3[2],keyQuaternion:U.AA.Quaternion[1],keyScaling:U.AA.Vector3[3]};let $=d.frame,H=r.frame;if(L.range){const u=J.getRange(L.range);u&&($=u.from,H=u.to)}else $=null!==(c=L.fromFrame)&&void 0!==c?c:$,H=null!==(I=L.toFrame)&&void 0!==I?I:H;if($!==d.frame&&(i=J.createKeyForFrame($)),H!==r.frame&&(j=J.createKeyForFrame(H)),1===J._keys.length){const u=J._getKeyValue(J._keys[0]);D.referenceValue=u.clone?u.clone():u}else if(k<=d.frame){const u=J._getKeyValue(d.value);D.referenceValue=u.clone?u.clone():u}else if(k>=r.frame){const u=J._getKeyValue(r.value);D.referenceValue=u.clone?u.clone():u}else{f.key=0;const u=J._interpolate(k,f);D.referenceValue=u.clone?u.clone():u}J.dataType===O.ANIMATIONTYPE_QUATERNION?D.referenceValue.normalize().conjugateInPlace():J.dataType===O.ANIMATIONTYPE_MATRIX&&(D.referenceValue.decompose(D.referenceScaling,D.referenceQuaternion,D.referencePosition),D.referenceQuaternion.normalize().conjugateInPlace());let t=Number.MAX_VALUE;const V=L.clipKeys?[]:null;for(let u=i;u<=j;u++){let x=J._keys[u];if((V||L.cloneOriginalAnimation)&&(x={frame:x.frame,value:x.value.clone?x.value.clone():x.value,inTangent:x.inTangent,outTangent:x.outTangent,interpolation:x.interpolation,lockedTangent:x.lockedTangent},V&&(t===Number.MAX_VALUE&&(t=x.frame),x.frame-=t,V.push(x))),!u||J.dataType===O.ANIMATIONTYPE_FLOAT||x.value!==d.value)switch(J.dataType){case O.ANIMATIONTYPE_MATRIX:x.value.decompose(D.keyScaling,D.keyQuaternion,D.keyPosition),D.keyPosition.subtractInPlace(D.referencePosition),D.keyScaling.divideInPlace(D.referenceScaling),D.referenceQuaternion.multiplyToRef(D.keyQuaternion,D.keyQuaternion),U.uq.ComposeToRef(D.keyScaling,D.keyQuaternion,D.keyPosition,x.value);break;case O.ANIMATIONTYPE_QUATERNION:D.referenceValue.multiplyToRef(x.value,x.value);break;case O.ANIMATIONTYPE_VECTOR2:case O.ANIMATIONTYPE_VECTOR3:case O.ANIMATIONTYPE_COLOR3:case O.ANIMATIONTYPE_COLOR4:x.value.subtractToRef(D.referenceValue,x.value);break;case O.ANIMATIONTYPE_SIZE:x.value.width-=D.referenceValue.width,x.value.height-=D.referenceValue.height;break;default:x.value-=D.referenceValue}}return V&&J.setKeys(V,!0),J}static TransitionTo(u,x,s,U,_,W,c,I=null){if(c<=0)return s[u]=x,I&&I(),null;const L=_*(c/1e3);W.setKeys([{frame:0,value:s[u].clone?s[u].clone():s[u]},{frame:L,value:x}]),s.animations||(s.animations=[]),s.animations.push(W);const J=U.beginAnimation(s,0,L,!1);return J.onAnimationEnd=I,J}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const u of this._runtimeAnimations)if(!u.isStopped())return!0;return!1}constructor(u,x,s,U,_,W){this.name=u,this.targetProperty=x,this.framePerSecond=s,this.dataType=U,this.loopMode=_,this.enableBlending=W,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=x.split("."),this.dataType=U,this.loopMode=void 0===_?O.ANIMATIONLOOPMODE_CYCLE:_,this.uniqueId=O._UniqueIdGenerator++}toString(u){let x="Name: "+this.name+", property: "+this.targetProperty;if(x+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],x+=", nKeys: "+(this._keys?this._keys.length:"none"),x+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),u){x+=", Ranges: {";let u=!0;for(const s in this._ranges)u&&(x+=", ",u=!1),x+=s;x+="}"}return x}addEvent(u){this._events.push(u),this._events.sort(((u,x)=>u.frame-x.frame))}removeEvents(u){for(let x=0;x<this._events.length;x++)this._events[x].frame===u&&(this._events.splice(x,1),x--)}getEvents(){return this._events}createRange(u,x,s){this._ranges[u]||(this._ranges[u]=new I.K(u,x,s))}deleteRange(u,x=!0){const s=this._ranges[u];if(s){if(x){const u=s.from,x=s.to;for(let s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=u&&this._keys[s].frame<=x&&this._keys.splice(s,1)}this._ranges[u]=null}}getRange(u){return this._ranges[u]}getKeys(){return this._keys}getHighestFrame(){let u=0;for(let x=0,s=this._keys.length;x<s;x++)u<this._keys[x].frame&&(u=this._keys[x].frame);return u}getEasingFunction(){return this._easingFunction}setEasingFunction(u){this._easingFunction=u}floatInterpolateFunction(u,x,s){return W.X.Lerp(u,x,s)}floatInterpolateFunctionWithTangents(u,x,s,U,_){return W.X.Hermite(u,x,s,U,_)}quaternionInterpolateFunction(u,x,s){return U.PT.Slerp(u,x,s)}quaternionInterpolateFunctionWithTangents(u,x,s,_,W){return U.PT.Hermite(u,x,s,_,W).normalize()}vector3InterpolateFunction(u,x,s){return U.Pq.Lerp(u,x,s)}vector3InterpolateFunctionWithTangents(u,x,s,_,W){return U.Pq.Hermite(u,x,s,_,W)}vector2InterpolateFunction(u,x,s){return U.I9.Lerp(u,x,s)}vector2InterpolateFunctionWithTangents(u,x,s,_,W){return U.I9.Hermite(u,x,s,_,W)}sizeInterpolateFunction(u,x,s){return J.o.Lerp(u,x,s)}color3InterpolateFunction(u,x,s){return _.v9.Lerp(u,x,s)}color3InterpolateFunctionWithTangents(u,x,s,U,W){return _.v9.Hermite(u,x,s,U,W)}color4InterpolateFunction(u,x,s){return _.ov.Lerp(u,x,s)}color4InterpolateFunctionWithTangents(u,x,s,U,W){return _.ov.Hermite(u,x,s,U,W)}_getKeyValue(u){return"function"==typeof u?u():u}evaluate(u){return f.key=0,this._interpolate(u,f)}_interpolate(u,x,s=!1){var U;if(x.loopMode===O.ANIMATIONLOOPMODE_CONSTANT&&x.repeatCount>0)return x.highLimitValue.clone?x.highLimitValue.clone():x.highLimitValue;const _=this._keys,W=_.length;let c=x.key;for(;c>=0&&u<_[c].frame;)--c;for(;c+1<=W-1&&u>=_[c+1].frame;)++c;if(x.key=c,c<0)return s?void 0:this._getKeyValue(_[0].value);if(c+1>W-1)return s?void 0:this._getKeyValue(_[W-1].value);const I=_[c],L=_[c+1];if(s&&(u===I.frame||u===L.frame))return;const J=this._getKeyValue(I.value),k=this._getKeyValue(L.value);if(1===I.interpolation)return L.frame>u?J:k;const i=void 0!==I.outTangent&&void 0!==L.inTangent,f=L.frame-I.frame;let t=(u-I.frame)/f;const V=I.easingFunction||this.getEasingFunction();switch(null!==V&&(t=V.ease(t)),this.dataType){case O.ANIMATIONTYPE_FLOAT:{const u=i?this.floatInterpolateFunctionWithTangents(J,I.outTangent*f,k,L.inTangent*f,t):this.floatInterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(null!==(U=x.offsetValue)&&void 0!==U?U:0)*x.repeatCount+u}break}case O.ANIMATIONTYPE_QUATERNION:{const u=i?this.quaternionInterpolateFunctionWithTangents(J,I.outTangent.scale(f),k,L.inTangent.scale(f),t):this.quaternionInterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.addInPlace((x.offsetValue||d).scale(x.repeatCount))}return u}case O.ANIMATIONTYPE_VECTOR3:{const u=i?this.vector3InterpolateFunctionWithTangents(J,I.outTangent.scale(f),k,L.inTangent.scale(f),t):this.vector3InterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((x.offsetValue||j).scale(x.repeatCount))}break}case O.ANIMATIONTYPE_VECTOR2:{const u=i?this.vector2InterpolateFunctionWithTangents(J,I.outTangent.scale(f),k,L.inTangent.scale(f),t):this.vector2InterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((x.offsetValue||r).scale(x.repeatCount))}break}case O.ANIMATIONTYPE_SIZE:switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(J,k,t);case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(J,k,t).add((x.offsetValue||D).scale(x.repeatCount))}break;case O.ANIMATIONTYPE_COLOR3:{const u=i?this.color3InterpolateFunctionWithTangents(J,I.outTangent.scale(f),k,L.inTangent.scale(f),t):this.color3InterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((x.offsetValue||$).scale(x.repeatCount))}break}case O.ANIMATIONTYPE_COLOR4:{const u=i?this.color4InterpolateFunctionWithTangents(J,I.outTangent.scale(f),k,L.inTangent.scale(f),t):this.color4InterpolateFunction(J,k,t);switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return u;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return u.add((x.offsetValue||H).scale(x.repeatCount))}break}case O.ANIMATIONTYPE_MATRIX:switch(x.loopMode){case O.ANIMATIONLOOPMODE_CYCLE:case O.ANIMATIONLOOPMODE_CONSTANT:case O.ANIMATIONLOOPMODE_YOYO:return O.AllowMatricesInterpolation?this.matrixInterpolateFunction(J,k,t,x.workValue):J;case O.ANIMATIONLOOPMODE_RELATIVE:case O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return J}}return 0}matrixInterpolateFunction(u,x,s,_){return O.AllowMatrixDecomposeForInterpolation?_?(U.uq.DecomposeLerpToRef(u,x,s,_),_):U.uq.DecomposeLerp(u,x,s):_?(U.uq.LerpToRef(u,x,s,_),_):U.uq.Lerp(u,x,s)}clone(){const u=new O(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed,this._keys&&u.setKeys(this._keys),this._ranges){u._ranges={};for(const x in this._ranges){const s=this._ranges[x];s&&(u._ranges[x]=s.clone())}}return u}setKeys(u,x=!1){this._keys=x?u:u.slice(0)}createKeyForFrame(u){f.key=0;const x=this._interpolate(u,f,!0);if(!x)return this._keys[f.key].frame===u?f.key:f.key+1;const s={frame:u,value:x.clone?x.clone():x};return this._keys.splice(f.key+1,0,s),f.key+1}serialize(){const u={};u.name=this.name,u.property=this.targetProperty,u.framePerSecond=this.framePerSecond,u.dataType=this.dataType,u.loopBehavior=this.loopMode,u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed;const x=this.dataType;u.keys=[];const s=this.getKeys();for(let U=0;U<s.length;U++){const _=s[U],W={};switch(W.frame=_.frame,x){case O.ANIMATIONTYPE_FLOAT:W.values=[_.value],void 0!==_.inTangent&&W.values.push(_.inTangent),void 0!==_.outTangent&&(void 0===_.inTangent&&W.values.push(void 0),W.values.push(_.outTangent)),void 0!==_.interpolation&&(void 0===_.inTangent&&W.values.push(void 0),void 0===_.outTangent&&W.values.push(void 0),W.values.push(_.interpolation));break;case O.ANIMATIONTYPE_QUATERNION:case O.ANIMATIONTYPE_MATRIX:case O.ANIMATIONTYPE_VECTOR3:case O.ANIMATIONTYPE_COLOR3:case O.ANIMATIONTYPE_COLOR4:W.values=_.value.asArray(),null!=_.inTangent&&W.values.push(_.inTangent.asArray()),null!=_.outTangent&&(void 0===_.inTangent&&W.values.push(void 0),W.values.push(_.outTangent.asArray())),void 0!==_.interpolation&&(void 0===_.inTangent&&W.values.push(void 0),void 0===_.outTangent&&W.values.push(void 0),W.values.push(_.interpolation))}u.keys.push(W)}u.ranges=[];for(const x in this._ranges){const s=this._ranges[x];if(!s)continue;const U={};U.name=x,U.from=s.from,U.to=s.to,u.ranges.push(U)}return u}static _UniversalLerp(u,x,s){const U=u.constructor;return U.Lerp?U.Lerp(u,x,s):U.Slerp?U.Slerp(u,x,s):u.toFixed?u*(1-s)+s*x:x}static Parse(u){const x=new O(u.name,u.property,u.framePerSecond,u.dataType,u.loopBehavior),s=u.dataType,W=[];let c,I;for(u.enableBlending&&(x.enableBlending=u.enableBlending),u.blendingSpeed&&(x.blendingSpeed=u.blendingSpeed),I=0;I<u.keys.length;I++){const x=u.keys[I];let L,J,k;switch(s){case O.ANIMATIONTYPE_FLOAT:c=x.values[0],x.values.length>=2&&(L=x.values[1]),x.values.length>=3&&(J=x.values[2]),x.values.length>=4&&(k=x.values[3]);break;case O.ANIMATIONTYPE_QUATERNION:if(c=U.PT.FromArray(x.values),x.values.length>=8){const u=U.PT.FromArray(x.values.slice(4,8));u.equals(U.PT.Zero())||(L=u)}if(x.values.length>=12){const u=U.PT.FromArray(x.values.slice(8,12));u.equals(U.PT.Zero())||(J=u)}x.values.length>=13&&(k=x.values[12]);break;case O.ANIMATIONTYPE_MATRIX:c=U.uq.FromArray(x.values),x.values.length>=17&&(k=x.values[16]);break;case O.ANIMATIONTYPE_COLOR3:c=_.v9.FromArray(x.values),x.values[3]&&(L=_.v9.FromArray(x.values[3])),x.values[4]&&(J=_.v9.FromArray(x.values[4])),x.values[5]&&(k=x.values[5]);break;case O.ANIMATIONTYPE_COLOR4:c=_.ov.FromArray(x.values),x.values[4]&&(L=_.ov.FromArray(x.values[4])),x.values[5]&&(J=_.ov.FromArray(x.values[5])),x.values[6]&&(k=_.ov.FromArray(x.values[6]));break;case O.ANIMATIONTYPE_VECTOR3:default:c=U.Pq.FromArray(x.values),x.values[3]&&(L=U.Pq.FromArray(x.values[3])),x.values[4]&&(J=U.Pq.FromArray(x.values[4])),x.values[5]&&(k=x.values[5])}const i={};i.frame=x.frame,i.value=c,null!=L&&(i.inTangent=L),null!=J&&(i.outTangent=J),null!=k&&(i.interpolation=k),W.push(i)}if(x.setKeys(W),u.ranges)for(I=0;I<u.ranges.length;I++)c=u.ranges[I],x.createRange(c.name,c.from,c.to);return x}static AppendSerializedAnimations(u,x){i.p.AppendSerializedAnimations(u,x)}static ParseFromFileAsync(u,x){return new Promise(((s,U)=>{const _=new k.u;_.addEventListener("readystatechange",(()=>{if(4==_.readyState)if(200==_.status){let x=JSON.parse(_.responseText);if(x.animations&&(x=x.animations),x.length){const u=[];for(const s of x)u.push(this.Parse(s));s(u)}else{const U=this.Parse(x);u&&(U.name=u),s(U)}}else U("Unable to load the animation")})),_.open("GET",x),_.send()}))}static ParseFromSnippetAsync(u){return new Promise(((x,s)=>{const U=new k.u;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const s=JSON.parse(JSON.parse(U.responseText).jsonPayload);if(s.animations){const U=JSON.parse(s.animations),_=[];for(const x of U.animations){const s=this.Parse(x);s.snippetId=u,_.push(s)}x(_)}else{const U=JSON.parse(s.animation),_=this.Parse(U);_.snippetId=u,x(_)}}else s("Unable to load the snippet "+u)})),U.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),U.send()}))}}O._UniqueIdGenerator=0,O.AllowMatricesInterpolation=!1,O.AllowMatrixDecomposeForInterpolation=!0,O.SnippetUrl=`https://snippet.babylonjs.com`,O.ANIMATIONTYPE_FLOAT=0,O.ANIMATIONTYPE_VECTOR3=1,O.ANIMATIONTYPE_QUATERNION=2,O.ANIMATIONTYPE_MATRIX=3,O.ANIMATIONTYPE_COLOR3=4,O.ANIMATIONTYPE_COLOR4=7,O.ANIMATIONTYPE_VECTOR2=5,O.ANIMATIONTYPE_SIZE=6,O.ANIMATIONLOOPMODE_RELATIVE=0,O.ANIMATIONLOOPMODE_CYCLE=1,O.ANIMATIONLOOPMODE_CONSTANT=2,O.ANIMATIONLOOPMODE_YOYO=4,O.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,O.CreateFromSnippetAsync=O.ParseFromSnippetAsync,c.Y5("BABYLON.Animation",O),L.b._AnimationRangeFactory=(u,x,s)=>new I.K(u,x,s)},340923:(u,x,s)=>{s.d(x,{p:()=>U});class U{constructor(u,x,s){this.frame=u,this.action=x,this.onlyOnce=s,this.isDone=!1}_clone(){return new U(this.frame,this.action,this.onlyOnce)}}},77724:(u,x,s)=>{s.d(x,{H:()=>I,k:()=>L});var U=s(871539),_=s(638113),W=s(395726),c=s(443401);class I{getClassName(){return"TargetedAnimation"}serialize(){const u={};return u.animation=this.animation.serialize(),u.targetId=this.target.id,u}}class L{get mask(){return this._mask}set mask(u){this._mask!==u&&(this._mask=u,this.syncWithMask(!0))}syncWithMask(u=!1){if(this.mask||u){this._numActiveAnimatables=0;for(let u=0;u<this._animatables.length;++u){const x=this._animatables[u];!this.mask||this.mask.disabled||this.mask.retainsTarget(x.target.name)?(this._numActiveAnimatables++,x.paused&&x.restart()):x.paused||x.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let u=0;u<this._animatables.length;++u){const x=this._animatables[u];this.mask.retainsTarget(x.target.name)||(x.stop(),this._animatables.splice(u,1),--u)}for(let u=0;u<this._targetedAnimations.length;u++){const x=this._targetedAnimations[u];this.mask.retainsTarget(x.target.name)||(this._targetedAnimations.splice(u,1),--u)}}}get from(){return this._from}set from(u){if(this._from!==u){this._from=u;for(let u=0;u<this._animatables.length;u++)this._animatables[u].fromFrame=this._from}}get to(){return this._to}set to(u){if(this._to!==u){this._to=u;for(let u=0;u<this._animatables.length;u++)this._animatables[u].toFrame=this._to}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(u){if(this._speedRatio!==u){this._speedRatio=u;for(let u=0;u<this._animatables.length;u++)this._animatables[u].speedRatio=this._speedRatio}}get loopAnimation(){return this._loopAnimation}set loopAnimation(u){if(this._loopAnimation!==u){this._loopAnimation=u;for(let u=0;u<this._animatables.length;u++)this._animatables[u].loopAnimation=this._loopAnimation}}get isAdditive(){return this._isAdditive}set isAdditive(u){if(this._isAdditive!==u){this._isAdditive=u;for(let u=0;u<this._animatables.length;u++)this._animatables[u].isAdditive=this._isAdditive}}get weight(){return this._weight}set weight(u){this._weight!==u&&(this._weight=u,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(u){if(this._playOrder!==u&&(this._playOrder=u,this._animatables.length>0)){for(let u=0;u<this._animatables.length;u++)this._animatables[u].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(u){if(this._enableBlending!==u&&(this._enableBlending=u,null!==u))for(let x=0;x<this._targetedAnimations.length;++x)this._targetedAnimations[x].animation.enableBlending=u}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(u){if(this._blendingSpeed!==u&&(this._blendingSpeed=u,null!==u))for(let x=0;x<this._targetedAnimations.length;++x)this._targetedAnimations[x].animation.blendingSpeed=u}getLength(u,x){return u=null!=u?u:this._from,((x=null!=x?x:this._to)-u)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(u,x=!0,s=!1,U){if(0===u.length)return null;U=null!=U?U:u[0].weight;let _=Number.MAX_VALUE,W=-Number.MAX_VALUE;if(s)for(const x of u)x.from<_&&(_=x.from),x.to>W&&(W=x.to);const c=new L(u[0].name+"_merged",u[0]._scene,U);for(const U of u){s&&U.normalize(_,W);for(const u of U.targetedAnimations)c.addTargetedAnimation(u.animation,u.target);x&&U.dispose()}return c}constructor(u,x=null,s=-1,U=0){this.name=u,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new _.cP,this.onAnimationLoopObservable=new _.cP,this.onAnimationGroupLoopObservable=new _.cP,this.onAnimationGroupEndObservable=new _.cP,this.onAnimationGroupPauseObservable=new _.cP,this.onAnimationGroupPlayObservable=new _.cP,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=x||W.q.LastCreatedScene,this._weight=s,this._playOrder=U,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(u,x){const s=new I;s.animation=u,s.target=x;const U=u.getKeys();return this._from>U[0].frame&&(this._from=U[0].frame),this._to<U[U.length-1].frame&&(this._to=U[U.length-1].frame),null!==this._enableBlending&&(u.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(u.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(s),this._shouldStart=!0,s}removeTargetedAnimation(u){for(let x=this._targetedAnimations.length-1;x>-1;x--)this._targetedAnimations[x].animation===u&&this._targetedAnimations.splice(x,1)}normalize(u=null,x=null){null==u&&(u=this._from),null==x&&(x=this._to);for(let s=0;s<this._targetedAnimations.length;s++){const U=this._targetedAnimations[s].animation.getKeys(),_=U[0],W=U[U.length-1];if(_.frame>u){const x={frame:u,value:_.value,inTangent:_.inTangent,outTangent:_.outTangent,interpolation:_.interpolation};U.splice(0,0,x)}if(W.frame<x){const u={frame:x,value:W.value,inTangent:W.inTangent,outTangent:W.outTangent,interpolation:W.interpolation};U.push(u)}}return this._from=u,this._to=x,this}_processLoop(u,x,s){u.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(x),this._animationLoopFlags[s]||(this._animationLoopFlags[s]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(u=!1,x=1,s,U,_){if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=u,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let W=0;W<this._targetedAnimations.length;W++){const c=this._targetedAnimations[W],I=this._scene.beginDirectAnimation(c.target,[c.animation],void 0!==s?s:this._from,void 0!==U?U:this._to,u,x,void 0,void 0,void 0!==_?_:this._isAdditive);I.weight=this._weight,I.playOrder=this._playOrder,I.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(c),this._checkAnimationGroupEnded(I)},this._processLoop(I,c,W),this._animatables.push(I)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=x,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let u=0;u<this._animatables.length;u++)this._animatables[u].pause();return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(u){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==u&&(this.loopAnimation=u),this.restart()):(this.stop(),this.start(u,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let u=0;u<this._animatables.length;u++)this._animatables[u].reset();return this}restart(){if(!this._isStarted)return this;for(let u=0;u<this._animatables.length;u++)this._animatables[u].restart();return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(u=!1){if(!this._isStarted)return this;const x=this._animatables.slice();for(let s=0;s<x.length;s++)x[s].stop(void 0,void 0,!0,u);let s=0;for(let x=0;x<this._scene._activeAnimatables.length;x++){const U=this._scene._activeAnimatables[x];U._runtimeAnimations.length>0?this._scene._activeAnimatables[s++]=U:u&&this._checkAnimationGroupEnded(U,u)}return this._scene._activeAnimatables.length=s,this._isStarted=!1,this}setWeightForAllAnimatables(u){for(let x=0;x<this._animatables.length;x++)this._animatables[x].weight=u;return this}syncAllAnimationsWith(u){for(let x=0;x<this._animatables.length;x++)this._animatables[x].syncWith(u);return this}goToFrame(u){if(!this._isStarted)return this;for(let x=0;x<this._animatables.length;x++)this._animatables[x].goToFrame(u);return this}getCurrentFrame(){var u;return(null===(u=this.animatables[0])||void 0===u?void 0:u.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const u=this._scene.animationGroups.indexOf(this);if(u>-1&&this._scene.animationGroups.splice(u,1),this._parentContainer){const u=this._parentContainer.animationGroups.indexOf(this);u>-1&&this._parentContainer.animationGroups.splice(u,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(u,x=!1){const s=this._animatables.indexOf(u);s>-1&&this._animatables.splice(s,1),0===this._animatables.length&&(this._isStarted=!1,x||this.onAnimationGroupEndObservable.notifyObservers(this))}clone(u,x,s=!1){const U=new L(u||this.name,this._scene,this._weight,this._playOrder);U._from=this.from,U._to=this.to,U._speedRatio=this.speedRatio,U._loopAnimation=this.loopAnimation,U._isAdditive=this.isAdditive,U._enableBlending=this.enableBlending,U._blendingSpeed=this.blendingSpeed,U.metadata=this.metadata,U.mask=this.mask;for(const u of this._targetedAnimations)U.addTargetedAnimation(s?u.animation.clone():u.animation,x?x(u.target):u.target);return U}serialize(){const u={};u.name=this.name,u.from=this.from,u.to=this.to,u.speedRatio=this.speedRatio,u.loopAnimation=this.loopAnimation,u.isAdditive=this.isAdditive,u.weight=this.weight,u.playOrder=this.playOrder,u.enableBlending=this.enableBlending,u.blendingSpeed=this.blendingSpeed,u.targetedAnimations=[];for(let x=0;x<this.targetedAnimations.length;x++){const s=this.targetedAnimations[x];u.targetedAnimations[x]=s.serialize()}return c.Y&&c.Y.HasTags(this)&&(u.tags=c.Y.GetTags(this)),this.metadata&&(u.metadata=this.metadata),u}static Parse(u,x){const s=new L(u.name,x,u.weight,u.playOrder);for(let _=0;_<u.targetedAnimations.length;_++){const W=u.targetedAnimations[_],c=U.X5.Parse(W.animation),I=W.targetId;if("influence"===W.animation.property){const u=x.getMorphTargetById(I);u&&s.addTargetedAnimation(c,u)}else{const u=x.getNodeById(I);null!=u&&s.addTargetedAnimation(c,u)}}return c.Y&&c.Y.AddTagsTo(s,u.tags),null!==u.from&&null!==u.to&&s.normalize(u.from,u.to),void 0!==u.speedRatio&&(s._speedRatio=u.speedRatio),void 0!==u.loopAnimation&&(s._loopAnimation=u.loopAnimation),void 0!==u.isAdditive&&(s._isAdditive=u.isAdditive),void 0!==u.weight&&(s._weight=u.weight),void 0!==u.playOrder&&(s._playOrder=u.playOrder),void 0!==u.enableBlending&&(s._enableBlending=u.enableBlending),void 0!==u.blendingSpeed&&(s._blendingSpeed=u.blendingSpeed),void 0!==u.metadata&&(s.metadata=u.metadata),s}static MakeAnimationAdditive(u,x,s,_=!1,W){let c;c="object"==typeof x?x:{referenceFrame:x,range:s,cloneOriginalAnimationGroup:_,clonedAnimationName:W};let I=u;c.cloneOriginalAnimationGroup&&(I=u.clone(c.clonedAnimationGroupName||I.name));const L=I.targetedAnimations;for(let u=0;u<L.length;u++){const x=L[u];x.animation=U.X5.MakeAnimationAdditive(x.animation,c)}if(I.isAdditive=!0,c.clipKeys){let u=Number.MAX_VALUE,x=-Number.MAX_VALUE;const s=I.targetedAnimations;for(let U=0;U<s.length;U++){const _=s[U].animation.getKeys();u>_[0].frame&&(u=_[0].frame),x<_[_.length-1].frame&&(x=_[_.length-1].frame)}I._from=u,I._to=x}return I}static ClipKeys(u,x,s,U,_){const W=u.clone(U||u.name);return L.ClipKeysInPlace(W,x,s,_)}static ClipKeysInPlace(u,x,s,U){return L.ClipInPlace(u,x,s,U,!1)}static ClipFrames(u,x,s,U,_){const W=u.clone(U||u.name);return L.ClipFramesInPlace(W,x,s,_)}static ClipFramesInPlace(u,x,s,U){return L.ClipInPlace(u,x,s,U,!0)}static ClipInPlace(u,x,s,U,_=!1){let W=Number.MAX_VALUE,c=-Number.MAX_VALUE;const I=u.targetedAnimations;for(let u=0;u<I.length;u++){const L=I[u],J=U?L.animation:L.animation.clone();_&&(J.createKeyForFrame(x),J.createKeyForFrame(s));const k=J.getKeys(),i=[];let d=Number.MAX_VALUE;for(let u=0;u<k.length;u++){const U=k[u];if(!_&&u>=x&&u<=s||_&&U.frame>=x&&U.frame<=s){const u={frame:U.frame,value:U.value.clone?U.value.clone():U.value,inTangent:U.inTangent,outTangent:U.outTangent,interpolation:U.interpolation,lockedTangent:U.lockedTangent};d===Number.MAX_VALUE&&(d=u.frame),u.frame-=d,i.push(u)}}0!==i.length?(W>i[0].frame&&(W=i[0].frame),c<i[i.length-1].frame&&(c=i[i.length-1].frame),J.setKeys(i,!0),L.animation=J):(I.splice(u,1),u--)}return u._from=W,u._to=c,u}getClassName(){return"AnimationGroup"}toString(u){let x="Name: "+this.name;return x+=", type: "+this.getClassName(),u&&(x+=", from: "+this._from,x+=", to: "+this._to,x+=", isStarted: "+this._isStarted,x+=", speedRatio: "+this._speedRatio,x+=", targetedAnimations length: "+this._targetedAnimations.length,x+=", animatables length: "+this._animatables),x}}},454074:(u,x,s)=>{s.d(x,{K:()=>U});class U{constructor(u,x,s){this.name=u,this.from=x,this.to=s}clone(){return new U(this.name,this.from,this.to)}}},371020:(u,x,s)=>{s.d(x,{Bv:()=>$,E8:()=>k,KA:()=>_,ND:()=>I,Q6:()=>j,Ww:()=>i,_B:()=>J,fA:()=>d,kL:()=>c,kc:()=>D,q7:()=>r,rm:()=>W,vm:()=>L});var U=s(808966);class _{constructor(){this._easingMode=_.EASINGMODE_EASEIN}setEasingMode(u){const x=Math.min(Math.max(u,0),2);this._easingMode=x}getEasingMode(){return this._easingMode}easeInCore(u){throw new Error("You must implement this method")}ease(u){switch(this._easingMode){case _.EASINGMODE_EASEIN:return this.easeInCore(u);case _.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-u)}return u>=.5?.5*(1-this.easeInCore(2*(1-u)))+.5:.5*this.easeInCore(2*u)}}_.EASINGMODE_EASEIN=0,_.EASINGMODE_EASEOUT=1,_.EASINGMODE_EASEINOUT=2;class W extends _{easeInCore(u){return u=Math.max(0,Math.min(1,u)),1-Math.sqrt(1-u*u)}}class c extends _{constructor(u=1){super(),this.amplitude=u}easeInCore(u){const x=Math.max(0,this.amplitude);return Math.pow(u,3)-u*x*Math.sin(3.141592653589793*u)}}class I extends _{constructor(u=3,x=2){super(),this.bounces=u,this.bounciness=x}easeInCore(u){const x=Math.max(0,this.bounces);let s=this.bounciness;s<=1&&(s=1.001);const U=Math.pow(s,x),_=1-s,W=(1-U)/_+.5*U,c=u*W,I=Math.log(-c*(1-s)+1)/Math.log(s),L=Math.floor(I),J=L+1,k=(1-Math.pow(s,L))/(_*W),i=.5*(k+(1-Math.pow(s,J))/(_*W)),d=u-i,j=i-k;return-Math.pow(1/s,x-L)/(j*j)*(d-j)*(d+j)}}class L extends _{easeInCore(u){return u*u*u}}class J extends _{constructor(u=3,x=3){super(),this.oscillations=u,this.springiness=x}easeInCore(u){let x;const s=Math.max(0,this.oscillations),U=Math.max(0,this.springiness);return x=0==U?u:(Math.exp(U*u)-1)/(Math.exp(U)-1),x*Math.sin((6.283185307179586*s+1.5707963267948966)*u)}}class k extends _{constructor(u=2){super(),this.exponent=u}easeInCore(u){return this.exponent<=0?u:(Math.exp(this.exponent*u)-1)/(Math.exp(this.exponent)-1)}}class i extends _{constructor(u=2){super(),this.power=u}easeInCore(u){const x=Math.max(0,this.power);return Math.pow(u,x)}}class d extends _{easeInCore(u){return u*u}}class j extends _{easeInCore(u){return u*u*u*u}}class r extends _{easeInCore(u){return u*u*u*u*u}}class D extends _{easeInCore(u){return 1-Math.sin(1.5707963267948966*(1-u))}}class $ extends _{constructor(u=0,x=0,s=1,U=1){super(),this.x1=u,this.y1=x,this.x2=s,this.y2=U}easeInCore(u){return U.vr.Interpolate(u,this.x1,this.y1,this.x2,this.y2)}}},573531:(u,x,s)=>{s.d(x,{x:()=>W});var U=s(604910),_=s(871539);class W{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(u,x,s,W){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._animation=x,this._target=u,this._scene=s,this._host=W,this._activeTargets=[],x._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===_.X5.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=U.uq.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const u={frame:0,value:this._minValue};this._keys.splice(0,0,u)}if(this._target instanceof Array){let u=0;for(const x of this._target)this._preparePath(x,u),this._getOriginalValues(u),u++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const c=x.getEvents();c&&c.length>0&&c.forEach((u=>{this._events.push(u._clone())})),this._enableBlending=u&&u.animationPropertiesOverride?u.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(u,x=0){const s=this._animation.targetPropertyPath;if(s.length>1){let U=u;for(let u=0;u<s.length-1;u++){const x=s[u];if(U=U[x],void 0===U)throw new Error(`Invalid property (${x}) in property path (${s.join(".")})`)}this._targetPath=s[s.length-1],this._activeTargets[x]=U}else this._targetPath=s[0],this._activeTargets[x]=u;if(void 0===this._activeTargets[x][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${s.join(".")})`)}get animation(){return this._animation}reset(u=!1){if(u)if(this._target instanceof Array){let u=0;for(const x of this._target)void 0!==this._originalValue[u]&&this._setValue(x,this._activeTargets[u],this._originalValue[u],-1,u),u++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let u=0;u<this._events.length;u++)this._events[u].isDone=!1}isStopped(){return this._stopped}dispose(){const u=this._animation.runtimeAnimations.indexOf(this);u>-1&&this._animation.runtimeAnimations.splice(u,1)}setValue(u,x){if(this._targetIsArray)for(let s=0;s<this._target.length;s++){const U=this._target[s];this._setValue(U,this._activeTargets[s],u,x,s)}else this._setValue(this._target,this._directTarget,u,x,0)}_getOriginalValues(u=0){let x;const s=this._activeTargets[u];x=s.getLocalMatrix&&"_matrix"===this._targetPath?s.getLocalMatrix():s[this._targetPath],x&&x.clone?this._originalValue[u]=x.clone():this._originalValue[u]=x}_setValue(u,x,s,W,c){if(this._currentActiveTarget=x,this._weight=W,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const u=x[this._targetPath];u.clone?this._originalBlendValue=u.clone():this._originalBlendValue=u}this._originalBlendValue.m?_.X5.AllowMatrixDecomposeForInterpolation?this._currentValue?U.uq.DecomposeLerpToRef(this._originalBlendValue,s,this._blendingFactor,this._currentValue):this._currentValue=U.uq.DecomposeLerp(this._originalBlendValue,s,this._blendingFactor):this._currentValue?U.uq.LerpToRef(this._originalBlendValue,s,this._blendingFactor,this._currentValue):this._currentValue=U.uq.Lerp(this._originalBlendValue,s,this._blendingFactor):this._currentValue=_.X5._UniversalLerp(this._originalBlendValue,s,this._blendingFactor);const W=u&&u.animationPropertiesOverride?u.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=W}else this._currentValue?this._currentValue.copyFrom?this._currentValue.copyFrom(s):this._currentValue=s:(null==s?void 0:s.clone)?this._currentValue=s.clone():this._currentValue=s;-1!==W?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[c]):this._animationState.loopMode===_.X5.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[c],x[this._targetPath]):x[this._targetPath]=this._originalValue[c]+this._currentValue:x[this._targetPath]=this._currentValue,u.markAsDirty&&u.markAsDirty(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(u,x=-1){const s=this._animation.getKeys();u<s[0].frame?u=s[0].frame:u>s[s.length-1].frame&&(u=s[s.length-1].frame);const U=this._events;if(U.length)for(let x=0;x<U.length;x++)U[x].onlyOnce||(U[x].isDone=U[x].frame<u);this._currentFrame=u;const _=this._animation._interpolate(u,this._animationState);this.setValue(_,x)}_prepareForSpeedRatioChange(u){const x=this._previousElapsedTime*(this._animation.framePerSecond*u)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-x}animate(u,x,s,U,W,c=-1){const I=this._animation,L=I.targetPropertyPath;if(!L||L.length<1)return this._stopped=!0,!1;let J=!0;(x<this._minFrame||x>this._maxFrame)&&(x=this._minFrame),(s<this._minFrame||s>this._maxFrame)&&(s=this._maxFrame);const k=s-x;let i,d=u*(I.framePerSecond*W)/1e3+this._absoluteFrameOffset,j=0,r=!1;const D=U&&this._animationState.loopMode===_.X5.ANIMATIONLOOPMODE_YOYO;if(D){const u=(d-x)/k,s=Math.sin(u*Math.PI);d=Math.abs(s)*k+x;const U=s>=0?1:-1;this._yoyoDirection!==U&&(r=!0),this._yoyoDirection=U}if(this._previousElapsedTime=u,this._previousAbsoluteFrame=d,!U&&s>=x&&(d>=k&&W>0||d<=0&&W<0))J=!1,j=I._getKeyValue(this._maxValue);else if(!U&&x>=s&&(d<=k&&W<0||d>=0&&W>0))J=!1,j=I._getKeyValue(this._minValue);else if(this._animationState.loopMode!==_.X5.ANIMATIONLOOPMODE_CYCLE){const u=s.toString()+x.toString();if(!this._offsetsCache[u]){this._animationState.repeatCount=0,this._animationState.loopMode=_.X5.ANIMATIONLOOPMODE_CYCLE;const U=I._interpolate(x,this._animationState),W=I._interpolate(s,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),I.dataType){case _.X5.ANIMATIONTYPE_FLOAT:this._offsetsCache[u]=W-U;break;case _.X5.ANIMATIONTYPE_QUATERNION:case _.X5.ANIMATIONTYPE_VECTOR3:case _.X5.ANIMATIONTYPE_VECTOR2:case _.X5.ANIMATIONTYPE_SIZE:case _.X5.ANIMATIONTYPE_COLOR3:this._offsetsCache[u]=W.subtract(U)}this._highLimitsCache[u]=W}j=this._highLimitsCache[u],i=this._offsetsCache[u]}if(void 0===i)switch(I.dataType){case _.X5.ANIMATIONTYPE_FLOAT:i=0;break;case _.X5.ANIMATIONTYPE_QUATERNION:i=_.s$;break;case _.X5.ANIMATIONTYPE_VECTOR3:i=_.y4;break;case _.X5.ANIMATIONTYPE_VECTOR2:i=_.rq;break;case _.X5.ANIMATIONTYPE_SIZE:i=_.vF;break;case _.X5.ANIMATIONTYPE_COLOR3:i=_.eA;break;case _.X5.ANIMATIONTYPE_COLOR4:i=_.nl}let $;if(this._host&&this._host.syncRoot){const u=this._host.syncRoot;$=x+k*((u.masterFrame-u.fromFrame)/(u.toFrame-u.fromFrame))}else $=d>0&&x>s||d<0&&x<s?J&&0!==k?s+d%k:x:J&&0!==k?x+d%k:s;const H=this._events;if(!D&&(W>0&&this.currentFrame>$||W<0&&this.currentFrame<$)||D&&r){this._onLoop();for(let u=0;u<H.length;u++)H[u].onlyOnce||(H[u].isDone=!1);this._animationState.key=W>0?0:I.getKeys().length-1}this._currentFrame=$,this._animationState.repeatCount=0===k?0:d/k>>0,this._animationState.highLimitValue=j,this._animationState.offsetValue=i;const f=I._interpolate($,this._animationState);if(this.setValue(f,c),H.length)for(let u=0;u<H.length;u++)if(k>=0&&$>=H[u].frame&&H[u].frame>=x||k<0&&$<=H[u].frame&&H[u].frame<=x){const x=H[u];x.isDone||(x.onlyOnce&&(H.splice(u,1),u--),x.isDone=!0,x.action($))}return J||(this._stopped=!0),J}}},240124:(u,x,s)=>{s.d(x,{L:()=>I});var U=s(638113),_=s(706400),W=s(33321),c=s(394501);W.$.AudioEngineFactory=(u,x,s)=>new I(u,x,s);class I{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(u=null,x=null,s=null){if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new U.cP,this.onAudioLockedObservable=new U.cP,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!c.BA())return;void 0!==window.AudioContext&&(this.canUseWebAudio=!0);const _=document.createElement("audio");this._hostElement=u,this._audioContext=x,this._audioDestination=s;try{_&&_.canPlayType&&(_.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||_.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(u){}try{_&&_.canPlayType&&_.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(u){}}lock(){this._triggerSuspendedState()}unlock(){var u,x;if("running"===(null===(u=this._audioContext)||void 0===u?void 0:u.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(x=this._audioContext)||void 0===x||x.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var u;null===(u=this._audioContext)||void 0===u||u.addEventListener("statechange",(()=>{var u;this.unlocked&&"running"!==(null===(u=this._audioContext)||void 0===u?void 0:u.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var u;return(null===(u=this._audioContext)||void 0===u?void 0:u.resume)?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(u){this.canUseWebAudio=!1,_.V.Error("Web Audio: "+u.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const u=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",x=document.createElement("style");x.appendChild(document.createTextNode(u)),document.getElementsByTagName("head")[0].appendChild(x),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(u){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=u)}connectToAnalyser(u){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=u,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},632039:(u,x,s)=>{s.d(x,{A:()=>c});var U=s(706211),_=s(488354),W=s(779908);class c{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(u){this._idleRotationSpeed=u}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(u){this._idleRotationWaitTime=u}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(u){this._idleRotationSpinupTime=u}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(u){this._attachedCamera=u;const x=this._attachedCamera.getScene();this._onPrePointerObservableObserver=x.onPrePointerObservable.add((u=>{u.type!==U.Zp.POINTERDOWN?u.type===U.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const u=_.j.Now;let x=0;null!=this._lastFrameTime&&(x=u-this._lastFrameTime),this._lastFrameTime=u,this._applyUserInteraction();const s=u-this._lastInteractionTime-this._idleRotationWaitTime,U=Math.max(Math.min(s/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*U,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(x/1e3))}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}resetLastInteractionTime(u){this._lastInteractionTime=null!=u?u:_.j.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<W.bH}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let u=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(u=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?u:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=_.j.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}},767761:(u,x,s)=>{s.d(x,{W:()=>W});var U=s(371020),_=s(871539);class W{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(u){if(this._autoTransitionRange===u)return;this._autoTransitionRange=u;const x=this._attachedCamera;x&&(u?this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((u=>{if(u&&(u.computeWorldMatrix(!0),u.getBoundingInfo)){const x=u.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*x,this.upperRadiusTransitionRange=.05*x}})):this._onMeshTargetChangedObserver&&x.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(u){this._attachedCamera=u,this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(u){return!!this._attachedCamera&&this._attachedCamera.radius===u&&!this._radiusIsAnimating}_applyBoundRadiusAnimation(u){if(!this._attachedCamera)return;this._radiusBounceTransition||(W.EasingFunction.setEasingMode(W.EasingMode),this._radiusBounceTransition=_.X5.CreateAnimation("radius",_.X5.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const x=_.X5.TransitionTo("radius",this._attachedCamera.radius+u,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));x&&this._animatables.push(x)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}W.EasingFunction=new U.kL(.3),W.EasingMode=U.KA.EASINGMODE_EASEOUT},205438:(u,x,s)=>{s.d(x,{p:()=>J});var U=s(371020),_=s(638113),W=s(706211),c=s(488354),I=s(604910),L=s(871539);class J{constructor(){this.onTargetFramingAnimationEndObservable=new _.cP,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(u){this._mode=u}get mode(){return this._mode}set radiusScale(u){this._radiusScale=u}get radiusScale(){return this._radiusScale}set positionScale(u){this._positionScale=u}get positionScale(){return this._positionScale}set defaultElevation(u){this._defaultElevation=u}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(u){this._elevationReturnTime=u}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(u){this._elevationReturnWaitTime=u}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(u){this._zoomStopsAnimation=u}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(u){this._framingTime=u}get framingTime(){return this._framingTime}init(){}attach(u){this._attachedCamera=u;const x=this._attachedCamera.getScene();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=x.onPrePointerObservable.add((u=>{u.type!==W.Zp.POINTERDOWN?u.type===W.Zp.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((u=>{u&&u.getBoundingInfo&&this.zoomOnMesh(u,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=u.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const u=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&u.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(u,x=!1,s=null){u.computeWorldMatrix(!0);const U=u.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(U.minimumWorld,U.maximumWorld,x,s)}zoomOnMeshHierarchy(u,x=!1,s=null){u.computeWorldMatrix(!0);const U=u.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(U.min,U.max,x,s)}zoomOnMeshesHierarchy(u,x=!1,s=null){const U=new I.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),_=new I.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let x=0;x<u.length;x++){const s=u[x].getHierarchyBoundingVectors(!0);I.Pq.CheckExtends(s.min,U,_),I.Pq.CheckExtends(s.max,U,_)}this.zoomOnBoundingInfo(U,_,x,s)}zoomOnBoundingInfo(u,x,s=!1,U=null){let _;if(!this._attachedCamera)return!1;const W=u.y,c=W+(x.y-W)*this._positionScale,k=x.subtract(u).scale(.5);if(s)_=new I.Pq(0,c,0);else{const x=u.add(k);_=new I.Pq(x.x,c,x.z)}this._vectorTransition||(this._vectorTransition=L.X5.CreateAnimation("target",L.X5.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let i=L.X5.TransitionTo("target",_,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);i&&this._animatables.push(i);let d=0;if(this._mode===J.FitFrustumSidesMode){const s=this._calculateLowerRadiusFromModelBoundingSphere(u,x);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=k.length()+this._attachedCamera.minZ),d=s}else this._mode===J.IgnoreBoundsSizeMode&&(d=this._calculateLowerRadiusFromModelBoundingSphere(u,x),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){const s=x.subtract(u).length();this._attachedCamera.panningSensibility=5e3/s,this._attachedCamera.wheelPrecision=100/d}return this._radiusTransition||(this._radiusTransition=L.X5.CreateAnimation("radius",L.X5.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),i=L.X5.TransitionTo("radius",d,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),U&&U(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),i&&this._animatables.push(i),!0}_calculateLowerRadiusFromModelBoundingSphere(u,x){const s=this._attachedCamera;if(!s)return 0;let U=s._calculateLowerRadiusFromModelBoundingSphere(u,x,this._radiusScale);return s.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(U=U<s.lowerRadiusLimit?s.lowerRadiusLimit:U),s.upperRadiusLimit&&(U=U>s.upperRadiusLimit?s.upperRadiusLimit:U),U}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const u=c.j.Now-this._lastInteractionTime,x=.5*Math.PI-this._defaultElevation,s=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>s&&u>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=L.X5.CreateAnimation("beta",L.X5.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const u=L.X5.TransitionTo("beta",x,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));u&&this._animatables.push(u)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=c.j.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new U.E8,J.EasingMode=U.KA.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1},641531:(u,x,s)=>{s.d(x,{$:()=>c});var U=s(604910),_=s(967872),W=s(869581);class c extends W.b{get _matrix(){return this._compose(),this._localMatrix}set _matrix(u){(u.updateFlag!==this._localMatrix.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this._localMatrix.copyFrom(u),this._markAsDirtyAndDecompose())}constructor(u,x,s=null,_=null,W=null,c=null,I=null){var L;super(u,x.getScene(),!1),this.name=u,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=x,this._localMatrix=null!==(L=null==_?void 0:_.clone())&&void 0!==L?L:U.uq.Identity(),this._restMatrix=null!=W?W:this._localMatrix.clone(),this._bindMatrix=null!=c?c:this._localMatrix.clone(),this._index=I,this._absoluteMatrix=new U.uq,this._absoluteBindMatrix=new U.uq,this._absoluteInverseBindMatrix=new U.uq,this._finalMatrix=new U.uq,x.bones.push(this),this.setParent(s,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(u){this.setParent(u)}setParent(u,x=!0){if(this.parent!==u){if(this.parent){const u=this.parent.children.indexOf(this);-1!==u&&this.parent.children.splice(u,1)}this._parentNode=u,this.parent&&this.parent.children.push(this),x&&this._updateAbsoluteBindMatrices(),this.markAsDirty()}}getLocalMatrix(){return this._compose(),this._localMatrix}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(u){this._restMatrix.copyFrom(u)}setRestPose(u){this.setRestMatrix(u)}getBindPose(){return this.getBindMatrix()}setBindMatrix(u){this.updateMatrix(u)}setBindPose(u){this.setBindMatrix(u)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){var u;if(this._linkedTransformNode){const x=U.AA.Vector3[0],s=U.AA.Quaternion[0],_=U.AA.Vector3[1];this.getRestMatrix().decompose(x,s,_),this._linkedTransformNode.position.copyFrom(_),this._linkedTransformNode.rotationQuaternion=null!==(u=this._linkedTransformNode.rotationQuaternion)&&void 0!==u?u:U.PT.Identity(),this._linkedTransformNode.rotationQuaternion.copyFrom(s),this._linkedTransformNode.scaling.copyFrom(x)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(u){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=u,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this._localPosition}set position(u){this._decompose(),this._localPosition.copyFrom(u),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(u){this.setRotation(u)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(u){this.setRotationQuaternion(u)}get scaling(){return this.getScale()}set scaling(u){this.setScale(u)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=U.Pq.Zero(),this._localRotation=U.PT.Zero(),this._localPosition=U.Pq.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,U.uq.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)):this._needToCompose=!1)}updateMatrix(u,x=!0,s=!0){this._bindMatrix.copyFrom(u),x&&this._updateAbsoluteBindMatrices(),s?this._matrix=u:this.markAsDirty()}_updateAbsoluteBindMatrices(u,x=!0){if(u||(u=this._bindMatrix),this.parent?u.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.copyFrom(u),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),x)for(let u=0;u<this.children.length;u++)this.children[u]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}markAsDirty(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.markAsDirty(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.markAsDirty(),this._needToDecompose=!0}_updatePosition(u,x=0,s,_=!0){const W=this.getLocalMatrix();if(0==x)_?(W.addAtIndex(12,u.x),W.addAtIndex(13,u.y),W.addAtIndex(14,u.z)):W.setTranslationFromFloats(u.x,u.y,u.z);else{let x=null;s&&(x=s.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const I=c._TmpMats[0],L=c._TmpVecs[0];this.parent?s&&x?(I.copyFrom(this.parent.getAbsoluteMatrix()),I.multiplyToRef(x,I)):I.copyFrom(this.parent.getAbsoluteMatrix()):U.uq.IdentityToRef(I),_&&I.setTranslationFromFloats(0,0,0),I.invert(),U.Pq.TransformCoordinatesToRef(u,I,L),_?(W.addAtIndex(12,L.x),W.addAtIndex(13,L.y),W.addAtIndex(14,L.z)):W.setTranslationFromFloats(L.x,L.y,L.z)}this._markAsDirtyAndDecompose()}translate(u,x=0,s){this._updatePosition(u,x,s,!0)}setPosition(u,x=0,s){this._updatePosition(u,x,s,!1)}setAbsolutePosition(u,x){this.setPosition(u,1,x)}scale(u,x,s,_=!1){const W=this.getLocalMatrix(),I=c._TmpMats[0];U.uq.ScalingToRef(u,x,s,I),I.multiplyToRef(W,W),I.invert();for(const U of this.children){const _=U.getLocalMatrix();_.multiplyToRef(I,_),_.multiplyAtIndex(12,u),_.multiplyAtIndex(13,x),_.multiplyAtIndex(14,s),U._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),_)for(const U of this.children)U.scale(u,x,s,_)}setScale(u){this._decompose(),this._localScaling.copyFrom(u),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(u){this._decompose(),u.copyFrom(this._localScaling)}setYawPitchRoll(u,x,s,_=0,W){if(0===_){const I=c._TmpQuat;return U.PT.RotationYawPitchRollToRef(u,x,s,I),void this.setRotationQuaternion(I,_,W)}const I=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(I,W))return;const L=c._TmpMats[1];U.uq.RotationYawPitchRollToRef(u,x,s,L),I.multiplyToRef(L,L),this._rotateWithMatrix(L,_,W)}rotate(u,x,s=0,_){const W=c._TmpMats[0];W.setTranslationFromFloats(0,0,0),U.uq.RotationAxisToRef(u,x,W),this._rotateWithMatrix(W,s,_)}setAxisAngle(u,x,s=0,_){if(0===s){const W=c._TmpQuat;return U.PT.RotationAxisToRef(u,x,W),void this.setRotationQuaternion(W,s,_)}const W=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,_))return;const I=c._TmpMats[1];U.uq.RotationAxisToRef(u,x,I),W.multiplyToRef(I,I),this._rotateWithMatrix(I,s,_)}setRotation(u,x=0,s){this.setYawPitchRoll(u.y,u.x,u.z,x,s)}setRotationQuaternion(u,x=0,s){if(0===x)return this._decompose(),this._localRotation.copyFrom(u),void this._markAsDirtyAndCompose();const _=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(_,s))return;const W=c._TmpMats[1];U.uq.FromQuaternionToRef(u,W),_.multiplyToRef(W,W),this._rotateWithMatrix(W,x,s)}setRotationMatrix(u,x=0,s){if(0===x){const _=c._TmpQuat;return U.PT.FromRotationMatrixToRef(u,_),void this.setRotationQuaternion(_,x,s)}const _=c._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(_,s))return;const W=c._TmpMats[1];W.copyFrom(u),_.multiplyToRef(u,W),this._rotateWithMatrix(W,x,s)}_rotateWithMatrix(u,x=0,s){const U=this.getLocalMatrix(),_=U.m[12],W=U.m[13],I=U.m[14],L=this.getParent(),J=c._TmpMats[3],k=c._TmpMats[4];L&&1==x?(s?(J.copyFrom(s.getWorldMatrix()),L.getAbsoluteMatrix().multiplyToRef(J,J)):J.copyFrom(L.getAbsoluteMatrix()),k.copyFrom(J),k.invert(),U.multiplyToRef(J,U),U.multiplyToRef(u,U),U.multiplyToRef(k,U)):1==x&&s?(J.copyFrom(s.getWorldMatrix()),k.copyFrom(J),k.invert(),U.multiplyToRef(J,U),U.multiplyToRef(u,U),U.multiplyToRef(k,U)):U.multiplyToRef(u,U),U.setTranslationFromFloats(_,W,I),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(u,x){const s=c._TmpMats[2];return u.copyFrom(this.getAbsoluteMatrix()),x?(u.multiplyToRef(x.getWorldMatrix(),u),U.uq.ScalingToRef(x.scaling.x,x.scaling.y,x.scaling.z,s)):U.uq.IdentityToRef(s),u.invert(),!isNaN(u.m[0])&&(s.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyToRef(s,u),!0)}getPosition(u=0,x=null){const s=U.Pq.Zero();return this.getPositionToRef(u,x,s),s}getPositionToRef(u=0,x,s){if(0==u){const u=this.getLocalMatrix();s.x=u.m[12],s.y=u.m[13],s.z=u.m[14]}else{let u=null;x&&(u=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let U=c._TmpMats[0];x&&u?(U.copyFrom(this.getAbsoluteMatrix()),U.multiplyToRef(u,U)):U=this.getAbsoluteMatrix(),s.x=U.m[12],s.y=U.m[13],s.z=U.m[14]}}getAbsolutePosition(u=null){const x=U.Pq.Zero();return this.getPositionToRef(1,u,x),x}getAbsolutePositionToRef(u,x){this.getPositionToRef(1,u,x)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this._localMatrix.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.copyFrom(this._localMatrix);const u=this._skeleton.getPoseMatrix();u&&this._absoluteMatrix.multiplyToRef(u,this._absoluteMatrix)}const u=this.children,x=u.length;for(let s=0;s<x;s++)u[s].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}getDirection(u,x=null){const s=U.Pq.Zero();return this.getDirectionToRef(u,x,s),s}getDirectionToRef(u,x=null,s){let _=null;x&&(_=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=c._TmpMats[0];W.copyFrom(this.getAbsoluteMatrix()),x&&_&&W.multiplyToRef(_,W),U.Pq.TransformNormalToRef(u,W,s),s.normalize()}getRotation(u=0,x=null){const s=U.Pq.Zero();return this.getRotationToRef(u,x,s),s}getRotationToRef(u=0,x=null,s){const U=c._TmpQuat;this.getRotationQuaternionToRef(u,x,U),U.toEulerAnglesToRef(s)}getRotationQuaternion(u=0,x=null){const s=U.PT.Identity();return this.getRotationQuaternionToRef(u,x,s),s}getRotationQuaternionToRef(u=0,x=null,s){if(0==u)this._decompose(),s.copyFrom(this._localRotation);else{const u=c._TmpMats[0],U=this.getAbsoluteMatrix();x?U.multiplyToRef(x.getWorldMatrix(),u):u.copyFrom(U),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.decompose(void 0,s,void 0)}}getRotationMatrix(u=0,x){const s=U.uq.Identity();return this.getRotationMatrixToRef(u,x,s),s}getRotationMatrixToRef(u=0,x,s){if(0==u)this.getLocalMatrix().getRotationMatrixToRef(s);else{const u=c._TmpMats[0],U=this.getAbsoluteMatrix();x?U.multiplyToRef(x.getWorldMatrix(),u):u.copyFrom(U),u.multiplyAtIndex(0,this._scalingDeterminant),u.multiplyAtIndex(1,this._scalingDeterminant),u.multiplyAtIndex(2,this._scalingDeterminant),u.getRotationMatrixToRef(s)}}getAbsolutePositionFromLocal(u,x=null){const s=U.Pq.Zero();return this.getAbsolutePositionFromLocalToRef(u,x,s),s}getAbsolutePositionFromLocalToRef(u,x=null,s){let _=null;x&&(_=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=c._TmpMats[0];W.copyFrom(this.getAbsoluteMatrix()),x&&_&&W.multiplyToRef(_,W),U.Pq.TransformCoordinatesToRef(u,W,s)}getLocalPositionFromAbsolute(u,x=null){const s=U.Pq.Zero();return this.getLocalPositionFromAbsoluteToRef(u,x,s),s}getLocalPositionFromAbsoluteToRef(u,x=null,s){let _=null;x&&(_=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=c._TmpMats[0];W.copyFrom(this.getAbsoluteMatrix()),x&&_&&W.multiplyToRef(_,W),W.invert(),U.Pq.TransformCoordinatesToRef(u,W,s)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}c._TmpVecs=_.mI(2,U.Pq.Zero),c._TmpQuat=U.PT.Identity(),c._TmpMats=_.mI(5,U.uq.Identity)},993954:(u,x,s)=>{s.d(x,{E:()=>d});var U=s(641531),_=s(638113),W=s(604910),c=s(376976),I=s(871539),L=s(454074),J=s(395726),k=s(706400),i=s(607552);class d{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(u){this._useTextureToStoreBoneMatrices=u,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(u,x,s){this.name=u,this.id=x,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=W.uq.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new _.cP,this.bones=[],this._scene=s||J.q.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const U=this._scene.getEngine().getCaps();this._canUseTextureForBones=U.textureFloat&&U.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((u=>!u.getParent()))}getTransformMatrices(u){if(this.needInitialSkinMatrix){if(!u)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return u._bonesTransformMatrices||this.prepare(!0),u._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(u){return this.needInitialSkinMatrix&&u._transformMatrixTexture?u._transformMatrixTexture:this._transformMatrixTexture}getScene(){return this._scene}toString(u){let x=`Name: ${this.name}, nBones: ${this.bones.length}`;if(x+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,u){x+=", Ranges: {";let u=!0;for(const s in this._ranges)u&&(x+=", ",u=!1),x+=s;x+="}"}return x}getBoneIndexByName(u){for(let x=0,s=this.bones.length;x<s;x++)if(this.bones[x].name===u)return x;return-1}createAnimationRange(u,x,s){if(!this._ranges[u]){this._ranges[u]=new L.K(u,x,s);for(let U=0,_=this.bones.length;U<_;U++)this.bones[U].animations[0]&&this.bones[U].animations[0].createRange(u,x,s)}}deleteAnimationRange(u,x=!0){for(let s=0,U=this.bones.length;s<U;s++)this.bones[s].animations[0]&&this.bones[s].animations[0].deleteRange(u,x);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}getAnimationRanges(){const u=[];let x;for(x in this._ranges)u.push(this._ranges[x]);return u}copyAnimationRange(u,x,s=!1){if(this._ranges[x]||!u.getAnimationRange(x))return!1;let U=!0;const _=this._getHighestAnimationFrame()+1,W={},c=u.bones;let I,J;for(J=0,I=c.length;J<I;J++)W[c[J].name]=c[J];this.bones.length!==c.length&&(k.V.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${c.length}`),U=!1);const i=s&&this.dimensionsAtRest&&u.dimensionsAtRest?this.dimensionsAtRest.divide(u.dimensionsAtRest):null;for(J=0,I=this.bones.length;J<I;J++){const u=this.bones[J].name,c=W[u];c?U=U&&this.bones[J].copyAnimationRange(c,x,_,s,i):(k.V.Warn("copyAnimationRange: not same rig, missing source bone "+u),U=!1)}const d=u.getAnimationRange(x);return d&&(this._ranges[x]=new L.K(x,d.from+_,d.to+_)),U}returnToRest(){for(const u of this.bones)-1!==u._index&&u.returnToRest()}_getHighestAnimationFrame(){let u=0;for(let x=0,s=this.bones.length;x<s;x++)if(this.bones[x].animations[0]){const s=this.bones[x].animations[0].getHighestFrame();u<s&&(u=s)}return u}beginAnimation(u,x,s,U){const _=this.getAnimationRange(u);return _?this._scene.beginAnimation(this,_.from,_.to,x,s,U):null}static MakeAnimationAdditive(u,x=0,s){const U=u.getAnimationRange(s);if(!U)return null;const _=u._scene.getAllAnimatablesByTarget(u);let W=null;for(let u=0;u<_.length;u++){const x=_[u];if(x.fromFrame===(null==U?void 0:U.from)&&x.toFrame===(null==U?void 0:U.to)){W=x;break}}const c=u.getAnimatables();for(let u=0;u<c.length;u++){const U=c[u].animations;if(U)for(let u=0;u<U.length;u++)I.X5.MakeAnimationAdditive(U[u],x,s)}return W&&(W.isAdditive=!0),u}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(u){this._meshesWithPoseMatrix.push(u)}_unregisterMeshWithPoseMatrix(u){const x=this._meshesWithPoseMatrix.indexOf(u);x>-1&&this._meshesWithPoseMatrix.splice(x,1)}_computeTransformMatrices(u,x){this.onBeforeComputeObservable.notifyObservers(this);for(let s=0;s<this.bones.length;s++){const U=this.bones[s];U._childUpdateId++;const _=U.getParent();if(_?U.getLocalMatrix().multiplyToRef(_.getFinalMatrix(),U.getFinalMatrix()):x?U.getLocalMatrix().multiplyToRef(x,U.getFinalMatrix()):U.getFinalMatrix().copyFrom(U.getLocalMatrix()),-1!==U._index){const x=null===U._index?s:U._index;U.getAbsoluteInverseBindMatrix().multiplyToArray(U.getFinalMatrix(),u,16*x)}}this._identity.copyToArray(u,16*this.bones.length)}prepare(u=!1){if(!u){const u=this.getScene().getRenderId();if(this._currentRenderId===u)return;this._currentRenderId=u}if(this._numBonesWithLinkedTransformNode>0)for(const u of this.bones)if(u._linkedTransformNode){const x=u._linkedTransformNode;u.position=x.position,x.rotationQuaternion?u.rotationQuaternion=x.rotationQuaternion:u.rotation=x.rotation,u.scaling=x.scaling}if(this.needInitialSkinMatrix)for(const u of this._meshesWithPoseMatrix){const x=u.getPoseMatrix();let s=this._isDirty;if(u._bonesTransformMatrices&&u._bonesTransformMatrices.length===16*(this.bones.length+1)||(u._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),s=!0),s){if(this._synchronizedWithMesh!==u){this._synchronizedWithMesh=u;for(const u of this.bones)u.getParent()||(u.getBindMatrix().multiplyToRef(x,W.AA.Matrix[1]),u._updateAbsoluteBindMatrices(W.AA.Matrix[1]));if(this.isUsingTextureForMatrices){const x=4*(this.bones.length+1);u._transformMatrixTexture&&u._transformMatrixTexture.getSize().width===x||(u._transformMatrixTexture&&u._transformMatrixTexture.dispose(),u._transformMatrixTexture=c.I.CreateRGBATexture(u._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(u._bonesTransformMatrices,x),this.isUsingTextureForMatrices&&u._transformMatrixTexture&&u._transformMatrixTexture.update(u._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=c.I.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let u=0;u<this.bones.length;u++)this._animatables.push(this.bones[u])}return this._animatables}clone(u,x){const s=new d(u,x||u,this._scene);s.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let u=0;u<this.bones.length;u++){const x=this.bones[u];let _=null;const W=x.getParent();if(W){const u=this.bones.indexOf(W);_=s.bones[u]}const c=new U.$(x.name,s,_,x.getBindMatrix().clone(),x.getRestMatrix().clone());c._index=x._index,x._linkedTransformNode&&c.linkTransformNode(x._linkedTransformNode),i.r.DeepCopy(x.animations,c.animations)}if(this._ranges){s._ranges={};for(const u in this._ranges){const x=this._ranges[u];x&&(s._ranges[u]=x.clone())}}return this._isDirty=!0,s.prepare(!0),s}enableBlending(u=.01){this.bones.forEach((x=>{x.animations.forEach((x=>{x.enableBlending=!0,x.blendingSpeed=u}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._parentContainer){const u=this._parentContainer.skeletons.indexOf(this);u>-1&&this._parentContainer.skeletons.splice(u,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){var u;const x={};x.name=this.name,x.id=this.id,this.dimensionsAtRest&&(x.dimensionsAtRest=this.dimensionsAtRest.asArray()),x.bones=[],x.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let s=0;s<this.bones.length;s++){const U=this.bones[s],_=U.getParent(),W={parentBoneIndex:_?this.bones.indexOf(_):-1,index:U.getIndex(),name:U.name,id:U.id,matrix:U.getBindMatrix().asArray(),rest:U.getRestMatrix().asArray(),linkedTransformNodeId:null===(u=U.getTransformNode())||void 0===u?void 0:u.id};x.bones.push(W),U.length&&(W.length=U.length),U.metadata&&(W.metadata=U.metadata),U.animations&&U.animations.length>0&&(W.animation=U.animations[0].serialize()),x.ranges=[];for(const u in this._ranges){const s=this._ranges[u];if(!s)continue;const U={};U.name=u,U.from=s.from,U.to=s.to,x.ranges.push(U)}}return x}static Parse(u,x){const s=new d(u.name,u.id,x);let _;for(u.dimensionsAtRest&&(s.dimensionsAtRest=W.Pq.FromArray(u.dimensionsAtRest)),s.needInitialSkinMatrix=u.needInitialSkinMatrix,_=0;_<u.bones.length;_++){const x=u.bones[_],c=u.bones[_].index;let L=null;x.parentBoneIndex>-1&&(L=s.bones[x.parentBoneIndex]);const J=x.rest?W.uq.FromArray(x.rest):null,k=new U.$(x.name,s,L,W.uq.FromArray(x.matrix),J,null,c);void 0!==x.id&&null!==x.id&&(k.id=x.id),x.length&&(k.length=x.length),x.metadata&&(k.metadata=x.metadata),x.animation&&k.animations.push(I.X5.Parse(x.animation)),void 0!==x.linkedTransformNodeId&&null!==x.linkedTransformNodeId&&(s._hasWaitingData=!0,k._waitingTransformNodeId=x.linkedTransformNodeId)}if(u.ranges)for(_=0;_<u.ranges.length;_++){const x=u.ranges[_];s.createAnimationRange(x.name,x.from,x.to)}return s}computeAbsoluteMatrices(u=!1){(this._absoluteTransformIsDirty||u)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(u=!1){this.computeAbsoluteMatrices(u)}getPoseMatrix(){let u=null;return this._meshesWithPoseMatrix.length>0&&(u=this._meshesWithPoseMatrix[0].getPoseMatrix()),u}sortBones(){const u=[],x=new Array(this.bones.length);for(let s=0;s<this.bones.length;s++)this._sortBones(s,u,x);this.bones=u}_sortBones(u,x,s){if(s[u])return;s[u]=!0;const U=this.bones[u];if(!U)return;void 0===U._index&&(U._index=u);const _=U.getParent();_&&this._sortBones(this.bones.indexOf(_),x,s),x.push(U)}setCurrentPoseAsRest(){this.bones.forEach((u=>{u.setCurrentPoseAsRest()}))}}},23987:(u,x,s)=>{s.d(x,{R:()=>c,h:()=>W});var U=s(389011),_=s(706400);class W{get isDisposed(){return this._isDisposed}constructor(u,x,s,_=0,W=!1,c=!1,I=!1,L,J){this._isAlreadyOwned=!1,this._isDisposed=!1,u&&u.getScene?this._engine=u.getScene().getEngine():this._engine=u,this._updatable=s,this._instanced=c,this._divisor=L||1,this._label=J,x instanceof U.n?(this._data=null,this._buffer=x):(this._data=x,this._buffer=null),this.byteStride=I?_:_*Float32Array.BYTES_PER_ELEMENT,W||this.create()}createVertexBuffer(u,x,s,U,_,W=!1,I){const L=W?x:x*Float32Array.BYTES_PER_ELEMENT,J=U?W?U:U*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new c(this._engine,this,u,this._updatable,!0,J,void 0===_?this._instanced:_,L,s,void 0,void 0,!0,this._divisor||I)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(u=null){!u&&this._buffer||(u=u||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,u),this._data=u):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(u,this._label),this._data=u):this._buffer=this._engine.createVertexBuffer(u,void 0,this._label))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label));_.V.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(u){this.create(u)}updateDirectly(u,x,s,U=!1){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,u,U?x:x*Float32Array.BYTES_PER_ELEMENT,s?s*this.byteStride:void 0),this._data=0===x&&void 0===s?u:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class c{get isDisposed(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(u){const x=0!=u;this._instanceDivisor=u,x!==this._instanced&&(this._instanced=x,this._computeHashCode())}get _maxVerticesCount(){const u=this.getData();return u?Array.isArray(u)?u.length/(this.byteStride/4)-this.byteOffset/4:(u.byteLength-this.byteOffset)/this.byteStride:0}constructor(u,x,s,U,_,I,L,J,k,i,d=!1,j=!1,r=1,D=!1){var $,H,f,O,t;this._isDisposed=!1;let V=!1;if(this.engine=u,"object"==typeof U&&null!==U?(V=null!==($=U.updatable)&&void 0!==$&&$,_=U.postponeInternalCreation,I=U.stride,L=U.instanced,J=U.offset,k=U.size,i=U.type,d=null!==(H=U.normalized)&&void 0!==H&&H,j=null!==(f=U.useBytes)&&void 0!==f&&f,r=null!==(O=U.divisor)&&void 0!==O?O:1,D=null!==(t=U.takeBufferOwnership)&&void 0!==t&&t,this._label=U.label):V=!!U,x instanceof W?(this._buffer=x,this._ownsBuffer=D):(this._buffer=new W(u,x,V,I,_,L,j,r,this._label),this._ownsBuffer=!0),this.uniqueId=c._Counter++,this._kind=s,void 0===i){const u=this.getData();this.type=u?c.GetDataType(u):c.FLOAT}else this.type=i;const N=c.GetTypeByteLength(this.type);j?(this._size=k||(I?I/N:c.DeduceStride(s)),this.byteStride=I||this._buffer.byteStride||this._size*N,this.byteOffset=J||0):(this._size=k||I||c.DeduceStride(s),this.byteStride=I?I*N:this._buffer.byteStride||this._size*N,this.byteOffset=(J||0)*N),this.normalized=d,this._instanced=void 0!==L&&L,this._instanceDivisor=L?r:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var u;null===(u=this._buffer)||void 0===u||u._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(u,x){const s=this.getData();return s?c.GetFloatData(s,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,u,x):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/c.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/c.GetTypeByteLength(this.type)}getSize(u=!1){return u?this._size*c.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(u){this._buffer.create(u),this._alignBuffer()}update(u){this._buffer.update(u),this._alignBuffer()}updateDirectly(u,x,s=!1){this._buffer.updateDirectly(u,x,void 0,s),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(u,x){c.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,u,this.normalized,x)}_alignBuffer(){}static DeduceStride(u){switch(u){case c.UVKind:case c.UV2Kind:case c.UV3Kind:case c.UV4Kind:case c.UV5Kind:case c.UV6Kind:return 2;case c.NormalKind:case c.PositionKind:return 3;case c.ColorKind:case c.ColorInstanceKind:case c.MatricesIndicesKind:case c.MatricesIndicesExtraKind:case c.MatricesWeightsKind:case c.MatricesWeightsExtraKind:case c.TangentKind:return 4;default:throw new Error("Invalid kind '"+u+"'")}}static GetDataType(u){return u instanceof Int8Array?c.BYTE:u instanceof Uint8Array?c.UNSIGNED_BYTE:u instanceof Int16Array?c.SHORT:u instanceof Uint16Array?c.UNSIGNED_SHORT:u instanceof Int32Array?c.INT:u instanceof Uint32Array?c.UNSIGNED_INT:c.FLOAT}static GetTypeByteLength(u){switch(u){case c.BYTE:case c.UNSIGNED_BYTE:return 1;case c.SHORT:case c.UNSIGNED_SHORT:return 2;case c.INT:case c.UNSIGNED_INT:case c.FLOAT:return 4;default:throw new Error(`Invalid type '${u}'`)}}static ForEach(u,x,s,U,_,W,I,L){if(u instanceof Array){let _=x/4;const c=s/4;for(let x=0;x<W;x+=U){for(let s=0;s<U;s++)L(u[_+s],x+s);_+=c}}else{const J=u instanceof ArrayBuffer?new DataView(u):new DataView(u.buffer,u.byteOffset,u.byteLength),k=c.GetTypeByteLength(_);for(let u=0;u<W;u+=U){let W=x;for(let x=0;x<U;x++)L(c._GetFloatValue(J,_,W,I),u+x),W+=k;x+=s}}}static _GetFloatValue(u,x,s,U){switch(x){case c.BYTE:{let x=u.getInt8(s);return U&&(x=Math.max(x/127,-1)),x}case c.UNSIGNED_BYTE:{let x=u.getUint8(s);return U&&(x/=255),x}case c.SHORT:{let x=u.getInt16(s,!0);return U&&(x=Math.max(x/32767,-1)),x}case c.UNSIGNED_SHORT:{let x=u.getUint16(s,!0);return U&&(x/=65535),x}case c.INT:return u.getInt32(s,!0);case c.UNSIGNED_INT:return u.getUint32(s,!0);case c.FLOAT:return u.getFloat32(s,!0);default:throw new Error(`Invalid component type ${x}`)}}static GetFloatData(u,x,s,U,W,I,L,J){const k=x*c.GetTypeByteLength(s),i=L*x;if(s!==c.FLOAT||W!==k){const _=new Float32Array(i);return c.ForEach(u,U,W,x,s,i,I,((u,x)=>_[x]=u)),_}if(!(u instanceof Array||u instanceof Float32Array)||0!==U||u.length!==i){if(u instanceof Array){const x=U/4;return u.slice(x,x+i)}if(u instanceof ArrayBuffer)return new Float32Array(u,U,i);{const x=u.byteOffset+U;if(3&x&&(_.V.Warn("Float array must be aligned to 4-bytes border"),J=!0),J){const s=new Uint8Array(i*Float32Array.BYTES_PER_ELEMENT),U=new Uint8Array(u.buffer,x,s.length);return s.set(U),new Float32Array(s.buffer)}return new Float32Array(u.buffer,x,i)}}return J?u.slice():u}}c._Counter=0,c.BYTE=5120,c.UNSIGNED_BYTE=5121,c.SHORT=5122,c.UNSIGNED_SHORT=5123,c.INT=5124,c.UNSIGNED_INT=5125,c.FLOAT=5126,c.PositionKind=`position`,c.NormalKind=`normal`,c.TangentKind=`tangent`,c.UVKind=`uv`,c.UV2Kind=`uv2`,c.UV3Kind=`uv3`,c.UV4Kind=`uv4`,c.UV5Kind=`uv5`,c.UV6Kind=`uv6`,c.ColorKind=`color`,c.ColorInstanceKind=`instanceColor`,c.MatricesIndicesKind=`matricesIndices`,c.MatricesWeightsKind=`matricesWeights`,c.MatricesIndicesExtraKind=`matricesIndicesExtra`,c.MatricesWeightsExtraKind=`matricesWeightsExtra`},174290:(u,x,s)=>{s.d(x,{g:()=>W});var U=s(23987),_=s(706400);function W(u,x,s,W,c,I,L,J){const k=x*U.R.GetTypeByteLength(s),i=L*x;if(J.length!==i)throw new Error("Output length is not valid");if(s===U.R.FLOAT&&c===k)if(u instanceof Array){const x=W/4;J.set(u,x)}else if(u instanceof ArrayBuffer){const x=new Float32Array(u,W,i);J.set(x)}else{const x=u.byteOffset+W;if(x%4)return _.V.Warn("CopyFloatData: copied misaligned data."),void J.set(new Float32Array(u.buffer.slice(x,x+4*i)));const s=new Float32Array(u.buffer,x,i);J.set(s)}else U.R.ForEach(u,W,c,x,s,i,I,((u,x)=>J[x]=u))}},389011:(u,x,s)=>{s.d(x,{n:()=>U});class U{get underlyingResource(){return null}constructor(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=U._Counter++}}U._Counter=0},429342:(u,x,s)=>{s.d(x,{R:()=>I});var U=s(297809),_=s(760998),W=s(898973),c=s(706211);class I{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(u){u=W.S0.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),s=x.getInputElement();let U=0,_=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=W=>{var I,L;const J=W.event,k="touch"===J.pointerType;if(W.type!==c.Zp.POINTERMOVE&&-1===this.buttons.indexOf(J.button))return;const i=J.target;if(this._altKey=J.altKey,this._ctrlKey=J.ctrlKey,this._metaKey=J.metaKey,this._shiftKey=J.shiftKey,this._buttonsPressed=J.buttons,x.isPointerLock){const u=J.movementX,x=J.movementY;this.onTouch(null,u,x),this._pointA=null,this._pointB=null}else{if(W.type!==c.Zp.POINTERDOWN&&W.type!==c.Zp.POINTERDOUBLETAP&&k&&(null===(I=this._pointA)||void 0===I?void 0:I.pointerId)!==J.pointerId&&(null===(L=this._pointB)||void 0===L?void 0:L.pointerId)!==J.pointerId)return;if(W.type!==c.Zp.POINTERDOWN||-1!==this._currentActiveButton&&!k)if(W.type===c.Zp.POINTERDOUBLETAP)this.onDoubleTap(J.pointerType);else if(W.type!==c.Zp.POINTERUP||this._currentActiveButton!==J.button&&!k){if(W.type===c.Zp.POINTERMOVE)if(u||J.preventDefault(),this._pointA&&null===this._pointB){const u=J.clientX-this._pointA.x,x=J.clientY-this._pointA.y;this._pointA.x=J.clientX,this._pointA.y=J.clientY,this.onTouch(this._pointA,u,x)}else if(this._pointA&&this._pointB){const u=this._pointA.pointerId===J.pointerId?this._pointA:this._pointB;u.x=J.clientX,u.y=J.clientY;const x=this._pointA.x-this._pointB.x,s=this._pointA.y-this._pointB.y,c=x*x+s*s,I={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:J.pointerId,type:W.type};this.onMultiTouch(this._pointA,this._pointB,U,c,_,I),_=I,U=c}}else{try{null==i||i.releasePointerCapture(J.pointerId)}catch(u){}k||(this._pointB=null),x._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==J.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==J.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==U||_)&&(this.onMultiTouch(this._pointA,this._pointB,U,0,_,null),U=0,_=null),this._currentActiveButton=-1,this.onButtonUp(J),u||J.preventDefault()}else{try{null==i||i.setPointerCapture(J.pointerId)}catch(u){}if(null===this._pointA)this._pointA={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType};else{if(null!==this._pointB)return;this._pointB={x:J.clientX,y:J.clientY,pointerId:J.pointerId,type:J.pointerType}}-1!==this._currentActiveButton||k||(this._currentActiveButton=J.button),this.onButtonDown(J),u||(J.preventDefault(),s&&s.focus())}}},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,c.Zp.POINTERDOWN|c.Zp.POINTERUP|c.Zp.POINTERMOVE|c.Zp.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,U=0,_=null,this.onLostFocus()},this._contextMenuBind=u=>this.onContextMenu(u),s&&s.addEventListener("contextmenu",this._contextMenuBind,!1);const I=this.camera.getScene().getEngine().getHostWindow();I&&W.S0.RegisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}detachControl(){if(this._onLostFocus){const u=this.camera.getScene().getEngine().getHostWindow();u&&W.S0.UnregisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const u=this.camera.getScene().getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(u){}onTouch(u,x,s){}onMultiTouch(u,x,s,U,_,W){}onContextMenu(u){u.preventDefault()}onButtonDown(u){}onButtonUp(u){}onLostFocus(){}}U.Cg([_.lK()],I.prototype,"buttons",void 0)},907204:(u,x,s)=>{s.d(x,{n:()=>L});var U=s(297809),_=s(760998),W=s(147003),c=s(834255),I=s(898973);class L{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(u){u=I.S0.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const s=x.event;if(!s.metaKey)if(x.type===c.TB.KEYDOWN)this._ctrlPressed=s.ctrlKey,this._altPressed=s.altKey,(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode))&&(-1===this._keys.indexOf(s.keyCode)&&this._keys.push(s.keyCode),s.preventDefault&&(u||s.preventDefault()));else if(-1!==this.keysUp.indexOf(s.keyCode)||-1!==this.keysDown.indexOf(s.keyCode)||-1!==this.keysLeft.indexOf(s.keyCode)||-1!==this.keysRight.indexOf(s.keyCode)||-1!==this.keysReset.indexOf(s.keyCode)){const x=this._keys.indexOf(s.keyCode);x>=0&&this._keys.splice(x,1),s.preventDefault&&(u||s.preventDefault())}})))}detachControl(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const u=this.camera;for(let x=0;x<this._keys.length;x++){const s=this._keys[x];-1!==this.keysLeft.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX-=1/this.panningSensibility:u.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset+=1/this.zoomingSensibility:u.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningX+=1/this.panningSensibility:u.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(s)?this._ctrlPressed&&this.camera._useCtrlForPanning?u.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?u.inertialRadiusOffset-=1/this.zoomingSensibility:u.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(s)&&u.useInputToRestoreState&&u.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}U.Cg([_.lK()],L.prototype,"keysUp",void 0),U.Cg([_.lK()],L.prototype,"keysDown",void 0),U.Cg([_.lK()],L.prototype,"keysLeft",void 0),U.Cg([_.lK()],L.prototype,"keysRight",void 0),U.Cg([_.lK()],L.prototype,"keysReset",void 0),U.Cg([_.lK()],L.prototype,"panningSensibility",void 0),U.Cg([_.lK()],L.prototype,"zoomingSensibility",void 0),U.Cg([_.lK()],L.prototype,"useAltToZoom",void 0),U.Cg([_.lK()],L.prototype,"angularSpeed",void 0),W.H["ArcRotateCameraKeyboardMoveInput"]=L},619882:(u,x,s)=>{s.d(x,{f:()=>r});var U=s(297809),_=s(760998),W=s(147003),c=s(706211),I=s(298039),L=s(604910),J=s(779908),k=s(332108),i=s(615473),d=s(898973);const j=40;class r{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new L.Pq(0,0,0),this._globalOffset=new L.Pq(0,0,0),this._inertialPanning=L.Pq.Zero()}_computeDeltaFromMouseWheelLegacyEvent(u,x){let s=0;const U=.01*u*this.wheelDeltaPercentage*x;return s=u>0?U/(1+this.wheelDeltaPercentage):U*(1+this.wheelDeltaPercentage),s}attachControl(u){u=d.S0.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==c.Zp.POINTERWHEEL)return;const s=x.event;let U=0;const _=s.deltaMode===k.s.DOM_DELTA_LINE?j:1,W=-s.deltaY*_;if(this.customComputeDeltaFromMouseWheel)U=this.customComputeDeltaFromMouseWheel(W,this,s);else if(this.wheelDeltaPercentage){if(U=this._computeDeltaFromMouseWheelLegacyEvent(W,this.camera.radius),U>0){let u=this.camera.radius,x=this.camera.inertialRadiusOffset+U;for(let s=0;s<20&&Math.abs(x)>.001;s++)u-=x,x*=this.camera.inertia;u=i.X.Clamp(u,0,Number.MAX_VALUE),U=this._computeDeltaFromMouseWheelLegacyEvent(W,u)}}else U=W/(40*this.wheelPrecision);U&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(U)):this.camera.inertialRadiusOffset+=U),s.preventDefault&&(u||s.preventDefault())},this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,c.Zp.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.setAll(0)}detachControl(){this._observer&&(this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const u=this.camera;0+u.inertialAlphaOffset+u.inertialBetaOffset+u.inertialRadiusOffset&&(this._updateHitPlane(),u.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(u.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const u=this.camera,x=u.target.subtract(u.position);this._hitPlane=I.Z.FromPositionAndNormal(u.target,x)}_getPosition(){var u;const x=this.camera,s=x.getScene(),U=s.createPickingRay(s.pointerX,s.pointerY,L.uq.Identity(),x,!1);0===x.targetScreenOffset.x&&0===x.targetScreenOffset.y||(this._viewOffset.set(x.targetScreenOffset.x,x.targetScreenOffset.y,0),x.getViewMatrix().invertToRef(x._cameraTransformMatrix),this._globalOffset=L.Pq.TransformNormal(this._viewOffset,x._cameraTransformMatrix),U.origin.addInPlace(this._globalOffset));let _=0;return this._hitPlane&&(_=null!==(u=U.intersectsPlane(this._hitPlane))&&void 0!==u?u:0),U.origin.addInPlace(U.direction.scaleInPlace(_))}_zoomToMouse(u){var x,s;const U=this.camera,_=1-U.inertia;if(U.lowerRadiusLimit){const s=null!==(x=U.lowerRadiusLimit)&&void 0!==x?x:0;U.radius-(U.inertialRadiusOffset+u)/_<s&&(u=(U.radius-s)*_-U.inertialRadiusOffset)}if(U.upperRadiusLimit){const x=null!==(s=U.upperRadiusLimit)&&void 0!==s?s:0;U.radius-(U.inertialRadiusOffset+u)/_>x&&(u=(U.radius-x)*_-U.inertialRadiusOffset)}const W=u/_/U.radius,c=this._getPosition(),I=L.AA.Vector3[6];c.subtractToRef(U.target,I),I.scaleInPlace(W),I.scaleInPlace(_),this._inertialPanning.addInPlace(I),U.inertialRadiusOffset+=u}_zeroIfClose(u){Math.abs(u.x)<J.bH&&(u.x=0),Math.abs(u.y)<J.bH&&(u.y=0),Math.abs(u.z)<J.bH&&(u.z=0)}}U.Cg([_.lK()],r.prototype,"wheelPrecision",void 0),U.Cg([_.lK()],r.prototype,"zoomToMouseLocation",void 0),U.Cg([_.lK()],r.prototype,"wheelDeltaPercentage",void 0),W.H["ArcRotateCameraMouseWheelInput"]=r},889610:(u,x,s)=>{s.d(x,{L:()=>I});var U=s(297809),_=s(760998),W=s(147003),c=s(429342);class I extends c.R{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(u,x){if(0!==this.panningSensibility&&u&&x){const s=x.x-u.x,U=x.y-u.y;this.camera.inertialPanningX+=-s/this.panningSensibility,this.camera.inertialPanningY+=U/this.panningSensibility}}_computePinchZoom(u,x){const s=this.camera.radius||I.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=s*Math.sqrt(u)/Math.sqrt(x):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(x-u)*s*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(x-u)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(u,x,s){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=s/this.panningSensibility):(this.camera.inertialAlphaOffset-=x/this.angularSensibilityX,this.camera.inertialBetaOffset-=s/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(u,x,s,U,_,W){0===s&&null===_||0===U&&null===W||(this.multiTouchPanAndZoom?(this._computePinchZoom(s,U),this._computeMultiTouchPanning(_,W)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(U)-Math.sqrt(s))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(s,U),this._isPinching=!0):this._computeMultiTouchPanning(_,W)):this.multiTouchPanning?this._computeMultiTouchPanning(_,W):this.pinchZoom&&this._computePinchZoom(s,U))}onButtonDown(u){this._isPanClick=u.button===this.camera._panningMouseButton}onButtonUp(u){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}I.MinimumRadiusForPinch=.001,U.Cg([_.lK()],I.prototype,"buttons",void 0),U.Cg([_.lK()],I.prototype,"angularSensibilityX",void 0),U.Cg([_.lK()],I.prototype,"angularSensibilityY",void 0),U.Cg([_.lK()],I.prototype,"pinchPrecision",void 0),U.Cg([_.lK()],I.prototype,"pinchDeltaPercentage",void 0),U.Cg([_.lK()],I.prototype,"useNaturalPinchZoom",void 0),U.Cg([_.lK()],I.prototype,"pinchZoom",void 0),U.Cg([_.lK()],I.prototype,"panningSensibility",void 0),U.Cg([_.lK()],I.prototype,"multiTouchPanning",void 0),U.Cg([_.lK()],I.prototype,"multiTouchPanAndZoom",void 0),W.H["ArcRotateCameraPointersInput"]=I},654550:(u,x,s)=>{s.d(x,{L:()=>f});var U=s(297809),_=s(760998),W=s(638113),c=s(604910),I=s(869581),L=s(27230),J=s(632039),k=s(767761),i=s(205438),d=s(564135),j=s(787618),r=s(552580),D=s(779908),$=s(898973),H=s(310035);I.b.AddNodeConstructor("ArcRotateCamera",((u,x)=>()=>new f(u,0,0,1,c.Pq.Zero(),x)));class f extends j.F{get target(){return this._target}set target(u){this.setTarget(u)}get targetHost(){return this._targetHost}set targetHost(u){u&&this.setTarget(u)}getTarget(){return this.target}get position(){return this._position}set position(u){this.setPosition(u)}set upVector(u){this._upToYMatrix||(this._yToUpMatrix=new c.uq,this._upToYMatrix=new c.uq,this._upVector=c.Pq.Zero()),u.normalize(),this._upVector.copyFrom(u),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){c.uq.RotationAlignToRef(c.Pq.UpReadOnly,this._upVector,this._yToUpMatrix),c.uq.RotationAlignToRef(this._upVector,c.Pq.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const u=this.inputs.attached["pointers"];return u?u.angularSensibilityX:0}set angularSensibilityX(u){const x=this.inputs.attached["pointers"];x&&(x.angularSensibilityX=u)}get angularSensibilityY(){const u=this.inputs.attached["pointers"];return u?u.angularSensibilityY:0}set angularSensibilityY(u){const x=this.inputs.attached["pointers"];x&&(x.angularSensibilityY=u)}get pinchPrecision(){const u=this.inputs.attached["pointers"];return u?u.pinchPrecision:0}set pinchPrecision(u){const x=this.inputs.attached["pointers"];x&&(x.pinchPrecision=u)}get pinchDeltaPercentage(){const u=this.inputs.attached["pointers"];return u?u.pinchDeltaPercentage:0}set pinchDeltaPercentage(u){const x=this.inputs.attached["pointers"];x&&(x.pinchDeltaPercentage=u)}get useNaturalPinchZoom(){const u=this.inputs.attached["pointers"];return!!u&&u.useNaturalPinchZoom}set useNaturalPinchZoom(u){const x=this.inputs.attached["pointers"];x&&(x.useNaturalPinchZoom=u)}get panningSensibility(){const u=this.inputs.attached["pointers"];return u?u.panningSensibility:0}set panningSensibility(u){const x=this.inputs.attached["pointers"];x&&(x.panningSensibility=u)}get keysUp(){const u=this.inputs.attached["keyboard"];return u?u.keysUp:[]}set keysUp(u){const x=this.inputs.attached["keyboard"];x&&(x.keysUp=u)}get keysDown(){const u=this.inputs.attached["keyboard"];return u?u.keysDown:[]}set keysDown(u){const x=this.inputs.attached["keyboard"];x&&(x.keysDown=u)}get keysLeft(){const u=this.inputs.attached["keyboard"];return u?u.keysLeft:[]}set keysLeft(u){const x=this.inputs.attached["keyboard"];x&&(x.keysLeft=u)}get keysRight(){const u=this.inputs.attached["keyboard"];return u?u.keysRight:[]}set keysRight(u){const x=this.inputs.attached["keyboard"];x&&(x.keysRight=u)}get wheelPrecision(){const u=this.inputs.attached["mousewheel"];return u?u.wheelPrecision:0}set wheelPrecision(u){const x=this.inputs.attached["mousewheel"];x&&(x.wheelPrecision=u)}get zoomToMouseLocation(){const u=this.inputs.attached["mousewheel"];return!!u&&u.zoomToMouseLocation}set zoomToMouseLocation(u){const x=this.inputs.attached["mousewheel"];x&&(x.zoomToMouseLocation=u)}get wheelDeltaPercentage(){const u=this.inputs.attached["mousewheel"];return u?u.wheelDeltaPercentage:0}set wheelDeltaPercentage(u){const x=this.inputs.attached["mousewheel"];x&&(x.wheelDeltaPercentage=u)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(u){u!==this.useBouncingBehavior&&(u?(this._bouncingBehavior=new k.W,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(u){u!==this.useFramingBehavior&&(u?(this._framingBehavior=new i.p,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(u){u!==this.useAutoRotationBehavior&&(u?(this._autoRotationBehavior=new J.A,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(u,x,s,U,_,I,L=!0){super(u,c.Pq.Zero(),I,L),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=c.Pq.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=c.I9.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new c.uq,this.panningAxis=new c.Pq(1,1,0),this._transformedDirection=new c.Pq,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new W.cP,this.checkCollisions=!1,this.collisionRadius=new c.Pq(.5,.5,.5),this._previousPosition=c.Pq.Zero(),this._collisionVelocity=c.Pq.Zero(),this._newPosition=c.Pq.Zero(),this._computationVector=c.Pq.Zero(),this._onCollisionPositionChange=(u,x,s=null)=>{s?(this.setPosition(x),this.onCollide&&this.onCollide(s)):this._previousPosition.copyFrom(this._position);const U=Math.cos(this.alpha),_=Math.sin(this.alpha),W=Math.cos(this.beta);let c=Math.sin(this.beta);0===c&&(c=1e-4);const I=this._getTargetPosition();this._computationVector.copyFromFloats(this.radius*U*c,this.radius*W,this.radius*_*c),I.addToRef(this._computationVector,this._newPosition),this._position.copyFrom(this._newPosition);let L=this.upVector;this.allowUpsideDown&&this.beta<0&&(L=L.clone(),L=L.negate()),this._computeViewMatrix(this._position,I,L),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y),this._collisionTriggered=!1},this._target=c.Pq.Zero(),_&&this.setTarget(_),this.alpha=x,this.beta=s,this.radius=U,this.getViewMatrix(),this.inputs=new r.H(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new c.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=c.I9.Zero()}_updateCache(u){u||super._updateCache(),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const u=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?u.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(u)}return this._getLockedTargetPosition()||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>D.bH&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset)}attachControl(u,x,s=!0,U=2){const _=arguments;x=$.S0.BackCompatCameraNoPreventDefault(_),this._useCtrlForPanning=s,this._panningMouseButton=U,"boolean"==typeof _[0]&&(_.length>1&&(this._useCtrlForPanning=_[1]),_.length>2&&(this._panningMouseButton=_[2])),this.inputs.attachElement(x),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}detachControl(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const u=this._scene.getEngine().getDeltaTime()/1e3,x=1-Math.pow(2,-u/this.restoreStateInterpolationFactor);this.setTarget(c.Pq.Lerp(this.getTarget(),this._storedTarget,x)),c.PT.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,c.AA.Quaternion[0]),c.PT.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,c.AA.Quaternion[1]),c.PT.SlerpToRef(c.AA.Quaternion[1],c.AA.Quaternion[0],x,c.AA.Quaternion[2]),c.AA.Quaternion[2].normalize(),c.AA.Quaternion[2].toAlphaBetaGammaToRef(c.AA.Vector3[0]),this.alpha=c.AA.Vector3[0].x,this.beta=c.AA.Vector3[0].y,this.radius+=(this._storedRadius-this.radius)*x,c.I9.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,x,this.targetScreenOffset),(c.Pq.DistanceSquared(this.getTarget(),this._storedTarget)<D.bH&&c.AA.Quaternion[2].equalsWithEpsilon(c.AA.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<D.bH&&c.I9.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<D.bH||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const u=this.invertRotation?-1:1,x=this._calculateHandednessMultiplier();let s=this.inertialAlphaOffset*x;this.beta<0&&(s*=-1),this.alpha+=s*u,this.beta+=this.inertialBetaOffset*u,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<D.bH&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<D.bH&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*D.bH&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const u=new c.Pq(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),c.Pq.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const u=this.upVector,x=c.Pq.CrossToRef(this._transformedDirection,u,this._transformedDirection);c.Pq.CrossToRef(u,x,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit)this._transformedDirection.addInPlace(this._target),c.Pq.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection);else{if(this.parent){const u=c.AA.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(u),u.transposeToRef(u),c.Pq.TransformCoordinatesToRef(this._transformedDirection,u,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*D.bH&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*D.bH&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.Pq.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const u=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const x=Math.round((u-this.alpha)/(2*Math.PI));this.alpha+=2*x*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(u){this._position.equals(u)||(this._position.copyFrom(u),this.rebuildAnglesAndRadius())}setTarget(u,x=!1,s=!1,U=!1){var _;if(U=null!==(_=this.overrideCloneAlphaBetaRadius)&&void 0!==_?_:U,u.computeWorldMatrix)x&&u.getBoundingInfo?this._targetBoundingCenter=u.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,u.computeWorldMatrix(),this._targetHost=u,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const x=u,U=this._getTargetPosition();if(U&&!s&&U.equals(x))return;this._targetHost=null,this._target=x,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}U||this.rebuildAnglesAndRadius()}_getViewMatrix(){const u=Math.cos(this.alpha),x=Math.sin(this.alpha),s=Math.cos(this.beta);let U=Math.sin(this.beta);0===U&&(U=1e-4),0===this.radius&&(this.radius=1e-4);const _=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*u*U,this.radius*s,this.radius*x*U),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||c.Pq.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),_.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){const u=this.getScene().collisionCoordinator;this._collider||(this._collider=u.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,u.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);let u=this.upVector;this.allowUpsideDown&&U<0&&(u=u.negate()),this._computeViewMatrix(this._position,_,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=_,this._viewMatrix}zoomOn(u,x=!1){u=u||this.getScene().meshes;const s=L.e.MinMax(u);let U=this._calculateLowerRadiusFromModelBoundingSphere(s.min,s.max);U=Math.max(Math.min(U,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=U*this.zoomOnFactor,this.focusOn({min:s.min,max:s.max,distance:U},x)}focusOn(u,x=!1){let s,U;if(void 0===u.min){const x=u||this.getScene().meshes;s=L.e.MinMax(x),U=c.Pq.Distance(s.min,s.max)}else s=u,U=u.distance;this._target=L.e.Center(s),x||(this.maxZ=2*U)}createRigCamera(u,x){let s=0;switch(this.cameraRigMode){case d.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.i.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.i.RIG_MODE_VR:s=this._cameraRigParams.stereoHalfAngle*(0===x?1:-1);break;case d.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:s=this._cameraRigParams.stereoHalfAngle*(0===x?-1:1)}const U=new f(u,this.alpha+s,this.beta,this.radius,this._target,this.getScene());return U._cameraRigParams={},U.isRigCamera=!0,U.rigParent=this,U.upVector=this.upVector,U.mode=this.mode,U.orthoLeft=this.orthoLeft,U.orthoRight=this.orthoRight,U.orthoBottom=this.orthoBottom,U.orthoTop=this.orthoTop,U}_updateRigCameras(){const u=this._rigCameras[0],x=this._rigCameras[1];switch(u.beta=x.beta=this.beta,this.cameraRigMode){case d.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case d.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case d.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case d.i.RIG_MODE_STEREOSCOPIC_INTERLACED:case d.i.RIG_MODE_VR:u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case d.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(u,x,s=1){const U=c.Pq.Distance(u,x),_=this.getScene().getEngine().getAspectRatio(this),W=Math.tan(this.fov/2),I=W*_,L=.5*U*s,J=L*Math.sqrt(1+1/(I*I)),k=L*Math.sqrt(1+1/(W*W));return Math.max(J,k)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}U.Cg([_.lK()],f.prototype,"alpha",void 0),U.Cg([_.lK()],f.prototype,"beta",void 0),U.Cg([_.lK()],f.prototype,"radius",void 0),U.Cg([_.lK()],f.prototype,"overrideCloneAlphaBetaRadius",void 0),U.Cg([_.P_("target")],f.prototype,"_target",void 0),U.Cg([_.xG("targetHost")],f.prototype,"_targetHost",void 0),U.Cg([_.lK()],f.prototype,"inertialAlphaOffset",void 0),U.Cg([_.lK()],f.prototype,"inertialBetaOffset",void 0),U.Cg([_.lK()],f.prototype,"inertialRadiusOffset",void 0),U.Cg([_.lK()],f.prototype,"lowerAlphaLimit",void 0),U.Cg([_.lK()],f.prototype,"upperAlphaLimit",void 0),U.Cg([_.lK()],f.prototype,"lowerBetaLimit",void 0),U.Cg([_.lK()],f.prototype,"upperBetaLimit",void 0),U.Cg([_.lK()],f.prototype,"lowerRadiusLimit",void 0),U.Cg([_.lK()],f.prototype,"upperRadiusLimit",void 0),U.Cg([_.lK()],f.prototype,"inertialPanningX",void 0),U.Cg([_.lK()],f.prototype,"inertialPanningY",void 0),U.Cg([_.lK()],f.prototype,"pinchToPanMaxDistance",void 0),U.Cg([_.lK()],f.prototype,"panningDistanceLimit",void 0),U.Cg([_.P_()],f.prototype,"panningOriginTarget",void 0),U.Cg([_.lK()],f.prototype,"panningInertia",void 0),U.Cg([_.lK()],f.prototype,"zoomToMouseLocation",null),U.Cg([_.lK()],f.prototype,"zoomOnFactor",void 0),U.Cg([_.WM()],f.prototype,"targetScreenOffset",void 0),U.Cg([_.lK()],f.prototype,"allowUpsideDown",void 0),U.Cg([_.lK()],f.prototype,"useInputToRestoreState",void 0),U.Cg([_.lK()],f.prototype,"restoreStateInterpolationFactor",void 0),H.Y5("BABYLON.ArcRotateCamera",f)},552580:(u,x,s)=>{s.d(x,{H:()=>I});var U=s(889610),_=s(907204),W=s(619882),c=s(147003);class I extends c._{constructor(u){super(u)}addMouseWheel(){return this.add(new W.f),this}addPointers(){return this.add(new U.L),this}addKeyboard(){return this.add(new _.n),this}}},564135:(u,x,s)=>{s.d(x,{i:()=>$});var U=s(297809),_=s(760998),W=s(293506),c=s(898973),I=s(638113),L=s(604910),J=s(869581),k=s(706400),i=s(310035),d=s(554014),j=s(60071),r=s(993739),D=s(337776);class $ extends J.b{get position(){return this._position}set position(u){this._position=u}set upVector(u){this._upVector=u}get upVector(){return this._upVector}get screenArea(){var u,x,s,U;let _=0,W=0;if(this.mode===$.PERSPECTIVE_CAMERA)this.fovMode===$.FOVMODE_VERTICAL_FIXED?(W=2*this.minZ*Math.tan(this.fov/2),_=this.getEngine().getAspectRatio(this)*W):(_=2*this.minZ*Math.tan(this.fov/2),W=_/this.getEngine().getAspectRatio(this));else{const c=this.getEngine().getRenderWidth()/2,I=this.getEngine().getRenderHeight()/2;_=(null!==(u=this.orthoRight)&&void 0!==u?u:c)-(null!==(x=this.orthoLeft)&&void 0!==x?x:-c),W=(null!==(s=this.orthoTop)&&void 0!==s?s:I)-(null!==(U=this.orthoBottom)&&void 0!==U?U:-I)}return _*W}set orthoLeft(u){this._orthoLeft=u;for(const x of this._rigCameras)x.orthoLeft=u}get orthoLeft(){return this._orthoLeft}set orthoRight(u){this._orthoRight=u;for(const x of this._rigCameras)x.orthoRight=u}get orthoRight(){return this._orthoRight}set orthoBottom(u){this._orthoBottom=u;for(const x of this._rigCameras)x.orthoBottom=u}get orthoBottom(){return this._orthoBottom}set orthoTop(u){this._orthoTop=u;for(const x of this._rigCameras)x.orthoTop=u}get orthoTop(){return this._orthoTop}set mode(u){this._mode=u;for(const x of this._rigCameras)x.mode=u}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(u,x,s,U=!0){super(u,s,!1),this._position=L.Pq.Zero(),this._upVector=L.Pq.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this._mode=$.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new j.L(0,0,1,1),this.layerMask=268435455,this.fovMode=$.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=$.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new I.cP,this.onProjectionMatrixChangedObservable=new I.cP,this.onAfterCheckInputsObservable=new I.cP,this.onRestoreStateObservable=new I.cP,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new L.uq,this._postProcesses=new Array,this._activeMeshes=new W.L(256),this._globalPosition=L.Pq.Zero(),this._computedViewMatrix=L.uq.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=L.uq.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=L.PT.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.getScene().addCamera(this),U&&!this.getScene().activeCamera&&(this.getScene().activeCamera=this),this.position=x,this.renderPassId=this.getScene().getEngine().createRenderPassId(`Camera ${u}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Camera"}toString(u){let x="Name: "+this.name;if(x+=", type: "+this.getClassName(),this.animations)for(let s=0;s<this.animations.length;s++)x+=", animation[0]: "+this.animations[s].toString(u);return x}applyVerticalCorrection(){const u=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-u.x:u.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(u){return-1!==this._activeMeshes.indexOf(u)}isReady(u=!1){if(u)for(const u of this._postProcesses)if(u&&!u.isReady())return!1;return super.isReady(u)}_initCache(){super._initCache(),this._cache.position=new L.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new L.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(u){u||super._updateCache(),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent()}_isSynchronizedProjectionMatrix(){let u=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!u)return!1;const x=this.getEngine();return this.mode===$.PERSPECTIVE_CAMERA?u=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===x.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(u=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===x.getRenderWidth()&&this._cache.renderHeight===x.getRenderHeight(),this.oblique&&(u=u&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),u}attachControl(u,x){}detachControl(u){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==$.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let u=0;u<this._postProcesses.length;u++)if(null!==this._postProcesses[u])return this._postProcesses[u];return null}_cascadePostProcessesToRigCams(){const u=this._getFirstPostProcess();u&&u.markTextureDirty();for(let u=0,x=this._rigCameras.length;u<x;u++){const x=this._rigCameras[u],s=x._rigPostProcess;s?("pass"===s.getEffectName()&&(x.isIntermediate=0===this._postProcesses.length),x._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()):x._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(u,x=null){return!u.isReusable()&&this._postProcesses.indexOf(u)>-1?(k.V.Error("You're trying to reuse a post process not defined as reusable."),0):(null==x||x<0?this._postProcesses.push(u):null===this._postProcesses[x]?this._postProcesses[x]=u:this._postProcesses.splice(x,0,u),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(u))}detachPostProcess(u){const x=this._postProcesses.indexOf(u);-1!==x&&(this._postProcesses[x]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return L.uq.Identity()}getViewMatrix(u){return!u&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(u){this._doNotComputeProjectionMatrix=!0,void 0!==u&&(this._projectionMatrix=u)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(u){var x,s,U,_,W,c,I,J,k,i,d,j,r,D,H,f,O,t,V;if(this._doNotComputeProjectionMatrix||!u&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const N=this.getEngine(),m=this.getScene(),b=N.useReverseDepthBuffer;if(this.mode===$.PERSPECTIVE_CAMERA){let u;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=N.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1),u=m.useRightHandedSystem?L.uq.PerspectiveFovRHToRef:L.uq.PerspectiveFovLHToRef,u(this.fov,N.getAspectRatio(this),b?this.maxZ:this.minZ,b?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===$.FOVMODE_VERTICAL_FIXED,N.isNDCHalfZRange,this.projectionPlaneTilt,b)}else{const u=N.getRenderWidth()/2,$=N.getRenderHeight()/2;m.useRightHandedSystem?this.oblique?L.uq.ObliqueOffCenterRHToRef(null!==(x=this.orthoLeft)&&void 0!==x?x:-u,null!==(s=this.orthoRight)&&void 0!==s?s:u,null!==(U=this.orthoBottom)&&void 0!==U?U:-$,null!==(_=this.orthoTop)&&void 0!==_?_:$,b?this.maxZ:this.minZ,b?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,N.isNDCHalfZRange):L.uq.OrthoOffCenterRHToRef(null!==(W=this.orthoLeft)&&void 0!==W?W:-u,null!==(c=this.orthoRight)&&void 0!==c?c:u,null!==(I=this.orthoBottom)&&void 0!==I?I:-$,null!==(J=this.orthoTop)&&void 0!==J?J:$,b?this.maxZ:this.minZ,b?this.minZ:this.maxZ,this._projectionMatrix,N.isNDCHalfZRange):this.oblique?L.uq.ObliqueOffCenterLHToRef(null!==(k=this.orthoLeft)&&void 0!==k?k:-u,null!==(i=this.orthoRight)&&void 0!==i?i:u,null!==(d=this.orthoBottom)&&void 0!==d?d:-$,null!==(j=this.orthoTop)&&void 0!==j?j:$,b?this.maxZ:this.minZ,b?this.minZ:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,N.isNDCHalfZRange):L.uq.OrthoOffCenterLHToRef(null!==(r=this.orthoLeft)&&void 0!==r?r:-u,null!==(D=this.orthoRight)&&void 0!==D?D:u,null!==(H=this.orthoBottom)&&void 0!==H?H:-$,null!==(f=this.orthoTop)&&void 0!==f?f:$,b?this.maxZ:this.minZ,b?this.minZ:this.maxZ,this._projectionMatrix,N.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(O=this.oblique)||void 0===O?void 0:O.angle,this._cache.obliqueLength=null===(t=this.oblique)||void 0===t?void 0:t.length,this._cache.obliqueOffset=null===(V=this.oblique)||void 0===V?void 0:V.offset,this._cache.renderWidth=N.getRenderWidth(),this._cache.renderHeight=N.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(u){return(this.radius||(this.target?L.Pq.Distance(this.position,this.target):this.position.length()))+u}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?r.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=r.P.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(u,x=!1){if(this._updateFrustumPlanes(),x&&this.rigCameras.length>0){let x=!1;return this.rigCameras.forEach((s=>{s._updateFrustumPlanes(),x=x||u.isInFrustum(s._frustumPlanes)})),x}return u.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(u){return this._updateFrustumPlanes(),u.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(u=100,x,s){throw d.n("Ray")}getForwardRayToRef(u,x=100,s,U){throw d.n("Ray")}dispose(u,x=!1){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this._parentContainer){const u=this._parentContainer.cameras.indexOf(this);u>-1&&this._parentContainer.cameras.splice(u,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==$.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let u=this._postProcesses.length;for(;--u>=0;){const x=this._postProcesses[u];x&&x.dispose(this)}}let s=this.customRenderTargets.length;for(;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(u,x)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(u,x){if(this.cameraRigMode!==u){for(;this._rigCameras.length>0;){const u=this._rigCameras.pop();u&&u.dispose()}if(this.cameraRigMode=u,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=x.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=c.S0.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==$.RIG_MODE_NONE){const u=this.createRigCamera(this.name+"_L",0);u&&(u._isLeftCamera=!0);const x=this.createRigCamera(this.name+"_R",1);x&&(x._isRightCamera=!0),u&&x&&(this._rigCameras.push(u),this._rigCameras.push(x))}this._setRigMode(x),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(u){}_getVRProjectionMatrix(){return L.uq.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(u,x){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[u]=x,"interaxialDistance"===u&&(this._cameraRigParams.stereoHalfAngle=c.S0.ToRadians(x/.0637))}createRigCamera(u,x){return null}_updateRigCameras(){for(let u=0;u<this._rigCameras.length;u++)this._rigCameras[u].minZ=this.minZ,this._rigCameras[u].maxZ=this.maxZ,this._rigCameras[u].fov=this.fov,this._rigCameras[u].upVector.copyFrom(this.upVector);this.cameraRigMode===$.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const u=D.p.Serialize(this);return u.uniqueId=this.uniqueId,u.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(u),this.inputs&&this.inputs.serialize(u),D.p.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}clone(u,x=null){const s=D.p.Clone($.GetConstructorFromName(this.getClassName(),u,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return s.name=u,s.parent=x,this.onClonedObservable.notifyObservers(s),s}getDirection(u){const x=L.Pq.Zero();return this.getDirectionToRef(u,x),x}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(u,x){L.Pq.TransformNormalToRef(u,this.getWorldMatrix(),x)}static GetConstructorFromName(u,x,s,U=0,_=!0){return J.b.Construct(u,x,s,{interaxial_distance:U,isStereoscopicSideBySide:_})||(()=>$._CreateDefaultParsedCamera(x,s))}computeWorldMatrix(){return this.getWorldMatrix()}static Parse(u,x){const s=u.type,U=$.GetConstructorFromName(s,u.name,x,u.interaxial_distance,u.isStereoscopicSideBySide),_=D.p.Parse(U,u,x);if(void 0!==u.parentId&&(_._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(_._waitingParentInstanceIndex=u.parentInstanceIndex),_.inputs&&(_.inputs.parse(u),_._setupInputs()),u.upVector&&(_.upVector=L.Pq.FromArray(u.upVector)),_.setPosition&&(_.position.copyFromFloats(0,0,0),_.setPosition(L.Pq.FromArray(u.position))),u.target&&_.setTarget&&_.setTarget(L.Pq.FromArray(u.target)),u.cameraRigMode){const x=u.interaxial_distance?{interaxialDistance:u.interaxial_distance}:{};_.setCameraRigMode(u.cameraRigMode,x)}if(u.animations){for(let x=0;x<u.animations.length;x++){const s=u.animations[x],U=i.n9("BABYLON.Animation");U&&_.animations.push(U.Parse(s))}J.b.ParseAnimationRanges(_,u,x)}return u.autoAnimate&&x.beginAnimation(_,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&_.setEnabled(u.isEnabled),_}_calculateHandednessMultiplier(){let u=this.getScene().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(u*=-1),u}}$._CreateDefaultParsedCamera=(u,x)=>{throw d.n("UniversalCamera")},$.PERSPECTIVE_CAMERA=0,$.ORTHOGRAPHIC_CAMERA=1,$.FOVMODE_VERTICAL_FIXED=0,$.FOVMODE_HORIZONTAL_FIXED=1,$.RIG_MODE_NONE=0,$.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,$.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,$.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,$.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,$.RIG_MODE_STEREOSCOPIC_INTERLACED=14,$.RIG_MODE_VR=20,$.RIG_MODE_CUSTOM=22,$.ForceAttachControlToAlwaysPreventDefault=!1,U.Cg([_.P_("position")],$.prototype,"_position",void 0),U.Cg([_.P_("upVector")],$.prototype,"_upVector",void 0),U.Cg([_.lK()],$.prototype,"orthoLeft",null),U.Cg([_.lK()],$.prototype,"orthoRight",null),U.Cg([_.lK()],$.prototype,"orthoBottom",null),U.Cg([_.lK()],$.prototype,"orthoTop",null),U.Cg([_.lK()],$.prototype,"fov",void 0),U.Cg([_.lK()],$.prototype,"projectionPlaneTilt",void 0),U.Cg([_.lK()],$.prototype,"minZ",void 0),U.Cg([_.lK()],$.prototype,"maxZ",void 0),U.Cg([_.lK()],$.prototype,"inertia",void 0),U.Cg([_.lK()],$.prototype,"mode",null),U.Cg([_.lK()],$.prototype,"layerMask",void 0),U.Cg([_.lK()],$.prototype,"fovMode",void 0),U.Cg([_.lK()],$.prototype,"cameraRigMode",void 0),U.Cg([_.lK()],$.prototype,"interaxialDistance",void 0),U.Cg([_.lK()],$.prototype,"isStereoscopicSideBySide",void 0)},147003:(u,x,s)=>{s.d(x,{H:()=>c,_:()=>I});var U=s(706400),_=s(337776),W=s(564135),c={};class I{constructor(u){this.attachedToElement=!1,this.attached={},this.camera=u,this.checkInputs=()=>{}}add(u){const x=u.getSimpleName();this.attached[x]?U.V.Warn("camera input of type "+x+" already exists on camera"):(this.attached[x]=u,u.camera=this.camera,u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u))),this.attachedToElement&&u.attachControl(this.noPreventDefault))}remove(u){for(const x in this.attached){const s=this.attached[x];if(s===u)return s.detachControl(),s.camera=null,delete this.attached[x],void this.rebuildInputCheck()}}removeByType(u){for(const x in this.attached){const s=this.attached[x];s.getClassName()===u&&(s.detachControl(),s.camera=null,delete this.attached[x],this.rebuildInputCheck())}}_addCheckInputs(u){const x=this.checkInputs;return()=>{x(),u()}}attachInput(u){this.attachedToElement&&u.attachControl(this.noPreventDefault)}attachElement(u=!1){if(!this.attachedToElement){u=!W.i.ForceAttachControlToAlwaysPreventDefault&&u,this.attachedToElement=!0,this.noPreventDefault=u;for(const x in this.attached)this.attached[x].attachControl(u)}}detachElement(u=!1){for(const x in this.attached)this.attached[x].detachControl(),u&&(this.attached[x].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const u in this.attached){const x=this.attached[u];x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(u){const x={};for(const u in this.attached){const s=this.attached[u],U=_.p.Serialize(s);x[s.getClassName()]=U}u.inputsmgr=x}parse(u){const x=u.inputsmgr;if(x){this.clear();for(const u in x){const s=c[u];if(s){const U=x[u],W=_.p.Parse((()=>new s),U,null);this.add(W)}}}else for(const x in this.attached){const s=c[this.attached[x].getClassName()];if(s){const U=_.p.Parse((()=>new s),u,null);this.remove(this.attached[x]),this.add(U)}}}}},787618:(u,x,s)=>{s.d(x,{F:()=>J});var U=s(297809),_=s(760998),W=s(564135),c=s(604910),I=s(779908),L=s(690096);s(869581).b.AddNodeConstructor("TargetCamera",((u,x)=>()=>new J(u,c.Pq.Zero(),x)));class J extends W.i{constructor(u,x,s,U=!0){super(u,x,s,U),this._tmpUpVector=c.Pq.Zero(),this._tmpTargetVector=c.Pq.Zero(),this.cameraDirection=new c.Pq(0,0,0),this.cameraRotation=new c.I9(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new c.PT,this.rotation=new c.Pq(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=c.Pq.Zero(),this._initialFocalDistance=1,this._viewMatrix=c.uq.Zero(),this._camMatrix=c.uq.Zero(),this._cameraTransformMatrix=c.uq.Zero(),this._cameraRotationMatrix=c.uq.Zero(),this._referencePoint=new c.Pq(0,0,1),this._transformedReferencePoint=c.Pq.Zero(),this._deferredPositionUpdate=new c.Pq,this._deferredRotationQuaternionUpdate=new c.PT,this._deferredRotationUpdate=new c.Pq,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=c.Pq.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(u){this.getWorldMatrix();const x=this.getTarget().subtract(this.position);return x.normalize(),x.scaleInPlace(u),this.globalPosition.add(x)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const u=this.lockedTarget;u.computeWorldMatrix().getTranslationToRef(u.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new c.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new c.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new c.PT(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(u){u||super._updateCache();const x=this._getLockedTargetPosition();x?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(x):this._cache.lockedTarget=x.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const u=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(u):!u)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const u=this.getEngine();return this.speed*Math.sqrt(u.getDeltaTime()/(100*u.getFps()))}setTarget(u){this.upVector.normalize(),this._initialFocalDistance=u.subtract(this.position).length(),this.position.z===u.z&&(this.position.z+=I.bH),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),c.uq.LookAtLHToRef(this.position,u,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const x=u.subtract(this.position);x.x>=0?this.rotation.y=-Math.atan(x.z/x.x)+Math.PI/2:this.rotation.y=-Math.atan(x.z/x.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&c.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(u){this.setTarget(u)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(c.AA.Matrix[0]),c.Pq.TransformNormalToRef(this.cameraDirection,c.AA.Matrix[0],c.AA.Vector3[0]),this._deferredPositionUpdate.addInPlace(c.AA.Vector3[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.copyFrom(this._deferredPositionUpdate)}_checkInputs(){const u=this.invertRotation?-this.inverseRotationSpeed:1,x=this._decideIfNeedsToMove(),s=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.copyFrom(this.rotation),this._deferredPositionUpdate.copyFrom(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.copyFrom(this.rotationQuaternion),x&&this._updatePosition(),s){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*u,this._deferredRotationUpdate.y+=this.cameraRotation.y*u,!this.noRotationConstraint){const u=1.570796;this._deferredRotationUpdate.x>u&&(this._deferredRotationUpdate.x=u),this._deferredRotationUpdate.x<-u&&(this._deferredRotationUpdate.x=-u)}this._deferOnly?this._deferredUpdated=!0:this.rotation.copyFrom(this._deferredRotationUpdate),this.rotationQuaternion&&this._deferredRotationUpdate.lengthSquared()&&(c.PT.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.copyFrom(this._deferredRotationQuaternionUpdate))}x&&(Math.abs(this.cameraDirection.x)<this.speed*I.bH&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*I.bH&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*I.bH&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),s&&(Math.abs(this.cameraRotation.x)<this.speed*I.bH&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*I.bH&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):c.uq.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return c.Pq.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),c.Pq.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?L._0.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(c.PT.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),L._0.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(u,x,s){if(this.ignoreParentScaling){if(this.parent){const U=this.parent.getWorldMatrix();c.Pq.TransformCoordinatesToRef(u,U,this._globalPosition),c.Pq.TransformCoordinatesToRef(x,U,this._tmpTargetVector),c.Pq.TransformNormalToRef(s,U,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(u),this._tmpTargetVector.copyFrom(x),this._tmpUpVector.copyFrom(s);this.getScene().useRightHandedSystem?c.uq.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):c.uq.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.getScene().useRightHandedSystem?c.uq.LookAtRHToRef(u,x,s,this._viewMatrix):c.uq.LookAtLHToRef(u,x,s,this._viewMatrix),this.parent){const u=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(u,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(u)}createRigCamera(u,x){if(this.cameraRigMode!==W.i.RIG_MODE_NONE){const x=new J(u,this.position.clone(),this.getScene());return x.isRigCamera=!0,x.rigParent=this,this.cameraRigMode===W.i.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new c.PT),x._cameraRigParams={},x.rotationQuaternion=new c.PT),x.mode=this.mode,x.orthoLeft=this.orthoLeft,x.orthoRight=this.orthoRight,x.orthoTop=this.orthoTop,x.orthoBottom=this.orthoBottom,x}return null}_updateRigCameras(){const u=this._rigCameras[0],x=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case W.i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case W.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case W.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case W.i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case W.i.RIG_MODE_STEREOSCOPIC_INTERLACED:{const s=this.cameraRigMode===W.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,U=this.cameraRigMode===W.i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*s,u),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*U,x);break}case W.i.RIG_MODE_VR:u.rotationQuaternion?(u.rotationQuaternion.copyFrom(this.rotationQuaternion),x.rotationQuaternion.copyFrom(this.rotationQuaternion)):(u.rotation.copyFrom(this.rotation),x.rotation.copyFrom(this.rotation)),u.position.copyFrom(this.position),x.position.copyFrom(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(u,x){this.getTarget().subtractToRef(this.position,J._TargetFocalPoint),J._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const s=J._TargetFocalPoint.addInPlace(this.position);c.uq.TranslationToRef(-s.x,-s.y,-s.z,J._TargetTransformMatrix),J._TargetTransformMatrix.multiplyToRef(c.uq.RotationAxis(x.upVector,u),J._RigCamTransformMatrix),c.uq.TranslationToRef(s.x,s.y,s.z,J._TargetTransformMatrix),J._RigCamTransformMatrix.multiplyToRef(J._TargetTransformMatrix,J._RigCamTransformMatrix),c.Pq.TransformCoordinatesToRef(this.position,J._RigCamTransformMatrix,x.position),x.setTarget(s)}getClassName(){return"TargetCamera"}}J._RigCamTransformMatrix=new c.uq,J._TargetTransformMatrix=new c.uq,J._TargetFocalPoint=new c.Pq,U.Cg([_.P_()],J.prototype,"rotation",void 0),U.Cg([_.lK()],J.prototype,"speed",void 0),U.Cg([_.xG("lockedTargetId")],J.prototype,"lockedTarget",void 0)},7686:(u,x,s)=>{s.d(x,{w:()=>U});class U{constructor(u,x,s){this.bu=u,this.bv=x,this.distance=s,this.faceId=0,this.subMeshId=0}}},775316:(u,x,s)=>{s.d(x,{j:()=>_});var U=s(604910);class _{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new U.Pq(0,0,0),this._diffPositionForCollisions=new U.Pq(0,0,0),this._collisionResponse=!0}}},79160:(u,x,s)=>{s.d(x,{G:()=>W});var U=s(604910),_=s(23987);class W{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(u=!1,x=!0){if(!this.pickedMesh||x&&!this.pickedMesh.isVerticesDataPresent(_.R.NormalKind))return null;let s,W=this.pickedMesh.getIndices();0===(null==W?void 0:W.length)&&(W=null);const c=U.AA.Vector3[0],I=U.AA.Vector3[1],L=U.AA.Vector3[2];if(x){const u=this.pickedMesh.getVerticesData(_.R.NormalKind);let x=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId],c):c.copyFromFloats(u[3*this.faceId*3],u[3*this.faceId*3+1],u[3*this.faceId*3+2]),J=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId+1],I):I.copyFromFloats(u[3*(3*this.faceId+1)],u[3*(3*this.faceId+1)+1],u[3*(3*this.faceId+1)+2]),k=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId+2],L):L.copyFromFloats(u[3*(3*this.faceId+2)],u[3*(3*this.faceId+2)+1],u[3*(3*this.faceId+2)+2]);x=x.scale(this.bu),J=J.scale(this.bv),k=k.scale(1-this.bu-this.bv),s=new U.Pq(x.x+J.x+k.x,x.y+J.y+k.y,x.z+J.z+k.z)}else{const u=this.pickedMesh.getVerticesData(_.R.PositionKind),x=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId],c):c.copyFromFloats(u[3*this.faceId*3],u[3*this.faceId*3+1],u[3*this.faceId*3+2]),J=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId+1],I):I.copyFromFloats(u[3*(3*this.faceId+1)],u[3*(3*this.faceId+1)+1],u[3*(3*this.faceId+1)+2]),k=W?U.Pq.FromArrayToRef(u,3*W[3*this.faceId+2],L):L.copyFromFloats(u[3*(3*this.faceId+2)],u[3*(3*this.faceId+2)+1],u[3*(3*this.faceId+2)+2]),i=x.subtract(J),d=k.subtract(J);s=U.Pq.Cross(i,d)}const J=(u,x)=>{let s=u.getWorldMatrix();u.nonUniformScaling&&(U.AA.Matrix[0].copyFrom(s),s=U.AA.Matrix[0],s.setTranslationFromFloats(0,0,0),s.invert(),s.transposeToRef(U.AA.Matrix[1]),s=U.AA.Matrix[1]),U.Pq.TransformNormalToRef(x,s,x)};if(u&&J(this.pickedMesh,s),this.ray){const x=U.AA.Vector3[0].copyFrom(s);u||J(this.pickedMesh,x),U.Pq.Dot(x,this.ray.direction)>0&&s.negateInPlace()}return s.normalize(),s}getTextureCoordinates(u=_.R.UVKind){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(u))return null;const x=this.pickedMesh.getIndices();if(!x)return null;const s=this.pickedMesh.getVerticesData(u);if(!s)return null;let W=U.I9.FromArray(s,2*x[3*this.faceId]),c=U.I9.FromArray(s,2*x[3*this.faceId+1]),I=U.I9.FromArray(s,2*x[3*this.faceId+2]);return W=W.scale(this.bu),c=c.scale(this.bv),I=I.scale(1-this.bu-this.bv),new U.I9(W.x+c.x+I.x,W.y+c.y+I.y)}}},158548:(u,x,s)=>{s.d(x,{p9:()=>_,rX:()=>U});let U=!1;const _={get UseOpenGLOrientationForUV(){return U},set UseOpenGLOrientationForUV(u){U=u}}},747979:(u,x,s)=>{s.d(x,{I:()=>c});var U=s(967872),_=s(604910),W=s(779908);class c{constructor(u,x,s){this.vectors=U.mI(8,_.Pq.Zero),this.center=_.Pq.Zero(),this.centerWorld=_.Pq.Zero(),this.extendSize=_.Pq.Zero(),this.extendSizeWorld=_.Pq.Zero(),this.directions=U.mI(3,_.Pq.Zero),this.vectorsWorld=U.mI(8,_.Pq.Zero),this.minimumWorld=_.Pq.Zero(),this.maximumWorld=_.Pq.Zero(),this.minimum=_.Pq.Zero(),this.maximum=_.Pq.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(u,x,s)}reConstruct(u,x,s){const U=u.x,W=u.y,c=u.z,I=x.x,L=x.y,J=x.z,k=this.vectors;this.minimum.copyFromFloats(U,W,c),this.maximum.copyFromFloats(I,L,J),k[0].copyFromFloats(U,W,c),k[1].copyFromFloats(I,L,J),k[2].copyFromFloats(I,W,c),k[3].copyFromFloats(U,L,c),k[4].copyFromFloats(U,W,J),k[5].copyFromFloats(I,L,c),k[6].copyFromFloats(U,L,J),k[7].copyFromFloats(I,W,J),x.addToRef(u,this.center).scaleInPlace(.5),x.subtractToRef(u,this.extendSize).scaleInPlace(.5),this._worldMatrix=s||_.uq.IdentityReadOnly,this._update(this._worldMatrix)}scale(u){const x=c._TmpVector3,s=this.maximum.subtractToRef(this.minimum,x[0]),U=s.length();s.normalizeFromLength(U);const _=U*u,W=s.scaleInPlace(.5*_),I=this.center.subtractToRef(W,x[1]),L=this.center.addToRef(W,x[2]);return this.reConstruct(I,L,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(u){const x=this.minimumWorld,s=this.maximumWorld,U=this.directions,W=this.vectorsWorld,c=this.vectors;if(u.isIdentity()){x.copyFrom(this.minimum),s.copyFrom(this.maximum);for(let u=0;u<8;++u)W[u].copyFrom(c[u]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{x.setAll(Number.MAX_VALUE),s.setAll(-Number.MAX_VALUE);for(let U=0;U<8;++U){const I=W[U];_.Pq.TransformCoordinatesToRef(c[U],u,I),x.minimizeInPlace(I),s.maximizeInPlace(I)}s.subtractToRef(x,this.extendSizeWorld).scaleInPlace(.5),s.addToRef(x,this.centerWorld).scaleInPlace(.5)}_.Pq.FromArrayToRef(u.m,0,U[0]),_.Pq.FromArrayToRef(u.m,4,U[1]),_.Pq.FromArrayToRef(u.m,8,U[2]),this._worldMatrix=u}isInFrustum(u){return c.IsInFrustum(this.vectorsWorld,u)}isCompletelyInFrustum(u){return c.IsCompletelyInFrustum(this.vectorsWorld,u)}intersectsPoint(u){const x=this.minimumWorld,s=this.maximumWorld,U=x.x,_=x.y,c=x.z,I=s.x,L=s.y,J=s.z,k=u.x,i=u.y,d=u.z,j=-W.bH;return!(I-k<j||j>k-U||L-i<j||j>i-_||J-d<j||j>d-c)}intersectsSphere(u){return c.IntersectsSphere(this.minimumWorld,this.maximumWorld,u.centerWorld,u.radiusWorld)}intersectsMinMax(u,x){const s=this.minimumWorld,U=this.maximumWorld,_=s.x,W=s.y,c=s.z,I=U.x,L=U.y,J=U.z,k=u.x,i=u.y,d=u.z,j=x.x,r=x.y,D=x.z;return!(I<k||_>j||L<i||W>r||J<d||c>D)}dispose(){var u,x;null===(u=this._drawWrapperFront)||void 0===u||u.dispose(),null===(x=this._drawWrapperBack)||void 0===x||x.dispose()}static Intersects(u,x){return u.intersectsMinMax(x.minimumWorld,x.maximumWorld)}static IntersectsSphere(u,x,s,U){const W=c._TmpVector3[0];return _.Pq.ClampToRef(s,u,x,W),_.Pq.DistanceSquared(s,W)<=U*U}static IsCompletelyInFrustum(u,x){for(let s=0;s<6;++s){const U=x[s];for(let x=0;x<8;++x)if(U.dotCoordinate(u[x])<0)return!1}return!0}static IsInFrustum(u,x){for(let s=0;s<6;++s){let U=!0;const _=x[s];for(let x=0;x<8;++x)if(_.dotCoordinate(u[x])>=0){U=!1;break}if(U)return!1}return!0}}c._TmpVector3=U.mI(3,_.Pq.Zero)},59036:(u,x,s)=>{s.d(x,{j:()=>i});var U=s(967872),_=s(604910),W=s(747979),c=s(214601);const I={min:0,max:0},L={min:0,max:0},J=(u,x,s)=>{const U=_.Pq.Dot(x.centerWorld,u),W=Math.abs(_.Pq.Dot(x.directions[0],u))*x.extendSize.x+Math.abs(_.Pq.Dot(x.directions[1],u))*x.extendSize.y+Math.abs(_.Pq.Dot(x.directions[2],u))*x.extendSize.z;s.min=U-W,s.max=U+W},k=(u,x,s)=>(J(u,x,I),J(u,s,L),!(I.min>L.max||L.min>I.max));class i{constructor(u,x,s){this._isLocked=!1,this.boundingBox=new W.I(u,x,s),this.boundingSphere=new c.i(u,x,s)}reConstruct(u,x,s){this.boundingBox.reConstruct(u,x,s),this.boundingSphere.reConstruct(u,x,s)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(u){this._isLocked=u}update(u){this._isLocked||(this.boundingBox._update(u),this.boundingSphere._update(u))}centerOn(u,x){const s=i._TmpVector3[0].copyFrom(u).subtractInPlace(x),U=i._TmpVector3[1].copyFrom(u).addInPlace(x);return this.boundingBox.reConstruct(s,U,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(s,U,this.boundingBox.getWorldMatrix()),this}encapsulate(u){const x=_.Pq.Minimize(this.minimum,u),s=_.Pq.Maximize(this.maximum,u);return this.reConstruct(x,s,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(u){const x=_.AA.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(x);const s=_.AA.Vector3[0];return _.Pq.TransformCoordinatesToRef(u.boundingBox.minimumWorld,x,s),this.encapsulate(s),_.Pq.TransformCoordinatesToRef(u.boundingBox.maximumWorld,x,s),this.encapsulate(s),this}scale(u){return this.boundingBox.scale(u),this.boundingSphere.scale(u),this}isInFrustum(u,x=0){return!(2!==x&&3!==x||!this.boundingSphere.isCenterInFrustum(u))||!!this.boundingSphere.isInFrustum(u)&&(!(1!==x&&3!==x)||this.boundingBox.isInFrustum(u))}get diagonalLength(){const u=this.boundingBox;return u.maximumWorld.subtractToRef(u.minimumWorld,i._TmpVector3[0]).length()}isCompletelyInFrustum(u){return this.boundingBox.isCompletelyInFrustum(u)}_checkCollision(u){return u._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(u){return!!this.boundingSphere.centerWorld&&!!this.boundingSphere.intersectsPoint(u)&&!!this.boundingBox.intersectsPoint(u)}intersects(u,x){if(!c.i.Intersects(this.boundingSphere,u.boundingSphere))return!1;if(!W.I.Intersects(this.boundingBox,u.boundingBox))return!1;if(!x)return!0;const s=this.boundingBox,U=u.boundingBox;return!!(k(s.directions[0],s,U)&&k(s.directions[1],s,U)&&k(s.directions[2],s,U)&&k(U.directions[0],s,U)&&k(U.directions[1],s,U)&&k(U.directions[2],s,U)&&k(_.Pq.Cross(s.directions[0],U.directions[0]),s,U)&&k(_.Pq.Cross(s.directions[0],U.directions[1]),s,U)&&k(_.Pq.Cross(s.directions[0],U.directions[2]),s,U)&&k(_.Pq.Cross(s.directions[1],U.directions[0]),s,U)&&k(_.Pq.Cross(s.directions[1],U.directions[1]),s,U)&&k(_.Pq.Cross(s.directions[1],U.directions[2]),s,U)&&k(_.Pq.Cross(s.directions[2],U.directions[0]),s,U)&&k(_.Pq.Cross(s.directions[2],U.directions[1]),s,U)&&k(_.Pq.Cross(s.directions[2],U.directions[2]),s,U))}}i._TmpVector3=U.mI(2,_.Pq.Zero)},214601:(u,x,s)=>{s.d(x,{i:()=>W});var U=s(967872),_=s(604910);class W{constructor(u,x,s){this.center=_.Pq.Zero(),this.centerWorld=_.Pq.Zero(),this.minimum=_.Pq.Zero(),this.maximum=_.Pq.Zero(),this.reConstruct(u,x,s)}reConstruct(u,x,s){this.minimum.copyFrom(u),this.maximum.copyFrom(x);const U=_.Pq.Distance(u,x);x.addToRef(u,this.center).scaleInPlace(.5),this.radius=.5*U,this._update(s||_.uq.IdentityReadOnly)}scale(u){const x=this.radius*u,s=W._TmpVector3,U=s[0].setAll(x),_=this.center.subtractToRef(U,s[1]),c=this.center.addToRef(U,s[2]);return this.reConstruct(_,c,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(u){if(u.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{_.Pq.TransformCoordinatesToRef(this.center,u,this.centerWorld);const x=W._TmpVector3[0];_.Pq.TransformNormalFromFloatsToRef(1,1,1,u,x),this.radiusWorld=Math.max(Math.abs(x.x),Math.abs(x.y),Math.abs(x.z))*this.radius}}isInFrustum(u){const x=this.centerWorld,s=this.radiusWorld;for(let U=0;U<6;U++)if(u[U].dotCoordinate(x)<=-s)return!1;return!0}isCenterInFrustum(u){const x=this.centerWorld;for(let s=0;s<6;s++)if(u[s].dotCoordinate(x)<0)return!1;return!0}intersectsPoint(u){const x=_.Pq.DistanceSquared(this.centerWorld,u);return!(this.radiusWorld*this.radiusWorld<x)}static Intersects(u,x){const s=_.Pq.DistanceSquared(u.centerWorld,x.centerWorld),U=u.radiusWorld+x.radiusWorld;return!(U*U<s)}static CreateFromCenterAndRadius(u,x,s){this._TmpVector3[0].copyFrom(u),this._TmpVector3[1].copyFromFloats(0,0,x),this._TmpVector3[2].copyFrom(u),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);const U=new W(this._TmpVector3[0],this._TmpVector3[2]);return U._worldMatrix=s||_.uq.Identity(),U}}W._TmpVector3=U.mI(3,_.Pq.Zero)},988514:(u,x,s)=>{s.d(x,{R:()=>i});var U=s(967872),_=s(604910),W=s(79160),c=s(7686),I=s(889460),L=s(564135),J=s(395726),k=s(779908);class i{constructor(u,x,s=Number.MAX_VALUE,U=k.bH){this.origin=u,this.direction=x,this.length=s,this.epsilon=U}clone(){return new i(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(u,x,s=0){const U=i._TmpVector3[0].copyFromFloats(u.x-s,u.y-s,u.z-s),_=i._TmpVector3[1].copyFromFloats(x.x+s,x.y+s,x.z+s);let W,c,I,L,J=0,k=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<U.x||this.origin.x>_.x)return!1}else if(W=1/this.direction.x,c=(U.x-this.origin.x)*W,I=(_.x-this.origin.x)*W,I===-1/0&&(I=1/0),c>I&&(L=c,c=I,I=L),J=Math.max(c,J),k=Math.min(I,k),J>k)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<U.y||this.origin.y>_.y)return!1}else if(W=1/this.direction.y,c=(U.y-this.origin.y)*W,I=(_.y-this.origin.y)*W,I===-1/0&&(I=1/0),c>I&&(L=c,c=I,I=L),J=Math.max(c,J),k=Math.min(I,k),J>k)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<U.z||this.origin.z>_.z)return!1}else if(W=1/this.direction.z,c=(U.z-this.origin.z)*W,I=(_.z-this.origin.z)*W,I===-1/0&&(I=1/0),c>I&&(L=c,c=I,I=L),J=Math.max(c,J),k=Math.min(I,k),J>k)return!1;return!0}intersectsBox(u,x=0){return this.intersectsBoxMinMax(u.minimum,u.maximum,x)}intersectsSphere(u,x=0){const s=u.center.x-this.origin.x,U=u.center.y-this.origin.y,_=u.center.z-this.origin.z,W=s*s+U*U+_*_,c=u.radius+x,I=c*c;if(W<=I)return!0;const L=s*this.direction.x+U*this.direction.y+_*this.direction.z;return!(L<0)&&W-L*L<=I}intersectsTriangle(u,x,s){const U=i._TmpVector3[0],W=i._TmpVector3[1],I=i._TmpVector3[2],L=i._TmpVector3[3],J=i._TmpVector3[4];x.subtractToRef(u,U),s.subtractToRef(u,W),_.Pq.CrossToRef(this.direction,W,I);const k=_.Pq.Dot(U,I);if(0===k)return null;const d=1/k;this.origin.subtractToRef(u,L);const j=_.Pq.Dot(L,I)*d;if(j<-this.epsilon||j>1+this.epsilon)return null;_.Pq.CrossToRef(L,U,J);const r=_.Pq.Dot(this.direction,J)*d;if(r<-this.epsilon||j+r>1+this.epsilon)return null;const D=_.Pq.Dot(W,J)*d;return D>this.length?null:new c.w(1-j-r,j,D)}intersectsPlane(u){let x;const s=_.Pq.Dot(u.normal,this.direction);if(Math.abs(s)<9.99999997475243e-7)return null;{const U=_.Pq.Dot(u.normal,this.origin);return x=(-u.d-U)/s,x<0?x<-9.99999997475243e-7?null:0:x}}intersectsAxis(u,x=0){switch(u){case"y":{const u=(this.origin.y-x)/this.direction.y;return u>0?null:new _.Pq(this.origin.x+this.direction.x*-u,x,this.origin.z+this.direction.z*-u)}case"x":{const u=(this.origin.x-x)/this.direction.x;return u>0?null:new _.Pq(x,this.origin.y+this.direction.y*-u,this.origin.z+this.direction.z*-u)}case"z":{const u=(this.origin.z-x)/this.direction.z;return u>0?null:new _.Pq(this.origin.x+this.direction.x*-u,this.origin.y+this.direction.y*-u,x)}default:return null}}intersectsMesh(u,x,s,U=!1,W,c=!1){const I=_.AA.Matrix[0];return u.getWorldMatrix().invertToRef(I),this._tmpRay?i.TransformToRef(this,I,this._tmpRay):this._tmpRay=i.Transform(this,I),u.intersects(this._tmpRay,x,s,U,W,c)}intersectsMeshes(u,x,s){s?s.length=0:s=[];for(let U=0;U<u.length;U++){const _=this.intersectsMesh(u[U],x);_.hit&&s.push(_)}return s.sort(this._comparePickingInfo),s}_comparePickingInfo(u,x){return u.distance<x.distance?-1:u.distance>x.distance?1:0}intersectionSegment(u,x,s){const U=this.origin,W=_.AA.Vector3[0],c=_.AA.Vector3[1],I=_.AA.Vector3[2],L=_.AA.Vector3[3];x.subtractToRef(u,W),this.direction.scaleToRef(i._Rayl,I),U.addToRef(I,c),u.subtractToRef(U,L);const J=_.Pq.Dot(W,W),k=_.Pq.Dot(W,I),d=_.Pq.Dot(I,I),j=_.Pq.Dot(W,L),r=_.Pq.Dot(I,L),D=J*d-k*k;let $,H,f=D,O=D;D<i._Smallnum?($=0,f=1,H=r,O=d):($=k*r-d*j,H=J*r-k*j,$<0?($=0,H=r,O=d):$>f&&($=f,H=r+k,O=d)),H<0?(H=0,-j<0?$=0:-j>J?$=f:($=-j,f=J)):H>O&&(H=O,-j+k<0?$=0:-j+k>J?$=f:($=-j+k,f=J));const t=Math.abs($)<i._Smallnum?0:$/f,V=Math.abs(H)<i._Smallnum?0:H/O,N=_.AA.Vector3[4];I.scaleToRef(V,N);const m=_.AA.Vector3[5];W.scaleToRef(t,m),m.addInPlace(L);const b=_.AA.Vector3[6];return m.subtractToRef(N,b),V>0&&V<=this.length&&b.lengthSquared()<s*s?m.length():-1}update(u,x,s,U,W,c,I,L=!1){if(L){i._RayDistant||(i._RayDistant=i.Zero()),i._RayDistant.unprojectRayToRef(u,x,s,U,_.uq.IdentityReadOnly,c,I);const L=_.AA.Matrix[0];W.invertToRef(L),i.TransformToRef(i._RayDistant,L,this)}else this.unprojectRayToRef(u,x,s,U,W,c,I);return this}static Zero(){return new i(_.Pq.Zero(),_.Pq.Zero())}static CreateNew(u,x,s,U,_,W,c){return i.Zero().update(u,x,s,U,_,W,c)}static CreateNewFromTo(u,x,s=_.uq.IdentityReadOnly){const U=new i(new _.Pq(0,0,0),new _.Pq(0,0,0));return i.CreateFromToToRef(u,x,U,s)}static CreateFromToToRef(u,x,s,U=_.uq.IdentityReadOnly){s.origin.copyFrom(u);const W=x.subtractToRef(u,s.direction),c=Math.sqrt(W.x*W.x+W.y*W.y+W.z*W.z);return s.length=c,s.direction.normalize(),i.TransformToRef(s,U,s)}static Transform(u,x){const s=new i(new _.Pq(0,0,0),new _.Pq(0,0,0));return i.TransformToRef(u,x,s),s}static TransformToRef(u,x,s){_.Pq.TransformCoordinatesToRef(u.origin,x,s.origin),_.Pq.TransformNormalToRef(u.direction,x,s.direction),s.length=u.length,s.epsilon=u.epsilon;const U=s.direction,W=U.length();if(0!==W&&1!==W){const u=1/W;U.x*=u,U.y*=u,U.z*=u,s.length*=W}return s}unprojectRayToRef(u,x,s,U,W,c,I){const L=_.AA.Matrix[0];W.multiplyToRef(c,L),L.multiplyToRef(I,L),L.invert();const k=J.q.LastCreatedEngine,i=_.AA.Vector3[0];i.x=u/s*2-1,i.y=-(x/U*2-1),i.z=(null==k?void 0:k.useReverseDepthBuffer)?1:(null==k?void 0:k.isNDCHalfZRange)?0:-1;const d=_.AA.Vector3[1].copyFromFloats(i.x,i.y,1-1e-8),j=_.AA.Vector3[2],r=_.AA.Vector3[3];_.Pq._UnprojectFromInvertedMatrixToRef(i,L,j),_.Pq._UnprojectFromInvertedMatrixToRef(d,L,r),this.origin.copyFrom(j),r.subtractToRef(j,this.direction),this.direction.normalize()}}i._TmpVector3=U.mI(6,_.Pq.Zero),i._RayDistant=i.Zero(),i._Smallnum=1e-8,i._Rayl=1e9,I.Z.prototype.createPickingRay=function(u,x,s,U,_=!1){const W=i.Zero();return this.createPickingRayToRef(u,x,s,W,U,_),W},I.Z.prototype.createPickingRayToRef=function(u,x,s,U,W,c=!1,I=!1){const L=this.getEngine();if(!W&&!(W=this.activeCamera))return this;const J=W.viewport,k=L.getRenderHeight(),{x:i,y:d,width:j,height:r}=J.toGlobal(L.getRenderWidth(),k),D=1/L.getHardwareScalingLevel();return u=u*D-i,x=x*D-(k-d-r),U.update(u,x,j,r,s||_.uq.IdentityReadOnly,c?_.uq.IdentityReadOnly:W.getViewMatrix(),W.getProjectionMatrix(),I),this},I.Z.prototype.createPickingRayInCameraSpace=function(u,x,s){const U=i.Zero();return this.createPickingRayInCameraSpaceToRef(u,x,U,s),U},I.Z.prototype.createPickingRayInCameraSpaceToRef=function(u,x,s,U){if(!W.G)return this;const c=this.getEngine();if(!U&&!(U=this.activeCamera))throw new Error("Active camera not set");const I=U.viewport,L=c.getRenderHeight(),{x:J,y:k,width:i,height:d}=I.toGlobal(c.getRenderWidth(),L),j=_.uq.Identity(),r=1/c.getHardwareScalingLevel();return u=u*r-J,x=x*r-(L-k-d),s.update(u,x,i,d,j,j,U.getProjectionMatrix()),this},I.Z.prototype._internalPickForMesh=function(u,x,s,U,_,W,c,I){const L=x(U,s.enableDistantPicking),J=s.intersects(L,_,c,W,U,I);return J&&J.hit?!_&&null!=u&&J.distance>=u.distance?null:J:null},I.Z.prototype._internalPick=function(u,x,s,U,c){let I=null;const L=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),J=this.cameraToUseForPointers||this.activeCamera;for(let W=0;W<this.meshes.length;W++){const k=this.meshes[W];if(x){if(!x(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.isPickable)continue;const i=L&&k.isWorldMatrixCameraDependent(),d=k.computeWorldMatrix(i,J);if(k.hasThinInstances&&k.thinInstanceEnablePicking){const W=this._internalPickForMesh(I,u,k,d,!0,!0,c);if(W){if(U)return W;const L=_.AA.Matrix[1],J=k.thinInstanceGetWorldMatrices();for(let _=0;_<J.length;_++){if(x&&!x(k,_))continue;J[_].multiplyToRef(d,L);const W=this._internalPickForMesh(I,u,k,L,s,U,c,!0);if(W&&(I=W,I.thinInstanceIndex=_,s))return I}}}else{const x=this._internalPickForMesh(I,u,k,d,s,U,c);if(x&&(I=x,s))return I}}return I||new W.G},I.Z.prototype._internalMultiPick=function(u,x,s){if(!W.G)return null;const U=[],c=!!(this.activeCameras&&this.activeCameras.length>1&&this.cameraToUseForPointers!==this.activeCamera),I=this.cameraToUseForPointers||this.activeCamera;for(let W=0;W<this.meshes.length;W++){const L=this.meshes[W];if(x){if(!x(L,-1))continue}else if(!L.isEnabled()||!L.isVisible||!L.isPickable)continue;const J=c&&L.isWorldMatrixCameraDependent(),k=L.computeWorldMatrix(J,I);if(L.hasThinInstances&&L.thinInstanceEnablePicking){if(this._internalPickForMesh(null,u,L,k,!0,!0,s)){const W=_.AA.Matrix[1],c=L.thinInstanceGetWorldMatrices();for(let _=0;_<c.length;_++){if(x&&!x(L,_))continue;c[_].multiplyToRef(k,W);const I=this._internalPickForMesh(null,u,L,W,!1,!1,s,!0);I&&(I.thinInstanceIndex=_,U.push(I))}}}else{const x=this._internalPickForMesh(null,u,L,k,!1,!1,s);x&&U.push(x)}}return U},I.Z.prototype.pickWithBoundingInfo=function(u,x,s,U,c){if(!W.G)return null;const I=this._internalPick((s=>(this._tempPickingRay||(this._tempPickingRay=i.Zero()),this.createPickingRayToRef(u,x,s,this._tempPickingRay,c||null),this._tempPickingRay)),s,U,!0);return I&&(I.ray=this.createPickingRay(u,x,_.uq.Identity(),c||null)),I},Object.defineProperty(I.Z.prototype,"_pickingAvailable",{get:()=>!0,enumerable:!1,configurable:!1}),I.Z.prototype.pick=function(u,x,s,U,W,c,I=!1){const L=this._internalPick(((s,U)=>(this._tempPickingRay||(this._tempPickingRay=i.Zero()),this.createPickingRayToRef(u,x,s,this._tempPickingRay,W||null,!1,U),this._tempPickingRay)),s,U,!1,c);return L&&(L.ray=this.createPickingRay(u,x,_.uq.Identity(),W||null)),L},I.Z.prototype.pickWithRay=function(u,x,s,U){const W=this._internalPick((x=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=_.uq.Identity()),x.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=i.Zero()),i.TransformToRef(u,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),x,s,!1,U);return W&&(W.ray=u),W},I.Z.prototype.multiPick=function(u,x,s,U,_){return this._internalMultiPick((s=>this.createPickingRay(u,x,s,U||null)),s,_)},I.Z.prototype.multiPickWithRay=function(u,x,s){return this._internalMultiPick((x=>(this._pickWithRayInverseMatrix||(this._pickWithRayInverseMatrix=_.uq.Identity()),x.invertToRef(this._pickWithRayInverseMatrix),this._cachedRayForTransform||(this._cachedRayForTransform=i.Zero()),i.TransformToRef(u,this._pickWithRayInverseMatrix,this._cachedRayForTransform),this._cachedRayForTransform)),x,s)},L.i.prototype.getForwardRay=function(u=100,x,s){return this.getForwardRayToRef(new i(_.Pq.Zero(),_.Pq.Zero(),u),u,x,s)},L.i.prototype.getForwardRayToRef=function(u,x=100,s,U){s||(s=this.getWorldMatrix()),u.length=x,U?u.origin.copyFrom(U):u.origin.copyFrom(this.position);const W=_.AA.Vector3[2];W.set(0,0,this._scene.useRightHandedSystem?-1:1);const c=_.AA.Vector3[3];return _.Pq.TransformNormalToRef(W,s,c),_.Pq.NormalizeToRef(c,u.direction),u}},725378:(u,x,s)=>{var U,_,W,c,I,L,J;s.d(x,{ST:()=>_,Ze:()=>W,bq:()=>U,dR:()=>J,h8:()=>c,pI:()=>I,sZ:()=>L}),function(u){u[u["Generic"]=0]="Generic",u[u["Keyboard"]=1]="Keyboard",u[u["Mouse"]=2]="Mouse",u[u["Touch"]=3]="Touch",u[u["DualShock"]=4]="DualShock",u[u["Xbox"]=5]="Xbox",u[u["Switch"]=6]="Switch",u[u["DualSense"]=7]="DualSense"}(U||(U={})),function(u){u[u["Horizontal"]=0]="Horizontal",u[u["Vertical"]=1]="Vertical",u[u["LeftClick"]=2]="LeftClick",u[u["MiddleClick"]=3]="MiddleClick",u[u["RightClick"]=4]="RightClick",u[u["BrowserBack"]=5]="BrowserBack",u[u["BrowserForward"]=6]="BrowserForward",u[u["MouseWheelX"]=7]="MouseWheelX",u[u["MouseWheelY"]=8]="MouseWheelY",u[u["MouseWheelZ"]=9]="MouseWheelZ",u[u["Move"]=12]="Move"}(_||(_={})),function(u){u[u["Horizontal"]=0]="Horizontal",u[u["Vertical"]=1]="Vertical",u[u["LeftClick"]=2]="LeftClick",u[u["MiddleClick"]=3]="MiddleClick",u[u["RightClick"]=4]="RightClick",u[u["BrowserBack"]=5]="BrowserBack",u[u["BrowserForward"]=6]="BrowserForward",u[u["MouseWheelX"]=7]="MouseWheelX",u[u["MouseWheelY"]=8]="MouseWheelY",u[u["MouseWheelZ"]=9]="MouseWheelZ",u[u["DeltaHorizontal"]=10]="DeltaHorizontal",u[u["DeltaVertical"]=11]="DeltaVertical"}(W||(W={})),function(u){u[u["Cross"]=0]="Cross",u[u["Circle"]=1]="Circle",u[u["Square"]=2]="Square",u[u["Triangle"]=3]="Triangle",u[u["L1"]=4]="L1",u[u["R1"]=5]="R1",u[u["L2"]=6]="L2",u[u["R2"]=7]="R2",u[u["Share"]=8]="Share",u[u["Options"]=9]="Options",u[u["L3"]=10]="L3",u[u["R3"]=11]="R3",u[u["DPadUp"]=12]="DPadUp",u[u["DPadDown"]=13]="DPadDown",u[u["DPadLeft"]=14]="DPadLeft",u[u["DPadRight"]=15]="DPadRight",u[u["Home"]=16]="Home",u[u["TouchPad"]=17]="TouchPad",u[u["LStickXAxis"]=18]="LStickXAxis",u[u["LStickYAxis"]=19]="LStickYAxis",u[u["RStickXAxis"]=20]="RStickXAxis",u[u["RStickYAxis"]=21]="RStickYAxis"}(c||(c={})),function(u){u[u["Cross"]=0]="Cross",u[u["Circle"]=1]="Circle",u[u["Square"]=2]="Square",u[u["Triangle"]=3]="Triangle",u[u["L1"]=4]="L1",u[u["R1"]=5]="R1",u[u["L2"]=6]="L2",u[u["R2"]=7]="R2",u[u["Create"]=8]="Create",u[u["Options"]=9]="Options",u[u["L3"]=10]="L3",u[u["R3"]=11]="R3",u[u["DPadUp"]=12]="DPadUp",u[u["DPadDown"]=13]="DPadDown",u[u["DPadLeft"]=14]="DPadLeft",u[u["DPadRight"]=15]="DPadRight",u[u["Home"]=16]="Home",u[u["TouchPad"]=17]="TouchPad",u[u["LStickXAxis"]=18]="LStickXAxis",u[u["LStickYAxis"]=19]="LStickYAxis",u[u["RStickXAxis"]=20]="RStickXAxis",u[u["RStickYAxis"]=21]="RStickYAxis"}(I||(I={})),function(u){u[u["A"]=0]="A",u[u["B"]=1]="B",u[u["X"]=2]="X",u[u["Y"]=3]="Y",u[u["LB"]=4]="LB",u[u["RB"]=5]="RB",u[u["LT"]=6]="LT",u[u["RT"]=7]="RT",u[u["Back"]=8]="Back",u[u["Start"]=9]="Start",u[u["LS"]=10]="LS",u[u["RS"]=11]="RS",u[u["DPadUp"]=12]="DPadUp",u[u["DPadDown"]=13]="DPadDown",u[u["DPadLeft"]=14]="DPadLeft",u[u["DPadRight"]=15]="DPadRight",u[u["Home"]=16]="Home",u[u["LStickXAxis"]=17]="LStickXAxis",u[u["LStickYAxis"]=18]="LStickYAxis",u[u["RStickXAxis"]=19]="RStickXAxis",u[u["RStickYAxis"]=20]="RStickYAxis"}(L||(L={})),function(u){u[u["B"]=0]="B",u[u["A"]=1]="A",u[u["Y"]=2]="Y",u[u["X"]=3]="X",u[u["L"]=4]="L",u[u["R"]=5]="R",u[u["ZL"]=6]="ZL",u[u["ZR"]=7]="ZR",u[u["Minus"]=8]="Minus",u[u["Plus"]=9]="Plus",u[u["LS"]=10]="LS",u[u["RS"]=11]="RS",u[u["DPadUp"]=12]="DPadUp",u[u["DPadDown"]=13]="DPadDown",u[u["DPadLeft"]=14]="DPadLeft",u[u["DPadRight"]=15]="DPadRight",u[u["Home"]=16]="Home",u[u["Capture"]=17]="Capture",u[u["LStickXAxis"]=18]="LStickXAxis",u[u["LStickYAxis"]=19]="LStickYAxis",u[u["RStickXAxis"]=20]="RStickXAxis",u[u["RStickYAxis"]=21]="RStickYAxis"}(J||(J={}))},154711:(u,x,s)=>{s.d(x,{c:()=>_});var U=s(638113);class _{constructor(u,x,s=0){this.deviceType=x,this.deviceSlot=s,this.onInputChangedObservable=new U.cP,this._deviceInputSystem=u}getInput(u){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,u)}}},276759:(u,x,s)=>{s.d(x,{Z:()=>D});var U=s(725378),_=s(638113),W=s(332108);class c{static CreateDeviceEvent(u,x,s,_,W,c,I){switch(u){case U.bq.Keyboard:return this._CreateKeyboardEvent(s,_,W,c);case U.bq.Mouse:if(s===U.ST.MouseWheelX||s===U.ST.MouseWheelY||s===U.ST.MouseWheelZ)return this._CreateWheelEvent(u,x,s,_,W,c);case U.bq.Touch:return this._CreatePointerEvent(u,x,s,_,W,c,I);default:throw`Unable to generate event for device ${U.bq[u]}`}}static _CreatePointerEvent(u,x,s,_,W,c,I){const L=this._CreateMouseEvent(u,x,s,_,W,c);u===U.bq.Mouse?(L.deviceType=U.bq.Mouse,L.pointerId=1,L.pointerType="mouse"):(L.deviceType=U.bq.Touch,L.pointerId=null!=I?I:x,L.pointerType="touch");let J=0;return J+=W.pollInput(u,x,U.ST.LeftClick),J+=2*W.pollInput(u,x,U.ST.RightClick),J+=4*W.pollInput(u,x,U.ST.MiddleClick),L.buttons=J,s===U.ST.Move?L.type="pointermove":s>=U.ST.LeftClick&&s<=U.ST.RightClick&&(L.type=1===_?"pointerdown":"pointerup",L.button=s-2),L}static _CreateWheelEvent(u,x,s,_,c,I){const L=this._CreateMouseEvent(u,x,s,_,c,I);switch(L.pointerId=1,L.type="wheel",L.deltaMode=W.s.DOM_DELTA_PIXEL,L.deltaX=0,L.deltaY=0,L.deltaZ=0,s){case U.ST.MouseWheelX:L.deltaX=_;break;case U.ST.MouseWheelY:L.deltaY=_;break;case U.ST.MouseWheelZ:L.deltaZ=_}return L}static _CreateMouseEvent(u,x,s,_,W,c){const I=this._CreateEvent(c),L=W.pollInput(u,x,U.ST.Horizontal),J=W.pollInput(u,x,U.ST.Vertical);return c?(I.movementX=0,I.movementY=0,I.offsetX=I.movementX-c.getBoundingClientRect().x,I.offsetY=I.movementY-c.getBoundingClientRect().y):(I.movementX=W.pollInput(u,x,10),I.movementY=W.pollInput(u,x,11),I.offsetX=0,I.offsetY=0),this._CheckNonCharacterKeys(I,W),I.clientX=L,I.clientY=J,I.x=L,I.y=J,I.deviceType=u,I.deviceSlot=x,I.inputIndex=s,I}static _CreateKeyboardEvent(u,x,s,_){const W=this._CreateEvent(_);return this._CheckNonCharacterKeys(W,s),W.deviceType=U.bq.Keyboard,W.deviceSlot=0,W.inputIndex=u,W.type=1===x?"keydown":"keyup",W.key=String.fromCharCode(u),W.keyCode=u,W}static _CheckNonCharacterKeys(u,x){const s=x.isDeviceAvailable(U.bq.Keyboard),_=s&&1===x.pollInput(U.bq.Keyboard,0,18),W=s&&1===x.pollInput(U.bq.Keyboard,0,17),c=s&&(1===x.pollInput(U.bq.Keyboard,0,91)||1===x.pollInput(U.bq.Keyboard,0,92)||1===x.pollInput(U.bq.Keyboard,0,93)),I=s&&1===x.pollInput(U.bq.Keyboard,0,16);u.altKey=_,u.ctrlKey=W,u.metaKey=c,u.shiftKey=I}static _CreateEvent(u){const x={preventDefault:()=>{}};return x.target=u,x}}class I{constructor(u,x,s){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(u,x,((u,x,U,_)=>{const W=c.CreateDeviceEvent(u,x,U,_,this);s(u,x,W)})):this._createDummyNativeInput()}pollInput(u,x,s){return this._nativeInput.pollInput(u,x,s)}isDeviceAvailable(u){return u===U.bq.Mouse||u===U.bq.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}var L=s(394501),J=s(898973);const k=255,i=Object.keys(U.ST).length/2;class d{constructor(u,x,s,U){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=J.S0.IsSafari(),this._usingMacOS=L.XD()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=u=>{},this._keyboardUpEvent=u=>{},this._keyboardBlurEvent=u=>{},this._pointerMoveEvent=u=>{},this._pointerDownEvent=u=>{},this._pointerUpEvent=u=>{},this._pointerCancelEvent=u=>{},this._pointerWheelEvent=u=>{},this._pointerBlurEvent=u=>{},this._pointerMacOSChromeOutEvent=u=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=L.XD()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=L.XD()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=u=>{},this._gamepadDisconnectedEvent=u=>{},this._eventPrefix=J.S0.GetPointerPrefix(u),this._engine=u,this._onDeviceConnected=x,this._onDeviceDisconnected=s,this._onInputChanged=U,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(u,x,s){const _=this._inputs[u][x];if(!_)throw`Unable to find device ${U.bq[u]}`;u>=U.bq.DualShock&&u<=U.bq.DualSense&&this._updateDevice(u,x,s);const W=_[s];if(void 0===W)throw`Unable to find input ${s} for device ${U.bq[u]} in slot ${x}`;return s===U.ST.Move&&J.S0.Warn(`Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data.`),W}isDeviceAvailable(u){return void 0!==this._inputs[u]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const u=null==this?void 0:this._engine.getInputElement();if(u&&(!this._eventsAttached||this._elementToAttachTo!==u)){if(this._disableEvents(),this._inputs)for(const u of this._inputs)if(u)for(const x in u){const s=u[+x];if(s)for(let u=0;u<s.length;u++)s[u]=0}this._elementToAttachTo=u,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const u=navigator.getGamepads();for(const x of u)x&&this._addGamePad(x)}"function"==typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(U.bq.Mouse,0,0,0)}_addGamePad(u){const x=this._getGamepadDeviceType(u.id),s=u.index;this._gamepads=this._gamepads||new Array(u.index+1),this._registerDevice(x,s,u.buttons.length+u.axes.length),this._gamepads[s]=x}_addPointerDevice(u,x,s,U){this._pointerActive||(this._pointerActive=!0),this._registerDevice(u,x,i);const _=this._inputs[u][x];_[0]=s,_[1]=U}_registerDevice(u,x,s){if(void 0===x)throw`Unable to register device ${U.bq[u]} to undefined slot.`;if(this._inputs[u]||(this._inputs[u]={}),!this._inputs[u][x]){const U=new Array(s);U.fill(0),this._inputs[u][x]=U,this._onDeviceConnected(u,x)}}_unregisterDevice(u,x){this._inputs[u][x]&&(delete this._inputs[u][x],this._onDeviceDisconnected(u,x))}_handleKeyActions(){this._keyboardDownEvent=u=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(U.bq.Keyboard,0,k));const x=this._inputs[U.bq.Keyboard][0];if(x){x[u.keyCode]=1;const s=u;s.inputIndex=u.keyCode,this._usingMacOS&&u.metaKey&&"Meta"!==u.key&&(this._metaKeys.includes(u.keyCode)||this._metaKeys.push(u.keyCode)),this._onInputChanged(U.bq.Keyboard,0,s)}},this._keyboardUpEvent=u=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(U.bq.Keyboard,0,k));const x=this._inputs[U.bq.Keyboard][0];if(x){x[u.keyCode]=0;const s=u;if(s.inputIndex=u.keyCode,this._usingMacOS&&"Meta"===u.key&&this._metaKeys.length>0){for(const u of this._metaKeys){const s=c.CreateDeviceEvent(U.bq.Keyboard,0,u,0,this,this._elementToAttachTo);x[u]=0,this._onInputChanged(U.bq.Keyboard,0,s)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(U.bq.Keyboard,0,s)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const u=this._inputs[U.bq.Keyboard][0];for(let x=0;x<u.length;x++)if(0!==u[x]){u[x]=0;const s=c.CreateDeviceEvent(U.bq.Keyboard,0,x,0,this,this._elementToAttachTo);this._onInputChanged(U.bq.Keyboard,0,s)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=L.XD()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let u=0;u<this._maxTouchPoints;u++)this._activeTouchIds[u]=-1;this._pointerMoveEvent=u=>{const x=this._getPointerType(u);let s=x===U.bq.Mouse?0:this._activeTouchIds.indexOf(u.pointerId);if(x===U.bq.Touch&&-1===s){const U=this._activeTouchIds.indexOf(-1);if(!(U>=0))return void J.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);s=U,this._activeTouchIds[U]=u.pointerId,this._onDeviceConnected(x,s)}this._inputs[x]||(this._inputs[x]={}),this._inputs[x][s]||this._addPointerDevice(x,s,u.clientX,u.clientY);const _=this._inputs[x][s];if(_){const W=u;W.inputIndex=U.ST.Move,_[U.ST.Horizontal]=u.clientX,_[U.ST.Vertical]=u.clientY,x===U.bq.Touch&&0===_[U.ST.LeftClick]&&(_[U.ST.LeftClick]=1),void 0===u.pointerId&&(u.pointerId=this._mouseId),this._onInputChanged(x,s,W),this._usingSafari||-1===u.button||(W.inputIndex=u.button+2,_[u.button+2]=_[u.button+2]?0:1,this._onInputChanged(x,s,W))}},this._pointerDownEvent=u=>{const x=this._getPointerType(u);let s=x===U.bq.Mouse?0:u.pointerId;if(x===U.bq.Touch){let x=this._activeTouchIds.indexOf(u.pointerId);if(-1===x&&(x=this._activeTouchIds.indexOf(-1)),!(x>=0))return void J.S0.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);s=x,this._activeTouchIds[x]=u.pointerId}this._inputs[x]||(this._inputs[x]={}),this._inputs[x][s]?x===U.bq.Touch&&this._onDeviceConnected(x,s):this._addPointerDevice(x,s,u.clientX,u.clientY);const _=this._inputs[x][s];if(_){const W=_[U.ST.Horizontal],c=_[U.ST.Vertical];if(x===U.bq.Mouse){if(void 0===u.pointerId&&(u.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(u){}}else if(u.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(u.pointerId)}catch(u){}_[U.ST.Horizontal]=u.clientX,_[U.ST.Vertical]=u.clientY,_[u.button+2]=1;const I=u;I.inputIndex=u.button+2,this._onInputChanged(x,s,I),W===u.clientX&&c===u.clientY||(I.inputIndex=U.ST.Move,this._onInputChanged(x,s,I))}},this._pointerUpEvent=u=>{var x,s,_,W,c;const I=this._getPointerType(u),L=I===U.bq.Mouse?0:this._activeTouchIds.indexOf(u.pointerId);if(I===U.bq.Touch){if(-1===L)return;this._activeTouchIds[L]=-1}const J=null===(x=this._inputs[I])||void 0===x?void 0:x[L];if(J&&0!==J[u.button+2]){const x=J[U.ST.Horizontal],k=J[U.ST.Vertical];J[U.ST.Horizontal]=u.clientX,J[U.ST.Vertical]=u.clientY,J[u.button+2]=0;const i=u;void 0===u.pointerId&&(u.pointerId=this._mouseId),x===u.clientX&&k===u.clientY||(i.inputIndex=U.ST.Move,this._onInputChanged(I,L,i)),i.inputIndex=u.button+2,I===U.bq.Mouse&&this._mouseId>=0&&(null===(_=(s=this._elementToAttachTo).hasPointerCapture)||void 0===_?void 0:_.call(s,this._mouseId))?this._elementToAttachTo.releasePointerCapture(this._mouseId):u.pointerId&&(null===(c=(W=this._elementToAttachTo).hasPointerCapture)||void 0===c?void 0:c.call(W,u.pointerId))&&this._elementToAttachTo.releasePointerCapture(u.pointerId),this._onInputChanged(I,L,i),I===U.bq.Touch&&this._onDeviceDisconnected(I,L)}},this._pointerCancelEvent=u=>{var x,s,_,W;if("mouse"===u.pointerType){const u=this._inputs[U.bq.Mouse][0];this._mouseId>=0&&(null===(s=(x=this._elementToAttachTo).hasPointerCapture)||void 0===s?void 0:s.call(x,this._mouseId))&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let x=U.ST.LeftClick;x<=U.ST.BrowserForward;x++)if(1===u[x]){u[x]=0;const s=c.CreateDeviceEvent(U.bq.Mouse,0,x,0,this,this._elementToAttachTo);this._onInputChanged(U.bq.Mouse,0,s)}}else{const x=this._activeTouchIds.indexOf(u.pointerId);if(-1===x)return;(null===(W=(_=this._elementToAttachTo).hasPointerCapture)||void 0===W?void 0:W.call(_,u.pointerId))&&this._elementToAttachTo.releasePointerCapture(u.pointerId),this._inputs[U.bq.Touch][x][U.ST.LeftClick]=0;const s=c.CreateDeviceEvent(U.bq.Touch,x,U.ST.LeftClick,0,this,this._elementToAttachTo,u.pointerId);this._onInputChanged(U.bq.Touch,x,s),this._activeTouchIds[x]=-1,this._onDeviceDisconnected(U.bq.Touch,x)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let u=!1;const x=function(){};try{const s=Object.defineProperty({},"passive",{get:function(){u=!0}});this._elementToAttachTo.addEventListener("test",x,s),this._elementToAttachTo.removeEventListener("test",x,s)}catch(u){}this._pointerBlurEvent=()=>{var u,x,s,_,W;if(this.isDeviceAvailable(U.bq.Mouse)){const s=this._inputs[U.bq.Mouse][0];this._mouseId>=0&&(null===(x=(u=this._elementToAttachTo).hasPointerCapture)||void 0===x?void 0:x.call(u,this._mouseId))&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let u=U.ST.LeftClick;u<=U.ST.BrowserForward;u++)if(1===s[u]){s[u]=0;const x=c.CreateDeviceEvent(U.bq.Mouse,0,u,0,this,this._elementToAttachTo);this._onInputChanged(U.bq.Mouse,0,x)}}if(this.isDeviceAvailable(U.bq.Touch)){const u=this._inputs[U.bq.Touch];for(let x=0;x<this._activeTouchIds.length;x++){const I=this._activeTouchIds[x];if((null===(_=(s=this._elementToAttachTo).hasPointerCapture)||void 0===_?void 0:_.call(s,I))&&this._elementToAttachTo.releasePointerCapture(I),-1!==I&&1===(null===(W=u[x])||void 0===W?void 0:W[U.ST.LeftClick])){u[x][U.ST.LeftClick]=0;const s=c.CreateDeviceEvent(U.bq.Touch,x,U.ST.LeftClick,0,this,this._elementToAttachTo,I);this._onInputChanged(U.bq.Touch,x,s),this._activeTouchIds[x]=-1,this._onDeviceDisconnected(U.bq.Touch,x)}}}},this._pointerWheelEvent=u=>{const x=U.bq.Mouse,s=0;this._inputs[x]||(this._inputs[x]=[]),this._inputs[x][s]||(this._pointerActive=!0,this._registerDevice(x,s,i));const _=this._inputs[x][s];if(_){_[U.ST.MouseWheelX]=u.deltaX||0,_[U.ST.MouseWheelY]=u.deltaY||u.wheelDelta||0,_[U.ST.MouseWheelZ]=u.deltaZ||0;const W=u;void 0===u.pointerId&&(u.pointerId=this._mouseId),0!==_[U.ST.MouseWheelX]&&(W.inputIndex=U.ST.MouseWheelX,this._onInputChanged(x,s,W)),0!==_[U.ST.MouseWheelY]&&(W.inputIndex=U.ST.MouseWheelY,this._onInputChanged(x,s,W)),0!==_[U.ST.MouseWheelZ]&&(W.inputIndex=U.ST.MouseWheelZ,this._onInputChanged(x,s,W))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=u=>{u.buttons>1&&this._pointerCancelEvent(u)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!u&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(U.bq.Mouse)){const u=this._inputs[U.bq.Mouse][0];u[U.ST.MouseWheelX]=0,u[U.ST.MouseWheelY]=0,u[U.ST.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=u=>{this._addGamePad(u.gamepad)},this._gamepadDisconnectedEvent=u=>{if(this._gamepads){const x=this._getGamepadDeviceType(u.gamepad.id),s=u.gamepad.index;this._unregisterDevice(x,s),delete this._gamepads[s]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(u,x,s){const U=navigator.getGamepads()[x];if(U&&u===this._gamepads[x]){const _=this._inputs[u][x];s>=U.buttons.length?_[s]=U.axes[s-U.buttons.length].valueOf():_[s]=U.buttons[s].value}}_getGamepadDeviceType(u){return-1!==u.indexOf("054c")?-1!==u.indexOf("0ce6")?U.bq.DualSense:U.bq.DualShock:-1!==u.indexOf("Xbox One")||-1!==u.search("Xbox 360")||-1!==u.search("xinput")?U.bq.Xbox:-1!==u.indexOf("057e")?U.bq.Switch:U.bq.Generic}_getPointerType(u){let x=U.bq.Mouse;return("touch"===u.pointerType||"pen"===u.pointerType||u.touches)&&(x=U.bq.Touch),x}}var j=s(154711);class r{constructor(u){this._registeredManagers=new Array,this._refCount=0,this.registerManager=u=>{for(let x=0;x<this._devices.length;x++){const s=this._devices[x];for(const U in s){const s=+U;u._addDevice(new j.c(this._deviceInputSystem,x,s))}}this._registeredManagers.push(u)},this.unregisterManager=u=>{const x=this._registeredManagers.indexOf(u);x>-1&&this._registeredManagers.splice(x,1)};const x=Object.keys(U.bq).length/2;this._devices=new Array(x);const s=(u,x)=>{this._devices[u]||(this._devices[u]=new Array),this._devices[u][x]||(this._devices[u][x]=x);for(const s of this._registeredManagers){const U=new j.c(this._deviceInputSystem,u,x);s._addDevice(U)}},_=(u,x)=>{var s;(null===(s=this._devices[u])||void 0===s?void 0:s[x])&&delete this._devices[u][x];for(const s of this._registeredManagers)s._removeDevice(u,x)},W=(u,x,s)=>{if(s)for(const U of this._registeredManagers)U._onInputChanged(u,x,s)};"undefined"!=typeof _native?this._deviceInputSystem=new I(s,_,W):this._deviceInputSystem=new d(u,s,_,W)}dispose(){this._deviceInputSystem.dispose()}}class D{getDeviceSource(u,x){if(void 0===x){if(void 0===this._firstDevice[u])return null;x=this._firstDevice[u]}return this._devices[u]&&void 0!==this._devices[u][x]?this._devices[u][x]:null}getDeviceSources(u){return this._devices[u]?this._devices[u].filter((u=>!!u)):[]}constructor(u){const x=Object.keys(U.bq).length/2;this._devices=new Array(x),this._firstDevice=new Array(x),this._engine=u,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new r(u)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new _.cP((u=>{for(const x of this._devices)if(x)for(const s of x)s&&this.onDeviceConnectedObservable.notifyObserver(u,s)})),this.onDeviceDisconnectedObservable=new _.cP,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=u.onDisposeObservable.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)}_addDevice(u){this._devices[u.deviceType]||(this._devices[u.deviceType]=new Array),this._devices[u.deviceType][u.deviceSlot]||(this._devices[u.deviceType][u.deviceSlot]=u,this._updateFirstDevices(u.deviceType)),this.onDeviceConnectedObservable.notifyObservers(u)}_removeDevice(u,x){var s,U;const _=null===(s=this._devices[u])||void 0===s?void 0:s[x];this.onDeviceDisconnectedObservable.notifyObservers(_),(null===(U=this._devices[u])||void 0===U?void 0:U[x])&&delete this._devices[u][x],this._updateFirstDevices(u)}_onInputChanged(u,x,s){var U,_;null===(_=null===(U=this._devices[u])||void 0===U?void 0:U[x])||void 0===_||_.onInputChangedObservable.notifyObservers(s)}_updateFirstDevices(u){switch(u){case U.bq.Keyboard:case U.bq.Mouse:this._firstDevice[u]=0;break;case U.bq.Touch:case U.bq.DualSense:case U.bq.DualShock:case U.bq.Xbox:case U.bq.Switch:case U.bq.Generic:{delete this._firstDevice[u];const x=this._devices[u];if(x)for(let s=0;s<x.length;s++)if(x[s]){this._firstDevice[u]=s;break}break}}}}},724982:(u,x,s)=>{s(33321).$.prototype.setAlphaEquation=function(u){if(this._alphaEquation!==u){switch(u){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=u}}},757634:(u,x,s)=>{var U=s(182453),_=s(706400),W=s(435683),c=s(977041),I=s(33321),L=s(892643);I.$.prototype._partialLoadFile=function(u,x,s,U,_=null){this._loadFile(u,(u=>{s[x]=u,s._internalCount++,6===s._internalCount&&U(s)}),void 0,void 0,!0,((u,x)=>{_&&u&&_(u.status+" "+u.statusText,x)}))},I.$.prototype._cascadeLoadFiles=function(u,x,s,U=null){const _=[];_._internalCount=0;for(let u=0;u<6;u++)this._partialLoadFile(s[u],u,_,x,U)},I.$.prototype._cascadeLoadImgs=function(u,x,s,U,_=null,W){const c=[];c._internalCount=0;for(let I=0;I<6;I++)this._partialLoadImg(U[I],I,c,u,x,s,_,W)},I.$.prototype._partialLoadImg=function(u,x,s,U,_,I,L=null,J){const k=c.z();W.W$(u,(u=>{s[x]=u,s._internalCount++,U&&U.removePendingData(k),6===s._internalCount&&I&&I(_,s)}),((u,x)=>{U&&U.removePendingData(k),L&&L(u,x)}),U?U.offlineProvider:null,J),U&&U.addPendingData(k)},I.$.prototype.createCubeTextureBase=function(u,x,s,W,c=null,I=null,J,k=null,i=!1,d=0,j=0,r=null,D=null,$=null,H=!1,f=null){const O=r||new U.h(this,7);O.isCube=!0,O.url=u,O.generateMipMaps=!W,O._lodGenerationScale=d,O._lodGenerationOffset=j,O._useSRGBBuffer=!!H&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!W),O!==r&&(O.label=u.substring(0,60)),this._doNotHandleContextLost||(O._extension=k,O._files=s,O._buffer=f);const t=u;this._transformTextureUrl&&!r&&(u=this._transformTextureUrl(u));const V=u.split("?")[0],N=V.lastIndexOf("."),m=k||(N>-1?V.substring(N).toLowerCase():""),b=L.g(m),n=(U,L)=>{u===t?I&&U&&I(U.status+" "+U.statusText,L):(_.V.Warn(`Failed to load ${u}, falling back to the ${t}`),this.createCubeTextureBase(t,x,s,!!W,c,I,J,k,i,d,j,O,D,$,H,f))};if(b)b.then((U=>{const W=u=>{D&&D(O,u),U.loadCubeData(u,O,i,c,I)};f?W(f):s&&6===s.length?U.supportCascades?this._cascadeLoadFiles(x,(u=>W(u.map((u=>new Uint8Array(u))))),s,I):I?I("Textures type does not support cascades."):_.V.Warn("Texture loader does not support cascades."):this._loadFile(u,(u=>W(new Uint8Array(u))),void 0,void 0,!0,n)}));else{if(!s||0===s.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(x,O,((u,x)=>{$&&$(u,x)}),s,I)}return this._internalTexturesCache.push(O),O}},779010:(u,x,s)=>{var U=s(33321);U.$.prototype.getInputElement=function(){return this._renderingCanvas},U.$.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},U.$.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},U.$.prototype.getAspectRatio=function(u,x=!1){const s=u.viewport;return this.getRenderWidth(x)*s.width/(this.getRenderHeight(x)*s.height)},U.$.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},U.$.prototype._verifyPointerLock=function(){var u;null===(u=this._onPointerLockChange)||void 0===u||u.call(this)}},129970:(u,x,s)=>{var U=s(394501),_=s(33321);_.$.prototype.displayLoadingUI=function(){if(!U.BA())return;const u=this.loadingScreen;u&&u.displayLoadingUI()},_.$.prototype.hideLoadingUI=function(){if(!U.BA())return;const u=this._loadingScreen;u&&u.hideLoadingUI()},Object.defineProperty(_.$.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=_.$.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(u){this._loadingScreen=u},enumerable:!0,configurable:!0}),Object.defineProperty(_.$.prototype,"loadingUIText",{set:function(u){this.loadingScreen.loadingUIText=u},enumerable:!0,configurable:!0}),Object.defineProperty(_.$.prototype,"loadingUIBackgroundColor",{set:function(u){this.loadingScreen.loadingUIBackgroundColor=u},enumerable:!0,configurable:!0})},299741:(u,x,s)=>{var U=s(33321);U.$.prototype.getRenderPassNames=function(){return this._renderPassNames},U.$.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},U.$.prototype.createRenderPassId=function(u){const x=++U.$._RenderPassIdCounter;return this._renderPassNames[x]=null!=u?u:"NONAME",x},U.$.prototype.releaseRenderPassId=function(u){this._renderPassNames[u]=void 0;for(let x=0;x<this.scenes.length;++x){const s=this.scenes[x];for(let x=0;x<s.meshes.length;++x){const U=s.meshes[x];if(U.subMeshes)for(let x=0;x<U.subMeshes.length;++x)U.subMeshes[x]._removeDrawWrapper(u)}}}},649646:(u,x,s)=>{var U=s(33321);s(724982),U.$.prototype.getInputElement=function(){return this._renderingCanvas},U.$.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},U.$.prototype.setDepthFunction=function(u){this._depthCullingState.depthFunc=u},U.$.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},U.$.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},U.$.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},U.$.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},U.$.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},U.$.prototype.setDepthWrite=function(u){this._depthCullingState.depthMask=u},U.$.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},U.$.prototype.setStencilBuffer=function(u){this._stencilState.stencilTest=u},U.$.prototype.getStencilMask=function(){return this._stencilState.stencilMask},U.$.prototype.setStencilMask=function(u){this._stencilState.stencilMask=u},U.$.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},U.$.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},U.$.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},U.$.prototype.setStencilFunction=function(u){this._stencilState.stencilFunc=u},U.$.prototype.setStencilFunctionReference=function(u){this._stencilState.stencilFuncRef=u},U.$.prototype.setStencilFunctionMask=function(u){this._stencilState.stencilFuncMask=u},U.$.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},U.$.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},U.$.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},U.$.prototype.setStencilOperationFail=function(u){this._stencilState.stencilOpStencilFail=u},U.$.prototype.setStencilOperationDepthFail=function(u){this._stencilState.stencilOpDepthFail=u},U.$.prototype.setStencilOperationPass=function(u){this._stencilState.stencilOpStencilDepthPass=u},U.$.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},U.$.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},U.$.prototype.setAlphaConstants=function(u,x,s,U){this._alphaState.setAlphaBlendConstants(u,x,s,U)},U.$.prototype.getAlphaMode=function(){return this._alphaMode},U.$.prototype.getAlphaEquation=function(){return this._alphaEquation}},834405:(u,x,s)=>{s(33321).$.prototype.createDepthStencilTexture=function(u,x,s){if(x.isCube){const s=u.width||u;return this._createDepthStencilCubeTexture(s,x)}return this._createDepthStencilTexture(u,x,s)}},889630:(u,x,s)=>{s(499251).w.prototype.setAlphaMode=function(u,x=!1){if(this._alphaMode!==u){switch(u){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}x||(this.depthCullingState.depthMask=0===u),this._alphaMode=u}else if(!x){const x=0===u;this.depthCullingState.depthMask!==x&&(this.depthCullingState.depthMask=x)}}},109050:(u,x,s)=>{var U=s(499251),_=s(182453),W=s(706400),c=s(104270);U.w.prototype._createDepthStencilCubeTexture=function(u,x){const s=new _.h(this,12);if(s.isCube=!0,1===this.webGLVersion)return W.V.Error("Depth cube texture is not supported by WebGL 1."),s;const U={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...x},c=this._gl;this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,s,!0),this._setupDepthStencilTexture(s,u,U.bilinearFiltering,U.comparisonFunction);for(let x=0;x<6;x++)U.generateStencil?c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,c.DEPTH24_STENCIL8,u,u,0,c.DEPTH_STENCIL,c.UNSIGNED_INT_24_8,null):c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,c.DEPTH_COMPONENT24,u,u,0,c.DEPTH_COMPONENT,c.UNSIGNED_INT,null);return this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(s),s},U.w.prototype._setCubeMapTextureParams=function(u,x,s){const U=this._gl;U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,x?U.LINEAR_MIPMAP_LINEAR:U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),u.samplingMode=x?3:2,x&&this.getCaps().textureMaxLevel&&void 0!==s&&s>0&&(U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAX_LEVEL,s),u._maxLodLevel=s),this._bindTextureDirectly(U.TEXTURE_CUBE_MAP,null)},U.w.prototype.createCubeTexture=function(u,x,s,U,_=null,I=null,L,J=null,k=!1,i=0,d=0,j=null,r,D=!1,$=null){const H=this._gl;return this.createCubeTextureBase(u,x,s,!!U,_,I,L,J,k,i,d,j,(u=>this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,u,!0)),((u,x)=>{const s=this.needPOTTextures?c.R(x[0].width,this._caps.maxCubemapTextureSize):x[0].width,I=s,J=[H.TEXTURE_CUBE_MAP_POSITIVE_X,H.TEXTURE_CUBE_MAP_POSITIVE_Y,H.TEXTURE_CUBE_MAP_POSITIVE_Z,H.TEXTURE_CUBE_MAP_NEGATIVE_X,H.TEXTURE_CUBE_MAP_NEGATIVE_Y,H.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(H.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(!1);const k=L?this._getInternalFormat(L,u._useSRGBBuffer):u._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:H.RGBA;let i=L?this._getInternalFormat(L):H.RGBA;u._useSRGBBuffer&&1===this.webGLVersion&&(i=k);for(let u=0;u<J.length;u++)if(x[u].width!==s||x[u].height!==I){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void W.V.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=s,this._workingCanvas.height=I,this._workingContext.drawImage(x[u],0,0,x[u].width,x[u].height,0,0,s,I),H.texImage2D(J[u],0,k,i,H.UNSIGNED_BYTE,this._workingCanvas)}else H.texImage2D(J[u],0,k,i,H.UNSIGNED_BYTE,x[u]);U||H.generateMipmap(H.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(u,!U),u.width=s,u.height=I,u.isReady=!0,L&&(u.format=L),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear(),_&&_()}),!!D,$)},U.w.prototype.generateMipMapsForCubemap=function(u,x=!0){if(u.generateMipMaps){const s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,u,!0),s.generateMipmap(s.TEXTURE_CUBE_MAP),x&&this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null)}}},80157:(u,x,s)=>{var U=s(499251);U.w.prototype.updateDynamicIndexBuffer=function(u,x,s=0){let U;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(u),U=u.is32Bits?x instanceof Uint32Array?x:new Uint32Array(x):x instanceof Uint16Array?x:new Uint16Array(x),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,U,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},U.w.prototype.updateDynamicVertexBuffer=function(u,x,s,U){this.bindArrayBuffer(u),void 0===s&&(s=0);const _=x.byteLength||x.length;void 0===U||U>=_&&0===s?x instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,new Float32Array(x)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,s,x):x instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(x).subarray(s,s+U)):(x=x instanceof ArrayBuffer?new Uint8Array(x,s,U):new Uint8Array(x.buffer,x.byteOffset+s,U),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,x)),this._resetVertexBufferBinding()}},106960:(u,x,s)=>{var U=s(104270),_=s(499251),W=s(182453);_.w.prototype.createDynamicTexture=function(u,x,s,_){const c=new W.h(this,4);return c.baseWidth=u,c.baseHeight=x,s&&(u=this.needPOTTextures?U.R(u,this._caps.maxTextureSize):u,x=this.needPOTTextures?U.R(x,this._caps.maxTextureSize):x),c.width=u,c.height=x,c.isReady=!1,c.generateMipMaps=s,c.samplingMode=_,this.updateTextureSamplingMode(_,c),this._internalTexturesCache.push(c),c},_.w.prototype.updateDynamicTexture=function(u,x,s,U=!1,_,W=!1,c=!1){if(!u)return;const I=this._gl,L=I.TEXTURE_2D,J=this._bindTextureDirectly(L,u,!0,W);this._unpackFlipY(void 0===s?u.invertY:s),U&&I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const k=this._getWebGLTextureType(u.type),i=this._getInternalFormat(_||u.format),d=this._getRGBABufferInternalSizedFormat(u.type,i);I.texImage2D(L,0,d,i,k,x),u.generateMipMaps&&I.generateMipmap(L),J||this._bindTextureDirectly(L,null),U&&I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),_&&(u.format=_),u._dynamicTextureSource=x,u._premulAlpha=U,u.invertY=s||!1,u.isReady=!0}},888414:(u,x,s)=>{var U=s(499251),_=s(182453),W=s(706400),c=s(562756),I=s(194373),L=s(615473),J=s(684911);s(109050),U.w.prototype.createPrefilteredCubeTexture=function(u,x,s,U,k=null,i=null,d,j=null,r=!0){return this.createCubeTexture(u,x,null,!1,(u=>{if(!u)return void(k&&k(null));const i=u.texture;if(r?u.info.sphericalPolynomial&&(i._sphericalPolynomial=u.info.sphericalPolynomial):i._sphericalPolynomial=new c.Q,i._source=9,this.getCaps().textureLOD)return void(k&&k(i));const d=3,j=this._gl,D=u.width;if(!D)return;const $=[];for(let c=0;c<d;c++){const k=1-c/(d-1),r=U,H=L.X.Log2(D)*s+U,f=r+(H-r)*k,O=Math.round(Math.min(Math.max(f,0),H)),t=new _.h(this,2);if(t.type=i.type,t.format=i.format,t.width=Math.pow(2,Math.max(L.X.Log2(D)-O,0)),t.height=t.width,t.isCube=!0,t._cachedWrapU=0,t._cachedWrapV=0,this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,t,!0),t.samplingMode=2,j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),u.isDDS){const x=u.info,s=u.data;this._unpackFlipY(x.isCompressed),J.D.UploadDDSLevels(this,t,s,x,!0,6,O)}else W.V.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null);const V=new I.t(x);V._isCube=!0,V._texture=t,t.isReady=!0,$.push(V)}i._lodTextureHigh=$[2],i._lodTextureMid=$[1],i._lodTextureLow=$[0],k&&k(i)}),i,d,j,r,s,U)}},490730:(u,x,s)=>{var U=s(182453),_=s(706400),W=s(499251),c=s(104270);function I(u,x,s,U){let _,W=1;1===U?_=new Float32Array(x*s*4):2===U?(_=new Uint16Array(x*s*4),W=15360):_=7===U?new Uint32Array(x*s*4):new Uint8Array(x*s*4);for(let U=0;U<x;U++)for(let c=0;c<s;c++){const s=3*(c*x+U),I=4*(c*x+U);_[I+0]=u[s+0],_[I+1]=u[s+1],_[I+2]=u[s+2],_[I+3]=W}return _}function L(u){return function(x,s,_,W,c,I,L,J,k=null,i=0){const d=u?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,j=u?10:11,r=new U.h(this,j);r.baseWidth=s,r.baseHeight=_,r.baseDepth=W,r.width=s,r.height=_,r.depth=W,r.format=c,r.type=i,r.generateMipMaps=I,r.samplingMode=J,u?r.is3D=!0:r.is2DArray=!0,this._doNotHandleContextLost||(r._bufferView=x),u?this.updateRawTexture3D(r,x,c,L,k,i):this.updateRawTexture2DArray(r,x,c,L,k,i),this._bindTextureDirectly(d,r,!0);const D=this._getSamplingParameters(J,I);return this._gl.texParameteri(d,this._gl.TEXTURE_MAG_FILTER,D.mag),this._gl.texParameteri(d,this._gl.TEXTURE_MIN_FILTER,D.min),I&&this._gl.generateMipmap(d),this._bindTextureDirectly(d,null),this._internalTexturesCache.push(r),r}}function J(u){return function(x,s,U,_,W=null,c=0){const I=u?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,L=this._getWebGLTextureType(c),J=this._getInternalFormat(U),k=this._getRGBABufferInternalSizedFormat(c,U);this._bindTextureDirectly(I,x,!0),this._unpackFlipY(void 0===_||!!_),this._doNotHandleContextLost||(x._bufferView=s,x.format=U,x.invertY=_,x._compression=W),x.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),W&&s?this._gl.compressedTexImage3D(I,0,this.getCaps().s3tc[W],x.width,x.height,x.depth,0,s):this._gl.texImage3D(I,0,k,x.width,x.height,x.depth,0,J,L,s),x.generateMipMaps&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),x.isReady=!0}}W.w.prototype.updateRawTexture=function(u,x,s,U,_=null,W=0,c=!1){if(!u)return;const I=this._getRGBABufferInternalSizedFormat(W,s,c),L=this._getInternalFormat(s),J=this._getWebGLTextureType(W);this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0),this._unpackFlipY(void 0===U||!!U),this._doNotHandleContextLost||(u._bufferView=x,u.format=s,u.type=W,u.invertY=U,u._compression=_),u.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),_&&x?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[_],u.width,u.height,0,x):this._gl.texImage2D(this._gl.TEXTURE_2D,0,I,u.width,u.height,0,L,J,x),u.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),u.isReady=!0},W.w.prototype.createRawTexture=function(u,x,s,_,W,c,I,L=null,J=0,k=0,i=!1){const d=new U.h(this,3);d.baseWidth=x,d.baseHeight=s,d.width=x,d.height=s,d.format=_,d.generateMipMaps=W,d.samplingMode=I,d.invertY=c,d._compression=L,d.type=J,d._useSRGBBuffer=this._getUseSRGBBuffer(i,!W),this._doNotHandleContextLost||(d._bufferView=u),this.updateRawTexture(d,u,_,c,L,J,d._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0);const j=this._getSamplingParameters(I,W);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,j.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,j.min),W&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(d),d},W.w.prototype.createRawCubeTexture=function(u,x,s,W,I,L,J,k=null){const i=this._gl,d=new U.h(this,8);d.isCube=!0,d.format=s,d.type=W,this._doNotHandleContextLost||(d._bufferViewArray=u);const j=this._getWebGLTextureType(W);let r=this._getInternalFormat(s);r===i.RGB&&(r=i.RGBA),j!==i.FLOAT||this._caps.textureFloatLinearFiltering?j!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?j!==i.FLOAT||this._caps.textureFloatRender?j!==i.HALF_FLOAT||this._caps.colorBufferFloat||(I=!1,_.V.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(I=!1,_.V.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(I=!1,J=1,_.V.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(I=!1,J=1,_.V.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const D=x,$=D;if(d.width=D,d.height=$,d.invertY=L,d._compression=k,!this.needPOTTextures||c.L8(d.width)&&c.L8(d.height)||(I=!1),u)this.updateRawCubeTexture(d,u,s,W,L,k);else{const u=this._getRGBABufferInternalSizedFormat(W),x=0;this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,d,!0);for(let s=0;s<6;s++)k?i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,x,this.getCaps().s3tc[k],d.width,d.height,0,void 0):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+s,x,u,d.width,d.height,0,r,j,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,d,!0),u&&I&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const H=this._getSamplingParameters(J,I);return i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,H.mag),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,H.min),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),this._bindTextureDirectly(i.TEXTURE_CUBE_MAP,null),d.generateMipMaps=I,d.samplingMode=J,d.isReady=!0,d},W.w.prototype.updateRawCubeTexture=function(u,x,s,U,_,W=null,L=0){u._bufferViewArray=x,u.format=s,u.type=U,u.invertY=_,u._compression=W;const J=this._gl,k=this._getWebGLTextureType(U);let i=this._getInternalFormat(s);const d=this._getRGBABufferInternalSizedFormat(U);let j=!1;i===J.RGB&&(i=J.RGBA,j=!0),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,u,!0),this._unpackFlipY(void 0===_||!!_),u.width%4!=0&&J.pixelStorei(J.UNPACK_ALIGNMENT,1);for(let s=0;s<6;s++){let _=x[s];W?J.compressedTexImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+s,L,this.getCaps().s3tc[W],u.width,u.height,0,_):(j&&(_=I(_,u.width,u.height,U)),J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+s,L,d,u.width,u.height,0,i,k,_))}(!this.needPOTTextures||c.L8(u.width)&&c.L8(u.height))&&u.generateMipMaps&&0===L&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),u.isReady=!0},W.w.prototype.createRawCubeTextureFromUrl=function(u,x,s,U,_,W,c,L,J=null,k=null,i=3,d=!1){const j=this._gl,r=this.createRawCubeTexture(null,s,U,_,!W,d,i,null);null==x||x.addPendingData(r),r.url=u,r.isReady=!1,this._internalTexturesCache.push(r);const D=u=>{const s=r.width,W=c(u);if(W){if(L){const u=this._getWebGLTextureType(_);let x=this._getInternalFormat(U);const c=this._getRGBABufferInternalSizedFormat(_);let J=!1;x===j.RGB&&(x=j.RGBA,J=!0),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,r,!0),this._unpackFlipY(!1);const k=L(W);for(let U=0;U<k.length;U++){const W=s>>U;for(let s=0;s<6;s++){let L=k[U][s];J&&(L=I(L,W,W,_)),j.texImage2D(s,U,c,W,W,0,x,u,L)}}this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(r,W,U,_,d);r.isReady=!0,null==x||x.removePendingData(r),r.onLoadedObservable.notifyObservers(r),r.onLoadedObservable.clear(),J&&J()}};return this._loadFile(u,(u=>{D(u)}),void 0,null==x?void 0:x.offlineProvider,!0,((u,s)=>{null==x||x.removePendingData(r),k&&u&&k(u.status+" "+u.statusText,s)})),r},W.w.prototype.createRawTexture2DArray=L(!1),W.w.prototype.createRawTexture3D=L(!0),W.w.prototype.updateRawTexture2DArray=J(!1),W.w.prototype.updateRawTexture3D=J(!0)},269673:(u,x,s)=>{s.d(x,{k:()=>_});var U=s(499251);function _(u,x,s=!1,U){switch(u){case 3:{const u=(ArrayBuffer,new Int8Array(x));return U&&u.set(new Int8Array(U)),u}case 0:{const u=(ArrayBuffer,new Uint8Array(x));return U&&u.set(new Uint8Array(U)),u}case 4:{const u=x instanceof ArrayBuffer?new Int16Array(x):new Int16Array(s?x/2:x);return U&&u.set(new Int16Array(U)),u}case 5:case 8:case 9:case 10:case 2:{const u=x instanceof ArrayBuffer?new Uint16Array(x):new Uint16Array(s?x/2:x);return U&&u.set(new Uint16Array(U)),u}case 6:{const u=x instanceof ArrayBuffer?new Int32Array(x):new Int32Array(s?x/4:x);return U&&u.set(new Int32Array(U)),u}case 7:case 11:case 12:case 13:case 14:case 15:{const u=x instanceof ArrayBuffer?new Uint32Array(x):new Uint32Array(s?x/4:x);return U&&u.set(new Uint32Array(U)),u}case 1:{const u=x instanceof ArrayBuffer?new Float32Array(x):new Float32Array(s?x/4:x);return U&&u.set(new Float32Array(U)),u}}const _=(ArrayBuffer,new Uint8Array(x));return U&&_.set(new Uint8Array(U)),_}U.w.prototype._readTexturePixelsSync=function(u,x,s,U=-1,W=0,c=null,I=!0,L=!1,J=0,k=0){var i,d;const j=this._gl;if(!j)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const u=j.createFramebuffer();if(!u)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=u}j.bindFramebuffer(j.FRAMEBUFFER,this._dummyFramebuffer),U>-1?j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_CUBE_MAP_POSITIVE_X+U,null===(i=u._hardwareTexture)||void 0===i?void 0:i.underlyingResource,W):j.framebufferTexture2D(j.FRAMEBUFFER,j.COLOR_ATTACHMENT0,j.TEXTURE_2D,null===(d=u._hardwareTexture)||void 0===d?void 0:d.underlyingResource,W);let r=void 0!==u.type?this._getWebGLTextureType(u.type):j.UNSIGNED_BYTE;return L?c||(c=_(u.type,4*x*s)):r===j.UNSIGNED_BYTE?(c||(c=new Uint8Array(4*x*s)),r=j.UNSIGNED_BYTE):(c||(c=new Float32Array(4*x*s)),r=j.FLOAT),I&&this.flushFramebuffer(),j.readPixels(J,k,x,s,j.RGBA,r,c),j.bindFramebuffer(j.FRAMEBUFFER,this._currentFramebuffer),c},U.w.prototype._readTexturePixels=function(u,x,s,U=-1,_=0,W=null,c=!0,I=!1,L=0,J=0){return Promise.resolve(this._readTexturePixelsSync(u,x,s,U,_,W,c,I,L,J))}},68561:(u,x,s)=>{var U=s(182453),_=s(706400),W=s(499251),c=s(380245);class I extends c.v{constructor(u,x,s,U,_){super(u,x,s,U),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=_}_cloneRenderTargetWrapper(){let u=null;return this._colorTextureArray&&this._depthStencilTextureArray?(u=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),u.texture.isReady=!0):u=super._cloneRenderTargetWrapper(),u}_swapRenderTargetWrapper(u){super._swapRenderTargetWrapper(u),u._framebuffer=this._framebuffer,u._depthStencilBuffer=this._depthStencilBuffer,u._MSAAFramebuffer=this._MSAAFramebuffer,u._colorTextureArray=this._colorTextureArray,u._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(u=0,x=!0,s=!1,U=1,_=14,W){if(this._depthStencilBuffer){const u=this._engine,x=u._currentFramebuffer,s=this._context;u._bindUnboundFramebuffer(this._framebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,null),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,null),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.RENDERBUFFER,null),u._bindUnboundFramebuffer(x),s.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(u,x,s,U,_,W)}shareDepth(u){super.shareDepth(u);const x=this._context,s=this._depthStencilBuffer,U=u._MSAAFramebuffer||u._framebuffer,_=this._engine;u._depthStencilBuffer&&u._depthStencilBuffer!==s&&x.deleteRenderbuffer(u._depthStencilBuffer),u._depthStencilBuffer=s;const W=u._generateStencilBuffer?x.DEPTH_STENCIL_ATTACHMENT:x.DEPTH_ATTACHMENT;_._bindUnboundFramebuffer(U),x.framebufferRenderbuffer(x.FRAMEBUFFER,W,x.RENDERBUFFER,s),_._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(u,x=0,s,U=0){var _,W,c,I;if(!u._hardwareTexture)return;const L=this._framebuffer,J=this._engine,k=J._currentFramebuffer;if(J._bindUnboundFramebuffer(L),J.webGLVersion>1){const L=this._context,J=L["COLOR_ATTACHMENT"+x];u.is2DArray||u.is3D?(s=null!==(W=null!=s?s:null===(_=this.layerIndices)||void 0===_?void 0:_[x])&&void 0!==W?W:0,L.framebufferTextureLayer(L.FRAMEBUFFER,J,u._hardwareTexture.underlyingResource,U,s)):u.isCube?(s=null!==(I=null!=s?s:null===(c=this.faceIndices)||void 0===c?void 0:c[x])&&void 0!==I?I:0,L.framebufferTexture2D(L.FRAMEBUFFER,J,L.TEXTURE_CUBE_MAP_POSITIVE_X+s,u._hardwareTexture.underlyingResource,U)):L.framebufferTexture2D(L.FRAMEBUFFER,J,L.TEXTURE_2D,u._hardwareTexture.underlyingResource,U)}else{const _=this._context,W=_["COLOR_ATTACHMENT"+x+"_WEBGL"],c=void 0!==s?_.TEXTURE_CUBE_MAP_POSITIVE_X+s:_.TEXTURE_2D;_.framebufferTexture2D(_.FRAMEBUFFER,W,c,u._hardwareTexture.underlyingResource,U)}J._bindUnboundFramebuffer(k)}setTexture(u,x=0,s=!0){super.setTexture(u,x,s),this._bindTextureRenderTarget(u,x)}setLayerAndFaceIndices(u,x){var s,U;if(super.setLayerAndFaceIndices(u,x),!this.textures||!this.layerIndices||!this.faceIndices)return;const _=null!==(U=null===(s=this._attachments)||void 0===s?void 0:s.length)&&void 0!==U?U:this.textures.length;for(let u=0;u<_;u++){const x=this.textures[u];x&&(x.is2DArray||x.is3D?this._bindTextureRenderTarget(x,u,this.layerIndices[u]):x.isCube?this._bindTextureRenderTarget(x,u,this.faceIndices[u]):this._bindTextureRenderTarget(x,u))}}setLayerAndFaceIndex(u=0,x,s){if(super.setLayerAndFaceIndex(u,x,s),!this.textures||!this.layerIndices||!this.faceIndices)return;const U=this.textures[u];U.is2DArray||U.is3D?this._bindTextureRenderTarget(this.textures[u],u,this.layerIndices[u]):U.isCube&&this._bindTextureRenderTarget(this.textures[u],u,this.faceIndices[u])}dispose(u=this._disposeOnlyFramebuffers){const x=this._context;u||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(x.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(x.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(x.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(u)}}s(834405),W.w.prototype._createHardwareRenderTargetWrapper=function(u,x,s){const U=new I(u,x,s,this,this._gl);return this._renderTargetWrapperCache.push(U),U},W.w.prototype.createRenderTargetTexture=function(u,x){var s,U;const _=this._createHardwareRenderTargetWrapper(!1,!1,u);let W,c,I=!0,L=!1,J=!1,k=1;void 0!==x&&"object"==typeof x&&(I=null===(s=x.generateDepthBuffer)||void 0===s||s,L=!!x.generateStencilBuffer,J=!!x.noColorAttachment,W=x.colorAttachment,k=null!==(U=x.samples)&&void 0!==U?U:1,c=x.label);const i=W||(J?null:this._createInternalTexture(u,x,!0,5)),d=u.width||u,j=u.height||u,r=this._currentFramebuffer,D=this._gl,$=D.createFramebuffer();return this._bindUnboundFramebuffer($),_._depthStencilBuffer=this._setupFramebufferDepthAttachments(L,I,d,j),!i||i.is2DArray||i.is3D||D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,i._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(r),_.label=null!=c?c:"RenderTargetWrapper",_._framebuffer=$,_._generateDepthBuffer=I,_._generateStencilBuffer=L,_.setTextures(i),this.updateRenderTargetTextureSampleCount(_,k),_},W.w.prototype._createDepthStencilTexture=function(u,x,s){var W;const c=this._gl,I=u.layers||0,L=u.depth||0;let J=c.TEXTURE_2D;0!==I?J=c.TEXTURE_2D_ARRAY:0!==L&&(J=c.TEXTURE_3D);const k=new U.h(this,12);if(k.label=x.label,!this._caps.depthTextureExtension)return _.V.Error("Depth texture is not supported by your browser or hardware."),k;const i={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...x};if(this._bindTextureDirectly(J,k,!0),this._setupDepthStencilTexture(k,u,0!==i.comparisonFunction&&i.bilinearFiltering,i.comparisonFunction,i.samples),void 0!==i.depthTextureFormat){if(15!==i.depthTextureFormat&&16!==i.depthTextureFormat&&17!==i.depthTextureFormat&&13!==i.depthTextureFormat&&14!==i.depthTextureFormat&&18!==i.depthTextureFormat)return _.V.Error(`Depth texture ${i.depthTextureFormat} format is not supported.`),k;k.format=i.depthTextureFormat}else k.format=i.generateStencil?13:16;const d=17===k.format||13===k.format||18===k.format;let j=c.UNSIGNED_INT;15===k.format?j=c.UNSIGNED_SHORT:17===k.format||13===k.format?j=c.UNSIGNED_INT_24_8:14===k.format?j=c.FLOAT:18===k.format&&(j=c.FLOAT_32_UNSIGNED_INT_24_8_REV);const r=d?c.DEPTH_STENCIL:c.DEPTH_COMPONENT,D=this._getInternalFormatFromDepthTextureFormat(k.format,!0,d);return k.is2DArray?c.texImage3D(J,0,D,k.width,k.height,I,0,r,j,null):k.is3D?c.texImage3D(J,0,D,k.width,k.height,L,0,r,j,null):c.texImage2D(J,0,D,k.width,k.height,0,r,j,null),this._bindTextureDirectly(J,null),this._internalTexturesCache.push(k),s._depthStencilBuffer&&(c.deleteRenderbuffer(s._depthStencilBuffer),s._depthStencilBuffer=null),this._bindUnboundFramebuffer(null!==(W=s._MSAAFramebuffer)&&void 0!==W?W:s._framebuffer),s._generateStencilBuffer=d,s._depthStencilTextureWithStencil=d,s._depthStencilBuffer=this._setupFramebufferDepthAttachments(s._generateStencilBuffer,s._generateDepthBuffer,s.width,s.height,s.samples,k.format),this._bindUnboundFramebuffer(null),k},W.w.prototype.updateRenderTargetTextureSampleCount=function(u,x){var s,U;if(this.webGLVersion<2||!u)return 1;if(u.samples===x)return x;const _=this._gl;x=Math.min(x,this.getCaps().maxMSAASamples),u._depthStencilBuffer&&(_.deleteRenderbuffer(u._depthStencilBuffer),u._depthStencilBuffer=null),u._MSAAFramebuffer&&(_.deleteFramebuffer(u._MSAAFramebuffer),u._MSAAFramebuffer=null);const W=null===(s=u.texture)||void 0===s?void 0:s._hardwareTexture;null==W||W.releaseMSAARenderBuffers();const c=_.createFramebuffer();if(!c)throw new Error("Unable to create multi sampled framebuffer");if(u._MSAAFramebuffer=c,u.texture&&x>1&&"function"==typeof _.renderbufferStorageMultisample){this._bindUnboundFramebuffer(u._MSAAFramebuffer);const s=this._createRenderBuffer(u.texture.width,u.texture.height,x,-1,this._getRGBABufferInternalSizedFormat(u.texture.type,u.texture.format,u.texture._useSRGBBuffer),_.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");null==W||W.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(null!==(U=u._MSAAFramebuffer)&&void 0!==U?U:u._framebuffer),u.texture&&(u.texture.samples=x),u._samples=x;const I=u._depthStencilTexture?u._depthStencilTexture.format:void 0;return u._depthStencilBuffer=this._setupFramebufferDepthAttachments(u._generateStencilBuffer,u._generateDepthBuffer,u.width,u.height,x,I),this._bindUnboundFramebuffer(null),x},W.w.prototype._setupDepthStencilTexture=function(u,x,s,U,_=1){const W=x.width||x,c=x.height||x,I=x.layers||0,L=x.depth||0;u.baseWidth=W,u.baseHeight=c,u.width=W,u.height=c,u.is2DArray=I>0,u.depth=I||L,u.isReady=!0,u.samples=_,u.generateMipMaps=!1,u.samplingMode=s?2:1,u.type=0,u._comparisonFunction=U;const J=this._gl,k=this._getTextureTarget(u),i=this._getSamplingParameters(u.samplingMode,!1);J.texParameteri(k,J.TEXTURE_MAG_FILTER,i.mag),J.texParameteri(k,J.TEXTURE_MIN_FILTER,i.min),J.texParameteri(k,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(k,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===U?(J.texParameteri(k,J.TEXTURE_COMPARE_FUNC,515),J.texParameteri(k,J.TEXTURE_COMPARE_MODE,J.NONE)):(J.texParameteri(k,J.TEXTURE_COMPARE_FUNC,U),J.texParameteri(k,J.TEXTURE_COMPARE_MODE,J.COMPARE_REF_TO_TEXTURE)))}},240396:(u,x,s)=>{var U=s(182453),_=s(706400);s(499251).w.prototype.createRenderTargetCubeTexture=function(u,x){const s=this._createHardwareRenderTargetWrapper(!1,!0,u),W={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...x};W.generateStencilBuffer=W.generateDepthBuffer&&W.generateStencilBuffer,(1!==W.type||this._caps.textureFloatLinearFiltering)&&(2!==W.type||this._caps.textureHalfFloatLinearFiltering)||(W.samplingMode=1);const c=this._gl,I=new U.h(this,5);this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,I,!0);const L=this._getSamplingParameters(W.samplingMode,W.generateMipMaps);1!==W.type||this._caps.textureFloat||(W.type=0,_.V.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,L.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,L.min),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);for(let x=0;x<6;x++)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,this._getRGBABufferInternalSizedFormat(W.type,W.format),u,u,0,this._getInternalFormat(W.format),this._getWebGLTextureType(W.type),null);const J=c.createFramebuffer();return this._bindUnboundFramebuffer(J),s._depthStencilBuffer=this._setupFramebufferDepthAttachments(W.generateStencilBuffer,W.generateDepthBuffer,u,u),W.generateMipMaps&&c.generateMipmap(c.TEXTURE_CUBE_MAP),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),s._framebuffer=J,s._generateDepthBuffer=W.generateDepthBuffer,s._generateStencilBuffer=W.generateStencilBuffer,I.width=u,I.height=u,I.isReady=!0,I.isCube=!0,I.samples=1,I.generateMipMaps=W.generateMipMaps,I.samplingMode=W.samplingMode,I.type=W.type,I.format=W.format,this._internalTexturesCache.push(I),s.setTextures(I),s}},650646:(u,x,s)=>{s(499251).w.prototype.setDepthStencilTexture=function(u,x,s,U){void 0!==u&&(x&&(this._boundUniforms[u]=x),s&&s.depthStencilTexture?this._setTexture(u,s,!1,!0,U):this._setTexture(u,null,void 0,void 0,U))}},617024:(u,x,s)=>{var U=s(499251),_=s(672506);U.w.prototype.createUniformBuffer=function(u,x){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create uniform buffer");const U=new _.A(s);return this.bindUniformBuffer(U),u instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,u,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(u),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),U.references=1,U},U.w.prototype.createDynamicUniformBuffer=function(u,x){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create dynamic uniform buffer");const U=new _.A(s);return this.bindUniformBuffer(U),u instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,u,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(u),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),U.references=1,U},U.w.prototype.updateUniformBuffer=function(u,x,s,U){this.bindUniformBuffer(u),void 0===s&&(s=0),void 0===U?x instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,x):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,new Float32Array(x)):x instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,x.subarray(s,s+U)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(x).subarray(s,s+U)),this.bindUniformBuffer(null)},U.w.prototype.bindUniformBuffer=function(u){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,u?u.underlyingResource:null)},U.w.prototype.bindUniformBufferBase=function(u,x,s){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,x,u?u.underlyingResource:null)},U.w.prototype.bindUniformBlock=function(u,x,s){const U=u.program,_=this._gl.getUniformBlockIndex(U,x);4294967295!==_&&this._gl.uniformBlockBinding(U,_,s)}},867967:(u,x,s)=>{s.d(x,{nO:()=>B,pB:()=>b,jC:()=>F,M0:()=>n,Iq:()=>E,J:()=>l});const U="attribute",_="varying";class W{constructor(){this.children=[]}isValid(u){return!0}process(u,x){var s,W,c,I,L,J,k;let i="";if(this.line){let d=this.line;const j=x.processor;if(j){j.lineProcessor&&(d=j.lineProcessor(d,x.isFragment,x.processingContext));const i=null!==(W=null===(s=x.processor)||void 0===s?void 0:s.attributeKeywordName)&&void 0!==W?W:U,r=x.isFragment&&(null===(c=x.processor)||void 0===c?void 0:c.varyingFragmentKeywordName)?null===(I=x.processor)||void 0===I?void 0:I.varyingFragmentKeywordName:!x.isFragment&&(null===(L=x.processor)||void 0===L?void 0:L.varyingVertexKeywordName)?null===(J=x.processor)||void 0===J?void 0:J.varyingVertexKeywordName:_;!x.isFragment&&j.attributeProcessor&&this.line.startsWith(i)?d=j.attributeProcessor(this.line,u,x.processingContext):j.varyingProcessor&&((null===(k=j.varyingCheck)||void 0===k?void 0:k.call(j,this.line,x.isFragment))||!j.varyingCheck&&this.line.startsWith(r))?d=j.varyingProcessor(this.line,x.isFragment,u,x.processingContext):j.uniformProcessor&&j.uniformRegexp&&j.uniformRegexp.test(this.line)?x.lookForClosingBracketForUniformBuffer||(d=j.uniformProcessor(this.line,x.isFragment,u,x.processingContext)):j.uniformBufferProcessor&&j.uniformBufferRegexp&&j.uniformBufferRegexp.test(this.line)?x.lookForClosingBracketForUniformBuffer||(d=j.uniformBufferProcessor(this.line,x.isFragment,x.processingContext),x.lookForClosingBracketForUniformBuffer=!0):j.textureProcessor&&j.textureRegexp&&j.textureRegexp.test(this.line)?d=j.textureProcessor(this.line,x.isFragment,u,x.processingContext):(j.uniformProcessor||j.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!x.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?j.uniformProcessor&&(d=j.uniformProcessor(this.line,x.isFragment,u,x.processingContext)):j.uniformBufferProcessor&&(d=j.uniformBufferProcessor(this.line,x.isFragment,x.processingContext),x.lookForClosingBracketForUniformBuffer=!0)),x.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(x.lookForClosingBracketForUniformBuffer=!1,j.endOfUniformBufferProcessor&&(d=j.endOfUniformBufferProcessor(this.line,x.isFragment,x.processingContext)))}i+=d+"\n"}return this.children.forEach((s=>{i+=s.process(u,x)})),this.additionalDefineKey&&(u[this.additionalDefineKey]=this.additionalDefineValue||"true"),i}}class c{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(u){this._lines.length=0;for(const x of u){if(!x||"\r"===x)continue;if("#"===x[0]){this._lines.push(x);continue}const u=x.trim();if(!u)continue;if(u.startsWith("//")){this._lines.push(x);continue}const s=u.indexOf(";");if(-1===s)this._lines.push(u);else if(s===u.length-1)u.length>1&&this._lines.push(u);else{const u=x.split(";");for(let x=0;x<u.length;x++){let s=u[x];s&&(s=s.trim(),s&&this._lines.push(s+(x!==u.length-1?";":"")))}}}}}class I extends W{process(u,x){for(let s=0;s<this.children.length;s++){const U=this.children[s];if(U.isValid(u))return U.process(u,x)}return""}}class L extends W{isValid(u){return this.testExpression.isTrue(u)}}class J{isTrue(u){return!0}static postfixToInfix(u){const x=[];for(const s of u)if(void 0===J._OperatorPriority[s])x.push(s);else{const u=x[x.length-1],U=x[x.length-2];x.length-=2,x.push(`(${U}${s}${u})`)}return x[x.length-1]}static infixToPostfix(u){const x=J._InfixToPostfixCache.get(u);if(x)return x.accessTime=Date.now(),x.result;if(!(u.includes("&&")||u.includes("||")||u.includes(")")||u.includes("(")))return[u];const s=[];let U=-1;const _=()=>{k=k.trim(),""!==k&&(s.push(k),k="")},W=u=>{U<J._Stack.length-1&&(J._Stack[++U]=u)},c=()=>J._Stack[U],I=()=>-1===U?"!!INVALID EXPRESSION!!":J._Stack[U--];let L=0,k="";for(;L<u.length;){const x=u.charAt(L),i=L<u.length-1?u.substr(L,2):"";if("("===x)k="",W(x);else if(")"===x){for(_();-1!==U&&"("!==c();)s.push(I());I()}else if(J._OperatorPriority[i]>1){for(_();-1!==U&&J._OperatorPriority[c()]>=J._OperatorPriority[i];)s.push(I());W(i),L++}else k+=x;L++}for(_();-1!==U;)"("===c()?I():s.push(I());return J._InfixToPostfixCache.size>=J.InfixToPostfixCacheLimitSize&&J.ClearCache(),J._InfixToPostfixCache.set(u,{result:s,accessTime:Date.now()}),s}static ClearCache(){const u=Array.from(J._InfixToPostfixCache.entries()).sort(((u,x)=>u[1].accessTime-x[1].accessTime));for(let x=0;x<J.InfixToPostfixCacheCleanupSize;x++)J._InfixToPostfixCache.delete(u[x][0])}}J.InfixToPostfixCacheLimitSize=5e4,J.InfixToPostfixCacheCleanupSize=25e3,J._InfixToPostfixCache=new Map,J._OperatorPriority={")":0,"(":1,"||":2,"&&":3},J._Stack=["","","","","","","","","","","","","","","","","","","",""];class k extends J{constructor(u,x=!1){super(),this.define=u,this.not=x}isTrue(u){let x=void 0!==u[this.define];return this.not&&(x=!x),x}}class i extends J{isTrue(u){return this.leftOperand.isTrue(u)||this.rightOperand.isTrue(u)}}class d extends J{isTrue(u){return this.leftOperand.isTrue(u)&&this.rightOperand.isTrue(u)}}class j extends J{constructor(u,x,s){super(),this.define=u,this.operand=x,this.testValue=s}isTrue(u){let x=u[this.define];void 0===x&&(x=this.define);let s=!1;const U=parseInt(x),_=parseInt(this.testValue);switch(this.operand){case">":s=U>_;break;case"<":s=U<_;break;case"<=":s=U<=_;break;case">=":s=U>=_;break;case"==":s=U===_;break;case"!=":s=U!==_}return s}}var r=s(554014),D=s(45410);const $=/defined\s*?\((.+?)\)/g,H=/defined\s*?\[(.+?)\]/g,f=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,O=/__decl__/,t=/light\{X\}.(\w*)/g,V=/\{X\}/g,N=[],m=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function b(u){u.processor&&u.processor.initializeShaders&&u.processor.initializeShaders(u.processingContext)}function n(u,x,s,U){var _;(null===(_=x.processor)||void 0===_?void 0:_.preProcessShaderCode)&&(u=x.processor.preProcessShaderCode(u,x.isFragment)),E(u,x,(u=>{x.processCodeAfterIncludes&&(u=x.processCodeAfterIncludes(x.isFragment?"fragment":"vertex",u,x.defines));const _=function(u,x,s){let U=function(u,x){var s;if(null===(s=x.processor)||void 0===s?void 0:s.noPrecision)return u;const U=x.shouldUseHighPrecisionShader;return-1===u.indexOf("precision highp float")?u=U?"precision highp float;\n"+u:"precision mediump float;\n"+u:U||(u=u.replace("precision highp float","precision mediump float")),u}(u,x);if(!x.processor)return U;if(0===x.processor.shaderLanguage&&-1!==U.indexOf("#version 3")&&(U=U.replace("#version 300 es",""),!x.processor.parseGLES3))return U;const _=x.defines,W=Q(x,s);return x.processor.preProcessor&&(U=x.processor.preProcessor(U,_,W,x.isFragment,x.processingContext)),U=T(U,W,x),x.processor.postProcessor&&(U=x.processor.postProcessor(U,_,x.isFragment,x.processingContext,s?{drawBuffersExtensionDisabled:!s.getCaps().drawBuffersExtension}:{})),(null==s?void 0:s._features.needShaderCodeInlining)&&(U=s.inlineShaderCode(U)),U}(u,x,U);s(_,u)}))}function F(u,x,s,U){var _;(null===(_=x.processor)||void 0===_?void 0:_.preProcessShaderCode)&&(u=x.processor.preProcessShaderCode(u,x.isFragment)),E(u,x,(u=>{x.processCodeAfterIncludes&&(u=x.processCodeAfterIncludes(x.isFragment?"fragment":"vertex",u,x.defines));const _=function(u,x,s){var U,_;let W=u;const c=x.defines,I=Q(x,s);return(null===(U=x.processor)||void 0===U?void 0:U.preProcessor)&&(W=x.processor.preProcessor(W,c,I,x.isFragment,x.processingContext)),W=T(W,I,x),(null===(_=x.processor)||void 0===_?void 0:_.postProcessor)&&(W=x.processor.postProcessor(W,c,x.isFragment,x.processingContext,s?{drawBuffersExtensionDisabled:!s.getCaps().drawBuffersExtension}:{})),s._features.needShaderCodeInlining&&(W=s.inlineShaderCode(W)),W}(u,x,U);s(_,u)}))}function B(u,x,s){return s.processor&&s.processor.finalizeShaders?s.processor.finalizeShaders(u,x,s.processingContext):{vertexCode:u,fragmentCode:x}}function Z(u){const x=/defined\((.+)\)/.exec(u);if(x&&x.length)return new k(x[1].trim(),"!"===u[0]);const s=["==","!=",">=","<=","<",">"];let U="",_=0;for(U of s)if(_=u.indexOf(U),_>-1)break;if(-1===_)return new k(u);const W=u.substring(0,_).trim(),c=u.substring(_+U.length).trim();return new j(W,U,c)}function v(u,x){const s=new L,U=u.substring(0,x);let _=u.substring(x);return _=_.substring(0,(_.indexOf("//")+1||_.length+1)-1).trim(),s.testExpression="#ifdef"===U?new k(_):"#ifndef"===U?new k(_,!0):function(u){u=u.replace($,"defined[$1]");const x=J.infixToPostfix(u),s=[];for(const u of x)if("||"!==u&&"&&"!==u)s.push(u);else if(s.length>=2){let x=s[s.length-1],U=s[s.length-2];s.length-=2;const _="&&"==u?new d:new i;"string"==typeof x&&(x=x.replace(H,"defined($1)")),"string"==typeof U&&(U=U.replace(H,"defined($1)")),_.leftOperand="string"==typeof U?Z(U):U,_.rightOperand="string"==typeof x?Z(x):x,s.push(_)}let U=s[s.length-1];return"string"==typeof U&&(U=U.replace(H,"defined($1)")),"string"==typeof U?Z(U):U}(_),s}function y(u,x,s){let U=u.currentLine;for(;e(u,s);){U=u.currentLine;const _=U.substring(0,5).toLowerCase();if("#else"===_){const s=new W;return x.children.push(s),void e(u,s)}if("#elif"===_){const u=v(U,5);x.children.push(u),s=u}}}function e(u,x){for(;u.canRead;){u.lineIndex++;const s=u.currentLine;if(s.indexOf("#")>=0){const U=m.exec(s);if(U&&U.length){switch(U[0]){case"#ifdef":{const U=new I;x.children.push(U);const _=v(s,6);U.children.push(_),y(u,U,_);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const U=new I;x.children.push(U);const _=v(s,7);U.children.push(_),y(u,U,_);break}case"#if":{const U=new I,_=v(s,3);x.children.push(U),U.children.push(_),y(u,U,_);break}}continue}}const U=new W;if(U.line=s,x.children.push(U),"#"===s[0]&&"d"===s[1]){const u=s.replace(";","").split(" ");U.additionalDefineKey=u[1],3===u.length&&(U.additionalDefineValue=u[2])}}return!1}function T(u,x,s){const U=new W,_=new c;return _.lineIndex=-1,_.lines=u.split("\n"),e(_,U),U.process(x,s)}function Q(u,x){var s;const U=u.defines,_={};for(const u of U){const x=u.replace("#define","").replace(";","").trim().split(" ");_[x[0]]=x.length>1?x[1]:""}return 0===(null===(s=u.processor)||void 0===s?void 0:s.shaderLanguage)&&(_["GL_ES"]="true"),_["__VERSION__"]=u.version,_[u.platformName]="true",D.xt(_,null==x?void 0:x.isNDCHalfZRange,null==x?void 0:x.useReverseDepthBuffer,null==x?void 0:x.useExactSrgbConversions),_}function E(u,x,s){let U;for(N.length=0;null!==(U=f.exec(u));)N.push(U);let _=String(u),W=[u],c=!1;for(const u of N){let U=u[1];if(-1!==U.indexOf("__decl__")&&(U=U.replace(O,""),x.supportsUniformBuffers&&(U=U.replace("Vertex","Ubo").replace("Fragment","Ubo")),U+="Declaration"),!x.includesShadersStore[U]){const u=x.shadersRepository+"ShadersInclude/"+U+".fx";return void l.loadFile(u,(u=>{x.includesShadersStore[U]=u,E(W.join(""),x,s)}))}{let s=x.includesShadersStore[U];if(u[2]){const x=u[3].split(",");for(let u=0;u<x.length;u+=2){const U=new RegExp(x[u],"g"),_=x[u+1];s=s.replace(U,_)}}if(u[4]){const U=u[5];if(-1!==U.indexOf("..")){const u=U.split(".."),_=parseInt(u[0]);let W=parseInt(u[1]),c=s.slice(0);s="",isNaN(W)&&(W=x.indexParameters[u[1]]);for(let u=_;u<W;u++)x.supportsUniformBuffers||(c=c.replace(t,((u,x)=>x+"{X}"))),s+=c.replace(V,u.toString())+"\n"}else x.supportsUniformBuffers||(s=s.replace(t,((u,x)=>x+"{X}"))),s=s.replace(V,U)}const _=[];for(const x of W){const U=x.split(u[0]);for(let u=0;u<U.length-1;u++)_.push(U[u]),_.push(s);_.push(U[U.length-1])}W=_,c=c||s.indexOf("#include<")>=0||s.indexOf("#include <")>=0}}N.length=0,_=W.join(""),c?E(_.toString(),x,s):s(_)}const l={loadFile:(u,x,s,U,_,W)=>{throw r.n("FileTools")}}},874858:(u,x,s)=>{s.d(x,{B:()=>_});const U=/(flat\s)?\s*varying\s*.*/;class _{constructor(){this.shaderLanguage=0}attributeProcessor(u){return u.replace("attribute","in")}varyingCheck(u,x){return U.test(u)}varyingProcessor(u,x){return u.replace("varying",x?"in":"out")}postProcessor(u,x,s){const U=-1!==u.search(/#extension.+GL_EXT_draw_buffers.+require/);if(u=(u=u.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),s){const x=-1!==u.search(/layout *\(location *= *0\) *out/g);u=(u=(u=(u=(u=(u=(u=u.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(U||x?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else if(-1!==x.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+u;return u}}},380811:(u,x,s)=>{s.d(x,{d:()=>U});class U{get underlyingResource(){return this._webGLTexture}constructor(u=null,x){if(this._MSAARenderBuffers=null,this._context=x,!u&&!(u=x.createTexture()))throw new Error("Unable to create webGL texture");this.set(u)}setUsage(){}set(u){this._webGLTexture=u}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(u){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(u)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const u of this._MSAARenderBuffers)this._context.deleteRenderbuffer(u);this._MSAARenderBuffers=null}}getMSAARenderBuffer(u=0){var x,s;return null!==(s=null===(x=this._MSAARenderBuffers)||void 0===x?void 0:x[u])&&void 0!==s?s:null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},640785:(u,x,s)=>{s.d(x,{x:()=>U});class U{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(u){u&&this.program&&u(this.program)}setEngine(u){this.engine=u}_fillEffectInformation(u,x,s,U,_,W,c,I){const L=this.engine;if(L.supportsUniformBuffers)for(const s in x)u.bindUniformBlock(s,x[s]);let J;for(this.engine.getUniforms(this,s).forEach(((u,x)=>{U[s[x]]=u})),this._uniforms=U,J=0;J<_.length;J++)null==u.getUniform(_[J])&&(_.splice(J,1),J--);_.forEach(((u,x)=>{W[u]=x}));for(const u of L.getAttributes(this,c))I.push(u)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(u,x){const s=this._valueCache[u],U=x.updateFlag;return(void 0===s||s!==U)&&(this._valueCache[u]=U,!0)}_cacheFloat2(u,x,s){let U=this._valueCache[u];if(!U||2!==U.length)return U=[x,s],this._valueCache[u]=U,!0;let _=!1;return U[0]!==x&&(U[0]=x,_=!0),U[1]!==s&&(U[1]=s,_=!0),_}_cacheFloat3(u,x,s,U){let _=this._valueCache[u];if(!_||3!==_.length)return _=[x,s,U],this._valueCache[u]=_,!0;let W=!1;return _[0]!==x&&(_[0]=x,W=!0),_[1]!==s&&(_[1]=s,W=!0),_[2]!==U&&(_[2]=U,W=!0),W}_cacheFloat4(u,x,s,U,_){let W=this._valueCache[u];if(!W||4!==W.length)return W=[x,s,U,_],this._valueCache[u]=W,!0;let c=!1;return W[0]!==x&&(W[0]=x,c=!0),W[1]!==s&&(W[1]=s,c=!0),W[2]!==U&&(W[2]=U,c=!0),W[3]!==_&&(W[3]=_,c=!0),c}setInt(u,x){const s=this._valueCache[u];void 0!==s&&s===x||this.engine.setInt(this._uniforms[u],x)&&(this._valueCache[u]=x)}setInt2(u,x,s){this._cacheFloat2(u,x,s)&&(this.engine.setInt2(this._uniforms[u],x,s)||(this._valueCache[u]=null))}setInt3(u,x,s,U){this._cacheFloat3(u,x,s,U)&&(this.engine.setInt3(this._uniforms[u],x,s,U)||(this._valueCache[u]=null))}setInt4(u,x,s,U,_){this._cacheFloat4(u,x,s,U,_)&&(this.engine.setInt4(this._uniforms[u],x,s,U,_)||(this._valueCache[u]=null))}setIntArray(u,x){this._valueCache[u]=null,this.engine.setIntArray(this._uniforms[u],x)}setIntArray2(u,x){this._valueCache[u]=null,this.engine.setIntArray2(this._uniforms[u],x)}setIntArray3(u,x){this._valueCache[u]=null,this.engine.setIntArray3(this._uniforms[u],x)}setIntArray4(u,x){this._valueCache[u]=null,this.engine.setIntArray4(this._uniforms[u],x)}setUInt(u,x){const s=this._valueCache[u];void 0!==s&&s===x||this.engine.setUInt(this._uniforms[u],x)&&(this._valueCache[u]=x)}setUInt2(u,x,s){this._cacheFloat2(u,x,s)&&(this.engine.setUInt2(this._uniforms[u],x,s)||(this._valueCache[u]=null))}setUInt3(u,x,s,U){this._cacheFloat3(u,x,s,U)&&(this.engine.setUInt3(this._uniforms[u],x,s,U)||(this._valueCache[u]=null))}setUInt4(u,x,s,U,_){this._cacheFloat4(u,x,s,U,_)&&(this.engine.setUInt4(this._uniforms[u],x,s,U,_)||(this._valueCache[u]=null))}setUIntArray(u,x){this._valueCache[u]=null,this.engine.setUIntArray(this._uniforms[u],x)}setUIntArray2(u,x){this._valueCache[u]=null,this.engine.setUIntArray2(this._uniforms[u],x)}setUIntArray3(u,x){this._valueCache[u]=null,this.engine.setUIntArray3(this._uniforms[u],x)}setUIntArray4(u,x){this._valueCache[u]=null,this.engine.setUIntArray4(this._uniforms[u],x)}setArray(u,x){this._valueCache[u]=null,this.engine.setArray(this._uniforms[u],x)}setArray2(u,x){this._valueCache[u]=null,this.engine.setArray2(this._uniforms[u],x)}setArray3(u,x){this._valueCache[u]=null,this.engine.setArray3(this._uniforms[u],x)}setArray4(u,x){this._valueCache[u]=null,this.engine.setArray4(this._uniforms[u],x)}setMatrices(u,x){x&&(this._valueCache[u]=null,this.engine.setMatrices(this._uniforms[u],x))}setMatrix(u,x){this._cacheMatrix(u,x)&&(this.engine.setMatrices(this._uniforms[u],x.asArray())||(this._valueCache[u]=null))}setMatrix3x3(u,x){this._valueCache[u]=null,this.engine.setMatrix3x3(this._uniforms[u],x)}setMatrix2x2(u,x){this._valueCache[u]=null,this.engine.setMatrix2x2(this._uniforms[u],x)}setFloat(u,x){const s=this._valueCache[u];void 0!==s&&s===x||this.engine.setFloat(this._uniforms[u],x)&&(this._valueCache[u]=x)}setVector2(u,x){this._cacheFloat2(u,x.x,x.y)&&(this.engine.setFloat2(this._uniforms[u],x.x,x.y)||(this._valueCache[u]=null))}setFloat2(u,x,s){this._cacheFloat2(u,x,s)&&(this.engine.setFloat2(this._uniforms[u],x,s)||(this._valueCache[u]=null))}setVector3(u,x){this._cacheFloat3(u,x.x,x.y,x.z)&&(this.engine.setFloat3(this._uniforms[u],x.x,x.y,x.z)||(this._valueCache[u]=null))}setFloat3(u,x,s,U){this._cacheFloat3(u,x,s,U)&&(this.engine.setFloat3(this._uniforms[u],x,s,U)||(this._valueCache[u]=null))}setVector4(u,x){this._cacheFloat4(u,x.x,x.y,x.z,x.w)&&(this.engine.setFloat4(this._uniforms[u],x.x,x.y,x.z,x.w)||(this._valueCache[u]=null))}setQuaternion(u,x){this._cacheFloat4(u,x.x,x.y,x.z,x.w)&&(this.engine.setFloat4(this._uniforms[u],x.x,x.y,x.z,x.w)||(this._valueCache[u]=null))}setFloat4(u,x,s,U,_){this._cacheFloat4(u,x,s,U,_)&&(this.engine.setFloat4(this._uniforms[u],x,s,U,_)||(this._valueCache[u]=null))}setColor3(u,x){this._cacheFloat3(u,x.r,x.g,x.b)&&(this.engine.setFloat3(this._uniforms[u],x.r,x.g,x.b)||(this._valueCache[u]=null))}setColor4(u,x,s){this._cacheFloat4(u,x.r,x.g,x.b,s)&&(this.engine.setFloat4(this._uniforms[u],x.r,x.g,x.b,s)||(this._valueCache[u]=null))}setDirectColor4(u,x){this._cacheFloat4(u,x.r,x.g,x.b,x.a)&&(this.engine.setFloat4(this._uniforms[u],x.r,x.g,x.b,x.a)||(this._valueCache[u]=null))}_getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null}}},45410:(u,x,s)=>{s.d(x,{W0:()=>c,iL:()=>W,sg:()=>_,xt:()=>I});var U=s(554014);s(394501);const _={};function W(u,x,s=""){return s+(x?x+"\n":"")+u}function c(u,x,s,W,c,I,L){const J=L||_.loadFile;if(J)return J(u,x,s,W,c,I);throw U.n("FileTools")}function I(u,x,s,U){if(u)return x?u["IS_NDC_HALF_ZRANGE"]="":delete u["IS_NDC_HALF_ZRANGE"],s?u["USE_REVERSE_DEPTHBUFFER"]="":delete u["USE_REVERSE_DEPTHBUFFER"],void(U?u["USE_EXACT_SRGB_CONVERSIONS"]="":delete u["USE_EXACT_SRGB_CONVERSIONS"]);{let u="";return x&&(u+="#define IS_NDC_HALF_ZRANGE"),s&&(u&&(u+="\n"),u+="#define USE_REVERSE_DEPTHBUFFER"),U&&(u&&(u+="\n"),u+="#define USE_EXACT_SRGB_CONVERSIONS"),u}}},33321:(u,x,s)=>{s.d(x,{$:()=>O,r:()=>f});var U=s(395726),_=s(706400),W=s(498083),c=s(155429),I=s(488354),L=s(460976),J=s(762945),k=s(56291),i=s(822133),d=s(554014),j=s(182453),r=s(394501),D=s(638113),$=s(45410),H=s(892643);function f(u,x){if(r.BA()){const{requestAnimationFrame:s}=x||window;if("function"==typeof s)return s(u)}else if("function"==typeof requestAnimationFrame)return requestAnimationFrame(u);return setTimeout(u,16)}class O{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(u){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(u){u!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=u,this._depthCullingState.depthFunc=u?518:515)}setColorWrite(u){u!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=u)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(u){if(u)return this.isNDCHalfZRange?u["IS_NDC_HALF_ZRANGE"]="":delete u["IS_NDC_HALF_ZRANGE"],this.useReverseDepthBuffer?u["USE_REVERSE_DEPTHBUFFER"]="":delete u["USE_REVERSE_DEPTHBUFFER"],void(this.useExactSrgbConversions?u["USE_EXACT_SRGB_CONVERSIONS"]="":delete u["USE_EXACT_SRGB_CONVERSIONS"]);{let u="";return this.isNDCHalfZRange&&(u+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(u&&(u+="\n"),u+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(u&&(u+="\n"),u+="#define USE_EXACT_SRGB_CONVERSIONS"),u}}_rebuildInternalTextures(){const u=this._internalTexturesCache.slice();for(const x of u)x._rebuild()}_rebuildRenderTargetWrappers(){const u=this._renderTargetWrapperCache.slice();for(const x of u)x._rebuild()}_rebuildEffects(){for(const u in this._compiledEffects){const x=this._compiledEffects[u];x._pipelineContext=null,x._prepareEffect()}W.M.ResetCache()}_rebuildGraphicsResources(){var u;this.wipeCaches(!0),this._rebuildEffects(),null===(u=this._rebuildComputeEffects)||void 0===u||u.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){_.V.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(u){setTimeout((async()=>{this._clearEmptyResources();const x=this._depthCullingState.depthTest,s=this._depthCullingState.depthFunc,U=this._depthCullingState.depthMask,_=this._stencilState.stencilTest;await u(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=x,this._depthCullingState.depthFunc=s,this._depthCullingState.depthMask=U,this._stencilState.stencilTest=_,this._flagContextRestored()}),0)}get isDisposed(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(u){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(u){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const u=new Uint8Array(4),x=[u,u,u,u,u,u];this._emptyCubeTexture=this.createRawCubeTexture(x,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(u){if(!u)return this._activeRenderLoops.length=0,void this._cancelFrame();const x=this._activeRenderLoops.indexOf(u);x>=0&&(this._activeRenderLoops.splice(x,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const u=this._frameHandler;if(this._frameHandler=0,r.BA()){const{cancelAnimationFrame:x}=this.getHostWindow()||window;if("function"==typeof x)return x(u)}else if("function"==typeof cancelAnimationFrame)return cancelAnimationFrame(u);return clearTimeout(u)}}beginFrame(){this.onBeginFrameObservable.notifyObservers(this)}endFrame(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let u=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(u=!1),u&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let u=0;u<this._activeRenderLoops.length;u++)(0,this._activeRenderLoops[u])()}_renderViews(){return!1}_queueNewFrame(u,x){return f(u,x)}runRenderLoop(u){-1===this._activeRenderLoops.indexOf(u)&&(this._activeRenderLoops.push(u),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(u){this._depthCullingState.depthTest=u}setZOffset(u){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-u:u}getZOffset(){const u=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-u:u}setZOffsetUnits(u){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-u:u}getZOffsetUnits(){const u=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-u:u}getHostWindow(){return r.BA()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(u){this._compatibilityMode=!0}_rebuildTextures(){for(const u of this.scenes)u._rebuildTextures();for(const u of this._virtualScenes)u._rebuildTextures()}_releaseRenderTargetWrapper(u){const x=this._renderTargetWrapperCache.indexOf(u);-1!==x&&this._renderTargetWrapperCache.splice(x,1)}get currentViewport(){return this._cachedViewport}setViewport(u,x,s){const U=x||this.getRenderWidth(),_=s||this.getRenderHeight(),W=u.x||0,c=u.y||0;this._cachedViewport=u,this._viewport(W*U,c*_,U*u.width,_*u.height)}createCanvasImage(){return document.createElement("img")}get description(){let u=this.name+this.version;return this._caps.parallelShaderCompile&&(u+=" - Parallel shader compilation"),u}_createTextureBase(u,x,s,W,c=3,I=null,L=null,J,k,i=null,d=null,r=null,D=null,$,f,t){const V="data:"===(u=u||"").substr(0,5),N="blob:"===u.substr(0,5),m=V&&-1!==u.indexOf(";base64,"),b=d||new j.h(this,1);b!==d&&(b.label=u.substring(0,60));const n=u;!this._transformTextureUrl||m||d||i||(u=this._transformTextureUrl(u)),n!==u&&(b._originalUrl=n);const F=u.lastIndexOf(".");let B=D||(F>-1?u.substring(F).toLowerCase():"");B.indexOf("?")>-1&&(B=B.split("?")[0]);const Z=H.g(B,$);W&&W.addPendingData(b),b.url=u,b.generateMipMaps=!x,b.samplingMode=c,b.invertY=s,b._useSRGBBuffer=this._getUseSRGBBuffer(!!t,x),this._doNotHandleContextLost||(b._buffer=i);let v=null;I&&!d&&(v=b.onLoadedObservable.add(I)),d||this._internalTexturesCache.push(b);const y=(s,d)=>{W&&W.removePendingData(b),u===n?(v&&b.onLoadedObservable.remove(v),U.q.UseFallbackTexture&&u!==U.q.FallbackTexture&&this._createTextureBase(U.q.FallbackTexture,x,b.invertY,W,c,null,L,J,k,i,b),s=(s||"Unknown error")+(U.q.UseFallbackTexture?" - Fallback texture was used":""),b.onErrorObservable.notifyObservers({message:s,exception:d}),L&&L(s,d)):(_.V.Warn(`Failed to load ${u}, falling back to ${n}`),this._createTextureBase(n,x,b.invertY,W,c,I,L,J,k,i,b,r,D,$,f,t))};if(Z){const x=async u=>{(await Z).loadData(u,b,((u,x,s,U,_,I)=>{I?y("TextureLoader failed to load data"):J(b,B,W,{width:u,height:x},b.invertY,!s,U,(()=>(_(),!1)),c)}),f)};i?i instanceof ArrayBuffer?x(new Uint8Array(i)):ArrayBuffer.isView(i)?x(i):L&&L("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(u,(u=>x(new Uint8Array(u))),void 0,W?W.offlineProvider:void 0,!0,((u,x)=>{y("Unable to load "+(u&&u.responseURL,x))}))}else{const s=u=>{N&&!this._doNotHandleContextLost&&(b._buffer=u),J(b,B,W,u,b.invertY,x,!1,k,c)};!V||m?i&&("string"==typeof i.decoding||i.close)?s(i):O._FileToolsLoadImage(u||"",s,y,W?W.offlineProvider:null,$,b.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"==typeof i||i instanceof ArrayBuffer||ArrayBuffer.isView(i)||i instanceof Blob?O._FileToolsLoadImage(i,s,y,W?W.offlineProvider:null,$,b.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):i&&s(i)}return b}_rebuildBuffers(){for(const u of this._uniformBuffers)u._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:r.Nf()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const u in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,u)&&(this._boundTexturesCache[u]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(u){this._name=u}static get NpmPackage(){return"babylonjs@7.24.0"}static get Version(){return"7.24.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(u){this._hardwareScalingLevel=u,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(u){this._doNotHandleContextLost=u}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(u,x,s){var _,W,d,j,$,H,f,O,t,V,N;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new L.N,this._stencilStateComposer=new J.u,this._stencilState=new k.K,this._alphaState=new i.i,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new D.cP,this.onCanvasFocusObservable=new D.cP,this.onNewSceneAddedObservable=new D.cP,this.onResizeObservable=new D.cP,this.onCanvasPointerOutObservable=new D.cP,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new D.cP,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new D.cP,this.onAfterShaderCompilationObservable=new D.cP,this.onBeginFrameObservable=new D.cP,this.onEndFrameObservable=new D.cP,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new D.cP,this.onContextRestoredObservable=new D.cP,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new D.cP,U.q.Instances.push(this),this.startTime=I.j.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,c.I.SetMatrixPrecision(!!x.useHighPrecisionMatrix),r.XD()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=null!=s&&s,x.antialias=null!=u?u:x.antialias,x.deterministicLockstep=null!==(_=x.deterministicLockstep)&&void 0!==_&&_,x.lockstepMaxSteps=null!==(W=x.lockstepMaxSteps)&&void 0!==W?W:4,x.timeStep=null!==(d=x.timeStep)&&void 0!==d?d:1/60,x.audioEngine=null===(j=x.audioEngine)||void 0===j||j,x.stencil=null===($=x.stencil)||void 0===$||$,this._audioContext=null!==(f=null===(H=x.audioEngineOptions)||void 0===H?void 0:H.audioContext)&&void 0!==f?f:null,this._audioDestination=null!==(t=null===(O=x.audioEngineOptions)||void 0===O?void 0:O.audioDestination)&&void 0!==t?t:null,this.premultipliedAlpha=null===(V=x.premultipliedAlpha)||void 0===V||V,this._doNotHandleContextLost=!!x.doNotHandleContextLost,this._isStencilEnable=!!x.stencil,this.useExactSrgbConversions=null!==(N=x.useExactSrgbConversions)&&void 0!==N&&N;const m=r.BA()&&window.devicePixelRatio||1,b=x.limitDeviceRatio||m;s=s||x.adaptToDeviceRatio||!1,this._hardwareScalingLevel=s?1/Math.min(b,m):1,this._lastDevicePixelRatio=m,this._creationOptions=x}resize(u=!1){let x,s;if(this.adaptToDeviceRatio){const u=r.BA()&&window.devicePixelRatio||1,x=this._lastDevicePixelRatio/u;this._lastDevicePixelRatio=u,this._hardwareScalingLevel*=x}if(r.BA()&&r.Nf())if(this._renderingCanvas){const u=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};x=this._renderingCanvas.clientWidth||u.width||this._renderingCanvas.width||100,s=this._renderingCanvas.clientHeight||u.height||this._renderingCanvas.height||100}else x=window.innerWidth,s=window.innerHeight;else x=this._renderingCanvas?this._renderingCanvas.width:100,s=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(x/this._hardwareScalingLevel,s/this._hardwareScalingLevel,u)}setSize(u,x,s=!1){if(!this._renderingCanvas)return!1;if(u|=0,x|=0,!s&&this._renderingCanvas.width===u&&this._renderingCanvas.height===x)return!1;if(this._renderingCanvas.width=u,this._renderingCanvas.height=x,this.scenes){for(let u=0;u<this.scenes.length;u++){const x=this.scenes[u];for(let u=0;u<x.cameras.length;u++)x.cameras[u]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(u,x,s,U,_,W,c,I,L,J,k){throw d.n("engine.rawTexture")}createRawCubeTexture(u,x,s,U,_,W,c,I){throw d.n("engine.rawTexture")}createRawTexture3D(u,x,s,U,_,W,c,I,L,J,k){throw d.n("engine.rawTexture")}createRawTexture2DArray(u,x,s,U,_,W,c,I,L,J,k){throw d.n("engine.rawTexture")}_sharedInit(u){this._renderingCanvas=u}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const u=navigator.userAgent;this.hostInformation.isMobile=-1!==u.indexOf("Mobile")||-1!==u.indexOf("Mac")&&r.Nf()&&"ontouchend"in document},this._checkForMobile(),r.BA()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(u){return document.createElement("video")}_reportDrawCall(u=1){var x;null===(x=this._drawCalls)||void 0===x||x.addCount(u,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(u,x){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(u,x){return createImageBitmap(u,x)}resizeImageBitmap(u,x,s){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(u){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(u,x){if("undefined"==typeof document)return new OffscreenCanvas(u,x);const s=document.createElement("canvas");return s.width=u,s.height=x,s}createCanvas(u,x){return O._CreateCanvas(u,x)}static _FileToolsLoadImage(u,x,s,U,_,W){throw d.n("FileTools")}_loadFile(u,x,s,U,_,W){const c=$.W0(u,x,s,U,_,W);return this._activeRequests.push(c),c.onCompleteObservable.add((()=>{const u=this._activeRequests.indexOf(c);-1!==u&&this._activeRequests.splice(u,1)})),c}static _FileToolsLoadFile(u,x,s,U,_,W){if($.sg.loadFile)return $.sg.loadFile(u,x,s,U,_,W);throw d.n("FileTools")}dispose(){var u;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(u=this.releaseComputeEffects)||void 0===u||u.call(this),W.M.ResetCache();for(const u of this._activeRequests)u.abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),r.BA()&&window.removeEventListener("resize",this._checkForMobile);const x=U.q.Instances.indexOf(this);x>=0&&U.q.Instances.splice(x,1),U.q.Instances.length||(U.q.OnEnginesDisposedObservable.notifyObservers(this),U.q.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(u){throw d.n("LoadingScreen")}static MarkAllMaterialsAsDirty(u,x){for(let s=0;s<U.q.Instances.length;s++){const _=U.q.Instances[s];for(let s=0;s<_.scenes.length;s++)_.scenes[s].markAllMaterialsAsDirty(u,x)}}}O._RenderPassIdCounter=0,O._RescalePostProcessFactory=null,O.CollisionsEpsilon=.001,O.QueueNewFrame=f},697772:(u,x,s)=>{s.d(x,{BG:()=>c,PR:()=>L,eG:()=>j,g7:()=>d,jf:()=>k,kF:()=>J,kX:()=>I,rT:()=>r,tl:()=>i});var U=s(394501),_=s(33321),W=s(395726);function c(u,x,s){u._onCanvasFocus=()=>{u.onCanvasFocusObservable.notifyObservers(u)},u._onCanvasBlur=()=>{u.onCanvasBlurObservable.notifyObservers(u)},u._onCanvasContextMenu=x=>{u.disableContextMenu&&x.preventDefault()},x.addEventListener("focus",u._onCanvasFocus),x.addEventListener("blur",u._onCanvasBlur),x.addEventListener("contextmenu",u._onCanvasContextMenu),u._onBlur=()=>{u.disablePerformanceMonitorInBackground&&u.performanceMonitor.disable(),u._windowIsBackground=!0},u._onFocus=()=>{u.disablePerformanceMonitorInBackground&&u.performanceMonitor.enable(),u._windowIsBackground=!1},u._onCanvasPointerOut=s=>{document.elementFromPoint(s.clientX,s.clientY)!==x&&u.onCanvasPointerOutObservable.notifyObservers(s)};const W=u.getHostWindow();W&&"function"==typeof W.addEventListener&&(W.addEventListener("blur",u._onBlur),W.addEventListener("focus",u._onFocus)),x.addEventListener("pointerout",u._onCanvasPointerOut),s.doNotHandleTouchAction||function(u){u&&u.setAttribute&&(u.setAttribute("touch-action","none"),u.style.touchAction="none",u.style.webkitTapHighlightColor="transparent")}(x),!_.$.audioEngine&&s.audioEngine&&_.$.AudioEngineFactory&&(_.$.audioEngine=_.$.AudioEngineFactory(u.getRenderingCanvas(),u.getAudioContext(),u.getAudioDestination())),U.Nf()&&(u._onFullscreenChange=()=>{u.isFullscreen=!!document.fullscreenElement,u.isFullscreen&&u._pointerLockRequested&&x&&j(x)},document.addEventListener("fullscreenchange",u._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",u._onFullscreenChange,!1),u._onPointerLockChange=()=>{u.isPointerLock=document.pointerLockElement===x},document.addEventListener("pointerlockchange",u._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",u._onPointerLockChange,!1)),u.enableOfflineSupport=void 0!==_.$.OfflineProviderFactory,u._deterministicLockstep=!!s.deterministicLockstep,u._lockstepMaxSteps=s.lockstepMaxSteps||0,u._timeStep=s.timeStep||1/60}function I(u,x){1===W.q.Instances.length&&_.$.audioEngine&&(_.$.audioEngine.dispose(),_.$.audioEngine=null);const s=u.getHostWindow();s&&"function"==typeof s.removeEventListener&&(s.removeEventListener("blur",u._onBlur),s.removeEventListener("focus",u._onFocus)),x&&(x.removeEventListener("focus",u._onCanvasFocus),x.removeEventListener("blur",u._onCanvasBlur),x.removeEventListener("pointerout",u._onCanvasPointerOut),x.removeEventListener("contextmenu",u._onCanvasContextMenu)),U.Nf()&&(document.removeEventListener("fullscreenchange",u._onFullscreenChange),document.removeEventListener("mozfullscreenchange",u._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",u._onFullscreenChange),document.removeEventListener("msfullscreenchange",u._onFullscreenChange),document.removeEventListener("pointerlockchange",u._onPointerLockChange),document.removeEventListener("mspointerlockchange",u._onPointerLockChange),document.removeEventListener("mozpointerlockchange",u._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",u._onPointerLockChange))}function L(u){const x=document.createElement("span");x.textContent="Hg",x.style.font=u;const s=document.createElement("div");s.style.display="inline-block",s.style.width="1px",s.style.height="0px",s.style.verticalAlign="bottom";const U=document.createElement("div");U.style.whiteSpace="nowrap",U.appendChild(x),U.appendChild(s),document.body.appendChild(U);let _=0,W=0;try{W=s.getBoundingClientRect().top-x.getBoundingClientRect().top,s.style.verticalAlign="baseline",_=s.getBoundingClientRect().top-x.getBoundingClientRect().top}finally{document.body.removeChild(U)}return{ascent:_,height:W,descent:W-_}}function J(u,x,s){return new Promise(((U,_)=>{const W=new Image;W.onload=()=>{W.decode().then((()=>{u.createImageBitmap(W,s).then((u=>{U(u)}))}))},W.onerror=()=>{_(`Error loading image ${W.src}`)},W.src=x}))}function k(u,x,s,U){const _=u.createCanvas(s,U).getContext("2d");if(!_)throw new Error("Unable to get 2d context for resizeImageBitmap");return _.drawImage(x,0,0),_.getImageData(0,0,s,U).data}function i(u){const x=u.requestFullscreen||u.webkitRequestFullscreen;x&&x.call(u)}function d(){const u=document;document.exitFullscreen?document.exitFullscreen():u.webkitCancelFullScreen&&u.webkitCancelFullScreen()}function j(u){if(u.requestPointerLock){const x=u.requestPointerLock();x instanceof Promise?x.then((()=>{u.focus()})).catch((()=>{})):u.focus()}}function r(){document.exitPointerLock&&document.exitPointerLock()}},412067:(u,x,s)=>{s.d(x,{N:()=>j});var U=s(182453),_=s(395726),W=s(499251),c=s(636828),I=s(672506),L=s(706400),J=s(380811),k=(s(889630),s(269673),s(80157),s(129970),s(779010),s(649646),s(299741),s(834405),s(33321)),i=s(697772),d=s(850327);s(240124);class j extends W.w{static get NpmPackage(){return k.$.NpmPackage}static get Version(){return k.$.Version}static get Instances(){return _.q.Instances}static get LastCreatedEngine(){return _.q.LastCreatedEngine}static get LastCreatedScene(){return _.q.LastCreatedScene}static DefaultLoadingScreenFactory(u){return k.$.DefaultLoadingScreenFactory(u)}get _supportsHardwareTextureRescaling(){return!!j._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(u,x,s,U=!1){if(super(u,x,s,U),this.customAnimationFrameRequester=null,this._performanceMonitor=new c.r,this._drawCalls=new d.A,u&&(this._features.supportRenderPasses=!0,s=this._creationOptions,u.getContext)){const x=u;this._sharedInit(x)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(u){super._sharedInit(u),i.BG(this,u,this._creationOptions)}resizeImageBitmap(u,x,s){return i.jf(this,u,x,s)}_createImageBitmapFromSource(u,x){return i.kF(this,u,x)}switchFullscreen(u){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(u)}enterFullscreen(u){this.isFullscreen||(this._pointerLockRequested=u,this._renderingCanvas&&i.tl(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&i.g7()}setDitheringState(u){u?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(u){u?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(u,x,s,U){const _=this._cachedViewport;return this._cachedViewport=null,this._viewport(u,x,s,U),_}scissorClear(u,x,s,U,_){this.enableScissor(u,x,s,U),this.clear(_,!0,!0,!0),this.disableScissor()}enableScissor(u,x,s,U){const _=this._gl;_.enable(_.SCISSOR_TEST),_.scissor(u,x,s,U)}disableScissor(){const u=this._gl;u.disable(u.SCISSOR_TEST)}_loadFileAsync(u,x,s){return new Promise(((U,_)=>{this._loadFile(u,(u=>{U(u)}),void 0,x,s,((u,x)=>{_(x)}))}))}getVertexShaderSource(u){const x=this._gl.getAttachedShaders(u);return x?this._gl.getShaderSource(x[0]):null}getFragmentShaderSource(u){const x=this._gl.getAttachedShaders(u);return x?this._gl.getShaderSource(x[1]):null}set framebufferDimensionsObject(u){this._framebufferDimensionsObject=u,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const u of this.scenes)u.resetCachedMaterial(),u._rebuildGeometries();for(const u of this._virtualScenes)u.resetCachedMaterial(),u._rebuildGeometries();super._rebuildBuffers()}getFontOffset(u){return i.PR(u)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:u}=this.customAnimationFrameRequester;u&&u(this.customAnimationFrameRequester.requestID)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let u=!0;(this.isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(u=!1),u&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&i.eG(this._renderingCanvas)}exitPointerlock(){i.rT()}beginFrame(){this._measureFps(),super.beginFrame()}_deletePipelineContext(u){const x=u;x&&x.program&&x.transformFeedback&&(this.deleteTransformFeedback(x.transformFeedback),x.transformFeedback=null),super._deletePipelineContext(u)}createShaderProgram(u,x,s,U,_,W=null){_=_||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const c=super.createShaderProgram(u,x,s,U,_,W);return this.onAfterShaderCompilationObservable.notifyObservers(this),c}_createShaderProgram(u,x,s,U,_=null){const W=U.createProgram();if(u.program=W,!W)throw new Error("Unable to create program");if(U.attachShader(W,x),U.attachShader(W,s),this.webGLVersion>1&&_){const x=this.createTransformFeedback();this.bindTransformFeedback(x),this.setTranformFeedbackVaryings(W,_),u.transformFeedback=x}return U.linkProgram(W),this.webGLVersion>1&&_&&this.bindTransformFeedback(null),u.context=U,u.vertexShader=x,u.fragmentShader=s,u.isParallelCompiled||this._finalizePipelineContext(u),W}_releaseTexture(u){super._releaseTexture(u)}_releaseRenderTargetWrapper(u){super._releaseRenderTargetWrapper(u),this.scenes.forEach((x=>{x.postProcesses.forEach((x=>{x._outputTexture===u&&(x._outputTexture=null)})),x.cameras.forEach((x=>{x._postProcesses.forEach((x=>{x&&x._outputTexture===u&&(x._outputTexture=null)}))}))}))}_rescaleTexture(u,x,s,U,_){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const W=this.createRenderTargetTexture({width:x.width,height:x.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&j._RescalePostProcessFactory&&(this._rescalePostProcess=j._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const c=()=>{this._rescalePostProcess.onApply=function(x){x._bindTexture("textureSampler",u)};let c=s;c||(c=this.scenes[this.scenes.length-1]),c.postProcessManager.directRender([this._rescalePostProcess],W,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,x,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,U,0,0,x.width,x.height,0),this.unBindFramebuffer(W),W.dispose(),_&&_()},I=this._rescalePostProcess.getEffect();I?I.executeWhenCompiled(c):this._rescalePostProcess.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled(c)}))}}wrapWebGLTexture(u,x=!1,s=3,_=0,W=0){const c=new J.d(u,this._gl),I=new U.h(this,0,!0);return I._hardwareTexture=c,I.baseWidth=_,I.baseHeight=W,I.width=_,I.height=W,I.isReady=!0,I.useMipMaps=x,this.updateTextureSamplingMode(s,I),I}_uploadImageToTexture(u,x,s=0,U=0){const _=this._gl,W=this._getWebGLTextureType(u.type),c=this._getInternalFormat(u.format),I=this._getRGBABufferInternalSizedFormat(u.type,c),L=u.isCube?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D;this._bindTextureDirectly(L,u,!0),this._unpackFlipY(u.invertY);let J=_.TEXTURE_2D;u.isCube&&(J=_.TEXTURE_CUBE_MAP_POSITIVE_X+s),_.texImage2D(J,U,I,c,W,x),this._bindTextureDirectly(L,null,!0)}updateTextureComparisonFunction(u,x){if(1===this.webGLVersion)return void L.V.Error("WebGL 1 does not support texture comparison.");const s=this._gl;u.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),0===x?(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_FUNC,x),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0),0===x?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,515),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.NONE)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_FUNC,x),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),u._comparisonFunction=x}createInstancesBuffer(u){const x=this._gl.createBuffer();if(!x)throw new Error("Unable to create instance buffer");const s=new I.A(x);return s.capacity=u,this.bindArrayBuffer(s),this._gl.bufferData(this._gl.ARRAY_BUFFER,u,this._gl.DYNAMIC_DRAW),s.references=1,s}deleteInstancesBuffer(u){this._gl.deleteBuffer(u)}_clientWaitAsync(u,x=0,s=10){const U=this._gl;return new Promise(((_,W)=>{const c=()=>{const I=U.clientWaitSync(u,x,0);I!=U.WAIT_FAILED?I!=U.TIMEOUT_EXPIRED?_():setTimeout(c,s):W()};c()}))}_readPixelsAsync(u,x,s,U,_,W,c){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const I=this._gl,L=I.createBuffer();I.bindBuffer(I.PIXEL_PACK_BUFFER,L),I.bufferData(I.PIXEL_PACK_BUFFER,c.byteLength,I.STREAM_READ),I.readPixels(u,x,s,U,_,W,0),I.bindBuffer(I.PIXEL_PACK_BUFFER,null);const J=I.fenceSync(I.SYNC_GPU_COMMANDS_COMPLETE,0);return J?(I.flush(),this._clientWaitAsync(J,0,10).then((()=>(I.deleteSync(J),I.bindBuffer(I.PIXEL_PACK_BUFFER,L),I.getBufferSubData(I.PIXEL_PACK_BUFFER,0,c),I.bindBuffer(I.PIXEL_PACK_BUFFER,null),I.deleteBuffer(L),c)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),i.kX(this,this._renderingCanvas),super.dispose()}}j.ALPHA_DISABLE=0,j.ALPHA_ADD=1,j.ALPHA_COMBINE=2,j.ALPHA_SUBTRACT=3,j.ALPHA_MULTIPLY=4,j.ALPHA_MAXIMIZED=5,j.ALPHA_ONEONE=6,j.ALPHA_PREMULTIPLIED=7,j.ALPHA_PREMULTIPLIED_PORTERDUFF=8,j.ALPHA_INTERPOLATE=9,j.ALPHA_SCREENMODE=10,j.DELAYLOADSTATE_NONE=0,j.DELAYLOADSTATE_LOADED=1,j.DELAYLOADSTATE_LOADING=2,j.DELAYLOADSTATE_NOTLOADED=4,j.NEVER=512,j.ALWAYS=519,j.LESS=513,j.EQUAL=514,j.LEQUAL=515,j.GREATER=516,j.GEQUAL=518,j.NOTEQUAL=517,j.KEEP=7680,j.REPLACE=7681,j.INCR=7682,j.DECR=7683,j.INVERT=5386,j.INCR_WRAP=34055,j.DECR_WRAP=34056,j.TEXTURE_CLAMP_ADDRESSMODE=0,j.TEXTURE_WRAP_ADDRESSMODE=1,j.TEXTURE_MIRROR_ADDRESSMODE=2,j.TEXTUREFORMAT_ALPHA=0,j.TEXTUREFORMAT_LUMINANCE=1,j.TEXTUREFORMAT_LUMINANCE_ALPHA=2,j.TEXTUREFORMAT_RGB=4,j.TEXTUREFORMAT_RGBA=5,j.TEXTUREFORMAT_RED=6,j.TEXTUREFORMAT_R=6,j.TEXTUREFORMAT_RG=7,j.TEXTUREFORMAT_RED_INTEGER=8,j.TEXTUREFORMAT_R_INTEGER=8,j.TEXTUREFORMAT_RG_INTEGER=9,j.TEXTUREFORMAT_RGB_INTEGER=10,j.TEXTUREFORMAT_RGBA_INTEGER=11,j.TEXTURETYPE_UNSIGNED_BYTE=0,j.TEXTURETYPE_UNSIGNED_INT=0,j.TEXTURETYPE_FLOAT=1,j.TEXTURETYPE_HALF_FLOAT=2,j.TEXTURETYPE_BYTE=3,j.TEXTURETYPE_SHORT=4,j.TEXTURETYPE_UNSIGNED_SHORT=5,j.TEXTURETYPE_INT=6,j.TEXTURETYPE_UNSIGNED_INTEGER=7,j.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,j.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,j.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,j.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,j.TEXTURETYPE_UNSIGNED_INT_24_8=12,j.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,j.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,j.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,j.TEXTURE_NEAREST_SAMPLINGMODE=1,j.TEXTURE_BILINEAR_SAMPLINGMODE=2,j.TEXTURE_TRILINEAR_SAMPLINGMODE=3,j.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,j.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,j.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,j.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,j.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,j.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,j.TEXTURE_NEAREST_LINEAR=7,j.TEXTURE_NEAREST_NEAREST=1,j.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,j.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,j.TEXTURE_LINEAR_LINEAR=2,j.TEXTURE_LINEAR_NEAREST=12,j.TEXTURE_EXPLICIT_MODE=0,j.TEXTURE_SPHERICAL_MODE=1,j.TEXTURE_PLANAR_MODE=2,j.TEXTURE_CUBIC_MODE=3,j.TEXTURE_PROJECTION_MODE=4,j.TEXTURE_SKYBOX_MODE=5,j.TEXTURE_INVCUBIC_MODE=6,j.TEXTURE_EQUIRECTANGULAR_MODE=7,j.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,j.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,j.SCALEMODE_FLOOR=1,j.SCALEMODE_NEAREST=2,j.SCALEMODE_CEILING=3},395726:(u,x,s)=>{s.d(x,{q:()=>_});var U=s(638113);class _{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}_.Instances=[],_.OnEnginesDisposedObservable=new U.cP,_._LastCreatedScene=null,_.UseFallbackTexture=!0,_.FallbackTexture=""},155429:(u,x,s)=>{s.d(x,{I:()=>U});class U{static SetMatrixPrecision(u){if(U.MatrixTrackPrecisionChange=!1,u&&!U.MatrixUse64Bits&&U.MatrixTrackedMatrices)for(let u=0;u<U.MatrixTrackedMatrices.length;++u){const x=U.MatrixTrackedMatrices[u],s=x._m;x._m=new Array(16);for(let u=0;u<16;++u)x._m[u]=s[u]}U.MatrixUse64Bits=u,U.MatrixCurrentType=U.MatrixUse64Bits?Array:Float32Array,U.MatrixTrackedMatrices=null}}U.MatrixUse64Bits=!1,U.MatrixTrackPrecisionChange=!0,U.MatrixCurrentType=Float32Array,U.MatrixTrackedMatrices=[]},380245:(u,x,s)=>{s.d(x,{v:()=>U});class U{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var u,x;return null!==(x=null===(u=this._textures)||void 0===u?void 0:u[0])&&void 0!==x?x:null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}get samples(){return this._samples}setSamples(u,x=!0,s=!1){if(this.samples===u&&!s)return u;const U=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,u,x):this._engine.updateRenderTargetTextureSampleCount(this,u);return this._samples=u,U}constructor(u,x,s,U,_){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=u,this._isCube=x,this._size=s,this._engine=U,this._depthStencilTexture=null,this.label=_}setTextures(u){Array.isArray(u)?this._textures=u:this._textures=u?[u]:null}setTexture(u,x=0,s=!0){this._textures||(this._textures=[]),this._textures[x]!==u&&(this._textures[x]&&s&&this._textures[x].dispose(),this._textures[x]=u)}setLayerAndFaceIndices(u,x){this._layerIndices=u,this._faceIndices=x}setLayerAndFaceIndex(u=0,x,s){this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==x&&x>=0&&(this._layerIndices[u]=x),void 0!==s&&s>=0&&(this._faceIndices[u]=s)}createDepthStencilTexture(u=0,x=!0,s=!1,U=1,_=14,W){var c;return null===(c=this._depthStencilTexture)||void 0===c||c.dispose(),this._depthStencilTextureWithStencil=s,this._depthStencilTextureLabel=W,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:x,comparisonFunction:u,generateStencil:s,isCube:this._isCube,samples:U,depthTextureFormat:_,label:W},this),this._depthStencilTexture}_shareDepth(u){this.shareDepth(u)}shareDepth(u){this._depthStencilTexture&&(u._depthStencilTexture&&u._depthStencilTexture.dispose(),u._depthStencilTexture=this._depthStencilTexture,u._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(u){this.texture&&this.texture._swapAndDie(u),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){var u,x,s,U,_,W,c,I;let L=null;if(this._isMulti){const s=this.textures;if(s&&s.length>0){let U=!1,_=s.length,W=-1;const c=s[s.length-1]._source;14!==c&&12!==c||(U=!0,W=s[s.length-1].format,_--);const I=[],J=[],k=[],i=[],d=[],j=[],r=[],D={};for(let U=0;U<_;++U){const _=s[U];I.push(_.samplingMode),J.push(_.type),k.push(_.format),void 0!==D[_.uniqueId]?(i.push(-1),r.push(0)):(D[_.uniqueId]=U,_.is2DArray?(i.push(35866),r.push(_.depth)):_.isCube?(i.push(34067),r.push(0)):_.is3D?(i.push(32879),r.push(_.depth)):(i.push(3553),r.push(0))),this._faceIndices&&d.push(null!==(u=this._faceIndices[U])&&void 0!==u?u:0),this._layerIndices&&j.push(null!==(x=this._layerIndices[U])&&void 0!==x?x:0)}const $={samplingModes:I,generateMipMaps:s[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:U,depthTextureFormat:W,types:J,formats:k,textureCount:_,targetTypes:i,faceIndex:d,layerIndex:j,layerCounts:r,label:this.label},H={width:this.width,height:this.height,depth:this.depth};L=this._engine.createMultipleRenderTarget(H,$);for(let u=0;u<_;++u){if(-1!==i[u])continue;const x=D[s[u].uniqueId];L.setTexture(L.textures[x],u)}}}else{const u={};if(u.generateDepthBuffer=this._generateDepthBuffer,u.generateMipMaps=null!==(U=null===(s=this.texture)||void 0===s?void 0:s.generateMipMaps)&&void 0!==U&&U,u.generateStencilBuffer=this._generateStencilBuffer,u.samplingMode=null===(_=this.texture)||void 0===_?void 0:_.samplingMode,u.type=null===(W=this.texture)||void 0===W?void 0:W.type,u.format=null===(c=this.texture)||void 0===c?void 0:c.format,u.noColorAttachment=!this._textures,u.label=this.label,this.isCube)L=this._engine.createRenderTargetCubeTexture(this.width,u);else{const x={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(I=this.texture)||void 0===I?void 0:I.depth:void 0};L=this._engine.createRenderTargetTexture(x,u)}L.texture&&(L.texture.isReady=!0)}return L}_swapRenderTargetWrapper(u){if(this._textures&&u._textures)for(let x=0;x<this._textures.length;++x)this._textures[x]._swapAndDie(u._textures[x],!1),u._textures[x].isReady=!0;this._depthStencilTexture&&u._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(u._depthStencilTexture),u._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const u=this._cloneRenderTargetWrapper();if(u){if(this._depthStencilTexture){const x=this._depthStencilTexture.samplingMode,s=this._depthStencilTexture.format,U=2===x||3===x||11===x;u.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,U,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,s,this._depthStencilTextureLabel)}this.samples>1&&u.setSamples(this.samples),u._swapRenderTargetWrapper(this),u.dispose()}}releaseTextures(){var u,x;if(this._textures)for(let s=0;null!==(x=s<(null===(u=this._textures)||void 0===u?void 0:u.length))&&void 0!==x&&x;++s)this._textures[s].dispose();this._textures=null}dispose(u=!1){var x;u||(null===(x=this._depthStencilTexture)||void 0===x||x.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)}}},395879:(u,x,s)=>{s.d(x,{l:()=>U});class U{static GetShadersRepository(u=0){return 0===u?U.ShadersRepository:U.ShadersRepositoryWGSL}static GetShadersStore(u=0){return 0===u?U.ShadersStore:U.ShadersStoreWGSL}static GetIncludesShadersStore(u=0){return 0===u?U.IncludesShadersStore:U.IncludesShadersStoreWGSL}}U.ShadersRepository="src/Shaders/",U.ShadersStore={},U.IncludesShadersStore={},U.ShadersRepositoryWGSL="src/ShadersWGSL/",U.ShadersStoreWGSL={},U.IncludesShadersStoreWGSL={}},712251:(u,x,s)=>{s.d(x,{C5:()=>H,Cm:()=>L,EX:()=>k,GX:()=>i,N5:()=>I,YM:()=>r,bS:()=>f,kf:()=>J,tI:()=>d,tg:()=>j});var U=s(640785),_=s(45410);const W=new WeakMap,c={_webGLVersion:2,cachedPipelines:{}};function I(u){let x=W.get(u);if(!x){if(!u)return c;x={_webGLVersion:u.TEXTURE_BINDING_3D?2:1,_context:u,cachedPipelines:{}},W.set(u,x)}return x}function L(u){W.delete(u)}function J(u,x,s,U,_,W){var c;const L=I(U);return W||(W=null!==(c=L._createShaderProgramInjection)&&void 0!==c?c:d),W(u,$(x,"vertex",U,L._contextWasLost),$(s,"fragment",U,L._contextWasLost),U,_,L.validateShaderPrograms)}function k(u,x,s,U,_,W=null,c){var L;const J=I(_);c||(c=null!==(L=J._createShaderProgramInjection)&&void 0!==L?L:d);const k=J._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return c(u,D(x,"vertex",U,k,_,J._contextWasLost),D(s,"fragment",U,k,_,J._contextWasLost),_,W,J.validateShaderPrograms)}function i(u,x){const s=new U.x,_=I(u);return _.parallelShaderCompile&&(s.isParallelCompiled=!0),s.context=_._context,s}function d(u,x,s,U,_=null,W){const c=U.createProgram();if(u.program=c,!c)throw new Error("Unable to create program");return U.attachShader(c,x),U.attachShader(c,s),U.linkProgram(c),u.context=U,u.vertexShader=x,u.fragmentShader=s,u.isParallelCompiled||j(u,U,W),c}function j(u,x,s){const U=u.context,_=u.vertexShader,W=u.fragmentShader,c=u.program;if(!U.getProgramParameter(c,U.LINK_STATUS)){if(!x.getShaderParameter(_,x.COMPILE_STATUS)){const s=x.getShaderInfoLog(_);if(s)throw u.vertexCompilationError=s,new Error("VERTEX SHADER "+s)}if(!x.getShaderParameter(W,x.COMPILE_STATUS)){const s=x.getShaderInfoLog(W);if(s)throw u.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s)}const s=U.getProgramInfoLog(c);if(s)throw u.programLinkError=s,new Error(s)}if(s&&(U.validateProgram(c),!U.getProgramParameter(c,U.VALIDATE_STATUS))){const x=U.getProgramInfoLog(c);if(x)throw u.programValidationError=x,new Error(x)}U.deleteShader(_),U.deleteShader(W),u.vertexShader=void 0,u.fragmentShader=void 0,u.onCompiled&&(u.onCompiled(),u.onCompiled=void 0)}function r(u,x,s,U,_,W,c,L,i,d="",j,r,D){var $,H;const f=I(u.context);r||(r=null!==($=f.createRawShaderProgramInjection)&&void 0!==$?$:J),D||(D=null!==(H=f.createShaderProgramInjection)&&void 0!==H?H:k);const O=u;O.program=U?r(O,x,s,O.context,i):D(O,x,s,L,O.context,i),O.program.__SPECTOR_rebuildProgram=c,j()}function D(u,x,s,U,W,c){return $(_.iL(u,s,U),x,W,c)}function $(u,x,s,U){const _=s.createShader("vertex"===x?s.VERTEX_SHADER:s.FRAGMENT_SHADER);if(!_){let u=s.NO_ERROR,_=s.NO_ERROR;for(;(_=s.getError())!==s.NO_ERROR;)u=_;throw new Error(`Something went wrong while creating a gl ${x} shader object. gl error=${u}, gl isContextLost=${s.isContextLost()}, _contextWasLost=${U}`)}return s.shaderSource(_,u),s.compileShader(_),_}function H(u,x){x.useProgram(u)}function f(u,x){const s=u;if(!s.isParallelCompiled)return void x(u);const U=s.onCompiled;s.onCompiled=()=>{null==U||U(),x(u)}}},499251:(u,x,s)=>{s.d(x,{w:()=>f});var U=s(712251),_=s(163406),W=s(706400),c=s(394501);class I{constructor(){this.shaderLanguage=0}postProcessor(u,x,s,U,_){if(_.drawBuffersExtensionDisabled){const x=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;u=u.replace(x,"")}return u}}var L=s(874858),J=s(672506),k=s(104270),i=s(33321),d=s(380811),j=s(182453),r=s(498083),D=s(45410),$=s(286648);class H{}class f extends i.${get name(){return this._name}set name(u){this._name=u}get version(){return this._webGLVersion}static get ShadersRepository(){return r.M.ShadersRepository}static set ShadersRepository(u){r.M.ShadersRepository=u}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(u){this._framebufferDimensionsObject=u}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(u,x,s,_){if(s=s||{},super(null!=x?x:s.antialias,s,_),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!u)return;let c=null;if(u.getContext){if(c=u,this._renderingCanvas=c,void 0===s.preserveDrawingBuffer&&(s.preserveDrawingBuffer=!1),void 0===s.xrCompatible&&(s.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const u=navigator.userAgent;for(const x of f.ExceptionList){const U=x.key,_=x.targets;if(new RegExp(U).test(u)){if(x.capture&&x.captureConstraint){const s=x.capture,U=x.captureConstraint,_=new RegExp(s).exec(u);if(_&&_.length>0&&parseInt(_[_.length-1])>=U)continue}for(const u of _)switch(u){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":s.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=u=>{u.preventDefault(),this._contextWasLost=!0,W.V.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},c.addEventListener("webglcontextlost",this._onContextLost,!1),c.addEventListener("webglcontextrestored",this._onContextRestored,!1),s.powerPreference=s.powerPreference||"high-performance"),this._badDesktopOS&&(s.xrCompatible=!1),!s.disableWebGL2Support)try{this._gl=c.getContext("webgl2",s)||c.getContext("experimental-webgl2",s),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(u){}if(!this._gl){if(!c)throw new Error("The provided canvas is null or undefined.");try{this._gl=c.getContext("webgl",s)||c.getContext("experimental-webgl",s)}catch(u){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=u,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const x=this._gl.getContextAttributes();x&&(s.stencil=x.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==s.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=s.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let u=0;u<this._caps.maxVertexAttribs;u++)this._currentBufferPointers[u]=new H;this._shaderProcessor=this.webGLVersion>1?new L.B:new I;const J=`Babylon.js v${f.Version}`;W.V.Log(J+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",J);const k=U.N5(this._gl);k.validateShaderPrograms=this.validateShaderPrograms,k.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(u){return null}areAllEffectsReady(){for(const u in this._compiledEffects)if(!this._compiledEffects[u].isReady())return!1;return!0}_initGLContext(){var u;this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const x=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=x&&(this._glRenderer=this._gl.getParameter(x.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(x.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(null!==(u=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT))&&void 0!==u?u:0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{const u=this._gl.getExtension("WEBGL_draw_buffers");if(null!==u){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=u.drawBuffersWEBGL.bind(u),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let x=0;x<16;x++)this._gl["COLOR_ATTACHMENT"+x+"_WEBGL"]=u["COLOR_ATTACHMENT"+x+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const u=this._gl.getExtension("WEBGL_depth_texture");null!=u&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=u.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const u=this._gl.getExtension("OES_vertex_array_object");null!=u&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=u.createVertexArrayOES.bind(u),this._gl.bindVertexArray=u.bindVertexArrayOES.bind(u),this._gl.deleteVertexArray=u.deleteVertexArrayOES.bind(u))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const u=this._gl.getExtension("ANGLE_instanced_arrays");null!=u?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=u.drawArraysInstancedANGLE.bind(u),this._gl.drawElementsInstanced=u.drawElementsInstancedANGLE.bind(u),this._gl.vertexAttribDivisor=u.vertexAttribDivisorANGLE.bind(u)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const u=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),x=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);u&&x&&(this._caps.highPrecisionShaderSupported=0!==u.precision&&0!==x.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const u=this._gl.getExtension("EXT_sRGB");null!=u&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:u.SRGB_EXT,SRGB8:u.SRGB_ALPHA_EXT,SRGB8_ALPHA8:u.SRGB_ALPHA_EXT})}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"==typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const u=this._workingCanvas.getContext("2d");u&&(this._workingContext=u)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const u=this.getGlInfo();return u&&u.renderer?u.renderer:""}getRenderWidth(u=!1){return!u&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(u=!1){return!u&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(u,x,s,U=!1){var _,W;const c=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=c;let I=0;if(x&&u){let x=!0;if(this._currentRenderTarget){const s=null===(_=this._currentRenderTarget.texture)||void 0===_?void 0:_.format;if(8===s||9===s||10===s||11===s){const s=null===(W=this._currentRenderTarget.texture)||void 0===W?void 0:W.type;7===s||5===s?(f._TempClearColorUint32[0]=255*u.r,f._TempClearColorUint32[1]=255*u.g,f._TempClearColorUint32[2]=255*u.b,f._TempClearColorUint32[3]=255*u.a,this._gl.clearBufferuiv(this._gl.COLOR,0,f._TempClearColorUint32),x=!1):(f._TempClearColorInt32[0]=255*u.r,f._TempClearColorInt32[1]=255*u.g,f._TempClearColorInt32[2]=255*u.b,f._TempClearColorInt32[3]=255*u.a,this._gl.clearBufferiv(this._gl.COLOR,0,f._TempClearColorInt32),x=!1)}}x&&(this._gl.clearColor(u.r,u.g,u.b,void 0!==u.a?u.a:1),I|=this._gl.COLOR_BUFFER_BIT)}s&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),I|=this._gl.DEPTH_BUFFER_BIT),U&&(this._gl.clearStencil(0),I|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(I)}_viewport(u,x,s,U){u===this._viewportCached.x&&x===this._viewportCached.y&&s===this._viewportCached.z&&U===this._viewportCached.w||(this._viewportCached.x=u,this._viewportCached.y=x,this._viewportCached.z=s,this._viewportCached.w=U,this._gl.viewport(u,x,s,U))}endFrame(){super.endFrame(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(u,x=0,s,U,_,c=0,I=0){var L,J,k,i,d,j;const r=u;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=u,this._bindUnboundFramebuffer(r._framebuffer);const D=this._gl;u.isMulti||(u.is2DArray||u.is3D?(D.framebufferTextureLayer(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,null===(L=u.texture._hardwareTexture)||void 0===L?void 0:L.underlyingResource,c,I),r._currentLOD=c):u.isCube?D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+x,null===(J=u.texture._hardwareTexture)||void 0===J?void 0:J.underlyingResource,c):r._currentLOD!==c&&(D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,null===(k=u.texture._hardwareTexture)||void 0===k?void 0:k.underlyingResource,c),r._currentLOD=c));const $=u._depthStencilTexture;if($){u.is3D&&(u.texture.width===$.width&&u.texture.height===$.height&&u.texture.depth===$.depth||W.V.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const s=u._depthStencilTextureWithStencil?D.DEPTH_STENCIL_ATTACHMENT:D.DEPTH_ATTACHMENT;u.is2DArray||u.is3D?D.framebufferTextureLayer(D.FRAMEBUFFER,s,null===(i=$._hardwareTexture)||void 0===i?void 0:i.underlyingResource,c,I):u.isCube?D.framebufferTexture2D(D.FRAMEBUFFER,s,D.TEXTURE_CUBE_MAP_POSITIVE_X+x,null===(d=$._hardwareTexture)||void 0===d?void 0:d.underlyingResource,c):D.framebufferTexture2D(D.FRAMEBUFFER,s,D.TEXTURE_2D,null===(j=$._hardwareTexture)||void 0===j?void 0:j.underlyingResource,c)}r._MSAAFramebuffer&&this._bindUnboundFramebuffer(r._MSAAFramebuffer),this._cachedViewport&&!_?this.setViewport(this._cachedViewport,s,U):(s||(s=u.width,c&&(s/=Math.pow(2,c))),U||(U=u.height,c&&(U/=Math.pow(2,c))),this._viewport(0,0,s,U)),this.wipeCaches()}setState(u,x=0,s,U=!1,_,W,c=0){var I,L;(this._depthCullingState.cull!==u||s)&&(this._depthCullingState.cull=u);const J=null===(L=null!==(I=this.cullBackFaces)&&void 0!==I?I:_)||void 0===L||L?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==J||s)&&(this._depthCullingState.cullFace=J),this.setZOffset(x),this.setZOffsetUnits(c);const k=U?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==k||s)&&(this._depthCullingState.frontFace=k),this._stencilStateComposer.stencilMaterial=W}_bindUnboundFramebuffer(u){this._currentFramebuffer!==u&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,u),this._currentFramebuffer=u)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(u){const x=this._getTextureTarget(u);this._bindTextureDirectly(x,u,!0),this._gl.generateMipmap(x),this._bindTextureDirectly(x,null)}unBindFramebuffer(u,x=!1,s){var U;const _=u;this._currentRenderTarget=null;const W=this._gl;if(_._MSAAFramebuffer){if(u.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(u,x,s);W.bindFramebuffer(W.READ_FRAMEBUFFER,_._MSAAFramebuffer),W.bindFramebuffer(W.DRAW_FRAMEBUFFER,_._framebuffer),W.blitFramebuffer(0,0,u.width,u.height,0,0,u.width,u.height,W.COLOR_BUFFER_BIT,W.NEAREST)}!(null===(U=u.texture)||void 0===U?void 0:U.generateMipMaps)||x||u.isCube||this.generateMipmaps(u.texture),s&&(_._MSAAFramebuffer&&this._bindUnboundFramebuffer(_._framebuffer),s()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(u,x,s){return this._createVertexBuffer(u,this._gl.STATIC_DRAW)}_createVertexBuffer(u,x){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create vertex buffer");const U=new J.A(s);return this.bindArrayBuffer(U),"number"!=typeof u?u instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(u),x),U.capacity=4*u.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,u,x),U.capacity=u.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(u),x),U.capacity=u),this._resetVertexBufferBinding(),U.references=1,U}createDynamicVertexBuffer(u,x){return this._createVertexBuffer(u,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(u,x,s){const U=this._gl.createBuffer(),_=new J.A(U);if(!U)throw new Error("Unable to create index buffer");this.bindIndexBuffer(_);const W=this._normalizeIndexData(u);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,W,x?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),_.references=1,_.is32Bits=4===W.BYTES_PER_ELEMENT,_}_normalizeIndexData(u){if(2===u.BYTES_PER_ELEMENT)return u;if(this._caps.uintIndices){if(u instanceof Uint32Array)return u;for(let x=0;x<u.length;x++)if(u[x]>=65535)return new Uint32Array(u);return new Uint16Array(u)}return new Uint16Array(u)}bindArrayBuffer(u){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(u,this._gl.ARRAY_BUFFER)}bindUniformBlock(u,x,s){const U=u.program,_=this._gl.getUniformBlockIndex(U,x);this._gl.uniformBlockBinding(U,_,s)}bindIndexBuffer(u){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(u,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(u,x){(this._vaoRecordInProgress||this._currentBoundBuffer[x]!==u)&&(this._gl.bindBuffer(x,u?u.underlyingResource:null),this._currentBoundBuffer[x]=u)}updateArrayBuffer(u){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,u)}_vertexAttribPointer(u,x,s,U,_,W,c){const I=this._currentBufferPointers[x];if(!I)return;let L=!1;I.active?(I.buffer!==u&&(I.buffer=u,L=!0),I.size!==s&&(I.size=s,L=!0),I.type!==U&&(I.type=U,L=!0),I.normalized!==_&&(I.normalized=_,L=!0),I.stride!==W&&(I.stride=W,L=!0),I.offset!==c&&(I.offset=c,L=!0)):(L=!0,I.active=!0,I.index=x,I.size=s,I.type=U,I.normalized=_,I.stride=W,I.offset=c,I.buffer=u),(L||this._vaoRecordInProgress)&&(this.bindArrayBuffer(u),U===this._gl.UNSIGNED_INT||U===this._gl.INT?this._gl.vertexAttribIPointer(x,s,U,W,c):this._gl.vertexAttribPointer(x,s,U,_,W,c))}_bindIndexBufferWithCache(u){null!=u&&this._cachedIndexBuffer!==u&&(this._cachedIndexBuffer=u,this.bindIndexBuffer(u),this._uintIndicesCurrentlySet=u.is32Bits)}_bindVertexBuffersAttributes(u,x,s){const U=x.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let _=0;_<U.length;_++){const W=x.getAttributeLocation(_);if(W>=0){const x=U[_];let c=null;if(s&&(c=s[x]),c||(c=u[x]),!c)continue;this._gl.enableVertexAttribArray(W),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[W]=!0);const I=c.getBuffer();I&&(this._vertexAttribPointer(I,W,c.getSize(),c.type,c.normalized,c.byteStride,c.byteOffset),c.getIsInstanced()&&(this._gl.vertexAttribDivisor(W,c.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(W),this._currentInstanceBuffers.push(I))))}}}recordVertexArrayObject(u,x,s,U){const _=this._gl.createVertexArray();if(!_)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(_),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(u,s,U),this.bindIndexBuffer(x),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),_}bindVertexArrayObject(u,x){this._cachedVertexArrayObject!==u&&(this._cachedVertexArrayObject=u,this._gl.bindVertexArray(u),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=x&&x.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(u,x,s,U,_){if(this._cachedVertexBuffers!==u||this._cachedEffectForVertexBuffers!==_){this._cachedVertexBuffers=u,this._cachedEffectForVertexBuffers=_;const x=_.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let W=0;for(let c=0;c<x;c++)if(c<s.length){const x=_.getAttributeLocation(c);x>=0&&(this._gl.enableVertexAttribArray(x),this._vertexAttribArraysEnabled[x]=!0,this._vertexAttribPointer(u,x,s[c],this._gl.FLOAT,!1,U,W)),W+=4*s[c]}}this._bindIndexBufferWithCache(x)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(u,x,s,U){this._cachedVertexBuffers===u&&this._cachedEffectForVertexBuffers===s||(this._cachedVertexBuffers=u,this._cachedEffectForVertexBuffers=s,this._bindVertexBuffersAttributes(u,s,U)),this._bindIndexBufferWithCache(x)}unbindInstanceAttributes(){let u;for(let x=0,s=this._currentInstanceLocations.length;x<s;x++){const s=this._currentInstanceBuffers[x];u!=s&&s.references&&(u=s,this.bindArrayBuffer(s));const U=this._currentInstanceLocations[x];this._gl.vertexAttribDivisor(U,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(u){this._gl.deleteVertexArray(u)}_releaseBuffer(u){return u.references--,0===u.references&&(this._deleteBuffer(u),!0)}_deleteBuffer(u){this._gl.deleteBuffer(u.underlyingResource)}updateAndBindInstancesBuffer(u,x,s){if(this.bindArrayBuffer(u),x&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,x),void 0!==s[0].index)this.bindInstancesBuffer(u,s,!0);else for(let x=0;x<4;x++){const U=s[x];this._vertexAttribArraysEnabled[U]||(this._gl.enableVertexAttribArray(U),this._vertexAttribArraysEnabled[U]=!0),this._vertexAttribPointer(u,U,4,this._gl.FLOAT,!1,64,16*x),this._gl.vertexAttribDivisor(U,1),this._currentInstanceLocations.push(U),this._currentInstanceBuffers.push(u)}}bindInstancesBuffer(u,x,s=!0){this.bindArrayBuffer(u);let U=0;if(s)for(let u=0;u<x.length;u++)U+=4*x[u].attributeSize;for(let s=0;s<x.length;s++){const _=x[s];void 0===_.index&&(_.index=this._currentEffect.getAttributeLocationByName(_.attributeName)),_.index<0||(this._vertexAttribArraysEnabled[_.index]||(this._gl.enableVertexAttribArray(_.index),this._vertexAttribArraysEnabled[_.index]=!0),this._vertexAttribPointer(u,_.index,_.attributeSize,_.attributeType||this._gl.FLOAT,_.normalized||!1,U,_.offset),this._gl.vertexAttribDivisor(_.index,void 0===_.divisor?1:_.divisor),this._currentInstanceLocations.push(_.index),this._currentInstanceBuffers.push(u))}}disableInstanceAttributeByName(u){if(!this._currentEffect)return;const x=this._currentEffect.getAttributeLocationByName(u);this.disableInstanceAttribute(x)}disableInstanceAttribute(u){let x,s=!1;for(;-1!==(x=this._currentInstanceLocations.indexOf(u));)this._currentInstanceLocations.splice(x,1),this._currentInstanceBuffers.splice(x,1),s=!0,x=this._currentInstanceLocations.indexOf(u);s&&(this._gl.vertexAttribDivisor(u,0),this.disableAttributeByIndex(u))}disableAttributeByIndex(u){this._gl.disableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!1,this._currentBufferPointers[u].active=!1}draw(u,x,s,U){this.drawElementsType(u?0:1,x,s,U)}drawPointClouds(u,x,s){this.drawArraysType(2,u,x,s)}drawUnIndexed(u,x,s,U){this.drawArraysType(u?0:1,x,s,U)}drawElementsType(u,x,s,U){this.applyStates(),this._reportDrawCall();const _=this._drawMode(u),W=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,c=this._uintIndicesCurrentlySet?4:2;U?this._gl.drawElementsInstanced(_,s,W,x*c,U):this._gl.drawElements(_,s,W,x*c)}drawArraysType(u,x,s,U){this.applyStates(),this._reportDrawCall();const _=this._drawMode(u);U?this._gl.drawArraysInstanced(_,x,s,U):this._gl.drawArrays(_,x,s)}_drawMode(u){switch(u){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(u){this._compiledEffects[u._key]&&delete this._compiledEffects[u._key];const x=u.getPipelineContext();x&&this._deletePipelineContext(x)}_deletePipelineContext(u){const x=u;x&&x.program&&(x.program.__SPECTOR_rebuildProgram=null,$.mO(x),this._gl.deleteProgram(x.program))}_getGlobalDefines(u){return D.xt(u,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(u,x,s,_,W,c,I,L,J,k=0,i){var d,j,D;const $="string"==typeof u?u:u.vertexToken||u.vertexSource||u.vertexElement||u.vertex,H="string"==typeof u?u:u.fragmentToken||u.fragmentSource||u.fragmentElement||u.fragment,f=this._getGlobalDefines();let O=null!==(d=null!=W?W:x.defines)&&void 0!==d?d:"";f&&(O+=f);const t=$+"+"+H+"@"+O;if(this._compiledEffects[t]){const u=this._compiledEffects[t];return I&&u.isReady()&&I(u),u._refCount++,u}this._gl&&U.N5(this._gl);const V=new r.M(u,x,s,_,this,W,c,I,L,J,t,null!==(j=x.shaderLanguage)&&void 0!==j?j:k,null!==(D=x.extraInitializationsAsync)&&void 0!==D?D:i);return this._compiledEffects[t]=V,V}_getShaderSource(u){return this._gl.getShaderSource(u)}createRawShaderProgram(u,x,s,_,W=null){const c=U.N5(this._gl);return c._contextWasLost=this._contextWasLost,c.validateShaderPrograms=this.validateShaderPrograms,U.kf(u,x,s,_||this._gl,W)}createShaderProgram(u,x,s,_,W,c=null){const I=U.N5(this._gl);return I._contextWasLost=this._contextWasLost,I.validateShaderPrograms=this.validateShaderPrograms,U.EX(u,x,s,_,W||this._gl,c)}inlineShaderCode(u){return u}createPipelineContext(u){this._gl&&(U.N5(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile);const x=U.GX(this._gl,u);return x.engine=this,x}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(u){return U.tg(u,this._gl,this.validateShaderPrograms)}_preparePipelineContext(u,x,s,_,W,c,I,L,J,k,i){const d=U.N5(this._gl);return d._contextWasLost=this._contextWasLost,d.validateShaderPrograms=this.validateShaderPrograms,d._createShaderProgramInjection=this._createShaderProgram.bind(this),d.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),d.createShaderProgramInjection=this.createShaderProgram.bind(this),d.loadFileInjection=this._loadFile.bind(this),U.YM(u,x,s,_,W,c,I,L,J,k,i)}_createShaderProgram(u,x,s,_,W=null){return U.tI(u,x,s,_,W)}_isRenderingStateCompiled(u){const x=u;return!(this._isDisposed||x._isDisposed||!this._gl.getProgramParameter(x.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)||(this._finalizePipelineContext(x),0))}_executeWhenRenderingStateIsCompiled(u,x){U.bS(u,x)}getUniforms(u,x){const s=new Array,U=u;for(let u=0;u<x.length;u++)s.push(this._gl.getUniformLocation(U.program,x[u]));return s}getAttributes(u,x){const s=[],U=u;for(let u=0;u<x.length;u++)try{s.push(this._gl.getAttribLocation(U.program,x[u]))}catch(u){s.push(-1)}return s}enableEffect(u){(u=null!==u&&_.E(u)?u.effect:u)&&u!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(u),this._currentEffect=u,u.onBind&&u.onBind(u),u._onBindObservable&&u._onBindObservable.notifyObservers(u))}setInt(u,x){return!!u&&(this._gl.uniform1i(u,x),!0)}setInt2(u,x,s){return!!u&&(this._gl.uniform2i(u,x,s),!0)}setInt3(u,x,s,U){return!!u&&(this._gl.uniform3i(u,x,s,U),!0)}setInt4(u,x,s,U,_){return!!u&&(this._gl.uniform4i(u,x,s,U,_),!0)}setIntArray(u,x){return!!u&&(this._gl.uniform1iv(u,x),!0)}setIntArray2(u,x){return!(!u||x.length%2!=0||(this._gl.uniform2iv(u,x),0))}setIntArray3(u,x){return!(!u||x.length%3!=0||(this._gl.uniform3iv(u,x),0))}setIntArray4(u,x){return!(!u||x.length%4!=0||(this._gl.uniform4iv(u,x),0))}setUInt(u,x){return!!u&&(this._gl.uniform1ui(u,x),!0)}setUInt2(u,x,s){return!!u&&(this._gl.uniform2ui(u,x,s),!0)}setUInt3(u,x,s,U){return!!u&&(this._gl.uniform3ui(u,x,s,U),!0)}setUInt4(u,x,s,U,_){return!!u&&(this._gl.uniform4ui(u,x,s,U,_),!0)}setUIntArray(u,x){return!!u&&(this._gl.uniform1uiv(u,x),!0)}setUIntArray2(u,x){return!(!u||x.length%2!=0||(this._gl.uniform2uiv(u,x),0))}setUIntArray3(u,x){return!(!u||x.length%3!=0||(this._gl.uniform3uiv(u,x),0))}setUIntArray4(u,x){return!(!u||x.length%4!=0||(this._gl.uniform4uiv(u,x),0))}setArray(u,x){return!(!u||x.length<1||(this._gl.uniform1fv(u,x),0))}setArray2(u,x){return!(!u||x.length%2!=0||(this._gl.uniform2fv(u,x),0))}setArray3(u,x){return!(!u||x.length%3!=0||(this._gl.uniform3fv(u,x),0))}setArray4(u,x){return!(!u||x.length%4!=0||(this._gl.uniform4fv(u,x),0))}setMatrices(u,x){return!!u&&(this._gl.uniformMatrix4fv(u,!1,x),!0)}setMatrix3x3(u,x){return!!u&&(this._gl.uniformMatrix3fv(u,!1,x),!0)}setMatrix2x2(u,x){return!!u&&(this._gl.uniformMatrix2fv(u,!1,x),!0)}setFloat(u,x){return!!u&&(this._gl.uniform1f(u,x),!0)}setFloat2(u,x,s){return!!u&&(this._gl.uniform2f(u,x,s),!0)}setFloat3(u,x,s,U){return!!u&&(this._gl.uniform3f(u,x,s,U),!0)}setFloat4(u,x,s,U,_){return!!u&&(this._gl.uniform4f(u,x,s,U,_),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const u=this._colorWrite;this._gl.colorMask(u,u,u,u)}}wipeCaches(u){this.preventCacheWipeBetweenFrames&&!u||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),u&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(u,x){const s=this._gl;let U=s.NEAREST,_=s.NEAREST;switch(u){case 11:U=s.LINEAR,_=x?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 3:U=s.LINEAR,_=x?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 8:U=s.NEAREST,_=x?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 4:U=s.NEAREST,_=x?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 5:U=s.NEAREST,_=x?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 6:U=s.NEAREST,_=x?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 7:U=s.NEAREST,_=s.LINEAR;break;case 1:U=s.NEAREST,_=s.NEAREST;break;case 9:U=s.LINEAR,_=x?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 10:U=s.LINEAR,_=x?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 2:U=s.LINEAR,_=s.LINEAR;break;case 12:U=s.LINEAR,_=s.NEAREST}return{min:_,mag:U}}_createTexture(){const u=this._gl.createTexture();if(!u)throw new Error("Unable to create texture");return u}_createHardwareTexture(){return new d.d(this._createTexture(),this._gl)}_createInternalTexture(u,x,s=!0,U=0){var _;let c,I=!1,L=0,J=3,k=5,i=!1,d=1;void 0!==x&&"object"==typeof x?(I=!!x.generateMipMaps,L=void 0===x.type?0:x.type,J=void 0===x.samplingMode?3:x.samplingMode,k=void 0===x.format?5:x.format,i=void 0!==x.useSRGBBuffer&&x.useSRGBBuffer,d=null!==(_=x.samples)&&void 0!==_?_:1,c=x.label):I=!!x,i&&(i=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==L||this._caps.textureFloatLinearFiltering)&&(2!==L||this._caps.textureHalfFloatLinearFiltering)||(J=1),1!==L||this._caps.textureFloat||(L=0,W.V.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const r=this._gl,D=new j.h(this,U),$=u.width||u,H=u.height||u,f=u.depth||0,O=u.layers||0,t=this._getSamplingParameters(J,I),V=0!==O?r.TEXTURE_2D_ARRAY:0!==f?r.TEXTURE_3D:r.TEXTURE_2D,N=this._getRGBABufferInternalSizedFormat(L,k,i),m=this._getInternalFormat(k),b=this._getWebGLTextureType(L);return this._bindTextureDirectly(V,D),0!==O?(D.is2DArray=!0,r.texImage3D(V,0,N,$,H,O,0,m,b,null)):0!==f?(D.is3D=!0,r.texImage3D(V,0,N,$,H,f,0,m,b,null)):r.texImage2D(V,0,N,$,H,0,m,b,null),r.texParameteri(V,r.TEXTURE_MAG_FILTER,t.mag),r.texParameteri(V,r.TEXTURE_MIN_FILTER,t.min),r.texParameteri(V,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(V,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),I&&this._gl.generateMipmap(V),this._bindTextureDirectly(V,null),D._useSRGBBuffer=i,D.baseWidth=$,D.baseHeight=H,D.width=$,D.height=H,D.depth=O,D.isReady=!0,D.samples=d,D.generateMipMaps=I,D.samplingMode=J,D.type=L,D.format=k,D.label=c,this._internalTexturesCache.push(D),D}_getUseSRGBBuffer(u,x){return u&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||x)}createTexture(u,x,s,U,_=3,W=null,c=null,I=null,L=null,J=null,k=null,i,d,r,D){return this._createTextureBase(u,x,s,U,_,W,c,((...u)=>this._prepareWebGLTexture(...u,J)),((u,x,s,_,W,c)=>{const I=this._gl,L=s.width===u&&s.height===x;W._creationFlags=null!=r?r:0;const J=this._getTexImageParametersForCreateTexture(W.format,W._useSRGBBuffer);if(L)return I.texImage2D(I.TEXTURE_2D,0,J.internalFormat,J.format,J.type,s),!1;const k=this._caps.maxTextureSize;if(s.width>k||s.height>k||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext||(this._workingCanvas.width=u,this._workingCanvas.height=x,this._workingContext.drawImage(s,0,0,s.width,s.height,0,0,u,x),I.texImage2D(I.TEXTURE_2D,0,J.internalFormat,J.format,J.type,this._workingCanvas),W.width=u,W.height=x,1));{const u=new j.h(this,2);this._bindTextureDirectly(I.TEXTURE_2D,u,!0),I.texImage2D(I.TEXTURE_2D,0,J.internalFormat,J.format,J.type,s),this._rescaleTexture(u,W,U,J.format,(()=>{this._releaseTexture(u),this._bindTextureDirectly(I.TEXTURE_2D,W,!0),c()}))}return!0}),I,L,J,k,i,d,D)}_getTexImageParametersForCreateTexture(u,x){let s,U;return 1===this.webGLVersion?(s=this._getInternalFormat(u,x),U=s):(s=this._getInternalFormat(u,!1),U=this._getRGBABufferInternalSizedFormat(0,u,x)),{internalFormat:U,format:s,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(u,x,s,U,_){}_unpackFlipY(u){this._unpackFlipYCached!==u&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,u?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=u))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(u){return u.isCube?this._gl.TEXTURE_CUBE_MAP:u.is3D?this._gl.TEXTURE_3D:u.is2DArray||u.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(u,x,s=!1){const U=this._getTextureTarget(x),_=this._getSamplingParameters(u,x.useMipMaps||s);this._setTextureParameterInteger(U,this._gl.TEXTURE_MAG_FILTER,_.mag,x),this._setTextureParameterInteger(U,this._gl.TEXTURE_MIN_FILTER,_.min),s&&(x.generateMipMaps=!0,this._gl.generateMipmap(U)),this._bindTextureDirectly(U,null),x.samplingMode=u}updateTextureDimensions(u,x,s,U=1){}updateTextureWrappingMode(u,x,s=null,U=null){const _=this._getTextureTarget(u);null!==x&&(this._setTextureParameterInteger(_,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(x),u),u._cachedWrapU=x),null!==s&&(this._setTextureParameterInteger(_,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(s),u),u._cachedWrapV=s),(u.is2DArray||u.is3D)&&null!==U&&(this._setTextureParameterInteger(_,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(U),u),u._cachedWrapR=U),this._bindTextureDirectly(_,null)}_uploadCompressedDataToTextureDirectly(u,x,s,U,_,W=0,c=0){const I=this._gl;let L=I.TEXTURE_2D;if(u.isCube&&(L=I.TEXTURE_CUBE_MAP_POSITIVE_X+W),u._useSRGBBuffer)switch(x){case 37492:case 36196:this._caps.etc2?x=I.COMPRESSED_SRGB8_ETC2:u._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?x=I.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u._useSRGBBuffer=!1;break;case 36492:x=I.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:x=I.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?x=I.COMPRESSED_SRGB_S3TC_DXT1_EXT:u._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?x=I.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:u._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?x=I.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:u._useSRGBBuffer=!1;break;default:u._useSRGBBuffer=!1}this._gl.compressedTexImage2D(L,c,x,s,U,0,_)}_uploadDataToTextureDirectly(u,x,s=0,U=0,_,W=!1){const c=this._gl,I=this._getWebGLTextureType(u.type),L=this._getInternalFormat(u.format),J=void 0===_?this._getRGBABufferInternalSizedFormat(u.type,u.format,u._useSRGBBuffer):this._getInternalFormat(_,u._useSRGBBuffer);this._unpackFlipY(u.invertY);let k=c.TEXTURE_2D;u.isCube&&(k=c.TEXTURE_CUBE_MAP_POSITIVE_X+s);const i=Math.round(Math.log(u.width)*Math.LOG2E),d=Math.round(Math.log(u.height)*Math.LOG2E),j=W?u.width:Math.pow(2,Math.max(i-U,0)),r=W?u.height:Math.pow(2,Math.max(d-U,0));c.texImage2D(k,U,J,j,r,0,L,I,x)}updateTextureData(u,x,s,U,_,W,c=0,I=0,L=!1){const J=this._gl,k=this._getWebGLTextureType(u.type),i=this._getInternalFormat(u.format);this._unpackFlipY(u.invertY);let d=J.TEXTURE_2D,j=J.TEXTURE_2D;u.isCube&&(j=J.TEXTURE_CUBE_MAP_POSITIVE_X+c,d=J.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d,u,!0),J.texSubImage2D(j,I,s,U,_,W,i,k,x),L&&this._gl.generateMipmap(j),this._bindTextureDirectly(d,null)}_uploadArrayBufferViewToTexture(u,x,s=0,U=0){const _=this._gl,W=u.isCube?_.TEXTURE_CUBE_MAP:_.TEXTURE_2D;this._bindTextureDirectly(W,u,!0),this._uploadDataToTextureDirectly(u,x,s,U),this._bindTextureDirectly(W,null,!0)}_prepareWebGLTextureContinuation(u,x,s,U,_){const W=this._gl;if(!W)return;const c=this._getSamplingParameters(_,!s);W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,c.mag),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,c.min),s||U||W.generateMipmap(W.TEXTURE_2D),this._bindTextureDirectly(W.TEXTURE_2D,null),x&&x.removePendingData(u),u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear()}_prepareWebGLTexture(u,x,s,U,_,W,c,I,L,J){const i=this.getCaps().maxTextureSize,d=Math.min(i,this.needPOTTextures?k.R(U.width,i):U.width),j=Math.min(i,this.needPOTTextures?k.R(U.height,i):U.height),r=this._gl;r&&(u._hardwareTexture?(this._bindTextureDirectly(r.TEXTURE_2D,u,!0),this._unpackFlipY(void 0===_||!!_),u.baseWidth=U.width,u.baseHeight=U.height,u.width=d,u.height=j,u.isReady=!0,u.type=-1!==u.type?u.type:0,u.format=-1!==u.format?u.format:null!=J?J:".jpg"!==x||u._useSRGBBuffer?5:4,I(d,j,U,x,u,(()=>{this._prepareWebGLTextureContinuation(u,s,W,c,L)}))||this._prepareWebGLTextureContinuation(u,s,W,c,L)):s&&s.removePendingData(u))}_getInternalFormatFromDepthTextureFormat(u,x,s){const U=this._gl;if(!x)return U.STENCIL_INDEX8;let _=s?U.DEPTH_STENCIL:U.DEPTH_COMPONENT;return this.webGLVersion>1?15===u?_=U.DEPTH_COMPONENT16:16===u?_=U.DEPTH_COMPONENT24:17===u||13===u?_=s?U.DEPTH24_STENCIL8:U.DEPTH_COMPONENT24:14===u?_=U.DEPTH_COMPONENT32F:18===u&&(_=s?U.DEPTH32F_STENCIL8:U.DEPTH_COMPONENT32F):_=U.DEPTH_COMPONENT16,_}_setupFramebufferDepthAttachments(u,x,s,U,_=1,W){const c=this._gl;W=null!=W?W:u?13:14;const I=this._getInternalFormatFromDepthTextureFormat(W,x,u);return u&&x?this._createRenderBuffer(s,U,_,c.DEPTH_STENCIL,I,c.DEPTH_STENCIL_ATTACHMENT):x?this._createRenderBuffer(s,U,_,I,I,c.DEPTH_ATTACHMENT):u?this._createRenderBuffer(s,U,_,I,I,c.STENCIL_ATTACHMENT):null}_createRenderBuffer(u,x,s,U,_,W,c=!0){const I=this._gl.createRenderbuffer();return this._updateRenderBuffer(I,u,x,s,U,_,W,c)}_updateRenderBuffer(u,x,s,U,_,W,c,I=!0){const L=this._gl;return L.bindRenderbuffer(L.RENDERBUFFER,u),U>1&&L.renderbufferStorageMultisample?L.renderbufferStorageMultisample(L.RENDERBUFFER,U,W,x,s):L.renderbufferStorage(L.RENDERBUFFER,_,x,s),L.framebufferRenderbuffer(L.FRAMEBUFFER,c,L.RENDERBUFFER,u),I&&L.bindRenderbuffer(L.RENDERBUFFER,null),u}_releaseTexture(u){this._deleteTexture(u._hardwareTexture),this.unbindAllTextures();const x=this._internalTexturesCache.indexOf(u);-1!==x&&this._internalTexturesCache.splice(x,1),u._lodTextureHigh&&u._lodTextureHigh.dispose(),u._lodTextureMid&&u._lodTextureMid.dispose(),u._lodTextureLow&&u._lodTextureLow.dispose(),u._irradianceTexture&&u._irradianceTexture.dispose()}_deleteTexture(u){null==u||u.release()}_setProgram(u){this._currentProgram!==u&&(U.C5(u,this._gl),this._currentProgram=u)}bindSamplers(u){const x=u.getPipelineContext();this._setProgram(x.program);const s=u.getSamplers();for(let x=0;x<s.length;x++){const U=u.getUniform(s[x]);U&&(this._boundUniforms[x]=U)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(u,x,s=!1,U=!1){var _,c;let I=!1;const L=x&&x._associatedChannel>-1;if(s&&L&&(this._activeChannel=x._associatedChannel),this._boundTexturesCache[this._activeChannel]!==x||U){if(this._activateCurrentTexture(),x&&x.isMultiview)throw W.V.Error(["_bindTextureDirectly called with a multiview texture!",u,x]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(u,null!==(c=null===(_=null==x?void 0:x._hardwareTexture)||void 0===_?void 0:_.underlyingResource)&&void 0!==c?c:null),this._boundTexturesCache[this._activeChannel]=x,x&&(x._associatedChannel=this._activeChannel)}else s&&(I=!0,this._activateCurrentTexture());return L&&!s&&this._bindSamplerUniformToChannel(x._associatedChannel,this._activeChannel),I}_bindTexture(u,x,s){if(void 0===u)return;x&&(x._associatedChannel=u),this._activeChannel=u;const U=x?this._getTextureTarget(x):this._gl.TEXTURE_2D;this._bindTextureDirectly(U,x)}unbindAllTextures(){for(let u=0;u<this._maxSimultaneousTextures;u++)this._activeChannel=u,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(u,x,s,U){void 0!==u&&(x&&(this._boundUniforms[u]=x),this._setTexture(u,s))}_bindSamplerUniformToChannel(u,x){const s=this._boundUniforms[u];s&&s._currentState!==x&&(this._gl.uniform1i(s,x),s._currentState=x)}_getTextureWrapMode(u){switch(u){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(u,x,s=!1,U=!1,_=""){if(!x)return null!=this._boundTexturesCache[u]&&(this._activeChannel=u,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(x.video){this._activeChannel=u;const s=x.getInternalTexture();s&&(s._associatedChannel=u),x.update()}else if(4===x.delayLoadState)return x.delayLoad(),!1;let W;W=U?x.depthStencilTexture:x.isReady()?x.getInternalTexture():x.isCube?this.emptyCubeTexture:x.is3D?this.emptyTexture3D:x.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!s&&W&&(W._associatedChannel=u);let c=!0;this._boundTexturesCache[u]===W&&(s||this._bindSamplerUniformToChannel(W._associatedChannel,u),c=!1),this._activeChannel=u;const I=this._getTextureTarget(W);if(c&&this._bindTextureDirectly(I,W,s),W&&!W.isMultiview){if(W.isCube&&W._cachedCoordinatesMode!==x.coordinatesMode){W._cachedCoordinatesMode=x.coordinatesMode;const u=3!==x.coordinatesMode&&5!==x.coordinatesMode?1:0;x.wrapU=u,x.wrapV=u}W._cachedWrapU!==x.wrapU&&(W._cachedWrapU=x.wrapU,this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(x.wrapU),W)),W._cachedWrapV!==x.wrapV&&(W._cachedWrapV=x.wrapV,this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(x.wrapV),W)),W.is3D&&W._cachedWrapR!==x.wrapR&&(W._cachedWrapR=x.wrapR,this._setTextureParameterInteger(I,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(x.wrapR),W)),this._setAnisotropicLevel(I,W,x.anisotropicFilteringLevel)}return!0}setTextureArray(u,x,s,U){if(void 0!==u&&x){this._textureUnits&&this._textureUnits.length===s.length||(this._textureUnits=new Int32Array(s.length));for(let x=0;x<s.length;x++){const U=s[x].getInternalTexture();U?(this._textureUnits[x]=u+x,U._associatedChannel=u+x):this._textureUnits[x]=-1}this._gl.uniform1iv(x,this._textureUnits);for(let u=0;u<s.length;u++)this._setTexture(this._textureUnits[u],s[u],!0)}}_setAnisotropicLevel(u,x,s){const U=this._caps.textureAnisotropicFilterExtension;11!==x.samplingMode&&3!==x.samplingMode&&2!==x.samplingMode&&(s=1),U&&x._cachedAnisotropicFilteringLevel!==s&&(this._setTextureParameterFloat(u,U.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s,this._caps.maxAnisotropy),x),x._cachedAnisotropicFilteringLevel=s)}_setTextureParameterFloat(u,x,s,U){this._bindTextureDirectly(u,U,!0,!0),this._gl.texParameterf(u,x,s)}_setTextureParameterInteger(u,x,s,U){U&&this._bindTextureDirectly(u,U,!0,!0),this._gl.texParameteri(u,x,s)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let u=0;u<this._caps.maxVertexAttribs;u++)this.disableAttributeByIndex(u)}else for(let u=0,x=this._vertexAttribArraysEnabled.length;u<x;u++)u>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[u]||this.disableAttributeByIndex(u)}releaseEffects(){const u=Object.keys(this._compiledEffects);for(const x of u)this._compiledEffects[x].dispose();this._compiledEffects={}}dispose(){var u;c.BA()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&(null===(u=this._gl.getExtension("WEBGL_lose_context"))||void 0===u||u.loseContext()),U.Cm(this._gl)}attachContextLostEvent(u){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",u,!1)}attachContextRestoredEvent(u){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",u,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(u){const x=this._gl;for(;x.getError()!==x.NO_ERROR;);let s=!0;const U=x.createTexture();x.bindTexture(x.TEXTURE_2D,U),x.texImage2D(x.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(u),1,1,0,x.RGBA,this._getWebGLTextureType(u),null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST);const _=x.createFramebuffer();x.bindFramebuffer(x.FRAMEBUFFER,_),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,U,0);const W=x.checkFramebufferStatus(x.FRAMEBUFFER);if(s=s&&W===x.FRAMEBUFFER_COMPLETE,s=s&&x.getError()===x.NO_ERROR,s&&(x.clear(x.COLOR_BUFFER_BIT),s=s&&x.getError()===x.NO_ERROR),s){x.bindFramebuffer(x.FRAMEBUFFER,null);const u=x.RGBA,U=x.UNSIGNED_BYTE,_=new Uint8Array(4);x.readPixels(0,0,1,1,u,U,_),s=s&&x.getError()===x.NO_ERROR}for(x.deleteTexture(U),x.deleteFramebuffer(_),x.bindFramebuffer(x.FRAMEBUFFER,null);!s&&x.getError()!==x.NO_ERROR;);return s}_getWebGLTextureType(u){if(1===this._webGLVersion){switch(u){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(u){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(u,x=!1){let s=x?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(u){case 0:s=this._gl.ALPHA;break;case 1:s=this._gl.LUMINANCE;break;case 2:s=this._gl.LUMINANCE_ALPHA;break;case 6:s=this._gl.RED;break;case 7:s=this._gl.RG;break;case 4:s=x?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:s=x?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(u){case 8:s=this._gl.RED_INTEGER;break;case 9:s=this._gl.RG_INTEGER;break;case 10:s=this._gl.RGB_INTEGER;break;case 11:s=this._gl.RGBA_INTEGER}return s}_getRGBABufferInternalSizedFormat(u,x,s=!1){if(1===this._webGLVersion){if(void 0!==x)switch(x){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return s?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(u){case 3:switch(x){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(x){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return s?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(x){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(x){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(x){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(x){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(x){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(x){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(x){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(u,x,s,U,_=!0,W=!0){const c=_?4:3,I=_?this._gl.RGBA:this._gl.RGB,L=new Uint8Array(U*s*c);return W&&this.flushFramebuffer(),this._gl.readPixels(u,x,s,U,I,this._gl.UNSIGNED_BYTE,L),Promise.resolve(L)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const u=i.$._CreateCanvas(1,1),x=u.getContext("webgl")||u.getContext("experimental-webgl");this._IsSupported=null!=x&&!!window.WebGLRenderingContext}catch(u){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const u=i.$._CreateCanvas(1,1),x=u.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||u.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!x}catch(u){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}f._TempClearColorUint32=new Uint32Array(4),f._TempClearColorInt32=new Int32Array(4),f.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],f._ConcatenateShader=D.iL,f._IsSupported=null,f._HasMajorPerformanceCaveat=null},332108:(u,x,s)=>{var U;s.d(x,{b:()=>U,s:()=>_}),function(u){u[u["PointerMove"]=0]="PointerMove",u[u["PointerDown"]=1]="PointerDown",u[u["PointerUp"]=2]="PointerUp"}(U||(U={}));class _{}_.DOM_DELTA_PIXEL=0,_.DOM_DELTA_LINE=1,_.DOM_DELTA_PAGE=2},834255:(u,x,s)=>{s.d(x,{Bu:()=>W,TB:()=>U,W0:()=>_});class U{}U.KEYDOWN=1,U.KEYUP=2;class _{constructor(u,x){this.type=u,this.event=x}}class W extends _{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(u){this.skipOnKeyboardObservable=u}constructor(u,x){super(u,x),this.type=u,this.event=x,this.skipOnKeyboardObservable=!1}}},706211:(u,x,s)=>{s.d(x,{Vn:()=>W,Zp:()=>_,mx:()=>I,tT:()=>c});var U=s(604910);class _{}_.POINTERDOWN=1,_.POINTERUP=2,_.POINTERMOVE=4,_.POINTERWHEEL=8,_.POINTERPICK=16,_.POINTERTAP=32,_.POINTERDOUBLETAP=64;class W{constructor(u,x){this.type=u,this.event=x}}class c extends W{constructor(u,x,s,_){super(u,x),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new U.I9(s,_)}}class I extends W{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(u,x,s,U=null){super(u,x),this._pickInfo=s,this._inputManager=U}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},214413:(u,x,s)=>{s.d(x,{c:()=>$});var U=s(604910),_=s(888413),W=s(554014),c=s(675100),I=s(59036),L=s(472295),J=s(706400),k=s(395726);const i=U.Pq.Up(),d=U.Pq.Zero(),j=new U.Pq,r=new U.Pq,D=new U.uq;class $ extends c.o{_validateFilter(u){return u===c.o.FILTER_NONE||u===c.o.FILTER_PCF||u===c.o.FILTER_PCSS?u:(J.V.Error('Unsupported filter "'+u+'"!'),c.o.FILTER_NONE)}get numCascades(){return this._numCascades}set numCascades(u){(u=Math.min(Math.max(u,$.MIN_CASCADES_COUNT),$.MAX_CASCADES_COUNT))!==this._numCascades&&(this._numCascades=u,this.recreateShadowMap(),this._recreateSceneUBOs())}get freezeShadowCastersBoundingInfo(){return this._freezeShadowCastersBoundingInfo}set freezeShadowCastersBoundingInfo(u){this._freezeShadowCastersBoundingInfoObservable&&u&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._freezeShadowCastersBoundingInfoObservable||u||(this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add((()=>this._computeShadowCastersBoundingInfo()))),this._freezeShadowCastersBoundingInfo=u,u&&this._computeShadowCastersBoundingInfo()}_computeShadowCastersBoundingInfo(){if(this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._scbiMax.copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._shadowMap&&this._shadowMap.renderList){const u=this._shadowMap.renderList;for(let x=0;x<u.length;x++){const s=u[x];if(!s)continue;const U=s.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(U.minimumWorld),this._scbiMax.maximizeInPlace(U.maximumWorld)}const x=this._scene.meshes;for(let u=0;u<x.length;u++){const s=x[u];if(!(s&&s.isVisible&&s.isEnabled&&s.receiveShadows))continue;const U=s.getBoundingInfo().boundingBox;this._scbiMin.minimizeInPlace(U.minimumWorld),this._scbiMax.maximizeInPlace(U.maximumWorld)}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax)}get shadowCastersBoundingInfo(){return this._shadowCastersBoundingInfo}set shadowCastersBoundingInfo(u){this._shadowCastersBoundingInfo=u}setMinMaxDistance(u,x){this._minDistance===u&&this._maxDistance===x||(u>x&&(u=0,x=1),u<0&&(u=0),x>1&&(x=1),this._minDistance=u,this._maxDistance=x,this._breaksAreDirty=!0)}get minDistance(){return this._minDistance}get maxDistance(){return this._maxDistance}getClassName(){return $.CLASSNAME}getCascadeMinExtents(u){return u>=0&&u<this._numCascades?this._cascadeMinExtents[u]:null}getCascadeMaxExtents(u){return u>=0&&u<this._numCascades?this._cascadeMaxExtents[u]:null}get shadowMaxZ(){return this._getCamera()?this._shadowMaxZ:0}set shadowMaxZ(u){const x=this._getCamera();x?this._shadowMaxZ===u||u<x.minZ||u>x.maxZ&&0!==x.maxZ||(this._shadowMaxZ=u,this._light._markMeshesAsLightDirty(),this._breaksAreDirty=!0):this._shadowMaxZ=u}get debug(){return this._debug}set debug(u){this._debug=u,this._light._markMeshesAsLightDirty()}get depthClamp(){return this._depthClamp}set depthClamp(u){this._depthClamp=u}get cascadeBlendPercentage(){return this._cascadeBlendPercentage}set cascadeBlendPercentage(u){this._cascadeBlendPercentage=u,this._light._markMeshesAsLightDirty()}get lambda(){return this._lambda}set lambda(u){const x=Math.min(Math.max(u,0),1);this._lambda!=x&&(this._lambda=x,this._breaksAreDirty=!0)}getCascadeViewMatrix(u){return u>=0&&u<this._numCascades?this._viewMatrices[u]:null}getCascadeProjectionMatrix(u){return u>=0&&u<this._numCascades?this._projectionMatrices[u]:null}getCascadeTransformMatrix(u){return u>=0&&u<this._numCascades?this._transformMatrices[u]:null}setDepthRenderer(u){this._depthRenderer=u,this._depthReducer&&this._depthReducer.setDepthRenderer(this._depthRenderer)}get autoCalcDepthBounds(){return this._autoCalcDepthBounds}set autoCalcDepthBounds(u){const x=this._getCamera();if(x){if(this._autoCalcDepthBounds=u,!u)return this._depthReducer&&this._depthReducer.deactivate(),void this.setMinMaxDistance(0,1);this._depthReducer||(this._depthReducer=new L.k(x),this._depthReducer.onAfterReductionPerformed.add((u=>{let x=u.min,s=u.max;x>=s&&(x=0,s=1),x==this._minDistance&&s==this._maxDistance||this.setMinMaxDistance(x,s)})),this._depthReducer.setDepthRenderer(this._depthRenderer)),this._depthReducer.activate()}}get autoCalcDepthBoundsRefreshRate(){var u,x,s;return null!==(s=null===(x=null===(u=this._depthReducer)||void 0===u?void 0:u.depthRenderer)||void 0===x?void 0:x.getDepthMap().refreshRate)&&void 0!==s?s:-1}set autoCalcDepthBoundsRefreshRate(u){var x;(null===(x=this._depthReducer)||void 0===x?void 0:x.depthRenderer)&&(this._depthReducer.depthRenderer.getDepthMap().refreshRate=u)}splitFrustum(){this._breaksAreDirty=!0}_splitFrustum(){const u=this._getCamera();if(!u)return;const x=u.minZ,s=u.maxZ||this._shadowMaxZ,U=s-x,_=this._minDistance,W=x+_*U,c=x+(this._shadowMaxZ<s&&this._shadowMaxZ>=x?Math.min((this._shadowMaxZ-x)/(s-x),this._maxDistance):this._maxDistance)*U,I=c-W,L=c/W;for(let u=0;u<this._cascades.length;++u){const s=(u+1)/this._numCascades,c=W*L**s,J=W+I*s,k=this._lambda*(c-J)+J;this._cascades[u].prevBreakDistance=0===u?_:this._cascades[u-1].breakDistance,this._cascades[u].breakDistance=(k-x)/U,this._viewSpaceFrustumsZ[u]=k,this._frustumLengths[u]=(this._cascades[u].breakDistance-this._cascades[u].prevBreakDistance)*U}this._breaksAreDirty=!1}_computeMatrices(){const u=this._scene;if(!this._getCamera())return;U.Pq.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection),1===Math.abs(U.Pq.Dot(this._lightDirection,U.Pq.Up()))&&(this._lightDirection.z=1e-13),this._cachedDirection.copyFrom(this._lightDirection);const x=u.getEngine().useReverseDepthBuffer;for(let s=0;s<this._numCascades;++s){this._computeFrustumInWorldSpace(s),this._computeCascadeFrustum(s),this._cascadeMaxExtents[s].subtractToRef(this._cascadeMinExtents[s],j),this._frustumCenter[s].addToRef(this._lightDirection.scale(this._cascadeMinExtents[s].z),this._shadowCameraPos[s]),U.uq.LookAtLHToRef(this._shadowCameraPos[s],this._frustumCenter[s],i,this._viewMatrices[s]);let _=0,W=j.z;const I=this._shadowCastersBoundingInfo;I.update(this._viewMatrices[s]),W=Math.min(W,I.boundingBox.maximumWorld.z),_=this._depthClamp&&this.filter!==c.o.FILTER_PCSS?Math.max(_,I.boundingBox.minimumWorld.z):Math.min(_,I.boundingBox.minimumWorld.z),U.uq.OrthoOffCenterLHToRef(this._cascadeMinExtents[s].x,this._cascadeMaxExtents[s].x,this._cascadeMinExtents[s].y,this._cascadeMaxExtents[s].y,x?W:_,x?_:W,this._projectionMatrices[s],u.getEngine().isNDCHalfZRange),this._cascadeMinExtents[s].z=_,this._cascadeMaxExtents[s].z=W,this._viewMatrices[s].multiplyToRef(this._projectionMatrices[s],this._transformMatrices[s]),U.Pq.TransformCoordinatesToRef(d,this._transformMatrices[s],j),j.scaleInPlace(this._mapSize/2),r.copyFromFloats(Math.round(j.x),Math.round(j.y),Math.round(j.z)),r.subtractInPlace(j).scaleInPlace(2/this._mapSize),U.uq.TranslationToRef(r.x,r.y,0,D),this._projectionMatrices[s].multiplyToRef(D,this._projectionMatrices[s]),this._viewMatrices[s].multiplyToRef(this._projectionMatrices[s],this._transformMatrices[s]),this._transformMatrices[s].copyToArray(this._transformMatricesAsArray,16*s)}}_computeFrustumInWorldSpace(u){const x=this._getCamera();if(!x)return;const s=this._cascades[u].prevBreakDistance,_=this._cascades[u].breakDistance,W=this._scene.getEngine().isNDCHalfZRange;x.getViewMatrix();const c=0===x.maxZ,I=x.maxZ;c&&(x.maxZ=this._shadowMaxZ,x.getProjectionMatrix(!0));const L=U.uq.Invert(x.getTransformationMatrix());c&&(x.maxZ=I,x.getProjectionMatrix(!0));const J=this._scene.getEngine().useReverseDepthBuffer?4:0;for(let x=0;x<$._FrustumCornersNDCSpace.length;++x)j.copyFrom($._FrustumCornersNDCSpace[(x+J)%$._FrustumCornersNDCSpace.length]),W&&-1===j.z&&(j.z=0),U.Pq.TransformCoordinatesToRef(j,L,this._frustumCornersWorldSpace[u][x]);for(let x=0;x<$._FrustumCornersNDCSpace.length/2;++x)j.copyFrom(this._frustumCornersWorldSpace[u][x+4]).subtractInPlace(this._frustumCornersWorldSpace[u][x]),r.copyFrom(j).scaleInPlace(s),j.scaleInPlace(_),j.addInPlace(this._frustumCornersWorldSpace[u][x]),this._frustumCornersWorldSpace[u][x+4].copyFrom(j),this._frustumCornersWorldSpace[u][x].addInPlace(r)}_computeCascadeFrustum(u){if(this._cascadeMinExtents[u].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cascadeMaxExtents[u].copyFromFloats(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._frustumCenter[u].copyFromFloats(0,0,0),this._getCamera()){for(let x=0;x<this._frustumCornersWorldSpace[u].length;++x)this._frustumCenter[u].addInPlace(this._frustumCornersWorldSpace[u][x]);if(this._frustumCenter[u].scaleInPlace(1/this._frustumCornersWorldSpace[u].length),this.stabilizeCascades){let x=0;for(let s=0;s<this._frustumCornersWorldSpace[u].length;++s){const U=this._frustumCornersWorldSpace[u][s].subtractToRef(this._frustumCenter[u],j).length();x=Math.max(x,U)}x=Math.ceil(16*x)/16,this._cascadeMaxExtents[u].copyFromFloats(x,x,x),this._cascadeMinExtents[u].copyFromFloats(-x,-x,-x)}else{const x=this._frustumCenter[u];this._frustumCenter[u].addToRef(this._lightDirection,j),U.uq.LookAtLHToRef(x,j,i,D);for(let x=0;x<this._frustumCornersWorldSpace[u].length;++x)U.Pq.TransformCoordinatesToRef(this._frustumCornersWorldSpace[u][x],D,j),this._cascadeMinExtents[u].minimizeInPlace(j),this._cascadeMaxExtents[u].maximizeInPlace(j)}}}_recreateSceneUBOs(){if(this._disposeSceneUBOs(),this._sceneUBOs)for(let u=0;u<this._numCascades;++u)this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for CSM Shadow Generator (light "${this._light.name}" cascade #${u})`))}static get IsSupported(){const u=k.q.LastCreatedEngine;return!!u&&u._features.supportCSM}constructor(u,x,s,U,_=!0){$.IsSupported?(super(u,x,s,U,_),this.usePercentageCloserFiltering=!0):J.V.Error("CascadedShadowMap is not supported by the current engine.")}_initializeGenerator(){var u,x,s,_,W,c,L,J,k,i,d,j,r,D,H,f,O,t,V,N;this.penumbraDarkness=null!==(u=this.penumbraDarkness)&&void 0!==u?u:1,this._numCascades=null!==(x=this._numCascades)&&void 0!==x?x:$.DEFAULT_CASCADES_COUNT,this.stabilizeCascades=null!==(s=this.stabilizeCascades)&&void 0!==s&&s,this._freezeShadowCastersBoundingInfoObservable=null!==(_=this._freezeShadowCastersBoundingInfoObservable)&&void 0!==_?_:null,this.freezeShadowCastersBoundingInfo=null!==(W=this.freezeShadowCastersBoundingInfo)&&void 0!==W&&W,this._scbiMin=null!==(c=this._scbiMin)&&void 0!==c?c:new U.Pq(0,0,0),this._scbiMax=null!==(L=this._scbiMax)&&void 0!==L?L:new U.Pq(0,0,0),this._shadowCastersBoundingInfo=null!==(J=this._shadowCastersBoundingInfo)&&void 0!==J?J:new I.j(new U.Pq(0,0,0),new U.Pq(0,0,0)),this._breaksAreDirty=null===(k=this._breaksAreDirty)||void 0===k||k,this._minDistance=null!==(i=this._minDistance)&&void 0!==i?i:0,this._maxDistance=null!==(d=this._maxDistance)&&void 0!==d?d:1,this._currentLayer=null!==(j=this._currentLayer)&&void 0!==j?j:0,this._shadowMaxZ=null!==(H=null!==(r=this._shadowMaxZ)&&void 0!==r?r:null===(D=this._getCamera())||void 0===D?void 0:D.maxZ)&&void 0!==H?H:1e4,this._debug=null!==(f=this._debug)&&void 0!==f&&f,this._depthClamp=null===(O=this._depthClamp)||void 0===O||O,this._cascadeBlendPercentage=null!==(t=this._cascadeBlendPercentage)&&void 0!==t?t:.1,this._lambda=null!==(V=this._lambda)&&void 0!==V?V:.5,this._autoCalcDepthBounds=null!==(N=this._autoCalcDepthBounds)&&void 0!==N&&N,this._recreateSceneUBOs(),super._initializeGenerator()}_createTargetRenderTexture(){const u=this._scene.getEngine(),x={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new _.$(this._light.name+"_CSMShadowMap",x,this._scene,!1,!0,this._textureType,!1,void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(u.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForCSMShadowGenerator-${this._light.name}`),this._shadowMap.noPrePassRenderer=!0}_initializeShadowMap(){if(super._initializeShadowMap(),null===this._shadowMap)return;this._transformMatricesAsArray=new Float32Array(16*this._numCascades),this._viewSpaceFrustumsZ=new Array(this._numCascades),this._frustumLengths=new Array(this._numCascades),this._lightSizeUVCorrection=new Array(2*this._numCascades),this._depthCorrection=new Array(this._numCascades),this._cascades=[],this._viewMatrices=[],this._projectionMatrices=[],this._transformMatrices=[],this._cascadeMinExtents=[],this._cascadeMaxExtents=[],this._frustumCenter=[],this._shadowCameraPos=[],this._frustumCornersWorldSpace=[];for(let u=0;u<this._numCascades;++u){this._cascades[u]={prevBreakDistance:0,breakDistance:0},this._viewMatrices[u]=U.uq.Zero(),this._projectionMatrices[u]=U.uq.Zero(),this._transformMatrices[u]=U.uq.Zero(),this._cascadeMinExtents[u]=new U.Pq,this._cascadeMaxExtents[u]=new U.Pq,this._frustumCenter[u]=new U.Pq,this._shadowCameraPos[u]=new U.Pq,this._frustumCornersWorldSpace[u]=new Array($._FrustumCornersNDCSpace.length);for(let x=0;x<$._FrustumCornersNDCSpace.length;++x)this._frustumCornersWorldSpace[u][x]=new U.Pq}const u=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear(),this._shadowMap.onBeforeRenderObservable.clear(),this._shadowMap.onBeforeRenderObservable.add((x=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[x]),this._currentLayer=x,this._filter===c.o.FILTER_PCF&&u.setColorWrite(!1),this._scene.setTransformMatrix(this.getCascadeViewMatrix(x),this.getCascadeProjectionMatrix(x)),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onBeforeBindObservable.add((()=>{var x;this._currentSceneUBO=this._scene.getSceneUniformBuffer(),null===(x=u._debugPushGroup)||void 0===x||x.call(u,`cascaded shadow map generation for pass id ${u.currentRenderPassId}`,1),this._breaksAreDirty&&this._splitFrustum(),this._computeMatrices()})),this._splitFrustum()}_bindCustomEffectForRenderSubMeshForShadowMap(u,x){x.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer))}_isReadyCustomDefines(u){u.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==c.o.FILTER_PCSS?"1":"0"))}prepareDefines(u,x){super.prepareDefines(u,x);const s=this._scene,U=this._light;if(!s.shadowsEnabled||!U.shadowEnabled)return;u["SHADOWCSM"+x]=!0,u["SHADOWCSMDEBUG"+x]=this.debug,u["SHADOWCSMNUM_CASCADES"+x]=this.numCascades,u["SHADOWCSM_RIGHTHANDED"+x]=s.useRightHandedSystem;const _=this._getCamera();_&&this._shadowMaxZ<=(_.maxZ||this._shadowMaxZ)&&(u["SHADOWCSMUSESHADOWMAXZ"+x]=!0),0===this.cascadeBlendPercentage&&(u["SHADOWCSMNOBLEND"+x]=!0)}bindShadowLight(u,x){const s=this._light;if(!this._scene.shadowsEnabled||!s.shadowEnabled)return;const U=this._getCamera();if(!U)return;const _=this.getShadowMap();if(!_)return;const W=_.getSize().width;if(x.setMatrices("lightMatrix"+u,this._transformMatricesAsArray),x.setArray("viewFrustumZ"+u,this._viewSpaceFrustumsZ),x.setFloat("cascadeBlendFactor"+u,0===this.cascadeBlendPercentage?1e4:1/this.cascadeBlendPercentage),x.setArray("frustumLengths"+u,this._frustumLengths),this._filter===c.o.FILTER_PCF)x.setDepthStencilTexture("shadowTexture"+u,_),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),W,1/W,this.frustumEdgeFalloff,u);else if(this._filter===c.o.FILTER_PCSS){for(let u=0;u<this._numCascades;++u)this._lightSizeUVCorrection[2*u+0]=0===u?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[u].x-this._cascadeMinExtents[u].x),this._lightSizeUVCorrection[2*u+1]=0===u?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[u].y-this._cascadeMinExtents[u].y),this._depthCorrection[u]=0===u?1:(this._cascadeMaxExtents[u].z-this._cascadeMinExtents[u].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);x.setDepthStencilTexture("shadowTexture"+u,_),x.setTexture("depthTexture"+u,_),x.setArray2("lightSizeUVCorrection"+u,this._lightSizeUVCorrection),x.setArray("depthCorrection"+u,this._depthCorrection),x.setFloat("penumbraDarkness"+u,this.penumbraDarkness),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/W,this._contactHardeningLightSizeUVRatio*W,this.frustumEdgeFalloff,u)}else x.setTexture("shadowTexture"+u,_),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),W,1/W,this.frustumEdgeFalloff,u);s._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(U),this.getLight().getDepthMinZ(U)+this.getLight().getDepthMaxZ(U),u)}getTransformMatrix(){return this.getCascadeTransformMatrix(0)}dispose(){super.dispose(),this._freezeShadowCastersBoundingInfoObservable&&(this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable),this._freezeShadowCastersBoundingInfoObservable=null),this._depthReducer&&(this._depthReducer.dispose(),this._depthReducer=null)}serialize(){const u=super.serialize(),x=this.getShadowMap();if(!x)return u;if(u.numCascades=this._numCascades,u.debug=this._debug,u.stabilizeCascades=this.stabilizeCascades,u.lambda=this._lambda,u.cascadeBlendPercentage=this.cascadeBlendPercentage,u.depthClamp=this._depthClamp,u.autoCalcDepthBounds=this.autoCalcDepthBounds,u.shadowMaxZ=this._shadowMaxZ,u.penumbraDarkness=this.penumbraDarkness,u.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo,u.minDistance=this.minDistance,u.maxDistance=this.maxDistance,u.renderList=[],x.renderList)for(let s=0;s<x.renderList.length;s++){const U=x.renderList[s];u.renderList.push(U.id)}return u}static Parse(u,x){const s=c.o.Parse(u,x,((u,x,s)=>new $(u,x,void 0,s)));return void 0!==u.numCascades&&(s.numCascades=u.numCascades),void 0!==u.debug&&(s.debug=u.debug),void 0!==u.stabilizeCascades&&(s.stabilizeCascades=u.stabilizeCascades),void 0!==u.lambda&&(s.lambda=u.lambda),void 0!==u.cascadeBlendPercentage&&(s.cascadeBlendPercentage=u.cascadeBlendPercentage),void 0!==u.depthClamp&&(s.depthClamp=u.depthClamp),void 0!==u.autoCalcDepthBounds&&(s.autoCalcDepthBounds=u.autoCalcDepthBounds),void 0!==u.shadowMaxZ&&(s.shadowMaxZ=u.shadowMaxZ),void 0!==u.penumbraDarkness&&(s.penumbraDarkness=u.penumbraDarkness),void 0!==u.freezeShadowCastersBoundingInfo&&(s.freezeShadowCastersBoundingInfo=u.freezeShadowCastersBoundingInfo),void 0!==u.minDistance&&void 0!==u.maxDistance&&s.setMinMaxDistance(u.minDistance,u.maxDistance),s}}$._FrustumCornersNDCSpace=[new U.Pq(-1,+1,-1),new U.Pq(+1,+1,-1),new U.Pq(+1,-1,-1),new U.Pq(-1,-1,-1),new U.Pq(-1,+1,+1),new U.Pq(+1,+1,+1),new U.Pq(+1,-1,+1),new U.Pq(-1,-1,+1)],$.CLASSNAME="CascadedShadowGenerator",$.DEFAULT_CASCADES_COUNT=4,$.MIN_CASCADES_COUNT=2,$.MAX_CASCADES_COUNT=4,$._SceneComponentInitialization=u=>{throw W.n("ShadowGeneratorSceneComponent")}},675100:(u,x,s)=>{s.d(x,{o:()=>f});var U=s(604910),_=s(332290),W=s(23987),c=s(349487),I=s(432050),L=s(888413),J=s(850034),k=s(958413),i=s(638113),d=s(554014),j=s(522208),r=s(809319),D=s(964061),$=s(651577),H=s(855300);class f{get bias(){return this._bias}set bias(u){this._bias=u}get normalBias(){return this._normalBias}set normalBias(u){this._normalBias=u}get blurBoxOffset(){return this._blurBoxOffset}set blurBoxOffset(u){this._blurBoxOffset!==u&&(this._blurBoxOffset=u,this._disposeBlurPostProcesses())}get blurScale(){return this._blurScale}set blurScale(u){this._blurScale!==u&&(this._blurScale=u,this._disposeBlurPostProcesses())}get blurKernel(){return this._blurKernel}set blurKernel(u){this._blurKernel!==u&&(this._blurKernel=u,this._disposeBlurPostProcesses())}get useKernelBlur(){return this._useKernelBlur}set useKernelBlur(u){this._useKernelBlur!==u&&(this._useKernelBlur=u,this._disposeBlurPostProcesses())}get depthScale(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()}set depthScale(u){this._depthScale=u}_validateFilter(u){return u}get filter(){return this._filter}set filter(u){if(u=this._validateFilter(u),this._light.needCube()){if(u===f.FILTER_BLUREXPONENTIALSHADOWMAP)return void(this.useExponentialShadowMap=!0);if(u===f.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)return void(this.useCloseExponentialShadowMap=!0);if(u===f.FILTER_PCF||u===f.FILTER_PCSS)return void(this.usePoissonSampling=!0)}u!==f.FILTER_PCF&&u!==f.FILTER_PCSS||this._scene.getEngine()._features.supportShadowSamplers?this._filter!==u&&(this._filter=u,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty()):this.usePoissonSampling=!0}get usePoissonSampling(){return this.filter===f.FILTER_POISSONSAMPLING}set usePoissonSampling(u){const x=this._validateFilter(f.FILTER_POISSONSAMPLING);(u||this.filter===f.FILTER_POISSONSAMPLING)&&(this.filter=u?x:f.FILTER_NONE)}get useExponentialShadowMap(){return this.filter===f.FILTER_EXPONENTIALSHADOWMAP}set useExponentialShadowMap(u){const x=this._validateFilter(f.FILTER_EXPONENTIALSHADOWMAP);(u||this.filter===f.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=u?x:f.FILTER_NONE)}get useBlurExponentialShadowMap(){return this.filter===f.FILTER_BLUREXPONENTIALSHADOWMAP}set useBlurExponentialShadowMap(u){const x=this._validateFilter(f.FILTER_BLUREXPONENTIALSHADOWMAP);(u||this.filter===f.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=u?x:f.FILTER_NONE)}get useCloseExponentialShadowMap(){return this.filter===f.FILTER_CLOSEEXPONENTIALSHADOWMAP}set useCloseExponentialShadowMap(u){const x=this._validateFilter(f.FILTER_CLOSEEXPONENTIALSHADOWMAP);(u||this.filter===f.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=u?x:f.FILTER_NONE)}get useBlurCloseExponentialShadowMap(){return this.filter===f.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP}set useBlurCloseExponentialShadowMap(u){const x=this._validateFilter(f.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);(u||this.filter===f.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=u?x:f.FILTER_NONE)}get usePercentageCloserFiltering(){return this.filter===f.FILTER_PCF}set usePercentageCloserFiltering(u){const x=this._validateFilter(f.FILTER_PCF);(u||this.filter===f.FILTER_PCF)&&(this.filter=u?x:f.FILTER_NONE)}get filteringQuality(){return this._filteringQuality}set filteringQuality(u){this._filteringQuality!==u&&(this._filteringQuality=u,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())}get useContactHardeningShadow(){return this.filter===f.FILTER_PCSS}set useContactHardeningShadow(u){const x=this._validateFilter(f.FILTER_PCSS);(u||this.filter===f.FILTER_PCSS)&&(this.filter=u?x:f.FILTER_NONE)}get contactHardeningLightSizeUVRatio(){return this._contactHardeningLightSizeUVRatio}set contactHardeningLightSizeUVRatio(u){this._contactHardeningLightSizeUVRatio=u}get darkness(){return this._darkness}set darkness(u){this.setDarkness(u)}getDarkness(){return this._darkness}setDarkness(u){return this._darkness=u>=1?1:u<=0?0:u,this}get transparencyShadow(){return this._transparencyShadow}set transparencyShadow(u){this.setTransparencyShadow(u)}setTransparencyShadow(u){return this._transparencyShadow=u,this}getShadowMap(){return this._shadowMap}getShadowMapForRendering(){return this._shadowMap2?this._shadowMap2:this._shadowMap}getClassName(){return f.CLASSNAME}addShadowCaster(u,x=!0){if(!this._shadowMap)return this;if(this._shadowMap.renderList||(this._shadowMap.renderList=[]),-1===this._shadowMap.renderList.indexOf(u)&&this._shadowMap.renderList.push(u),x)for(const x of u.getChildMeshes())-1===this._shadowMap.renderList.indexOf(x)&&this._shadowMap.renderList.push(x);return this}removeShadowCaster(u,x=!0){if(!this._shadowMap||!this._shadowMap.renderList)return this;const s=this._shadowMap.renderList.indexOf(u);if(-1!==s&&this._shadowMap.renderList.splice(s,1),x)for(const x of u.getChildren())this.removeShadowCaster(x);return this}getLight(){return this._light}get shaderLanguage(){return this._shaderLanguage}_getCamera(){var u;return null!==(u=this._camera)&&void 0!==u?u:this._scene.activeCamera}get mapSize(){return this._mapSize}set mapSize(u){this._mapSize=u,this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}constructor(u,x,s,_,W,c=!1){this.onBeforeShadowMapRenderObservable=new i.cP,this.onAfterShadowMapRenderObservable=new i.cP,this.onBeforeShadowMapRenderMeshObservable=new i.cP,this.onAfterShadowMapRenderMeshObservable=new i.cP,this._bias=5e-5,this._normalBias=0,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=f.FILTER_NONE,this._filteringQuality=f.QUALITY_HIGH,this._contactHardeningLightSizeUVRatio=.1,this._darkness=0,this._transparencyShadow=!1,this.enableSoftTransparentShadow=!1,this.useOpacityTextureForTransparentShadow=!1,this.frustumEdgeFalloff=0,this._shaderLanguage=0,this.forceBackFacesOnly=!1,this._lightDirection=U.Pq.Zero(),this._viewMatrix=U.uq.Zero(),this._projectionMatrix=U.uq.Zero(),this._transformMatrix=U.uq.Zero(),this._cachedPosition=new U.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cachedDirection=new U.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=U.uq.Identity(),this._shadersLoaded=!1,this._mapSize=u,this._light=x,this._scene=x.getScene(),this._camera=null!=_?_:null,this._useRedTextureType=!!W,this._initShaderSourceAsync(c);let I=x._shadowGenerators;I||(I=x._shadowGenerators=new Map),I.set(this._camera,this),this.id=x.id,this._useUBO=this._scene.getEngine().supportsUniformBuffers,this._useUBO&&(this._sceneUBOs=[],this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene for Shadow Generator (light "${this._light.name}")`))),f._SceneComponentInitialization(this._scene);const L=this._scene.getEngine().getCaps();s?L.textureFloatRender&&L.textureFloatLinearFiltering?this._textureType=1:L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering?this._textureType=2:this._textureType=0:L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering?this._textureType=2:L.textureFloatRender&&L.textureFloatLinearFiltering?this._textureType=1:this._textureType=0,this._initializeGenerator(),this._applyFilterValues()}_initializeGenerator(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()}_createTargetRenderTexture(){const u=this._scene.getEngine();u._features.supportDepthStencilTexture?(this._shadowMap=new L.$(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube(),void 0,!1,!1,void 0,this._useRedTextureType?6:5),this._shadowMap.createDepthStencilTexture(u.useReverseDepthBuffer?516:513,!0,void 0,void 0,void 0,`DepthStencilForShadowGenerator-${this._light.name}`)):this._shadowMap=new L.$(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.noPrePassRenderer=!0}_initializeShadowMap(){if(this._createTargetRenderTexture(),null===this._shadowMap)return;this._shadowMap.wrapU=I.g.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=I.g.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(I.g.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._storedUniqueId&&(this._shadowMap.uniqueId=this._storedUniqueId),this._shadowMap.customRenderFunction=(u,x,s,U)=>this._renderForShadowMap(u,x,s,U),this._shadowMap.customIsReadyFunction=()=>!0;const u=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add((()=>{var x;this._currentSceneUBO=this._scene.getSceneUniformBuffer(),null===(x=u._debugPushGroup)||void 0===x||x.call(u,`shadow map generation for pass id ${u.currentRenderPassId}`,1)})),this._shadowMap.onBeforeRenderObservable.add((x=>{this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._sceneUBOs[0]),this._currentFaceIndex=x,this._filter===f.FILTER_PCF&&u.setColorWrite(!1),this.getTransformMatrix(),this._scene.setTransformMatrix(this._viewMatrix,this._projectionMatrix),this._useUBO&&(this._scene.getSceneUniformBuffer().unbindEffect(),this._scene.finalizeSceneUbo())})),this._shadowMap.onAfterUnbindObservable.add((()=>{var x,s;if(this._sceneUBOs&&this._scene.setSceneUniformBuffer(this._currentSceneUBO),this._scene.updateTransformMatrix(),this._filter===f.FILTER_PCF&&u.setColorWrite(!0),!this.useBlurExponentialShadowMap&&!this.useBlurCloseExponentialShadowMap)return void(null===(x=u._debugPopGroup)||void 0===x||x.call(u,1));const U=this.getShadowMapForRendering();U&&(this._scene.postProcessManager.directRender(this._blurPostProcesses,U.renderTarget,!0),u.unBindFramebuffer(U.renderTarget,!0),null===(s=u._debugPopGroup)||void 0===s||s.call(u,1))}));const x=new _.ov(0,0,0,0),s=new _.ov(1,1,1,1);this._shadowMap.onClearObservable.add((u=>{this._filter===f.FILTER_PCF?u.clear(s,!1,!0,!1):this.useExponentialShadowMap||this.useBlurExponentialShadowMap?u.clear(x,!0,!0,!1):u.clear(s,!0,!0,!1)})),this._shadowMap.onResizeObservable.add((u=>{this._storedUniqueId=this._shadowMap.uniqueId,this._mapSize=u.getRenderSize(),this._light._markMeshesAsLightDirty(),this.recreateShadowMap()}));for(let u=r.m.MIN_RENDERINGGROUPS;u<r.m.MAX_RENDERINGGROUPS;u++)this._shadowMap.setRenderingAutoClearDepthStencil(u,!1)}async _initShaderSourceAsync(u=!1){!this._scene.getEngine().isWebGPU||u||f.ForceGLSL?await Promise.all([s.e(7075).then(s.bind(s,507075)),s.e(12235).then(s.bind(s,412235)),s.e(58047).then(s.bind(s,958047)),s.e(71635).then(s.bind(s,271635))]):(this._shaderLanguage=1,await Promise.all([s.e(5310).then(s.bind(s,105310)),s.e(51871).then(s.bind(s,151871)),s.e(44830).then(s.bind(s,144830)),s.e(92838).then(s.bind(s,792838))])),this._shadersLoaded=!0}_initializeBlurRTTAndPostProcesses(){const u=this._scene.getEngine(),x=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new L.$(this._light.name+"_shadowMap2",x,this._scene,!1,!0,this._textureType,void 0,void 0,!1),this._shadowMap2.wrapU=I.g.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=I.g.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(I.g.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new k.j(this._light.name+"KernelBlurX",new U.I9(1,0),this.blurKernel,1,null,I.g.BILINEAR_SAMPLINGMODE,u,!1,this._textureType),this._kernelBlurXPostprocess.width=x,this._kernelBlurXPostprocess.height=x,this._kernelBlurXPostprocess.externalTextureSamplerBinding=!0,this._kernelBlurXPostprocess.onApplyObservable.add((u=>{u.setTexture("textureSampler",this._shadowMap)})),this._kernelBlurYPostprocess=new k.j(this._light.name+"KernelBlurY",new U.I9(0,1),this.blurKernel,1,null,I.g.BILINEAR_SAMPLINGMODE,u,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,0===this._textureType&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new J.w(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,I.g.BILINEAR_SAMPLINGMODE,u,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType,void 0,void 0,void 0,void 0,this._shaderLanguage),this._boxBlurPostprocess.externalTextureSamplerBinding=!0,this._boxBlurPostprocess.onApplyObservable.add((u=>{u.setFloat2("screenSize",x,x),u.setTexture("textureSampler",this._shadowMap)})),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])}_renderForShadowMap(u,x,s,U){let _;if(U.length)for(_=0;_<U.length;_++)this._renderSubMeshForShadowMap(U.data[_]);for(_=0;_<u.length;_++)this._renderSubMeshForShadowMap(u.data[_]);for(_=0;_<x.length;_++)this._renderSubMeshForShadowMap(x.data[_]);if(this._transparencyShadow)for(_=0;_<s.length;_++)this._renderSubMeshForShadowMap(s.data[_],!0);else for(_=0;_<s.length;_++)s.data[_].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}_bindCustomEffectForRenderSubMeshForShadowMap(u,x,s){x.setMatrix("viewProjection",this.getTransformMatrix())}_renderSubMeshForShadowMap(u,x=!1){var s,U;const _=u.getRenderingMesh(),W=u.getEffectiveMesh(),I=this._scene,L=I.getEngine(),J=u.getMaterial();if(W._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!J||0===u.verticesCount||u._renderId===I.getRenderId())return;const k=I.useRightHandedSystem,i=W._getWorldMatrixDeterminant()<0;let d=J._getEffectiveOrientation(_);(i&&!k||!i&&k)&&(d=0===d?1:0);const j=0===d;L.setState(J.backFaceCulling,void 0,void 0,j,J.cullBackFaces);const r=_._getInstancesRenderList(u._id,!!u.getReplacementMesh());if(r.mustReturn)return;const f=L.getCaps().instancedArrays&&(null!==r.visibleInstances[u._id]&&void 0!==r.visibleInstances[u._id]||_.hasThinInstances);if(!this.customAllowRendering||this.customAllowRendering(u))if(this.isReady(u,f,x)){u._renderId=I.getRenderId();const k=J.shadowDepthWrapper,i=null!==(s=null==k?void 0:k.getEffect(u,this,L.currentRenderPassId))&&void 0!==s?s:u._getDrawWrapper(),d=D.E.GetEffect(i);L.enableEffect(i),f||_._bind(u,d,J.fillMode),this.getTransformMatrix(),d.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale),this.getLight().getTypeID()===c.v.LIGHTTYPEID_DIRECTIONALLIGHT?d.setVector3("lightDataSM",this._cachedDirection):d.setVector3("lightDataSM",this._cachedPosition);const j=this._getCamera();if(j&&d.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(j),this.getLight().getDepthMinZ(j)+this.getLight().getDepthMaxZ(j)),x&&this.enableSoftTransparentShadow&&d.setFloat2("softTransparentShadowSM",W.visibility*J.alpha,(null===(U=this._opacityTexture)||void 0===U?void 0:U.getAlphaFromRGB)?1:0),k)u._setMainDrawWrapperOverride(i),k.standalone?k.baseMaterial.bindForSubMesh(W.getWorldMatrix(),_,u):J.bindForSubMesh(W.getWorldMatrix(),_,u),u._setMainDrawWrapperOverride(null);else{if(this._opacityTexture&&(d.setTexture("diffuseSampler",this._opacityTexture),d.setMatrix("diffuseMatrix",this._opacityTexture.getTextureMatrix()||this._defaultTextureMatrix)),_.useBones&&_.computeBonesUsingShaders&&_.skeleton){const u=_.skeleton;if(u.isUsingTextureForMatrices){const x=u.getTransformMatrixTexture(_);if(!x)return;d.setTexture("boneSampler",x),d.setFloat("boneTextureWidth",4*(u.bones.length+1))}else d.setMatrices("mBones",u.getTransformMatrices(_))}H.nR(_,d),_.morphTargetManager&&_.morphTargetManager.isUsingTextureForTargets&&_.morphTargetManager._bind(d);const x=u.getMesh().bakedVertexAnimationManager;x&&x.isEnabled&&x.bind(d,f),$.gS(d,J,I)}this._useUBO||k||this._bindCustomEffectForRenderSubMeshForShadowMap(u,d,W),H._8(d,this._scene.getSceneUniformBuffer()),this._scene.getSceneUniformBuffer().bindUniformBuffer();const O=W.getWorldMatrix();f&&(W.getMeshUniformBuffer().bindToEffect(d,"Mesh"),W.transferToEffect(O)),this.forceBackFacesOnly&&L.setState(!0,0,!1,!0,J.cullBackFaces),this.onBeforeShadowMapRenderMeshObservable.notifyObservers(_),this.onBeforeShadowMapRenderObservable.notifyObservers(d),_._processRendering(W,u,d,J.fillMode,r,f,((u,x)=>{W===_||u?(W.getMeshUniformBuffer().bindToEffect(d,"Mesh"),W.transferToEffect(u?x:O)):(_.getMeshUniformBuffer().bindToEffect(d,"Mesh"),_.transferToEffect(x))})),this.forceBackFacesOnly&&L.setState(!0,0,!1,!1,J.cullBackFaces),this.onAfterShadowMapRenderObservable.notifyObservers(d),this.onAfterShadowMapRenderMeshObservable.notifyObservers(_)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}_applyFilterValues(){this._shadowMap&&(this.filter===f.FILTER_NONE||this.filter===f.FILTER_PCSS?this._shadowMap.updateSamplingMode(I.g.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(I.g.BILINEAR_SAMPLINGMODE))}forceCompilation(u,x){const s={useInstances:!1,...x},U=this.getShadowMap();if(!U)return void(u&&u(this));const _=U.renderList;if(!_)return void(u&&u(this));const W=[];for(const u of _)W.push(...u.subMeshes);if(0===W.length)return void(u&&u(this));let c=0;const I=()=>{var x,U;if(this._scene&&this._scene.getEngine()){for(;this.isReady(W[c],s.useInstances,null!==(U=null===(x=W[c].getMaterial())||void 0===x?void 0:x.needAlphaBlendingForMesh(W[c].getMesh()))&&void 0!==U&&U);)if(c++,c>=W.length)return void(u&&u(this));setTimeout(I,16)}};I()}forceCompilationAsync(u){return new Promise((x=>{this.forceCompilation((()=>{x()}),u)}))}_isReadyCustomDefines(u,x,s){}_prepareShadowDefines(u,x,s,U){s.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase()),s.push("#define SM_FLOAT "+(0!==this._textureType?"1":"0")),s.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0")),s.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));const _=u.getMesh();return s.push("#define SM_NORMALBIAS "+(this.normalBias&&_.isVerticesDataPresent(W.R.NormalKind)?"1":"0")),s.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===c.v.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0")),s.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0")),s.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&U?"1":"0")),this._isReadyCustomDefines(s,u,x),s}isReady(u,x,s){var U;if(!this._shadersLoaded)return!1;const _=u.getMaterial(),c=null==_?void 0:_.shadowDepthWrapper;if(this._opacityTexture=null,!_)return!1;const I=[];if(this._prepareShadowDefines(u,x,I,s),c){if(!c.isReadyForSubMesh(u,I,this,x,this._scene.getEngine().currentRenderPassId))return!1}else{const s=u._getDrawWrapper(void 0,!0);let c=s.effect,L=s.defines;const J=[W.R.PositionKind],k=u.getMesh();this.normalBias&&k.isVerticesDataPresent(W.R.NormalKind)&&(J.push(W.R.NormalKind),I.push("#define NORMAL"),k.nonUniformScaling&&I.push("#define NONUNIFORMSCALING"));const i=_.needAlphaTesting();if((i||_.needAlphaBlending())&&(this.useOpacityTextureForTransparentShadow?this._opacityTexture=_.opacityTexture:this._opacityTexture=_.getAlphaTestTexture(),this._opacityTexture)){if(!this._opacityTexture.isReady())return!1;const u=null!==(U=_.alphaCutOff)&&void 0!==U?U:f.DEFAULT_ALPHA_CUTOFF;I.push("#define ALPHATEXTURE"),i&&I.push(`#define ALPHATESTVALUE ${u}${u%1==0?".":""}`),k.isVerticesDataPresent(W.R.UVKind)&&(J.push(W.R.UVKind),I.push("#define UV1")),k.isVerticesDataPresent(W.R.UV2Kind)&&1===this._opacityTexture.coordinatesIndex&&(J.push(W.R.UV2Kind),I.push("#define UV2"))}const d=new j.J;if(k.useBones&&k.computeBonesUsingShaders&&k.skeleton){J.push(W.R.MatricesIndicesKind),J.push(W.R.MatricesWeightsKind),k.numBoneInfluencers>4&&(J.push(W.R.MatricesIndicesExtraKind),J.push(W.R.MatricesWeightsExtraKind));const u=k.skeleton;I.push("#define NUM_BONE_INFLUENCERS "+k.numBoneInfluencers),k.numBoneInfluencers>0&&d.addCPUSkinningFallback(0,k),u.isUsingTextureForMatrices?I.push("#define BONETEXTURE"):I.push("#define BonesPerMesh "+(u.bones.length+1))}else I.push("#define NUM_BONE_INFLUENCERS 0");const r=k.morphTargetManager;let D=0;if(r&&(D=r.numMaxInfluencers||r.numInfluencers,D>0&&(I.push("#define MORPHTARGETS"),I.push("#define NUM_MORPH_INFLUENCERS "+D),r.isUsingTextureForTargets&&I.push("#define MORPHTARGETS_TEXTURE"),H.MF(J,k,D))),$.tv(_,this._scene,I),x&&(I.push("#define INSTANCES"),H.te(J),u.getRenderingMesh().hasThinInstances&&I.push("#define THIN_INSTANCES")),this.customShaderOptions&&this.customShaderOptions.defines)for(const u of this.customShaderOptions.defines)-1===I.indexOf(u)&&I.push(u);const O=k.bakedVertexAnimationManager;O&&O.isEnabled&&(I.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),x&&J.push("bakedVertexAnimationSettingsInstanced"));const t=I.join("\n");if(L!==t){L=t;let u="shadowMap";const x=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","morphTargetCount","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],U=["diffuseSampler","boneSampler","morphTargets","bakedVertexAnimationTexture"],_=["Scene","Mesh"];if($.TV(x),this.customShaderOptions){if(u=this.customShaderOptions.shaderName,this.customShaderOptions.attributes)for(const u of this.customShaderOptions.attributes)-1===J.indexOf(u)&&J.push(u);if(this.customShaderOptions.uniforms)for(const u of this.customShaderOptions.uniforms)-1===x.indexOf(u)&&x.push(u);if(this.customShaderOptions.samplers)for(const u of this.customShaderOptions.samplers)-1===U.indexOf(u)&&U.push(u)}const W=this._scene.getEngine();c=W.createEffect(u,{attributes:J,uniformsNames:x,uniformBuffersNames:_,samplers:U,defines:t,fallbacks:d,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:D},shaderLanguage:this._shaderLanguage},W),s.setEffect(c,L)}if(!c.isReady())return!1}return(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(this._blurPostProcesses&&this._blurPostProcesses.length||this._initializeBlurRTTAndPostProcesses()),!(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady()||this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()||this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady())}prepareDefines(u,x){const s=this._scene,U=this._light;s.shadowsEnabled&&U.shadowEnabled&&(u["SHADOW"+x]=!0,this.useContactHardeningShadow?(u["SHADOWPCSS"+x]=!0,this._filteringQuality===f.QUALITY_LOW?u["SHADOWLOWQUALITY"+x]=!0:this._filteringQuality===f.QUALITY_MEDIUM&&(u["SHADOWMEDIUMQUALITY"+x]=!0)):this.usePercentageCloserFiltering?(u["SHADOWPCF"+x]=!0,this._filteringQuality===f.QUALITY_LOW?u["SHADOWLOWQUALITY"+x]=!0:this._filteringQuality===f.QUALITY_MEDIUM&&(u["SHADOWMEDIUMQUALITY"+x]=!0)):this.usePoissonSampling?u["SHADOWPOISSON"+x]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?u["SHADOWESM"+x]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(u["SHADOWCLOSEESM"+x]=!0),U.needCube()&&(u["SHADOWCUBE"+x]=!0))}bindShadowLight(u,x){const s=this._light;if(!this._scene.shadowsEnabled||!s.shadowEnabled)return;const U=this._getCamera();if(!U)return;const _=this.getShadowMap();if(!_)return;s.needCube()||x.setMatrix("lightMatrix"+u,this.getTransformMatrix());const W=this.getShadowMapForRendering();this._filter===f.FILTER_PCF?(x.setDepthStencilTexture("shadowTexture"+u,W),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),_.getSize().width,1/_.getSize().width,this.frustumEdgeFalloff,u)):this._filter===f.FILTER_PCSS?(x.setDepthStencilTexture("shadowTexture"+u,W),x.setTexture("depthTexture"+u,W),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/_.getSize().width,this._contactHardeningLightSizeUVRatio*_.getSize().width,this.frustumEdgeFalloff,u)):(x.setTexture("shadowTexture"+u,W),s._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/_.getSize().width,this.depthScale,this.frustumEdgeFalloff,u)),s._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(U),this.getLight().getDepthMinZ(U)+this.getLight().getDepthMaxZ(U),u)}get viewMatrix(){return this._viewMatrix}get projectionMatrix(){return this._projectionMatrix}getTransformMatrix(){const u=this._scene;if(this._currentRenderId===u.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderId=u.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;let x=this._light.position;if(this._light.computeTransformedInformation()&&(x=this._light.transformedPosition),U.Pq.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(U.Pq.Dot(this._lightDirection,U.Pq.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!x.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(x),this._cachedDirection.copyFrom(this._lightDirection),U.uq.LookAtLHToRef(x,x.add(this._lightDirection),U.Pq.Up(),this._viewMatrix);const u=this.getShadowMap();if(u){const x=u.renderList;x&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,x)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix}recreateShadowMap(){const u=this._shadowMap;if(!u)return;const x=u.renderList;if(this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this._filter,this._applyFilterValues(),x){this._shadowMap.renderList||(this._shadowMap.renderList=[]);for(const u of x)this._shadowMap.renderList.push(u)}else this._shadowMap.renderList=null}_disposeBlurPostProcesses(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]}_disposeRTTandPostProcesses(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()}_disposeSceneUBOs(){if(this._sceneUBOs){for(const u of this._sceneUBOs)u.dispose();this._sceneUBOs=[]}}dispose(){if(this._disposeRTTandPostProcesses(),this._disposeSceneUBOs(),this._light){if(this._light._shadowGenerators){const u=this._light._shadowGenerators.entries();for(let x=u.next();!0!==x.done;x=u.next()){const[u,s]=x.value;s===this&&this._light._shadowGenerators.delete(u)}0===this._light._shadowGenerators.size&&(this._light._shadowGenerators=null)}this._light._markMeshesAsLightDirty()}this.onBeforeShadowMapRenderMeshObservable.clear(),this.onBeforeShadowMapRenderObservable.clear(),this.onAfterShadowMapRenderMeshObservable.clear(),this.onAfterShadowMapRenderObservable.clear()}serialize(){var u;const x={},s=this.getShadowMap();if(!s)return x;if(x.className=this.getClassName(),x.lightId=this._light.id,x.cameraId=null===(u=this._camera)||void 0===u?void 0:u.id,x.id=this.id,x.mapSize=s.getRenderSize(),x.forceBackFacesOnly=this.forceBackFacesOnly,x.darkness=this.getDarkness(),x.transparencyShadow=this._transparencyShadow,x.frustumEdgeFalloff=this.frustumEdgeFalloff,x.bias=this.bias,x.normalBias=this.normalBias,x.usePercentageCloserFiltering=this.usePercentageCloserFiltering,x.useContactHardeningShadow=this.useContactHardeningShadow,x.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio,x.filteringQuality=this.filteringQuality,x.useExponentialShadowMap=this.useExponentialShadowMap,x.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,x.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,x.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,x.usePoissonSampling=this.usePoissonSampling,x.depthScale=this.depthScale,x.blurBoxOffset=this.blurBoxOffset,x.blurKernel=this.blurKernel,x.blurScale=this.blurScale,x.useKernelBlur=this.useKernelBlur,x.renderList=[],s.renderList)for(let u=0;u<s.renderList.length;u++){const U=s.renderList[u];x.renderList.push(U.id)}return x}static Parse(u,x,s){const U=x.getLightById(u.lightId),_=void 0!==u.cameraId?x.getCameraById(u.cameraId):null,W=s?s(u.mapSize,U,_):new f(u.mapSize,U,void 0,_),c=W.getShadowMap();for(let s=0;s<u.renderList.length;s++)x.getMeshesById(u.renderList[s]).forEach((function(u){c&&(c.renderList||(c.renderList=[]),c.renderList.push(u))}));return void 0!==u.id&&(W.id=u.id),W.forceBackFacesOnly=!!u.forceBackFacesOnly,void 0!==u.darkness&&W.setDarkness(u.darkness),u.transparencyShadow&&W.setTransparencyShadow(!0),void 0!==u.frustumEdgeFalloff&&(W.frustumEdgeFalloff=u.frustumEdgeFalloff),void 0!==u.bias&&(W.bias=u.bias),void 0!==u.normalBias&&(W.normalBias=u.normalBias),u.usePercentageCloserFiltering?W.usePercentageCloserFiltering=!0:u.useContactHardeningShadow?W.useContactHardeningShadow=!0:u.usePoissonSampling?W.usePoissonSampling=!0:u.useExponentialShadowMap?W.useExponentialShadowMap=!0:u.useBlurExponentialShadowMap?W.useBlurExponentialShadowMap=!0:u.useCloseExponentialShadowMap?W.useCloseExponentialShadowMap=!0:u.useBlurCloseExponentialShadowMap?W.useBlurCloseExponentialShadowMap=!0:u.useVarianceShadowMap?W.useExponentialShadowMap=!0:u.useBlurVarianceShadowMap&&(W.useBlurExponentialShadowMap=!0),void 0!==u.contactHardeningLightSizeUVRatio&&(W.contactHardeningLightSizeUVRatio=u.contactHardeningLightSizeUVRatio),void 0!==u.filteringQuality&&(W.filteringQuality=u.filteringQuality),u.depthScale&&(W.depthScale=u.depthScale),u.blurScale&&(W.blurScale=u.blurScale),u.blurBoxOffset&&(W.blurBoxOffset=u.blurBoxOffset),u.useKernelBlur&&(W.useKernelBlur=u.useKernelBlur),u.blurKernel&&(W.blurKernel=u.blurKernel),W}}f.CLASSNAME="ShadowGenerator",f.ForceGLSL=!1,f.FILTER_NONE=0,f.FILTER_EXPONENTIALSHADOWMAP=1,f.FILTER_POISSONSAMPLING=2,f.FILTER_BLUREXPONENTIALSHADOWMAP=3,f.FILTER_CLOSEEXPONENTIALSHADOWMAP=4,f.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,f.FILTER_PCF=6,f.FILTER_PCSS=7,f.QUALITY_HIGH=0,f.QUALITY_MEDIUM=1,f.QUALITY_LOW=2,f.DEFAULT_ALPHA_CUTOFF=.5,f._SceneComponentInitialization=u=>{throw d.n("ShadowGeneratorSceneComponent")}},625735:(u,x,s)=>{s.d(x,{x:()=>c});var U=s(675100),_=s(214413),W=s(122030);s(837475).d.AddParser(W.v.NAME_SHADOWGENERATOR,((u,x)=>{if(void 0!==u.shadowGenerators&&null!==u.shadowGenerators)for(let s=0,W=u.shadowGenerators.length;s<W;s++){const W=u.shadowGenerators[s];W.className===_.c.CLASSNAME?_.c.Parse(W,x):U.o.Parse(W,x)}}));class c{constructor(u){this.name=W.v.NAME_SHADOWGENERATOR,this.scene=u}register(){this.scene._gatherRenderTargetsStage.registerStep(W.v.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets)}rebuild(){}serialize(u){u.shadowGenerators=[];const x=this.scene.lights;for(const s of x){const x=s.getShadowGenerators();if(x){const s=x.values();for(let x=s.next();!0!==x.done;x=s.next()){const s=x.value;u.shadowGenerators.push(s.serialize())}}}}addFromContainer(u){}removeFromContainer(u,x){}dispose(){}_gatherRenderTargets(u){const x=this.scene;if(this.scene.shadowsEnabled)for(let s=0;s<x.lights.length;s++){const U=x.lights[s],_=U.getShadowGenerators();if(U.isEnabled()&&U.shadowEnabled&&_){const s=_.values();for(let U=s.next();!0!==U.done;U=s.next()){const s=U.value.getShadowMap();-1!==x.textures.indexOf(s)&&u.push(s)}}}}}U.o._SceneComponentInitialization=u=>{let x=u._getComponent(W.v.NAME_SHADOWGENERATOR);x||(x=new c(u),u._addComponent(x))}},497224:(u,x,s)=>{s.d(x,{g:()=>k});var U=s(297809),_=s(760998),W=s(604910),c=s(332290),I=s(869581),L=s(349487),J=s(310035);I.b.AddNodeConstructor("Light_Type_3",((u,x)=>()=>new k(u,W.Pq.Zero(),x)));class k extends L.v{constructor(u,x,s){super(u,s),this.groundColor=new c.v9(0,0,0),this.direction=x||W.Pq.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"HemisphericLight"}setDirectionToTarget(u){return this.direction=W.Pq.Normalize(u.subtract(W.Pq.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(u,x){const s=W.Pq.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",s.x,s.y,s.z,0,x),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),x),this}transferToNodeMaterialEffect(u,x){const s=W.Pq.Normalize(this.direction);return u.setFloat3(x,s.x,s.y,s.z),this}computeWorldMatrix(){return this._worldMatrix||(this._worldMatrix=W.uq.Identity()),this._worldMatrix}getTypeID(){return L.v.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(u,x){u["HEMILIGHT"+x]=!0}}U.Cg([_.jT()],k.prototype,"groundColor",void 0),U.Cg([_.P_()],k.prototype,"direction",void 0),J.Y5("BABYLON.HemisphericLight",k)},349487:(u,x,s)=>{s.d(x,{v:()=>d});var U=s(297809),_=s(760998),W=s(604910),c=s(332290),I=s(869581),L=s(384898),J=s(310035),k=s(875830),i=s(337776);class d extends I.b{get range(){return this._range}set range(u){this._range=u,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(u){this._intensityMode=u,this._computePhotometricScale()}get radius(){return this._radius}set radius(u){this._radius=u,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(u){this._shadowEnabled!==u&&(this._shadowEnabled=u,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(u){this._includedOnlyMeshes=u,this._hookArrayForIncludedOnly(u)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(u){this._excludedMeshes=u,this._hookArrayForExcluded(u)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(u){this._excludeWithLayerMask=u,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(u){this._includeOnlyWithLayerMask=u,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(u){this._lightmapMode!==u&&(this._lightmapMode=u,this._markMeshesAsLightDirty())}getViewMatrix(u){return null}getProjectionMatrix(u,x){return null}constructor(u,x){super(u,x,!1),this.diffuse=new c.v9(1,1,1),this.specular=new c.v9(1,1,1),this.falloffType=d.FALLOFF_DEFAULT,this.intensity=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=d.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.getScene().addLight(this),this._uniformBuffer=new L.D(this.getScene().getEngine(),void 0,void 0,u),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(u,x){return this}_bindLight(u,x,s,U,_=!0){var W;const I=u.toString();let L=!1;if(this._uniformBuffer.bindToEffect(s,"Light"+I),this._renderId!==x.getRenderId()||this._lastUseSpecular!==U||!this._uniformBuffer.useUbo){this._renderId=x.getRenderId(),this._lastUseSpecular=U;const u=this.getScaledIntensity();this.transferToEffect(s,I),this.diffuse.scaleToRef(u,c.IG.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",c.IG.Color3[0],this.range,I),U&&(this.specular.scaleToRef(u,c.IG.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",c.IG.Color3[1],this.radius,I)),L=!0}if(this.transferTexturesToEffect(s,I),x.shadowsEnabled&&this.shadowEnabled&&_){const u=null!==(W=this.getShadowGenerator(x.activeCamera))&&void 0!==W?W:this.getShadowGenerator();u&&(u.bindShadowLight(I,s),L=!0)}L?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(u){let x="Name: "+this.name;if(x+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let s=0;s<this.animations.length;s++)x+=", animation[0]: "+this.animations[s].toString(u);return x}_syncParentEnabledState(){super._syncParentEnabledState(),this.isDisposed()||this._resyncMeshes()}setEnabled(u){super.setEnabled(u),this._resyncMeshes()}getShadowGenerator(u=null){var x;return null===this._shadowGenerators?null:null!==(x=this._shadowGenerators.get(u))&&void 0!==x?x:null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return W.Pq.Zero()}canAffectMesh(u){return!(u&&(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(u)||this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(u)||!(0===this.includeOnlyWithLayerMask||this.includeOnlyWithLayerMask&u.layerMask)||0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&u.layerMask))}dispose(u,x=!1){if(this._shadowGenerators){const u=this._shadowGenerators.values();for(let x=u.next();!0!==x.done;x=u.next())x.value.dispose();this._shadowGenerators=null}if(this.getScene().stopAnimation(this),this._parentContainer){const u=this._parentContainer.lights.indexOf(this);u>-1&&this._parentContainer.lights.splice(u,1),this._parentContainer=null}for(const u of this.getScene().meshes)u._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.getScene().removeLight(this),super.dispose(u,x)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.intensity}clone(u,x=null){const s=d.GetConstructorFromName(this.getTypeID(),u,this.getScene());if(!s)return null;const U=i.p.Clone(s,this);return u&&(U.name=u),x&&(U.parent=x),U.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(U),U}serialize(){const u=i.p.Serialize(this);return u.uniqueId=this.uniqueId,u.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(u),this.excludedMeshes.length>0&&(u.excludedMeshesIds=[],this.excludedMeshes.forEach((x=>{u.excludedMeshesIds.push(x.id)}))),this.includedOnlyMeshes.length>0&&(u.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((x=>{u.includedOnlyMeshesIds.push(x.id)}))),i.p.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.isEnabled=this.isEnabled(),u}static GetConstructorFromName(u,x,s){return I.b.Construct("Light_Type_"+u,x,s)||null}static Parse(u,x){const s=d.GetConstructorFromName(u.type,u.name,x);if(!s)return null;const U=i.p.Parse(s,u,x);if(u.excludedMeshesIds&&(U._excludedMeshesIds=u.excludedMeshesIds),u.includedOnlyMeshesIds&&(U._includedOnlyMeshesIds=u.includedOnlyMeshesIds),void 0!==u.parentId&&(U._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(U._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.falloffType&&(U.falloffType=u.falloffType),void 0!==u.lightmapMode&&(U.lightmapMode=u.lightmapMode),u.animations){for(let x=0;x<u.animations.length;x++){const s=u.animations[x],_=J.n9("BABYLON.Animation");_&&U.animations.push(_.Parse(s))}I.b.ParseAnimationRanges(U,u,x)}return u.autoAnimate&&x.beginAnimation(U,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),void 0!==u.isEnabled&&U.setEnabled(u.isEnabled),U}_hookArrayForExcluded(u){const x=u.push;u.push=(...s)=>{const U=x.apply(u,s);for(const u of s)u._resyncLightSource(this);return U};const s=u.splice;u.splice=(x,U)=>{const _=s.apply(u,[x,U]);for(const u of _)u._resyncLightSource(this);return _};for(const x of u)x._resyncLightSource(this)}_hookArrayForIncludedOnly(u){const x=u.push;u.push=(...s)=>{const U=x.apply(u,s);return this._resyncMeshes(),U};const s=u.splice;u.splice=(x,U)=>{const _=s.apply(u,[x,U]);return this._resyncMeshes(),_},this._resyncMeshes()}_resyncMeshes(){for(const u of this.getScene().meshes)u._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const u of this.getScene().meshes)-1!==u.lightSources.indexOf(this)&&u._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()}_getPhotometricScale(){let u=0;const x=this.getTypeID();let s=this.intensityMode;switch(s===d.INTENSITYMODE_AUTOMATIC&&(s=x===d.LIGHTTYPEID_DIRECTIONALLIGHT?d.INTENSITYMODE_ILLUMINANCE:d.INTENSITYMODE_LUMINOUSINTENSITY),x){case d.LIGHTTYPEID_POINTLIGHT:case d.LIGHTTYPEID_SPOTLIGHT:switch(s){case d.INTENSITYMODE_LUMINOUSPOWER:u=1/(4*Math.PI);break;case d.INTENSITYMODE_LUMINOUSINTENSITY:u=1;break;case d.INTENSITYMODE_LUMINANCE:u=this.radius*this.radius}break;case d.LIGHTTYPEID_DIRECTIONALLIGHT:switch(s){case d.INTENSITYMODE_ILLUMINANCE:u=1;break;case d.INTENSITYMODE_LUMINANCE:{let x=this.radius;x=Math.max(x,.001),u=2*Math.PI*(1-Math.cos(x));break}}break;case d.LIGHTTYPEID_HEMISPHERICLIGHT:u=1}return u}_reorderLightsInScene(){const u=this.getScene();0!=this._renderPriority&&(u.requireLightSorting=!0),this.getScene().sortLightsByPriority()}}d.FALLOFF_DEFAULT=k.c.FALLOFF_DEFAULT,d.FALLOFF_PHYSICAL=k.c.FALLOFF_PHYSICAL,d.FALLOFF_GLTF=k.c.FALLOFF_GLTF,d.FALLOFF_STANDARD=k.c.FALLOFF_STANDARD,d.LIGHTMAP_DEFAULT=k.c.LIGHTMAP_DEFAULT,d.LIGHTMAP_SPECULAR=k.c.LIGHTMAP_SPECULAR,d.LIGHTMAP_SHADOWSONLY=k.c.LIGHTMAP_SHADOWSONLY,d.INTENSITYMODE_AUTOMATIC=k.c.INTENSITYMODE_AUTOMATIC,d.INTENSITYMODE_LUMINOUSPOWER=k.c.INTENSITYMODE_LUMINOUSPOWER,d.INTENSITYMODE_LUMINOUSINTENSITY=k.c.INTENSITYMODE_LUMINOUSINTENSITY,d.INTENSITYMODE_ILLUMINANCE=k.c.INTENSITYMODE_ILLUMINANCE,d.INTENSITYMODE_LUMINANCE=k.c.INTENSITYMODE_LUMINANCE,d.LIGHTTYPEID_POINTLIGHT=k.c.LIGHTTYPEID_POINTLIGHT,d.LIGHTTYPEID_DIRECTIONALLIGHT=k.c.LIGHTTYPEID_DIRECTIONALLIGHT,d.LIGHTTYPEID_SPOTLIGHT=k.c.LIGHTTYPEID_SPOTLIGHT,d.LIGHTTYPEID_HEMISPHERICLIGHT=k.c.LIGHTTYPEID_HEMISPHERICLIGHT,U.Cg([_.jT()],d.prototype,"diffuse",void 0),U.Cg([_.jT()],d.prototype,"specular",void 0),U.Cg([_.lK()],d.prototype,"falloffType",void 0),U.Cg([_.lK()],d.prototype,"intensity",void 0),U.Cg([_.lK()],d.prototype,"range",null),U.Cg([_.lK()],d.prototype,"intensityMode",null),U.Cg([_.lK()],d.prototype,"radius",null),U.Cg([_.lK()],d.prototype,"_renderPriority",void 0),U.Cg([_.$z("_reorderLightsInScene")],d.prototype,"renderPriority",void 0),U.Cg([_.lK("shadowEnabled")],d.prototype,"_shadowEnabled",void 0),U.Cg([_.lK("excludeWithLayerMask")],d.prototype,"_excludeWithLayerMask",void 0),U.Cg([_.lK("includeOnlyWithLayerMask")],d.prototype,"_includeOnlyWithLayerMask",void 0),U.Cg([_.lK("lightmapMode")],d.prototype,"_lightmapMode",void 0)},875830:(u,x,s)=>{s.d(x,{c:()=>U});class U{static CompareLightsPriority(u,x){return u.shadowEnabled!==x.shadowEnabled?(x.shadowEnabled?1:0)-(u.shadowEnabled?1:0):x.renderPriority-u.renderPriority}}U.FALLOFF_DEFAULT=0,U.FALLOFF_PHYSICAL=1,U.FALLOFF_GLTF=2,U.FALLOFF_STANDARD=3,U.LIGHTMAP_DEFAULT=0,U.LIGHTMAP_SPECULAR=1,U.LIGHTMAP_SHADOWSONLY=2,U.INTENSITYMODE_AUTOMATIC=0,U.INTENSITYMODE_LUMINOUSPOWER=1,U.INTENSITYMODE_LUMINOUSINTENSITY=2,U.INTENSITYMODE_ILLUMINANCE=3,U.INTENSITYMODE_LUMINANCE=4,U.LIGHTTYPEID_POINTLIGHT=0,U.LIGHTTYPEID_DIRECTIONALLIGHT=1,U.LIGHTTYPEID_SPOTLIGHT=2,U.LIGHTTYPEID_HEMISPHERICLIGHT=3},232395:(u,x,s)=>{s.d(x,{p:()=>L});var U=s(297809),_=s(760998),W=s(604910),c=s(349487),I=s(690096);class L extends c.v{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=W.uq.Identity(),this._projectionMatrix=W.uq.Identity()}_setPosition(u){this._position=u}get position(){return this._position}set position(u){this._setPosition(u)}_setDirection(u){this._direction=u}get direction(){return this._direction}set direction(u){this._setDirection(u)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(u){this._shadowMinZ=u,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(u){this._shadowMaxZ=u,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix||(this.transformedPosition||(this.transformedPosition=W.Pq.Zero()),W.Pq.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=W.Pq.Zero()),W.Pq.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),0))}getDepthScale(){return 50}getShadowDirection(u){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(u){return this.direction=W.Pq.Normalize(u.subtract(this.position)),this.direction}getRotation(){this.direction.normalize();const u=W.Pq.Cross(this.direction,I._0.Y),x=W.Pq.Cross(u,this.direction);return W.Pq.RotationFromAxis(u,x,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=W.Pq.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}computeWorldMatrix(u){return!u&&this.isSynchronized()?(this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.copyFrom(this.position),this._worldMatrix||(this._worldMatrix=W.uq.Identity()),W.uq.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(u){return void 0!==this.shadowMinZ?this.shadowMinZ:u.minZ}getDepthMaxZ(u){return void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ}setShadowProjectionMatrix(u,x,s){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(x,s,u):this._setDefaultShadowProjectionMatrix(u,x,s),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(u){const x=W.AA.Vector3[0];let s=this.position;this.computeTransformedInformation()&&(s=this.transformedPosition),W.Pq.NormalizeToRef(this.getShadowDirection(u),x),1===Math.abs(W.Pq.Dot(x,W.Pq.Up()))&&(x.z=1e-13);const U=W.AA.Vector3[1];return s.addToRef(x,U),W.uq.LookAtLHToRef(s,U,W.Pq.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(u,x){return this.setShadowProjectionMatrix(this._projectionMatrix,null!=u?u:this._viewMatrix,null!=x?x:[]),this._projectionMatrix}}U.Cg([_.P_()],L.prototype,"position",null),U.Cg([_.P_()],L.prototype,"direction",null),U.Cg([_.lK()],L.prototype,"shadowMinZ",null),U.Cg([_.lK()],L.prototype,"shadowMaxZ",null)},216471:(u,x,s)=>{s.d(x,{n:()=>i});var U=s(297809),_=s(760998),W=s(604910),c=s(869581),I=s(349487),L=s(232395),J=s(432050),k=s(310035);c.b.AddNodeConstructor("Light_Type_2",((u,x)=>()=>new i(u,W.Pq.Zero(),W.Pq.Zero(),0,0,x)));class i extends L.p{get angle(){return this._angle}set angle(u){this._angle=u,this._cosHalfAngle=Math.cos(.5*u),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(u){this._innerAngle=u,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(u){this._shadowAngleScale=u,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(u){this._projectionTextureLightNear=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(u){this._projectionTextureLightFar=u,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(u){this._projectionTextureUpDirection=u,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(u){this._projectionTexture!==u&&(this._projectionTexture=u,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(i._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):i._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(u){return void 0!==u.onGeneratedObservable}static _IsTexture(u){return void 0!==u.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(u){this._projectionTextureProjectionLightMatrix=u,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(u,x,s,U,_,c){super(u,c),this._innerAngle=0,this._projectionTextureMatrix=W.uq.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=W.Pq.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=W.Pq.Zero(),this._projectionTextureViewLightMatrix=W.uq.Zero(),this._projectionTextureProjectionLightMatrix=W.uq.Zero(),this._projectionTextureScalingMatrix=W.uq.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=x,this.direction=s,this.angle=U,this.exponent=_}getClassName(){return"SpotLight"}getTypeID(){return I.v.LIGHTTYPEID_SPOTLIGHT}_setDirection(u){super._setDirection(u),this._projectionTextureViewLightDirty=!0}_setPosition(u){super._setPosition(u),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(u,x,s){const U=this.getScene().activeCamera;if(!U)return;this._shadowAngleScale=this._shadowAngleScale||1;const _=this._shadowAngleScale*this._angle,c=void 0!==this.shadowMinZ?this.shadowMinZ:U.minZ,I=void 0!==this.shadowMaxZ?this.shadowMaxZ:U.maxZ,L=this.getScene().getEngine().useReverseDepthBuffer;W.uq.PerspectiveFovLHToRef(_,1,L?I:c,L?c:I,u,!0,this._scene.getEngine().isNDCHalfZRange,void 0,L)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),W.uq.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const u=this.projectionTextureLightFar,x=this.projectionTextureLightNear,s=u/(u-x),U=-s*x,_=1/Math.tan(this._angle/2);W.uq.FromValuesToRef(_/1,0,0,0,0,_,0,0,0,0,s,1,0,0,U,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof J.g){const u=this._projectionTexture.uScale/2,x=this._projectionTexture.vScale/2;W.uq.FromValuesToRef(u,0,0,0,0,x,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(u,x){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),u.setMatrix("textureProjectionMatrix"+x,this._projectionTextureMatrix),u.setTexture("projectionLightTexture"+x,this.projectionTexture)),this}transferToEffect(u,x){let s;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,x),s=W.Pq.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,x),s=W.Pq.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",s.x,s.y,s.z,this._cosHalfAngle,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,x),this}transferToNodeMaterialEffect(u,x){let s;return s=this.computeTransformedInformation()?W.Pq.Normalize(this.transformedDirection):W.Pq.Normalize(this.direction),this.getScene().useRightHandedSystem?u.setFloat3(x,-s.x,-s.y,-s.z):u.setFloat3(x,s.x,s.y,s.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(u){const x=this._scene.getEngine(),s=void 0!==this.shadowMinZ?this.shadowMinZ:u.minZ;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?s:this._scene.getEngine().isNDCHalfZRange?0:s}getDepthMaxZ(u){const x=this._scene.getEngine(),s=void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ;return x.useReverseDepthBuffer&&x.isNDCHalfZRange?0:s}prepareLightSpecificDefines(u,x){u["SPOTLIGHT"+x]=!0,u["PROJECTEDLIGHTTEXTURE"+x]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}U.Cg([_.lK()],i.prototype,"angle",null),U.Cg([_.lK()],i.prototype,"innerAngle",null),U.Cg([_.lK()],i.prototype,"shadowAngleScale",null),U.Cg([_.lK()],i.prototype,"exponent",void 0),U.Cg([_.lK()],i.prototype,"projectionTextureLightNear",null),U.Cg([_.lK()],i.prototype,"projectionTextureLightFar",null),U.Cg([_.lK()],i.prototype,"projectionTextureUpDirection",null),U.Cg([_.uM("projectedLightTexture")],i.prototype,"_projectionTexture",void 0),k.Y5("BABYLON.SpotLight",i)},197501:(u,x,s)=>{s.d(x,{Q:()=>e,l:()=>T});var U=s(706400),_=s(564135),W=s(604910),c=s(332290),I=s(27230),L=s(742631),J=s(633727),k=s(55973),i=s(234412),d=s(639093),j=s(394899),r=s(77724),D=s(349487),$=s(122030),H=s(548949),f=s(837475),O=s(23178),t=s(938480),V=s(993954),N=s(776796),m=s(875137),b=s(390436),n=s(704830),F=s(293940),B=s(310035),Z=s(898973),v=s(850034),y=s(133716),e=!0;class T{}T.LoaderInjectedPhysicsEngine=void 0;let Q={},E={};const l=(u,x,s,U)=>{if(!x.materials)return null;for(let _=0,W=x.materials.length;_<W;_++){const W=x.materials[_];if(u(W))return{parsedMaterial:W,material:k.i.Parse(W,s,U)}}return null},z=(u,x,s)=>{for(const U in x)if(u.name===x[U])return s.push(u.id),!0;return void 0!==u.parentId&&-1!==s.indexOf(u.parentId)&&(s.push(u.id),!0)},S=(u,x)=>u+" of "+(x?x.file+" from "+x.name+" version: "+x.version+", exporter version: "+x.exporter_version:"unknown"),R=(u,x)=>{const s=x;if(x._waitingData.lods){if(x._waitingData.lods.ids&&x._waitingData.lods.ids.length>0){const U=x._waitingData.lods.ids,_=s.isEnabled(!1);if(x._waitingData.lods.distances){const W=x._waitingData.lods.distances;if(W.length>=U.length){const x=W.length>U.length?W[W.length-1]:0;s.setEnabled(!1);for(let x=0;x<U.length;x++){const _=U[x],c=u.getMeshById(_);null!=c&&s.addLODLevel(W[x],c)}x>0&&s.addLODLevel(x,null),!0===_&&s.setEnabled(!0)}else Z.S0.Warn("Invalid level of detail distances for "+x.name)}}x._waitingData.lods=null}},X=(u,x,s)=>{if("number"!=typeof u){const U=s.getLastEntryById(u);return U&&null!=x?U.instances[parseInt(x)]:U}const U=Q[u];return U&&null!=x?U.instances[parseInt(x)]:U},p=(u,x)=>"number"!=typeof u?x.getLastMaterialById(u,!0):E[u],G=(u,x,s,W,c=!1)=>{const $=new O.WZ(u);let m="importScene has failed JSON parse";try{var b=JSON.parse(x);m="";const U=H.cn.loggingLevel===H.cn.DETAILED_LOGGING;let W,c;if(void 0!==b.environmentTexture&&null!==b.environmentTexture){const x=void 0===b.isPBR||b.isPBR;if(b.environmentTextureType&&"BABYLON.HDRCubeTexture"===b.environmentTextureType){const U=b.environmentTextureSize?b.environmentTextureSize:128,_=new j.H((b.environmentTexture.match(/https?:\/\//g)?"":s)+b.environmentTexture,u,U,!0,!x,void 0,b.environmentTexturePrefilterOnLoad);b.environmentTextureRotationY&&(_.rotationY=b.environmentTextureRotationY),u.environmentTexture=_}else if("object"==typeof b.environmentTexture){const x=d.b.Parse(b.environmentTexture,u,s);u.environmentTexture=x}else if(b.environmentTexture.endsWith(".env")){const x=new d.b((b.environmentTexture.match(/https?:\/\//g)?"":s)+b.environmentTexture,u,b.environmentTextureForcedExtension);b.environmentTextureRotationY&&(x.rotationY=b.environmentTextureRotationY),u.environmentTexture=x}else{const x=d.b.CreateFromPrefilteredData((b.environmentTexture.match(/https?:\/\//g)?"":s)+b.environmentTexture,u,b.environmentTextureForcedExtension);b.environmentTextureRotationY&&(x.rotationY=b.environmentTextureRotationY),u.environmentTexture=x}if(!0===b.createDefaultSkybox){const s=void 0!==u.activeCamera&&null!==u.activeCamera?(u.activeCamera.maxZ-u.activeCamera.minZ)/2:1e3,U=b.skyboxBlurLevel||0;u.createDefaultSkybox(u.environmentTexture,x,s,U)}$.environmentTexture=u.environmentTexture}if(void 0!==b.environmentIntensity&&null!==b.environmentIntensity&&(u.environmentIntensity=b.environmentIntensity),void 0!==b.lights&&null!==b.lights)for(W=0,c=b.lights.length;W<c;W++){const x=b.lights[W],s=D.v.Parse(x,u);s&&(Q[x.uniqueId]=s,$.lights.push(s),s._parentContainer=$,m+=0===W?"\n\tLights:":"",m+="\n\t\t"+s.toString(U))}if(void 0!==b.reflectionProbes&&null!==b.reflectionProbes)for(W=0,c=b.reflectionProbes.length;W<c;W++){const x=b.reflectionProbes[W],_=F.a.Parse(x,u,s);_&&($.reflectionProbes.push(_),_._parentContainer=$,m+=0===W?"\n\tReflection Probes:":"",m+="\n\t\t"+_.toString(U))}if(void 0!==b.animations&&null!==b.animations)for(W=0,c=b.animations.length;W<c;W++){const x=b.animations[W],s=B.n9("BABYLON.Animation");if(s){const _=s.Parse(x);u.animations.push(_),$.animations.push(_),m+=0===W?"\n\tAnimations:":"",m+="\n\t\t"+_.toString(U)}}if(void 0!==b.materials&&null!==b.materials)for(W=0,c=b.materials.length;W<c;W++){const x=b.materials[W],_=k.i.Parse(x,u,s);_&&(E[x.uniqueId||x.id]=_,$.materials.push(_),_._parentContainer=$,m+=0===W?"\n\tMaterials:":"",m+="\n\t\t"+_.toString(U),_.getActiveTextures().forEach((u=>{-1==$.textures.indexOf(u)&&($.textures.push(u),u._parentContainer=$)})))}if(void 0!==b.multiMaterials&&null!==b.multiMaterials)for(W=0,c=b.multiMaterials.length;W<c;W++){const x=b.multiMaterials[W],s=i.F.ParseMultiMaterial(x,u);E[x.uniqueId||x.id]=s,$.multiMaterials.push(s),s._parentContainer=$,m+=0===W?"\n\tMultiMaterials:":"",m+="\n\t\t"+s.toString(U),s.getActiveTextures().forEach((u=>{-1==$.textures.indexOf(u)&&($.textures.push(u),u._parentContainer=$)}))}if(void 0!==b.morphTargetManagers&&null!==b.morphTargetManagers)for(const x of b.morphTargetManagers){const s=N.j.Parse(x,u);$.morphTargetManagers.push(s),s._parentContainer=$}if(void 0!==b.skeletons&&null!==b.skeletons)for(W=0,c=b.skeletons.length;W<c;W++){const x=b.skeletons[W],s=V.E.Parse(x,u);$.skeletons.push(s),s._parentContainer=$,m+=0===W?"\n\tSkeletons:":"",m+="\n\t\t"+s.toString(U)}const O=b.geometries;if(null!=O){const x=new Array,U=O.vertexData;if(null!=U)for(W=0,c=U.length;W<c;W++){const _=U[W];x.push(L.V.Parse(_,u,s))}x.forEach((u=>{u&&($.geometries.push(u),u._parentContainer=$)}))}if(void 0!==b.transformNodes&&null!==b.transformNodes)for(W=0,c=b.transformNodes.length;W<c;W++){const x=b.transformNodes[W],U=J.V.Parse(x,u,s);Q[x.uniqueId]=U,$.transformNodes.push(U),U._parentContainer=$}if(void 0!==b.meshes&&null!==b.meshes)for(W=0,c=b.meshes.length;W<c;W++){const x=b.meshes[W],_=I.e.Parse(x,u,s);if(Q[x.uniqueId]=_,$.meshes.push(_),_._parentContainer=$,_.hasInstances)for(const u of _.instances)$.meshes.push(u),u._parentContainer=$;m+=0===W?"\n\tMeshes:":"",m+="\n\t\t"+_.toString(U)}if(void 0!==b.cameras&&null!==b.cameras)for(W=0,c=b.cameras.length;W<c;W++){const x=b.cameras[W],s=_.i.Parse(x,u);Q[x.uniqueId]=s,$.cameras.push(s),s._parentContainer=$,m+=0===W?"\n\tCameras:":"",m+="\n\t\t"+s.toString(U)}if(void 0!==b.postProcesses&&null!==b.postProcesses)for(W=0,c=b.postProcesses.length;W<c;W++){const x=b.postProcesses[W],U=v.w.Parse(x,u,s);U&&($.postProcesses.push(U),U._parentContainer=$,m+=0===W?"\nPostprocesses:":"",m+="\n\t\t"+U.toString())}if(void 0!==b.animationGroups&&null!==b.animationGroups)for(W=0,c=b.animationGroups.length;W<c;W++){const x=b.animationGroups[W],s=r.k.Parse(x,u);$.animationGroups.push(s),s._parentContainer=$,m+=0===W?"\n\tAnimationGroups:":"",m+="\n\t\t"+s.toString(U)}if(b.spriteManagers)for(let x=0,U=b.spriteManagers.length;x<U;x++){const U=b.spriteManagers[x];m+="\n\t\tSpriteManager "+y.x.Parse(U,u,s).name}for(W=0,c=u.cameras.length;W<c;W++){const x=u.cameras[W];null!==x._waitingParentId&&(x.parent=X(x._waitingParentId,x._waitingParentInstanceIndex,u),x._waitingParentId=null,x._waitingParentInstanceIndex=null)}for(W=0,c=u.lights.length;W<c;W++){const x=u.lights[W];x&&null!==x._waitingParentId&&(x.parent=X(x._waitingParentId,x._waitingParentInstanceIndex,u),x._waitingParentId=null,x._waitingParentInstanceIndex=null)}for(W=0,c=u.transformNodes.length;W<c;W++){const x=u.transformNodes[W];null!==x._waitingParentId&&(x.parent=X(x._waitingParentId,x._waitingParentInstanceIndex,u),x._waitingParentId=null,x._waitingParentInstanceIndex=null)}for(W=0,c=u.meshes.length;W<c;W++){const x=u.meshes[W];null!==x._waitingParentId&&(x.parent=X(x._waitingParentId,x._waitingParentInstanceIndex,u),x._waitingParentId=null,x._waitingParentInstanceIndex=null),x._waitingData.lods&&R(u,x)}for(u.multiMaterials.forEach((x=>{x._waitingSubMaterialsUniqueIds.forEach((s=>{x.subMaterials.push(p(s,u))})),x._waitingSubMaterialsUniqueIds=[]})),u.meshes.forEach((x=>{null!==x._waitingMaterialId&&(x.material=p(x._waitingMaterialId,u),x._waitingMaterialId=null)})),W=0,c=u.skeletons.length;W<c;W++){const x=u.skeletons[W];x._hasWaitingData&&(null!=x.bones&&x.bones.forEach((x=>{if(x._waitingTransformNodeId){const s=u.getLastEntryById(x._waitingTransformNodeId);s&&x.linkTransformNode(s),x._waitingTransformNodeId=null}})),x._hasWaitingData=null)}for(W=0,c=u.meshes.length;W<c;W++){const x=u.meshes[W];x._waitingData.freezeWorldMatrix?(x.freezeWorldMatrix(),x._waitingData.freezeWorldMatrix=null):x.computeWorldMatrix(!0)}for(W=0,c=u.lights.length;W<c;W++){const x=u.lights[W];if(x._excludedMeshesIds.length>0){for(let s=0;s<x._excludedMeshesIds.length;s++){const U=u.getMeshById(x._excludedMeshesIds[s]);U&&x.excludedMeshes.push(U)}x._excludedMeshesIds=[]}if(x._includedOnlyMeshesIds.length>0){for(let s=0;s<x._includedOnlyMeshesIds.length;s++){const U=u.getMeshById(x._includedOnlyMeshesIds[s]);U&&x.includedOnlyMeshes.push(U)}x._includedOnlyMeshesIds=[]}}for(u.geometries.forEach((u=>{u._loadedUniqueId=""})),f.d.Parse(b,u,$,s),W=0,c=u.meshes.length;W<c;W++){const x=u.meshes[W];x._waitingData.actions&&(t.m.Parse(x._waitingData.actions,x,u),x._waitingData.actions=null)}void 0!==b.actions&&null!==b.actions&&t.m.Parse(b.actions,null,u)}catch(u){const x=S("loadAssets",b?b.producer:"Unknown")+m;if(!W)throw U.V.Log(x),u;W(x,u)}finally{Q={},E={},c||$.removeAllFromScene(),null!==m&&H.cn.loggingLevel!==H.cn.NO_LOGGING&&U.V.Log(S("loadAssets",b?b.producer:"Unknown")+(H.cn.loggingLevel!==H.cn.MINIMAL_LOGGING?m:""))}return $};H.cn.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:u=>-1!==u.indexOf("babylon"),rewriteRootURL:function(u){return 0?0:window.EVO_CDN||""},importMesh:(u,x,s,_,W,c,k,d)=>{var j;let r="importMesh has failed JSON parse";try{var D=JSON.parse(s);r="";const d=H.cn.loggingLevel===H.cn.DETAILED_LOGGING;u?Array.isArray(u)||(u=[u]):u=null;const O=[],t=new Map,m=[];if(void 0!==D.transformNodes&&null!==D.transformNodes)for(let u=0,s=D.transformNodes.length;u<s;u++){const s=D.transformNodes[u],U=J.V.Parse(s,x,_);m.push(U),t.set(U._waitingParsedUniqueId,U),U._waitingParsedUniqueId=null}if(void 0!==D.meshes&&null!==D.meshes){const s=[],c=[],J=[],$=[];for(let j=0,H=D.meshes.length;j<H;j++){const H=D.meshes[j];if(null===u||z(H,u,O)){if(null!==u&&delete u[u.indexOf(H.name)],void 0!==H.geometryId&&null!==H.geometryId&&void 0!==D.geometries&&null!==D.geometries){let u=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach((s=>{!0!==u&&D.geometries[s]&&Array.isArray(D.geometries[s])&&D.geometries[s].forEach((U=>{U.id===H.geometryId&&("vertexData"===s&&L.V.Parse(U,x,_),u=!0)}))})),!1===u&&U.V.Warn("Geometry not found for mesh "+H.id)}if(H.materialUniqueId||H.materialId){const u=H.materialUniqueId?J:c;let s=-1!==u.indexOf(H.materialUniqueId||H.materialId);if(!1===s&&void 0!==D.multiMaterials&&null!==D.multiMaterials){const U=(s,U)=>{u.push(s);const W=l(U,D,x,_);W&&W.material&&(E[W.parsedMaterial.uniqueId||W.parsedMaterial.id]=W.material,r+="\n\tMaterial "+W.material.toString(d))};for(let _=0,W=D.multiMaterials.length;_<W;_++){const W=D.multiMaterials[_];if(H.materialUniqueId&&W.uniqueId===H.materialUniqueId||W.id===H.materialId){W.materialsUniqueIds?W.materialsUniqueIds.forEach((u=>U(u,(x=>x.uniqueId===u)))):W.materials.forEach((u=>U(u,(x=>x.id===u)))),u.push(W.uniqueId||W.id);const _=i.F.ParseMultiMaterial(W,x);E[W.uniqueId||W.id]=_,_&&(s=!0,r+="\n\tMulti-Material "+_.toString(d));break}}}if(!1===s){u.push(H.materialUniqueId||H.materialId);const s=l((u=>H.materialUniqueId&&u.uniqueId===H.materialUniqueId||u.id===H.materialId),D,x,_);s&&s.material?(E[s.parsedMaterial.uniqueId||s.parsedMaterial.id]=s.material,r+="\n\tMaterial "+s.material.toString(d)):U.V.Warn("Material not found for mesh "+H.id)}}if(null!==H.skeletonId&&void 0!==H.skeletonId&&-1!==D.skeletonId&&void 0!==D.skeletons&&null!==D.skeletons&&!(s.indexOf(H.skeletonId)>-1))for(let u=0,U=D.skeletons.length;u<U;u++){const U=D.skeletons[u];if(U.id===H.skeletonId){const u=V.E.Parse(U,x);k.push(u),s.push(U.id),r+="\n\tSkeleton "+u.toString(d)}}if(H.morphTargetManagerId>-1&&void 0!==D.morphTargetManagers&&null!==D.morphTargetManagers&&!($.indexOf(H.morphTargetManagerId)>-1))for(let u=0,s=D.morphTargetManagers.length;u<s;u++){const s=D.morphTargetManagers[u];if(s.id===H.morphTargetManagerId){const u=N.j.Parse(s,x);$.push(u.uniqueId),r+="\nMorph target "+u.toString()}}const j=I.e.Parse(H,x,_);W.push(j),t.set(j._waitingParsedUniqueId,j),j._waitingParsedUniqueId=null,r+="\n\tMesh "+j.toString(d)}}x.multiMaterials.forEach((u=>{u._waitingSubMaterialsUniqueIds.forEach((s=>{u.subMaterials.push(p(s,x))})),u._waitingSubMaterialsUniqueIds=[]})),x.meshes.forEach((u=>{null!==u._waitingMaterialId&&(u.material=p(u._waitingMaterialId,x),u._waitingMaterialId=null)}));for(let u=0,s=x.transformNodes.length;u<s;u++){const s=x.transformNodes[u];if(null!==s._waitingParentId){let u=t.get(parseInt(s._waitingParentId))||null;null===u&&(u=x.getLastEntryById(s._waitingParentId));let U=u;s._waitingParentInstanceIndex&&(U=u.instances[parseInt(s._waitingParentInstanceIndex)],s._waitingParentInstanceIndex=null),s.parent=U,s._waitingParentId=null}}let H;for(let u=0,s=x.meshes.length;u<s;u++){if(H=x.meshes[u],H._waitingParentId){let u=t.get(parseInt(H._waitingParentId))||null;null===u&&(u=x.getLastEntryById(H._waitingParentId));let s=u;if(H._waitingParentInstanceIndex&&(s=u.instances[parseInt(H._waitingParentInstanceIndex)],H._waitingParentInstanceIndex=null),H.parent=s,"TransformNode"===(null===(j=H.parent)||void 0===j?void 0:j.getClassName())){const u=m.indexOf(H.parent);u>-1&&m.splice(u,1)}H._waitingParentId=null}H._waitingData.lods&&R(x,H)}for(const u of m)u.dispose();for(let u=0,s=x.skeletons.length;u<s;u++){const s=x.skeletons[u];s._hasWaitingData&&(null!=s.bones&&s.bones.forEach((u=>{if(u._waitingTransformNodeId){const s=x.getLastEntryById(u._waitingTransformNodeId);s&&u.linkTransformNode(s),u._waitingTransformNodeId=null}})),s._hasWaitingData=null)}for(let u=0,s=x.meshes.length;u<s;u++)H=x.meshes[u],H._waitingData.freezeWorldMatrix?(H.freezeWorldMatrix(),H._waitingData.freezeWorldMatrix=null):H.computeWorldMatrix(!0)}if(void 0!==D.particleSystems&&null!==D.particleSystems){const u=f.d.GetIndividualParser($.v.NAME_PARTICLESYSTEM);if(u)for(let s=0,U=D.particleSystems.length;s<U;s++){const U=D.particleSystems[s];-1!==O.indexOf(U.emitterId)&&c.push(u(U,x,_))}}return x.geometries.forEach((u=>{u._loadedUniqueId=""})),!0}catch(u){const x=S("importMesh",D?D.producer:"Unknown")+r;if(!d)throw U.V.Log(x),u;d(x,u)}finally{null!==r&&H.cn.loggingLevel!==H.cn.NO_LOGGING&&U.V.Log(S("importMesh",D?D.producer:"Unknown")+(H.cn.loggingLevel!==H.cn.MINIMAL_LOGGING?r:"")),E={}}return!1},load:(u,x,s,_)=>{let I="importScene has failed JSON parse";try{var L=JSON.parse(x);switch(I="",void 0!==L.useDelayedTextureLoading&&null!==L.useDelayedTextureLoading&&(u.useDelayedTextureLoading=L.useDelayedTextureLoading&&!H.cn.ForceFullSceneLoadingForIncremental),void 0!==L.autoClear&&null!==L.autoClear&&(u.autoClear=L.autoClear),void 0!==L.clearColor&&null!==L.clearColor&&(u.clearColor=c.ov.FromArray(L.clearColor)),void 0!==L.ambientColor&&null!==L.ambientColor&&(u.ambientColor=c.v9.FromArray(L.ambientColor)),void 0!==L.gravity&&null!==L.gravity&&(u.gravity=W.Pq.FromArray(L.gravity)),void 0!==L.useRightHandedSystem&&(u.useRightHandedSystem=!!L.useRightHandedSystem),void 0!==L.fogMode&&null!==L.fogMode&&(u.fogMode=L.fogMode),void 0!==L.fogColor&&null!==L.fogColor&&(u.fogColor=c.v9.FromArray(L.fogColor)),void 0!==L.fogStart&&null!==L.fogStart&&(u.fogStart=L.fogStart),void 0!==L.fogEnd&&null!==L.fogEnd&&(u.fogEnd=L.fogEnd),void 0!==L.fogDensity&&null!==L.fogDensity&&(u.fogDensity=L.fogDensity),I+="\tFog mode for scene:  ",u.fogMode){case 0:I+="none\n";break;case 1:I+="exp\n";break;case 2:I+="exp2\n";break;case 3:I+="linear\n"}if(L.physicsEnabled){let x;"cannon"===L.physicsEngine||L.physicsEngine===m.O.name?x=new m.O(void 0,void 0,T.LoaderInjectedPhysicsEngine):"oimo"===L.physicsEngine||L.physicsEngine===b.z.name?x=new b.z(void 0,T.LoaderInjectedPhysicsEngine):"ammo"!==L.physicsEngine&&L.physicsEngine!==n.v.name||(x=new n.v(void 0,T.LoaderInjectedPhysicsEngine,void 0)),I="\tPhysics engine "+(L.physicsEngine?L.physicsEngine:"oimo")+" enabled\n";const s=L.gravity?W.Pq.FromArray(L.gravity):L.physicsGravity?W.Pq.FromArray(L.physicsGravity):null;u.enablePhysics(s,x)}return void 0!==L.metadata&&null!==L.metadata&&(u.metadata=L.metadata),void 0!==L.collisionsEnabled&&null!==L.collisionsEnabled&&(u.collisionsEnabled=L.collisionsEnabled),!!G(u,x,s,_,!0)&&(L.autoAnimate&&u.beginAnimation(u,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1),void 0!==L.activeCameraID&&null!==L.activeCameraID&&u.setActiveCameraById(L.activeCameraID),!0)}catch(u){const x=S("importScene",L?L.producer:"Unknown")+I;if(!_)throw U.V.Log(x),u;_(x,u)}finally{null!==I&&H.cn.loggingLevel!==H.cn.NO_LOGGING&&U.V.Log(S("importScene",L?L.producer:"Unknown")+(H.cn.loggingLevel!==H.cn.MINIMAL_LOGGING?I:""))}return!1},loadAssetContainer:(u,x,s,U)=>G(u,x,s,U)})},548949:(u,x,s)=>{s.d(x,{VA:()=>n,VU:()=>Z,cH:()=>N,cn:()=>z,fV:()=>E,gD:()=>U,kS:()=>e});var U,_=s(898973),W=s(638113),c=s(889460),I=s(395726),L=s(706400),J=s(396574),k=s(435683),i=s(879808),d=s(977041),j=s(33321);(function(u){u[u["Clean"]=0]="Clean",u[u["Stop"]=1]="Stop",u[u["Sync"]=2]="Sync",u[u["NoSync"]=3]="NoSync"})(U||(U={}));const r=new W.cP,D={};let $=!1;function H(){return D[".babylon"]}function f(u){return D[u]||(L.V.Warn("Unable to find a plugin to load "+u+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),H())}function O(u,x,s){let U="Unable to load from "+(u.rawData?"binary data":u.url);return x?U+=`: ${x}`:s&&(U+=`: ${s}`),U}function t(u,x,s,U,_,W,c,I,L){var J;const i="data:"===(d=u.url).substr(0,5)?d.substr(5):null;var d;if(u.rawData&&!c)throw"When using ArrayBufferView to load data the file extension must be provided.";const $=c?f(c):i?function(u){for(const x in D){const s=D[x].plugin;if(s.canDirectLoad&&s.canDirectLoad(u))return D[x]}return H()}(u.url):function(u){const x=u.indexOf("?");-1!==x&&(u=u.substring(0,x));const s=u.lastIndexOf(".");return f(u.substring(s,u.length).toLowerCase())}(u.url);if(!$)throw new Error(`No plugin or fallback for ${null!=c?c:u.url}`);if(!1===(null===(J=null==L?void 0:L[$.plugin.name])||void 0===J?void 0:J.enabled))throw new Error(`The '${$.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(u.rawData&&!$.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(u=>{if($.plugin.createPlugin){const x=$.plugin.createPlugin(null!=L?L:{});return x instanceof Promise?(x.then(u).catch((u=>{_("Error instantiating plugin.",u)})),null):(u(x),x)}return u($.plugin),$.plugin})((L=>{var J;if(!L)throw`The loader plugin corresponding to the '${c}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(r.notifyObservers(L),i&&(L.canDirectLoad&&L.canDirectLoad(u.url)||!k.f2(u.url))){if(L.directLoad){const u=L.directLoad(x,i);u instanceof Promise?u.then((u=>{s(L,u)})).catch((u=>{_("Error in directLoad of _loadData: "+u,u)})):s(L,u)}else s(L,i);return}const d=$.isBinary,D=(u,U)=>{x.isDisposed?_("Scene has been disposed"):s(L,u,U)};let H=null,f=!1;null===(J=L.onDisposeObservable)||void 0===J||J.add((()=>{f=!0,H&&(H.abort(),H=null),W()}));const O=()=>{if(f)return;const s=(u,x)=>{_(null==u?void 0:u.statusText,x)};if(!L.loadFile&&u.rawData)throw"Plugin does not support loading ArrayBufferView.";H=L.loadFile?L.loadFile(x,u.rawData||u.file||u.url,u.rootUrl,D,U,d,s,I):x._loadFile(u.file||u.url,D,U,!0,d,s)},t=x.getEngine();let V=t.enableOfflineSupport;if(V){let s=!1;for(const U of x.disableOfflineSupportExceptionRules)if(U.test(u.url)){s=!0;break}V=!s}V&&j.$.OfflineProviderFactory?x.offlineProvider=j.$.OfflineProviderFactory(u.url,O,t.disableManifestCheck):O()}))}function V(u,x){let s,U,W=null,c=null;if(x)if(x.name)s=`file:${x.name}`,U=x.name,W=x;else if(ArrayBuffer.isView(x))s="",U=d.z(),c=x;else if(x.startsWith("data:"))s=x,U="";else if(u){const W=x;if("/"===W.substr(0,1))return _.S0.Error("Wrong sceneFilename parameter"),null;s=u+W,U=W}else s=x,U=_.S0.GetFilename(x),u=_.S0.GetFolderPath(x);else s=u,U=_.S0.GetFilename(u),u=_.S0.GetFolderPath(u);return{url:s,rootUrl:u,name:U,file:W,rawData:c}}function N(u){if("string"==typeof u.extensions){const x=u.extensions;D[x.toLowerCase()]={plugin:u,isBinary:!1}}else{const x=u.extensions;Object.keys(x).forEach((s=>{D[s.toLowerCase()]={plugin:u,isBinary:x[s].isBinary}}))}}function m(u,x,s="",U=I.q.LastCreatedScene,_=null,W=null,c=null,J=null,k="",d={}){if(!U)return L.V.Error("No scene available to import mesh to"),null;const j=V(x,s);if(!j)return null;const r={};U.addPendingData(r);const D=()=>{U.removePendingData(r)},$=(u,x)=>{const s=O(j,u,x);c?c(U,s,new i.bu(s,i.tG.SceneLoaderError,x)):L.V.Error(s),D()},H=W?u=>{try{W(u)}catch(u){$("Error in onProgress callback: "+u,u)}}:void 0,f=(u,x,s,W,c,I,L,J)=>{if(U.importedMeshesFiles.push(j.url),_)try{_(u,x,s,W,c,I,L,J)}catch(u){$("Error in onSuccess callback: "+u,u)}U.removePendingData(r)};return t(j,U,((x,s,_)=>{if(x.rewriteRootURL&&(j.rootUrl=x.rewriteRootURL(j.rootUrl,_)),x.importMesh){const _=[],W=[],c=[];if(!x.importMesh(u,U,s,j.rootUrl,_,W,c,$))return;U.loadingPluginName=x.name,f(_,W,c,[],[],[],[],[])}else x.importMeshAsync(u,U,s,j.rootUrl,H,j.name).then((u=>{U.loadingPluginName=x.name,f(u.meshes,u.particleSystems,u.skeletons,u.animationGroups,u.transformNodes,u.geometries,u.lights,u.spriteManagers)})).catch((u=>{$(u.message,u)}))}),H,$,D,J,k,d)}function b(u,x="",s=I.q.LastCreatedEngine,U=null,W=null,L=null,J=null,k="",i={}){return s?B(u,x,new c.Z(s),U,W,L,J,k,i):(_.S0.Error("No engine available"),null)}function n(u,x,s){const{rootUrl:U="",onProgress:_,pluginExtension:W,name:c,pluginOptions:I}=null!=s?s:{};return F(U,u,x,_,W,c,I)}function F(u,x,s,U,_,W,c){return new Promise(((I,L)=>{b(u,x,s,(u=>{I(u)}),U,((u,x,s)=>{L(s||new Error(x))}),_,W,c)}))}function B(u,x="",s=I.q.LastCreatedScene,U=null,_=null,W=null,c=null,k="",d={}){if(!s)return L.V.Error("No scene available to append to"),null;const j=V(u,x);if(!j)return null;const r={};s.addPendingData(r);const D=()=>{s.removePendingData(r)};J.B.ShowLoadingScreen&&!$&&($=!0,s.getEngine().displayLoadingUI(),s.executeWhenReady((()=>{s.getEngine().hideLoadingUI(),$=!1})));const H=(u,x)=>{const U=O(j,u,x);W?W(s,U,new i.bu(U,i.tG.SceneLoaderError,x)):L.V.Error(U),D()},f=_?u=>{try{_(u)}catch(u){H("Error in onProgress callback",u)}}:void 0,N=()=>{if(U)try{U(s)}catch(u){H("Error in onSuccess callback",u)}s.removePendingData(r)};return t(j,s,((u,x)=>{if(u.load){if(!u.load(s,x,j.rootUrl,H))return;s.loadingPluginName=u.name,N()}else u.loadAsync(s,x,j.rootUrl,f,j.name).then((()=>{s.loadingPluginName=u.name,N()})).catch((u=>{H(u.message,u)}))}),f,H,D,c,k,d)}async function Z(u,x,s){const{rootUrl:U="",onProgress:_,pluginExtension:W,name:c,pluginOptions:I}=null!=s?s:{};await v(U,u,x,_,W,c,I)}function v(u,x,s,U,_,W,c){return new Promise(((I,L)=>{B(u,x,s,(u=>{I(u)}),U,((u,x,s)=>{L(s||new Error(x))}),_,W,c)}))}function y(u,x="",s=I.q.LastCreatedScene,U=null,_=null,W=null,c=null,J="",k={}){if(!s)return L.V.Error("No scene available to load asset container to"),null;const d=V(u,x);if(!d)return null;const j={};s.addPendingData(j);const r=()=>{s.removePendingData(j)},D=(u,x)=>{const U=O(d,u,x);W?W(s,U,new i.bu(U,i.tG.SceneLoaderError,x)):L.V.Error(U),r()},$=_?u=>{try{_(u)}catch(u){D("Error in onProgress callback",u)}}:void 0,H=u=>{if(U)try{U(u)}catch(u){D("Error in onSuccess callback",u)}s.removePendingData(j)};return t(d,s,((u,x)=>{if(u.loadAssetContainer){const U=u.loadAssetContainer(s,x,d.rootUrl,D);if(!U)return;U.populateRootNodes(),s.loadingPluginName=u.name,H(U)}else u.loadAssetContainerAsync?u.loadAssetContainerAsync(s,x,d.rootUrl,$,d.name).then((x=>{x.populateRootNodes(),s.loadingPluginName=u.name,H(x)})).catch((u=>{D(u.message,u)})):D("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),$,D,r,c,J,k)}function e(u,x,s){const{rootUrl:U="",onProgress:_,pluginExtension:W,name:c,pluginOptions:I}=null!=s?s:{};return T(U,u,x,_,W,c,I)}function T(u,x,s,U,_,W,c){return new Promise(((I,L)=>{y(u,x,s,(u=>{I(u)}),U,((u,x,s)=>{L(s||new Error(x))}),_,W,c)}))}function Q(u,x="",s=I.q.LastCreatedScene,U=!0,_=0,W=null,c=null,J=null,k=null,i=null,d="",j={}){if(!s)return void L.V.Error("No scene available to load animations to");if(U){for(const u of s.animatables)u.reset();s.stopAllAnimations(),s.animationGroups.slice().forEach((u=>{u.dispose()})),s.getNodes().forEach((u=>{u.animations&&(u.animations=[])}))}else switch(_){case 0:s.animationGroups.slice().forEach((u=>{u.dispose()}));break;case 1:s.animationGroups.forEach((u=>{u.stop()}));break;case 2:s.animationGroups.forEach((u=>{u.reset(),u.restart()}));break;case 3:break;default:return void L.V.Error("Unknown animation group loading mode value '"+_+"'")}const r=s.animatables.length;y(u,x,s,(u=>{u.mergeAnimationsTo(s,s.animatables.slice(r),W),u.dispose(),s.onAnimationFileImportedObservable.notifyObservers(s),c&&c(s)}),J,k,i,d,j)}async function E(u,x,s){const{rootUrl:U="",overwriteAnimations:_,animationGroupLoadingMode:W,targetConverter:c,onProgress:I,pluginExtension:L,name:J,pluginOptions:k}=null!=s?s:{};await l(U,u,x,_,W,c,I,L,J,k)}function l(u,x,s,U,_,W,c,I,L,J){return new Promise(((k,i)=>{Q(u,x,s,U,_,W,(u=>{k(u)}),c,((u,x,s)=>{i(s||new Error(x))}),I,L,J)}))}class z{static get ForceFullSceneLoadingForIncremental(){return J.B.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){J.B.ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return J.B.ShowLoadingScreen}static set ShowLoadingScreen(u){J.B.ShowLoadingScreen=u}static get loggingLevel(){return J.B.loggingLevel}static set loggingLevel(u){J.B.loggingLevel=u}static get CleanBoneMatrixWeights(){return J.B.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){J.B.CleanBoneMatrixWeights=u}static GetDefaultPlugin(){return H()}static GetPluginForExtension(u){var x;return null===(x=f(u))||void 0===x?void 0:x.plugin}static IsPluginForExtensionAvailable(u){return function(u){return!!D[u]}(u)}static RegisterPlugin(u){N(u)}static ImportMesh(u,x,s,U,_,W,c,I,L){return m(u,x,s,U,_,W,c,I,L)}static ImportMeshAsync(u,x,s,U,_,W,c){return function(u,x,s,U,_,W,c,I){return new Promise(((L,J)=>{m(u,x,s,U,((u,x,s,U,_,W,c,I)=>{L({meshes:u,particleSystems:x,skeletons:s,animationGroups:U,transformNodes:_,geometries:W,lights:c,spriteManagers:I})}),_,((u,x,s)=>{J(s||new Error(x))}),W,c,I)}))}(u,x,s,U,_,W,c)}static Load(u,x,s,U,_,W,c,I){return b(u,x,s,U,_,W,c,I)}static LoadAsync(u,x,s,U,_,W){return F(u,x,s,U,_,W)}static Append(u,x,s,U,_,W,c,I){return B(u,x,s,U,_,W,c,I)}static AppendAsync(u,x,s,U,_,W){return v(u,x,s,U,_,W)}static LoadAssetContainer(u,x,s,U,_,W,c,I){return y(u,x,s,U,_,W,c,I)}static LoadAssetContainerAsync(u,x,s,U,_,W){return T(u,x,s,U,_,W)}static ImportAnimations(u,x,s,U,_,W,c,I,L,J,k){Q(u,x,s,U,_,W,c,I,L,J,k)}static ImportAnimationsAsync(u,x,s,U,_,W,c,I,L,J,k){return l(u,x,s,U,_,W,I,J,k)}}z.NO_LOGGING=0,z.MINIMAL_LOGGING=1,z.SUMMARY_LOGGING=2,z.DETAILED_LOGGING=3,z.OnPluginActivatedObservable=r},396574:(u,x,s)=>{s.d(x,{B:()=>U});class U{static get ForceFullSceneLoadingForIncremental(){return U._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(u){U._ForceFullSceneLoadingForIncremental=u}static get ShowLoadingScreen(){return U._ShowLoadingScreen}static set ShowLoadingScreen(u){U._ShowLoadingScreen=u}static get loggingLevel(){return U._LoggingLevel}static set loggingLevel(u){U._LoggingLevel=u}static get CleanBoneMatrixWeights(){return U._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(u){U._CleanBoneMatrixWeights=u}}U._ForceFullSceneLoadingForIncremental=!1,U._ShowLoadingScreen=!0,U._CleanBoneMatrixWeights=!1,U._LoggingLevel=0},825274:(u,x,s)=>{s.d(x,{i:()=>d,v:()=>i});var U=s(297809),_=s(760998),W=s(23987),c=s(604910),I=s(591160),L=s(185537),J=s(527335),k=s(855300);class i extends J.M{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class d extends L.y{set angle(u){this.direction.x=Math.cos(u),this.direction.y=Math.sin(u)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"PBRAnisotropic",110,new i,x),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.direction=new c.I9(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16]}isReadyForSubMesh(u,x){return!this._isEnabled||!(u._areTexturesDirty&&x.texturesEnabled&&this._texture&&I.h.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(u,x,s){this._isEnabled?(u.ANISOTROPIC=this._isEnabled,this._isEnabled&&!s.isVerticesDataPresent(W.R.TangentKind)&&(u._needUVs=!0,u.MAINUV1=!0),u._areTexturesDirty&&x.texturesEnabled&&(this._texture&&I.h.AnisotropicTextureEnabled?k.YT(this._texture,u,"ANISOTROPIC_TEXTURE"):u.ANISOTROPIC_TEXTURE=!1),u._areMiscDirty&&(u.ANISOTROPIC_LEGACY=this._legacy)):(u.ANISOTROPIC=!1,u.ANISOTROPIC_TEXTURE=!1,u.ANISOTROPIC_TEXTUREDIRECTUV=0,u.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(u,x){if(!this._isEnabled)return;const s=this._material.isFrozen;u.useUbo&&s&&u.isSync||(this._texture&&I.h.AnisotropicTextureEnabled&&(u.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),k.mA(this._texture,u,"anisotropy")),u.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity)),x.texturesEnabled&&this._texture&&I.h.AnisotropicTextureEnabled&&u.setTexture("anisotropySampler",this._texture)}hasTexture(u){return this._texture===u}getActiveTextures(u){this._texture&&u.push(this._texture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture)}dispose(u){u&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(u,x,s){return u.ANISOTROPIC&&x.addFallback(s++,"ANISOTROPIC"),s}getSamplers(u){u.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(u,x,s){super.parse(u,x,s),void 0===u.legacy&&(this.legacy=!0)}}U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],d.prototype,"isEnabled",void 0),U.Cg([_.lK()],d.prototype,"intensity",void 0),U.Cg([_.WM()],d.prototype,"direction",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],d.prototype,"texture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsMiscDirty")],d.prototype,"legacy",void 0)},158619:(u,x,s)=>{s.d(x,{j:()=>L});var U=s(297809),_=s(760998),W=s(527335),c=s(185537);class I extends W.M{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class L extends c.y{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"PBRBRDF",90,new I,x),this._useEnergyConservation=L.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=L.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=L.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=L.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=L.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=L.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=L.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=L.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=u._dirtyCallbacks[16],this._enable(!0)}prepareDefines(u){u.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,u.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,u.SPHERICAL_HARMONICS=this._useSphericalHarmonics,u.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}L.DEFAULT_USE_ENERGY_CONSERVATION=!0,L.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,L.DEFAULT_USE_SPHERICAL_HARMONICS=!0,L.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,U.Cg([_.lK(),_.$z("_markAllSubMeshesAsMiscDirty")],L.prototype,"useEnergyConservation",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsMiscDirty")],L.prototype,"useSmithVisibilityHeightCorrelated",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsMiscDirty")],L.prototype,"useSphericalHarmonics",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsMiscDirty")],L.prototype,"useSpecularGlossinessInputEnergyConservation",void 0)},570627:(u,x,s)=>{s.d(x,{d:()=>Q,g:()=>T});var U=s(297809),_=s(760998),W=s(706400),c=s(293506),I=s(940296),L=s(889460),J=s(604910),k=s(23987),i=s(158619),d=s(626956),j=s(332290),r=s(615473),D=s(239590),$=s(55973),H=s(527335),f=s(235519),O=s(432050),t=s(591160),V=(s(587053),s(522208)),N=s(40619),m=s(732789),b=s(825274),n=s(727058),F=s(572322),B=s(722736),Z=s(651577),v=s(855300),y=s(384898);const e={effect:null,subMesh:null};class T extends H.M{constructor(u){super(u),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NDC_DEPTH=!1,this.PREPASS_NDC_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class Q extends f.E{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(u){this._realTimeFiltering=u,this.markAsDirty(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(u){this._realTimeFilteringQuality=u,this.markAsDirty(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=u||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(u,x,s=!1){super(u,x),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new J.IU(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=j.v9.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new j.v9(0,0,0),this._albedoColor=new j.v9(1,1,1),this._reflectivityColor=new j.v9(1,1,1),this._reflectionColor=new j.v9(1,1,1),this._emissiveColor=new j.v9(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=Q.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new c.L(16),this._globalAmbientColor=new j.v9(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1;const U=this.getScene().getEngine();!U.isWebGPU||s||Q.ForceGLSL||(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new y.D(U,void 0,void 0,this.name,!0),this._shaderLanguage=1),this.brdf=new i.j(this),this.clearCoat=new N.t(this),this.iridescence=new m.z(this),this.anisotropy=new b.i(this),this.sheen=new n.C(this),this.subSurface=new F.I(this),this.detailMap=new B.c(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),t.h.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=I.X(this.getScene()),this.prePassConfiguration=new d.J}get hasRenderTargetTextures(){return!!(t.h.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var u;return this._transparencyMode===Q.PBRMATERIAL_OPAQUE||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST||(null===(u=this.subSurface)||void 0===u?void 0:u.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var u;return!!this._forceAlphaTest||!(null===(u=this.subSurface)||void 0===u?void 0:u.disableAlphaBlending)&&this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Q.PBRMATERIAL_ALPHATEST)}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==Q.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(u,x,s){var U;this._uniformBufferLayoutBuilt||this.buildUniformLayout();const _=x._drawWrapper;if(_.effect&&this.isFrozen&&_._wasPreviouslyReady&&_._wasPreviouslyUsingInstances===s)return!0;x.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),x.materialDefines=new T(this._eventInfo.defineNames));const c=x.materialDefines;if(this._isReadyForSubMesh(x))return!0;const I=this.getScene(),L=I.getEngine();if(c._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,I.texturesEnabled)){if(this._albedoTexture&&t.h.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&t.h.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&t.h.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const u=this._getReflectionTexture();if(u&&t.h.ReflectionTextureEnabled){if(!u.isReadyOrNotBlocking())return!1;if(u.irradianceTexture){if(!u.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!u.sphericalPolynomial&&(null===(U=u.getInternalTexture())||void 0===U?void 0:U._sphericalPolynomialPromise))return!1}if(this._lightmapTexture&&t.h.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&t.h.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(t.h.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(L.getCaps().standardDerivatives&&this._bumpTexture&&t.h.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&t.h.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=c,this._eventInfo.subMesh=x,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(c._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;L.getCaps().standardDerivatives||u.isVerticesDataPresent(k.R.NormalKind)||(u.createNormals(!0),W.V.Warn("PBRMaterial: Normals have been created for the mesh: "+u.name));const J=x.effect,i=c._areLightsDisposed;let d=this._prepareEffect(u,c,this.onCompiled,this.onError,s,null,x.getRenderingMesh().hasThinInstances),j=!1;if(d)if(this._onEffectCreatedObservable&&(e.effect=d,e.subMesh=x,this._onEffectCreatedObservable.notifyObservers(e)),this.allowShaderHotSwapping&&J&&!d.isReady()){if(d=J,c.markAsUnprocessed(),j=this.isFrozen,i)return c._areLightsDisposed=!0,!1}else I.resetCachedMaterial(),x.setEffect(d,c,this._materialContext);return!(!x.effect||!x.effect.isReady()||(c._renderId=I.getRenderId(),_._wasPreviouslyReady=!j,_._wasPreviouslyUsingInstances=!!s,this._checkScenePerformancePriority(),0))}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(u,x,U=null,_=null,W=null,c=null,I){if(this._prepareDefines(u,x,W,c,I),!x.isDirty)return null;x.markAsProcessed();const L=this.getScene().getEngine(),J=new V.J;let i=0;x.USESPHERICALINVERTEX&&J.addFallback(i++,"USESPHERICALINVERTEX"),x.FOG&&J.addFallback(i,"FOG"),x.SPECULARAA&&J.addFallback(i,"SPECULARAA"),x.POINTSIZE&&J.addFallback(i,"POINTSIZE"),x.LOGARITHMICDEPTH&&J.addFallback(i,"LOGARITHMICDEPTH"),x.PARALLAX&&J.addFallback(i,"PARALLAX"),x.PARALLAX_RHS&&J.addFallback(i,"PARALLAX_RHS"),x.PARALLAXOCCLUSION&&J.addFallback(i++,"PARALLAXOCCLUSION"),x.ENVIRONMENTBRDF&&J.addFallback(i++,"ENVIRONMENTBRDF"),x.TANGENT&&J.addFallback(i++,"TANGENT"),x.BUMP&&J.addFallback(i++,"BUMP"),i=v.c4(x,J,this._maxSimultaneousLights,i++),x.SPECULARTERM&&J.addFallback(i++,"SPECULARTERM"),x.USESPHERICALFROMREFLECTIONMAP&&J.addFallback(i++,"USESPHERICALFROMREFLECTIONMAP"),x.USEIRRADIANCEMAP&&J.addFallback(i++,"USEIRRADIANCEMAP"),x.LIGHTMAP&&J.addFallback(i++,"LIGHTMAP"),x.NORMAL&&J.addFallback(i++,"NORMAL"),x.AMBIENT&&J.addFallback(i++,"AMBIENT"),x.EMISSIVE&&J.addFallback(i++,"EMISSIVE"),x.VERTEXCOLOR&&J.addFallback(i++,"VERTEXCOLOR"),x.MORPHTARGETS&&J.addFallback(i++,"MORPHTARGETS"),x.MULTIVIEW&&J.addFallback(0,"MULTIVIEW");const j=[k.R.PositionKind];x.NORMAL&&j.push(k.R.NormalKind),x.TANGENT&&j.push(k.R.TangentKind);for(let u=1;u<=6;++u)x["UV"+u]&&j.push(`uv${1===u?"":u}`);x.VERTEXCOLOR&&j.push(k.R.ColorKind),v.ni(j,u,x,J),v.ER(j,x),v.IF(j,u,x),v.J2(j,u,x);let r="pbr";const $=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],H=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],f=["Material","Scene","Mesh"],O={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:x.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=J,this._eventInfo.fallbackRank=i,this._eventInfo.defines=x,this._eventInfo.uniforms=$,this._eventInfo.attributes=j,this._eventInfo.samplers=H,this._eventInfo.uniformBuffersNames=f,this._eventInfo.customCode=void 0,this._eventInfo.mesh=u,this._eventInfo.indexParameters=O,this._callbackPluginEventGeneric(128,this._eventInfo),d.J.AddUniforms($),d.J.AddSamplers(H),Z.TV($),D.p&&(D.p.PrepareUniforms($,x),D.p.PrepareSamplers(H,x)),v.Bb({uniformsNames:$,uniformBuffersNames:f,samplers:H,defines:x,maxSimultaneousLights:this._maxSimultaneousLights});const t={};this.customShaderNameResolve&&(r=this.customShaderNameResolve(r,$,f,H,x,j,t));const N=x.toString(),m=L.createEffect(r,{attributes:j,uniformsNames:$,uniformBuffersNames:f,samplers:H,defines:N,fallbacks:J,onCompiled:U,onError:_,indexParameters:O,processFinalCode:t.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:x.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([s.e(8873).then(s.bind(s,308873)),s.e(88918).then(s.bind(s,788918))]):await Promise.all([s.e(60079).then(s.bind(s,60079)),s.e(99697).then(s.bind(s,499697))]),this._shadersLoaded=!0}},L);return this._eventInfo.customCode=void 0,m}_prepareDefines(u,x,s=null,U=null,_=!1){const W=this.getScene(),c=W.getEngine();v.az(W,u,x,!0,this._maxSimultaneousLights,this._disableLighting),x._needNormals=!0,v.VO(W,x);const I=this.needAlphaBlendingForMesh(u)&&this.getScene().useOrderIndependentTransparency;if(v.N4(W,x,this.canRenderToMRT&&!I),v.Nc(W,x,I),x.METALLICWORKFLOW=this.isMetallicWorkflow(),x._areTexturesDirty){x._needUVs=!1;for(let u=1;u<=6;++u)x["MAINUV"+u]=!1;if(W.texturesEnabled){x.ALBEDODIRECTUV=0,x.AMBIENTDIRECTUV=0,x.OPACITYDIRECTUV=0,x.EMISSIVEDIRECTUV=0,x.REFLECTIVITYDIRECTUV=0,x.MICROSURFACEMAPDIRECTUV=0,x.METALLIC_REFLECTANCEDIRECTUV=0,x.REFLECTANCEDIRECTUV=0,x.BUMPDIRECTUV=0,x.LIGHTMAPDIRECTUV=0,c.getCaps().textureLOD&&(x.LODBASEDMICROSFURACE=!0),this._albedoTexture&&t.h.DiffuseTextureEnabled?(v.YT(this._albedoTexture,x,"ALBEDO"),x.GAMMAALBEDO=this._albedoTexture.gammaSpace):x.ALBEDO=!1,this._ambientTexture&&t.h.AmbientTextureEnabled?(v.YT(this._ambientTexture,x,"AMBIENT"),x.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):x.AMBIENT=!1,this._opacityTexture&&t.h.OpacityTextureEnabled?(v.YT(this._opacityTexture,x,"OPACITY"),x.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):x.OPACITY=!1;const u=this._getReflectionTexture();if(u&&t.h.ReflectionTextureEnabled){switch(x.REFLECTION=!0,x.GAMMAREFLECTION=u.gammaSpace,x.RGBDREFLECTION=u.isRGBD,x.LODINREFLECTIONALPHA=u.lodLevelInAlpha,x.LINEARSPECULARREFLECTION=u.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(x.NUM_SAMPLES=""+this.realTimeFilteringQuality,c._features.needTypeSuffixInShaderConstants&&(x.NUM_SAMPLES=x.NUM_SAMPLES+"u"),x.REALTIME_FILTERING=!0):x.REALTIME_FILTERING=!1,x.INVERTCUBICMAP=u.coordinatesMode===O.g.INVCUBIC_MODE,x.REFLECTIONMAP_3D=u.isCube,x.REFLECTIONMAP_OPPOSITEZ=x.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!u.invertZ:u.invertZ,x.REFLECTIONMAP_CUBIC=!1,x.REFLECTIONMAP_EXPLICIT=!1,x.REFLECTIONMAP_PLANAR=!1,x.REFLECTIONMAP_PROJECTION=!1,x.REFLECTIONMAP_SKYBOX=!1,x.REFLECTIONMAP_SPHERICAL=!1,x.REFLECTIONMAP_EQUIRECTANGULAR=!1,x.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,x.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,u.coordinatesMode){case O.g.EXPLICIT_MODE:x.REFLECTIONMAP_EXPLICIT=!0;break;case O.g.PLANAR_MODE:x.REFLECTIONMAP_PLANAR=!0;break;case O.g.PROJECTION_MODE:x.REFLECTIONMAP_PROJECTION=!0;break;case O.g.SKYBOX_MODE:x.REFLECTIONMAP_SKYBOX=!0;break;case O.g.SPHERICAL_MODE:x.REFLECTIONMAP_SPHERICAL=!0;break;case O.g.EQUIRECTANGULAR_MODE:x.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case O.g.FIXED_EQUIRECTANGULAR_MODE:x.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case O.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:x.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case O.g.CUBIC_MODE:case O.g.INVCUBIC_MODE:default:x.REFLECTIONMAP_CUBIC=!0,x.USE_LOCAL_REFLECTIONMAP_CUBIC=!!u.boundingBoxSize}u.coordinatesMode!==O.g.SKYBOX_MODE&&(u.irradianceTexture?(x.USEIRRADIANCEMAP=!0,x.USESPHERICALFROMREFLECTIONMAP=!1):u.isCube&&(x.USESPHERICALFROMREFLECTIONMAP=!0,x.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||c.getCaps().maxVaryingVectors<=8?x.USESPHERICALINVERTEX=!1:x.USESPHERICALINVERTEX=!0))}else x.REFLECTION=!1,x.REFLECTIONMAP_3D=!1,x.REFLECTIONMAP_SPHERICAL=!1,x.REFLECTIONMAP_PLANAR=!1,x.REFLECTIONMAP_CUBIC=!1,x.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,x.REFLECTIONMAP_PROJECTION=!1,x.REFLECTIONMAP_SKYBOX=!1,x.REFLECTIONMAP_EXPLICIT=!1,x.REFLECTIONMAP_EQUIRECTANGULAR=!1,x.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,x.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,x.INVERTCUBICMAP=!1,x.USESPHERICALFROMREFLECTIONMAP=!1,x.USEIRRADIANCEMAP=!1,x.USESPHERICALINVERTEX=!1,x.REFLECTIONMAP_OPPOSITEZ=!1,x.LODINREFLECTIONALPHA=!1,x.GAMMAREFLECTION=!1,x.RGBDREFLECTION=!1,x.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&t.h.LightmapTextureEnabled?(v.YT(this._lightmapTexture,x,"LIGHTMAP"),x.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,x.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,x.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):x.LIGHTMAP=!1,this._emissiveTexture&&t.h.EmissiveTextureEnabled?(v.YT(this._emissiveTexture,x,"EMISSIVE"),x.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):x.EMISSIVE=!1,t.h.SpecularTextureEnabled?(this._metallicTexture?(v.YT(this._metallicTexture,x,"REFLECTIVITY"),x.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,x.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,x.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,x.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,x.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?(v.YT(this._reflectivityTexture,x,"REFLECTIVITY"),x.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,x.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,x.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):x.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(x.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?(v.YT(this._metallicReflectanceTexture,x,"METALLIC_REFLECTANCE"),x.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):x.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?(v.YT(this._reflectanceTexture,x,"REFLECTANCE"),x.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):x.REFLECTANCE=!1):(x.METALLIC_REFLECTANCE=!1,x.REFLECTANCE=!1),this._microSurfaceTexture?v.YT(this._microSurfaceTexture,x,"MICROSURFACEMAP"):x.MICROSURFACEMAP=!1):(x.REFLECTIVITY=!1,x.MICROSURFACEMAP=!1),c.getCaps().standardDerivatives&&this._bumpTexture&&t.h.BumpTextureEnabled&&!this._disableBumpMap?(v.YT(this._bumpTexture,x,"BUMP"),this._useParallax&&this._albedoTexture&&t.h.DiffuseTextureEnabled?(x.PARALLAX=!0,x.PARALLAX_RHS=W.useRightHandedSystem,x.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):x.PARALLAX=!1,x.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(x.BUMP=!1,x.PARALLAX=!1,x.PARALLAX_RHS=!1,x.PARALLAXOCCLUSION=!1,x.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&t.h.ReflectionTextureEnabled?(x.ENVIRONMENTBRDF=!0,x.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(x.ENVIRONMENTBRDF=!1,x.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?x.ALPHAFROMALBEDO=!0:x.ALPHAFROMALBEDO=!1}x.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===Q.LIGHTFALLOFF_STANDARD?(x.USEPHYSICALLIGHTFALLOFF=!1,x.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===Q.LIGHTFALLOFF_GLTF?(x.USEPHYSICALLIGHTFALLOFF=!1,x.USEGLTFLIGHTFALLOFF=!0):(x.USEPHYSICALLIGHTFALLOFF=!0,x.USEGLTFLIGHTFALLOFF=!1),x.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.backFaceCulling&&this._twoSidedLighting?x.TWOSIDEDLIGHTING=!0:x.TWOSIDEDLIGHTING=!1,x.SPECULARAA=c.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(x._areTexturesDirty||x._areMiscDirty)&&(x.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1==0?".":""}`,x.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,x.ALPHABLEND=this.needAlphaBlendingForMesh(u),x.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,x.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),x._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(x),x.FORCENORMALFORWARD=this._forceNormalForward,x.RADIANCEOCCLUSION=this._useRadianceOcclusion,x.HORIZONOCCLUSION=this._useHorizonOcclusion,x._areMiscDirty&&(v.fm(u,W,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(u)||this._forceAlphaTest,x,this._applyDecalMapAfterDetailMap),x.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!u.isVerticesDataPresent(k.R.NormalKind),x.DEBUGMODE=this._debugMode),v.OR(W,c,this,x,!!s,U,_),this._eventInfo.defines=x,this._eventInfo.mesh=u,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),v.qB(u,x,!0,!0,!0,this._transparencyMode!==Q.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(u,x,s){const U={clipPlane:!1,useInstances:!1,...s};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo),(()=>{if(this._breakShaderLoadedCheck)return;const s=new T(this._eventInfo.defineNames),_=this._prepareEffect(u,s,void 0,void 0,U.useInstances,U.clipPlane,u.hasThinInstances);this._onEffectCreatedObservable&&(e.effect=_,e.subMesh=null,this._onEffectCreatedObservable.notifyObservers(e)),_.isReady()?x&&x(this):_.onCompileObservable.add((()=>{x&&x(this)}))})()}buildUniformLayout(){const u=this._uniformBuffer;u.addUniform("vAlbedoInfos",2),u.addUniform("vAmbientInfos",4),u.addUniform("vOpacityInfos",2),u.addUniform("vEmissiveInfos",2),u.addUniform("vLightmapInfos",2),u.addUniform("vReflectivityInfos",3),u.addUniform("vMicroSurfaceSamplerInfos",2),u.addUniform("vReflectionInfos",2),u.addUniform("vReflectionFilteringInfo",2),u.addUniform("vReflectionPosition",3),u.addUniform("vReflectionSize",3),u.addUniform("vBumpInfos",3),u.addUniform("albedoMatrix",16),u.addUniform("ambientMatrix",16),u.addUniform("opacityMatrix",16),u.addUniform("emissiveMatrix",16),u.addUniform("lightmapMatrix",16),u.addUniform("reflectivityMatrix",16),u.addUniform("microSurfaceSamplerMatrix",16),u.addUniform("bumpMatrix",16),u.addUniform("vTangentSpaceParams",2),u.addUniform("reflectionMatrix",16),u.addUniform("vReflectionColor",3),u.addUniform("vAlbedoColor",4),u.addUniform("vLightingIntensity",4),u.addUniform("vReflectionMicrosurfaceInfos",3),u.addUniform("pointSize",1),u.addUniform("vReflectivityColor",4),u.addUniform("vEmissiveColor",3),u.addUniform("vAmbientColor",3),u.addUniform("vDebugMode",2),u.addUniform("vMetallicReflectanceFactors",4),u.addUniform("vMetallicReflectanceInfos",2),u.addUniform("metallicReflectanceMatrix",16),u.addUniform("vReflectanceInfos",2),u.addUniform("reflectanceMatrix",16),u.addUniform("vSphericalL00",3),u.addUniform("vSphericalL1_1",3),u.addUniform("vSphericalL10",3),u.addUniform("vSphericalL11",3),u.addUniform("vSphericalL2_2",3),u.addUniform("vSphericalL2_1",3),u.addUniform("vSphericalL20",3),u.addUniform("vSphericalL21",3),u.addUniform("vSphericalL22",3),u.addUniform("vSphericalX",3),u.addUniform("vSphericalY",3),u.addUniform("vSphericalZ",3),u.addUniform("vSphericalXX_ZZ",3),u.addUniform("vSphericalYY_ZZ",3),u.addUniform("vSphericalZZ",3),u.addUniform("vSphericalXY",3),u.addUniform("vSphericalYZ",3),u.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(u,x,s){var U,_,W,c;const I=this.getScene(),J=s.materialDefines;if(!J)return;const k=s.effect;if(!k)return;this._activeEffect=k,x.getMeshUniformBuffer().bindToEffect(k,"Mesh"),x.transferToEffect(u);const i=I.getEngine();this._uniformBuffer.bindToEffect(k,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,I,x,u,this.isFrozen),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),J.OBJECTSPACE_NORMALMAP&&(u.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const d=this._mustRebind(I,k,s,x.visibility);v.f$(x,this._activeEffect,this.prePassConfiguration);let D=null;const $=this._uniformBuffer;if(d){if(this.bindViewProjection(k),D=this._getReflectionTexture(),!$.useUbo||!this.isFrozen||!$.isSync||s._drawWrapper._forceRebindOnNextCall){if(I.texturesEnabled){if(this._albedoTexture&&t.h.DiffuseTextureEnabled&&($.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),v.mA(this._albedoTexture,$,"albedo")),this._ambientTexture&&t.h.AmbientTextureEnabled&&($.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),v.mA(this._ambientTexture,$,"ambient")),this._opacityTexture&&t.h.OpacityTextureEnabled&&($.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),v.mA(this._opacityTexture,$,"opacity")),D&&t.h.ReflectionTextureEnabled){if($.updateMatrix("reflectionMatrix",D.getReflectionTextureMatrix()),$.updateFloat2("vReflectionInfos",D.level,0),D.boundingBoxSize){const u=D;$.updateVector3("vReflectionPosition",u.boundingBoxPosition),$.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this.realTimeFiltering){const u=D.getSize().width;$.updateFloat2("vReflectionFilteringInfo",u,r.X.Log2(u))}if(!J.USEIRRADIANCEMAP){const u=D.sphericalPolynomial;if(J.USESPHERICALFROMREFLECTIONMAP&&u)if(J.SPHERICAL_HARMONICS){const x=u.preScaledHarmonics;$.updateVector3("vSphericalL00",x.l00),$.updateVector3("vSphericalL1_1",x.l1_1),$.updateVector3("vSphericalL10",x.l10),$.updateVector3("vSphericalL11",x.l11),$.updateVector3("vSphericalL2_2",x.l2_2),$.updateVector3("vSphericalL2_1",x.l2_1),$.updateVector3("vSphericalL20",x.l20),$.updateVector3("vSphericalL21",x.l21),$.updateVector3("vSphericalL22",x.l22)}else $.updateFloat3("vSphericalX",u.x.x,u.x.y,u.x.z),$.updateFloat3("vSphericalY",u.y.x,u.y.y,u.y.z),$.updateFloat3("vSphericalZ",u.z.x,u.z.y,u.z.z),$.updateFloat3("vSphericalXX_ZZ",u.xx.x-u.zz.x,u.xx.y-u.zz.y,u.xx.z-u.zz.z),$.updateFloat3("vSphericalYY_ZZ",u.yy.x-u.zz.x,u.yy.y-u.zz.y,u.yy.z-u.zz.z),$.updateFloat3("vSphericalZZ",u.zz.x,u.zz.y,u.zz.z),$.updateFloat3("vSphericalXY",u.xy.x,u.xy.y,u.xy.z),$.updateFloat3("vSphericalYZ",u.yz.x,u.yz.y,u.yz.z),$.updateFloat3("vSphericalZX",u.zx.x,u.zx.y,u.zx.z)}$.updateFloat3("vReflectionMicrosurfaceInfos",D.getSize().width,D.lodGenerationScale,D.lodGenerationOffset)}this._emissiveTexture&&t.h.EmissiveTextureEnabled&&($.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),v.mA(this._emissiveTexture,$,"emissive")),this._lightmapTexture&&t.h.LightmapTextureEnabled&&($.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),v.mA(this._lightmapTexture,$,"lightmap")),t.h.SpecularTextureEnabled&&(this._metallicTexture?($.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),v.mA(this._metallicTexture,$,"reflectivity")):this._reflectivityTexture&&($.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),v.mA(this._reflectivityTexture,$,"reflectivity")),this._metallicReflectanceTexture&&($.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),v.mA(this._metallicReflectanceTexture,$,"metallicReflectance")),this._reflectanceTexture&&J.REFLECTANCE&&($.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),v.mA(this._reflectanceTexture,$,"reflectance")),this._microSurfaceTexture&&($.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),v.mA(this._microSurfaceTexture,$,"microSurfaceSampler"))),this._bumpTexture&&i.getCaps().standardDerivatives&&t.h.BumpTextureEnabled&&!this._disableBumpMap&&($.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),v.mA(this._bumpTexture,$,"bump"),I._mirroredCameraPosition?$.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):$.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&$.updateFloat("pointSize",this.pointSize),J.METALLICWORKFLOW){j.IG.Color3[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,j.IG.Color3[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,$.updateColor4("vReflectivityColor",j.IG.Color3[0],1);const u=null!==(_=null===(U=this.subSurface)||void 0===U?void 0:U._indexOfRefraction)&&void 0!==_?_:1.5,x=1,s=Math.pow((u-x)/(u+x),2);this._metallicReflectanceColor.scaleToRef(s*this._metallicF0Factor,j.IG.Color3[0]);const W=this._metallicF0Factor;$.updateColor4("vMetallicReflectanceFactors",j.IG.Color3[0],W)}else $.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);$.updateColor3("vEmissiveColor",t.h.EmissiveTextureEnabled?this._emissiveColor:j.v9.BlackReadOnly),$.updateColor3("vReflectionColor",this._reflectionColor),!J.SS_REFRACTION&&(null===(W=this.subSurface)||void 0===W?void 0:W._linkRefractionWithTransparency)?$.updateColor4("vAlbedoColor",this._albedoColor,1):$.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*I.environmentIntensity,this._lightingInfos.w=this._specularIntensity,$.updateVector4("vLightingIntensity",this._lightingInfos),I.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),$.updateColor3("vAmbientColor",this._globalAmbientColor),$.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}I.texturesEnabled&&(this._albedoTexture&&t.h.DiffuseTextureEnabled&&$.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&t.h.AmbientTextureEnabled&&$.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&t.h.OpacityTextureEnabled&&$.setTexture("opacitySampler",this._opacityTexture),D&&t.h.ReflectionTextureEnabled&&(J.LODBASEDMICROSFURACE?$.setTexture("reflectionSampler",D):($.setTexture("reflectionSampler",D._lodTextureMid||D),$.setTexture("reflectionSamplerLow",D._lodTextureLow||D),$.setTexture("reflectionSamplerHigh",D._lodTextureHigh||D)),J.USEIRRADIANCEMAP&&$.setTexture("irradianceSampler",D.irradianceTexture)),J.ENVIRONMENTBRDF&&$.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&t.h.EmissiveTextureEnabled&&$.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&t.h.LightmapTextureEnabled&&$.setTexture("lightmapSampler",this._lightmapTexture),t.h.SpecularTextureEnabled&&(this._metallicTexture?$.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&$.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&$.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&J.REFLECTANCE&&$.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&$.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&i.getCaps().standardDerivatives&&t.h.BumpTextureEnabled&&!this._disableBumpMap&&$.setTexture("bumpSampler",this._bumpTexture)),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(x)&&this.getScene().depthPeelingRenderer.bind(k),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),Z.gS(this._activeEffect,this,I),this.bindEyePosition(k)}else I.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!d&&this.isFrozen||(I.lightsEnabled&&!this._disableLighting&&v.RL(I,x,this._activeEffect,J,this._maxSimultaneousLights),(I.fogEnabled&&x.applyFog&&I.fogMode!==L.Z.FOGMODE_NONE||D||this.subSurface.refractionTexture||x.receiveShadows||J.PREPASS)&&this.bindView(k),v.Yy(I,x,this._activeEffect,!0),J.NUM_MORPH_INFLUENCERS&&v.nR(x,this._activeEffect),J.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(c=x.bakedVertexAnimationManager)||void 0===c||c.bind(k,J.INSTANCES)),this._imageProcessingConfiguration.bind(this._activeEffect),v.DL(J,this._activeEffect,I)),this._afterBind(x,this._activeEffect,s),$.update()}getAnimatables(){const u=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&u.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&u.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&u.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&u.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&u.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?u.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&u.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&u.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&u.push(this._microSurfaceTexture),u}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture}getActiveTextures(){const u=super.getActiveTextures();return this._albedoTexture&&u.push(this._albedoTexture),this._ambientTexture&&u.push(this._ambientTexture),this._opacityTexture&&u.push(this._opacityTexture),this._reflectionTexture&&u.push(this._reflectionTexture),this._emissiveTexture&&u.push(this._emissiveTexture),this._reflectivityTexture&&u.push(this._reflectivityTexture),this._metallicTexture&&u.push(this._metallicTexture),this._metallicReflectanceTexture&&u.push(this._metallicReflectanceTexture),this._reflectanceTexture&&u.push(this._reflectanceTexture),this._microSurfaceTexture&&u.push(this._microSurfaceTexture),this._bumpTexture&&u.push(this._bumpTexture),this._lightmapTexture&&u.push(this._lightmapTexture),u}hasTexture(u){return!!super.hasTexture(u)||this._albedoTexture===u||this._ambientTexture===u||this._opacityTexture===u||this._reflectionTexture===u||this._emissiveTexture===u||this._reflectivityTexture===u||this._metallicTexture===u||this._metallicReflectanceTexture===u||this._reflectanceTexture===u||this._microSurfaceTexture===u||this._bumpTexture===u||this._lightmapTexture===u}setPrePassRenderer(){var u;if(!(null===(u=this.subSurface)||void 0===u?void 0:u.isScatteringEnabled))return!1;const x=this.getScene().enableSubSurfaceForPrePass();return x&&(x.enabled=!0),!0}dispose(u,x){var s,U,_,W,c,I,L,J,k,i,d,j;this._breakShaderLoadedCheck=!0,x&&(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(s=this._albedoTexture)||void 0===s||s.dispose(),null===(U=this._ambientTexture)||void 0===U||U.dispose(),null===(_=this._opacityTexture)||void 0===_||_.dispose(),null===(W=this._reflectionTexture)||void 0===W||W.dispose(),null===(c=this._emissiveTexture)||void 0===c||c.dispose(),null===(I=this._metallicTexture)||void 0===I||I.dispose(),null===(L=this._reflectivityTexture)||void 0===L||L.dispose(),null===(J=this._bumpTexture)||void 0===J||J.dispose(),null===(k=this._lightmapTexture)||void 0===k||k.dispose(),null===(i=this._metallicReflectanceTexture)||void 0===i||i.dispose(),null===(d=this._reflectanceTexture)||void 0===d||d.dispose(),null===(j=this._microSurfaceTexture)||void 0===j||j.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(u,x)}}Q.PBRMATERIAL_OPAQUE=$.i.MATERIAL_OPAQUE,Q.PBRMATERIAL_ALPHATEST=$.i.MATERIAL_ALPHATEST,Q.PBRMATERIAL_ALPHABLEND=$.i.MATERIAL_ALPHABLEND,Q.PBRMATERIAL_ALPHATESTANDBLEND=$.i.MATERIAL_ALPHATESTANDBLEND,Q.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,Q.LIGHTFALLOFF_PHYSICAL=0,Q.LIGHTFALLOFF_GLTF=1,Q.LIGHTFALLOFF_STANDARD=2,Q.ForceGLSL=!1,U.Cg([_.n1()],Q.prototype,"_imageProcessingConfiguration",void 0),U.Cg([_.$z("_markAllSubMeshesAsMiscDirty")],Q.prototype,"debugMode",void 0)},256085:(u,x,s)=>{s.d(x,{n:()=>I});var U=s(297809),_=s(760998),W=s(332290),c=s(570627);class I extends c.d{get doubleSided(){return this._twoSidedLighting}set doubleSided(u){this._twoSidedLighting!==u&&(this._twoSidedLighting=u,this.backFaceCulling=!u,this._markAllSubMeshesAsTexturesDirty())}constructor(u,x){super(u,x),this.maxSimultaneousLights=4,this.disableLighting=!1,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.emissiveColor=new W.v9(0,0,0),this.occlusionStrength=1,this.useLightmapAsShadowmap=!1,this._useAlphaFromAlbedoTexture=!0,this._useAmbientInGrayScale=!0}getClassName(){return"PBRBaseSimpleMaterial"}}U.Cg([_.lK(),_.$z("_markAllSubMeshesAsLightsDirty")],I.prototype,"maxSimultaneousLights",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsLightsDirty")],I.prototype,"disableLighting",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],I.prototype,"environmentTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapX",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],I.prototype,"invertNormalMapY",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],I.prototype,"normalTexture",void 0),U.Cg([_.jT("emissive"),_.$z("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveColor",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],I.prototype,"emissiveTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],I.prototype,"occlusionStrength",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],I.prototype,"occlusionTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],I.prototype,"alphaCutOff",void 0),U.Cg([_.lK()],I.prototype,"doubleSided",null),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty",null)],I.prototype,"lightmapTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],I.prototype,"useLightmapAsShadowmap",void 0)},40619:(u,x,s)=>{s.d(x,{a:()=>k,t:()=>i});var U=s(297809),_=s(760998),W=s(332290),c=s(591160),I=s(185537),L=s(527335),J=s(855300);class k extends L.M{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class i extends I.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"PBRClearCoat",100,new k,x),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.roughness=0,this._indexOfRefraction=i._DefaultIndexOfRefraction,this.indexOfRefraction=i._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=W.v9.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,x,s){if(!this._isEnabled)return!0;const U=this._material._disableBumpMap;if(u._areTexturesDirty&&x.texturesEnabled){if(this._texture&&c.h.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&c.h.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(s.getCaps().standardDerivatives&&this._bumpTexture&&c.h.ClearCoatBumpTextureEnabled&&!U&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&c.h.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,x){this._isEnabled?(u.CLEARCOAT=!0,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,u._areTexturesDirty&&x.texturesEnabled&&(this._texture&&c.h.ClearCoatTextureEnabled?J.YT(this._texture,u,"CLEARCOAT_TEXTURE"):u.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&c.h.ClearCoatTextureEnabled?J.YT(this._textureRoughness,u,"CLEARCOAT_TEXTURE_ROUGHNESS"):u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&c.h.ClearCoatBumpTextureEnabled?J.YT(this._bumpTexture,u,"CLEARCOAT_BUMP"):u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===i._DefaultIndexOfRefraction,this._isTintEnabled?(u.CLEARCOAT_TINT=!0,this._tintTexture&&c.h.ClearCoatTintTextureEnabled?(J.YT(this._tintTexture,u,"CLEARCOAT_TINT_TEXTURE"),u.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):u.CLEARCOAT_TINT_TEXTURE=!1):(u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1))):(u.CLEARCOAT=!1,u.CLEARCOAT_TEXTURE=!1,u.CLEARCOAT_TEXTURE_ROUGHNESS=!1,u.CLEARCOAT_BUMP=!1,u.CLEARCOAT_TINT=!1,u.CLEARCOAT_TINT_TEXTURE=!1,u.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.CLEARCOAT_DEFAULTIOR=!1,u.CLEARCOAT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,u.CLEARCOAT_BUMPDIRECTUV=0,u.CLEARCOAT_REMAP_F0=!1,u.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,u.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(u,x,s,U){var _,W,I,L,k,i,d,j;if(!this._isEnabled)return;const r=U.materialDefines,D=this._material.isFrozen,$=this._material._disableBumpMap,H=this._material._invertNormalMapX,f=this._material._invertNormalMapY;if(!u.useUbo||!D||!u.isSync){(this._texture||this._textureRoughness)&&c.h.ClearCoatTextureEnabled&&(u.updateFloat4("vClearCoatInfos",null!==(W=null===(_=this._texture)||void 0===_?void 0:_.coordinatesIndex)&&void 0!==W?W:0,null!==(L=null===(I=this._texture)||void 0===I?void 0:I.level)&&void 0!==L?L:0,null!==(i=null===(k=this._textureRoughness)||void 0===k?void 0:k.coordinatesIndex)&&void 0!==i?i:0,null!==(j=null===(d=this._textureRoughness)||void 0===d?void 0:d.level)&&void 0!==j?j:0),this._texture&&J.mA(this._texture,u,"clearCoat"),this._textureRoughness&&!r.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&J.mA(this._textureRoughness,u,"clearCoatRoughness")),this._bumpTexture&&s.getCaps().standardDerivatives&&c.h.ClearCoatTextureEnabled&&!$&&(u.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),J.mA(this._bumpTexture,u,"clearCoatBump"),x._mirroredCameraPosition?u.updateFloat2("vClearCoatTangentSpaceParams",H?1:-1,f?1:-1):u.updateFloat2("vClearCoatTangentSpaceParams",H?-1:1,f?-1:1)),this._tintTexture&&c.h.ClearCoatTintTextureEnabled&&(u.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),J.mA(this._tintTexture,u,"clearCoatTint")),u.updateFloat2("vClearCoatParams",this.intensity,this.roughness);const U=1-this._indexOfRefraction,D=1+this._indexOfRefraction,O=Math.pow(-U/D,2),t=1/this._indexOfRefraction;u.updateFloat4("vClearCoatRefractionParams",O,t,U,D),this._isTintEnabled&&(u.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),u.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}x.texturesEnabled&&(this._texture&&c.h.ClearCoatTextureEnabled&&u.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!r.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&c.h.ClearCoatTextureEnabled&&u.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&s.getCaps().standardDerivatives&&c.h.ClearCoatBumpTextureEnabled&&!$&&u.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&c.h.ClearCoatTintTextureEnabled&&u.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(u){return this._texture===u||this._textureRoughness===u||this._bumpTexture===u||this._tintTexture===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness),this._bumpTexture&&u.push(this._bumpTexture),this._tintTexture&&u.push(this._tintTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&u.push(this._tintTexture)}dispose(u){var x,s,U,_;u&&(null===(x=this._texture)||void 0===x||x.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose(),null===(U=this._bumpTexture)||void 0===U||U.dispose(),null===(_=this._tintTexture)||void 0===_||_.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(u,x,s){return u.CLEARCOAT_BUMP&&x.addFallback(s++,"CLEARCOAT_BUMP"),u.CLEARCOAT_TINT&&x.addFallback(s++,"CLEARCOAT_TINT"),u.CLEARCOAT&&x.addFallback(s++,"CLEARCOAT"),s}getSamplers(u){u.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}i._DefaultIndexOfRefraction=1.5,U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),U.Cg([_.lK()],i.prototype,"intensity",void 0),U.Cg([_.lK()],i.prototype,"roughness",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"indexOfRefraction",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"remapF0OnInterfaceChange",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isTintEnabled",void 0),U.Cg([_.jT()],i.prototype,"tintColor",void 0),U.Cg([_.lK()],i.prototype,"tintColorAtDistance",void 0),U.Cg([_.lK()],i.prototype,"tintThickness",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"tintTexture",void 0)},732789:(u,x,s)=>{s.d(x,{m:()=>J,z:()=>k});var U=s(297809),_=s(760998),W=s(591160),c=s(185537),I=s(527335),L=s(855300);class J extends I.M{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class k extends c.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"PBRIridescence",110,new J,x),this._isEnabled=!1,this.isEnabled=!1,this.intensity=1,this.minimumThickness=k._DefaultMinimumThickness,this.maximumThickness=k._DefaultMaximumThickness,this.indexOfRefraction=k._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,x){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&x.texturesEnabled){if(this._texture&&W.h.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&W.h.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,x){this._isEnabled?(u.IRIDESCENCE=!0,u._areTexturesDirty&&x.texturesEnabled&&(this._texture&&W.h.IridescenceTextureEnabled?L.YT(this._texture,u,"IRIDESCENCE_TEXTURE"):u.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&W.h.IridescenceTextureEnabled?L.YT(this._thicknessTexture,u,"IRIDESCENCE_THICKNESS_TEXTURE"):u.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(u.IRIDESCENCE=!1,u.IRIDESCENCE_TEXTURE=!1,u.IRIDESCENCE_THICKNESS_TEXTURE=!1,u.IRIDESCENCE_TEXTUREDIRECTUV=0,u.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(u,x){var s,U,_,c,I,J,k,i;if(!this._isEnabled)return;const d=this._material.isFrozen;u.useUbo&&d&&u.isSync||((this._texture||this._thicknessTexture)&&W.h.IridescenceTextureEnabled&&(u.updateFloat4("vIridescenceInfos",null!==(U=null===(s=this._texture)||void 0===s?void 0:s.coordinatesIndex)&&void 0!==U?U:0,null!==(c=null===(_=this._texture)||void 0===_?void 0:_.level)&&void 0!==c?c:0,null!==(J=null===(I=this._thicknessTexture)||void 0===I?void 0:I.coordinatesIndex)&&void 0!==J?J:0,null!==(i=null===(k=this._thicknessTexture)||void 0===k?void 0:k.level)&&void 0!==i?i:0),this._texture&&L.mA(this._texture,u,"iridescence"),this._thicknessTexture&&L.mA(this._thicknessTexture,u,"iridescenceThickness")),u.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)),x.texturesEnabled&&(this._texture&&W.h.IridescenceTextureEnabled&&u.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&W.h.IridescenceTextureEnabled&&u.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(u){return this._texture===u||this._thicknessTexture===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._thicknessTexture&&u.push(this._thicknessTexture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture)}dispose(u){var x,s;u&&(null===(x=this._texture)||void 0===x||x.dispose(),null===(s=this._thicknessTexture)||void 0===s||s.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(u,x,s){return u.IRIDESCENCE&&x.addFallback(s++,"IRIDESCENCE"),s}getSamplers(u){u.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}k._DefaultMinimumThickness=100,k._DefaultMaximumThickness=400,k._DefaultIndexOfRefraction=1.3,U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],k.prototype,"isEnabled",void 0),U.Cg([_.lK()],k.prototype,"intensity",void 0),U.Cg([_.lK()],k.prototype,"minimumThickness",void 0),U.Cg([_.lK()],k.prototype,"maximumThickness",void 0),U.Cg([_.lK()],k.prototype,"indexOfRefraction",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],k.prototype,"texture",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],k.prototype,"thicknessTexture",void 0)},212275:(u,x,s)=>{s.d(x,{f:()=>L});var U=s(297809),_=s(760998),W=s(337776),c=s(256085),I=s(310035);class L extends c.n{constructor(u,x){super(u,x),this._useRoughnessFromMetallicTextureAlpha=!1,this._useRoughnessFromMetallicTextureGreen=!0,this._useMetallnessFromMetallicTextureBlue=!0,this.metallic=1,this.roughness=1}getClassName(){return"PBRMetallicRoughnessMaterial"}clone(u){const x=W.p.Clone((()=>new L(u,this.getScene())),this);return x.id=u,x.name=u,this.clearCoat.copyTo(x.clearCoat),this.anisotropy.copyTo(x.anisotropy),this.brdf.copyTo(x.brdf),this.sheen.copyTo(x.sheen),this.subSurface.copyTo(x.subSurface),x}serialize(){const u=W.p.Serialize(this);return u.customType="BABYLON.PBRMetallicRoughnessMaterial",u.clearCoat=this.clearCoat.serialize(),u.anisotropy=this.anisotropy.serialize(),u.brdf=this.brdf.serialize(),u.sheen=this.sheen.serialize(),u.subSurface=this.subSurface.serialize(),u.iridescence=this.iridescence.serialize(),u}static Parse(u,x,s){const U=W.p.Parse((()=>new L(u.name,x)),u,x,s);return u.clearCoat&&U.clearCoat.parse(u.clearCoat,x,s),u.anisotropy&&U.anisotropy.parse(u.anisotropy,x,s),u.brdf&&U.brdf.parse(u.brdf,x,s),u.sheen&&U.sheen.parse(u.sheen,x,s),u.subSurface&&U.subSurface.parse(u.subSurface,x,s),u.iridescence&&U.iridescence.parse(u.iridescence,x,s),U}}U.Cg([_.jT(),_.$z("_markAllSubMeshesAsTexturesDirty","_albedoColor")],L.prototype,"baseColor",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],L.prototype,"baseTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],L.prototype,"metallic",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],L.prototype,"roughness",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],L.prototype,"metallicRoughnessTexture",void 0),I.Y5("BABYLON.PBRMetallicRoughnessMaterial",L)},727058:(u,x,s)=>{s.d(x,{C:()=>i,Z:()=>k});var U=s(297809),_=s(760998),W=s(332290),c=s(591160),I=s(185537),L=s(527335),J=s(855300);class k extends L.M{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class i extends I.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"Sheen",120,new k,x),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.intensity=1,this.color=W.v9.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,x){if(!this._isEnabled)return!0;if(u._areTexturesDirty&&x.texturesEnabled){if(this._texture&&c.h.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&c.h.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,x){this._isEnabled?(u.SHEEN=!0,u.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,u.SHEEN_ROUGHNESS=null!==this._roughness,u.SHEEN_ALBEDOSCALING=this._albedoScaling,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,u._areTexturesDirty&&x.texturesEnabled&&(this._texture&&c.h.SheenTextureEnabled?(J.YT(this._texture,u,"SHEEN_TEXTURE"),u.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):u.SHEEN_TEXTURE=!1,this._textureRoughness&&c.h.SheenTextureEnabled?J.YT(this._textureRoughness,u,"SHEEN_TEXTURE_ROUGHNESS"):u.SHEEN_TEXTURE_ROUGHNESS=!1)):(u.SHEEN=!1,u.SHEEN_TEXTURE=!1,u.SHEEN_TEXTURE_ROUGHNESS=!1,u.SHEEN_LINKWITHALBEDO=!1,u.SHEEN_ROUGHNESS=!1,u.SHEEN_ALBEDOSCALING=!1,u.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,u.SHEEN_GAMMATEXTURE=!1,u.SHEEN_TEXTUREDIRECTUV=0,u.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(u,x,s,U){var _,W,I,L,k,i,d,j;if(!this._isEnabled)return;const r=U.materialDefines,D=this._material.isFrozen;u.useUbo&&D&&u.isSync||((this._texture||this._textureRoughness)&&c.h.SheenTextureEnabled&&(u.updateFloat4("vSheenInfos",null!==(W=null===(_=this._texture)||void 0===_?void 0:_.coordinatesIndex)&&void 0!==W?W:0,null!==(L=null===(I=this._texture)||void 0===I?void 0:I.level)&&void 0!==L?L:0,null!==(i=null===(k=this._textureRoughness)||void 0===k?void 0:k.coordinatesIndex)&&void 0!==i?i:0,null!==(j=null===(d=this._textureRoughness)||void 0===d?void 0:d.level)&&void 0!==j?j:0),this._texture&&J.mA(this._texture,u,"sheen"),this._textureRoughness&&!r.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&J.mA(this._textureRoughness,u,"sheenRoughness")),u.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity),null!==this._roughness&&u.updateFloat("vSheenRoughness",this._roughness)),x.texturesEnabled&&(this._texture&&c.h.SheenTextureEnabled&&u.setTexture("sheenSampler",this._texture),this._textureRoughness&&!r.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&c.h.SheenTextureEnabled&&u.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(u){return this._texture===u||this._textureRoughness===u}getActiveTextures(u){this._texture&&u.push(this._texture),this._textureRoughness&&u.push(this._textureRoughness)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&u.push(this._textureRoughness)}dispose(u){var x,s;u&&(null===(x=this._texture)||void 0===x||x.dispose(),null===(s=this._textureRoughness)||void 0===s||s.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(u,x,s){return u.SHEEN&&x.addFallback(s++,"SHEEN"),s}getSamplers(u){u.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkSheenWithAlbedo",void 0),U.Cg([_.lK()],i.prototype,"intensity",void 0),U.Cg([_.jT()],i.prototype,"color",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRoughnessFromMainTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"textureRoughness",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"albedoScaling",void 0)},572322:(u,x,s)=>{s.d(x,{I:()=>j,p:()=>d});var U=s(297809),_=s(760998),W=s(332290),c=s(591160),I=s(615473),L=s(604910),J=s(185537),k=s(527335),i=s(855300);class d extends k.M{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class j extends J.y{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(u){this._scene.enableSubSurfaceForPrePass()&&u&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(u))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(u){this._volumeIndexOfRefraction=u>=1?u:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"PBRSubSurface",130,new d,x),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=W.v9.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=W.v9.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=u.getScene(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=u._dirtyCallbacks[32]}isReadyForSubMesh(u,x){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(u._areTexturesDirty&&x.texturesEnabled){if(this._thicknessTexture&&c.h.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&c.h.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&c.h.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const u=this._getRefractionTexture(x);if(u&&c.h.RefractionTextureEnabled&&!u.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(u,x){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return u.SUBSURFACE=!1,u.SS_DISPERSION=!1,u.SS_TRANSLUCENCY=!1,u.SS_SCATTERING=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,u.SS_HAS_THICKNESS=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,u.SS_REFRACTIONMAP_3D=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(u.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(u._areTexturesDirty){if(u.SUBSURFACE=!0,u.SS_DISPERSION=this._isDispersionEnabled,u.SS_TRANSLUCENCY=this._isTranslucencyEnabled,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_SCATTERING=this._isScatteringEnabled,u.SS_THICKNESSANDMASK_TEXTURE=!1,u.SS_REFRACTIONINTENSITY_TEXTURE=!1,u.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,u.SS_HAS_THICKNESS=!1,u.SS_USE_GLTF_TEXTURES=!1,u.SS_REFRACTION=!1,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,u.SS_REFRACTIONMAP_3D=!1,u.SS_GAMMAREFRACTION=!1,u.SS_RGBDREFRACTION=!1,u.SS_LINEARSPECULARREFRACTION=!1,u.SS_REFRACTIONMAP_OPPOSITEZ=!1,u.SS_LODINREFRACTIONALPHA=!1,u.SS_LINKREFRACTIONTOTRANSPARENCY=!1,u.SS_ALBEDOFORREFRACTIONTINT=!1,u.SS_ALBEDOFORTRANSLUCENCYTINT=!1,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,u.SS_USE_THICKNESS_AS_DEPTH=!1,u.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,u._areTexturesDirty&&x.texturesEnabled&&(this._thicknessTexture&&c.h.ThicknessTextureEnabled&&i.YT(this._thicknessTexture,u,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&c.h.RefractionIntensityTextureEnabled&&i.YT(this._refractionIntensityTexture,u,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&c.h.TranslucencyIntensityTextureEnabled&&i.YT(this._translucencyIntensityTexture,u,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&c.h.TranslucencyColorTextureEnabled&&i.YT(this._translucencyColorTexture,u,"SS_TRANSLUCENCYCOLOR_TEXTURE")),u.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!=0,u.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,u.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,u.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&x.texturesEnabled){const s=this._getRefractionTexture(x);s&&c.h.RefractionTextureEnabled&&(u.SS_REFRACTION=!0,u.SS_REFRACTIONMAP_3D=s.isCube,u.SS_GAMMAREFRACTION=s.gammaSpace,u.SS_RGBDREFRACTION=s.isRGBD,u.SS_LINEARSPECULARREFRACTION=s.linearSpecularLOD,u.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&s.isCube?!s.invertZ:s.invertZ,u.SS_LODINREFRACTIONALPHA=s.lodLevelInAlpha,u.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,u.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,u.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=s.isCube&&s.boundingBoxSize,u.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(u.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(u,x,s,U){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)u.updateFloat2("vThicknessParam",0,0);else{U.getRenderingMesh().getWorldMatrix().decompose(L.AA.Vector3[0]);const x=Math.max(Math.abs(L.AA.Vector3[0].x),Math.abs(L.AA.Vector3[0].y),Math.abs(L.AA.Vector3[0].z));u.updateFloat2("vThicknessParam",this.minimumThickness*x,(this.maximumThickness-this.minimumThickness)*x)}}bindForSubMesh(u,x,s,U){var _;if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const W=U.materialDefines,L=this._material.isFrozen,J=this._material.realTimeFiltering,k=W.LODBASEDMICROSFURACE,d=this._getRefractionTexture(x);if(!u.useUbo||!L||!u.isSync){if(this._thicknessTexture&&c.h.ThicknessTextureEnabled&&(u.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),i.mA(this._thicknessTexture,u,"thickness")),this._refractionIntensityTexture&&c.h.RefractionIntensityTextureEnabled&&W.SS_REFRACTIONINTENSITY_TEXTURE&&(u.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),i.mA(this._refractionIntensityTexture,u,"refractionIntensity")),this._translucencyColorTexture&&c.h.TranslucencyColorTextureEnabled&&W.SS_TRANSLUCENCYCOLOR_TEXTURE&&(u.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),i.mA(this._translucencyColorTexture,u,"translucencyColor")),this._translucencyIntensityTexture&&c.h.TranslucencyIntensityTextureEnabled&&W.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(u.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),i.mA(this._translucencyIntensityTexture,u,"translucencyIntensity")),d&&c.h.RefractionTextureEnabled){u.updateMatrix("refractionMatrix",d.getRefractionTextureMatrix());let x=1;d.isCube||d.depth&&(x=d.depth);const s=d.getSize().width,U=this.volumeIndexOfRefraction;if(u.updateFloat4("vRefractionInfos",d.level,1/U,x,this._invertRefractionY?-1:1),u.updateFloat4("vRefractionMicrosurfaceInfos",s,d.lodGenerationScale,d.lodGenerationOffset,1/this.indexOfRefraction),J&&u.updateFloat2("vRefractionFilteringInfo",s,I.X.Log2(s)),d.boundingBoxSize){const x=d;u.updateVector3("vRefractionPosition",x.boundingBoxPosition),u.updateVector3("vRefractionSize",x.boundingBoxSize)}}this._isScatteringEnabled&&u.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),u.updateColor3("vDiffusionDistance",this.diffusionDistance),u.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),u.updateColor4("vTranslucencyColor",null!==(_=this.translucencyColor)&&void 0!==_?_:this.tintColor,0),u.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),u.updateFloat("dispersion",this.dispersion)}x.texturesEnabled&&(this._thicknessTexture&&c.h.ThicknessTextureEnabled&&u.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&c.h.RefractionIntensityTextureEnabled&&W.SS_REFRACTIONINTENSITY_TEXTURE&&u.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&c.h.TranslucencyIntensityTextureEnabled&&W.SS_TRANSLUCENCYINTENSITY_TEXTURE&&u.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&c.h.TranslucencyColorTextureEnabled&&W.SS_TRANSLUCENCYCOLOR_TEXTURE&&u.setTexture("translucencyColorSampler",this._translucencyColorTexture),d&&c.h.RefractionTextureEnabled&&(k?u.setTexture("refractionSampler",d):(u.setTexture("refractionSampler",d._lodTextureMid||d),u.setTexture("refractionSamplerLow",d._lodTextureLow||d),u.setTexture("refractionSamplerHigh",d._lodTextureHigh||d))))}_getRefractionTexture(u){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?u.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(u){c.h.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&u.push(this._refractionTexture)}hasTexture(u){return this._thicknessTexture===u||this._refractionTexture===u||this._refractionIntensityTexture===u||this._translucencyIntensityTexture===u||this._translucencyColorTexture===u}hasRenderTargetTextures(){return!!(c.h.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(u){this._thicknessTexture&&u.push(this._thicknessTexture),this._refractionTexture&&u.push(this._refractionTexture),this._translucencyColorTexture&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&u.push(this._translucencyIntensityTexture)}getAnimatables(u){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&u.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&u.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&u.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&u.push(this._translucencyIntensityTexture)}dispose(u){u&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(u,x,s){return u.SS_SCATTERING&&x.addFallback(s++,"SS_SCATTERING"),u.SS_TRANSLUCENCY&&x.addFallback(s++,"SS_TRANSLUCENCY"),s}getSamplers(u){u.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isRefractionEnabled",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isTranslucencyEnabled",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isDispersionEnabled",void 0),U.Cg([_.lK(),_.$z("_markScenePrePassDirty")],j.prototype,"isScatteringEnabled",void 0),U.Cg([_.lK()],j.prototype,"_scatteringDiffusionProfileIndex",void 0),U.Cg([_.lK()],j.prototype,"refractionIntensity",void 0),U.Cg([_.lK()],j.prototype,"translucencyIntensity",void 0),U.Cg([_.lK()],j.prototype,"useAlbedoToTintRefraction",void 0),U.Cg([_.lK()],j.prototype,"useAlbedoToTintTranslucency",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"thicknessTexture",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"refractionTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"indexOfRefraction",void 0),U.Cg([_.lK()],j.prototype,"_volumeIndexOfRefraction",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"volumeIndexOfRefraction",null),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"invertRefractionY",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"linkRefractionWithTransparency",void 0),U.Cg([_.lK()],j.prototype,"minimumThickness",void 0),U.Cg([_.lK()],j.prototype,"maximumThickness",void 0),U.Cg([_.lK()],j.prototype,"useThicknessAsDepth",void 0),U.Cg([_.jT()],j.prototype,"tintColor",void 0),U.Cg([_.lK()],j.prototype,"tintColorAtDistance",void 0),U.Cg([_.lK()],j.prototype,"dispersion",void 0),U.Cg([_.jT()],j.prototype,"diffusionDistance",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useMaskFromThicknessTexture",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"refractionIntensityTexture",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"translucencyIntensityTexture",void 0),U.Cg([_.jT()],j.prototype,"translucencyColor",void 0),U.Cg([_.uM(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"translucencyColorTexture",void 0),U.Cg([_.lK(),_.$z("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useGltfStyleTextures",void 0)},205942:(u,x,s)=>{s.d(x,{F:()=>I});var U=s(948733),_=s(615473),W=s(101032),c=s(706400);s(240396),s(346124),s(90406);class I{constructor(u,x={}){this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=4096,this.hdrScale=1,this._engine=u,this.hdrScale=x.hdrScale||this.hdrScale,this.quality=x.quality||this.quality}_createRenderTarget(u){let x=0;this._engine.getCaps().textureHalfFloatRender?x=2:this._engine.getCaps().textureFloatRender&&(x=1);const s=this._engine.createRenderTargetCubeTexture(u,{format:5,type:x,createMipMaps:!0,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:1});return this._engine.updateTextureWrappingMode(s.texture,0,0,0),this._engine.updateTextureSamplingMode(3,s.texture,!0),s}_prefilterInternal(u){const x=u.getSize().width,s=_.X.ILog2(x)+1,W=this._effectWrapper.effect,c=this._createRenderTarget(x);this._effectRenderer.saveStates(),this._effectRenderer.setViewport();const I=u.getInternalTexture();I&&this._engine.updateTextureSamplingMode(3,I,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);const L=[[new U.Pq(0,0,-1),new U.Pq(0,-1,0),new U.Pq(1,0,0)],[new U.Pq(0,0,1),new U.Pq(0,-1,0),new U.Pq(-1,0,0)],[new U.Pq(1,0,0),new U.Pq(0,0,1),new U.Pq(0,1,0)],[new U.Pq(1,0,0),new U.Pq(0,0,-1),new U.Pq(0,-1,0)],[new U.Pq(1,0,0),new U.Pq(0,-1,0),new U.Pq(0,0,1)],[new U.Pq(-1,0,0),new U.Pq(0,-1,0),new U.Pq(0,0,-1)]];W.setFloat("hdrScale",this.hdrScale),W.setFloat2("vFilteringInfo",u.getSize().width,s),W.setTexture("inputTexture",u);for(let u=0;u<6;u++){W.setVector3("up",L[u][0]),W.setVector3("right",L[u][1]),W.setVector3("front",L[u][2]);for(let U=0;U<s;U++){this._engine.bindFramebuffer(c,u,void 0,void 0,!0,U),this._effectRenderer.applyEffectWrapper(this._effectWrapper);let s=Math.pow(2,(U-this._lodGenerationOffset)/this._lodGenerationScale)/x;0===U&&(s=0),W.setFloat("alphaG",s),this._effectRenderer.draw()}}this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseTexture(u._texture);const J=c.texture.type,k=c.texture.format;return c._swapAndDie(u._texture),u._texture.type=J,u._texture.format=k,u.gammaSpace=!1,u.lodGenerationOffset=this._lodGenerationOffset,u.lodGenerationScale=this._lodGenerationScale,u._prefiltered=!0,u}_createEffect(u,x){const s=[];return u.gammaSpace&&s.push("#define GAMMA_INPUT"),s.push("#define NUM_SAMPLES "+this.quality+"u"),new W.$({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:s,onCompiled:x})}isReady(u){return u.isReady()&&this._effectWrapper.effect.isReady()}prefilter(u,x=null){return this._engine._features.allowTexturePrefiltering?new Promise((s=>{this._effectRenderer=new W.J(this._engine),this._effectWrapper=this._createEffect(u),this._effectWrapper.effect.executeWhenCompiled((()=>{this._prefilterInternal(u),this._effectRenderer.dispose(),this._effectWrapper.dispose(),s(),x&&x()}))})):(c.V.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."),Promise.reject("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."))}}},882689:(u,x,s)=>{s.r(x),s.d(x,{_ENVTextureLoader:()=>_});var U=s(653505);class _{constructor(){this.supportCascades=!1}loadCubeData(u,x,s,_,W){if(Array.isArray(u))return;const c=U.cU(u);if(c){x.width=c.width,x.height=c.width;try{U.ow(x,c),U.o5(x,u,c).then((()=>{x.isReady=!0,x.onLoadedObservable.notifyObservers(x),x.onLoadedObservable.clear(),_&&_()}),(u=>{null==W||W("Can not upload environment levels",u)}))}catch(u){null==W||W("Can not upload environment file",u)}}else W&&W("Can not parse the environment file",null)}loadData(){throw".env not supported in 2d."}}},892643:(u,x,s)=>{function U(u,x){return u.endsWith(".dds")?s.e(44639).then(s.bind(s,44639)).then((u=>new u._DDSTextureLoader)):u.endsWith(".basis")?s.e(40310).then(s.bind(s,340310)).then((u=>new u._BasisTextureLoader)):u.endsWith(".env")?s.e(82689).then(s.bind(s,882689)).then((u=>new u._ENVTextureLoader)):u.endsWith(".hdr")?s.e(38410).then(s.bind(s,838410)).then((u=>new u._HDRTextureLoader)):u.endsWith(".ktx")||u.endsWith(".ktx2")||"image/ktx"===x||"image/ktx2"===x?s.e(59603).then(s.bind(s,359603)).then((u=>new u._KTXTextureLoader)):u.endsWith(".tga")?s.e(67412).then(s.bind(s,567412)).then((u=>new u._TGATextureLoader)):u.endsWith(".exr")?s.e(50883).then(s.bind(s,750883)).then((u=>new u._ExrTextureLoader)):null}s.d(x,{g:()=>U})},194373:(u,x,s)=>{s.d(x,{t:()=>i});var U=s(297809),_=s(760998),W=s(638113),c=s(604910),I=s(395726),L=s(977041),J=(s(435683),s(140699)),k=s(337776);s(269673);class i extends J.D{set hasAlpha(u){this._hasAlpha!==u&&(this._hasAlpha=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(u){this._getAlphaFromRGB!==u&&(this._getAlphaFromRGB=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(u){this._coordinatesIndex!==u&&(this._coordinatesIndex=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(u){this._coordinatesMode!==u&&(this._coordinatesMode=u,this._scene&&this._scene.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(u){this._wrapU=u}get wrapV(){return this._wrapV}set wrapV(u){this._wrapV=u}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(u){this._texture?this._texture.isCube=u:this._isCube=u}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(u){this._texture&&(this._texture.is3D=u)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(u){this._texture&&(this._texture.is2DArray=u)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(u){var x;if(this._texture){if(this._texture._gammaSpace===u)return;this._texture._gammaSpace=u}else{if(this._gammaSpace===u)return;this._gammaSpace=u}null===(x=this.getScene())||void 0===x||x.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(u){var x;u!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=u),null===(x=this.getScene())||void 0===x||x.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(u){this._texture&&(this._texture._lodGenerationOffset=u)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(u){this._texture&&(this._texture._lodGenerationScale=u)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(u){this._texture&&(this._texture._linearSpecularLOD=u)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(u){this._texture&&(this._texture._irradianceTexture=u)}get uid(){return this._uid||(this._uid=L.z()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(u,x=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=i.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new W.cP,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,u?i._IsScene(u)?this._scene=u:this._engine=u:this._scene=I.q.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=x,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return c.uq.IdentityReadOnly}getReflectionTextureMatrix(){return c.uq.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(u){}get canRescale(){return!1}_getFromCache(u,x,s,U,_,W){const c=this._getEngine();if(!c)return null;const I=c._getUseSRGBBuffer(!!_,x),L=c.getLoadedTexturesCache();for(let c=0;c<L.length;c++){const J=L[c];if(!(void 0!==_&&I!==J._useSRGBBuffer||void 0!==U&&U!==J.invertY||J.url!==u||J.generateMipMaps!==!x||s&&s!==J.samplingMode||void 0!==W&&W!==J.isCube))return J.incrementReferences(),J}return null}_rebuild(u=!1){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const u=this.getScene();u&&u.markAllMaterialsAsDirty(1)}readPixels(u=0,x=0,s=null,U=!0,_=!1,W=0,c=0,I=Number.MAX_VALUE,L=Number.MAX_VALUE){if(!this._texture)return null;const J=this._getEngine();if(!J)return null;const k=this.getSize();let i=k.width,d=k.height;0!==x&&(i/=Math.pow(2,x),d/=Math.pow(2,x),i=Math.round(i),d=Math.round(d)),I=Math.min(i,I),L=Math.min(d,L);try{return this._texture.isCube?J._readTexturePixels(this._texture,I,L,u,x,s,U,_,W,c):J._readTexturePixels(this._texture,I,L,-1,x,s,U,_,W,c)}catch(u){return null}}_readPixelsSync(u=0,x=0,s=null,U=!0,_=!1){if(!this._texture)return null;const W=this.getSize();let c=W.width,I=W.height;const L=this._getEngine();if(!L)return null;0!=x&&(c/=Math.pow(2,x),I/=Math.pow(2,x),c=Math.round(c),I=Math.round(I));try{return this._texture.isCube?L._readTexturePixelsSync(this._texture,c,I,u,x,s,U,_):L._readTexturePixelsSync(this._texture,c,I,-1,x,s,U,_)}catch(u){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const u=this._scene.textures.indexOf(this);if(u>=0&&this._scene.textures.splice(u,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const u=this._parentContainer.textures.indexOf(this);u>-1&&this._parentContainer.textures.splice(u,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(u=!1){if(!this.name&&!u)return null;const x=k.p.Serialize(this);return k.p.AppendSerializedAnimations(this,x),x}static WhenAllReady(u,x){let s=u.length;if(0!==s)for(let U=0;U<u.length;U++){const _=u[U];if(_.isReady())0==--s&&x();else{const u=_.onLoadObservable;u?u.addOnce((()=>{0==--s&&x()})):0==--s&&x()}}else x()}static _IsScene(u){return"Scene"===u.getClassName()}}i.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,U.Cg([_.lK()],i.prototype,"uniqueId",void 0),U.Cg([_.lK()],i.prototype,"name",void 0),U.Cg([_.lK()],i.prototype,"metadata",void 0),U.Cg([_.lK("hasAlpha")],i.prototype,"_hasAlpha",void 0),U.Cg([_.lK("getAlphaFromRGB")],i.prototype,"_getAlphaFromRGB",void 0),U.Cg([_.lK()],i.prototype,"level",void 0),U.Cg([_.lK("coordinatesIndex")],i.prototype,"_coordinatesIndex",void 0),U.Cg([_.lK()],i.prototype,"optimizeUVAllocation",void 0),U.Cg([_.lK("coordinatesMode")],i.prototype,"_coordinatesMode",void 0),U.Cg([_.lK()],i.prototype,"wrapU",null),U.Cg([_.lK()],i.prototype,"wrapV",null),U.Cg([_.lK()],i.prototype,"wrapR",void 0),U.Cg([_.lK()],i.prototype,"anisotropicFilteringLevel",void 0),U.Cg([_.lK()],i.prototype,"isCube",null),U.Cg([_.lK()],i.prototype,"is3D",null),U.Cg([_.lK()],i.prototype,"is2DArray",null),U.Cg([_.lK()],i.prototype,"gammaSpace",null),U.Cg([_.lK()],i.prototype,"invertZ",void 0),U.Cg([_.lK()],i.prototype,"lodLevelInAlpha",void 0),U.Cg([_.lK()],i.prototype,"lodGenerationOffset",null),U.Cg([_.lK()],i.prototype,"lodGenerationScale",null),U.Cg([_.lK()],i.prototype,"linearSpecularLOD",null),U.Cg([_.uM()],i.prototype,"irradianceTexture",null),U.Cg([_.lK()],i.prototype,"isRenderTarget",void 0)},587053:(u,x,s)=>{var U=s(906264),_=s(194373);_.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(_.t.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=U.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((u=>{this._texture._sphericalPolynomial=u,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(u){this._texture&&(this._texture._sphericalPolynomial=u)},enumerable:!0,configurable:!0})},639093:(u,x,s)=>{s.d(x,{b:()=>j});var U=s(297809),_=s(760998),W=s(898973),c=s(604910),I=s(194373),L=s(432050),J=s(310035),k=s(638113),i=s(337776);s(757634),s(109050),s(888414);const d=.8;class j extends I.t{set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const x=this.getScene();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(u){this._rotationY=u,this.setReflectionTextureMatrix(c.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(u,x,s){let U="";return u.forEach((u=>U+=u)),new j(U,x,null,s,u)}static CreateFromPrefilteredData(u,x,s=null,U=!0){const _=x.useDelayedTextureLoading;x.useDelayedTextureLoading=!1;const W=new j(u,x,null,!1,null,null,null,void 0,!0,s,U);return x.useDelayedTextureLoading=_,W}constructor(u,x,s=null,U=!1,_=null,W=null,I=null,J=5,i=!1,j=null,r=!1,D=d,$=0,H,f){var O,t,V,N,m,b,n,F,B,Z,v,y,e;super(x),this.onLoadObservable=new k.cP,this.boundingBoxPosition=c.Pq.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new c.uq,this._buffer=null,this.name=u,this.url=u,this._noMipmap=U,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=c.uq.Identity(),this.coordinatesMode=L.g.CUBIC_MODE;let T=null,Q=null;null===s||Array.isArray(s)?(this._noMipmap=U,this._format=J,this._createPolynomials=r,T=s,this._loaderOptions=H,this._useSRGBBuffer=f,this._lodScale=D,this._lodOffset=$):(T=null!==(O=s.extensions)&&void 0!==O?O:null,this._noMipmap=null!==(t=s.noMipmap)&&void 0!==t&&t,_=null!==(V=s.files)&&void 0!==V?V:null,Q=null!==(N=s.buffer)&&void 0!==N?N:null,this._format=null!==(m=s.format)&&void 0!==m?m:5,i=null!==(b=s.prefiltered)&&void 0!==b&&b,j=null!==(n=s.forcedExtension)&&void 0!==n?n:null,this._createPolynomials=null!==(F=s.createPolynomials)&&void 0!==F&&F,this._lodScale=null!==(B=s.lodScale)&&void 0!==B?B:d,this._lodOffset=null!==(Z=s.lodOffset)&&void 0!==Z?Z:0,this._loaderOptions=s.loaderOptions,this._useSRGBBuffer=s.useSRGBBuffer,W=null!==(v=s.onLoad)&&void 0!==v?v:null,I=null!==(y=s.onError)&&void 0!==y?y:null),(u||_)&&this.updateURL(u,j,W,i,I,T,null===(e=this.getScene())||void 0===e?void 0:e.useDelayedTextureLoading,_,Q)}getClassName(){return"CubeTexture"}updateURL(u,x=null,s=null,U=!1,_=null,W=null,c=!1,I=null,L=null){this.name&&!this.name.startsWith("data:")||(this.name=u),this.url=u,x&&(this._forcedExtension=x);const J=u.lastIndexOf("."),k=x||(J>-1?u.substring(J).toLowerCase():""),i=0===k.indexOf(".dds"),d=0===k.indexOf(".env"),j=0===k.indexOf(".basis");if(d?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=U,U&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),I)this._files=I;else if(j||d||i||W||(W=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,W){for(let x=0;x<W.length;x++)this._files.push(u+W[x]);this._extensions=W}this._buffer=L,c?(this.delayLoadState=4,this._delayedOnLoad=s,this._delayedOnError=_):this._loadTexture(s,_)}delayLoad(u){4===this.delayLoadState&&(u&&(this._forcedExtension=u),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(u){var x,s;if(u.updateFlag===this._textureMatrix.updateFlag)return;if(u.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(x=this.getScene())||void 0===x||x.markAllMaterialsAsDirty(1,(u=>-1!==u.getActiveTextures().indexOf(this)))),this._textureMatrix=u,!(null===(s=this.getScene())||void 0===s?void 0:s.useRightHandedSystem))return;const U=c.AA.Vector3[0],_=c.AA.Quaternion[0],W=c.AA.Vector3[1];this._textureMatrix.decompose(U,_,W),_.z*=-1,_.w*=-1,c.uq.ComposeToRef(U,_,W,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var u;return(null===(u=this.getScene())||void 0===u?void 0:u.useRightHandedSystem)?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(u=null,x=null){var s;const U=this.getScene(),_=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const c=()=>{var x;this.onLoadObservable.notifyObservers(this),_&&(_.dispose(),null===(x=this.getScene())||void 0===x||x.markAllMaterialsAsDirty(1)),u&&u()},I=(u,s)=>{this._loadingError=!0,this._errorObject={message:u,exception:s},x&&x(u,s),L.g.OnTextureLoadErrorObservable.notifyObservers(this)};this._texture?this._texture.isReady?W.S0.SetImmediate((()=>c())):this._texture.onLoadedObservable.add((()=>c())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,U,this._lodScale,this._lodOffset,u,I,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,U,this._files,this._noMipmap,u,I,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(s=this._texture)||void 0===s||s.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(u,x,s){const U=i.p.Parse((()=>{var U;let _=!1;return u.prefiltered&&(_=u.prefiltered),new j(s+(null!==(U=u.url)&&void 0!==U?U:u.name),x,u.extensions,!1,u.files||null,null,null,void 0,_,u.forcedExtension)}),u,x);if(u.boundingBoxPosition&&(U.boundingBoxPosition=c.Pq.FromArray(u.boundingBoxPosition)),u.boundingBoxSize&&(U.boundingBoxSize=c.Pq.FromArray(u.boundingBoxSize)),u.animations)for(let x=0;x<u.animations.length;x++){const s=u.animations[x],_=J.n9("BABYLON.Animation");_&&U.animations.push(_.Parse(s))}return U}clone(){let u=0;const x=i.p.Clone((()=>{const x=new j(this.url,this.getScene()||this._getEngine(),this._extensions,this._noMipmap,this._files);return u=x.uniqueId,x}),this);return x.uniqueId=u,x}}U.Cg([_.lK()],j.prototype,"url",void 0),U.Cg([_.P_()],j.prototype,"boundingBoxPosition",void 0),U.Cg([_.P_()],j.prototype,"boundingBoxSize",null),U.Cg([_.lK("rotationY")],j.prototype,"rotationY",null),U.Cg([_.lK("files")],j.prototype,"_files",void 0),U.Cg([_.lK("forcedExtension")],j.prototype,"_forcedExtension",void 0),U.Cg([_.lK("extensions")],j.prototype,"_extensions",void 0),U.Cg([_.GG("textureMatrix")],j.prototype,"_textureMatrix",void 0),U.Cg([_.GG("textureMatrixRefraction")],j.prototype,"_textureMatrixRefraction",void 0),L.g._CubeTextureParser=j.Parse,J.Y5("BABYLON.CubeTexture",j)},121669:(u,x,s)=>{s.d(x,{R:()=>W});var U=s(706400),_=s(432050);s(106960);class W extends _.g{constructor(u,x,s=null,U=!1,W=3,c=5,I){super(null,s,!U,I,W,void 0,void 0,void 0,void 0,c),this.name=u,this.wrapU=_.g.CLAMP_ADDRESSMODE,this.wrapV=_.g.CLAMP_ADDRESSMODE,this._generateMipMaps=U;const L=this._getEngine();if(!L)return;x.getContext?(this._canvas=x,this._ownCanvas=!1,this._texture=L.createDynamicTexture(x.width,x.height,U,W)):(this._canvas=L.createCanvas(1,1),this._ownCanvas=!0,x.width||0===x.width?this._texture=L.createDynamicTexture(x.width,x.height,U,W):this._texture=L.createDynamicTexture(x,x,U,W));const J=this.getSize();this._canvas.width!==J.width&&(this._canvas.width=J.width),this._canvas.height!==J.height&&(this._canvas.height=J.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(u){this._canvas.width=u.width,this._canvas.height=u.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(u.width,u.height,this._generateMipMaps,this.samplingMode)}scale(u){const x=this.getSize();x.width*=u,x.height*=u,this._recreate(x)}scaleTo(u,x){const s=this.getSize();s.width=u,s.height=x,this._recreate(s)}getContext(){return this._context}clear(u){const x=this.getSize();u&&(this._context.fillStyle=u),this._context.clearRect(0,0,x.width,x.height)}update(u,x=!1,s=!1){this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===u||u,x,this._format||void 0,void 0,s)}drawText(u,x,s,U,_,W,c,I=!0){const L=this.getSize();if(W&&(this._context.fillStyle=W,this._context.fillRect(0,0,L.width,L.height)),this._context.font=U,null==x){const s=this._context.measureText(u);x=(L.width-s.width)/2}if(null==s){const u=parseInt(U.replace(/\D/g,""));s=L.height/2+u/3.65}this._context.fillStyle=_||"",this._context.fillText(u,x,s),I&&this.update(c)}dispose(){var u,x;super.dispose(),this._ownCanvas&&(null===(x=null===(u=this._canvas)||void 0===u?void 0:u.remove)||void 0===x||x.call(u)),this._canvas=null,this._context=null}clone(){const u=this.getScene();if(!u)return this;const x=this.getSize(),s=new W(this.name,x,u,this._generateMipMaps);return s.hasAlpha=this.hasAlpha,s.level=this.level,s.wrapU=this.wrapU,s.wrapV=this.wrapV,s}serialize(){const u=this.getScene();u&&!u.isReady()&&U.V.Warn("The scene must be ready before serializing the dynamic texture");const x=super.serialize();return W._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x}static _IsCanvasElement(u){return void 0!==u.toDataURL}_rebuild(){this.update()}}},679725:(u,x,s)=>{s.d(x,{N:()=>L});var U=s(171482),_=s(194373),W=s(432050),c=s(898973),I=(s(490730),s(435683));class L extends _.t{constructor(u,x,s,U=!1,_=!0,I=null,L=null,J=!1){if(super(x),this._onLoad=null,this._onError=null,!u)throw new Error("Image url is not set");this._coordinatesMode=W.g.CUBIC_MODE,this.name=u,this.url=u,this._size=s,this._supersample=J,this._noMipmap=U,this.gammaSpace=_,this._onLoad=I,this._onError=L,this.hasAlpha=!1,this.isCube=!0,this._texture=this._getFromCache(u,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?I&&(this._texture.isReady?c.S0.SetImmediate((()=>I())):this._texture.onLoadedObservable.add(I)):x.useDelayedTextureLoading?this.delayLoadState=4:this._loadImage((()=>this._loadTexture()),this._onError)}_loadImage(u,x){const s=this.getScene();if(!s)return;const U=s.getEngine().createRawCubeTexture(null,this._size,4,s.getEngine().getCaps().textureFloat?1:7,!this._noMipmap,!1,3);U.generateMipMaps=!this._noMipmap,s.addPendingData(U),U.url=this.url,U.isReady=!1,s.getEngine()._internalTexturesCache.push(U),this._texture=U;const _=document.createElement("canvas");I.W$(this.url,(x=>{this._width=x.width,this._height=x.height,_.width=this._width,_.height=this._height;const s=_.getContext("2d");s.drawImage(x,0,0);const U=s.getImageData(0,0,x.width,x.height);this._buffer=U.data.buffer,_.remove(),u()}),((u,_)=>{s.removePendingData(U),x&&x(`${this.getClassName()} could not be loaded`,_)}),s?s.offlineProvider:null)}_loadTexture(){const u=this.getScene();if(!u)return;const x=(()=>{const u=this._getFloat32ArrayFromArrayBuffer(this._buffer),x=U.D.ConvertPanoramaToCubemap(u,this._width,this._height,this._size,this._supersample),s=[];for(let u=0;u<6;u++){const U=x[L._FacesMapping[u]];s.push(U)}return s})(),s=this._texture;u.getEngine().updateRawCubeTexture(s,x,s.format,s.type,s.invertY),s.isReady=!0,u.removePendingData(s),s.onLoadedObservable.notifyObservers(s),s.onLoadedObservable.clear(),this._onLoad&&this._onLoad()}_getFloat32ArrayFromArrayBuffer(u){const x=new DataView(u),s=new Float32Array(3*u.byteLength/4);let U=0;for(let _=0;_<u.byteLength;_++)(_+1)%4!=0&&(s[U++]=x.getUint8(_)/255);return s}getClassName(){return"EquiRectangularCubeTexture"}clone(){const u=this.getScene();if(!u)return this;const x=new L(this.url,u,this._size,this._noMipmap,this.gammaSpace);return x.level=this.level,x.wrapU=this.wrapU,x.wrapV=this.wrapV,x.coordinatesIndex=this.coordinatesIndex,x.coordinatesMode=this.coordinatesMode,x}}L._FacesMapping=["right","left","up","down","front","back"]},394899:(u,x,s)=>{s.d(x,{H:()=>r});var U=s(604910),_=s(194373),W=s(432050),c=s(843019),I=s(906264),L=s(310035),J=s(638113),k=s(898973),i=s(779908),d=s(205942),j=s(484573);s(490730),s(587053);class r extends _.t{set isBlocking(u){this._isBlocking=u}get isBlocking(){return this._isBlocking}set rotationY(u){this._rotationY=u,this.setReflectionTextureMatrix(U.uq.RotationY(this._rotationY))}get rotationY(){return this._rotationY}set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const x=this.getScene();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}constructor(u,x,s,_=!1,c=!0,I=!1,L=!1,i=null,d=null,j=!1){var r;super(x),this._generateHarmonics=!0,this._onError=null,this._isBlocking=!0,this._rotationY=0,this.boundingBoxPosition=U.Pq.Zero(),this.onLoadObservable=new J.cP,u&&(this._coordinatesMode=W.g.CUBIC_MODE,this.name=u,this.url=u,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=U.uq.Identity(),this._prefilterOnLoad=L,this._onLoad=()=>{this.onLoadObservable.notifyObservers(this),i&&i()},this._onError=d,this.gammaSpace=I,this._noMipmap=_,this._size=s,this._supersample=j,this._generateHarmonics=c,this._texture=this._getFromCache(u,this._noMipmap,void 0,void 0,void 0,this.isCube),this._texture?this._texture.isReady?k.S0.SetImmediate((()=>this._onLoad())):this._texture.onLoadedObservable.add(this._onLoad):(null===(r=this.getScene())||void 0===r?void 0:r.useDelayedTextureLoading)?this.delayLoadState=4:this._loadTexture())}getClassName(){return"HDRCubeTexture"}_loadTexture(){const u=this._getEngine(),x=u.getCaps();let s=0;if(x.textureFloat&&x.textureFloatLinearFiltering?s=1:x.textureHalfFloat&&x.textureHalfFloatLinearFiltering&&(s=2),u._features.allowTexturePrefiltering&&this._prefilterOnLoad){const x=this._onLoad,s=new d.F(u);this._onLoad=()=>{s.prefilter(this,x)}}this._texture=u.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,4,s,this._noMipmap,(u=>{this.lodGenerationOffset=0,this.lodGenerationScale=.8;const x=c.VH(u,this._size,this._supersample);if(this._generateHarmonics){const u=I.d.ConvertCubeMapToSphericalPolynomial(x);this.sphericalPolynomial=u}const U=[];let _=null,W=null;for(let u=0;u<6;u++){2===s?W=new Uint16Array(this._size*this._size*3):0===s&&(_=new Uint8Array(this._size*this._size*3));const c=x[r._FacesMapping[u]];if(this.gammaSpace||W||_)for(let u=0;u<this._size*this._size;u++)if(this.gammaSpace&&(c[3*u+0]=Math.pow(c[3*u+0],i.rv),c[3*u+1]=Math.pow(c[3*u+1],i.rv),c[3*u+2]=Math.pow(c[3*u+2],i.rv)),W&&(W[3*u+0]=j.LZ(c[3*u+0]),W[3*u+1]=j.LZ(c[3*u+1]),W[3*u+2]=j.LZ(c[3*u+2])),_){let x=Math.max(255*c[3*u+0],0),s=Math.max(255*c[3*u+1],0),U=Math.max(255*c[3*u+2],0);const W=Math.max(Math.max(x,s),U);if(W>255){const u=255/W;x*=u,s*=u,U*=u}_[3*u+0]=x,_[3*u+1]=s,_[3*u+2]=U}W?U.push(W):_?U.push(_):U.push(c)}return U}),null,this._onLoad,this._onError)}clone(){const u=new r(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return u.level=this.level,u.wrapU=this.wrapU,u.wrapV=this.wrapV,u.coordinatesIndex=this.coordinatesIndex,u.coordinatesMode=this.coordinatesMode,u}delayLoad(){4===this.delayLoadState&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this._loadTexture())}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(u){var x;this._textureMatrix=u,u.updateFlag!==this._textureMatrix.updateFlag&&u.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(x=this.getScene())||void 0===x||x.markAllMaterialsAsDirty(1,(u=>-1!==u.getActiveTextures().indexOf(this))))}dispose(){this.onLoadObservable.clear(),super.dispose()}static Parse(u,x,s){let _=null;return u.name&&!u.isRenderTarget&&(_=new r(s+u.name,x,u.size,u.noMipmap,u.generateHarmonics,u.useInGammaSpace),_.name=u.name,_.hasAlpha=u.hasAlpha,_.level=u.level,_.coordinatesMode=u.coordinatesMode,_.isBlocking=u.isBlocking),_&&(u.boundingBoxPosition&&(_.boundingBoxPosition=U.Pq.FromArray(u.boundingBoxPosition)),u.boundingBoxSize&&(_.boundingBoxSize=U.Pq.FromArray(u.boundingBoxSize)),u.rotationY&&(_.rotationY=u.rotationY)),_}serialize(){if(!this.name)return null;const u={};return u.name=this.name,u.hasAlpha=this.hasAlpha,u.isCube=!0,u.level=this.level,u.size=this._size,u.coordinatesMode=this.coordinatesMode,u.useInGammaSpace=this.gammaSpace,u.generateHarmonics=this._generateHarmonics,u.customType="BABYLON.HDRCubeTexture",u.noMipmap=this._noMipmap,u.isBlocking=this._isBlocking,u.rotationY=this._rotationY,u}}r._FacesMapping=["right","left","up","down","front","back"],L.Y5("BABYLON.HDRCubeTexture",r)},182453:(u,x,s)=>{s.d(x,{G:()=>U,h:()=>c});var U,_=s(638113),W=s(796152);(function(u){u[u["Unknown"]=0]="Unknown",u[u["Url"]=1]="Url",u[u["Temp"]=2]="Temp",u[u["Raw"]=3]="Raw",u[u["Dynamic"]=4]="Dynamic",u[u["RenderTarget"]=5]="RenderTarget",u[u["MultiRenderTarget"]=6]="MultiRenderTarget",u[u["Cube"]=7]="Cube",u[u["CubeRaw"]=8]="CubeRaw",u[u["CubePrefiltered"]=9]="CubePrefiltered",u[u["Raw3D"]=10]="Raw3D",u[u["Raw2DArray"]=11]="Raw2DArray",u[u["DepthStencil"]=12]="DepthStencil",u[u["CubeRawRGBD"]=13]="CubeRawRGBD",u[u["Depth"]=14]="Depth"})(U||(U={}));class c extends W.u{get useMipMaps(){return this.generateMipMaps}set useMipMaps(u){this.generateMipMaps=u}get uniqueId(){return this._uniqueId}_setUniqueId(u){this._uniqueId=u}getEngine(){return this._engine}get source(){return this._source}constructor(u,x,s=!1){super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new _.cP,this.onErrorObservable=new _.cP,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=u,this._source=x,this._uniqueId=c._Counter++,s||(this._hardwareTexture=u._createHardwareTexture())}incrementReferences(){this._references++}updateSize(u,x,s=1){this._engine.updateTextureDimensions(this,u,x,s),this.width=u,this.height=x,this.depth=s,this.baseWidth=u,this.baseHeight=x,this.baseDepth=s,this._size=u*x*s}_rebuild(){var u,x;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const u=this.onRebuildCallback(this),x=x=>{x._swapAndDie(this,!1),this.isReady=u.isReady};return void(u.isAsync?u.proxy.then(x):x(u.proxy))}let s;switch(this.source){case 2:case 12:case 14:break;case 1:return void(s=this._engine.createTexture(null!==(u=this._originalUrl)&&void 0!==u?u:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(u=>{u._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:s=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),s._swapAndDie(this,!1),this.isReady=!0;break;case 10:s=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),s._swapAndDie(this,!1),this.isReady=!0;break;case 11:s=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),s._swapAndDie(this,!1),this.isReady=!0;break;case 4:s=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),s._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(s=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{s._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:s=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,null!==(x=this._originalFormat)&&void 0!==x?x:this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),s._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return s=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(u=>{u&&u._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(s._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(u,x=!0){var s;null===(s=this._hardwareTexture)||void 0===s||s.setUsage(u._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),u._hardwareTexture=this._hardwareTexture,x&&(u._isRGBD=this._isRGBD),this._lodTextureHigh&&(u._lodTextureHigh&&u._lodTextureHigh.dispose(),u._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(u._lodTextureMid&&u._lodTextureMid.dispose(),u._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(u._lodTextureLow&&u._lodTextureLow.dispose(),u._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(u._irradianceTexture&&u._irradianceTexture.dispose(),u._irradianceTexture=this._irradianceTexture);const U=this._engine.getLoadedTexturesCache();let _=U.indexOf(this);-1!==_&&U.splice(_,1),_=U.indexOf(u),-1===_&&U.push(u)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}c._Counter=0},376976:(u,x,s)=>{s.d(x,{I:()=>_});var U=s(432050);s(490730);class _ extends U.g{constructor(u,x,s,_,W,c=!0,I=!1,L=3,J=0,k,i){super(null,W,!c,I,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,k),this.format=_,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==J||(L=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==J||(L=1),this._texture=this._engine.createRawTexture(u,x,s,_,c,I,L,null,J,null!=k?k:0,null!=i&&i),this.wrapU=U.g.CLAMP_ADDRESSMODE,this.wrapV=U.g.CLAMP_ADDRESSMODE)}update(u){this._getEngine().updateRawTexture(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const u=new _(null,this.getSize().width,this.getSize().height,this.format,this.getScene(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return u._texture=this._texture,this._texture.incrementReferences(),u}static CreateLuminanceTexture(u,x,s,U,W=!0,c=!1,I=3){return new _(u,x,s,1,U,W,c,I)}static CreateLuminanceAlphaTexture(u,x,s,U,W=!0,c=!1,I=3){return new _(u,x,s,2,U,W,c,I)}static CreateAlphaTexture(u,x,s,U,W=!0,c=!1,I=3){return new _(u,x,s,0,U,W,c,I)}static CreateRGBTexture(u,x,s,U,W=!0,c=!1,I=3,L=0,J=0,k=!1){return new _(u,x,s,4,U,W,c,I,L,J,k)}static CreateRGBATexture(u,x,s,U,W=!0,c=!1,I=3,L=0,J=0,k=!1){return new _(u,x,s,5,U,W,c,I,L,J,k)}static CreateRGBAStorageTexture(u,x,s,U,W=!0,c=!1,I=3,L=0,J=!1){return new _(u,x,s,5,U,W,c,I,L,1,J)}static CreateRTexture(u,x,s,W,c=!0,I=!1,L=U.g.TRILINEAR_SAMPLINGMODE,J=1){return new _(u,x,s,6,W,c,I,L,J)}static CreateRStorageTexture(u,x,s,W,c=!0,I=!1,L=U.g.TRILINEAR_SAMPLINGMODE,J=1){return new _(u,x,s,6,W,c,I,L,J,1)}}},517609:(u,x,s)=>{s.d(x,{L:()=>_});var U=s(432050);s(490730);class _ extends U.g{get depth(){return this._depth}constructor(u,x,s,_,W,c,I=!0,L=!1,J=U.g.TRILINEAR_SAMPLINGMODE,k=0,i){super(null,c,!I,L),this.format=W,this._texture=c.getEngine().createRawTexture2DArray(u,x,s,_,W,I,L,J,null,k,i),this._depth=_,this.is2DArray=!0}update(u){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,u,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(u,x,s,U,W,c=!0,I=!1,L=3,J=0){return new _(u,x,s,U,5,W,c,I,L,J)}}},888413:(u,x,s)=>{s.d(x,{$:()=>i});var U=s(638113),_=s(604910),W=s(432050),c=s(848287),I=s(809319),L=(s(68561),s(240396),s(650646),s(967872)),J=s(827627),k=s(104270);s(498083).M.prototype.setDepthStencilTexture=function(u,x){this._engine.setDepthStencilTexture(this._samplers[u],this._uniforms[u],x,u)};class i extends W.g{get renderList(){return this._renderList}set renderList(u){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),u&&(this._unObserveRenderList=L.lL(u,this._renderListHasChanged)),this._renderList=u}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(u){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(u)}set onBeforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u)}set onAfterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(u)}set onClear(u){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(u)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(u,x){let s;s=Array.isArray(u)?u:[u];for(let u=0;u<s.length;++u)for(let U=0;U<this._renderPassIds.length;++U)s[u].setMaterialForRenderPass(this._renderPassIds[U],void 0!==x?Array.isArray(x)?x[U]:x:void 0)}get isMulti(){var u,x;return null!==(x=null===(u=this._renderTarget)||void 0===u?void 0:u.isMulti)&&void 0!==x&&x}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(u){if(this._boundingBoxSize&&this._boundingBoxSize.equals(u))return;this._boundingBoxSize=u;const x=this.getScene();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var u,x;return null!==(x=null===(u=this._renderTarget)||void 0===u?void 0:u._depthStencilTexture)&&void 0!==x?x:null}constructor(u,x,s,c=!1,L=!0,J=0,k=!1,i=W.g.TRILINEAR_SAMPLINGMODE,d=!0,j=!1,r=!1,D=5,$=!1,H,f,O=!1,t=!1){var V,N,m,b,n,F,B;let Z,v=!0;if("object"==typeof c){const u=c;c=!!u.generateMipMaps,L=null===(V=u.doNotChangeAspectRatio)||void 0===V||V,J=null!==(N=u.type)&&void 0!==N?N:0,k=!!u.isCube,i=null!==(m=u.samplingMode)&&void 0!==m?m:W.g.TRILINEAR_SAMPLINGMODE,d=null===(b=u.generateDepthBuffer)||void 0===b||b,j=!!u.generateStencilBuffer,r=!!u.isMulti,D=null!==(n=u.format)&&void 0!==n?n:5,$=!!u.delayAllocation,H=u.samples,f=u.creationFlags,O=!!u.noColorAttachment,t=!!u.useSRGBBuffer,Z=u.colorAttachment,v=null!==(F=u.gammaSpace)&&void 0!==F?F:v}if(super(null,s,!c,void 0,i,void 0,void 0,void 0,void 0,D),this._unObserveRenderList=null,this._renderListHasChanged=(u,x)=>{var s;const U=this._renderList?this._renderList.length:0;(0===x&&U>0||0===U)&&(null===(s=this.getScene())||void 0===s||s.meshes.forEach((u=>{u._markSubMeshesAsLightDirty()})))},this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new U.cP,this.onAfterUnbindObservable=new U.cP,this.onBeforeRenderObservable=new U.cP,this.onAfterRenderObservable=new U.cP,this.onClearObservable=new U.cP,this.onResizeObservable=new U.cP,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=_.Pq.Zero(),!(s=this.getScene()))return;const y=this.getScene().getEngine();this._gammaSpace=v,this._coordinatesMode=W.g.PROJECTION_MODE,this.renderList=[],this.name=u,this.isRenderTarget=!0,this._initialSizeParameter=x,this._renderPassIds=[],this._isCubeData=k,this._processSizeParameter(x),this.renderPassId=this._renderPassIds[0],this._resizeObserver=y.onResizeObservable.add((()=>{})),this._generateMipMaps=!!c,this._doNotChangeAspectRatio=L,this._renderingManager=new I.m(s),this._renderingManager._useSceneAutoClearSetup=!0,r||(this._renderTargetOptions={generateMipMaps:c,type:J,format:null!==(B=this._format)&&void 0!==B?B:void 0,samplingMode:this.samplingMode,generateDepthBuffer:d,generateStencilBuffer:j,samples:H,creationFlags:f,noColorAttachment:O,useSRGBBuffer:t,colorAttachment:Z,label:this.name},this.samplingMode===W.g.NEAREST_SAMPLINGMODE&&(this.wrapU=W.g.CLAMP_ADDRESSMODE,this.wrapV=W.g.CLAMP_ADDRESSMODE),$||(k?(this._renderTarget=s.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=W.g.INVCUBIC_MODE,this._textureMatrix=_.uq.Identity()):this._renderTarget=s.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==H&&(this.samples=H)))}createDepthStencilTexture(u=0,x=!0,s=!1,U=1,_=14,W){var c;null===(c=this._renderTarget)||void 0===c||c.createDepthStencilTexture(u,x,s,U,_,W)}_releaseRenderPassId(){if(this._scene){const u=this._scene.getEngine();for(let x=0;x<this._renderPassIds.length;++x)u.releaseRenderPassId(this._renderPassIds[x])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const u=this._scene.getEngine(),x=this._isCubeData?6:this.getRenderLayers()||1;for(let s=0;s<x;++s)this._renderPassIds[s]=u.createRenderPassId(`RenderTargetTexture - ${this.name}#${s}`)}_processSizeParameter(u,x=!0){if(u.ratio){this._sizeRatio=u.ratio;const x=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(x.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(x.getRenderHeight(),this._sizeRatio)}}else this._size=u;x&&this._createRenderPassId()}get samples(){var u,x;return null!==(x=null===(u=this._renderTarget)||void 0===u?void 0:u.samples)&&void 0!==x?x:this._samples}set samples(u){this._renderTarget&&(this._samples=this._renderTarget.setSamples(u))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(u){this._refreshRate=u,this.resetRefreshCounter()}addPostProcess(u){if(!this._postProcessManager){const u=this.getScene();if(!u)return;this._postProcessManager=new c.X(u),this._postProcesses=new Array}this._postProcesses.push(u),this._postProcesses[0].autoClear=!1}clearPostProcesses(u=!1){if(this._postProcesses){if(u)for(const u of this._postProcesses)u.dispose();this._postProcesses=[]}}removePostProcess(u){if(!this._postProcesses)return;const x=this._postProcesses.indexOf(u);-1!==x&&(this._postProcesses.splice(x,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const u=this._size.layers;if(u)return u;return this._size.depth||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(u){const x=Math.max(1,this.getRenderSize()*u);this.resize(x)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(u){var x;const s=this.isCube;null===(x=this._renderTarget)||void 0===x||x.dispose(),this._renderTarget=null;const U=this.getScene();U&&(this._processSizeParameter(u,!1),this._renderTarget=s?U.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):U.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(u=!1,x=!1){this._render(u,x)}isReadyForRendering(){return this._render(!1,!1,!0)}_render(u=!1,x=!1,s=!1){var U;const _=this.getScene();if(!_)return s;const W=_.getEngine();if(void 0!==this.useCameraPostProcesses&&(u=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let u=0;u<this._waitingRenderList.length;u++){const x=this._waitingRenderList[u],s=_.getMeshById(x);s&&this.renderList.push(s)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const u=this.getScene();if(!u)return s;const x=u.meshes;for(let u=0;u<x.length;u++){const s=x[u];this.renderListPredicate(s)&&this.renderList.push(s)}}const c=W.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const I=null!==(U=this.activeCamera)&&void 0!==U?U:_.activeCamera,L=_.activeCamera;I&&(I!==_.activeCamera&&(_.setTransformMatrix(I.getViewMatrix(),I.getProjectionMatrix(!0)),_.activeCamera=I),W.setViewport(I.rigParent?I.rigParent.viewport:I.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let J=s;if(s){_.getViewMatrix()||_.updateTransformMatrix();const u=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let x=0;x<u&&J;x++){let u=null;const U=this.renderList?this.renderList:_.getActiveMeshes().data,c=this.renderList?this.renderList.length:_.getActiveMeshes().length;W.currentRenderPassId=this._renderPassIds[x],this.onBeforeRenderObservable.notifyObservers(x),this.getCustomRenderList&&(u=this.getCustomRenderList(x,U,c)),u||(u=U),this._doNotChangeAspectRatio||_.updateTransformMatrix(!0);for(let x=0;x<u.length&&J;++x){const U=u[x];if(U.isEnabled()&&!U.isBlocked&&U.isVisible&&U.subMeshes)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(U,this.refreshRate,s)){J=!1;continue}}else if(!U.isReady(!0)){J=!1;continue}}this.onAfterRenderObservable.notifyObservers(x),(this.is2DArray||this.is3D||this.isCube)&&(_.incrementRenderId(),_.resetCachedMaterial())}}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let s=0;s<6;s++)this._renderToTarget(s,u,x,void 0,I),_.incrementRenderId(),_.resetCachedMaterial();else this._renderToTarget(0,u,x,void 0,I);else for(let s=0;s<this.getRenderLayers();s++)this._renderToTarget(0,u,x,s,I),_.incrementRenderId(),_.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),W.currentRenderPassId=c,L&&(_.activeCamera=L,this.activeCamera&&this.activeCamera!==_.activeCamera&&_.setTransformMatrix(_.activeCamera.getViewMatrix(),_.activeCamera.getProjectionMatrix(!0)),W.setViewport(_.activeCamera.viewport)),_.resetCachedMaterial(),J}_bestReflectionRenderTargetDimension(u,x){const s=128,U=u*x,_=k.OG(U+s*s/(s+U));return Math.min(k.C4(u),_)}_prepareRenderingManager(u,x,s,U){const _=this.getScene();if(!_)return;this._renderingManager.reset();const W=_.getRenderId();for(let c=0;c<x;c++){const x=u[c];if(x&&!x.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(x,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!x.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!x._internalAbstractMeshDataInfo._currentLODIsUpToDate&&_.activeCamera&&(x._internalAbstractMeshDataInfo._currentLOD=_.customLODSelector?_.customLODSelector(x,this.activeCamera||_.activeCamera):x.getLOD(this.activeCamera||_.activeCamera),x._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!x._internalAbstractMeshDataInfo._currentLOD)continue;let u,c=x._internalAbstractMeshDataInfo._currentLOD;if(c._preActivateForIntermediateRendering(W),u=!(!U||!s||x.layerMask&s.layerMask),x.isEnabled()&&x.isVisible&&x.subMeshes&&!u){if(c!==x&&c._activate(W,!0),x._activate(W,!0)&&x.subMeshes.length){x.isAnInstance?x._internalAbstractMeshDataInfo._actAsRegularMesh&&(c=x):c._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,c._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(let u=0;u<c.subMeshes.length;u++){const x=c.subMeshes[u];this._renderingManager.dispatch(x,c)}}x._postActivate()}}}for(let u=0;u<_.particleSystems.length;u++){const x=_.particleSystems[u],s=x.emitter;x.isStarted()&&s&&(!s.position||s.isEnabled())&&this._renderingManager.dispatchParticles(x)}}_bindFrameBuffer(u=0,x=0){const s=this.getScene();if(!s)return;const U=s.getEngine();this._renderTarget&&U.bindFramebuffer(this._renderTarget,this.isCube?u:void 0,void 0,void 0,this.ignoreCameraViewport,0,x)}_unbindFrameBuffer(u,x){this._renderTarget&&u.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(x)}))}_prepareFrame(u,x,s,U){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):U&&u.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(x,s)}_renderToTarget(u,x,s,U=0,_=null){var W,c,I,L,k,i;const d=this.getScene();if(!d)return;const j=d.getEngine();if(null===(W=j._debugPushGroup)||void 0===W||W.call(j,`render to face #${u} layer #${U}`,1),this._prepareFrame(d,u,U,x),this.is2DArray||this.is3D?(j.currentRenderPassId=this._renderPassIds[U],this.onBeforeRenderObservable.notifyObservers(U)):(j.currentRenderPassId=this._renderPassIds[u],this.onBeforeRenderObservable.notifyObservers(u)),j.snapshotRendering&&1===j.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(j):this.skipInitialClear||j.clear(this.clearColor||d.clearColor,!0,!0,!0);else{let W=null;const i=this.renderList?this.renderList:d.getActiveMeshes().data,r=this.renderList?this.renderList.length:d.getActiveMeshes().length;this.getCustomRenderList&&(W=this.getCustomRenderList(this.is2DArray||this.is3D?U:u,i,r)),W?this._prepareRenderingManager(W,W.length,_,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(i,r,_,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),W=i);for(const x of d._beforeRenderTargetClearStage)x.action(this,u,U);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(j):this.skipInitialClear||j.clear(this.clearColor||d.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0);for(const x of d._beforeRenderTargetDrawStage)x.action(this,u,U);this._renderingManager.render(this.customRenderFunction,W,this.renderParticles,this.renderSprites);for(const x of d._afterRenderTargetDrawStage)x.action(this,u,U);const D=null!==(I=null===(c=this._texture)||void 0===c?void 0:c.generateMipMaps)&&void 0!==I&&I;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,null!==(L=this._renderTarget)&&void 0!==L?L:void 0,u,this._postProcesses,this.ignoreCameraViewport):x&&d.postProcessManager._finalizeFrame(!1,null!==(k=this._renderTarget)&&void 0!==k?k:void 0,u);for(const x of d._afterRenderTargetPostProcessStage)x.action(this,u,U);this._texture&&(this._texture.generateMipMaps=D),this._doNotChangeAspectRatio||d.updateTransformMatrix(!0),s&&J.yp(this.getRenderWidth(),this.getRenderHeight(),j)}this._unbindFrameBuffer(j,u),this._texture&&this.isCube&&5===u&&j.generateMipMapsForCubemap(this._texture,!0),null===(i=j._debugPopGroup)||void 0===i||i.call(j,1)}setRenderingOrder(u,x=null,s=null,U=null){this._renderingManager.setRenderingOrder(u,x,s,U)}setRenderingAutoClearDepthStencil(u,x){this._renderingManager.setRenderingAutoClearDepthStencil(u,x),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const u=this.getSize(),x=new i(this.name,u,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return x.hasAlpha=this.hasAlpha,x.level=this.level,x.coordinatesMode=this.coordinatesMode,this.renderList&&(x.renderList=this.renderList.slice(0)),x}serialize(){if(!this.name)return null;const u=super.serialize();if(u.renderTargetSize=this.getRenderSize(),u.renderList=[],this.renderList)for(let x=0;x<this.renderList.length;x++)u.renderList.push(this.renderList[x].id);return u}disposeFramebufferObjects(){var u;null===(u=this._renderTarget)||void 0===u||u.dispose(!0)}releaseInternalTexture(){var u;null===(u=this._renderTarget)||void 0===u||u.releaseTextures(),this._texture=null}dispose(){var u;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const x=this.getScene();if(!x)return;let s=x.customRenderTargets.indexOf(this);s>=0&&x.customRenderTargets.splice(s,1);for(const u of x.cameras)s=u.customRenderTargets.indexOf(this),s>=0&&u.customRenderTargets.splice(s,1);null===(u=this._renderTarget)||void 0===u||u.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===i.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=i.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}i.REFRESHRATE_RENDER_ONCE=0,i.REFRESHRATE_RENDER_ONEVERYFRAME=1,i.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,W.g._CreateRenderTargetTexture=(u,x,s,U,_)=>new i(u,x,s,U)},432050:(u,x,s)=>{s.d(x,{g:()=>H});var U=s(297809),_=s(760998),W=s(638113),c=s(604910),I=s(194373),L=s(310035),J=s(554014),k=s(602187),i=s(862e3),d=s(298039),j=s(711210),r=s(393518),D=s(158548),$=s(337776);class H extends I.t{static _CreateVideoTexture(u,x,s,U=!1,_=!1,W=H.TRILINEAR_SAMPLINGMODE,c={},I,L=5){throw J.n("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(u){this._isBlocking=u}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(u,x,s,U,_=H.TRILINEAR_SAMPLINGMODE,c=null,I=null,L=null,J=!1,i,d,j,r,$){var f,O,t,V,N,m,b,n,F,B;let Z;super(x),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new W.cP,this._isBlocking=!0,this.name=u||"",this.url=u;let v=!1,y=null,e=!0;"object"==typeof s&&null!==s?(Z=null!==(f=s.noMipmap)&&void 0!==f&&f,U=null!==(O=s.invertY)&&void 0!==O?O:!D.rX,_=null!==(t=s.samplingMode)&&void 0!==t?t:H.TRILINEAR_SAMPLINGMODE,c=null!==(V=s.onLoad)&&void 0!==V?V:null,I=null!==(N=s.onError)&&void 0!==N?N:null,L=null!==(m=s.buffer)&&void 0!==m?m:null,J=null!==(b=s.deleteBuffer)&&void 0!==b&&b,i=s.format,d=s.mimeType,j=s.loaderOptions,r=s.creationFlags,v=null!==(n=s.useSRGBBuffer)&&void 0!==n&&n,y=null!==(F=s.internalTexture)&&void 0!==F?F:null,e=null!==(B=s.gammaSpace)&&void 0!==B?B:e):Z=!!s,this._gammaSpace=e,this._noMipmap=Z,this._invertY=void 0===U?!D.rX:U,this._initialSamplingMode=_,this._buffer=L,this._deleteBuffer=J,this._mimeType=d,this._loaderOptions=j,this._creationFlags=r,this._useSRGBBuffer=v,this._forcedExtension=$,i&&(this._format=i);const T=this.getScene(),Q=this._getEngine();if(!Q)return;Q.onBeforeTextureInitObservable.notifyObservers(this);const E=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),c&&c(),!this.isBlocking&&T&&T.resetCachedMaterial()},l=(u,x)=>{this._loadingError=!0,this._errorObject={message:u,exception:x},I&&I(u,x),H.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!y)return this._delayedOnLoad=E,void(this._delayedOnError=l);if(this._texture=null!=y?y:this._getFromCache(this.url,Z,_,this._invertY,v,this.isCube),this._texture)if(this._texture.isReady)k._.SetImmediate((()=>E()));else{const u=this._texture.onLoadedObservable.add(E);this._texture.onErrorObservable.add((x=>{var s;l(x.message,x.exception),null===(s=this._texture)||void 0===s||s.onLoadedObservable.remove(u)}))}else if(T&&T.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=E,this._delayedOnError=l;else{try{this._texture=Q.createTexture(this.url,Z,this._invertY,T,_,E,l,this._buffer,void 0,this._format,this._forcedExtension,d,j,r,v)}catch(u){throw l("error loading",u),u}J&&(this._buffer=null)}}updateURL(u,x=null,s,U){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(u=>u.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=u),this.url=u,this._buffer=x,this._forcedExtension=U,this.delayLoadState=4,s&&(this._delayedOnLoad=s),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const u=this.getScene();u&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?k._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=u.getEngine().createTexture(this.url,this._noMipmap,this._invertY,u,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(u,x,s,U){u*=this._cachedUScale,x*=this._cachedVScale,u-=this.uRotationCenter*this._cachedUScale,x-=this.vRotationCenter*this._cachedVScale,s-=this.wRotationCenter,c.Pq.TransformCoordinatesFromFloatsToRef(u,x,s,this._rowGenerationMatrix,U),U.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,U.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,U.z+=this.wRotationCenter}getTextureMatrix(u=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*u===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*u,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=c.uq.Zero(),this._rowGenerationMatrix=new c.uq,this._t0=c.Pq.Zero(),this._t1=c.Pq.Zero(),this._t2=c.Pq.Zero()),c.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(c.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,c.AA.Matrix[0]),c.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,c.AA.Matrix[1]),c.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,c.AA.Matrix[2]),c.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,c.AA.Matrix[3]),c.AA.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(c.AA.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(c.AA.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(c.AA.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),c.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const x=this.getScene();if(!x)return this._cachedTextureMatrix;const s=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&s!==this._cachedIdentity3x2&&x.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const u=this.getScene();if(!u)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==H.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===u.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=c.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=c.uq.Zero());const x=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case H.PLANAR_MODE:c.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case H.PROJECTION_MODE:{c.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const x=u.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=x.updateFlag,x.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:c.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return x&&u.markAllMaterialsAsDirty(1,(u=>u.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const u={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return $.p.Clone((()=>new H(this._texture?this._texture.url:null,this.getScene(),u)),this)}serialize(){var u,x;const s=this.name;H.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const U=super.serialize(H._SerializeInternalTextureUniqueId);return U?((H.SerializeBuffers||H.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(U.base64String=this._buffer,U.name=U.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?U.base64String="data:image/png;base64,"+j.EL(this._buffer):(H.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(U.base64String=!this._engine||this._engine._features.supportSyncTextureRead?r.lP(this):r.nh(this))),U.invertY=this._invertY,U.samplingMode=this.samplingMode,U._creationFlags=this._creationFlags,U._useSRGBBuffer=this._useSRGBBuffer,H._SerializeInternalTextureUniqueId&&(U.internalTextureUniqueId=null!==(x=null===(u=this._texture)||void 0===u?void 0:u.uniqueId)&&void 0!==x?x:void 0),U.noMipmap=this._noMipmap,this.name=s,U):null}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(u,x,s){if(u.customType){const U=i.n.Instantiate(u.customType).Parse(u,x,s);return u.samplingMode&&U.updateSamplingMode&&U._samplingMode&&U._samplingMode!==u.samplingMode&&U.updateSamplingMode(u.samplingMode),U}if(u.isCube&&!u.isRenderTarget)return H._CubeTextureParser(u,x,s);const U=void 0!==u.internalTextureUniqueId;if(!u.name&&!u.isRenderTarget&&!U)return null;let _;if(U){const s=x.getEngine().getLoadedTexturesCache();for(const x of s)if(x.uniqueId===u.internalTextureUniqueId){_=x;break}}const W=x=>{var s;if(x&&x._texture&&(x._texture._cachedWrapU=null,x._texture._cachedWrapV=null,x._texture._cachedWrapR=null),u.samplingMode){const s=u.samplingMode;x&&x.samplingMode!==s&&x.updateSamplingMode(s)}if(x&&u.animations)for(let s=0;s<u.animations.length;s++){const U=u.animations[s],_=L.n9("BABYLON.Animation");_&&x.animations.push(_.Parse(U))}U&&!_&&(null===(s=null==x?void 0:x._texture)||void 0===s||s._setUniqueId(u.internalTextureUniqueId))};return $.p.Parse((()=>{var U,c,I;let L=!0;if(u.noMipmap&&(L=!1),u.mirrorPlane){const s=H._CreateMirror(u.name,u.renderTargetSize,x,L);return s._waitingRenderList=u.renderList,s.mirrorPlane=d.Z.FromArray(u.mirrorPlane),W(s),s}if(u.isRenderTarget){let s=null;if(u.isCube){if(x.reflectionProbes)for(let s=0;s<x.reflectionProbes.length;s++){const U=x.reflectionProbes[s];if(U.name===u.name)return U.cubeTexture}}else s=H._CreateRenderTargetTexture(u.name,u.renderTargetSize,x,L,null!==(U=u._creationFlags)&&void 0!==U?U:0),s._waitingRenderList=u.renderList;return W(s),s}if(u.isVideo){const U=H._CreateVideoTexture(s+(u.url||u.name),s+(u.src||u.url),x,L,u.invertY,u.samplingMode,u.settings||{});return W(U),U}{let U;if(u.base64String&&!_)U=H.CreateFromBase64String(u.base64String,u.base64String,x,!L,u.invertY,u.samplingMode,(()=>{W(U)}),null!==(c=u._creationFlags)&&void 0!==c?c:0,null!==(I=u._useSRGBBuffer)&&void 0!==I&&I),U.name=u.name;else{let c;c=u.name&&(u.name.indexOf("://")>0||u.name.startsWith("data:"))?u.name:s+u.name,u.url&&(u.url.startsWith("data:")||H.UseSerializedUrlIfAny)&&(c=u.url);const I={noMipmap:!L,invertY:u.invertY,samplingMode:u.samplingMode,onLoad:()=>{W(U)},internalTexture:_};U=new H(c,x,I)}return U}}),u,x)}static CreateFromBase64String(u,x,s,U,_,W=H.TRILINEAR_SAMPLINGMODE,c=null,I=null,L=5,J,k){return new H("data:"+x,s,U,_,W,c,I,u,!1,L,void 0,void 0,J,k)}static LoadFromDataString(u,x,s,U=!1,_,W=!0,c=H.TRILINEAR_SAMPLINGMODE,I=null,L=null,J=5,k,i){return"data:"!==u.substr(0,5)&&(u="data:"+u),new H(u,s,_,W,c,I,L,x,U,J,void 0,void 0,k,i)}}H.SerializeBuffers=!0,H.ForceSerializeBuffers=!1,H.OnTextureLoadErrorObservable=new W.cP,H._SerializeInternalTextureUniqueId=!1,H._CubeTextureParser=(u,x,s)=>{throw J.n("CubeTexture")},H._CreateMirror=(u,x,s,U)=>{throw J.n("MirrorTexture")},H._CreateRenderTargetTexture=(u,x,s,U,_)=>{throw J.n("RenderTargetTexture")},H.NEAREST_SAMPLINGMODE=1,H.NEAREST_NEAREST_MIPLINEAR=8,H.BILINEAR_SAMPLINGMODE=2,H.LINEAR_LINEAR_MIPNEAREST=11,H.TRILINEAR_SAMPLINGMODE=3,H.LINEAR_LINEAR_MIPLINEAR=3,H.NEAREST_NEAREST_MIPNEAREST=4,H.NEAREST_LINEAR_MIPNEAREST=5,H.NEAREST_LINEAR_MIPLINEAR=6,H.NEAREST_LINEAR=7,H.NEAREST_NEAREST=1,H.LINEAR_NEAREST_MIPNEAREST=9,H.LINEAR_NEAREST_MIPLINEAR=10,H.LINEAR_LINEAR=2,H.LINEAR_NEAREST=12,H.EXPLICIT_MODE=0,H.SPHERICAL_MODE=1,H.PLANAR_MODE=2,H.CUBIC_MODE=3,H.PROJECTION_MODE=4,H.SKYBOX_MODE=5,H.INVCUBIC_MODE=6,H.EQUIRECTANGULAR_MODE=7,H.FIXED_EQUIRECTANGULAR_MODE=8,H.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,H.CLAMP_ADDRESSMODE=0,H.WRAP_ADDRESSMODE=1,H.MIRROR_ADDRESSMODE=2,H.UseSerializedUrlIfAny=!0,U.Cg([_.lK()],H.prototype,"url",void 0),U.Cg([_.lK()],H.prototype,"uOffset",void 0),U.Cg([_.lK()],H.prototype,"vOffset",void 0),U.Cg([_.lK()],H.prototype,"uScale",void 0),U.Cg([_.lK()],H.prototype,"vScale",void 0),U.Cg([_.lK()],H.prototype,"uAng",void 0),U.Cg([_.lK()],H.prototype,"vAng",void 0),U.Cg([_.lK()],H.prototype,"wAng",void 0),U.Cg([_.lK()],H.prototype,"uRotationCenter",void 0),U.Cg([_.lK()],H.prototype,"vRotationCenter",void 0),U.Cg([_.lK()],H.prototype,"wRotationCenter",void 0),U.Cg([_.lK()],H.prototype,"homogeneousRotationInUVTransform",void 0),U.Cg([_.lK()],H.prototype,"isBlocking",null),L.Y5("BABYLON.Texture",H),$.p._TextureParser=H.Parse},796152:(u,x,s)=>{s.d(x,{u:()=>U});class U{get wrapU(){return this._cachedWrapU}set wrapU(u){this._cachedWrapU=u}get wrapV(){return this._cachedWrapV}set wrapV(u){this._cachedWrapV=u}get wrapR(){return this._cachedWrapR}set wrapR(u){this._cachedWrapR=u}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(u){this._cachedAnisotropicFilteringLevel=u}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(u){this._comparisonFunction=u}get useMipMaps(){return this._useMipMaps}set useMipMaps(u){this._useMipMaps=u}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(u=1,x=1,s=1,U=1,_=2,W=0){return this._cachedWrapU=u,this._cachedWrapV=x,this._cachedWrapR=s,this._cachedAnisotropicFilteringLevel=U,this.samplingMode=_,this._comparisonFunction=W,this}compareSampler(u){return this._cachedWrapU===u._cachedWrapU&&this._cachedWrapV===u._cachedWrapV&&this._cachedWrapR===u._cachedWrapR&&this._cachedAnisotropicFilteringLevel===u._cachedAnisotropicFilteringLevel&&this.samplingMode===u.samplingMode&&this._comparisonFunction===u._comparisonFunction&&this._useMipMaps===u._useMipMaps}}},140699:(u,x,s)=>{s.d(x,{D:()=>_});var U=s(500556);class _{get wrapU(){return this._wrapU}set wrapU(u){this._wrapU=u}get wrapV(){return this._wrapV}set wrapV(u){this._wrapV=u}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(u){this._texture&&(this._texture.isCube=u)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(u){this._texture&&(this._texture.is3D=u)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(u){this._texture&&(this._texture.is2DArray=u)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(u){return void 0!==(null==u?void 0:u.shareDepth)}constructor(u){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=U.o.Zero(),this._cachedBaseSize=U.o.Zero(),this._initialSamplingMode=2,this._texture=_._IsRenderTargetWrapper(u)?u.texture:u,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(u){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(u,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}},651577:(u,x,s)=>{function U(u){-1===u.indexOf("vClipPlane")&&u.push("vClipPlane"),-1===u.indexOf("vClipPlane2")&&u.push("vClipPlane2"),-1===u.indexOf("vClipPlane3")&&u.push("vClipPlane3"),-1===u.indexOf("vClipPlane4")&&u.push("vClipPlane4"),-1===u.indexOf("vClipPlane5")&&u.push("vClipPlane5"),-1===u.indexOf("vClipPlane6")&&u.push("vClipPlane6")}function _(u,x,s){var U,_,W,c,I,L;const J=!!(null!==(U=u.clipPlane)&&void 0!==U?U:x.clipPlane),k=!!(null!==(_=u.clipPlane2)&&void 0!==_?_:x.clipPlane2),i=!!(null!==(W=u.clipPlane3)&&void 0!==W?W:x.clipPlane3),d=!!(null!==(c=u.clipPlane4)&&void 0!==c?c:x.clipPlane4),j=!!(null!==(I=u.clipPlane5)&&void 0!==I?I:x.clipPlane5),r=!!(null!==(L=u.clipPlane6)&&void 0!==L?L:x.clipPlane6);J&&s.push("#define CLIPPLANE"),k&&s.push("#define CLIPPLANE2"),i&&s.push("#define CLIPPLANE3"),d&&s.push("#define CLIPPLANE4"),j&&s.push("#define CLIPPLANE5"),r&&s.push("#define CLIPPLANE6")}function W(u,x,s){var U,_,W,c,I,L;let J=!1;const k=!!(null!==(U=u.clipPlane)&&void 0!==U?U:x.clipPlane),i=!!(null!==(_=u.clipPlane2)&&void 0!==_?_:x.clipPlane2),d=!!(null!==(W=u.clipPlane3)&&void 0!==W?W:x.clipPlane3),j=!!(null!==(c=u.clipPlane4)&&void 0!==c?c:x.clipPlane4),r=!!(null!==(I=u.clipPlane5)&&void 0!==I?I:x.clipPlane5),D=!!(null!==(L=u.clipPlane6)&&void 0!==L?L:x.clipPlane6);return s["CLIPPLANE"]!==k&&(s["CLIPPLANE"]=k,J=!0),s["CLIPPLANE2"]!==i&&(s["CLIPPLANE2"]=i,J=!0),s["CLIPPLANE3"]!==d&&(s["CLIPPLANE3"]=d,J=!0),s["CLIPPLANE4"]!==j&&(s["CLIPPLANE4"]=j,J=!0),s["CLIPPLANE5"]!==r&&(s["CLIPPLANE5"]=r,J=!0),s["CLIPPLANE6"]!==D&&(s["CLIPPLANE6"]=D,J=!0),J}function c(u,x,s){var U,_,W,c,L,J;let k=null!==(U=x.clipPlane)&&void 0!==U?U:s.clipPlane;I(u,"vClipPlane",k),k=null!==(_=x.clipPlane2)&&void 0!==_?_:s.clipPlane2,I(u,"vClipPlane2",k),k=null!==(W=x.clipPlane3)&&void 0!==W?W:s.clipPlane3,I(u,"vClipPlane3",k),k=null!==(c=x.clipPlane4)&&void 0!==c?c:s.clipPlane4,I(u,"vClipPlane4",k),k=null!==(L=x.clipPlane5)&&void 0!==L?L:s.clipPlane5,I(u,"vClipPlane5",k),k=null!==(J=x.clipPlane6)&&void 0!==J?J:s.clipPlane6,I(u,"vClipPlane6",k)}function I(u,x,s){s&&u.setFloat4(x,s.normal.x,s.normal.y,s.normal.z,s.d)}s.d(x,{Eq:()=>W,TV:()=>U,gS:()=>c,tv:()=>_})},844468:(u,x,s)=>{function U(u){u.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}s.d(x,{B:()=>U})},87639:(u,x,s)=>{s.d(x,{Q:()=>L});var U=s(297809),_=s(760998),W=s(332290),c=s(337776),I=s(844468);class L{constructor(){this._dirty=!0,this._tempColor=new W.ov(0,0,0,0),this._globalCurve=new W.ov(0,0,0,0),this._highlightsCurve=new W.ov(0,0,0,0),this._midtonesCurve=new W.ov(0,0,0,0),this._shadowsCurve=new W.ov(0,0,0,0),this._positiveCurve=new W.ov(0,0,0,0),this._negativeCurve=new W.ov(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(u){this._globalHue=u,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(u){this._globalDensity=u,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(u){this._globalSaturation=u,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(u){this._globalExposure=u,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(u){this._highlightsHue=u,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(u){this._highlightsDensity=u,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(u){this._highlightsSaturation=u,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(u){this._highlightsExposure=u,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(u){this._midtonesHue=u,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(u){this._midtonesDensity=u,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(u){this._midtonesSaturation=u,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(u){this._midtonesExposure=u,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(u){this._shadowsHue=u,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(u){this._shadowsDensity=u,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(u){this._shadowsSaturation=u,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(u){this._shadowsExposure=u,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(u,x,s="vCameraColorCurvePositive",U="vCameraColorCurveNeutral",_="vCameraColorCurveNegative"){u._dirty&&(u._dirty=!1,u._getColorGradingDataToRef(u._globalHue,u._globalDensity,u._globalSaturation,u._globalExposure,u._globalCurve),u._getColorGradingDataToRef(u._highlightsHue,u._highlightsDensity,u._highlightsSaturation,u._highlightsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._highlightsCurve),u._getColorGradingDataToRef(u._midtonesHue,u._midtonesDensity,u._midtonesSaturation,u._midtonesExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._midtonesCurve),u._getColorGradingDataToRef(u._shadowsHue,u._shadowsDensity,u._shadowsSaturation,u._shadowsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._shadowsCurve),u._highlightsCurve.subtractToRef(u._midtonesCurve,u._positiveCurve),u._midtonesCurve.subtractToRef(u._shadowsCurve,u._negativeCurve)),x&&(x.setFloat4(s,u._positiveCurve.r,u._positiveCurve.g,u._positiveCurve.b,u._positiveCurve.a),x.setFloat4(U,u._midtonesCurve.r,u._midtonesCurve.g,u._midtonesCurve.b,u._midtonesCurve.a),x.setFloat4(_,u._negativeCurve.r,u._negativeCurve.g,u._negativeCurve.b,u._negativeCurve.a))}_getColorGradingDataToRef(u,x,s,U,_){null!=u&&(u=L._Clamp(u,0,360),x=L._Clamp(x,-100,100),s=L._Clamp(s,-100,100),U=L._Clamp(U,-100,100),x=L._ApplyColorGradingSliderNonlinear(x),x*=.5,U=L._ApplyColorGradingSliderNonlinear(U),x<0&&(x*=-1,u=(u+180)%360),L._FromHSBToRef(u,x,50+.25*U,_),_.scaleToRef(2,_),_.a=1+.01*s)}static _ApplyColorGradingSliderNonlinear(u){u/=100;let x=Math.abs(u);return x=Math.pow(x,2),u<0&&(x*=-1),x*=100,x}static _FromHSBToRef(u,x,s,U){let _=L._Clamp(u,0,360);const W=L._Clamp(x/100,0,1),c=L._Clamp(s/100,0,1);if(0===W)U.r=c,U.g=c,U.b=c;else{_/=60;const u=Math.floor(_),x=_-u,s=c*(1-W),I=c*(1-W*x),L=c*(1-W*(1-x));switch(u){case 0:U.r=c,U.g=L,U.b=s;break;case 1:U.r=I,U.g=c,U.b=s;break;case 2:U.r=s,U.g=c,U.b=L;break;case 3:U.r=s,U.g=I,U.b=c;break;case 4:U.r=L,U.g=s,U.b=c;break;default:U.r=c,U.g=s,U.b=I}}U.a=1}static _Clamp(u,x,s){return Math.min(Math.max(u,x),s)}clone(){return c.p.Clone((()=>new L),this)}serialize(){return c.p.Serialize(this)}static Parse(u){return c.p.Parse((()=>new L),u,null,null)}}L.PrepareUniforms=I.B,U.Cg([_.lK()],L.prototype,"_globalHue",void 0),U.Cg([_.lK()],L.prototype,"_globalDensity",void 0),U.Cg([_.lK()],L.prototype,"_globalSaturation",void 0),U.Cg([_.lK()],L.prototype,"_globalExposure",void 0),U.Cg([_.lK()],L.prototype,"_highlightsHue",void 0),U.Cg([_.lK()],L.prototype,"_highlightsDensity",void 0),U.Cg([_.lK()],L.prototype,"_highlightsSaturation",void 0),U.Cg([_.lK()],L.prototype,"_highlightsExposure",void 0),U.Cg([_.lK()],L.prototype,"_midtonesHue",void 0),U.Cg([_.lK()],L.prototype,"_midtonesDensity",void 0),U.Cg([_.lK()],L.prototype,"_midtonesSaturation",void 0),U.Cg([_.lK()],L.prototype,"_midtonesExposure",void 0),c.p._ColorCurvesParser=L.Parse},163406:(u,x,s)=>{function U(u){return void 0===u.getPipelineContext}s.d(x,{E:()=>U})},964061:(u,x,s)=>{s.d(x,{E:()=>U});class U{static GetEffect(u){return void 0===u.getPipelineContext?u.effect:u}constructor(u,x=!0){this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=u.createDrawContext(),x&&(this.materialContext=u.createMaterialContext())}setEffect(u,x,s=!0){var U;this.effect=u,void 0!==x&&(this.defines=x),s&&(null===(U=this.drawContext)||void 0===U||U.reset())}dispose(){var u;null===(u=this.drawContext)||void 0===u||u.dispose()}}},286648:(u,x,s)=>{s.d(x,{b4:()=>J,bu:()=>i,mO:()=>k,uR:()=>j});var U=s(394501),_=s(712251),W=s(395879),c=s(706400),I=s(867967),L=s(45410);function J(u,x){return _.N5(x).cachedPipelines[u]}function k(u){const x=u._name,s=u.context;if(x&&s){const u=_.N5(s),U=u.cachedPipelines[x];null==U||U.dispose(),delete u.cachedPipelines[x]}}function i(u,x,s,_,W,c,L){let J,k;const i=U.BA()?null==c?void 0:c.getHostDocument():null;J="string"==typeof x?x:x.vertexSource?"source:"+x.vertexSource:x.vertexElement?(null==i?void 0:i.getElementById(x.vertexElement))||x.vertexElement:x.vertex||x,k="string"==typeof x?x:x.fragmentSource?"source:"+x.fragmentSource:x.fragmentElement?(null==i?void 0:i.getElementById(x.fragmentElement))||x.fragmentElement:x.fragment||x;const j=[void 0,void 0],r=()=>{if(j[0]&&j[1]){u.isFragment=!0;const[U,J]=j;I.M0(J,u,((c,J)=>{L&&(L._fragmentSourceCodeBeforeMigration=J),s&&(c=s("fragment",c));const k=I.nO(U,c,u);u=null;const i=function(u,x,s,U){return s?{vertexSourceCode:(1===U?"//":"")+"#define SHADER_NAME vertex:"+(s.vertexElement||s.vertex||s.spectorName||s)+"\n"+u,fragmentSourceCode:(1===U?"//":"")+"#define SHADER_NAME fragment:"+(s.fragmentElement||s.fragment||s.spectorName||s)+"\n"+x}:{vertexSourceCode:u,fragmentSourceCode:x}}(k.vertexCode,k.fragmentCode,x,W);null==_||_(i.vertexSourceCode,i.fragmentSourceCode)}),c)}};d(J,"Vertex","",(x=>{I.pB(u),I.M0(x,u,((u,U)=>{L&&(L._rawVertexSourceCode=x,L._vertexSourceCodeBeforeMigration=U),s&&(u=s("vertex",u)),j[0]=u,r()}),c)}),W),d(k,"Fragment","Pixel",(u=>{L&&(L._rawFragmentSourceCode=u),j[1]=u,r()}),W)}function d(u,x,s,_,c,I){if("undefined"!=typeof HTMLElement&&u instanceof HTMLElement)return void _(U.Zl(u));if("source:"===u.substr(0,7))return void _(u.substr(7));if("base64:"===u.substr(0,7))return void _(window.atob(u.substr(7)));const J=W.l.GetShadersStore(c);if(J[u+x+"Shader"])return void _(J[u+x+"Shader"]);if(s&&J[u+s+"Shader"])return void _(J[u+s+"Shader"]);let k;if(k="."===u[0]||"/"===u[0]||u.indexOf("http")>-1?u:W.l.GetShadersRepository(c)+u,!(I=I||L.W0))throw new Error("loadFileInjection is not defined");I(k+"."+x.toLowerCase()+".fx",_)}const j=(u,x,s,U)=>{try{const W=u.existingPipelineContext||x(u.shaderProcessingContext);return W._name=u.name,u.name&&u.context&&(_.N5(u.context).cachedPipelines[u.name]=W),s(W,u.vertex,u.fragment,!!u.createAsRaw,"","",u.rebuildRebind,u.defines,u.transformFeedbackVaryings,"",(()=>{U(W,(()=>{var x;null===(x=u.onRenderingStateCompiled)||void 0===x||x.call(u,W)}))})),W}catch(u){throw c.V.Error("Error compiling effect"),u}}},498083:(u,x,s)=>{s.d(x,{M:()=>I});var U=s(638113),_=s(706400),W=s(395879),c=s(286648);class I{static get ShadersRepository(){return W.l.ShadersRepository}static set ShadersRepository(u){W.l.ShadersRepository=u}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new U.cP),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(u,x,s,_=null,W,L=null,J=null,k=null,i=null,d,j="",r=0,D){var $,H,f,O;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new U.cP,this.onErrorObservable=new U.cP,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=u,this._key=j;const t=this._key.replace(/\r/g,"").replace(/\n/g,"|");let V;if(x.attributes){const u=x;if(this._engine=s,this._attributesNames=u.attributes,this._uniformsNames=u.uniformsNames.concat(u.samplers),this._samplerList=u.samplers.slice(),this.defines=u.defines,this.onError=u.onError,this.onCompiled=u.onCompiled,this._fallbacks=u.fallbacks,this._indexParameters=u.indexParameters,this._transformFeedbackVaryings=u.transformFeedbackVaryings||null,this._multiTarget=!!u.multiTarget,this._shaderLanguage=null!==($=u.shaderLanguage)&&void 0!==$?$:0,u.uniformBuffersNames){this._uniformBuffersNamesList=u.uniformBuffersNames.slice();for(let x=0;x<u.uniformBuffersNames.length;x++)this._uniformBuffersNames[u.uniformBuffersNames[x]]=x}this._processFinalCode=null!==(H=u.processFinalCode)&&void 0!==H?H:null,this._processCodeAfterIncludes=null!==(f=u.processCodeAfterIncludes)&&void 0!==f?f:void 0,V=u.existingPipelineContext}else this._engine=W,this.defines=null==L?"":L,this._uniformsNames=s.concat(_),this._samplerList=_?_.slice():[],this._attributesNames=x,this._uniformBuffersNamesList=[],this._shaderLanguage=r,this.onError=i,this.onCompiled=k,this._indexParameters=d,this._fallbacks=J;"WEBGL2"===this._engine.shaderPlatformName&&(V=null!==(O=c.b4(t,this._engine._gl))&&void 0!==O?O:V),this._attributeLocationByName={},this.uniqueId=I._UniqueIdSeed++,V?(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,D)}async _processShaderCodeAsync(u=null,x=!1,s=null,U){U&&await U(),this._processingContext=s||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const _={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:null!=u?u:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:W.l.GetShadersRepository(this._shaderLanguage),includesShadersStore:W.l.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};c.bu(_,this.name,this._processFinalCode,((u,s)=>{this._vertexSourceCode=u,this._fragmentSourceCode=s,this._prepareEffect(x)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(u){return!1}}_isReadyInternal(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(u){return this._attributes[u]}getAttributeLocationByName(u){return this._attributeLocationByName[u]}getAttributesCount(){return this._attributes.length}getUniformIndex(u){return this._uniformsNames.indexOf(u)}getUniform(u){return this._uniforms[u]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(u){this.isReady()?u(this):(this.onCompileObservable.add((x=>{u(x)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(u){try{if(this._isReadyInternal())return}catch(x){return void this._processCompilationErrors(x,u)}this._isDisposed||setTimeout((()=>{this._checkIsReady(u)}),16)}get vertexSourceCode(){var u,x;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(x=null===(u=this._pipelineContext)||void 0===u?void 0:u._getVertexShaderCode())&&void 0!==x?x:this._vertexSourceCode}get fragmentSourceCode(){var u,x;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(x=null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode())&&void 0!==x?x:this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(u,x,s,U){this._isReady=!1,this._vertexSourceCodeOverride=u,this._fragmentSourceCodeOverride=x,this.onError=(u,x)=>{U&&U(x)},this.onCompiled=()=>{var u,x;const U=this.getEngine().scenes;if(U)for(let u=0;u<U.length;u++)U[u].markAllMaterialsAsDirty(63);null===(x=(u=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===x||x.call(u,s)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(u){if(this._pipelineContext=u,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let u=0;u<this._attributesNames.length;u++){const x=this._attributesNames[u];this._attributeLocationByName[x]=this._attributes[u]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()}_prepareEffect(u=!1){const x=this._pipelineContext;this._isReady=!1;try{const s=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),U=s?null:this.defines,_=s?this._vertexSourceCodeOverride:this._vertexSourceCode,W=s?this._fragmentSourceCodeOverride:this._fragmentSourceCode,I=this._engine;this._pipelineContext=c.uR({existingPipelineContext:u?x:null,vertex:_,fragment:W,context:"WEBGL2"===I.shaderPlatformName?I._gl:void 0,rebuildRebind:(u,x,s,U)=>this._rebuildProgram(u,x,s,U),defines:U,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:s,parallelShaderCompile:I._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:s=>{x&&!u&&this._engine._deletePipelineContext(x),s&&this._onRenderingStateCompiled(s)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(x)}catch(u){this._processCompilationErrors(u,x)}}_getShaderCodeAndErrorLine(u,x,s){const U=s?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let _=null;if(x&&u){const W=x.match(U);if(W&&2===W.length){const x=parseInt(W[1]),U=u.split("\n",-1);U.length>=x&&(_=`Offending line [${x}] in ${s?"fragment":"vertex"} code: ${U[x-1]}`)}}return[u,_]}_processCompilationErrors(u,x=null){var s,U,W;this._compilationError=u.message;const c=this._attributesNames,L=this._fallbacks;if(_.V.Error("Unable to compile effect:"),_.V.Error("Uniforms: "+this._uniformsNames.map((function(u){return" "+u}))),_.V.Error("Attributes: "+c.map((function(u){return" "+u}))),_.V.Error("Defines:\n"+this.defines),I.LogShaderCodeOnCompilationError){let u=null,x=null,c=null;(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())&&([c,u]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),c&&(_.V.Error("Vertex code:"),_.V.Error(c))),(null===(U=this._pipelineContext)||void 0===U?void 0:U._getFragmentShaderCode())&&([c,x]=this._getShaderCodeAndErrorLine(null===(W=this._pipelineContext)||void 0===W?void 0:W._getFragmentShaderCode(),this._compilationError,!0),c&&(_.V.Error("Fragment code:"),_.V.Error(c))),u&&_.V.Error(u),x&&_.V.Error(x)}_.V.Error("Error: "+this._compilationError);const J=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};x&&(this._pipelineContext=x,this._isReady=!0,J()),L?(this._pipelineContext=null,L.hasMoreFallbacks?(this._allFallbacksProcessed=!1,_.V.Error("Trying next fallback."),this.defines=L.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,J(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,x||J())}get isSupported(){return""===this._compilationError}_bindTexture(u,x){this._engine._bindTexture(this._samplers[u],x,u)}setTexture(u,x){this._engine.setTexture(this._samplers[u],this._uniforms[u],x,u)}setTextureArray(u,x){const s=u+"Ex";if(-1===this._samplerList.indexOf(s+"0")){const U=this._samplerList.indexOf(u);for(let u=1;u<x.length;u++){const x=s+(u-1).toString();this._samplerList.splice(U+u,0,x)}let _=0;for(const u of this._samplerList)this._samplers[u]=_,_+=1}this._engine.setTextureArray(this._samplers[u],this._uniforms[u],x,u)}bindUniformBuffer(u,x){const s=this._uniformBuffersNames[x];void 0===s||I._BaseCache[s]===u&&this._engine._features.useUBOBindingCache||(I._BaseCache[s]=u,this._engine.bindUniformBufferBase(u,s,x))}bindUniformBlock(u,x){this._engine.bindUniformBlock(this._pipelineContext,u,x)}setInt(u,x){return this._pipelineContext.setInt(u,x),this}setInt2(u,x,s){return this._pipelineContext.setInt2(u,x,s),this}setInt3(u,x,s,U){return this._pipelineContext.setInt3(u,x,s,U),this}setInt4(u,x,s,U,_){return this._pipelineContext.setInt4(u,x,s,U,_),this}setIntArray(u,x){return this._pipelineContext.setIntArray(u,x),this}setIntArray2(u,x){return this._pipelineContext.setIntArray2(u,x),this}setIntArray3(u,x){return this._pipelineContext.setIntArray3(u,x),this}setIntArray4(u,x){return this._pipelineContext.setIntArray4(u,x),this}setUInt(u,x){return this._pipelineContext.setUInt(u,x),this}setUInt2(u,x,s){return this._pipelineContext.setUInt2(u,x,s),this}setUInt3(u,x,s,U){return this._pipelineContext.setUInt3(u,x,s,U),this}setUInt4(u,x,s,U,_){return this._pipelineContext.setUInt4(u,x,s,U,_),this}setUIntArray(u,x){return this._pipelineContext.setUIntArray(u,x),this}setUIntArray2(u,x){return this._pipelineContext.setUIntArray2(u,x),this}setUIntArray3(u,x){return this._pipelineContext.setUIntArray3(u,x),this}setUIntArray4(u,x){return this._pipelineContext.setUIntArray4(u,x),this}setFloatArray(u,x){return this._pipelineContext.setArray(u,x),this}setFloatArray2(u,x){return this._pipelineContext.setArray2(u,x),this}setFloatArray3(u,x){return this._pipelineContext.setArray3(u,x),this}setFloatArray4(u,x){return this._pipelineContext.setArray4(u,x),this}setArray(u,x){return this._pipelineContext.setArray(u,x),this}setArray2(u,x){return this._pipelineContext.setArray2(u,x),this}setArray3(u,x){return this._pipelineContext.setArray3(u,x),this}setArray4(u,x){return this._pipelineContext.setArray4(u,x),this}setMatrices(u,x){return this._pipelineContext.setMatrices(u,x),this}setMatrix(u,x){return this._pipelineContext.setMatrix(u,x),this}setMatrix3x3(u,x){return this._pipelineContext.setMatrix3x3(u,x),this}setMatrix2x2(u,x){return this._pipelineContext.setMatrix2x2(u,x),this}setFloat(u,x){return this._pipelineContext.setFloat(u,x),this}setBool(u,x){return this._pipelineContext.setInt(u,x?1:0),this}setVector2(u,x){return this._pipelineContext.setVector2(u,x),this}setFloat2(u,x,s){return this._pipelineContext.setFloat2(u,x,s),this}setVector3(u,x){return this._pipelineContext.setVector3(u,x),this}setFloat3(u,x,s,U){return this._pipelineContext.setFloat3(u,x,s,U),this}setVector4(u,x){return this._pipelineContext.setVector4(u,x),this}setQuaternion(u,x){return this._pipelineContext.setQuaternion(u,x),this}setFloat4(u,x,s,U,_){return this._pipelineContext.setFloat4(u,x,s,U,_),this}setColor3(u,x){return this._pipelineContext.setColor3(u,x),this}setColor4(u,x,s){return this._pipelineContext.setColor4(u,x,s),this}setDirectColor4(u,x){return this._pipelineContext.setDirectColor4(u,x),this}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&c.mO(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)}static RegisterShader(u,x,s,U=0){x&&(W.l.GetShadersStore(U)[`${u}PixelShader`]=x),s&&(W.l.GetShadersStore(U)[`${u}VertexShader`]=s)}static ResetCache(){I._BaseCache={}}}I.LogShaderCodeOnCompilationError=!0,I._UniqueIdSeed=0,I._BaseCache={},I.ShadersStore=W.l.ShadersStore,I.IncludesShadersStore=W.l.IncludesShadersStore},522208:(u,x,s)=>{s.d(x,{J:()=>U});class U{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(u,x){this._defines[u]||(u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u),this._defines[u]=new Array),this._defines[u].push(x)}addCPUSkinningFallback(u,x){this._mesh=x,u<this._currentRank&&(this._currentRank=u),u>this._maxRank&&(this._maxRank=u)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(u,x){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,u=u.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),x._bonesComputationForcedToCPU=!0;const s=this._mesh.getScene();for(let u=0;u<s.meshes.length;u++){const U=s.meshes[u];if(U.material){if(U.computeBonesUsingShaders&&0!==U.numBoneInfluencers)if(U.material.getEffect()===x)U.computeBonesUsingShaders=!1;else if(U.subMeshes)for(const u of U.subMeshes)if(u.effect===x){U.computeBonesUsingShaders=!1;break}}else!this._mesh.material&&U.computeBonesUsingShaders&&U.numBoneInfluencers>0&&(U.computeBonesUsingShaders=!1)}}else{const x=this._defines[this._currentRank];if(x)for(let s=0;s<x.length;s++)u=u.replace("#define "+x[s],"");this._currentRank++}return u}}},101032:(u,x,s)=>{s.d(x,{$:()=>k,J:()=>J});var U=s(23987),_=s(60071),W=s(638113),c=s(498083),I=s(964061);s(310839);const L={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class J{constructor(u,x=L){var s,W;this._fullscreenViewport=new _.L(0,0,1,1);const c=null!==(s=x.positions)&&void 0!==s?s:L.positions,I=null!==(W=x.indices)&&void 0!==W?W:L.indices;this.engine=u,this._vertexBuffers={[U.R.PositionKind]:new U.R(u,c,U.R.PositionKind,!1,!1,2)},this._indexBuffer=u.createIndexBuffer(I),this._onContextRestoredObserver=u.onContextRestoredObservable.add((()=>{this._indexBuffer=u.createIndexBuffer(I);for(const u in this._vertexBuffers)this._vertexBuffers[u]._rebuild()}))}setViewport(u=this._fullscreenViewport){this.engine.setViewport(u)}bindBuffers(u){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,u)}applyEffectWrapper(u){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(u._drawWrapper),this.bindBuffers(u.effect),u.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest}restoreStates(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.engine.drawElementsType(0,0,6)}_isRenderTargetTexture(u){return void 0!==u.renderTarget}render(u,x=null){if(!u.effect.isReady())return;this.saveStates(),this.setViewport();const s=null===x?null:this._isRenderTargetTexture(x)?x.renderTarget:x;s&&this.engine.bindFramebuffer(s),this.applyEffectWrapper(u),this.draw(),s&&this.engine.unBindFramebuffer(s),this.restoreStates()}dispose(){const u=this._vertexBuffers[U.R.PositionKind];u&&(u.dispose(),delete this._vertexBuffers[U.R.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class k{get effect(){return this._drawWrapper.effect}set effect(u){this._drawWrapper.effect=u}constructor(u){let x;this.onApplyObservable=new W.cP;const s=u.uniformNames||[];u.vertexShader?x={fragmentSource:u.fragmentShader,vertexSource:u.vertexShader,spectorName:u.name||"effectWrapper"}:(s.push("scale"),x={fragmentSource:u.fragmentShader,vertex:"postprocess",spectorName:u.name||"effectWrapper"},this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)})));const U=u.defines?u.defines.join("\n"):"";this._drawWrapper=new I.E(u.engine),u.useShaderStore?(x.fragment=x.fragmentSource,x.vertex||(x.vertex=x.vertexSource),delete x.fragmentSource,delete x.vertexSource,this.effect=u.engine.createEffect(x,u.attributeNames||["position"],s,u.samplerNames,U,void 0,u.onCompiled,void 0,void 0,u.shaderLanguage,u.extraInitializationsAsync)):(this.effect=new c.M(x,u.attributeNames||["position"],s,u.samplerNames,u.engine,U,void 0,u.onCompiled,void 0,void 0,void 0,u.shaderLanguage,u.extraInitializationsAsync),this._onContextRestoredObserver=u.engine.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()})))}dispose(u=!1){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()}}},309229:(u,x,s)=>{s.d(x,{C:()=>W,_:()=>_});var U=s(844468);function _(u,x){x.EXPOSURE&&u.push("exposureLinear"),x.CONTRAST&&u.push("contrast"),x.COLORGRADING&&u.push("colorTransformSettings"),(x.VIGNETTE||x.DITHER)&&u.push("vInverseScreenSize"),x.VIGNETTE&&(u.push("vignetteSettings1"),u.push("vignetteSettings2")),x.COLORCURVES&&U.B(u),x.DITHER&&u.push("ditherIntensity")}function W(u,x){x.COLORGRADING&&u.push("txColorTransform")}},239590:(u,x,s)=>{s.d(x,{p:()=>d});var U=s(297809),_=s(760998),W=s(638113),c=s(332290),I=s(87639),L=s(104270),J=s(337776),k=s(309229),i=s(310035);class d{constructor(){this.colorCurves=new I.Q,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=d.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new c.ov(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=d.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new W.cP}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(u){this._colorCurvesEnabled!==u&&(this._colorCurvesEnabled=u,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(u){this._colorGradingTexture!==u&&(this._colorGradingTexture=u,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(u){this._colorGradingEnabled!==u&&(this._colorGradingEnabled=u,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(u){this._colorGradingWithGreenDepth!==u&&(this._colorGradingWithGreenDepth=u,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(u){this._colorGradingBGR!==u&&(this._colorGradingBGR=u,this._updateParameters())}get exposure(){return this._exposure}set exposure(u){this._exposure!==u&&(this._exposure=u,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(u){this._toneMappingEnabled!==u&&(this._toneMappingEnabled=u,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(u){this._toneMappingType!==u&&(this._toneMappingType=u,this._updateParameters())}get contrast(){return this._contrast}set contrast(u){this._contrast!==u&&(this._contrast=u,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(u){this.vignetteCenterY=u}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(u){this.vignetteCenterX=u}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(u){this._vignetteBlendMode!==u&&(this._vignetteBlendMode=u,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(u){this._vignetteEnabled!==u&&(this._vignetteEnabled=u,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(u){this._ditheringEnabled!==u&&(this._ditheringEnabled=u,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(u){this._ditheringIntensity!==u&&(this._ditheringIntensity=u,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(u){this._skipFinalColorClamp!==u&&(this._skipFinalColorClamp=u,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(u){this._applyByPostProcess!==u&&(this._applyByPostProcess=u,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(u){this._isEnabled!==u&&(this._isEnabled=u,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(u,x=!1){if(x!==this.applyByPostProcess||!this._isEnabled)return u.VIGNETTE=!1,u.TONEMAPPING=0,u.CONTRAST=!1,u.EXPOSURE=!1,u.COLORCURVES=!1,u.COLORGRADING=!1,u.COLORGRADING3D=!1,u.DITHER=!1,u.IMAGEPROCESSING=!1,u.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(u.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(u.VIGNETTE=this.vignetteEnabled,u.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===d._VIGNETTEMODE_MULTIPLY,u.VIGNETTEBLENDMODEOPAQUE=!u.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case d.TONEMAPPING_KHR_PBR_NEUTRAL:u.TONEMAPPING=3;break;case d.TONEMAPPING_ACES:u.TONEMAPPING=2;break;default:u.TONEMAPPING=1}else u.TONEMAPPING=0;u.CONTRAST=1!==this.contrast,u.EXPOSURE=1!==this.exposure,u.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,u.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,u.COLORGRADING?u.COLORGRADING3D=this.colorGradingTexture.is3D:u.COLORGRADING3D=!1,u.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,u.SAMPLER3DBGRMAP=this.colorGradingBGR,u.DITHER=this._ditheringEnabled,u.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,u.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,u.IMAGEPROCESSING=u.VIGNETTE||!!u.TONEMAPPING||u.CONTRAST||u.EXPOSURE||u.COLORCURVES||u.COLORGRADING||u.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(u,x){if(this._colorCurvesEnabled&&this.colorCurves&&I.Q.Bind(this.colorCurves,u),this._vignetteEnabled||this._ditheringEnabled){const s=1/u.getEngine().getRenderWidth(),U=1/u.getEngine().getRenderHeight();if(u.setFloat2("vInverseScreenSize",s,U),this._ditheringEnabled&&u.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const _=null!=x?x:U/s;let W=Math.tan(.5*this.vignetteCameraFov),c=W*_;const I=Math.sqrt(c*W);c=L.zF(c,I,this.vignetteStretch),W=L.zF(W,I,this.vignetteStretch),u.setFloat4("vignetteSettings1",c,W,-c*this.vignetteCenterX,-W*this.vignetteCenterY);const J=-2*this.vignetteWeight;u.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,J)}}if(u.setFloat("exposureLinear",this.exposure),u.setFloat("contrast",this.contrast),this.colorGradingTexture){u.setTexture("txColorTransform",this.colorGradingTexture);const x=this.colorGradingTexture.getSize().height;u.setFloat4("colorTransformSettings",(x-1)/x,.5/x,x,this.colorGradingTexture.level)}}clone(){return J.p.Clone((()=>new d),this)}serialize(){return J.p.Serialize(this)}static Parse(u){const x=J.p.Parse((()=>new d),u,null,null);return void 0!==u.vignetteCentreX&&(x.vignetteCenterX=u.vignetteCentreX),void 0!==u.vignetteCentreY&&(x.vignetteCenterY=u.vignetteCentreY),x}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}d.TONEMAPPING_STANDARD=0,d.TONEMAPPING_ACES=1,d.TONEMAPPING_KHR_PBR_NEUTRAL=2,d.PrepareUniforms=k._,d.PrepareSamplers=k.C,d._VIGNETTEMODE_MULTIPLY=0,d._VIGNETTEMODE_OPAQUE=1,U.Cg([_.wL()],d.prototype,"colorCurves",void 0),U.Cg([_.lK()],d.prototype,"_colorCurvesEnabled",void 0),U.Cg([_.uM("colorGradingTexture")],d.prototype,"_colorGradingTexture",void 0),U.Cg([_.lK()],d.prototype,"_colorGradingEnabled",void 0),U.Cg([_.lK()],d.prototype,"_colorGradingWithGreenDepth",void 0),U.Cg([_.lK()],d.prototype,"_colorGradingBGR",void 0),U.Cg([_.lK()],d.prototype,"_exposure",void 0),U.Cg([_.lK()],d.prototype,"_toneMappingEnabled",void 0),U.Cg([_.lK()],d.prototype,"_toneMappingType",void 0),U.Cg([_.lK()],d.prototype,"_contrast",void 0),U.Cg([_.lK()],d.prototype,"vignetteStretch",void 0),U.Cg([_.lK()],d.prototype,"vignetteCenterX",void 0),U.Cg([_.lK()],d.prototype,"vignetteCenterY",void 0),U.Cg([_.lK()],d.prototype,"vignetteWeight",void 0),U.Cg([_.qK()],d.prototype,"vignetteColor",void 0),U.Cg([_.lK()],d.prototype,"vignetteCameraFov",void 0),U.Cg([_.lK()],d.prototype,"_vignetteBlendMode",void 0),U.Cg([_.lK()],d.prototype,"_vignetteEnabled",void 0),U.Cg([_.lK()],d.prototype,"_ditheringEnabled",void 0),U.Cg([_.lK()],d.prototype,"_ditheringIntensity",void 0),U.Cg([_.lK()],d.prototype,"_skipFinalColorClamp",void 0),U.Cg([_.lK()],d.prototype,"_applyByPostProcess",void 0),U.Cg([_.lK()],d.prototype,"_isEnabled",void 0),J.p._ImageProcessingConfigurationParser=d.Parse,i.Y5("BABYLON.ImageProcessingConfiguration",d)},722736:(u,x,s)=>{s.d(x,{H:()=>k,c:()=>i});var U=s(297809),_=s(55973),W=s(760998),c=s(591160),I=s(527335),L=s(185537),J=s(855300);class k extends I.M{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class i extends L.y{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(u,x=!0){super(u,"DetailMap",140,new k,x),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=_.i.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=u._dirtyCallbacks[1]}isReadyForSubMesh(u,x,s){return!this._isEnabled||!(u._areTexturesDirty&&x.texturesEnabled&&s.getCaps().standardDerivatives&&this._texture&&c.h.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(u,x){if(this._isEnabled){u.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const s=x.getEngine();u._areTexturesDirty&&(s.getCaps().standardDerivatives&&this._texture&&c.h.DetailTextureEnabled&&this._isEnabled?(J.YT(this._texture,u,"DETAIL"),u.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):u.DETAIL=!1)}else u.DETAIL=!1}bindForSubMesh(u,x){if(!this._isEnabled)return;const s=this._material.isFrozen;u.useUbo&&s&&u.isSync||this._texture&&c.h.DetailTextureEnabled&&(u.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),J.mA(this._texture,u,"detail")),x.texturesEnabled&&this._texture&&c.h.DetailTextureEnabled&&u.setTexture("detailSampler",this._texture)}hasTexture(u){return this._texture===u}getActiveTextures(u){this._texture&&u.push(this._texture)}getAnimatables(u){this._texture&&this._texture.animations&&this._texture.animations.length>0&&u.push(this._texture)}dispose(u){var x;u&&(null===(x=this._texture)||void 0===x||x.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(u){u.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}U.Cg([W.uM("detailTexture"),W.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),U.Cg([W.lK()],i.prototype,"diffuseBlendLevel",void 0),U.Cg([W.lK()],i.prototype,"roughnessBlendLevel",void 0),U.Cg([W.lK()],i.prototype,"bumpLevel",void 0),U.Cg([W.lK(),W.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"normalBlendMethod",void 0),U.Cg([W.lK(),W.$z("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0)},55973:(u,x,s)=>{s.d(x,{i:()=>$});var U=s(297809),_=s(760998),W=s(898973),c=s(638113),I=s(395726),L=s(374216),J=s(384898),k=s(706400),i=s(298039),d=s(964061),j=s(337776);class r{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(u){this._func=u}get funcRef(){return this._funcRef}set funcRef(u){this._funcRef=u}get funcMask(){return this._funcMask}set funcMask(u){this._funcMask=u}get opStencilFail(){return this._opStencilFail}set opStencilFail(u){this._opStencilFail=u}get opDepthFail(){return this._opDepthFail}set opDepthFail(u){this._opDepthFail=u}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(u){this._opStencilDepthPass=u}get mask(){return this._mask}set mask(u){this._mask=u}get enabled(){return this._enabled}set enabled(u){this._enabled=u}getClassName(){return"MaterialStencilState"}copyTo(u){j.p.Clone((()=>u),this)}serialize(){return j.p.Serialize(this)}parse(u,x,s){j.p.Parse((()=>this),u,x,s)}}U.Cg([_.lK()],r.prototype,"func",null),U.Cg([_.lK()],r.prototype,"funcRef",null),U.Cg([_.lK()],r.prototype,"funcMask",null),U.Cg([_.lK()],r.prototype,"opStencilFail",null),U.Cg([_.lK()],r.prototype,"opDepthFail",null),U.Cg([_.lK()],r.prototype,"opStencilDepthPass",null),U.Cg([_.lK()],r.prototype,"mask",null),U.Cg([_.lK()],r.prototype,"enabled",null);var D=s(855300);class ${get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(u){if(this._alpha===u)return;const x=this._alpha;this._alpha=u,1!==x&&1!==u||this.markAsDirty($.MiscDirtyFlag+$.PrePassDirtyFlag)}get alpha(){return this._alpha}set backFaceCulling(u){this._backFaceCulling!==u&&(this._backFaceCulling=u,this.markAsDirty($.TextureDirtyFlag))}get backFaceCulling(){return this._backFaceCulling}set cullBackFaces(u){this._cullBackFaces!==u&&(this._cullBackFaces=u,this.markAsDirty($.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(u){this._blockDirtyMechanism!==u&&(this._blockDirtyMechanism=u,u||this.markDirty())}atomicMaterialsUpdate(u){this.blockDirtyMechanism=!0;try{u(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new c.cP),this._onBindObservable}set onBind(u){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(u)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new c.cP),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new c.cP),this._onEffectCreatedObservable}set alphaMode(u){this._alphaMode!==u&&(this._alphaMode=u,this.markAsDirty($.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(u){this._needDepthPrePass!==u&&(this._needDepthPrePass=u,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(u){this._fogEnabled!==u&&(this._fogEnabled=u,this.markAsDirty($.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case $.WireFrameFillMode:case $.LineListDrawMode:case $.LineLoopDrawMode:case $.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(u){this.fillMode=u?$.WireFrameFillMode:$.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case $.PointFillMode:case $.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(u){this.fillMode=u?$.PointFillMode:$.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(u){this._fillMode!==u&&(this._fillMode=u,this.markAsDirty($.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(u){const x=this.getScene().getEngine().getCaps().fragmentDepthSupported;u&&!x&&k.V.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=u&&x,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(u){this._drawWrapper=u}constructor(u,x,s){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new c.cP,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new r,this._useUBO=!1,this._fillMode=$.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=u;const U=x||I.q.LastCreatedScene;U&&(this._scene=U,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=u||W.S0.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new d.E(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new J.D(this._scene.getEngine(),void 0,void 0,u),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,s||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),$.OnEventObservable.notifyObservers(this,1))}toString(u){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.markDirty(),this.checkReadyOnlyOnce=!0}unfreeze(){this.markDirty(),this.checkReadyOnlyOnce=!1}isReady(u,x){return!0}isReadyForSubMesh(u,x,s){const U=x.materialDefines;return!!U&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=U,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}getScene(){return this._scene}_getEffectiveOrientation(u){return null!==this.sideOrientation?this.sideOrientation:u.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(u){this._transparencyMode!==u&&(this._transparencyMode=u,this._forceAlphaTest=u===$.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===$.MATERIAL_OPAQUE||this._transparencyMode===$.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(u){return u.visibility<1||!this._disableAlphaBlending&&(u.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(u){return!this.needAlphaBlendingForMesh(u)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}markDirty(u=!1){const x=this.getScene().meshes;for(const s of x)if(s.subMeshes)for(const x of s.subMeshes)if(x.getMaterial()===this)for(const s of x._drawWrappers)s&&this._materialContext===s.materialContext&&(s._wasPreviouslyReady=!1,s._wasPreviouslyUsingInstances=null,s._forceRebindOnNextCall=u);u&&this.markAsDirty($.AllDirtyFlag)}_preBind(u,x=null){const s=this._scene.getEngine(),U=(null==x?this.sideOrientation:x)===$.ClockWiseSideOrientation;return s.enableEffect(u||this._getDrawWrapper()),s.setState(this.backFaceCulling,this.zOffset,!1,U,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),U}bind(u,x){}buildUniformLayout(){const u=this._uniformBuffer;this._eventInfo.ubo=u,this._callbackPluginEventGeneric(8,this._eventInfo),u.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(u,x,s){const U=s._drawWrapper;this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),U._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(u){}bindView(u){this._useUBO?this._needToBindSceneUbo=!0:u.setMatrix("view",this.getScene().getViewMatrix())}bindViewProjection(u){this._useUBO?this._needToBindSceneUbo=!0:(u.setMatrix("viewProjection",this.getScene().getTransformMatrix()),u.setMatrix("projection",this.getScene().getProjectionMatrix()))}bindEyePosition(u,x){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(u,x)}_afterBind(u,x=null,s){if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&x&&(this._needToBindSceneUbo=!1,D._8(x,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=u?u.visibility:1,this._onBindObservable&&u&&this._onBindObservable.notifyObservers(u),this.disableDepthWrite){const u=this._scene.getEngine();this._cachedDepthWriteState=u.getDepthWrite(),u.setDepthWrite(!1)}if(this.disableColorWrite){const u=this._scene.getEngine();this._cachedColorWriteState=u.getColorWrite(),u.setColorWrite(!1)}if(0!==this.depthFunction){const u=this._scene.getEngine();this._cachedDepthFunctionState=u.getDepthFunction()||0,u.setDepthFunction(this.depthFunction)}}unbind(){this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState),this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState),this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(u){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=u,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(u){return null}_clonePlugins(u,x){const s={};if(this._serializePlugins(s),$._ParsePlugins(s,u,this._scene,x),this.pluginManager)for(const x of this.pluginManager._plugins){const s=u.pluginManager.getPlugin(x.name);s&&x.copyTo(s)}}getBindedMeshes(){if(this.meshMap){const u=[];for(const x in this.meshMap){const s=this.meshMap[x];s&&u.push(s)}return u}return this._scene.meshes.filter((u=>u.material===this))}forceCompilation(u,x,s,U){const _={clipPlane:!1,useInstances:!1,...s},W=this.getScene(),c=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const I=()=>{if(!this._scene||!this._scene.getEngine())return;const s=W.clipPlane;if(_.clipPlane&&(W.clipPlane=new i.Z(0,0,0,1)),this._storeEffectOnSubMeshes){let s=!0,W=null;if(u.subMeshes){const x=new L.K(0,0,0,0,0,u,void 0,!1,!1);x.materialDefines&&(x.materialDefines._renderId=-1),this.isReadyForSubMesh(u,x,_.useInstances)||(x.effect&&x.effect.getCompilationError()&&x.effect.allFallbacksProcessed()?W=x.effect.getCompilationError():(s=!1,setTimeout(I,16)))}s&&(this.allowShaderHotSwapping=c,W&&U&&U(W),x&&x(this))}else this.isReady()?(this.allowShaderHotSwapping=c,x&&x(this)):setTimeout(I,16);_.clipPlane&&(W.clipPlane=s)};I()}forceCompilationAsync(u,x){return new Promise(((s,U)=>{this.forceCompilation(u,(()=>{s()}),x,(u=>{U(u)}))}))}markAsDirty(u){this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism||($._DirtyCallbackArray.length=0,u&$.TextureDirtyFlag&&$._DirtyCallbackArray.push($._TextureDirtyCallBack),u&$.LightDirtyFlag&&$._DirtyCallbackArray.push($._LightsDirtyCallBack),u&$.FresnelDirtyFlag&&$._DirtyCallbackArray.push($._FresnelDirtyCallBack),u&$.AttributesDirtyFlag&&$._DirtyCallbackArray.push($._AttributeDirtyCallBack),u&$.MiscDirtyFlag&&$._DirtyCallbackArray.push($._MiscDirtyCallBack),u&$.PrePassDirtyFlag&&$._DirtyCallbackArray.push($._PrePassDirtyCallBack),$._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty($._RunDirtyCallBacks),this.getScene().resetCachedMaterial())}resetDrawCache(){const u=this.getScene().meshes;for(const x of u)if(x.subMeshes)for(const u of x.subMeshes)u.getMaterial()===this&&u.resetDrawCache()}_markAllSubMeshesAsDirty(u){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const x=this.getScene().meshes;for(const s of x)if(s.subMeshes)for(const x of s.subMeshes)if(x.getMaterial(!1)===this)for(const s of x._drawWrappers)s&&s.defines&&s.defines.markAllAsDirty&&this._materialContext===s.materialContext&&u(s.defines)}_markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const u=this.getScene().enablePrePassRenderer();u&&u.markAsDirty()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty($._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty($._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty($._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty($._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty($._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty($._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty($._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty($._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty($._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty($._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const u=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.onDisposeObservable.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(u)}))}}setPrePassRenderer(u){return!1}dispose(u,x,s){const U=this.getScene();if(U.stopAnimation(this),U.freeProcessedMaterials(),U.removeMaterial(this),this._eventInfo.forceDisposeTextures=x,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const u=this._parentContainer.materials.indexOf(this);u>-1&&this._parentContainer.materials.splice(u,1),this._parentContainer=null}if(!0!==s)if(this.meshMap)for(const x in this.meshMap){const s=this.meshMap[x];s&&(s.material=null,this.releaseVertexArrayObject(s,u))}else{const x=U.meshes;for(const s of x)s.material!==this||s.sourceMesh||(s.material=null,this.releaseVertexArrayObject(s,u))}this._uniformBuffer.dispose(),u&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(u,x){const s=u.geometry;if(s)if(this._storeEffectOnSubMeshes){if(u.subMeshes)for(const U of u.subMeshes)s._releaseVertexArrayObject(U.effect),x&&U.effect&&U.effect.dispose()}else s._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const u=j.p.Serialize(this);return u.stencil=this.stencil.serialize(),u.uniqueId=this.uniqueId,this._serializePlugins(u),u}_serializePlugins(u){if(u.plugins={},this.pluginManager)for(const x of this.pluginManager._plugins)u.plugins[x.getClassName()]=x.serialize()}static Parse(u,x,s){if(u.customType){if("BABYLON.PBRMaterial"===u.customType&&u.overloadedAlbedo&&(u.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return k.V.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else u.customType="BABYLON.StandardMaterial";const U=W.S0.Instantiate(u.customType).Parse(u,x,s);return U._loadedUniqueId=u.uniqueId,U}static _ParsePlugins(u,x,s,U){var _;if(u.plugins)for(const c in u.plugins){const I=u.plugins[c];let L=null===(_=x.pluginManager)||void 0===_?void 0:_.getPlugin(I.name);if(!L){const u=W.S0.Instantiate("BABYLON."+c);u&&(L=new u(x))}null==L||L.parse(I,s,U)}}}$.TriangleFillMode=0,$.WireFrameFillMode=1,$.PointFillMode=2,$.PointListDrawMode=3,$.LineListDrawMode=4,$.LineLoopDrawMode=5,$.LineStripDrawMode=6,$.TriangleStripDrawMode=7,$.TriangleFanDrawMode=8,$.ClockWiseSideOrientation=0,$.CounterClockWiseSideOrientation=1,$.TextureDirtyFlag=1,$.LightDirtyFlag=2,$.FresnelDirtyFlag=4,$.AttributesDirtyFlag=8,$.MiscDirtyFlag=16,$.PrePassDirtyFlag=32,$.AllDirtyFlag=63,$.MATERIAL_OPAQUE=0,$.MATERIAL_ALPHATEST=1,$.MATERIAL_ALPHABLEND=2,$.MATERIAL_ALPHATESTANDBLEND=3,$.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,$.MATERIAL_NORMALBLENDMETHOD_RNM=1,$.OnEventObservable=new c.cP,$._AllDirtyCallBack=u=>u.markAllAsDirty(),$._ImageProcessingDirtyCallBack=u=>u.markAsImageProcessingDirty(),$._TextureDirtyCallBack=u=>u.markAsTexturesDirty(),$._FresnelDirtyCallBack=u=>u.markAsFresnelDirty(),$._MiscDirtyCallBack=u=>u.markAsMiscDirty(),$._PrePassDirtyCallBack=u=>u.markAsPrePassDirty(),$._LightsDirtyCallBack=u=>u.markAsLightDirty(),$._AttributeDirtyCallBack=u=>u.markAsAttributesDirty(),$._FresnelAndMiscDirtyCallBack=u=>{$._FresnelDirtyCallBack(u),$._MiscDirtyCallBack(u)},$._TextureAndMiscDirtyCallBack=u=>{$._TextureDirtyCallBack(u),$._MiscDirtyCallBack(u)},$._DirtyCallbackArray=[],$._RunDirtyCallBacks=u=>{for(const x of $._DirtyCallbackArray)x(u)},U.Cg([_.lK()],$.prototype,"id",void 0),U.Cg([_.lK()],$.prototype,"uniqueId",void 0),U.Cg([_.lK()],$.prototype,"name",void 0),U.Cg([_.lK()],$.prototype,"metadata",void 0),U.Cg([_.lK()],$.prototype,"checkReadyOnEveryCall",void 0),U.Cg([_.lK()],$.prototype,"checkReadyOnlyOnce",void 0),U.Cg([_.lK()],$.prototype,"state",void 0),U.Cg([_.lK("alpha")],$.prototype,"_alpha",void 0),U.Cg([_.lK("backFaceCulling")],$.prototype,"_backFaceCulling",void 0),U.Cg([_.lK("cullBackFaces")],$.prototype,"_cullBackFaces",void 0),U.Cg([_.lK()],$.prototype,"sideOrientation",void 0),U.Cg([_.lK("alphaMode")],$.prototype,"_alphaMode",void 0),U.Cg([_.lK()],$.prototype,"_needDepthPrePass",void 0),U.Cg([_.lK()],$.prototype,"disableDepthWrite",void 0),U.Cg([_.lK()],$.prototype,"disableColorWrite",void 0),U.Cg([_.lK()],$.prototype,"forceDepthWrite",void 0),U.Cg([_.lK()],$.prototype,"depthFunction",void 0),U.Cg([_.lK()],$.prototype,"separateCullingPass",void 0),U.Cg([_.lK("fogEnabled")],$.prototype,"_fogEnabled",void 0),U.Cg([_.lK()],$.prototype,"pointSize",void 0),U.Cg([_.lK()],$.prototype,"zOffset",void 0),U.Cg([_.lK()],$.prototype,"zOffsetUnits",void 0),U.Cg([_.lK()],$.prototype,"pointsCloud",null),U.Cg([_.lK()],$.prototype,"fillMode",null),U.Cg([_.lK()],$.prototype,"useLogarithmicDepth",null),U.Cg([_.lK()],$.prototype,"transparencyMode",null)},527335:(u,x,s)=>{s.d(x,{M:()=>U});class U{constructor(u){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=u,u)for(const x in u)Object.prototype.hasOwnProperty.call(u,x)&&this._setDefaultValue(x)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(u=!1){this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||u,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const u of Object.keys(this))"_"!==u[0]&&this._keys.push(u);if(this._externalProperties)for(const u in this._externalProperties)-1===this._keys.indexOf(u)&&this._keys.push(u)}isEqual(u){if(this._keys.length!==u._keys.length)return!1;for(let x=0;x<this._keys.length;x++){const s=this._keys[x];if(this[s]!==u[s])return!1}return!0}cloneTo(u){this._keys.length!==u._keys.length&&(u._keys=this._keys.slice(0));for(let x=0;x<this._keys.length;x++){const s=this._keys[x];u[s]=this[s]}}reset(){this._keys.forEach((u=>this._setDefaultValue(u)))}_setDefaultValue(u){var x,s,U,_,W;const c=null!==(U=null===(s=null===(x=this._externalProperties)||void 0===x?void 0:x[u])||void 0===s?void 0:s.type)&&void 0!==U?U:typeof this[u],I=null===(W=null===(_=this._externalProperties)||void 0===_?void 0:_[u])||void 0===W?void 0:W.default;switch(c){case"number":this[u]=null!=I?I:0;break;case"string":this[u]=null!=I?I:"";break;default:this[u]=null!=I&&I}}toString(){let u="";for(let x=0;x<this._keys.length;x++){const s=this._keys[x],U=this[s];switch(typeof U){case"number":case"string":u+="#define "+s+" "+U+"\n";break;default:U&&(u+="#define "+s+"\n")}}return u}}},591160:(u,x,s)=>{s.d(x,{h:()=>_});var U=s(33321);class _{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(u){this._DiffuseTextureEnabled!==u&&(this._DiffuseTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(u){this._DetailTextureEnabled!==u&&(this._DetailTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(u){this._DecalMapEnabled!==u&&(this._DecalMapEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(u){this._AmbientTextureEnabled!==u&&(this._AmbientTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(u){this._OpacityTextureEnabled!==u&&(this._OpacityTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(u){this._ReflectionTextureEnabled!==u&&(this._ReflectionTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(u){this._EmissiveTextureEnabled!==u&&(this._EmissiveTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(u){this._SpecularTextureEnabled!==u&&(this._SpecularTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(u){this._BumpTextureEnabled!==u&&(this._BumpTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(u){this._LightmapTextureEnabled!==u&&(this._LightmapTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(u){this._RefractionTextureEnabled!==u&&(this._RefractionTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(u){this._ColorGradingTextureEnabled!==u&&(this._ColorGradingTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(u){this._FresnelEnabled!==u&&(this._FresnelEnabled=u,U.$.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(u){this._ClearCoatTextureEnabled!==u&&(this._ClearCoatTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(u){this._ClearCoatBumpTextureEnabled!==u&&(this._ClearCoatBumpTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(u){this._ClearCoatTintTextureEnabled!==u&&(this._ClearCoatTintTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(u){this._SheenTextureEnabled!==u&&(this._SheenTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(u){this._AnisotropicTextureEnabled!==u&&(this._AnisotropicTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(u){this._ThicknessTextureEnabled!==u&&(this._ThicknessTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(u){this._RefractionIntensityTextureEnabled!==u&&(this._RefractionIntensityTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(u){this._TranslucencyIntensityTextureEnabled!==u&&(this._TranslucencyIntensityTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(u){this._TranslucencyColorTextureEnabled!==u&&(this._TranslucencyColorTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(u){this._IridescenceTextureEnabled!==u&&(this._IridescenceTextureEnabled=u,U.$.MarkAllMaterialsAsDirty(1))}}_._DiffuseTextureEnabled=!0,_._DetailTextureEnabled=!0,_._DecalMapEnabled=!0,_._AmbientTextureEnabled=!0,_._OpacityTextureEnabled=!0,_._ReflectionTextureEnabled=!0,_._EmissiveTextureEnabled=!0,_._SpecularTextureEnabled=!0,_._BumpTextureEnabled=!0,_._LightmapTextureEnabled=!0,_._RefractionTextureEnabled=!0,_._ColorGradingTextureEnabled=!0,_._FresnelEnabled=!0,_._ClearCoatTextureEnabled=!0,_._ClearCoatBumpTextureEnabled=!0,_._ClearCoatTintTextureEnabled=!0,_._SheenTextureEnabled=!0,_._AnisotropicTextureEnabled=!0,_._ThicknessTextureEnabled=!0,_._RefractionIntensityTextureEnabled=!0,_._TranslucencyIntensityTextureEnabled=!0,_._TranslucencyColorTextureEnabled=!0,_._IridescenceTextureEnabled=!0},855300:(u,x,s)=>{s.d(x,{Bb:()=>G,DL:()=>k,ER:()=>n,GD:()=>p,IC:()=>T,IF:()=>j,J2:()=>O,Jz:()=>Q,Kd:()=>N,L0:()=>V,MF:()=>d,N4:()=>R,Nc:()=>S,OR:()=>e,RL:()=>m,VO:()=>z,Y7:()=>X,YT:()=>H,Yy:()=>i,_8:()=>$,az:()=>v,c4:()=>F,f$:()=>t,fm:()=>Z,lo:()=>y,mA:()=>f,nR:()=>D,ni:()=>b,qB:()=>l,qL:()=>B,te:()=>r,wu:()=>E});var U=s(706400),_=s(332290),W=s(395726),c=s(875830),I=s(651577);const L=_.v9.Black(),J={NUM_MORPH_INFLUENCERS:0};function k(u,x,s){if(!u||u["LOGARITHMICDEPTH"]||u.indexOf&&u.indexOf("LOGARITHMICDEPTH")>=0){const u=s.activeCamera;1===u.mode&&U.V.Error("Logarithmic depth is not compatible with orthographic cameras!",20),x.setFloat("logarithmicDepthConstant",2/(Math.log(u.maxZ+1)/Math.LN2))}}function i(u,x,s,U=!1){s&&u.fogEnabled&&(!x||x.applyFog)&&0!==u.fogMode&&(s.setFloat4("vFogInfos",u.fogMode,u.fogStart,u.fogEnd,u.fogDensity),U?(u.fogColor.toLinearSpaceToRef(L,u.getEngine().useExactSrgbConversions),s.setColor3("vFogColor",L)):s.setColor3("vFogColor",u.fogColor))}function d(u,x,s){J.NUM_MORPH_INFLUENCERS=s,j(u,x,J)}function j(u,x,s){const _=s["NUM_MORPH_INFLUENCERS"];if(_>0&&W.q.LastCreatedEngine){const c=W.q.LastCreatedEngine.getCaps().maxVertexAttribs,I=x.morphTargetManager;if(null==I?void 0:I.isUsingTextureForTargets)return;const L=I&&I.supportsNormals&&s["NORMAL"],J=I&&I.supportsTangents&&s["TANGENT"],k=I&&I.supportsUVs&&s["UV1"];for(let s=0;s<_;s++)u.push(`position`+s),L&&u.push(`normal`+s),J&&u.push(`tangent`+s),k&&u.push(`uv`+"_"+s),u.length>c&&U.V.Error("Cannot add more vertex attributes for mesh "+x.name)}}function r(u,x=!1){u.push("world0"),u.push("world1"),u.push("world2"),u.push("world3"),x&&(u.push("previousWorld0"),u.push("previousWorld1"),u.push("previousWorld2"),u.push("previousWorld3"))}function D(u,x){const s=u.morphTargetManager;u&&s&&x.setFloatArray("morphTargetInfluences",s.influences)}function $(u,x){x.bindToEffect(u,"Scene")}function H(u,x,s){x._needUVs=!0,x[s]=!0,u.optimizeUVAllocation&&u.getTextureMatrix().isIdentityAs3x2()?(x[s+"DIRECTUV"]=u.coordinatesIndex+1,x["MAINUV"+(u.coordinatesIndex+1)]=!0):x[s+"DIRECTUV"]=0}function f(u,x,s){const U=u.getTextureMatrix();x.updateMatrix(s+"Matrix",U)}function O(u,x,s){s["BAKED_VERTEX_ANIMATION_TEXTURE"]&&s["INSTANCES"]&&u.push("bakedVertexAnimationSettingsInstanced")}function t(u,x,s){var U;if(x&&u&&(u.computeBonesUsingShaders&&x._bonesComputationForcedToCPU&&(u.computeBonesUsingShaders=!1),u.useBones&&u.computeBonesUsingShaders&&u.skeleton)){const _=u.skeleton;if(_.isUsingTextureForMatrices&&x.getUniformIndex("boneTextureWidth")>-1){const s=_.getTransformMatrixTexture(u);x.setTexture("boneSampler",s),x.setFloat("boneTextureWidth",4*(_.bones.length+1))}else{const W=_.getTransformMatrices(u);W&&(x.setMatrices("mBones",W),s&&u.getScene().prePassRenderer&&u.getScene().prePassRenderer.getIndex(2)&&(s.previousBones[u.uniqueId]||(s.previousBones[u.uniqueId]=W.slice()),x.setMatrices("mPreviousBones",s.previousBones[u.uniqueId]),U=W,s.previousBones[u.uniqueId].set(U)))}}}function V(u,x,s){u.transferToEffect(x,s+"")}function N(u,x,s,U,_,W=!0){u._bindLight(x,s,U,_,W)}function m(u,x,s,U,_=4){const W=Math.min(x.lightSources.length,_);for(let _=0;_<W;_++)N(x.lightSources[_],_,u,s,"boolean"==typeof U?U:U["SPECULARTERM"],x.receiveShadows)}function b(u,x,s,U){s["NUM_BONE_INFLUENCERS"]>0&&(U.addCPUSkinningFallback(0,x),u.push(`matricesIndices`),u.push(`matricesWeights`),s["NUM_BONE_INFLUENCERS"]>4&&(u.push(`matricesIndicesExtra`),u.push(`matricesWeightsExtra`)))}function n(u,x){(x["INSTANCES"]||x["THIN_INSTANCES"])&&r(u,!!x["PREPASS_VELOCITY"]),x.INSTANCESCOLOR&&u.push(`instanceColor`)}function F(u,x,s=4,U=0){let _=0;for(let W=0;W<s&&u["LIGHT"+W];W++)W>0&&(_=U+W,x.addFallback(_,"LIGHT"+W)),u["SHADOWS"]||(u["SHADOW"+W]&&x.addFallback(U,"SHADOW"+W),u["SHADOWPCF"+W]&&x.addFallback(U,"SHADOWPCF"+W),u["SHADOWPCSS"+W]&&x.addFallback(U,"SHADOWPCSS"+W),u["SHADOWPOISSON"+W]&&x.addFallback(U,"SHADOWPOISSON"+W),u["SHADOWESM"+W]&&x.addFallback(U,"SHADOWESM"+W),u["SHADOWCLOSEESM"+W]&&x.addFallback(U,"SHADOWCLOSEESM"+W));return _++}function B(u,x){return x.fogEnabled&&u.applyFog&&0!==x.fogMode}function Z(u,x,s,U,_,W,c,I=!1){c._areMiscDirty&&(c["LOGARITHMICDEPTH"]=s,c["POINTSIZE"]=U,c["FOG"]=_&&B(u,x),c["NONUNIFORMSCALING"]=u.nonUniformScaling,c["ALPHATEST"]=W,c["DECAL_AFTER_DETAIL"]=I)}function v(u,x,s,U,_=4,W=!1){if(!s._areLightsDirty)return s._needNormals;let c=0;const I={needNormals:s._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(u.lightsEnabled&&!W)for(const W of x.lightSources)if(y(u,x,W,c,s,U,I),c++,c===_)break;s["SPECULARTERM"]=I.specularEnabled,s["SHADOWS"]=I.shadowEnabled;for(let u=c;u<_;u++)void 0!==s["LIGHT"+u]&&(s["LIGHT"+u]=!1,s["HEMILIGHT"+u]=!1,s["POINTLIGHT"+u]=!1,s["DIRLIGHT"+u]=!1,s["SPOTLIGHT"+u]=!1,s["SHADOW"+u]=!1,s["SHADOWCSM"+u]=!1,s["SHADOWCSMDEBUG"+u]=!1,s["SHADOWCSMNUM_CASCADES"+u]=!1,s["SHADOWCSMUSESHADOWMAXZ"+u]=!1,s["SHADOWCSMNOBLEND"+u]=!1,s["SHADOWCSM_RIGHTHANDED"+u]=!1,s["SHADOWPCF"+u]=!1,s["SHADOWPCSS"+u]=!1,s["SHADOWPOISSON"+u]=!1,s["SHADOWESM"+u]=!1,s["SHADOWCLOSEESM"+u]=!1,s["SHADOWCUBE"+u]=!1,s["SHADOWLOWQUALITY"+u]=!1,s["SHADOWMEDIUMQUALITY"+u]=!1);const L=u.getEngine().getCaps();return void 0===s["SHADOWFLOAT"]&&(I.needRebuild=!0),s["SHADOWFLOAT"]=I.shadowEnabled&&(L.textureFloatRender&&L.textureFloatLinearFiltering||L.textureHalfFloatRender&&L.textureHalfFloatLinearFiltering),s["LIGHTMAPEXCLUDED"]=I.lightmapMode,I.needRebuild&&s.rebuild(),I.needNormals}function y(u,x,s,U,_,W,I){var L;switch(I.needNormals=!0,void 0===_["LIGHT"+U]&&(I.needRebuild=!0),_["LIGHT"+U]=!0,_["SPOTLIGHT"+U]=!1,_["HEMILIGHT"+U]=!1,_["POINTLIGHT"+U]=!1,_["DIRLIGHT"+U]=!1,s.prepareLightSpecificDefines(_,U),_["LIGHT_FALLOFF_PHYSICAL"+U]=!1,_["LIGHT_FALLOFF_GLTF"+U]=!1,_["LIGHT_FALLOFF_STANDARD"+U]=!1,s.falloffType){case c.c.FALLOFF_GLTF:_["LIGHT_FALLOFF_GLTF"+U]=!0;break;case c.c.FALLOFF_PHYSICAL:_["LIGHT_FALLOFF_PHYSICAL"+U]=!0;break;case c.c.FALLOFF_STANDARD:_["LIGHT_FALLOFF_STANDARD"+U]=!0}if(W&&!s.specular.equalsFloats(0,0,0)&&(I.specularEnabled=!0),_["SHADOW"+U]=!1,_["SHADOWCSM"+U]=!1,_["SHADOWCSMDEBUG"+U]=!1,_["SHADOWCSMNUM_CASCADES"+U]=!1,_["SHADOWCSMUSESHADOWMAXZ"+U]=!1,_["SHADOWCSMNOBLEND"+U]=!1,_["SHADOWCSM_RIGHTHANDED"+U]=!1,_["SHADOWPCF"+U]=!1,_["SHADOWPCSS"+U]=!1,_["SHADOWPOISSON"+U]=!1,_["SHADOWESM"+U]=!1,_["SHADOWCLOSEESM"+U]=!1,_["SHADOWCUBE"+U]=!1,_["SHADOWLOWQUALITY"+U]=!1,_["SHADOWMEDIUMQUALITY"+U]=!1,x&&x.receiveShadows&&u.shadowsEnabled&&s.shadowEnabled){const x=null!==(L=s.getShadowGenerator(u.activeCamera))&&void 0!==L?L:s.getShadowGenerator();if(x){const u=x.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(I.shadowEnabled=!0,x.prepareDefines(_,U))}}s.lightmapMode!=c.c.LIGHTMAP_DEFAULT?(I.lightmapMode=!0,_["LIGHTMAPEXCLUDED"+U]=!0,_["LIGHTMAPNOSPECULAR"+U]=s.lightmapMode==c.c.LIGHTMAP_SHADOWSONLY):(_["LIGHTMAPEXCLUDED"+U]=!1,_["LIGHTMAPNOSPECULAR"+U]=!1)}function e(u,x,s,U,_,W=null,c=!1){let L=X(u,U);!1!==W&&(L=I.Eq(s,u,U)),U["DEPTHPREPASS"]!==!x.getColorWrite()&&(U["DEPTHPREPASS"]=!U["DEPTHPREPASS"],L=!0),U["INSTANCES"]!==_&&(U["INSTANCES"]=_,L=!0),U["THIN_INSTANCES"]!==c&&(U["THIN_INSTANCES"]=c,L=!0),L&&U.markAsUnprocessed()}function T(u,x){if(u.useBones&&u.computeBonesUsingShaders&&u.skeleton){x["NUM_BONE_INFLUENCERS"]=u.numBoneInfluencers;const s=void 0!==x["BONETEXTURE"];if(u.skeleton.isUsingTextureForMatrices&&s)x["BONETEXTURE"]=!0;else{x["BonesPerMesh"]=u.skeleton.bones.length+1,x["BONETEXTURE"]=!s&&void 0;const U=u.getScene().prePassRenderer;if(U&&U.enabled){const s=-1===U.excludedSkinnedMesh.indexOf(u);x["BONES_VELOCITY_ENABLED"]=s}}}else x["NUM_BONE_INFLUENCERS"]=0,x["BonesPerMesh"]=0,void 0!==x["BONETEXTURE"]&&(x["BONETEXTURE"]=!1)}function Q(u,x){const s=u.morphTargetManager;s?(x["MORPHTARGETS_UV"]=s.supportsUVs&&x["UV1"],x["MORPHTARGETS_TANGENT"]=s.supportsTangents&&x["TANGENT"],x["MORPHTARGETS_NORMAL"]=s.supportsNormals&&x["NORMAL"],x["NUM_MORPH_INFLUENCERS"]=s.numMaxInfluencers||s.numInfluencers,x["MORPHTARGETS"]=x["NUM_MORPH_INFLUENCERS"]>0,x["MORPHTARGETS_TEXTURE"]=s.isUsingTextureForTargets):(x["MORPHTARGETS_UV"]=!1,x["MORPHTARGETS_TANGENT"]=!1,x["MORPHTARGETS_NORMAL"]=!1,x["MORPHTARGETS"]=!1,x["NUM_MORPH_INFLUENCERS"]=0)}function E(u,x){const s=u.bakedVertexAnimationManager;x["BAKED_VERTEX_ANIMATION_TEXTURE"]=!(!s||!s.isEnabled)}function l(u,x,s,U,_=!1,W=!0,c=!0){if(!x._areAttributesDirty&&x._needNormals===x._normals&&x._needUVs===x._uvs)return!1;x._normals=x._needNormals,x._uvs=x._needUVs,x["NORMAL"]=x._needNormals&&u.isVerticesDataPresent(`normal`),x._needNormals&&u.isVerticesDataPresent(`tangent`)&&(x["TANGENT"]=!0);for(let s=1;s<=6;++s)x["UV"+s]=!!x._needUVs&&u.isVerticesDataPresent(`uv${1===s?"":s}`);if(s){const s=u.useVertexColors&&u.isVerticesDataPresent(`color`);x["VERTEXCOLOR"]=s,x["VERTEXALPHA"]=u.hasVertexAlpha&&s&&W}return u.isVerticesDataPresent(`instanceColor`)&&(u.hasInstances||u.hasThinInstances)&&(x["INSTANCESCOLOR"]=!0),U&&T(u,x),_&&Q(u,x),c&&E(u,x),!0}function z(u,x){if(u.activeCamera){const s=x.MULTIVIEW;x.MULTIVIEW=null!==u.activeCamera.outputRenderTarget&&u.activeCamera.outputRenderTarget.getViewCount()>1,x.MULTIVIEW!=s&&x.markAsUnprocessed()}}function S(u,x,s){const U=x.ORDER_INDEPENDENT_TRANSPARENCY,_=x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;x.ORDER_INDEPENDENT_TRANSPARENCY=u.useOrderIndependentTransparency&&s,x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!u.getEngine().getCaps().textureFloatLinearFiltering,U===x.ORDER_INDEPENDENT_TRANSPARENCY&&_===x.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||x.markAsUnprocessed()}function R(u,x,s){const U=x.PREPASS;if(!x._arePrePassDirty)return;const _=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_NDC_DEPTH",index:"PREPASS_NDC_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(u.prePassRenderer&&u.prePassRenderer.enabled&&s){x.PREPASS=!0,x.SCENE_MRT_COUNT=u.prePassRenderer.mrtCount,x.PREPASS_NORMAL_WORLDSPACE=u.prePassRenderer.generateNormalsInWorldSpace;for(let s=0;s<_.length;s++){const U=u.prePassRenderer.getIndex(_[s].type);-1!==U?(x[_[s].define]=!0,x[_[s].index]=U):x[_[s].define]=!1}}else{x.PREPASS=!1;for(let u=0;u<_.length;u++)x[_[u].define]=!1}x.PREPASS!=U&&(x.markAsUnprocessed(),x.markAsImageProcessingDirty())}function X(u,x){let s=!1;if(u.activeCamera){const U=x["CAMERA_ORTHOGRAPHIC"]?1:0,_=x["CAMERA_PERSPECTIVE"]?1:0,W=1===u.activeCamera.mode?1:0,c=0===u.activeCamera.mode?1:0;(U^W||_^c)&&(x["CAMERA_ORTHOGRAPHIC"]=1===W,x["CAMERA_PERSPECTIVE"]=1===c,s=!0)}return s}function p(u,x,s,U,_=null,W=!1){_&&_.push("Light"+u),W||(x.push("vLightData"+u,"vLightDiffuse"+u,"vLightSpecular"+u,"vLightDirection"+u,"vLightFalloff"+u,"vLightGround"+u,"lightMatrix"+u,"shadowsInfo"+u,"depthValues"+u),s.push("shadowTexture"+u),s.push("depthTexture"+u),x.push("viewFrustumZ"+u,"cascadeBlendFactor"+u,"lightSizeUVCorrection"+u,"depthCorrection"+u,"penumbraDarkness"+u,"frustumLengths"+u),U&&(s.push("projectionLightTexture"+u),x.push("textureProjectionMatrix"+u)))}function G(u,x,s,U=4){let _,W=null;if(u.uniformsNames){const c=u;_=c.uniformsNames,W=c.uniformBuffersNames,x=c.samplers,s=c.defines,U=c.maxSimultaneousLights||0}else _=u,x||(x=[]);for(let u=0;u<U&&s["LIGHT"+u];u++)p(u,_,x,s["PROJECTEDLIGHTTEXTURE"+u],W);s["NUM_MORPH_INFLUENCERS"]&&(_.push("morphTargetInfluences"),_.push("morphTargetCount")),s["BAKED_VERTEX_ANIMATION_TEXTURE"]&&(_.push("bakedVertexAnimationSettings"),_.push("bakedVertexAnimationTextureSizeInverted"),_.push("bakedVertexAnimationTime"),x.push("bakedVertexAnimationTexture"))}},185537:(u,x,s)=>{s.d(x,{y:()=>L});var U=s(297809),_=s(760998),W=s(586365),c=s(337776),I=s(310035);class L{isCompatible(u){return 0===u}_enable(u){u&&this._pluginManager._activatePlugin(this)}constructor(u,x,s,U,_=!0,c=!1,I=!1){this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=u,this.name=x,this.priority=s,this.resolveIncludes=I,u.pluginManager||(u.pluginManager=new W.uZ(u),u.onDisposeObservable.add((()=>{u.pluginManager=void 0}))),this._pluginDefineNames=U,this._pluginManager=u.pluginManager,_&&this._pluginManager._addPlugin(this),c&&this._enable(!0),this.markAllDefinesAsDirty=u._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(u,x,s,U){return!0}hardBindForSubMesh(u,x,s,U){}bindForSubMesh(u,x,s,U){}dispose(u){}getCustomCode(u,x=0){return null}collectDefines(u){if(this._pluginDefineNames)for(const x of Object.keys(this._pluginDefineNames)){if("_"===x[0])continue;const s=typeof this._pluginDefineNames[x];u[x]={type:"number"===s?"number":"string"===s?"string":"boolean"===s?"boolean":"object",default:this._pluginDefineNames[x]}}}prepareDefinesBeforeAttributes(u,x,s){}prepareDefines(u,x,s){}hasTexture(u){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(u){}getActiveTextures(u){}getAnimatables(u){}addFallbacks(u,x,s){return s}getSamplers(u){}getAttributes(u,x,s){}getUniformBuffersNames(u){}getUniforms(u=0){return{}}copyTo(u){c.p.Clone((()=>u),this)}serialize(){return c.p.Serialize(this)}parse(u,x,s){c.p.Parse((()=>this),u,x,s)}}U.Cg([_.lK()],L.prototype,"name",void 0),U.Cg([_.lK()],L.prototype,"priority",void 0),U.Cg([_.lK()],L.prototype,"resolveIncludes",void 0),U.Cg([_.lK()],L.prototype,"registerForExtraEvents",void 0),I.Y5("BABYLON.MaterialPluginBase",L)},586365:(u,x,s)=>{s.d(x,{YC:()=>d,lM:()=>j,tC:()=>r,uZ:()=>L});var U=s(55973),_=s(395726),W=s(867967),c=s(395879);const I=new RegExp("^([gimus]+)!");class L{constructor(u){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=u,this._scene=u.getScene(),this._engine=this._scene.getEngine()}_addPlugin(u){for(let x=0;x<this._plugins.length;++x)if(this._plugins[x].name===u.name)return!1;if(this._material._uniformBufferLayoutBuilt)throw`The plugin "${u.name}" can't be added to the material "${this._material.name}" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.`;if(!u.isCompatible(this._material.shaderLanguage))throw`The plugin "${u.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const x=u.getClassName();L._MaterialPluginClassToMainDefine[x]||(L._MaterialPluginClassToMainDefine[x]="MATERIALPLUGIN_"+ ++L._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(u,x)=>this._handlePluginEvent(u,x),this._plugins.push(u),this._plugins.sort(((u,x)=>u.priority-x.priority)),this._codeInjectionPoints={};const s={};s[L._MaterialPluginClassToMainDefine[x]]={type:"boolean",default:!0};for(const u of this._plugins)u.collectDefines(s),this._collectPointNames("vertex",u.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",u.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=s,!0}_activatePlugin(u){-1===this._activePlugins.indexOf(u)&&(this._activePlugins.push(u),this._activePlugins.sort(((u,x)=>u.priority-x.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),u.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(u),this._activePluginsForExtraEvents.sort(((u,x)=>u.priority-x.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(u){for(let x=0;x<this._plugins.length;++x)if(this._plugins[x].name===u)return this._plugins[x];return null}_handlePluginEventIsReadyForSubMesh(u){let x=!0;for(const s of this._activePlugins)x=x&&s.isReadyForSubMesh(u.defines,this._scene,this._engine,u.subMesh);u.isReadyForSubMesh=x}_handlePluginEventPrepareDefinesBeforeAttributes(u){for(const x of this._activePlugins)x.prepareDefinesBeforeAttributes(u.defines,this._scene,u.mesh)}_handlePluginEventPrepareDefines(u){for(const x of this._activePlugins)x.prepareDefines(u.defines,this._scene,u.mesh)}_handlePluginEventHardBindForSubMesh(u){for(const x of this._activePluginsForExtraEvents)x.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,u.subMesh)}_handlePluginEventBindForSubMesh(u){for(const x of this._activePlugins)x.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,u.subMesh)}_handlePluginEventHasRenderTargetTextures(u){let x=!1;for(const u of this._activePluginsForExtraEvents)if(x=u.hasRenderTargetTextures(),x)break;u.hasRenderTargetTextures=x}_handlePluginEventFillRenderTargetTextures(u){for(const x of this._activePluginsForExtraEvents)x.fillRenderTargetTextures(u.renderTargets)}_handlePluginEvent(u,x){var s;switch(u){case 512:{const u=x;for(const x of this._activePlugins)x.getActiveTextures(u.activeTextures);break}case 256:{const u=x;for(const x of this._activePlugins)x.getAnimatables(u.animatables);break}case 1024:{const u=x;let s=!1;for(const x of this._activePlugins)if(s=x.hasTexture(u.texture),s)break;u.hasTexture=s;break}case 2:{const u=x;for(const x of this._plugins)x.dispose(u.forceDisposeTextures);break}case 4:x.defineNames=this._defineNamesFromPlugins;break;case 128:{const u=x;for(const x of this._activePlugins)u.fallbackRank=x.addFallbacks(u.defines,u.fallbacks,u.fallbackRank),x.getAttributes(u.attributes,this._scene,u.mesh);this._uniformList.length>0&&u.uniforms.push(...this._uniformList),this._samplerList.length>0&&u.samplers.push(...this._samplerList),this._uboList.length>0&&u.uniformBuffersNames.push(...this._uboList),u.customCode=this._injectCustomCode(u,u.customCode);break}case 8:{const u=x;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const U=1===this._material.shaderLanguage;for(const x of this._plugins){const _=x.getUniforms(this._material.shaderLanguage);if(_){if(_.ubo)for(const x of _.ubo){if(x.size&&x.type){const _=null!==(s=x.arraySize)&&void 0!==s?s:0;if(u.ubo.addUniform(x.name,x.size,_),U){let u;switch(x.type){case"mat4":u="mat4x4f";break;case"float":u="f32";break;default:u=`${x.type}f`}this._uboDeclaration+=`uniform ${x.name}: ${u}${_>0?`[${_}]`:""};\n`}else this._uboDeclaration+=`${x.type} ${x.name}${_>0?`[${_}]`:""};\n`}this._uniformList.push(x.name)}_.vertex&&(this._vertexDeclaration+=_.vertex+"\n"),_.fragment&&(this._fragmentDeclaration+=_.fragment+"\n")}x.getSamplers(this._samplerList),x.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(u,x){if(x)for(const s in x)this._codeInjectionPoints[u]||(this._codeInjectionPoints[u]={}),this._codeInjectionPoints[u][s]=!0}_injectCustomCode(u,x){return(s,U)=>{var _,L;x&&(U=x(s,U)),this._uboDeclaration&&(U=U.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(U=U.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(U=U.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const J=null===(_=this._codeInjectionPoints)||void 0===_?void 0:_[s];if(!J)return U;let k=null;for(let x in J){let _="";for(const U of this._activePlugins){let I=null===(L=U.getCustomCode(s,this._material.shaderLanguage))||void 0===L?void 0:L[x];if(I){if(U.resolveIncludes){if(null===k){const x=0;k={defines:[],indexParameters:u.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:c.l.GetShadersRepository(x),includesShadersStore:c.l.GetIncludesShadersStore(x),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}k.isFragment="fragment"===s,W.Iq(I,k,(u=>I=u))}_+=I+"\n"}}if(_.length>0)if("!"===x.charAt(0)){x=x.substring(1);let u="g";if("!"===x.charAt(0))u="",x=x.substring(1);else{const s=I.exec(x);s&&s.length>=2&&(u=s[1],x=x.substring(u.length+1))}u.indexOf("g")<0&&(u+="g");const s=U,W=new RegExp(x,u);let c=W.exec(s);for(;null!==c;){let u=_;for(let x=0;x<c.length;++x)u=u.replace("$"+x,c[x]);U=U.replace(c[0],u),c=W.exec(s)}}else{const u="#define "+x;U=U.replace(u,"\n"+_+"\n"+u)}}return U}}}L._MaterialPluginClassToMainDefine={},L._MaterialPluginCounter=0,_.q.OnEnginesDisposedObservable.add((()=>{r()}));const J=[];let k=!1,i=null;function d(u,x){k||(i=U.i.OnEventObservable.add((u=>{for(const[,x]of J)x(u)}),1),k=!0);const s=J.filter((([x,s])=>x===u));s.length>0?s[0][1]=x:J.push([u,x])}function j(u){for(let x=0;x<J.length;++x)if(J[x][0]===u)return J.splice(x,1),0===J.length&&r(),!0;return!1}function r(){J.length=0,k=!1,U.i.OnEventObservable.remove(i),i=null}},234412:(u,x,s)=>{s.d(x,{F:()=>c});var U=s(55973),_=s(443401),W=s(310035);class c extends U.i{get subMaterials(){return this._subMaterials}set subMaterials(u){this._subMaterials=u,this._hookArray(u)}getChildren(){return this.subMaterials}constructor(u,x){super(u,x,!0),this._waitingSubMaterialsUniqueIds=[],this.getScene().addMultiMaterial(this),this.subMaterials=[],this._storeEffectOnSubMeshes=!0}_hookArray(u){const x=u.push;u.push=(...s)=>{const U=x.apply(u,s);return this._markAllSubMeshesAsTexturesDirty(),U};const s=u.splice;u.splice=(x,U)=>{const _=s.apply(u,[x,U]);return this._markAllSubMeshesAsTexturesDirty(),_}}getSubMaterial(u){return u<0||u>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[u]}getActiveTextures(){return super.getActiveTextures().concat(...this.subMaterials.map((u=>u?u.getActiveTextures():[])))}hasTexture(u){var x;if(super.hasTexture(u))return!0;for(let s=0;s<this.subMaterials.length;s++)if(null===(x=this.subMaterials[s])||void 0===x?void 0:x.hasTexture(u))return!0;return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(u,x,s){for(let U=0;U<this.subMaterials.length;U++){const _=this.subMaterials[U];if(_){if(_._storeEffectOnSubMeshes){if(!_.isReadyForSubMesh(u,x,s))return!1;continue}if(!_.isReady(u))return!1}}return!0}clone(u,x){const s=new c(u,this.getScene());for(let U=0;U<this.subMaterials.length;U++){let _=null;const W=this.subMaterials[U];_=x&&W?W.clone(u+"-"+W.name):this.subMaterials[U],s.subMaterials.push(_)}return s}serialize(){const u={};u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,_.Y&&(u.tags=_.Y.GetTags(this)),u.materialsUniqueIds=[],u.materials=[];for(let x=0;x<this.subMaterials.length;x++){const s=this.subMaterials[x];s?(u.materialsUniqueIds.push(s.uniqueId),u.materials.push(s.id)):(u.materialsUniqueIds.push(null),u.materials.push(null))}return u}dispose(u,x,s){const U=this.getScene();if(!U)return;if(s)for(let s=0;s<this.subMaterials.length;s++){const U=this.subMaterials[s];U&&U.dispose(u,x)}const _=U.multiMaterials.indexOf(this);_>=0&&U.multiMaterials.splice(_,1),super.dispose(u,x)}static ParseMultiMaterial(u,x){const s=new c(u.name,x);return s.id=u.id,s._loadedUniqueId=u.uniqueId,_.Y&&_.Y.AddTagsTo(s,u.tags),u.materialsUniqueIds?s._waitingSubMaterialsUniqueIds=u.materialsUniqueIds:u.materials.forEach((u=>s.subMaterials.push(x.getLastMaterialById(u)))),s}}W.Y5("BABYLON.MultiMaterial",c)},626956:(u,x,s)=>{s.d(x,{J:()=>U});class U{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(u){u.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(u){}bindForSubMesh(u,x,s,U,_){if(x.prePassRenderer&&x.prePassRenderer.enabled&&x.prePassRenderer.currentRTisSceneRT&&(-1!==x.prePassRenderer.getIndex(2)||-1!==x.prePassRenderer.getIndex(11))){this.previousWorldMatrices[s.uniqueId]||(this.previousWorldMatrices[s.uniqueId]=U.clone()),this.previousViewProjection||(this.previousViewProjection=x.getTransformMatrix().clone(),this.currentViewProjection=x.getTransformMatrix().clone());const _=x.getEngine();this.currentViewProjection.updateFlag!==x.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=_.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection),this.currentViewProjection.copyFrom(x.getTransformMatrix())):this._lastUpdateFrameId!==_.frameId&&(this._lastUpdateFrameId=_.frameId,this.previousViewProjection.copyFrom(this.currentViewProjection)),u.setMatrix("previousWorld",this.previousWorldMatrices[s.uniqueId]),u.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[s.uniqueId]=U.clone()}}}},235519:(u,x,s)=>{s.d(x,{E:()=>W});var U=s(604910),_=s(55973);class W extends _.i{constructor(u,x,s=!0){super(u,x),this._normalMatrix=new U.uq,this._storeEffectOnSubMeshes=s}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(u,x){return!!u&&(!this._storeEffectOnSubMeshes||!u.subMeshes||0===u.subMeshes.length||this.isReadyForSubMesh(u,u.subMeshes[0],x))}_isReadyForSubMesh(u){const x=u.materialDefines;return!(this.checkReadyOnEveryCall||!u.effect||!x||x._renderId!==this.getScene().getRenderId())}bindOnlyWorldMatrix(u){this._activeEffect.setMatrix("world",u)}bindOnlyNormalMatrix(u){this._activeEffect.setMatrix("normalMatrix",u)}bind(u,x){x&&this.bindForSubMesh(u,x,x.subMeshes[0])}_afterBind(u,x=null,s){super._afterBind(u,x,s),this.getScene()._cachedEffect=x,s?s._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(u,x,s,U=1){return s._drawWrapper._forceRebindOnNextCall||u.isCachedMaterialInvalid(this,x,U)}dispose(u,x,s){this._activeEffect=void 0,super.dispose(u,x,s)}}},648826:(u,x,s)=>{s.d(x,{B:()=>H});var U=s(337776),_=s(889460),W=s(604910),c=s(23987),I=s(432050),L=s(310035),J=s(332290),k=s(522208),i=s(732259),d=s(235519),j=s(395726),r=s(651577),D=s(855300);const $={effect:null,subMesh:null};class H extends d.E{constructor(u,x,s,U={},_=!0){super(u,x,_),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new W.uq,this._cachedWorldViewProjectionMatrix=new W.uq,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=s,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...U}}get shaderPath(){return this._shaderPath}set shaderPath(u){this._shaderPath=u}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(u){-1===this._options.uniforms.indexOf(u)&&this._options.uniforms.push(u)}setTexture(u,x){return-1===this._options.samplers.indexOf(u)&&this._options.samplers.push(u),this._textures[u]=x,this}setTextureArray(u,x){return-1===this._options.samplers.indexOf(u)&&this._options.samplers.push(u),this._checkUniform(u),this._textureArrays[u]=x,this}setExternalTexture(u,x){return-1===this._options.externalTextures.indexOf(u)&&this._options.externalTextures.push(u),this._externalTextures[u]=x,this}setFloat(u,x){return this._checkUniform(u),this._floats[u]=x,this}setInt(u,x){return this._checkUniform(u),this._ints[u]=x,this}setUInt(u,x){return this._checkUniform(u),this._uints[u]=x,this}setFloats(u,x){return this._checkUniform(u),this._floatsArrays[u]=x,this}setColor3(u,x){return this._checkUniform(u),this._colors3[u]=x,this}setColor3Array(u,x){return this._checkUniform(u),this._colors3Arrays[u]=x.reduce(((u,x)=>(x.toArray(u,u.length),u)),[]),this}setColor4(u,x){return this._checkUniform(u),this._colors4[u]=x,this}setColor4Array(u,x){return this._checkUniform(u),this._colors4Arrays[u]=x.reduce(((u,x)=>(x.toArray(u,u.length),u)),[]),this}setVector2(u,x){return this._checkUniform(u),this._vectors2[u]=x,this}setVector3(u,x){return this._checkUniform(u),this._vectors3[u]=x,this}setVector4(u,x){return this._checkUniform(u),this._vectors4[u]=x,this}setQuaternion(u,x){return this._checkUniform(u),this._quaternions[u]=x,this}setQuaternionArray(u,x){return this._checkUniform(u),this._quaternionsArrays[u]=x.reduce(((u,x)=>(x.toArray(u,u.length),u)),[]),this}setMatrix(u,x){return this._checkUniform(u),this._matrices[u]=x,this}setMatrices(u,x){this._checkUniform(u);const s=new Float32Array(16*x.length);for(let u=0;u<x.length;u++)x[u].copyToArray(s,16*u);return this._matrixArrays[u]=s,this}setMatrix3x3(u,x){return this._checkUniform(u),this._matrices3x3[u]=x,this}setMatrix2x2(u,x){return this._checkUniform(u),this._matrices2x2[u]=x,this}setArray2(u,x){return this._checkUniform(u),this._vectors2Arrays[u]=x,this}setArray3(u,x){return this._checkUniform(u),this._vectors3Arrays[u]=x,this}setArray4(u,x){return this._checkUniform(u),this._vectors4Arrays[u]=x,this}setUniformBuffer(u,x){return-1===this._options.uniformBuffers.indexOf(u)&&this._options.uniformBuffers.push(u),this._uniformBuffers[u]=x,this}setTextureSampler(u,x){return-1===this._options.samplerObjects.indexOf(u)&&this._options.samplerObjects.push(u),this._textureSamplers[u]=x,this}setStorageBuffer(u,x){return-1===this._options.storageBuffers.indexOf(u)&&this._options.storageBuffers.push(u),this._storageBuffers[u]=x,this}setDefine(u,x){const s=u.trimEnd()+" ",U=this.options.defines.findIndex((x=>x===u||x.startsWith(s)));return U>=0&&this.options.defines.splice(U,1),("boolean"!=typeof x||x)&&this.options.defines.push(s+x),this}isReadyForSubMesh(u,x,s){return this.isReady(u,s,x)}isReady(u,x,s){var U,W,I,L;const J=s&&this._storeEffectOnSubMeshes;if(this.isFrozen){const u=J?s._drawWrapper:this._drawWrapper;if(u.effect&&u._wasPreviouslyReady&&u._wasPreviouslyUsingInstances===x)return!0}const i=this.getScene(),d=i.getEngine(),j=[],H=[],f=new k.J;let O=this._shaderPath,t=this._options.uniforms,V=this._options.uniformBuffers,N=this._options.samplers;d.getCaps().multiview&&i.activeCamera&&i.activeCamera.outputRenderTarget&&i.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,j.push("#define MULTIVIEW"),-1!==t.indexOf("viewProjection")&&-1===t.indexOf("viewProjectionR")&&t.push("viewProjectionR"));for(let u=0;u<this._options.defines.length;u++){const x=0===this._options.defines[u].indexOf("#define")?this._options.defines[u]:`#define ${this._options.defines[u]}`;j.push(x)}for(let u=0;u<this._options.attributes.length;u++)H.push(this._options.attributes[u]);if(u&&u.isVerticesDataPresent(c.R.ColorKind)&&(-1===H.indexOf(c.R.ColorKind)&&H.push(c.R.ColorKind),j.push("#define VERTEXCOLOR")),x&&(j.push("#define INSTANCES"),D.te(H,this._materialHelperNeedsPreviousMatrices),(null==u?void 0:u.hasThinInstances)&&(j.push("#define THIN_INSTANCES"),u&&u.isVerticesDataPresent(c.R.ColorInstanceKind)&&(H.push(c.R.ColorInstanceKind),j.push("#define INSTANCESCOLOR")))),u&&u.useBones&&u.computeBonesUsingShaders&&u.skeleton){H.push(c.R.MatricesIndicesKind),H.push(c.R.MatricesWeightsKind),u.numBoneInfluencers>4&&(H.push(c.R.MatricesIndicesExtraKind),H.push(c.R.MatricesWeightsExtraKind));const x=u.skeleton;j.push("#define NUM_BONE_INFLUENCERS "+u.numBoneInfluencers),f.addCPUSkinningFallback(0,u),x.isUsingTextureForMatrices?(j.push("#define BONETEXTURE"),-1===t.indexOf("boneTextureWidth")&&t.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(j.push("#define BonesPerMesh "+(x.bones.length+1)),-1===t.indexOf("mBones")&&t.push("mBones"))}else j.push("#define NUM_BONE_INFLUENCERS 0");let m=0;const b=u?u.morphTargetManager:null;if(b){const u=b.supportsUVs&&-1!==j.indexOf("#define UV1"),x=b.supportsTangents&&-1!==j.indexOf("#define TANGENT"),s=b.supportsNormals&&-1!==j.indexOf("#define NORMAL");m=b.numMaxInfluencers||b.numInfluencers,u&&j.push("#define MORPHTARGETS_UV"),x&&j.push("#define MORPHTARGETS_TANGENT"),s&&j.push("#define MORPHTARGETS_NORMAL"),m>0&&j.push("#define MORPHTARGETS"),b.isUsingTextureForTargets&&(j.push("#define MORPHTARGETS_TEXTURE"),-1===t.indexOf("morphTargetTextureIndices")&&t.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),j.push("#define NUM_MORPH_INFLUENCERS "+m);for(let U=0;U<m;U++)H.push(c.R.PositionKind+U),s&&H.push(c.R.NormalKind+U),x&&H.push(c.R.TangentKind+U),u&&H.push(c.R.UVKind+"_"+U);m>0&&(t=t.slice(),t.push("morphTargetInfluences"),t.push("morphTargetCount"),t.push("morphTargetTextureInfo"),t.push("morphTargetTextureIndices"))}else j.push("#define NUM_MORPH_INFLUENCERS 0");if(u){const x=u.bakedVertexAnimationManager;x&&x.isEnabled&&(j.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===t.indexOf("bakedVertexAnimationSettings")&&t.push("bakedVertexAnimationSettings"),-1===t.indexOf("bakedVertexAnimationTextureSizeInverted")&&t.push("bakedVertexAnimationTextureSizeInverted"),-1===t.indexOf("bakedVertexAnimationTime")&&t.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),D.J2(H,u,j)}for(const u in this._textures)if(!this._textures[u].isReady())return!1;u&&this._shouldTurnAlphaTestOn(u)&&j.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&(r.TV(t),r.tv(this,i,j)),i.fogEnabled&&(null==u?void 0:u.applyFog)&&i.fogMode!==_.Z.FOGMODE_NONE&&(j.push("#define FOG"),-1===t.indexOf("view")&&t.push("view"),-1===t.indexOf("vFogInfos")&&t.push("vFogInfos"),-1===t.indexOf("vFogColor")&&t.push("vFogColor")),this._useLogarithmicDepth&&(j.push("#define LOGARITHMICDEPTH"),-1===t.indexOf("logarithmicDepthConstant")&&t.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(t=t.slice(),V=V.slice(),N=N.slice(),O=this.customShaderNameResolve(this.name,t,V,N,j,H));const n=J?s._getDrawWrapper(void 0,!0):this._drawWrapper,F=null!==(U=null==n?void 0:n.effect)&&void 0!==U?U:null,B=null!==(W=null==n?void 0:n.defines)&&void 0!==W?W:null,Z=j.join("\n");let v=F;return B!==Z&&(v=d.createEffect(O,{attributes:H,uniformsNames:t,uniformBuffersNames:V,samplers:N,defines:Z,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:m},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},d),J?s.setEffect(v,Z,this._materialContext):n&&n.setEffect(v,Z),this._onEffectCreatedObservable&&($.effect=v,$.subMesh=null!==(I=null!=s?s:null==u?void 0:u.subMeshes[0])&&void 0!==I?I:null,this._onEffectCreatedObservable.notifyObservers($))),n._wasPreviouslyUsingInstances=!!x,null!==(L=!(null==v?void 0:v.isReady()))&&void 0!==L&&!L&&(F!==v&&i.resetCachedMaterial(),n._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(u,x){const s=this.getScene(),U=null!=x?x:this.getEffect();U&&(-1!==this._options.uniforms.indexOf("world")&&U.setMatrix("world",u),-1!==this._options.uniforms.indexOf("worldView")&&(u.multiplyToRef(s.getViewMatrix(),this._cachedWorldViewMatrix),U.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(u.multiplyToRef(s.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),U.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&U.setMatrix("view",s.getViewMatrix()))}bindForSubMesh(u,x,s){var U;this.bind(u,x,null===(U=s._drawWrapperOverride)||void 0===U?void 0:U.effect,s)}bind(u,x,s,U){var _;const W=U&&this._storeEffectOnSubMeshes,c=null!=s?s:W?U.effect:this.getEffect();if(!c)return;const I=this.getScene();this._activeEffect=c,this.bindOnlyWorldMatrix(u,s);const L=this._options.uniformBuffers;let J=!1;if(c&&L&&L.length>0&&I.getEngine().supportsUniformBuffers)for(let s=0;s<L.length;++s)switch(L[s]){case"Mesh":x&&(x.getMeshUniformBuffer().bindToEffect(c,"Mesh"),x.transferToEffect(u));break;case"Scene":D._8(c,I.getSceneUniformBuffer()),I.finalizeSceneUbo(),J=!0}const k=x&&W?this._mustRebind(I,c,U,x.visibility):I.getCachedMaterial()!==this;if(c&&k){let u;for(u in J||-1===this._options.uniforms.indexOf("view")||c.setMatrix("view",I.getViewMatrix()),J||-1===this._options.uniforms.indexOf("projection")||c.setMatrix("projection",I.getProjectionMatrix()),J||-1===this._options.uniforms.indexOf("viewProjection")||(c.setMatrix("viewProjection",I.getTransformMatrix()),this._multiview&&c.setMatrix("viewProjectionR",I._transformMatrixR)),I.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&c.setVector3("cameraPosition",I.activeCamera.globalPosition),D.f$(x,c),r.gS(c,this,I),this._useLogarithmicDepth&&D.DL(W?U.materialDefines:c.defines,c,I),x&&D.Yy(I,x,c),this._textures)c.setTexture(u,this._textures[u]);for(u in this._textureArrays)c.setTextureArray(u,this._textureArrays[u]);for(u in this._ints)c.setInt(u,this._ints[u]);for(u in this._uints)c.setUInt(u,this._uints[u]);for(u in this._floats)c.setFloat(u,this._floats[u]);for(u in this._floatsArrays)c.setArray(u,this._floatsArrays[u]);for(u in this._colors3)c.setColor3(u,this._colors3[u]);for(u in this._colors3Arrays)c.setArray3(u,this._colors3Arrays[u]);for(u in this._colors4){const x=this._colors4[u];c.setFloat4(u,x.r,x.g,x.b,x.a)}for(u in this._colors4Arrays)c.setArray4(u,this._colors4Arrays[u]);for(u in this._vectors2)c.setVector2(u,this._vectors2[u]);for(u in this._vectors3)c.setVector3(u,this._vectors3[u]);for(u in this._vectors4)c.setVector4(u,this._vectors4[u]);for(u in this._quaternions)c.setQuaternion(u,this._quaternions[u]);for(u in this._matrices)c.setMatrix(u,this._matrices[u]);for(u in this._matrixArrays)c.setMatrices(u,this._matrixArrays[u]);for(u in this._matrices3x3)c.setMatrix3x3(u,this._matrices3x3[u]);for(u in this._matrices2x2)c.setMatrix2x2(u,this._matrices2x2[u]);for(u in this._vectors2Arrays)c.setArray2(u,this._vectors2Arrays[u]);for(u in this._vectors3Arrays)c.setArray3(u,this._vectors3Arrays[u]);for(u in this._vectors4Arrays)c.setArray4(u,this._vectors4Arrays[u]);for(u in this._quaternionsArrays)c.setArray4(u,this._quaternionsArrays[u]);for(u in this._uniformBuffers){const x=this._uniformBuffers[u].getBuffer();x&&c.bindUniformBuffer(x,u)}const s=I.getEngine(),_=s.setExternalTexture;if(_)for(u in this._externalTextures)_.call(s,u,this._externalTextures[u]);const L=s.setTextureSampler;if(L)for(u in this._textureSamplers)L.call(s,u,this._textureSamplers[u]);const k=s.setStorageBuffer;if(k)for(u in this._storageBuffers)k.call(s,u,this._storageBuffers[u])}if(c&&x&&(k||!this.isFrozen)){const u=x.morphTargetManager;u&&u.numInfluencers>0&&D.nR(x,c);const s=x.bakedVertexAnimationManager;if(s&&s.isEnabled){const u=W?U._drawWrapper:this._drawWrapper;null===(_=x.bakedVertexAnimationManager)||void 0===_||_.bind(c,!!u._wasPreviouslyUsingInstances)}}this._afterBind(x,c,U)}getActiveTextures(){const u=super.getActiveTextures();for(const x in this._textures)u.push(this._textures[x]);for(const x in this._textureArrays){const s=this._textureArrays[x];for(let x=0;x<s.length;x++)u.push(s[x])}return u}hasTexture(u){if(super.hasTexture(u))return!0;for(const x in this._textures)if(this._textures[x]===u)return!0;for(const x in this._textureArrays){const s=this._textureArrays[x];for(let x=0;x<s.length;x++)if(s[x]===u)return!0}return!1}clone(u){const x=U.p.Clone((()=>new H(u,this.getScene(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);x.name=u,x.id=u,"object"==typeof x._shaderPath&&(x._shaderPath={...x._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((u=>{const x=this._options[u];Array.isArray(x)&&(this._options[u]=x.slice(0))})),this.stencil.copyTo(x.stencil);for(const u in this._textures)x.setTexture(u,this._textures[u]);for(const u in this._textureArrays)x.setTextureArray(u,this._textureArrays[u]);for(const u in this._externalTextures)x.setExternalTexture(u,this._externalTextures[u]);for(const u in this._ints)x.setInt(u,this._ints[u]);for(const u in this._uints)x.setUInt(u,this._uints[u]);for(const u in this._floats)x.setFloat(u,this._floats[u]);for(const u in this._floatsArrays)x.setFloats(u,this._floatsArrays[u]);for(const u in this._colors3)x.setColor3(u,this._colors3[u]);for(const u in this._colors3Arrays)x._colors3Arrays[u]=this._colors3Arrays[u];for(const u in this._colors4)x.setColor4(u,this._colors4[u]);for(const u in this._colors4Arrays)x._colors4Arrays[u]=this._colors4Arrays[u];for(const u in this._vectors2)x.setVector2(u,this._vectors2[u]);for(const u in this._vectors3)x.setVector3(u,this._vectors3[u]);for(const u in this._vectors4)x.setVector4(u,this._vectors4[u]);for(const u in this._quaternions)x.setQuaternion(u,this._quaternions[u]);for(const u in this._quaternionsArrays)x._quaternionsArrays[u]=this._quaternionsArrays[u];for(const u in this._matrices)x.setMatrix(u,this._matrices[u]);for(const u in this._matrixArrays)x._matrixArrays[u]=this._matrixArrays[u].slice();for(const u in this._matrices3x3)x.setMatrix3x3(u,this._matrices3x3[u]);for(const u in this._matrices2x2)x.setMatrix2x2(u,this._matrices2x2[u]);for(const u in this._vectors2Arrays)x.setArray2(u,this._vectors2Arrays[u]);for(const u in this._vectors3Arrays)x.setArray3(u,this._vectors3Arrays[u]);for(const u in this._vectors4Arrays)x.setArray4(u,this._vectors4Arrays[u]);for(const u in this._uniformBuffers)x.setUniformBuffer(u,this._uniformBuffers[u]);for(const u in this._textureSamplers)x.setTextureSampler(u,this._textureSamplers[u]);for(const u in this._storageBuffers)x.setStorageBuffer(u,this._storageBuffers[u]);return x}dispose(u,x,s){if(x){let u;for(u in this._textures)this._textures[u].dispose();for(u in this._textureArrays){const x=this._textureArrays[u];for(let u=0;u<x.length;u++)x[u].dispose()}}this._textures={},super.dispose(u,x,s)}serialize(){const u=U.p.Serialize(this);let x;for(x in u.customType="BABYLON.ShaderMaterial",u.uniqueId=this.uniqueId,u.options=this._options,u.shaderPath=this._shaderPath,u.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,u.stencil=this.stencil.serialize(),u.textures={},this._textures)u.textures[x]=this._textures[x].serialize();for(x in u.textureArrays={},this._textureArrays){u.textureArrays[x]=[];const s=this._textureArrays[x];for(let U=0;U<s.length;U++)u.textureArrays[x].push(s[U].serialize())}for(x in u.ints={},this._ints)u.ints[x]=this._ints[x];for(x in u.uints={},this._uints)u.uints[x]=this._uints[x];for(x in u.floats={},this._floats)u.floats[x]=this._floats[x];for(x in u.floatsArrays={},this._floatsArrays)u.floatsArrays[x]=this._floatsArrays[x];for(x in u.colors3={},this._colors3)u.colors3[x]=this._colors3[x].asArray();for(x in u.colors3Arrays={},this._colors3Arrays)u.colors3Arrays[x]=this._colors3Arrays[x];for(x in u.colors4={},this._colors4)u.colors4[x]=this._colors4[x].asArray();for(x in u.colors4Arrays={},this._colors4Arrays)u.colors4Arrays[x]=this._colors4Arrays[x];for(x in u.vectors2={},this._vectors2)u.vectors2[x]=this._vectors2[x].asArray();for(x in u.vectors3={},this._vectors3)u.vectors3[x]=this._vectors3[x].asArray();for(x in u.vectors4={},this._vectors4)u.vectors4[x]=this._vectors4[x].asArray();for(x in u.quaternions={},this._quaternions)u.quaternions[x]=this._quaternions[x].asArray();for(x in u.matrices={},this._matrices)u.matrices[x]=this._matrices[x].asArray();for(x in u.matrixArray={},this._matrixArrays)u.matrixArray[x]=this._matrixArrays[x];for(x in u.matrices3x3={},this._matrices3x3)u.matrices3x3[x]=this._matrices3x3[x];for(x in u.matrices2x2={},this._matrices2x2)u.matrices2x2[x]=this._matrices2x2[x];for(x in u.vectors2Arrays={},this._vectors2Arrays)u.vectors2Arrays[x]=this._vectors2Arrays[x];for(x in u.vectors3Arrays={},this._vectors3Arrays)u.vectors3Arrays[x]=this._vectors3Arrays[x];for(x in u.vectors4Arrays={},this._vectors4Arrays)u.vectors4Arrays[x]=this._vectors4Arrays[x];for(x in u.quaternionsArrays={},this._quaternionsArrays)u.quaternionsArrays[x]=this._quaternionsArrays[x];return u}static Parse(u,x,s){const _=U.p.Parse((()=>new H(u.name,x,u.shaderPath,u.options,u.storeEffectOnSubMeshes)),u,x,s);let c;for(c in u.stencil&&_.stencil.parse(u.stencil,x,s),u.textures)_.setTexture(c,I.g.Parse(u.textures[c],x,s));for(c in u.textureArrays){const U=u.textureArrays[c],W=[];for(let u=0;u<U.length;u++)W.push(I.g.Parse(U[u],x,s));_.setTextureArray(c,W)}for(c in u.ints)_.setInt(c,u.ints[c]);for(c in u.uints)_.setUInt(c,u.uints[c]);for(c in u.floats)_.setFloat(c,u.floats[c]);for(c in u.floatsArrays)_.setFloats(c,u.floatsArrays[c]);for(c in u.colors3)_.setColor3(c,J.v9.FromArray(u.colors3[c]));for(c in u.colors3Arrays){const x=u.colors3Arrays[c].reduce(((u,x,s)=>(s%3==0?u.push([x]):u[u.length-1].push(x),u)),[]).map((u=>J.v9.FromArray(u)));_.setColor3Array(c,x)}for(c in u.colors4)_.setColor4(c,J.ov.FromArray(u.colors4[c]));for(c in u.colors4Arrays){const x=u.colors4Arrays[c].reduce(((u,x,s)=>(s%4==0?u.push([x]):u[u.length-1].push(x),u)),[]).map((u=>J.ov.FromArray(u)));_.setColor4Array(c,x)}for(c in u.vectors2)_.setVector2(c,W.I9.FromArray(u.vectors2[c]));for(c in u.vectors3)_.setVector3(c,W.Pq.FromArray(u.vectors3[c]));for(c in u.vectors4)_.setVector4(c,W.IU.FromArray(u.vectors4[c]));for(c in u.quaternions)_.setQuaternion(c,W.PT.FromArray(u.quaternions[c]));for(c in u.matrices)_.setMatrix(c,W.uq.FromArray(u.matrices[c]));for(c in u.matrixArray)_._matrixArrays[c]=new Float32Array(u.matrixArray[c]);for(c in u.matrices3x3)_.setMatrix3x3(c,u.matrices3x3[c]);for(c in u.matrices2x2)_.setMatrix2x2(c,u.matrices2x2[c]);for(c in u.vectors2Arrays)_.setArray2(c,u.vectors2Arrays[c]);for(c in u.vectors3Arrays)_.setArray3(c,u.vectors3Arrays[c]);for(c in u.vectors4Arrays)_.setArray4(c,u.vectors4Arrays[c]);for(c in u.quaternionsArrays)_.setArray4(c,u.quaternionsArrays[c]);return _}static ParseFromFileAsync(u,x,s,U=""){return new Promise(((_,W)=>{const c=new i.u;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const x=JSON.parse(c.responseText),W=this.Parse(x,s||j.q.LastCreatedScene,U);u&&(W.name=u),_(W)}else W("Unable to load the ShaderMaterial")})),c.open("GET",x),c.send()}))}static ParseFromSnippetAsync(u,x,s=""){return new Promise(((U,_)=>{const W=new i.u;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const _=JSON.parse(JSON.parse(W.responseText).jsonPayload),c=JSON.parse(_.shaderMaterial),I=this.Parse(c,x||j.q.LastCreatedScene,s);I.snippetId=u,U(I)}else _("Unable to load the snippet "+u)})),W.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),W.send()}))}}H.SnippetUrl=`https://snippet.babylonjs.com`,H.CreateFromSnippetAsync=H.ParseFromSnippetAsync,L.Y5("BABYLON.ShaderMaterial",H)},32138:(u,x,s)=>{s.d(x,{F:()=>F,f:()=>n});var U=s(297809),_=s(760998),W=s(293506),c=s(889460),I=s(604910),L=s(332290),J=s(23987),k=s(626956),i=s(239590),d=s(55973),j=s(527335),r=s(235519),D=s(432050),$=s(310035),H=s(591160),f=s(522208),O=s(722736),t=s(651577),V=s(855300),N=s(337776),m=s(384898);const b={effect:null,subMesh:null};class n extends j.M{constructor(u){super(u),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_NDC_DEPTH=!1,this.PREPASS_NDC_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(u){const x=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const s of x)this[s]=s===u}}class F extends r.E{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(u){this._attachImageProcessingConfiguration(u),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(u){u!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=u||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(u){this.imageProcessingConfiguration.colorCurvesEnabled=u}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(u){this.imageProcessingConfiguration.colorGradingEnabled=u}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(u){this._imageProcessingConfiguration.toneMappingEnabled=u}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(u){this._imageProcessingConfiguration.exposure=u}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(u){this._imageProcessingConfiguration.contrast=u}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(u){this._imageProcessingConfiguration.colorGradingTexture=u}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(u){this._imageProcessingConfiguration.colorCurves=u}get canRenderToMRT(){return!0}constructor(u,x,s=!1){super(u,x),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new L.v9(0,0,0),this.diffuseColor=new L.v9(1,1,1),this.specularColor=new L.v9(1,1,1),this.emissiveColor=new L.v9(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new W.L(16),this._worldViewProjectionMatrix=I.uq.Zero(),this._globalAmbientColor=new L.v9(0,0,0),this._cacheHasRenderTargetTextures=!1;const U=this.getScene().getEngine();!U.isWebGPU||s||F.ForceGLSL||(this._uniformBuffer&&this._uniformBuffer.dispose(),this._uniformBuffer=new m.D(U,void 0,void 0,this.name,!0),this._shaderLanguage=1),this.detailMap=new O.c(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new k.J,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),F.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),F.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(F.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(F.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}getClassName(){return"StandardMaterial"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===d.i.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==d.i.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(u,x,U=!1){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const _=x._drawWrapper;if(_.effect&&this.isFrozen&&_._wasPreviouslyReady&&_._wasPreviouslyUsingInstances===U)return!0;x.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),x.materialDefines=new n(this._eventInfo.defineNames));const W=this.getScene(),c=x.materialDefines;if(this._isReadyForSubMesh(x))return!0;const I=W.getEngine();c._needNormals=V.az(W,u,c,!0,this._maxSimultaneousLights,this._disableLighting),V.VO(W,c);const L=this.needAlphaBlendingForMesh(u)&&this.getScene().useOrderIndependentTransparency;if(V.N4(W,c,this.canRenderToMRT&&!L),V.Nc(W,c,L),c._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,c._needUVs=!1;for(let u=1;u<=6;++u)c["MAINUV"+u]=!1;if(W.texturesEnabled){if(c.DIFFUSEDIRECTUV=0,c.BUMPDIRECTUV=0,c.AMBIENTDIRECTUV=0,c.OPACITYDIRECTUV=0,c.EMISSIVEDIRECTUV=0,c.SPECULARDIRECTUV=0,c.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&F.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;V.YT(this._diffuseTexture,c,"DIFFUSE")}else c.DIFFUSE=!1;if(this._ambientTexture&&F.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;V.YT(this._ambientTexture,c,"AMBIENT")}else c.AMBIENT=!1;if(this._opacityTexture&&F.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;V.YT(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else c.OPACITY=!1;if(this._reflectionTexture&&F.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(c._needNormals=!0,c.REFLECTION=!0,c.ROUGHNESS=this._roughness>0,c.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,c.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===D.g.INVCUBIC_MODE,c.REFLECTIONMAP_3D=this._reflectionTexture.isCube,c.REFLECTIONMAP_OPPOSITEZ=c.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,c.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case D.g.EXPLICIT_MODE:c.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case D.g.PLANAR_MODE:c.setReflectionMode("REFLECTIONMAP_PLANAR");break;case D.g.PROJECTION_MODE:c.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case D.g.SKYBOX_MODE:c.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case D.g.SPHERICAL_MODE:c.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case D.g.EQUIRECTANGULAR_MODE:c.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case D.g.FIXED_EQUIRECTANGULAR_MODE:c.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case D.g.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case D.g.CUBIC_MODE:case D.g.INVCUBIC_MODE:default:c.setReflectionMode("REFLECTIONMAP_CUBIC")}c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else c.REFLECTION=!1,c.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&F.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;V.YT(this._emissiveTexture,c,"EMISSIVE")}else c.EMISSIVE=!1;if(this._lightmapTexture&&F.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;V.YT(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else c.LIGHTMAP=!1;if(this._specularTexture&&F.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;V.YT(this._specularTexture,c,"SPECULAR"),c.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else c.SPECULAR=!1;if(W.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&F.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;V.YT(this._bumpTexture,c,"BUMP"),c.PARALLAX=this._useParallax,c.PARALLAX_RHS=W.useRightHandedSystem,c.PARALLAXOCCLUSION=this._useParallaxOcclusion,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else c.BUMP=!1,c.PARALLAX=!1,c.PARALLAX_RHS=!1,c.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&F.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;c._needUVs=!0,c.REFRACTION=!0,c.REFRACTIONMAP_3D=this._refractionTexture.isCube,c.RGBDREFRACTION=this._refractionTexture.isRGBD,c.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else c.REFRACTION=!1;c.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else c.DIFFUSE=!1,c.AMBIENT=!1,c.OPACITY=!1,c.REFLECTION=!1,c.EMISSIVE=!1,c.LIGHTMAP=!1,c.BUMP=!1,c.REFRACTION=!1;c.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),c.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,c.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,c.SPECULAROVERALPHA=this._useSpecularOverAlpha,c.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,c.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,c.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(u)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=c,this._eventInfo.subMesh=x,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(c._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(c),c.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,c.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}c._areFresnelDirty&&(F.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(c.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,c.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,c.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,c.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,c.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,c.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,c._needNormals=!0,c.FRESNEL=!0):c.FRESNEL=!1),V.fm(u,W,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(u)||this._forceAlphaTest,c,this._applyDecalMapAfterDetailMap),V.OR(W,I,this,c,U,null,x.getRenderingMesh().hasThinInstances),this._eventInfo.defines=c,this._eventInfo.mesh=u,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),V.qB(u,c,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let d=!1;if(c.isDirty){const U=c._areLightsDisposed;c.markAsProcessed();const _=new f.J;c.REFLECTION&&_.addFallback(0,"REFLECTION"),c.SPECULAR&&_.addFallback(0,"SPECULAR"),c.BUMP&&_.addFallback(0,"BUMP"),c.PARALLAX&&_.addFallback(1,"PARALLAX"),c.PARALLAX_RHS&&_.addFallback(1,"PARALLAX_RHS"),c.PARALLAXOCCLUSION&&_.addFallback(0,"PARALLAXOCCLUSION"),c.SPECULAROVERALPHA&&_.addFallback(0,"SPECULAROVERALPHA"),c.FOG&&_.addFallback(1,"FOG"),c.POINTSIZE&&_.addFallback(0,"POINTSIZE"),c.LOGARITHMICDEPTH&&_.addFallback(0,"LOGARITHMICDEPTH"),V.c4(c,_,this._maxSimultaneousLights),c.SPECULARTERM&&_.addFallback(0,"SPECULARTERM"),c.DIFFUSEFRESNEL&&_.addFallback(1,"DIFFUSEFRESNEL"),c.OPACITYFRESNEL&&_.addFallback(2,"OPACITYFRESNEL"),c.REFLECTIONFRESNEL&&_.addFallback(3,"REFLECTIONFRESNEL"),c.EMISSIVEFRESNEL&&_.addFallback(4,"EMISSIVEFRESNEL"),c.FRESNEL&&_.addFallback(4,"FRESNEL"),c.MULTIVIEW&&_.addFallback(0,"MULTIVIEW");const L=[J.R.PositionKind];c.NORMAL&&L.push(J.R.NormalKind),c.TANGENT&&L.push(J.R.TangentKind);for(let u=1;u<=6;++u)c["UV"+u]&&L.push(`uv${1===u?"":u}`);c.VERTEXCOLOR&&L.push(J.R.ColorKind),V.ni(L,u,c,_),V.ER(L,c),V.IF(L,u,c),V.J2(L,u,c);let j="default";const r=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],D=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],$=["Material","Scene","Mesh"],H={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=_,this._eventInfo.fallbackRank=0,this._eventInfo.defines=c,this._eventInfo.uniforms=r,this._eventInfo.attributes=L,this._eventInfo.samplers=D,this._eventInfo.uniformBuffersNames=$,this._eventInfo.customCode=void 0,this._eventInfo.mesh=u,this._eventInfo.indexParameters=H,this._callbackPluginEventGeneric(128,this._eventInfo),k.J.AddUniforms(r),k.J.AddSamplers(D),i.p&&(i.p.PrepareUniforms(r,c),i.p.PrepareSamplers(D,c)),V.Bb({uniformsNames:r,uniformBuffersNames:$,samplers:D,defines:c,maxSimultaneousLights:this._maxSimultaneousLights}),t.TV(r);const O={};this.customShaderNameResolve&&(j=this.customShaderNameResolve(j,r,$,D,c,L,O));const N=c.toString(),m=x.effect;let n=W.getEngine().createEffect(j,{attributes:L,uniformsNames:r,uniformBuffersNames:$,samplers:D,defines:N,fallbacks:_,onCompiled:this.onCompiled,onError:this.onError,indexParameters:H,processFinalCode:O.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:c.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([s.e(10228).then(s.bind(s,410228)),s.e(11300).then(s.bind(s,211300))]):await Promise.all([s.e(10036).then(s.bind(s,310036)),s.e(53566).then(s.bind(s,53566))]),this._shadersLoaded=!0}},I);if(this._eventInfo.customCode=void 0,n)if(this._onEffectCreatedObservable&&(b.effect=n,b.subMesh=x,this._onEffectCreatedObservable.notifyObservers(b)),this.allowShaderHotSwapping&&m&&!n.isReady()){if(n=m,c.markAsUnprocessed(),d=this.isFrozen,U)return c._areLightsDisposed=!0,!1}else W.resetCachedMaterial(),x.setEffect(n,c,this._materialContext)}return!(!x.effect||!x.effect.isReady()||(c._renderId=W.getRenderId(),_._wasPreviouslyReady=!d,_._wasPreviouslyUsingInstances=U,this._checkScenePerformancePriority(),0))}buildUniformLayout(){const u=this._uniformBuffer;u.addUniform("diffuseLeftColor",4),u.addUniform("diffuseRightColor",4),u.addUniform("opacityParts",4),u.addUniform("reflectionLeftColor",4),u.addUniform("reflectionRightColor",4),u.addUniform("refractionLeftColor",4),u.addUniform("refractionRightColor",4),u.addUniform("emissiveLeftColor",4),u.addUniform("emissiveRightColor",4),u.addUniform("vDiffuseInfos",2),u.addUniform("vAmbientInfos",2),u.addUniform("vOpacityInfos",2),u.addUniform("vReflectionInfos",2),u.addUniform("vReflectionPosition",3),u.addUniform("vReflectionSize",3),u.addUniform("vEmissiveInfos",2),u.addUniform("vLightmapInfos",2),u.addUniform("vSpecularInfos",2),u.addUniform("vBumpInfos",3),u.addUniform("diffuseMatrix",16),u.addUniform("ambientMatrix",16),u.addUniform("opacityMatrix",16),u.addUniform("reflectionMatrix",16),u.addUniform("emissiveMatrix",16),u.addUniform("lightmapMatrix",16),u.addUniform("specularMatrix",16),u.addUniform("bumpMatrix",16),u.addUniform("vTangentSpaceParams",2),u.addUniform("pointSize",1),u.addUniform("alphaCutOff",1),u.addUniform("refractionMatrix",16),u.addUniform("vRefractionInfos",4),u.addUniform("vRefractionPosition",3),u.addUniform("vRefractionSize",3),u.addUniform("vSpecularColor",4),u.addUniform("vEmissiveColor",3),u.addUniform("vDiffuseColor",4),u.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(u,x,s){var U;const _=this.getScene(),W=s.materialDefines;if(!W)return;const I=s.effect;if(!I)return;this._activeEffect=I,x.getMeshUniformBuffer().bindToEffect(I,"Mesh"),x.transferToEffect(u),this._uniformBuffer.bindToEffect(I,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,_,x,u,this.isFrozen),this._eventInfo.subMesh=s,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),W.OBJECTSPACE_NORMALMAP&&(u.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const J=this._mustRebind(_,I,s,x.visibility);V.f$(x,I);const k=this._uniformBuffer;if(J){if(this.bindViewProjection(I),!k.useUbo||!this.isFrozen||!k.isSync||s._drawWrapper._forceRebindOnNextCall){if(F.FresnelEnabled&&W.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(k.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),k.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&k.updateColor4("opacityParts",new L.v9(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(k.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),k.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(k.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),k.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(k.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),k.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),_.texturesEnabled){if(this._diffuseTexture&&F.DiffuseTextureEnabled&&(k.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),V.mA(this._diffuseTexture,k,"diffuse")),this._ambientTexture&&F.AmbientTextureEnabled&&(k.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),V.mA(this._ambientTexture,k,"ambient")),this._opacityTexture&&F.OpacityTextureEnabled&&(k.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),V.mA(this._opacityTexture,k,"opacity")),this._hasAlphaChannel()&&k.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&F.ReflectionTextureEnabled&&(k.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),k.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const u=this._reflectionTexture;k.updateVector3("vReflectionPosition",u.boundingBoxPosition),k.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this._emissiveTexture&&F.EmissiveTextureEnabled&&(k.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),V.mA(this._emissiveTexture,k,"emissive")),this._lightmapTexture&&F.LightmapTextureEnabled&&(k.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),V.mA(this._lightmapTexture,k,"lightmap")),this._specularTexture&&F.SpecularTextureEnabled&&(k.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),V.mA(this._specularTexture,k,"specular")),this._bumpTexture&&_.getEngine().getCaps().standardDerivatives&&F.BumpTextureEnabled&&(k.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),V.mA(this._bumpTexture,k,"bump"),_._mirroredCameraPosition?k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):k.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&F.RefractionTextureEnabled){let u=1;if(this._refractionTexture.isCube||(k.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(u=this._refractionTexture.depth)),k.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,u,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const u=this._refractionTexture;k.updateVector3("vRefractionPosition",u.boundingBoxPosition),k.updateVector3("vRefractionSize",u.boundingBoxSize)}}}this.pointsCloud&&k.updateFloat("pointSize",this.pointSize),W.SPECULARTERM&&k.updateColor4("vSpecularColor",this.specularColor,this.specularPower),k.updateColor3("vEmissiveColor",F.EmissiveTextureEnabled?this.emissiveColor:L.v9.BlackReadOnly),k.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),_.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),k.updateColor3("vAmbientColor",this._globalAmbientColor)}_.texturesEnabled&&(this._diffuseTexture&&F.DiffuseTextureEnabled&&I.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&F.AmbientTextureEnabled&&I.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&F.OpacityTextureEnabled&&I.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&F.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?I.setTexture("reflectionCubeSampler",this._reflectionTexture):I.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&F.EmissiveTextureEnabled&&I.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&F.LightmapTextureEnabled&&I.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&F.SpecularTextureEnabled&&I.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&_.getEngine().getCaps().standardDerivatives&&F.BumpTextureEnabled&&I.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&F.RefractionTextureEnabled&&(this._refractionTexture.isCube?I.setTexture("refractionCubeSampler",this._refractionTexture):I.setTexture("refraction2DSampler",this._refractionTexture))),this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(x)&&this.getScene().depthPeelingRenderer.bind(I),this._eventInfo.subMesh=s,this._callbackPluginEventBindForSubMesh(this._eventInfo),t.gS(I,this,_),this.bindEyePosition(I)}else _.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);!J&&this.isFrozen||(_.lightsEnabled&&!this._disableLighting&&V.RL(_,x,I,W,this._maxSimultaneousLights),(_.fogEnabled&&x.applyFog&&_.fogMode!==c.Z.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||x.receiveShadows||W.PREPASS)&&this.bindView(I),V.Yy(_,x,I),W.NUM_MORPH_INFLUENCERS&&V.nR(x,I),W.BAKED_VERTEX_ANIMATION_TEXTURE&&(null===(U=x.bakedVertexAnimationManager)||void 0===U||U.bind(I,W.INSTANCES)),this.useLogarithmicDepth&&V.DL(W,I,_),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(x,this._activeEffect,s),k.update()}getAnimatables(){const u=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&u.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&u.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&u.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&u.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&u.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&u.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&u.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&u.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&u.push(this._refractionTexture),u}getActiveTextures(){const u=super.getActiveTextures();return this._diffuseTexture&&u.push(this._diffuseTexture),this._ambientTexture&&u.push(this._ambientTexture),this._opacityTexture&&u.push(this._opacityTexture),this._reflectionTexture&&u.push(this._reflectionTexture),this._emissiveTexture&&u.push(this._emissiveTexture),this._specularTexture&&u.push(this._specularTexture),this._bumpTexture&&u.push(this._bumpTexture),this._lightmapTexture&&u.push(this._lightmapTexture),this._refractionTexture&&u.push(this._refractionTexture),u}hasTexture(u){return!!super.hasTexture(u)||this._diffuseTexture===u||this._ambientTexture===u||this._opacityTexture===u||this._reflectionTexture===u||this._emissiveTexture===u||this._specularTexture===u||this._bumpTexture===u||this._lightmapTexture===u||this._refractionTexture===u}dispose(u,x){var s,U,_,W,c,I,L,J,k;x&&(null===(s=this._diffuseTexture)||void 0===s||s.dispose(),null===(U=this._ambientTexture)||void 0===U||U.dispose(),null===(_=this._opacityTexture)||void 0===_||_.dispose(),null===(W=this._reflectionTexture)||void 0===W||W.dispose(),null===(c=this._emissiveTexture)||void 0===c||c.dispose(),null===(I=this._specularTexture)||void 0===I||I.dispose(),null===(L=this._bumpTexture)||void 0===L||L.dispose(),null===(J=this._lightmapTexture)||void 0===J||J.dispose(),null===(k=this._refractionTexture)||void 0===k||k.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(u,x)}clone(u,x=!0,s=""){const U=N.p.Clone((()=>new F(u,this.getScene())),this,{cloneTexturesOnlyOnce:x});return U.name=u,U.id=u,this.stencil.copyTo(U.stencil),this._clonePlugins(U,s),U}static Parse(u,x,s){const U=N.p.Parse((()=>new F(u.name,x)),u,x,s);return u.stencil&&U.stencil.parse(u.stencil,x,s),d.i._ParsePlugins(u,U,x,s),U}static get DiffuseTextureEnabled(){return H.h.DiffuseTextureEnabled}static set DiffuseTextureEnabled(u){H.h.DiffuseTextureEnabled=u}static get DetailTextureEnabled(){return H.h.DetailTextureEnabled}static set DetailTextureEnabled(u){H.h.DetailTextureEnabled=u}static get AmbientTextureEnabled(){return H.h.AmbientTextureEnabled}static set AmbientTextureEnabled(u){H.h.AmbientTextureEnabled=u}static get OpacityTextureEnabled(){return H.h.OpacityTextureEnabled}static set OpacityTextureEnabled(u){H.h.OpacityTextureEnabled=u}static get ReflectionTextureEnabled(){return H.h.ReflectionTextureEnabled}static set ReflectionTextureEnabled(u){H.h.ReflectionTextureEnabled=u}static get EmissiveTextureEnabled(){return H.h.EmissiveTextureEnabled}static set EmissiveTextureEnabled(u){H.h.EmissiveTextureEnabled=u}static get SpecularTextureEnabled(){return H.h.SpecularTextureEnabled}static set SpecularTextureEnabled(u){H.h.SpecularTextureEnabled=u}static get BumpTextureEnabled(){return H.h.BumpTextureEnabled}static set BumpTextureEnabled(u){H.h.BumpTextureEnabled=u}static get LightmapTextureEnabled(){return H.h.LightmapTextureEnabled}static set LightmapTextureEnabled(u){H.h.LightmapTextureEnabled=u}static get RefractionTextureEnabled(){return H.h.RefractionTextureEnabled}static set RefractionTextureEnabled(u){H.h.RefractionTextureEnabled=u}static get ColorGradingTextureEnabled(){return H.h.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(u){H.h.ColorGradingTextureEnabled=u}static get FresnelEnabled(){return H.h.FresnelEnabled}static set FresnelEnabled(u){H.h.FresnelEnabled=u}}F.ForceGLSL=!1,U.Cg([_.uM("diffuseTexture")],F.prototype,"_diffuseTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"diffuseTexture",void 0),U.Cg([_.uM("ambientTexture")],F.prototype,"_ambientTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"ambientTexture",void 0),U.Cg([_.uM("opacityTexture")],F.prototype,"_opacityTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"opacityTexture",void 0),U.Cg([_.uM("reflectionTexture")],F.prototype,"_reflectionTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"reflectionTexture",void 0),U.Cg([_.uM("emissiveTexture")],F.prototype,"_emissiveTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"emissiveTexture",void 0),U.Cg([_.uM("specularTexture")],F.prototype,"_specularTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"specularTexture",void 0),U.Cg([_.uM("bumpTexture")],F.prototype,"_bumpTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"bumpTexture",void 0),U.Cg([_.uM("lightmapTexture")],F.prototype,"_lightmapTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"lightmapTexture",void 0),U.Cg([_.uM("refractionTexture")],F.prototype,"_refractionTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionTexture",void 0),U.Cg([_.jT("ambient")],F.prototype,"ambientColor",void 0),U.Cg([_.jT("diffuse")],F.prototype,"diffuseColor",void 0),U.Cg([_.jT("specular")],F.prototype,"specularColor",void 0),U.Cg([_.jT("emissive")],F.prototype,"emissiveColor",void 0),U.Cg([_.lK()],F.prototype,"specularPower",void 0),U.Cg([_.lK("useAlphaFromDiffuseTexture")],F.prototype,"_useAlphaFromDiffuseTexture",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"useAlphaFromDiffuseTexture",void 0),U.Cg([_.lK("useEmissiveAsIllumination")],F.prototype,"_useEmissiveAsIllumination",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useEmissiveAsIllumination",void 0),U.Cg([_.lK("linkEmissiveWithDiffuse")],F.prototype,"_linkEmissiveWithDiffuse",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkEmissiveWithDiffuse",void 0),U.Cg([_.lK("useSpecularOverAlpha")],F.prototype,"_useSpecularOverAlpha",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useSpecularOverAlpha",void 0),U.Cg([_.lK("useReflectionOverAlpha")],F.prototype,"_useReflectionOverAlpha",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useReflectionOverAlpha",void 0),U.Cg([_.lK("disableLighting")],F.prototype,"_disableLighting",void 0),U.Cg([_.$z("_markAllSubMeshesAsLightsDirty")],F.prototype,"disableLighting",void 0),U.Cg([_.lK("useObjectSpaceNormalMap")],F.prototype,"_useObjectSpaceNormalMap",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useObjectSpaceNormalMap",void 0),U.Cg([_.lK("useParallax")],F.prototype,"_useParallax",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useParallax",void 0),U.Cg([_.lK("useParallaxOcclusion")],F.prototype,"_useParallaxOcclusion",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useParallaxOcclusion",void 0),U.Cg([_.lK()],F.prototype,"parallaxScaleBias",void 0),U.Cg([_.lK("roughness")],F.prototype,"_roughness",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"roughness",void 0),U.Cg([_.lK()],F.prototype,"indexOfRefraction",void 0),U.Cg([_.lK()],F.prototype,"invertRefractionY",void 0),U.Cg([_.lK()],F.prototype,"alphaCutOff",void 0),U.Cg([_.lK("useLightmapAsShadowmap")],F.prototype,"_useLightmapAsShadowmap",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useLightmapAsShadowmap",void 0),U.Cg([_.Y9("diffuseFresnelParameters")],F.prototype,"_diffuseFresnelParameters",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelDirty")],F.prototype,"diffuseFresnelParameters",void 0),U.Cg([_.Y9("opacityFresnelParameters")],F.prototype,"_opacityFresnelParameters",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelAndMiscDirty")],F.prototype,"opacityFresnelParameters",void 0),U.Cg([_.Y9("reflectionFresnelParameters")],F.prototype,"_reflectionFresnelParameters",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelDirty")],F.prototype,"reflectionFresnelParameters",void 0),U.Cg([_.Y9("refractionFresnelParameters")],F.prototype,"_refractionFresnelParameters",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelDirty")],F.prototype,"refractionFresnelParameters",void 0),U.Cg([_.Y9("emissiveFresnelParameters")],F.prototype,"_emissiveFresnelParameters",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelDirty")],F.prototype,"emissiveFresnelParameters",void 0),U.Cg([_.lK("useReflectionFresnelFromSpecular")],F.prototype,"_useReflectionFresnelFromSpecular",void 0),U.Cg([_.$z("_markAllSubMeshesAsFresnelDirty")],F.prototype,"useReflectionFresnelFromSpecular",void 0),U.Cg([_.lK("useGlossinessFromSpecularMapAlpha")],F.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useGlossinessFromSpecularMapAlpha",void 0),U.Cg([_.lK("maxSimultaneousLights")],F.prototype,"_maxSimultaneousLights",void 0),U.Cg([_.$z("_markAllSubMeshesAsLightsDirty")],F.prototype,"maxSimultaneousLights",void 0),U.Cg([_.lK("invertNormalMapX")],F.prototype,"_invertNormalMapX",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertNormalMapX",void 0),U.Cg([_.lK("invertNormalMapY")],F.prototype,"_invertNormalMapY",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertNormalMapY",void 0),U.Cg([_.lK("twoSidedLighting")],F.prototype,"_twoSidedLighting",void 0),U.Cg([_.$z("_markAllSubMeshesAsTexturesDirty")],F.prototype,"twoSidedLighting",void 0),U.Cg([_.lK("applyDecalMapAfterDetailMap")],F.prototype,"_applyDecalMapAfterDetailMap",void 0),U.Cg([_.$z("_markAllSubMeshesAsMiscDirty")],F.prototype,"applyDecalMapAfterDetailMap",void 0),$.Y5("BABYLON.StandardMaterial",F),c.Z.DefaultMaterialFactory=u=>new F("default material",u)},384898:(u,x,s)=>{s.d(x,{D:()=>W});var U=s(706400),_=s(898973);s(617024);class W{constructor(u,x,s,U,_=!1){this._valueCache={},this._engine=u,this._noUBO=!u.supportsUniformBuffers||_,this._dynamic=s,this._name=null!=U?U:"no-name",this._data=x||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(u){let x;if(x=u<=2?u:4,this._uniformLocationPointer%x!=0){const u=this._uniformLocationPointer;this._uniformLocationPointer+=x-this._uniformLocationPointer%x;const s=this._uniformLocationPointer-u;for(let u=0;u<s;u++)this._data.push(0)}}addUniform(u,x,s=0){if(this._noUBO)return;if(void 0!==this._uniformLocations[u])return;let U;if(s>0){if(x instanceof Array)throw"addUniform should not be use with Array in UBO: "+u;this._fillAlignment(4),this._uniformArraySizes[u]={strideSize:x,arraySize:s},16==x?x*=s:x=x*s+(4-x)*s,U=[];for(let u=0;u<x;u++)U.push(0)}else{if(x instanceof Array)U=x,x=U.length;else{U=[];for(let u=0;u<x;u++)U.push(0)}this._fillAlignment(x)}this._uniformSizes[u]=x,this._uniformLocations[u]=this._uniformLocationPointer,this._uniformLocationPointer+=x;for(let u=0;u<x;u++)this._data.push(U[u]);this._needSync=!0}addMatrix(u,x){this.addUniform(u,Array.prototype.slice.call(x.asArray()))}addFloat2(u,x,s){const U=[x,s];this.addUniform(u,U)}addFloat3(u,x,s,U){const _=[x,s,U];this.addUniform(u,_)}addColor3(u,x){const s=[x.r,x.g,x.b];this.addUniform(u,s)}addColor4(u,x,s){const U=[x.r,x.g,x.b,s];this.addUniform(u,U)}addVector3(u,x){const s=[x.x,x.y,x.z];this.addUniform(u,s)}addMatrix3x3(u){this.addUniform(u,12)}addMatrix2x2(u){this.addUniform(u,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const u=[];let x=0;for(const s in this._uniformLocations)if(u.push(s),10==++x)break;return u.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(u,x){for(let s=0;s<u.length;++s)if(u[s]!==x[s])return!1;return!0}_copyBuffer(u,x){for(let s=0;s<u.length;++s)x[s]=u[s]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(W._UpdatedUbosInFrame[this._name]||(W._UpdatedUbosInFrame[this._name]=0),W._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(u,x,s){this._checkNewFrame();let _=this._uniformLocations[u];if(void 0===_){if(this._buffer)return void U.V.Error("Cannot add an uniform after UBO has been created. uniformName="+u);this.addUniform(u,s),_=this._uniformLocations[u]}if(this._buffer||this.create(),this._dynamic)for(let u=0;u<s;u++)this._bufferData[_+u]=x[u];else{let u=!1;for(let U=0;U<s;U++)(16===s&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[_+U]!==Math.fround(x[U]))&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[_+U]=x[U]);this._needSync=this._needSync||u}}updateUniformArray(u,x,s){this._checkNewFrame();const W=this._uniformLocations[u];if(void 0===W)return void U.V.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const c=this._uniformArraySizes[u];if(this._dynamic)for(let u=0;u<s;u++)this._bufferData[W+u]=x[u];else{let u=!1,U=0,I=0;for(let L=0;L<s;L++)if(this._bufferData[W+4*I+U]!==_.S0.FloatRound(x[L])&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[W+4*I+U]=x[L]),U++,U===c.strideSize){for(;U<4;U++)this._bufferData[W+4*I+U]=0;U=0,I++}this._needSync=this._needSync||u}}_cacheMatrix(u,x){this._checkNewFrame();const s=this._valueCache[u],U=x.updateFlag;return(void 0===s||s!==U)&&(this._valueCache[u]=U,!0)}_updateMatrix3x3ForUniform(u,x){for(let u=0;u<3;u++)W._TempBuffer[4*u]=x[3*u],W._TempBuffer[4*u+1]=x[3*u+1],W._TempBuffer[4*u+2]=x[3*u+2],W._TempBuffer[4*u+3]=0;this.updateUniform(u,W._TempBuffer,12)}_updateMatrix3x3ForEffect(u,x){this._currentEffect.setMatrix3x3(u,x)}_updateMatrix2x2ForEffect(u,x){this._currentEffect.setMatrix2x2(u,x)}_updateMatrix2x2ForUniform(u,x){for(let u=0;u<2;u++)W._TempBuffer[4*u]=x[2*u],W._TempBuffer[4*u+1]=x[2*u+1],W._TempBuffer[4*u+2]=0,W._TempBuffer[4*u+3]=0;this.updateUniform(u,W._TempBuffer,8)}_updateFloatForEffect(u,x){this._currentEffect.setFloat(u,x)}_updateFloatForUniform(u,x){W._TempBuffer[0]=x,this.updateUniform(u,W._TempBuffer,1)}_updateFloat2ForEffect(u,x,s,U=""){this._currentEffect.setFloat2(u+U,x,s)}_updateFloat2ForUniform(u,x,s){W._TempBuffer[0]=x,W._TempBuffer[1]=s,this.updateUniform(u,W._TempBuffer,2)}_updateFloat3ForEffect(u,x,s,U,_=""){this._currentEffect.setFloat3(u+_,x,s,U)}_updateFloat3ForUniform(u,x,s,U){W._TempBuffer[0]=x,W._TempBuffer[1]=s,W._TempBuffer[2]=U,this.updateUniform(u,W._TempBuffer,3)}_updateFloat4ForEffect(u,x,s,U,_,W=""){this._currentEffect.setFloat4(u+W,x,s,U,_)}_updateFloat4ForUniform(u,x,s,U,_){W._TempBuffer[0]=x,W._TempBuffer[1]=s,W._TempBuffer[2]=U,W._TempBuffer[3]=_,this.updateUniform(u,W._TempBuffer,4)}_updateFloatArrayForEffect(u,x){this._currentEffect.setFloatArray(u,x)}_updateFloatArrayForUniform(u,x){this.updateUniformArray(u,x,x.length)}_updateArrayForEffect(u,x){this._currentEffect.setArray(u,x)}_updateArrayForUniform(u,x){this.updateUniformArray(u,x,x.length)}_updateIntArrayForEffect(u,x){this._currentEffect.setIntArray(u,x)}_updateIntArrayForUniform(u,x){W._TempBufferInt32View.set(x),this.updateUniformArray(u,W._TempBuffer,x.length)}_updateUIntArrayForEffect(u,x){this._currentEffect.setUIntArray(u,x)}_updateUIntArrayForUniform(u,x){W._TempBufferUInt32View.set(x),this.updateUniformArray(u,W._TempBuffer,x.length)}_updateMatrixForEffect(u,x){this._currentEffect.setMatrix(u,x)}_updateMatrixForUniform(u,x){this._cacheMatrix(u,x)&&this.updateUniform(u,x.asArray(),16)}_updateMatricesForEffect(u,x){this._currentEffect.setMatrices(u,x)}_updateMatricesForUniform(u,x){this.updateUniform(u,x,x.length)}_updateVector3ForEffect(u,x){this._currentEffect.setVector3(u,x)}_updateVector3ForUniform(u,x){W._TempBuffer[0]=x.x,W._TempBuffer[1]=x.y,W._TempBuffer[2]=x.z,this.updateUniform(u,W._TempBuffer,3)}_updateVector4ForEffect(u,x){this._currentEffect.setVector4(u,x)}_updateVector4ForUniform(u,x){W._TempBuffer[0]=x.x,W._TempBuffer[1]=x.y,W._TempBuffer[2]=x.z,W._TempBuffer[3]=x.w,this.updateUniform(u,W._TempBuffer,4)}_updateColor3ForEffect(u,x,s=""){this._currentEffect.setColor3(u+s,x)}_updateColor3ForUniform(u,x){W._TempBuffer[0]=x.r,W._TempBuffer[1]=x.g,W._TempBuffer[2]=x.b,this.updateUniform(u,W._TempBuffer,3)}_updateColor4ForEffect(u,x,s,U=""){this._currentEffect.setColor4(u+U,x,s)}_updateDirectColor4ForEffect(u,x,s=""){this._currentEffect.setDirectColor4(u+s,x)}_updateColor4ForUniform(u,x,s){W._TempBuffer[0]=x.r,W._TempBuffer[1]=x.g,W._TempBuffer[2]=x.b,W._TempBuffer[3]=s,this.updateUniform(u,W._TempBuffer,4)}_updateDirectColor4ForUniform(u,x){W._TempBuffer[0]=x.r,W._TempBuffer[1]=x.g,W._TempBuffer[2]=x.b,W._TempBuffer[3]=x.a,this.updateUniform(u,W._TempBuffer,4)}_updateIntForEffect(u,x,s=""){this._currentEffect.setInt(u+s,x)}_updateIntForUniform(u,x){W._TempBufferInt32View[0]=x,this.updateUniform(u,W._TempBuffer,1)}_updateInt2ForEffect(u,x,s,U=""){this._currentEffect.setInt2(u+U,x,s)}_updateInt2ForUniform(u,x,s){W._TempBufferInt32View[0]=x,W._TempBufferInt32View[1]=s,this.updateUniform(u,W._TempBuffer,2)}_updateInt3ForEffect(u,x,s,U,_=""){this._currentEffect.setInt3(u+_,x,s,U)}_updateInt3ForUniform(u,x,s,U){W._TempBufferInt32View[0]=x,W._TempBufferInt32View[1]=s,W._TempBufferInt32View[2]=U,this.updateUniform(u,W._TempBuffer,3)}_updateInt4ForEffect(u,x,s,U,_,W=""){this._currentEffect.setInt4(u+W,x,s,U,_)}_updateInt4ForUniform(u,x,s,U,_){W._TempBufferInt32View[0]=x,W._TempBufferInt32View[1]=s,W._TempBufferInt32View[2]=U,W._TempBufferInt32View[3]=_,this.updateUniform(u,W._TempBuffer,4)}_updateUIntForEffect(u,x,s=""){this._currentEffect.setUInt(u+s,x)}_updateUIntForUniform(u,x){W._TempBufferUInt32View[0]=x,this.updateUniform(u,W._TempBuffer,1)}_updateUInt2ForEffect(u,x,s,U=""){this._currentEffect.setUInt2(u+U,x,s)}_updateUInt2ForUniform(u,x,s){W._TempBufferUInt32View[0]=x,W._TempBufferUInt32View[1]=s,this.updateUniform(u,W._TempBuffer,2)}_updateUInt3ForEffect(u,x,s,U,_=""){this._currentEffect.setUInt3(u+_,x,s,U)}_updateUInt3ForUniform(u,x,s,U){W._TempBufferUInt32View[0]=x,W._TempBufferUInt32View[1]=s,W._TempBufferUInt32View[2]=U,this.updateUniform(u,W._TempBuffer,3)}_updateUInt4ForEffect(u,x,s,U,_,W=""){this._currentEffect.setUInt4(u+W,x,s,U,_)}_updateUInt4ForUniform(u,x,s,U,_){W._TempBufferUInt32View[0]=x,W._TempBufferUInt32View[1]=s,W._TempBufferUInt32View[2]=U,W._TempBufferUInt32View[3]=_,this.updateUniform(u,W._TempBuffer,4)}setTexture(u,x){this._currentEffect.setTexture(u,x)}setTextureArray(u,x){this._currentEffect.setTextureArray(u,x)}bindTexture(u,x){this._currentEffect._bindTexture(u,x)}updateUniformDirectly(u,x){this.updateUniform(u,x,x.length),this.update()}bindToEffect(u,x){this._currentEffect=u,this._currentEffectName=x}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(u){if(!this._buffers)return this._buffer===u;for(let x=0;x<this._buffers.length;++x)if(this._buffers[x][0]===u)return this._bufferIndex=x,this._buffer=u,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1}dispose(){if(this._noUBO)return;const u=this._engine._uniformBuffers,x=u.indexOf(this);if(-1!==x&&(u[x]=u[u.length-1],u.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let u=0;u<this._buffers.length;++u){const x=this._buffers[u][0];this._engine._releaseBuffer(x)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}W._UpdatedUbosInFrame={},W._MAX_UNIFORM_SIZE=256,W._TempBuffer=new Float32Array(W._MAX_UNIFORM_SIZE),W._TempBufferInt32View=new Int32Array(W._TempBuffer.buffer),W._TempBufferUInt32View=new Uint32Array(W._TempBuffer.buffer)},690096:(u,x,s)=>{s.d(x,{$x:()=>U,_0:()=>c,xp:()=>_});var U,_,W=s(604910);(function(u){u[u["LOCAL"]=0]="LOCAL",u[u["WORLD"]=1]="WORLD",u[u["BONE"]=2]="BONE"})(U||(U={}));class c{}c.X=new W.Pq(1,0,0),c.Y=new W.Pq(0,1,0),c.Z=new W.Pq(0,0,1),function(u){u[u["X"]=0]="X",u[u["Y"]=1]="Y",u[u["Z"]=2]="Z"}(_||(_={}))},332290:(u,x,s)=>{s.d(x,{IG:()=>r,ov:()=>j,v9:()=>d});var U=s(967872),_=s(310035),W=s(779908),c=s(615473),I=s(241082);function L(u){return Math.pow(u,W.tk)}function J(u){return u<=.04045?.0773993808*u:Math.pow(.947867299*(u+.055),2.4)}function k(u){return Math.pow(u,W.rv)}function i(u){return u<=.0031308?12.92*u:1.055*Math.pow(u,.41666)-.055}class d{constructor(u=0,x=0,s=0){this.r=u,this.g=x,this.b=s}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let u=255*this.r|0;return u=397*u^(255*this.g|0),u=397*u^(255*this.b|0),u}toArray(u,x=0){return u[x]=this.r,u[x+1]=this.g,u[x+2]=this.b,this}fromArray(u,x=0){return d.FromArrayToRef(u,x,this),this}toColor4(u=1){return new j(this.r,this.g,this.b,u)}asArray(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(u){return new d(this.r*u.r,this.g*u.g,this.b*u.b)}multiplyToRef(u,x){return x.r=this.r*u.r,x.g=this.g*u.g,x.b=this.b*u.b,x}multiplyInPlace(u){return this.r*=u.r,this.g*=u.g,this.b*=u.b,this}multiplyByFloats(u,x,s){return new d(this.r*u,this.g*x,this.b*s)}divide(u){throw new ReferenceError("Can not divide a color")}divideToRef(u,x){throw new ReferenceError("Can not divide a color")}divideInPlace(u){throw new ReferenceError("Can not divide a color")}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u.r,u.g,u.b)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u.r,u.g,u.b)}minimizeInPlaceFromFloats(u,x,s){return this.r=Math.min(u,this.r),this.g=Math.min(x,this.g),this.b=Math.min(s,this.b),this}maximizeInPlaceFromFloats(u,x,s){return this.r=Math.max(u,this.r),this.g=Math.max(x,this.g),this.b=Math.max(s,this.b),this}floorToRef(u){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(u){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b}equalsFloats(u,x,s){return this.equalsToFloats(u,x,s)}equalsToFloats(u,x,s){return this.r===u&&this.g===x&&this.b===s}equalsWithEpsilon(u,x=W.bH){return c.X.WithinEpsilon(this.r,u.r,x)&&c.X.WithinEpsilon(this.g,u.g,x)&&c.X.WithinEpsilon(this.b,u.b,x)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(u){throw new ReferenceError("Can not negate a color")}scale(u){return new d(this.r*u,this.g*u,this.b*u)}scaleInPlace(u){return this.r*=u,this.g*=u,this.b*=u,this}scaleToRef(u,x){return x.r=this.r*u,x.g=this.g*u,x.b=this.b*u,x}scaleAndAddToRef(u,x){return x.r+=this.r*u,x.g+=this.g*u,x.b+=this.b*u,x}clampToRef(u=0,x=1,s){return s.r=I.OQ(this.r,u,x),s.g=I.OQ(this.g,u,x),s.b=I.OQ(this.b,u,x),s}add(u){return new d(this.r+u.r,this.g+u.g,this.b+u.b)}addInPlace(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this}addInPlaceFromFloats(u,x,s){return this.r+=u,this.g+=x,this.b+=s,this}addToRef(u,x){return x.r=this.r+u.r,x.g=this.g+u.g,x.b=this.b+u.b,x}subtract(u){return new d(this.r-u.r,this.g-u.g,this.b-u.b)}subtractToRef(u,x){return x.r=this.r-u.r,x.g=this.g-u.g,x.b=this.b-u.b,x}subtractInPlace(u){return this.r-=u.r,this.g-=u.g,this.b-=u.b,this}subtractFromFloats(u,x,s){return new d(this.r-u,this.g-x,this.b-s)}subtractFromFloatsToRef(u,x,s,U){return U.r=this.r-u,U.g=this.g-x,U.b=this.b-s,U}clone(){return new d(this.r,this.g,this.b)}copyFrom(u){return this.r=u.r,this.g=u.g,this.b=u.b,this}copyFromFloats(u,x,s){return this.r=u,this.g=x,this.b=s,this}set(u,x,s){return this.copyFromFloats(u,x,s)}setAll(u){return this.r=this.g=this.b=u,this}toHexString(){const u=Math.round(255*this.r),x=Math.round(255*this.g),s=Math.round(255*this.b);return"#"+I.Db(u)+I.Db(x)+I.Db(s)}toHSV(){return this.toHSVToRef(new d)}toHSVToRef(u){const x=this.r,s=this.g,U=this.b,_=Math.max(x,s,U),W=Math.min(x,s,U);let c=0,I=0;const L=_,J=_-W;return 0!==_&&(I=J/_),_!=W&&(_==x?(c=(s-U)/J,s<U&&(c+=6)):_==s?c=(U-x)/J+2:_==U&&(c=(x-s)/J+4),c*=60),u.r=c,u.g=I,u.b=L,u}toLinearSpace(u=!1){const x=new d;return this.toLinearSpaceToRef(x,u),x}toLinearSpaceToRef(u,x=!1){return x?(u.r=J(this.r),u.g=J(this.g),u.b=J(this.b)):(u.r=L(this.r),u.g=L(this.g),u.b=L(this.b)),this}toGammaSpace(u=!1){const x=new d;return this.toGammaSpaceToRef(x,u),x}toGammaSpaceToRef(u,x=!1){return x?(u.r=i(this.r),u.g=i(this.g),u.b=i(this.b)):(u.r=k(this.r),u.g=k(this.g),u.b=k(this.b)),this}static HSVtoRGBToRef(u,x,s,U){const _=s*x,W=u/60,c=_*(1-Math.abs(W%2-1));let I=0,L=0,J=0;W>=0&&W<=1?(I=_,L=c):W>=1&&W<=2?(I=c,L=_):W>=2&&W<=3?(L=_,J=c):W>=3&&W<=4?(L=c,J=_):W>=4&&W<=5?(I=c,J=_):W>=5&&W<=6&&(I=_,J=c);const k=s-_;return U.r=I+k,U.g=L+k,U.b=J+k,U}static FromHSV(u,x,s){const U=new d(0,0,0);return d.HSVtoRGBToRef(u,x,s,U),U}static FromHexString(u){if("#"!==u.substring(0,1)||7!==u.length)return new d(0,0,0);const x=parseInt(u.substring(1,3),16),s=parseInt(u.substring(3,5),16),U=parseInt(u.substring(5,7),16);return d.FromInts(x,s,U)}static FromArray(u,x=0){return new d(u[x],u[x+1],u[x+2])}static FromArrayToRef(u,x=0,s){s.r=u[x],s.g=u[x+1],s.b=u[x+2]}static FromInts(u,x,s){return new d(u/255,x/255,s/255)}static Lerp(u,x,s){const U=new d(0,0,0);return d.LerpToRef(u,x,s,U),U}static LerpToRef(u,x,s,U){U.r=u.r+(x.r-u.r)*s,U.g=u.g+(x.g-u.g)*s,U.b=u.b+(x.b-u.b)*s}static Hermite(u,x,s,U,_){const W=_*_,c=_*W,I=2*c-3*W+1,L=-2*c+3*W,J=c-2*W+_,k=c-W,i=u.r*I+s.r*L+x.r*J+U.r*k,j=u.g*I+s.g*L+x.g*J+U.g*k,r=u.b*I+s.b*L+x.b*J+U.b*k;return new d(i,j,r)}static Hermite1stDerivative(u,x,s,U,_){const W=d.Black();return this.Hermite1stDerivativeToRef(u,x,s,U,_,W),W}static Hermite1stDerivativeToRef(u,x,s,U,_,W){const c=_*_;W.r=6*(c-_)*u.r+(3*c-4*_+1)*x.r+6*(-c+_)*s.r+(3*c-2*_)*U.r,W.g=6*(c-_)*u.g+(3*c-4*_+1)*x.g+6*(-c+_)*s.g+(3*c-2*_)*U.g,W.b=6*(c-_)*u.b+(3*c-4*_+1)*x.b+6*(-c+_)*s.b+(3*c-2*_)*U.b}static Red(){return new d(1,0,0)}static Green(){return new d(0,1,0)}static Blue(){return new d(0,0,1)}static Black(){return new d(0,0,0)}static get BlackReadOnly(){return d._BlackReadOnly}static White(){return new d(1,1,1)}static Purple(){return new d(.5,0,.5)}static Magenta(){return new d(1,0,1)}static Yellow(){return new d(1,1,0)}static Gray(){return new d(.5,.5,.5)}static Teal(){return new d(0,1,1)}static Random(){return new d(Math.random(),Math.random(),Math.random())}}d._BlackReadOnly=d.Black(),Object.defineProperties(d.prototype,{dimension:{value:[3]},rank:{value:1}});class j{constructor(u=0,x=0,s=0,U=1){this.r=u,this.g=x,this.b=s,this.a=U}asArray(){return[this.r,this.g,this.b,this.a]}toArray(u,x=0){return u[x]=this.r,u[x+1]=this.g,u[x+2]=this.b,u[x+3]=this.a,this}fromArray(u,x=0){return this.r=u[x],this.g=u[x+1],this.b=u[x+2],this.a=u[x+3],this}equals(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b&&this.a===u.a}add(u){return new j(this.r+u.r,this.g+u.g,this.b+u.b,this.a+u.a)}addToRef(u,x){return x.r=this.r+u.r,x.g=this.g+u.g,x.b=this.b+u.b,x.a=this.a+u.a,x}addInPlace(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this.a+=u.a,this}addInPlaceFromFloats(u,x,s,U){return this.r+=u,this.g+=x,this.b+=s,this.a+=U,this}subtract(u){return new j(this.r-u.r,this.g-u.g,this.b-u.b,this.a-u.a)}subtractToRef(u,x){return x.r=this.r-u.r,x.g=this.g-u.g,x.b=this.b-u.b,x.a=this.a-u.a,x}subtractInPlace(u){return this.r-=u.r,this.g-=u.g,this.b-=u.b,this.a-=u.a,this}subtractFromFloats(u,x,s,U){return new j(this.r-u,this.g-x,this.b-s,this.a-U)}subtractFromFloatsToRef(u,x,s,U,_){return _.r=this.r-u,_.g=this.g-x,_.b=this.b-s,_.a=this.a-U,_}scale(u){return new j(this.r*u,this.g*u,this.b*u,this.a*u)}scaleInPlace(u){return this.r*=u,this.g*=u,this.b*=u,this.a*=u,this}scaleToRef(u,x){return x.r=this.r*u,x.g=this.g*u,x.b=this.b*u,x.a=this.a*u,x}scaleAndAddToRef(u,x){return x.r+=this.r*u,x.g+=this.g*u,x.b+=this.b*u,x.a+=this.a*u,x}clampToRef(u=0,x=1,s){return s.r=I.OQ(this.r,u,x),s.g=I.OQ(this.g,u,x),s.b=I.OQ(this.b,u,x),s.a=I.OQ(this.a,u,x),s}multiply(u){return new j(this.r*u.r,this.g*u.g,this.b*u.b,this.a*u.a)}multiplyToRef(u,x){return x.r=this.r*u.r,x.g=this.g*u.g,x.b=this.b*u.b,x.a=this.a*u.a,x}multiplyInPlace(u){return this.r*=u.r,this.g*=u.g,this.b*=u.b,this.a*=u.a,this}multiplyByFloats(u,x,s,U){return new j(this.r*u,this.g*x,this.b*s,this.a*U)}divide(u){throw new ReferenceError("Can not divide a color")}divideToRef(u,x){throw new ReferenceError("Can not divide a color")}divideInPlace(u){throw new ReferenceError("Can not divide a color")}minimizeInPlace(u){return this.r=Math.min(this.r,u.r),this.g=Math.min(this.g,u.g),this.b=Math.min(this.b,u.b),this.a=Math.min(this.a,u.a),this}maximizeInPlace(u){return this.r=Math.max(this.r,u.r),this.g=Math.max(this.g,u.g),this.b=Math.max(this.b,u.b),this.a=Math.max(this.a,u.a),this}minimizeInPlaceFromFloats(u,x,s,U){return this.r=Math.min(u,this.r),this.g=Math.min(x,this.g),this.b=Math.min(s,this.b),this.a=Math.min(U,this.a),this}maximizeInPlaceFromFloats(u,x,s,U){return this.r=Math.max(u,this.r),this.g=Math.max(x,this.g),this.b=Math.max(s,this.b),this.a=Math.max(U,this.a),this}floorToRef(u){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(u){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(u){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(u,x=W.bH){return c.X.WithinEpsilon(this.r,u.r,x)&&c.X.WithinEpsilon(this.g,u.g,x)&&c.X.WithinEpsilon(this.b,u.b,x)&&c.X.WithinEpsilon(this.a,u.a,x)}equalsToFloats(u,x,s,U){return this.r===u&&this.g===x&&this.b===s&&this.a===U}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let u=255*this.r|0;return u=397*u^(255*this.g|0),u=397*u^(255*this.b|0),u=397*u^(255*this.a|0),u}clone(){return(new j).copyFrom(this)}copyFrom(u){return this.r=u.r,this.g=u.g,this.b=u.b,this.a=u.a,this}copyFromFloats(u,x,s,U){return this.r=u,this.g=x,this.b=s,this.a=U,this}set(u,x,s,U){return this.copyFromFloats(u,x,s,U)}setAll(u){return this.r=this.g=this.b=this.a=u,this}toHexString(u=!1){const x=Math.round(255*this.r),s=Math.round(255*this.g),U=Math.round(255*this.b);if(u)return"#"+I.Db(x)+I.Db(s)+I.Db(U);const _=Math.round(255*this.a);return"#"+I.Db(x)+I.Db(s)+I.Db(U)+I.Db(_)}toLinearSpace(u=!1){const x=new j;return this.toLinearSpaceToRef(x,u),x}toLinearSpaceToRef(u,x=!1){return x?(u.r=J(this.r),u.g=J(this.g),u.b=J(this.b)):(u.r=L(this.r),u.g=L(this.g),u.b=L(this.b)),u.a=this.a,this}toGammaSpace(u=!1){const x=new j;return this.toGammaSpaceToRef(x,u),x}toGammaSpaceToRef(u,x=!1){return x?(u.r=i(this.r),u.g=i(this.g),u.b=i(this.b)):(u.r=k(this.r),u.g=k(this.g),u.b=k(this.b)),u.a=this.a,this}static FromHexString(u){if("#"!==u.substring(0,1)||9!==u.length&&7!==u.length)return new j(0,0,0,0);const x=parseInt(u.substring(1,3),16),s=parseInt(u.substring(3,5),16),U=parseInt(u.substring(5,7),16),_=9===u.length?parseInt(u.substring(7,9),16):255;return j.FromInts(x,s,U,_)}static Lerp(u,x,s){return j.LerpToRef(u,x,s,new j)}static LerpToRef(u,x,s,U){return U.r=u.r+(x.r-u.r)*s,U.g=u.g+(x.g-u.g)*s,U.b=u.b+(x.b-u.b)*s,U.a=u.a+(x.a-u.a)*s,U}static Hermite(u,x,s,U,_){const W=_*_,c=_*W,I=2*c-3*W+1,L=-2*c+3*W,J=c-2*W+_,k=c-W,i=u.r*I+s.r*L+x.r*J+U.r*k,d=u.g*I+s.g*L+x.g*J+U.g*k,r=u.b*I+s.b*L+x.b*J+U.b*k,D=u.a*I+s.a*L+x.a*J+U.a*k;return new j(i,d,r,D)}static Hermite1stDerivative(u,x,s,U,_){const W=new j;return this.Hermite1stDerivativeToRef(u,x,s,U,_,W),W}static Hermite1stDerivativeToRef(u,x,s,U,_,W){const c=_*_;W.r=6*(c-_)*u.r+(3*c-4*_+1)*x.r+6*(-c+_)*s.r+(3*c-2*_)*U.r,W.g=6*(c-_)*u.g+(3*c-4*_+1)*x.g+6*(-c+_)*s.g+(3*c-2*_)*U.g,W.b=6*(c-_)*u.b+(3*c-4*_+1)*x.b+6*(-c+_)*s.b+(3*c-2*_)*U.b,W.a=6*(c-_)*u.a+(3*c-4*_+1)*x.a+6*(-c+_)*s.a+(3*c-2*_)*U.a}static FromColor3(u,x=1){return new j(u.r,u.g,u.b,x)}static FromArray(u,x=0){return new j(u[x],u[x+1],u[x+2],u[x+3])}static FromArrayToRef(u,x=0,s){s.r=u[x],s.g=u[x+1],s.b=u[x+2],s.a=u[x+3]}static FromInts(u,x,s,U){return new j(u/255,x/255,s/255,U/255)}static CheckColors4(u,x){if(u.length===3*x){const x=[];for(let s=0;s<u.length;s+=3){const U=s/3*4;x[U]=u[s],x[U+1]=u[s+1],x[U+2]=u[s+2],x[U+3]=1}return x}return u}}Object.defineProperties(j.prototype,{dimension:{value:[4]},rank:{value:1}});class r{}r.Color3=U.mI(3,d.Black),r.Color4=U.mI(3,(()=>new j(0,0,0,0))),_.Y5("BABYLON.Color3",d),_.Y5("BABYLON.Color4",j)},779908:(u,x,s)=>{s.d(x,{a6:()=>W,bH:()=>c,rv:()=>U,tk:()=>_});const U=1/2.2,_=2.2,W=(1+Math.sqrt(5))/2,c=.001},993739:(u,x,s)=>{s.d(x,{P:()=>_});var U=s(298039);class _{static GetPlanes(u){const x=[];for(let u=0;u<6;u++)x.push(new U.Z(0,0,0,0));return _.GetPlanesToRef(u,x),x}static GetNearPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]+s[2],x.normal.y=s[7]+s[6],x.normal.z=s[11]+s[10],x.d=s[15]+s[14],x.normalize()}static GetFarPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]-s[2],x.normal.y=s[7]-s[6],x.normal.z=s[11]-s[10],x.d=s[15]-s[14],x.normalize()}static GetLeftPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]+s[0],x.normal.y=s[7]+s[4],x.normal.z=s[11]+s[8],x.d=s[15]+s[12],x.normalize()}static GetRightPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]-s[0],x.normal.y=s[7]-s[4],x.normal.z=s[11]-s[8],x.d=s[15]-s[12],x.normalize()}static GetTopPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]-s[1],x.normal.y=s[7]-s[5],x.normal.z=s[11]-s[9],x.d=s[15]-s[13],x.normalize()}static GetBottomPlaneToRef(u,x){const s=u.m;x.normal.x=s[3]+s[1],x.normal.y=s[7]+s[5],x.normal.z=s[11]+s[9],x.d=s[15]+s[13],x.normalize()}static GetPlanesToRef(u,x){_.GetNearPlaneToRef(u,x[0]),_.GetFarPlaneToRef(u,x[1]),_.GetLeftPlaneToRef(u,x[2]),_.GetRightPlaneToRef(u,x[3]),_.GetTopPlaneToRef(u,x[4]),_.GetBottomPlaneToRef(u,x[5])}static IsPointInFrustum(u,x){for(let s=0;s<6;s++)if(x[s].dotCoordinate(u)<0)return!1;return!0}}},755752:(u,x,s)=>{s.d(x,{b:()=>L,c:()=>I});var U=s(297809),_=s(604910),W=s(760998);class c{static extractMinAndMaxIndexed(u,x,s,U,_,W){for(let c=s;c<s+U;c++){const s=3*x[c],U=u[s],I=u[s+1],L=u[s+2];_.minimizeInPlaceFromFloats(U,I,L),W.maximizeInPlaceFromFloats(U,I,L)}}static extractMinAndMax(u,x,s,U,_,W){for(let c=x,I=x*U;c<x+s;c++,I+=U){const x=u[I],s=u[I+1],U=u[I+2];_.minimizeInPlaceFromFloats(x,s,U),W.maximizeInPlaceFromFloats(x,s,U)}}}function I(u,x,s,U,W=null){const I=new _.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new _.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return c.extractMinAndMaxIndexed(u,x,s,U,I,L),W&&(I.x-=I.x*W.x+W.y,I.y-=I.y*W.x+W.y,I.z-=I.z*W.x+W.y,L.x+=L.x*W.x+W.y,L.y+=L.y*W.x+W.y,L.z+=L.z*W.x+W.y),{minimum:I,maximum:L}}function L(u,x,s,U=null,W){const I=new _.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new _.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return W||(W=3),c.extractMinAndMax(u,x,s,W,I,L),U&&(I.x-=I.x*U.x+U.y,I.y-=I.y*U.x+U.y,I.z-=I.z*U.x+U.y,L.x+=L.x*U.x+U.y,L.y+=L.y*U.x+U.y,L.z+=L.z*U.x+U.y),{minimum:I,maximum:L}}U.Cg([W.Cx.filter(((...[u,x])=>!Array.isArray(u)&&!Array.isArray(x)))],c,"extractMinAndMaxIndexed",null),U.Cg([W.Cx.filter(((...[u])=>!Array.isArray(u)))],c,"extractMinAndMax",null)},948733:(u,x,s)=>{s.d(x,{uM:()=>I.uM,Xy:()=>I.Xy,_0:()=>U._0,vr:()=>I.vr,v9:()=>_.v9,ov:()=>_.ov,xp:()=>U.xp,jj:()=>I.jj,bH:()=>W.bH,PP:()=>c.P,uq:()=>k.uq,t4:()=>I.t4,a6:()=>W.a6,Cu:()=>I.Cu,tO:()=>I.tO,Zc:()=>L.Z,k0:()=>d,B5:()=>i,PT:()=>k.PT,or:()=>J.o,$x:()=>U.$x,IG:()=>_.IG,AA:()=>k.AA,rv:()=>W.rv,tk:()=>W.tk,I9:()=>k.I9,Pq:()=>k.Pq,IU:()=>k.IU,LM:()=>j.L});var U=s(690096),_=s(332290),W=s(779908),c=s(993739),I=s(808966),L=s(298039),J=s(500556),k=s(604910);class i{constructor(u=k.Pq.Zero(),x=k.Pq.Up()){this.position=u,this.normal=x}clone(){return new i(this.position.clone(),this.normal.clone())}}class d{constructor(u=k.Pq.Zero(),x=k.Pq.Up(),s=k.I9.Zero()){this.position=u,this.normal=x,this.uv=s}clone(){return new d(this.position.clone(),this.normal.clone(),this.uv.clone())}}var j=s(60071)},808966:(u,x,s)=>{s.d(x,{Cu:()=>k,Xy:()=>J,jj:()=>d,t4:()=>U,tO:()=>i,uM:()=>L,vr:()=>I});var U,_=s(615473),W=s(604910),c=s(779908);(function(u){u[u["CW"]=0]="CW",u[u["CCW"]=1]="CCW"})(U||(U={}));class I{static Interpolate(u,x,s,U,_){const W=1-3*U+3*x,c=3*U-6*x,I=3*x;let L=u;for(let x=0;x<5;x++){const x=L*L;L-=(W*(x*L)+c*x+I*L-u)*(1/(3*W*x+2*c*L+I)),L=Math.min(1,Math.max(0,L))}return 3*Math.pow(1-L,2)*L*s+3*(1-L)*Math.pow(L,2)*_+Math.pow(L,3)}}class L{constructor(u){this._radians=u,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(u,x){const s=x.subtract(u),U=Math.atan2(s.y,s.x);return new L(U)}static BetweenTwoVectors(u,x){let s=u.lengthSquared()*x.lengthSquared();if(0===s)return new L(Math.PI/2);s=Math.sqrt(s);let U=u.dot(x)/s;U=_.X.Clamp(U,-1,1);const W=Math.acos(U);return new L(W)}static FromRadians(u){return new L(u)}static FromDegrees(u){return new L(u*Math.PI/180)}}class J{constructor(u,x,s){this.startPoint=u,this.midPoint=x,this.endPoint=s;const U=Math.pow(x.x,2)+Math.pow(x.y,2),_=(Math.pow(u.x,2)+Math.pow(u.y,2)-U)/2,c=(U-Math.pow(s.x,2)-Math.pow(s.y,2))/2,I=(u.x-x.x)*(x.y-s.y)-(x.x-s.x)*(u.y-x.y);this.centerPoint=new W.I9((_*(x.y-s.y)-c*(u.y-x.y))/I,((u.x-x.x)*c-(x.x-s.x)*_)/I),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=L.BetweenTwoPoints(this.centerPoint,this.startPoint);const J=this.startAngle.degrees();let k=L.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),i=L.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();k-J>+180&&(k-=360),k-J<-180&&(k+=360),i-k>+180&&(i-=360),i-k<-180&&(i+=360),this.orientation=k-J<0?0:1,this.angle=L.FromDegrees(0===this.orientation?J-i:i-J)}}class k{constructor(u,x){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new W.I9(u,x))}addLineTo(u,x){if(this.closed)return this;const s=new W.I9(u,x),U=this._points[this._points.length-1];return this._points.push(s),this._length+=s.subtract(U).length(),this}addArcTo(u,x,s,U,_=36){if(this.closed)return this;const c=this._points[this._points.length-1],I=new W.I9(u,x),L=new W.I9(s,U),k=new J(c,I,L);let i=k.angle.radians()/_;0===k.orientation&&(i*=-1);let d=k.startAngle.radians()+i;for(let u=0;u<_;u++){const u=Math.cos(d)*k.radius+k.centerPoint.x,x=Math.sin(d)*k.radius+k.centerPoint.y;this.addLineTo(u,x),d+=i}return this}addQuadraticCurveTo(u,x,s,U,_=36){if(this.closed)return this;const W=(u,x,s,U)=>(1-u)*(1-u)*x+2*u*(1-u)*s+u*u*U,c=this._points[this._points.length-1];for(let I=0;I<=_;I++){const L=I/_,J=W(L,c.x,u,s),k=W(L,c.y,x,U);this.addLineTo(J,k)}return this}addBezierCurveTo(u,x,s,U,_,W,c=36){if(this.closed)return this;const I=(u,x,s,U,_)=>(1-u)*(1-u)*(1-u)*x+3*u*(1-u)*(1-u)*s+3*u*u*(1-u)*U+u*u*u*_,L=this._points[this._points.length-1];for(let J=0;J<=c;J++){const k=J/c,i=I(k,L.x,u,s,_),d=I(k,L.y,x,U,W);this.addLineTo(i,d)}return this}isPointInside(u){let x=!1;const s=this._points.length;for(let U=s-1,_=0;_<s;U=_++){let s=this._points[U],W=this._points[_],c=W.x-s.x,I=W.y-s.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(s=this._points[_],c=-c,W=this._points[U],I=-I),u.y<s.y||u.y>W.y)continue;if(u.y===s.y&&u.x===s.x)return!0;{const U=I*(u.x-s.x)-c*(u.y-s.y);if(0===U)return!0;if(U<0)continue;x=!x}}else{if(u.y!==s.y)continue;if(W.x<=u.x&&u.x<=s.x||s.x<=u.x&&u.x<=W.x)return!0}}return x}close(){return this.closed=!0,this}length(){let u=this._length;if(this.closed){const x=this._points[this._points.length-1];u+=this._points[0].subtract(x).length()}return u}area(){const u=this._points.length;let x=0;for(let s=u-1,U=0;U<u;s=U++)x+=this._points[s].x*this._points[U].y-this._points[U].x*this._points[s].y;return.5*x}getPoints(){return this._points}getPointAtLengthPosition(u){if(u<0||u>1)return W.I9.Zero();const x=u*this.length();let s=0;for(let u=0;u<this._points.length;u++){const U=(u+1)%this._points.length,_=this._points[u],c=this._points[U].subtract(_),I=c.length()+s;if(x>=s&&x<=I){const u=c.normalize(),U=x-s;return new W.I9(_.x+u.x*U,_.y+u.y*U)}s=I}return W.I9.Zero()}static StartingAt(u,x){return new k(u,x)}}class i{constructor(u,x=null,s,U=!1){this.path=u,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:W.Pq.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:W.uq.Identity()};for(let x=0;x<u.length;x++)this._curve[x]=u[x].clone();this._raw=s||!1,this._alignTangentsWithPath=U,this._compute(x,U)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(u){return this._updatePointAtData(u).point}getTangentAt(u,x=!1){return this._updatePointAtData(u,x),x?W.Pq.TransformCoordinates(W.Pq.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(u,x=!1){return this._updatePointAtData(u,x),x?W.Pq.TransformCoordinates(W.Pq.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(u,x=!1){return this._updatePointAtData(u,x),x?W.Pq.TransformCoordinates(W.Pq.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(u){return this.length()*u}getPreviousPointIndexAt(u){return this._updatePointAtData(u),this._pointAtData.previousPointArrayIndex}getSubPositionAt(u){return this._updatePointAtData(u),this._pointAtData.subPosition}getClosestPositionTo(u){let x=Number.MAX_VALUE,s=0;for(let U=0;U<this._curve.length-1;U++){const _=this._curve[U+0],c=this._curve[U+1].subtract(_).normalize(),I=this._distances[U+1]-this._distances[U+0],L=Math.min(Math.max(W.Pq.Dot(c,u.subtract(_).normalize()),0)*W.Pq.Distance(_,u)/I,1),J=W.Pq.Distance(_.add(c.scale(L*I)),u);J<x&&(x=J,s=(this._distances[U+0]+I*L)/this.length())}return s}slice(u=0,x=1){if(u<0&&(u=1- -1*u%1),x<0&&(x=1- -1*x%1),u>x){const s=u;u=x,x=s}const s=this.getCurve(),U=this.getPointAt(u);let _=this.getPreviousPointIndexAt(u);const W=this.getPointAt(x),c=this.getPreviousPointIndexAt(x)+1,I=[];return 0!==u&&(_++,I.push(U)),I.push(...s.slice(_,c)),1===x&&1!==u||I.push(W),new i(I,this.getNormalAt(u),this._raw,this._alignTangentsWithPath)}update(u,x=null,s=!1){for(let x=0;x<u.length;x++)this._curve[x].x=u[x].x,this._curve[x].y=u[x].y,this._curve[x].z=u[x].z;return this._compute(x,s),this}_compute(u,x=!1){const s=this._curve.length;if(s<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[s-1]=this._curve[s-1].subtract(this._curve[s-2]),this._raw||this._tangents[s-1].normalize();const U=this._tangents[0],_=this._normalVector(U,u);let c,I,L,J,k;this._normals[0]=_,this._raw||this._normals[0].normalize(),this._binormals[0]=W.Pq.Cross(U,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let u=1;u<s;u++)c=this._getLastNonNullVector(u),u<s-1&&(I=this._getFirstNonNullVector(u),this._tangents[u]=x?I:c.add(I),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+this._curve[u].subtract(this._curve[u-1]).length(),L=this._tangents[u],k=this._binormals[u-1],this._normals[u]=W.Pq.Cross(k,L),this._raw||(0===this._normals[u].length()?(J=this._normals[u-1],this._normals[u]=J.clone()):this._normals[u].normalize()),this._binormals[u]=W.Pq.Cross(L,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(u){let x=1,s=this._curve[u+x].subtract(this._curve[u]);for(;0===s.length()&&u+x+1<this._curve.length;)x++,s=this._curve[u+x].subtract(this._curve[u]);return s}_getLastNonNullVector(u){let x=1,s=this._curve[u].subtract(this._curve[u-x]);for(;0===s.length()&&u>x+1;)x++,s=this._curve[u].subtract(this._curve[u-x]);return s}_normalVector(u,x){let s,U=u.length();if(0===U&&(U=1),null==x){let x;x=_.X.WithinEpsilon(Math.abs(u.y)/U,1,c.bH)?_.X.WithinEpsilon(Math.abs(u.x)/U,1,c.bH)?_.X.WithinEpsilon(Math.abs(u.z)/U,1,c.bH)?W.Pq.Zero():new W.Pq(0,0,1):new W.Pq(1,0,0):new W.Pq(0,-1,0),s=W.Pq.Cross(u,x)}else s=W.Pq.Cross(u,x),W.Pq.CrossToRef(s,u,s);return s.normalize(),s}_updatePointAtData(u,x=!1){if(this._pointAtData.id===u)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=u;const s=this.getPoints();if(u<=0)return this._setPointAtData(0,0,s[0],0,x);if(u>=1)return this._setPointAtData(1,1,s[s.length-1],s.length-1,x);let U,_=s[0],c=0;const I=u*this.length();for(let L=1;L<s.length;L++){U=s[L];const J=W.Pq.Distance(_,U);if(c+=J,c===I)return this._setPointAtData(u,1,U,L,x);if(c>I){const s=(c-I)/J,W=_.subtract(U),k=U.add(W.scaleInPlace(s));return this._setPointAtData(u,1-s,k,L-1,x)}_=U}return this._pointAtData}_setPointAtData(u,x,s,U,_){return this._pointAtData.point=s,this._pointAtData.position=u,this._pointAtData.subPosition=x,this._pointAtData.previousPointArrayIndex=U,this._pointAtData.interpolateReady=_,_&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=W.uq.Identity();const u=this._pointAtData.previousPointArrayIndex;if(u!==this._tangents.length-1){const x=u+1,s=this._tangents[u].clone(),U=this._normals[u].clone(),_=this._binormals[u].clone(),c=this._tangents[x].clone(),I=this._normals[x].clone(),L=this._binormals[x].clone(),J=W.PT.RotationQuaternionFromAxis(U,_,s),k=W.PT.RotationQuaternionFromAxis(I,L,c);W.PT.Slerp(J,k,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class d{static CreateQuadraticBezier(u,x,s,U){U=U>2?U:3;const _=[],c=(u,x,s,U)=>(1-u)*(1-u)*x+2*u*(1-u)*s+u*u*U;for(let I=0;I<=U;I++)_.push(new W.Pq(c(I/U,u.x,x.x,s.x),c(I/U,u.y,x.y,s.y),c(I/U,u.z,x.z,s.z)));return new d(_)}static CreateCubicBezier(u,x,s,U,_){_=_>3?_:4;const c=[],I=(u,x,s,U,_)=>(1-u)*(1-u)*(1-u)*x+3*u*(1-u)*(1-u)*s+3*u*u*(1-u)*U+u*u*u*_;for(let L=0;L<=_;L++)c.push(new W.Pq(I(L/_,u.x,x.x,s.x,U.x),I(L/_,u.y,x.y,s.y,U.y),I(L/_,u.z,x.z,s.z,U.z)));return new d(c)}static CreateHermiteSpline(u,x,s,U,_){const c=[],I=1/_;for(let L=0;L<=_;L++)c.push(W.Pq.Hermite(u,x,s,U,L*I));return new d(c)}static CreateCatmullRomSpline(u,x,s){const U=[],_=1/x;let c=0;if(s){const s=u.length;for(let I=0;I<s;I++){c=0;for(let L=0;L<x;L++)U.push(W.Pq.CatmullRom(u[I%s],u[(I+1)%s],u[(I+2)%s],u[(I+3)%s],c)),c+=_}U.push(U[0])}else{const s=[];s.push(u[0].clone()),Array.prototype.push.apply(s,u),s.push(u[u.length-1].clone());let I=0;for(;I<s.length-3;I++){c=0;for(let u=0;u<x;u++)U.push(W.Pq.CatmullRom(s[I],s[I+1],s[I+2],s[I+3],c)),c+=_}I--,U.push(W.Pq.CatmullRom(s[I],s[I+1],s[I+2],s[I+3],c))}return new d(U)}static ArcThru3Points(u,x,s,U=32,_=!1,c=!1){const I=[],L=x.subtract(u),J=s.subtract(x),k=u.subtract(s),i=W.Pq.Cross(L,J),j=i.length();if(j<Math.pow(10,-8))return new d(I);const r=L.lengthSquared(),D=J.lengthSquared(),$=k.lengthSquared(),H=i.lengthSquared(),f=.5*L.length()*J.length()*k.length()/j,O=-.5*D*W.Pq.Dot(L,k)/H,t=-.5*$*W.Pq.Dot(L,J)/H,V=-.5*r*W.Pq.Dot(J,k)/H,N=u.scale(O).add(x.scale(t)).add(s.scale(V)),m=u.subtract(N).normalize(),b=W.Pq.Cross(i,m).normalize();if(c){const x=2*Math.PI/U;for(let u=0;u<=2*Math.PI;u+=x)I.push(N.add(m.scale(f*Math.cos(u)).add(b.scale(f*Math.sin(u)))));I.push(u)}else{const x=1/U;let c=0,L=W.Pq.Zero();do{L=N.add(m.scale(f*Math.cos(c)).add(b.scale(f*Math.sin(c)))),I.push(L),c+=x}while(!L.equalsWithEpsilon(s,f*x*1.1));I.push(s),_&&I.push(u)}return new d(I)}constructor(u){this._length=0,this._points=u,this._length=this._computeLength(u)}getPoints(){return this._points}length(){return this._length}continue(u){const x=this._points[this._points.length-1],s=this._points.slice(),U=u.getPoints();for(let u=1;u<U.length;u++)s.push(U[u].subtract(U[0]).add(x));return new d(s)}_computeLength(u){let x=0;for(let s=1;s<u.length;s++)x+=u[s].subtract(u[s-1]).length();return x}}},298039:(u,x,s)=>{s.d(x,{Z:()=>_});var U=s(604910);class _{constructor(u,x,s,_){this.normal=new U.Pq(u,x,s),this.d=_}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new _(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let u=this.normal.getHashCode();return u=397*u^(0|this.d),u}normalize(){const u=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let x=0;return 0!==u&&(x=1/u),this.normal.x*=x,this.normal.y*=x,this.normal.z*=x,this.d*=x,this}transform(u){const x=_._TmpMatrix;u.invertToRef(x);const s=x.m,U=this.normal.x,W=this.normal.y,c=this.normal.z,I=this.d,L=U*s[0]+W*s[1]+c*s[2]+I*s[3],J=U*s[4]+W*s[5]+c*s[6]+I*s[7],k=U*s[8]+W*s[9]+c*s[10]+I*s[11],i=U*s[12]+W*s[13]+c*s[14]+I*s[15];return new _(L,J,k,i)}dotCoordinate(u){return this.normal.x*u.x+this.normal.y*u.y+this.normal.z*u.z+this.d}copyFromPoints(u,x,s){const U=x.x-u.x,_=x.y-u.y,W=x.z-u.z,c=s.x-u.x,I=s.y-u.y,L=s.z-u.z,J=_*L-W*I,k=W*c-U*L,i=U*I-_*c,d=Math.sqrt(J*J+k*k+i*i);let j;return j=0!==d?1/d:0,this.normal.x=J*j,this.normal.y=k*j,this.normal.z=i*j,this.d=-(this.normal.x*u.x+this.normal.y*u.y+this.normal.z*u.z),this}isFrontFacingTo(u,x){return U.Pq.Dot(this.normal,u)<=x}signedDistanceTo(u){return U.Pq.Dot(u,this.normal)+this.d}static FromArray(u){return new _(u[0],u[1],u[2],u[3])}static FromPoints(u,x,s){const U=new _(0,0,0,0);return U.copyFromPoints(u,x,s),U}static FromPositionAndNormal(u,x){const s=new _(0,0,0,0);return this.FromPositionAndNormalToRef(u,x,s)}static FromPositionAndNormalToRef(u,x,s){return s.normal.copyFrom(x),s.normal.normalize(),s.d=-u.dot(s.normal),s}static SignedDistanceToPlaneFromPositionAndNormal(u,x,s){const _=-(x.x*u.x+x.y*u.y+x.z*u.z);return U.Pq.Dot(s,x)+_}}_._TmpMatrix=U.uq.Identity()},241082:(u,x,s)=>{function U(u,x,s=1401298e-51){return Math.abs(u-x)<=s}function _(u,x){return u===x?u:Math.random()*(x-u)+u}function W(u,x,s){return u+(x-u)*s}function c(u,x=0,s=1){return Math.min(s,Math.max(x,u))}function I(u){return u-2*Math.PI*Math.floor((u+Math.PI)/(2*Math.PI))}function L(u){const x=u.toString(16);return u<=15?("0"+x).toUpperCase():x.toUpperCase()}s.d(x,{Db:()=>L,Mj:()=>U,OQ:()=>c,VD:()=>_,cP:()=>W,ed:()=>I})},615473:(u,x,s)=>{s.d(x,{X:()=>_});var U=s(241082);class _{static Sign(u){return 0==(u=+u)||isNaN(u)?u:u>0?1:-1}static Log2(u){return Math.log(u)*Math.LOG2E}static ILog2(u){if(Math.log2)return Math.floor(Math.log2(u));if(u<0)return NaN;if(0===u)return-1/0;let x=0;if(u<1){for(;u<1;)x++,u*=2;x=-x}else if(u>1)for(;u>1;)x++,u=Math.floor(u/2);return x}static Repeat(u,x){return u-Math.floor(u/x)*x}static Normalize(u,x,s){return(u-x)/(s-x)}static Denormalize(u,x,s){return u*(s-x)+x}static DeltaAngle(u,x){let s=_.Repeat(x-u,360);return s>180&&(s-=360),s}static PingPong(u,x){const s=_.Repeat(u,2*x);return x-Math.abs(s-x)}static SmoothStep(u,x,s){let U=_.Clamp(s);return U=-2*U*U*U+3*U*U,x*U+u*(1-U)}static MoveTowards(u,x,s){let U=0;return U=Math.abs(x-u)<=s?x:u+_.Sign(x-u)*s,U}static MoveTowardsAngle(u,x,s){const U=_.DeltaAngle(u,x);let W=0;return-s<U&&U<s?W=x:(x=u+U,W=_.MoveTowards(u,x,s)),W}static LerpAngle(u,x,s){let W=_.Repeat(x-u,360);return W>180&&(W-=360),u+W*U.OQ(s)}static InverseLerp(u,x,s){let _=0;return _=u!=x?U.OQ((s-u)/(x-u)):0,_}static Hermite(u,x,s,U,_){const W=_*_,c=_*W;return u*(2*c-3*W+1)+s*(-2*c+3*W)+x*(c-2*W+_)+U*(c-W)}static Hermite1stDerivative(u,x,s,U,_){const W=_*_;return 6*(W-_)*u+(3*W-4*_+1)*x+6*(-W+_)*s+(3*W-2*_)*U}static RangeToPercent(u,x,s){return(u-x)/(s-x)}static PercentToRange(u,x,s){return(s-x)*u+x}static HCF(u,x){const s=u%x;return 0===s?x:_.HCF(x,s)}}_.TwoPi=2*Math.PI,_.WithinEpsilon=U.Mj,_.ToHex=U.Db,_.Clamp=U.OQ,_.Lerp=U.cP,_.RandomRange=U.VD,_.NormalizeRadians=U.ed},500556:(u,x,s)=>{s.d(x,{o:()=>U});class U{constructor(u,x){this.width=u,this.height=x}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let u=0|this.width;return u=397*u^(0|this.height),u}copyFrom(u){this.width=u.width,this.height=u.height}copyFromFloats(u,x){return this.width=u,this.height=x,this}set(u,x){return this.copyFromFloats(u,x)}multiplyByFloats(u,x){return new U(this.width*u,this.height*x)}clone(){return new U(this.width,this.height)}equals(u){return!!u&&this.width===u.width&&this.height===u.height}get surface(){return this.width*this.height}static Zero(){return new U(0,0)}add(u){return new U(this.width+u.width,this.height+u.height)}subtract(u){return new U(this.width-u.width,this.height-u.height)}scale(u){return new U(this.width*u,this.height*u)}static Lerp(u,x,s){const _=u.width+(x.width-u.width)*s,W=u.height+(x.height-u.height)*s;return new U(_,W)}}},604910:(u,x,s)=>{s.d(x,{AA:()=>$,I9:()=>k,IU:()=>d,PT:()=>j,Pq:()=>i,uq:()=>r});var U=s(779908),_=s(967872),W=s(310035),c=s(155429),I=s(395726),L=s(241082);const J=u=>parseInt(u.toString().replace(/\W/g,""));class k{constructor(u=0,x=0){this.x=u,this.y=x}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let u=J(this.x);return u=397*u^J(this.y),u}toArray(u,x=0){return u[x]=this.x,u[x+1]=this.y,this}fromArray(u,x=0){return k.FromArrayToRef(u,x,this),this}asArray(){return[this.x,this.y]}copyFrom(u){return this.x=u.x,this.y=u.y,this}copyFromFloats(u,x){return this.x=u,this.y=x,this}set(u,x){return this.copyFromFloats(u,x)}setAll(u){return this.copyFromFloats(u,u)}add(u){return new k(this.x+u.x,this.y+u.y)}addToRef(u,x){return x.x=this.x+u.x,x.y=this.y+u.y,x}addInPlace(u){return this.x+=u.x,this.y+=u.y,this}addInPlaceFromFloats(u,x){return this.x+=u,this.y+=x,this}addVector3(u){return new k(this.x+u.x,this.y+u.y)}subtract(u){return new k(this.x-u.x,this.y-u.y)}subtractToRef(u,x){return x.x=this.x-u.x,x.y=this.y-u.y,x}subtractInPlace(u){return this.x-=u.x,this.y-=u.y,this}multiplyInPlace(u){return this.x*=u.x,this.y*=u.y,this}multiply(u){return new k(this.x*u.x,this.y*u.y)}multiplyToRef(u,x){return x.x=this.x*u.x,x.y=this.y*u.y,x}multiplyByFloats(u,x){return new k(this.x*u,this.y*x)}divide(u){return new k(this.x/u.x,this.y/u.y)}divideToRef(u,x){return x.x=this.x/u.x,x.y=this.y/u.y,x}divideInPlace(u){return this.x=this.x/u.x,this.y=this.y/u.y,this}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u.x,u.y)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u.x,u.y)}minimizeInPlaceFromFloats(u,x){return this.x=Math.min(u,this.x),this.y=Math.min(x,this.y),this}maximizeInPlaceFromFloats(u,x){return this.x=Math.max(u,this.x),this.y=Math.max(x,this.y),this}subtractFromFloats(u,x){return new k(this.x-u,this.y-x)}subtractFromFloatsToRef(u,x,s){return s.x=this.x-u,s.y=this.y-x,s}negate(){return new k(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(u){return u.x=-this.x,u.y=-this.y,u}scaleInPlace(u){return this.x*=u,this.y*=u,this}scale(u){return new k(this.x*u,this.y*u)}scaleToRef(u,x){return x.x=this.x*u,x.y=this.y*u,x}scaleAndAddToRef(u,x){return x.x+=this.x*u,x.y+=this.y*u,x}equals(u){return u&&this.x===u.x&&this.y===u.y}equalsWithEpsilon(u,x=U.bH){return u&&L.Mj(this.x,u.x,x)&&L.Mj(this.y,u.y,x)}equalsToFloats(u,x){return this.x===u&&this.y===x}floor(){return new k(Math.floor(this.x),Math.floor(this.y))}floorToRef(u){return u.x=Math.floor(this.x),u.y=Math.floor(this.y),u}fract(){return new k(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(u){return u.x=this.x-Math.floor(this.x),u.y=this.y-Math.floor(this.y),u}rotateToRef(u,x){const s=Math.cos(u),U=Math.sin(u),_=s*this.x-U*this.y,W=U*this.x+s*this.y;return x.x=_,x.y=W,x}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){const u=new k;return this.normalizeToRef(u),u}normalizeToRef(u){const x=this.length();return 0===x&&(u.x=this.x,u.y=this.y),this.scaleToRef(1/x,u)}clone(){return new k(this.x,this.y)}dot(u){return this.x*u.x+this.y*u.y}static Zero(){return new k(0,0)}static One(){return new k(1,1)}static Random(u=0,x=1){return new k(L.VD(u,x),L.VD(u,x))}static RandomToRef(u=0,x=1,s){return s.copyFromFloats(L.VD(u,x),L.VD(u,x))}static get ZeroReadOnly(){return k._ZeroReadOnly}static FromArray(u,x=0){return new k(u[x],u[x+1])}static FromArrayToRef(u,x,s){return s.x=u[x],s.y=u[x+1],s}static FromFloatsToRef(u,x,s){return s.copyFromFloats(u,x),s}static CatmullRom(u,x,s,U,_){const W=_*_,c=_*W,I=.5*(2*x.x+(-u.x+s.x)*_+(2*u.x-5*x.x+4*s.x-U.x)*W+(-u.x+3*x.x-3*s.x+U.x)*c),L=.5*(2*x.y+(-u.y+s.y)*_+(2*u.y-5*x.y+4*s.y-U.y)*W+(-u.y+3*x.y-3*s.y+U.y)*c);return new k(I,L)}static ClampToRef(u,x,s,U){return U.x=L.OQ(u.x,x.x,s.x),U.y=L.OQ(u.y,x.y,s.y),U}static Clamp(u,x,s){const U=L.OQ(u.x,x.x,s.x),_=L.OQ(u.y,x.y,s.y);return new k(U,_)}static Hermite(u,x,s,U,_){const W=_*_,c=_*W,I=2*c-3*W+1,L=-2*c+3*W,J=c-2*W+_,i=c-W,d=u.x*I+s.x*L+x.x*J+U.x*i,j=u.y*I+s.y*L+x.y*J+U.y*i;return new k(d,j)}static Hermite1stDerivative(u,x,s,U,_){return this.Hermite1stDerivativeToRef(u,x,s,U,_,new k)}static Hermite1stDerivativeToRef(u,x,s,U,_,W){const c=_*_;return W.x=6*(c-_)*u.x+(3*c-4*_+1)*x.x+6*(-c+_)*s.x+(3*c-2*_)*U.x,W.y=6*(c-_)*u.y+(3*c-4*_+1)*x.y+6*(-c+_)*s.y+(3*c-2*_)*U.y,W}static Lerp(u,x,s){return k.LerpToRef(u,x,s,new k)}static LerpToRef(u,x,s,U){return U.x=u.x+(x.x-u.x)*s,U.y=u.y+(x.y-u.y)*s,U}static Dot(u,x){return u.x*x.x+u.y*x.y}static Normalize(u){return k.NormalizeToRef(u,new k)}static NormalizeToRef(u,x){return u.normalizeToRef(x),x}static Minimize(u,x){const s=u.x<x.x?u.x:x.x,U=u.y<x.y?u.y:x.y;return new k(s,U)}static Maximize(u,x){const s=u.x>x.x?u.x:x.x,U=u.y>x.y?u.y:x.y;return new k(s,U)}static Transform(u,x){return k.TransformToRef(u,x,new k)}static TransformToRef(u,x,s){const U=x.m,_=u.x*U[0]+u.y*U[4]+U[12],W=u.x*U[1]+u.y*U[5]+U[13];return s.x=_,s.y=W,s}static PointInTriangle(u,x,s,U){const _=1/2*(-s.y*U.x+x.y*(-s.x+U.x)+x.x*(s.y-U.y)+s.x*U.y),W=_<0?-1:1,c=(x.y*U.x-x.x*U.y+(U.y-x.y)*u.x+(x.x-U.x)*u.y)*W,I=(x.x*s.y-x.y*s.x+(x.y-s.y)*u.x+(s.x-x.x)*u.y)*W;return c>0&&I>0&&c+I<2*_*W}static Distance(u,x){return Math.sqrt(k.DistanceSquared(u,x))}static DistanceSquared(u,x){const s=u.x-x.x,U=u.y-x.y;return s*s+U*U}static Center(u,x){return k.CenterToRef(u,x,new k)}static CenterToRef(u,x,s){return s.copyFromFloats((u.x+x.x)/2,(u.y+x.y)/2)}static DistanceOfPointFromSegment(u,x,s){const U=k.DistanceSquared(x,s);if(0===U)return k.Distance(u,x);const _=s.subtract(x),W=Math.max(0,Math.min(1,k.Dot(u.subtract(x),_)/U)),c=x.add(_.multiplyByFloats(W,W));return k.Distance(u,c)}}k._ZeroReadOnly=k.Zero(),Object.defineProperties(k.prototype,{dimension:{value:[2]},rank:{value:1}});class i{get x(){return this._x}set x(u){this._x=u,this._isDirty=!0}get y(){return this._y}set y(u){this._y=u,this._isDirty=!0}get z(){return this._z}set z(u){this._z=u,this._isDirty=!0}constructor(u=0,x=0,s=0){this._isDirty=!0,this._x=u,this._y=x,this._z=s}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"Vector3"}getHashCode(){let u=J(this._x);return u=397*u^J(this._y),u=397*u^J(this._z),u}asArray(){return[this._x,this._y,this._z]}toArray(u,x=0){return u[x]=this._x,u[x+1]=this._y,u[x+2]=this._z,this}fromArray(u,x=0){return i.FromArrayToRef(u,x,this),this}toQuaternion(){return j.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(u){return this._x+=u._x,this._y+=u._y,this._z+=u._z,this._isDirty=!0,this}addInPlaceFromFloats(u,x,s){return this._x+=u,this._y+=x,this._z+=s,this._isDirty=!0,this}add(u){return new i(this._x+u._x,this._y+u._y,this._z+u._z)}addToRef(u,x){return x._x=this._x+u._x,x._y=this._y+u._y,x._z=this._z+u._z,x._isDirty=!0,x}subtractInPlace(u){return this._x-=u._x,this._y-=u._y,this._z-=u._z,this._isDirty=!0,this}subtract(u){return new i(this._x-u._x,this._y-u._y,this._z-u._z)}subtractToRef(u,x){return this.subtractFromFloatsToRef(u._x,u._y,u._z,x)}subtractFromFloats(u,x,s){return new i(this._x-u,this._y-x,this._z-s)}subtractFromFloatsToRef(u,x,s,U){return U._x=this._x-u,U._y=this._y-x,U._z=this._z-s,U._isDirty=!0,U}negate(){return new i(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(u){return u._x=-1*this._x,u._y=-1*this._y,u._z=-1*this._z,u._isDirty=!0,u}scaleInPlace(u){return this._x*=u,this._y*=u,this._z*=u,this._isDirty=!0,this}scale(u){return new i(this._x*u,this._y*u,this._z*u)}scaleToRef(u,x){return x._x=this._x*u,x._y=this._y*u,x._z=this._z*u,x._isDirty=!0,x}getNormalToRef(u){const x=this.length();let s=Math.acos(this.y/x);const U=Math.atan2(this.z,this.x);s>Math.PI/2?s-=Math.PI/2:s+=Math.PI/2;const _=x*Math.sin(s)*Math.cos(U),W=x*Math.cos(s),c=x*Math.sin(s)*Math.sin(U);return u.set(_,W,c),u}applyRotationQuaternionToRef(u,x){const s=this._x,U=this._y,_=this._z,W=u._x,c=u._y,I=u._z,L=u._w,J=2*(c*_-I*U),k=2*(I*s-W*_),i=2*(W*U-c*s);return x._x=s+L*J+c*i-I*k,x._y=U+L*k+I*J-W*i,x._z=_+L*i+W*k-c*J,x._isDirty=!0,x}applyRotationQuaternionInPlace(u){return this.applyRotationQuaternionToRef(u,this)}applyRotationQuaternion(u){return this.applyRotationQuaternionToRef(u,new i)}scaleAndAddToRef(u,x){return x._x+=this._x*u,x._y+=this._y*u,x._z+=this._z*u,x._isDirty=!0,x}projectOnPlane(u,x){return this.projectOnPlaneToRef(u,x,new i)}projectOnPlaneToRef(u,x,s){const U=u.normal,_=u.d,W=D.Vector3[0];this.subtractToRef(x,W),W.normalize();const c=i.Dot(W,U);if(Math.abs(c)<1e-10)s.setAll(1/0);else{const u=-(i.Dot(x,U)+_)/c,I=W.scaleInPlace(u);x.addToRef(I,s)}return s}equals(u){return u&&this._x===u._x&&this._y===u._y&&this._z===u._z}equalsWithEpsilon(u,x=U.bH){return u&&L.Mj(this._x,u._x,x)&&L.Mj(this._y,u._y,x)&&L.Mj(this._z,u._z,x)}equalsToFloats(u,x,s){return this._x===u&&this._y===x&&this._z===s}multiplyInPlace(u){return this._x*=u._x,this._y*=u._y,this._z*=u._z,this._isDirty=!0,this}multiply(u){return this.multiplyByFloats(u._x,u._y,u._z)}multiplyToRef(u,x){return x._x=this._x*u._x,x._y=this._y*u._y,x._z=this._z*u._z,x._isDirty=!0,x}multiplyByFloats(u,x,s){return new i(this._x*u,this._y*x,this._z*s)}divide(u){return new i(this._x/u._x,this._y/u._y,this._z/u._z)}divideToRef(u,x){return x._x=this._x/u._x,x._y=this._y/u._y,x._z=this._z/u._z,x._isDirty=!0,x}divideInPlace(u){return this._x=this._x/u._x,this._y=this._y/u._y,this._z=this._z/u._z,this._isDirty=!0,this}minimizeInPlace(u){return this.minimizeInPlaceFromFloats(u._x,u._y,u._z)}maximizeInPlace(u){return this.maximizeInPlaceFromFloats(u._x,u._y,u._z)}minimizeInPlaceFromFloats(u,x,s){return u<this._x&&(this.x=u),x<this._y&&(this.y=x),s<this._z&&(this.z=s),this}maximizeInPlaceFromFloats(u,x,s){return u>this._x&&(this.x=u),x>this._y&&(this.y=x),s>this._z&&(this.z=s),this}isNonUniformWithinEpsilon(u){const x=Math.abs(this._x),s=Math.abs(this._y);if(!L.Mj(x,s,u))return!0;const U=Math.abs(this._z);return!L.Mj(x,U,u)||!L.Mj(s,U,u)}get isNonUniform(){const u=Math.abs(this._x);return u!==Math.abs(this._y)||u!==Math.abs(this._z)}floorToRef(u){return u._x=Math.floor(this._x),u._y=Math.floor(this._y),u._z=Math.floor(this._z),u._isDirty=!0,u}floor(){return new i(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(u){return u._x=this.x-Math.floor(this._x),u._y=this.y-Math.floor(this._y),u._z=this.z-Math.floor(this._z),u._isDirty=!0,u}fract(){return new i(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z==0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(u){if("xyz"===(u=u.toLowerCase()))return this;const x=D.Vector3[0].copyFrom(this);return this.x=x[u[0]],this.y=x[u[1]],this.z=x[u[2]],this}rotateByQuaternionToRef(u,x){return u.toRotationMatrix(D.Matrix[0]),i.TransformCoordinatesToRef(this,D.Matrix[0],x),x}rotateByQuaternionAroundPointToRef(u,x,s){return this.subtractToRef(x,D.Vector3[0]),D.Vector3[0].rotateByQuaternionToRef(u,D.Vector3[0]),x.addToRef(D.Vector3[0],s),s}cross(u){return i.CrossToRef(this,u,new i)}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){return this.normalizeToRef(new i)}normalizeToRef(u){const x=this.length();return 0===x||1===x?(u._x=this._x,u._y=this._y,u._z=this._z,u._isDirty=!0,u):this.scaleToRef(1/x,u)}clone(){return new i(this._x,this._y,this._z)}copyFrom(u){return this.copyFromFloats(u._x,u._y,u._z)}copyFromFloats(u,x,s){return this._x=u,this._y=x,this._z=s,this._isDirty=!0,this}set(u,x,s){return this.copyFromFloats(u,x,s)}setAll(u){return this._x=this._y=this._z=u,this._isDirty=!0,this}static GetClipFactor(u,x,s,U){const _=i.Dot(u,s);return(_-U)/(_-i.Dot(x,s))}static GetAngleBetweenVectors(u,x,s){const U=u.normalizeToRef(D.Vector3[1]),_=x.normalizeToRef(D.Vector3[2]);let W=i.Dot(U,_);W=L.OQ(W,-1,1);const c=Math.acos(W),I=D.Vector3[3];return i.CrossToRef(U,_,I),i.Dot(I,s)>0?isNaN(c)?0:c:isNaN(c)?-Math.PI:-Math.acos(W)}static GetAngleBetweenVectorsOnPlane(u,x,s){D.Vector3[0].copyFrom(u);const U=D.Vector3[0];D.Vector3[1].copyFrom(x);const _=D.Vector3[1];D.Vector3[2].copyFrom(s);const W=D.Vector3[2],c=D.Vector3[3],I=D.Vector3[4];U.normalize(),_.normalize(),W.normalize(),i.CrossToRef(W,U,c),i.CrossToRef(c,W,I);const J=Math.atan2(i.Dot(_,c),i.Dot(_,I));return L.ed(J)}static PitchYawRollToMoveBetweenPointsToRef(u,x,s){const U=$.Vector3[0];return x.subtractToRef(u,U),s._y=Math.atan2(U.x,U.z)||0,s._x=Math.atan2(Math.sqrt(U.x**2+U.z**2),U.y)||0,s._z=0,s._isDirty=!0,s}static PitchYawRollToMoveBetweenPoints(u,x){const s=i.Zero();return i.PitchYawRollToMoveBetweenPointsToRef(u,x,s)}static SlerpToRef(u,x,s,_){s=L.OQ(s,0,1);const W=D.Vector3[0],c=D.Vector3[1];W.copyFrom(u);const I=W.length();W.normalizeFromLength(I),c.copyFrom(x);const J=c.length();c.normalizeFromLength(J);const k=i.Dot(W,c);let d,j;if(k<1-U.bH){const u=Math.acos(k),x=1/Math.sin(u);d=Math.sin((1-s)*u)*x,j=Math.sin(s*u)*x}else d=1-s,j=s;return W.scaleInPlace(d),c.scaleInPlace(j),_.copyFrom(W).addInPlace(c),_.scaleInPlace(L.cP(I,J,s)),_}static SmoothToRef(u,x,s,U,_){return i.SlerpToRef(u,x,0===U?1:s/U,_),_}static FromArray(u,x=0){return new i(u[x],u[x+1],u[x+2])}static FromFloatArray(u,x){return i.FromArray(u,x)}static FromArrayToRef(u,x,s){return s._x=u[x],s._y=u[x+1],s._z=u[x+2],s._isDirty=!0,s}static FromFloatArrayToRef(u,x,s){return i.FromArrayToRef(u,x,s)}static FromFloatsToRef(u,x,s,U){return U.copyFromFloats(u,x,s),U}static Zero(){return new i(0,0,0)}static One(){return new i(1,1,1)}static Up(){return new i(0,1,0)}static get UpReadOnly(){return i._UpReadOnly}static get DownReadOnly(){return i._DownReadOnly}static get RightReadOnly(){return i._RightReadOnly}static get LeftReadOnly(){return i._LeftReadOnly}static get LeftHandedForwardReadOnly(){return i._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return i._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return i._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return i._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return i._ZeroReadOnly}static get OneReadOnly(){return i._OneReadOnly}static Down(){return new i(0,-1,0)}static Forward(u=!1){return new i(0,0,u?-1:1)}static Backward(u=!1){return new i(0,0,u?1:-1)}static Right(){return new i(1,0,0)}static Left(){return new i(-1,0,0)}static Random(u=0,x=1){return new i(L.VD(u,x),L.VD(u,x),L.VD(u,x))}static RandomToRef(u=0,x=1,s){return s.copyFromFloats(L.VD(u,x),L.VD(u,x),L.VD(u,x))}static TransformCoordinates(u,x){const s=i.Zero();return i.TransformCoordinatesToRef(u,x,s),s}static TransformCoordinatesToRef(u,x,s){return i.TransformCoordinatesFromFloatsToRef(u._x,u._y,u._z,x,s),s}static TransformCoordinatesFromFloatsToRef(u,x,s,U,_){const W=U.m,c=u*W[0]+x*W[4]+s*W[8]+W[12],I=u*W[1]+x*W[5]+s*W[9]+W[13],L=u*W[2]+x*W[6]+s*W[10]+W[14],J=1/(u*W[3]+x*W[7]+s*W[11]+W[15]);return _._x=c*J,_._y=I*J,_._z=L*J,_._isDirty=!0,_}static TransformNormal(u,x){const s=i.Zero();return i.TransformNormalToRef(u,x,s),s}static TransformNormalToRef(u,x,s){return this.TransformNormalFromFloatsToRef(u._x,u._y,u._z,x,s),s}static TransformNormalFromFloatsToRef(u,x,s,U,_){const W=U.m;return _._x=u*W[0]+x*W[4]+s*W[8],_._y=u*W[1]+x*W[5]+s*W[9],_._z=u*W[2]+x*W[6]+s*W[10],_._isDirty=!0,_}static CatmullRom(u,x,s,U,_){const W=_*_,c=_*W,I=.5*(2*x._x+(-u._x+s._x)*_+(2*u._x-5*x._x+4*s._x-U._x)*W+(-u._x+3*x._x-3*s._x+U._x)*c),L=.5*(2*x._y+(-u._y+s._y)*_+(2*u._y-5*x._y+4*s._y-U._y)*W+(-u._y+3*x._y-3*s._y+U._y)*c),J=.5*(2*x._z+(-u._z+s._z)*_+(2*u._z-5*x._z+4*s._z-U._z)*W+(-u._z+3*x._z-3*s._z+U._z)*c);return new i(I,L,J)}static Clamp(u,x,s){const U=new i;return i.ClampToRef(u,x,s,U),U}static ClampToRef(u,x,s,U){let _=u._x;_=_>s._x?s._x:_,_=_<x._x?x._x:_;let W=u._y;W=W>s._y?s._y:W,W=W<x._y?x._y:W;let c=u._z;return c=c>s._z?s._z:c,c=c<x._z?x._z:c,U.copyFromFloats(_,W,c),U}static CheckExtends(u,x,s){x.minimizeInPlace(u),s.maximizeInPlace(u)}static Hermite(u,x,s,U,_){const W=_*_,c=_*W,I=2*c-3*W+1,L=-2*c+3*W,J=c-2*W+_,k=c-W,d=u._x*I+s._x*L+x._x*J+U._x*k,j=u._y*I+s._y*L+x._y*J+U._y*k,r=u._z*I+s._z*L+x._z*J+U._z*k;return new i(d,j,r)}static Hermite1stDerivative(u,x,s,U,_){const W=new i;return this.Hermite1stDerivativeToRef(u,x,s,U,_,W),W}static Hermite1stDerivativeToRef(u,x,s,U,_,W){const c=_*_;return W._x=6*(c-_)*u._x+(3*c-4*_+1)*x._x+6*(-c+_)*s._x+(3*c-2*_)*U._x,W._y=6*(c-_)*u._y+(3*c-4*_+1)*x._y+6*(-c+_)*s._y+(3*c-2*_)*U._y,W._z=6*(c-_)*u._z+(3*c-4*_+1)*x._z+6*(-c+_)*s._z+(3*c-2*_)*U._z,W._isDirty=!0,W}static Lerp(u,x,s){const U=new i(0,0,0);return i.LerpToRef(u,x,s,U),U}static LerpToRef(u,x,s,U){return U._x=u._x+(x._x-u._x)*s,U._y=u._y+(x._y-u._y)*s,U._z=u._z+(x._z-u._z)*s,U._isDirty=!0,U}static Dot(u,x){return u._x*x._x+u._y*x._y+u._z*x._z}dot(u){return this._x*u._x+this._y*u._y+this._z*u._z}static Cross(u,x){const s=new i;return i.CrossToRef(u,x,s),s}static CrossToRef(u,x,s){const U=u._y*x._z-u._z*x._y,_=u._z*x._x-u._x*x._z,W=u._x*x._y-u._y*x._x;return s.copyFromFloats(U,_,W),s}static Normalize(u){const x=i.Zero();return i.NormalizeToRef(u,x),x}static NormalizeToRef(u,x){return u.normalizeToRef(x),x}static Project(u,x,s,U){const _=new i;return i.ProjectToRef(u,x,s,U,_),_}static ProjectToRef(u,x,s,U,_){var W;const c=U.width,L=U.height,J=U.x,k=U.y,d=D.Matrix[1],j=null===(W=I.q.LastCreatedEngine)||void 0===W?void 0:W.isNDCHalfZRange,$=j?1:.5,H=j?0:.5;r.FromValuesToRef(c/2,0,0,0,0,-L/2,0,0,0,0,$,0,J+c/2,L/2+k,H,1,d);const f=D.Matrix[0];return x.multiplyToRef(s,f),f.multiplyToRef(d,f),i.TransformCoordinatesToRef(u,f,_),_}static Reflect(u,x){return this.ReflectToRef(u,x,new i)}static ReflectToRef(u,x,s){const U=$.Vector3[0];return U.copyFrom(x).scaleInPlace(2*i.Dot(u,x)),s.copyFrom(u).subtractInPlace(U)}static _UnprojectFromInvertedMatrixToRef(u,x,s){i.TransformCoordinatesToRef(u,x,s);const U=x.m,_=u._x*U[3]+u._y*U[7]+u._z*U[11]+U[15];return L.Mj(_,1)&&s.scaleInPlace(1/_),s}static UnprojectFromTransform(u,x,s,U,_){return this.Unproject(u,x,s,U,_,r.IdentityReadOnly)}static Unproject(u,x,s,U,_,W){const c=new i;return i.UnprojectToRef(u,x,s,U,_,W,c),c}static UnprojectToRef(u,x,s,U,_,W,c){return i.UnprojectFloatsToRef(u._x,u._y,u._z,x,s,U,_,W,c),c}static UnprojectFloatsToRef(u,x,s,U,_,W,c,L,J){var k;const d=D.Matrix[0];W.multiplyToRef(c,d),d.multiplyToRef(L,d),d.invert();const j=D.Vector3[0];return j.x=u/U*2-1,j.y=-(x/_*2-1),(null===(k=I.q.LastCreatedEngine)||void 0===k?void 0:k.isNDCHalfZRange)?j.z=s:j.z=2*s-1,i._UnprojectFromInvertedMatrixToRef(j,d,J),J}static Minimize(u,x){const s=new i;return s.copyFrom(u),s.minimizeInPlace(x),s}static Maximize(u,x){const s=new i;return s.copyFrom(u),s.maximizeInPlace(x),s}static Distance(u,x){return Math.sqrt(i.DistanceSquared(u,x))}static DistanceSquared(u,x){const s=u._x-x._x,U=u._y-x._y,_=u._z-x._z;return s*s+U*U+_*_}static ProjectOnTriangleToRef(u,x,s,_,W){const c=D.Vector3[0],I=D.Vector3[1],J=D.Vector3[2],k=D.Vector3[3],d=D.Vector3[4];s.subtractToRef(x,c),_.subtractToRef(x,I),_.subtractToRef(s,J);const j=c.length(),r=I.length(),$=J.length();if(j<U.bH||r<U.bH||$<U.bH)return W.copyFrom(x),i.Distance(u,x);u.subtractToRef(x,d),i.CrossToRef(c,I,k);const H=k.length();if(H<U.bH)return W.copyFrom(x),i.Distance(u,x);k.normalizeFromLength(H);let f=d.length();if(f<U.bH)return W.copyFrom(x),0;d.normalizeFromLength(f);const O=i.Dot(k,d),t=D.Vector3[5],V=D.Vector3[6];t.copyFrom(k).scaleInPlace(-f*O),V.copyFrom(u).addInPlace(t);const N=D.Vector3[4],m=D.Vector3[5],b=D.Vector3[7],n=D.Vector3[8];N.copyFrom(c).scaleInPlace(1/j),n.copyFrom(I).scaleInPlace(1/r),N.addInPlace(n).scaleInPlace(-1),m.copyFrom(c).scaleInPlace(-1/j),n.copyFrom(J).scaleInPlace(1/$),m.addInPlace(n).scaleInPlace(-1),b.copyFrom(J).scaleInPlace(-1/$),n.copyFrom(I).scaleInPlace(-1/r),b.addInPlace(n).scaleInPlace(-1);const F=D.Vector3[9];let B;F.copyFrom(V).subtractInPlace(x),i.CrossToRef(N,F,n),B=i.Dot(n,k);const Z=B;F.copyFrom(V).subtractInPlace(s),i.CrossToRef(m,F,n),B=i.Dot(n,k);const v=B;F.copyFrom(V).subtractInPlace(_),i.CrossToRef(b,F,n),B=i.Dot(n,k);const y=B,e=D.Vector3[10];let T,Q;Z>0&&v<0?(e.copyFrom(c),T=x,Q=s):v>0&&y<0?(e.copyFrom(J),T=s,Q=_):(e.copyFrom(I).scaleInPlace(-1),T=_,Q=x);const E=D.Vector3[9],l=D.Vector3[4];if(T.subtractToRef(V,n),Q.subtractToRef(V,E),i.CrossToRef(n,E,l),!(i.Dot(l,k)<0))return W.copyFrom(V),Math.abs(f*O);const z=D.Vector3[5];i.CrossToRef(e,l,z),z.normalize();const S=D.Vector3[9];S.copyFrom(T).subtractInPlace(V);const R=S.length();if(R<U.bH)return W.copyFrom(T),i.Distance(u,T);S.normalizeFromLength(R);const X=i.Dot(z,S),p=D.Vector3[7];p.copyFrom(V).addInPlace(z.scaleInPlace(R*X)),n.copyFrom(p).subtractInPlace(T),f=e.length(),e.normalizeFromLength(f);let G=i.Dot(n,e)/Math.max(f,U.bH);return G=L.OQ(G,0,1),p.copyFrom(T).addInPlace(e.scaleInPlace(G*f)),W.copyFrom(p),i.Distance(u,p)}static Center(u,x){return i.CenterToRef(u,x,i.Zero())}static CenterToRef(u,x,s){return s.copyFromFloats((u._x+x._x)/2,(u._y+x._y)/2,(u._z+x._z)/2)}static RotationFromAxis(u,x,s){const U=new i;return i.RotationFromAxisToRef(u,x,s,U),U}static RotationFromAxisToRef(u,x,s,U){const _=D.Quaternion[0];return j.RotationQuaternionFromAxisToRef(u,x,s,_),_.toEulerAnglesToRef(U),U}}i._UpReadOnly=i.Up(),i._DownReadOnly=i.Down(),i._LeftHandedForwardReadOnly=i.Forward(!1),i._RightHandedForwardReadOnly=i.Forward(!0),i._LeftHandedBackwardReadOnly=i.Backward(!1),i._RightHandedBackwardReadOnly=i.Backward(!0),i._RightReadOnly=i.Right(),i._LeftReadOnly=i.Left(),i._ZeroReadOnly=i.Zero(),i._OneReadOnly=i.One(),Object.defineProperties(i.prototype,{dimension:{value:[3]},rank:{value:1}});class d{constructor(u=0,x=0,s=0,U=0){this.x=u,this.y=x,this.z=s,this.w=U}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let u=J(this.x);return u=397*u^J(this.y),u=397*u^J(this.z),u=397*u^J(this.w),u}asArray(){return[this.x,this.y,this.z,this.w]}toArray(u,x){return void 0===x&&(x=0),u[x]=this.x,u[x+1]=this.y,u[x+2]=this.z,u[x+3]=this.w,this}fromArray(u,x=0){return d.FromArrayToRef(u,x,this),this}addInPlace(u){return this.x+=u.x,this.y+=u.y,this.z+=u.z,this.w+=u.w,this}addInPlaceFromFloats(u,x,s,U){return this.x+=u,this.y+=x,this.z+=s,this.w+=U,this}add(u){return new d(this.x+u.x,this.y+u.y,this.z+u.z,this.w+u.w)}addToRef(u,x){return x.x=this.x+u.x,x.y=this.y+u.y,x.z=this.z+u.z,x.w=this.w+u.w,x}subtractInPlace(u){return this.x-=u.x,this.y-=u.y,this.z-=u.z,this.w-=u.w,this}subtract(u){return new d(this.x-u.x,this.y-u.y,this.z-u.z,this.w-u.w)}subtractToRef(u,x){return x.x=this.x-u.x,x.y=this.y-u.y,x.z=this.z-u.z,x.w=this.w-u.w,x}subtractFromFloats(u,x,s,U){return new d(this.x-u,this.y-x,this.z-s,this.w-U)}subtractFromFloatsToRef(u,x,s,U,_){return _.x=this.x-u,_.y=this.y-x,_.z=this.z-s,_.w=this.w-U,_}negate(){return new d(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(u){return u.x=-this.x,u.y=-this.y,u.z=-this.z,u.w=-this.w,u}scaleInPlace(u){return this.x*=u,this.y*=u,this.z*=u,this.w*=u,this}scale(u){return new d(this.x*u,this.y*u,this.z*u,this.w*u)}scaleToRef(u,x){return x.x=this.x*u,x.y=this.y*u,x.z=this.z*u,x.w=this.w*u,x}scaleAndAddToRef(u,x){return x.x+=this.x*u,x.y+=this.y*u,x.z+=this.z*u,x.w+=this.w*u,x}equals(u){return u&&this.x===u.x&&this.y===u.y&&this.z===u.z&&this.w===u.w}equalsWithEpsilon(u,x=U.bH){return u&&L.Mj(this.x,u.x,x)&&L.Mj(this.y,u.y,x)&&L.Mj(this.z,u.z,x)&&L.Mj(this.w,u.w,x)}equalsToFloats(u,x,s,U){return this.x===u&&this.y===x&&this.z===s&&this.w===U}multiplyInPlace(u){return this.x*=u.x,this.y*=u.y,this.z*=u.z,this.w*=u.w,this}multiply(u){return new d(this.x*u.x,this.y*u.y,this.z*u.z,this.w*u.w)}multiplyToRef(u,x){return x.x=this.x*u.x,x.y=this.y*u.y,x.z=this.z*u.z,x.w=this.w*u.w,x}multiplyByFloats(u,x,s,U){return new d(this.x*u,this.y*x,this.z*s,this.w*U)}divide(u){return new d(this.x/u.x,this.y/u.y,this.z/u.z,this.w/u.w)}divideToRef(u,x){return x.x=this.x/u.x,x.y=this.y/u.y,x.z=this.z/u.z,x.w=this.w/u.w,x}divideInPlace(u){return this.divideToRef(u,this)}minimizeInPlace(u){return u.x<this.x&&(this.x=u.x),u.y<this.y&&(this.y=u.y),u.z<this.z&&(this.z=u.z),u.w<this.w&&(this.w=u.w),this}maximizeInPlace(u){return u.x>this.x&&(this.x=u.x),u.y>this.y&&(this.y=u.y),u.z>this.z&&(this.z=u.z),u.w>this.w&&(this.w=u.w),this}minimizeInPlaceFromFloats(u,x,s,U){return this.x=Math.min(u,this.x),this.y=Math.min(x,this.y),this.z=Math.min(s,this.z),this.w=Math.min(U,this.w),this}maximizeInPlaceFromFloats(u,x,s,U){return this.x=Math.max(u,this.x),this.y=Math.max(x,this.y),this.z=Math.max(s,this.z),this.w=Math.max(U,this.w),this}floorToRef(u){return u.x=Math.floor(this.x),u.y=Math.floor(this.y),u.z=Math.floor(this.z),u.w=Math.floor(this.w),u}floor(){return new d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(u){return u.x=this.x-Math.floor(this.x),u.y=this.y-Math.floor(this.y),u.z=this.z-Math.floor(this.z),u.w=this.w-Math.floor(this.w),u}fract(){return new d(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){return this.normalizeToRef(new d)}normalizeToRef(u){const x=this.length();return 0===x||1===x?(u.x=this.x,u.y=this.y,u.z=this.z,u.w=this.w,u):this.scaleToRef(1/x,u)}toVector3(){return new i(this.x,this.y,this.z)}clone(){return new d(this.x,this.y,this.z,this.w)}copyFrom(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this}copyFromFloats(u,x,s,U){return this.x=u,this.y=x,this.z=s,this.w=U,this}set(u,x,s,U){return this.copyFromFloats(u,x,s,U)}setAll(u){return this.x=this.y=this.z=this.w=u,this}dot(u){return this.x*u.x+this.y*u.y+this.z*u.z+this.w*u.w}static FromArray(u,x){return x||(x=0),new d(u[x],u[x+1],u[x+2],u[x+3])}static FromArrayToRef(u,x,s){return s.x=u[x],s.y=u[x+1],s.z=u[x+2],s.w=u[x+3],s}static FromFloatArrayToRef(u,x,s){return d.FromArrayToRef(u,x,s),s}static FromFloatsToRef(u,x,s,U,_){return _.x=u,_.y=x,_.z=s,_.w=U,_}static Zero(){return new d(0,0,0,0)}static One(){return new d(1,1,1,1)}static Random(u=0,x=1){return new d(L.VD(u,x),L.VD(u,x),L.VD(u,x),L.VD(u,x))}static RandomToRef(u=0,x=1,s){return s.x=L.VD(u,x),s.y=L.VD(u,x),s.z=L.VD(u,x),s.w=L.VD(u,x),s}static Clamp(u,x,s){return d.ClampToRef(u,x,s,new d)}static ClampToRef(u,x,s,U){return U.x=L.OQ(u.x,x.x,s.x),U.y=L.OQ(u.y,x.y,s.y),U.z=L.OQ(u.z,x.z,s.z),U.w=L.OQ(u.w,x.w,s.w),U}static CheckExtends(u,x,s){x.minimizeInPlace(u),s.maximizeInPlace(u)}static get ZeroReadOnly(){return d._ZeroReadOnly}static Normalize(u){return d.NormalizeToRef(u,new d)}static NormalizeToRef(u,x){return u.normalizeToRef(x),x}static Minimize(u,x){const s=new d;return s.copyFrom(u),s.minimizeInPlace(x),s}static Maximize(u,x){const s=new d;return s.copyFrom(u),s.maximizeInPlace(x),s}static Distance(u,x){return Math.sqrt(d.DistanceSquared(u,x))}static DistanceSquared(u,x){const s=u.x-x.x,U=u.y-x.y,_=u.z-x.z,W=u.w-x.w;return s*s+U*U+_*_+W*W}static Center(u,x){return d.CenterToRef(u,x,new d)}static CenterToRef(u,x,s){return s.x=(u.x+x.x)/2,s.y=(u.y+x.y)/2,s.z=(u.z+x.z)/2,s.w=(u.w+x.w)/2,s}static TransformCoordinates(u,x){return d.TransformCoordinatesToRef(u,x,new d)}static TransformCoordinatesToRef(u,x,s){return d.TransformCoordinatesFromFloatsToRef(u._x,u._y,u._z,x,s),s}static TransformCoordinatesFromFloatsToRef(u,x,s,U,_){const W=U.m,c=u*W[0]+x*W[4]+s*W[8]+W[12],I=u*W[1]+x*W[5]+s*W[9]+W[13],L=u*W[2]+x*W[6]+s*W[10]+W[14],J=u*W[3]+x*W[7]+s*W[11]+W[15];return _.x=c,_.y=I,_.z=L,_.w=J,_}static TransformNormal(u,x){return d.TransformNormalToRef(u,x,new d)}static TransformNormalToRef(u,x,s){const U=x.m,_=u.x*U[0]+u.y*U[4]+u.z*U[8],W=u.x*U[1]+u.y*U[5]+u.z*U[9],c=u.x*U[2]+u.y*U[6]+u.z*U[10];return s.x=_,s.y=W,s.z=c,s.w=u.w,s}static TransformNormalFromFloatsToRef(u,x,s,U,_,W){const c=_.m;return W.x=u*c[0]+x*c[4]+s*c[8],W.y=u*c[1]+x*c[5]+s*c[9],W.z=u*c[2]+x*c[6]+s*c[10],W.w=U,W}static FromVector3(u,x=0){return new d(u._x,u._y,u._z,x)}static Dot(u,x){return u.x*x.x+u.y*x.y+u.z*x.z+u.w*x.w}}d._ZeroReadOnly=d.Zero(),Object.defineProperties(d.prototype,{dimension:{value:[4]},rank:{value:1}});class j{get x(){return this._x}set x(u){this._x=u,this._isDirty=!0}get y(){return this._y}set y(u){this._y=u,this._isDirty=!0}get z(){return this._z}set z(u){this._z=u,this._isDirty=!0}get w(){return this._w}set w(u){this._w=u,this._isDirty=!0}constructor(u=0,x=0,s=0,U=1){this._isDirty=!0,this._x=u,this._y=x,this._z=s,this._w=U}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let u=J(this._x);return u=397*u^J(this._y),u=397*u^J(this._z),u=397*u^J(this._w),u}asArray(){return[this._x,this._y,this._z,this._w]}toArray(u,x=0){return u[x]=this._x,u[x+1]=this._y,u[x+2]=this._z,u[x+3]=this._w,this}fromArray(u,x=0){return j.FromArrayToRef(u,x,this)}equals(u){return u&&this._x===u._x&&this._y===u._y&&this._z===u._z&&this._w===u._w}equalsWithEpsilon(u,x=U.bH){return u&&L.Mj(this._x,u._x,x)&&L.Mj(this._y,u._y,x)&&L.Mj(this._z,u._z,x)&&L.Mj(this._w,u._w,x)}clone(){return new j(this._x,this._y,this._z,this._w)}copyFrom(u){return this._x=u._x,this._y=u._y,this._z=u._z,this._w=u._w,this._isDirty=!0,this}copyFromFloats(u,x,s,U){return this._x=u,this._y=x,this._z=s,this._w=U,this._isDirty=!0,this}set(u,x,s,U){return this.copyFromFloats(u,x,s,U)}setAll(u){return this.copyFromFloats(u,u,u,u)}add(u){return new j(this._x+u._x,this._y+u._y,this._z+u._z,this._w+u._w)}addInPlace(u){return this._x+=u._x,this._y+=u._y,this._z+=u._z,this._w+=u._w,this._isDirty=!0,this}addToRef(u,x){return x._x=this._x+u._x,x._y=this._y+u._y,x._z=this._z+u._z,x._w=this._w+u._w,x._isDirty=!0,x}addInPlaceFromFloats(u,x,s,U){return this._x+=u,this._y+=x,this._z+=s,this._w+=U,this._isDirty=!0,this}subtractToRef(u,x){return x._x=this._x-u._x,x._y=this._y-u._y,x._z=this._z-u._z,x._w=this._w-u._w,x._isDirty=!0,x}subtractFromFloats(u,x,s,U){return this.subtractFromFloatsToRef(u,x,s,U,new j)}subtractFromFloatsToRef(u,x,s,U,_){return _._x=this._x-u,_._y=this._y-x,_._z=this._z-s,_._w=this._w-U,_._isDirty=!0,_}subtract(u){return new j(this._x-u._x,this._y-u._y,this._z-u._z,this._w-u._w)}subtractInPlace(u){return this._x-=u._x,this._y-=u._y,this._z-=u._z,this._w-=u._w,this._isDirty=!0,this}scale(u){return new j(this._x*u,this._y*u,this._z*u,this._w*u)}scaleToRef(u,x){return x._x=this._x*u,x._y=this._y*u,x._z=this._z*u,x._w=this._w*u,x._isDirty=!0,x}scaleInPlace(u){return this._x*=u,this._y*=u,this._z*=u,this._w*=u,this._isDirty=!0,this}scaleAndAddToRef(u,x){return x._x+=this._x*u,x._y+=this._y*u,x._z+=this._z*u,x._w+=this._w*u,x._isDirty=!0,x}multiply(u){const x=new j(0,0,0,1);return this.multiplyToRef(u,x),x}multiplyToRef(u,x){const s=this._x*u._w+this._y*u._z-this._z*u._y+this._w*u._x,U=-this._x*u._z+this._y*u._w+this._z*u._x+this._w*u._y,_=this._x*u._y-this._y*u._x+this._z*u._w+this._w*u._z,W=-this._x*u._x-this._y*u._y-this._z*u._z+this._w*u._w;return x.copyFromFloats(s,U,_,W),x}multiplyInPlace(u){return this.multiplyToRef(u,this)}multiplyByFloats(u,x,s,U){return this._x*=u,this._y*=x,this._z*=s,this._w*=U,this._isDirty=!0,this}divide(u){throw new ReferenceError("Can not divide a quaternion")}divideToRef(u,x){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(u){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new j)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(u){return u._x=-this._x,u._y=-this._y,u._z=-this._z,u._w=-this._w,u._isDirty=!0,u}equalsToFloats(u,x,s,U){return this._x===u&&this._y===x&&this._z===s&&this._w===U}floorToRef(u){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(u){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(u){return u.copyFromFloats(-this._x,-this._y,-this._z,this._w),u}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new j(-this._x,-this._y,-this._z,this._w)}invert(){const u=this.conjugate(),x=this.lengthSquared();return 0==x||1==x||u.scaleInPlace(1/x),u}invertInPlace(){this.conjugateInPlace();const u=this.lengthSquared();return 0==u||1==u||this.scaleInPlace(1/u),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(u){return 0===u||1===u?this:this.scaleInPlace(1/u)}normalizeToNew(){const u=new j(0,0,0,1);return this.normalizeToRef(u),u}normalizeToRef(u){const x=this.length();return 0===x||1===x?u.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/x,u)}toEulerAngles(){const u=i.Zero();return this.toEulerAnglesToRef(u),u}toEulerAnglesToRef(u){const x=this._z,s=this._x,U=this._y,_=this._w,W=U*x-s*_,c=.4999999;if(W<-c)u._y=2*Math.atan2(U,_),u._x=Math.PI/2,u._z=0,u._isDirty=!0;else if(W>c)u._y=2*Math.atan2(U,_),u._x=-Math.PI/2,u._z=0,u._isDirty=!0;else{const c=_*_,I=x*x,L=s*s,J=U*U;u._z=Math.atan2(2*(s*U+x*_),-I-L+J+c),u._x=Math.asin(-2*W),u._y=Math.atan2(2*(x*s+U*_),I-L-J+c),u._isDirty=!0}return u}toAlphaBetaGammaToRef(u){const x=this._z,s=this._x,U=this._y,_=this._w,W=Math.sqrt(s*s+U*U),c=Math.sqrt(x*x+_*_),I=2*Math.atan2(W,c),L=2*Math.atan2(x,_),J=2*Math.atan2(U,s),k=(L+J)/2,i=(L-J)/2;return u.set(i,I,k),u}toRotationMatrix(u){return r.FromQuaternionToRef(this,u),u}fromRotationMatrix(u){return j.FromRotationMatrixToRef(u,this),this}dot(u){return this._x*u._x+this._y*u._y+this._z*u._z+this._w*u._w}static FromRotationMatrix(u){const x=new j;return j.FromRotationMatrixToRef(u,x),x}static FromRotationMatrixToRef(u,x){const s=u.m,U=s[0],_=s[4],W=s[8],c=s[1],I=s[5],L=s[9],J=s[2],k=s[6],i=s[10],d=U+I+i;let j;return d>0?(j=.5/Math.sqrt(d+1),x._w=.25/j,x._x=(k-L)*j,x._y=(W-J)*j,x._z=(c-_)*j,x._isDirty=!0):U>I&&U>i?(j=2*Math.sqrt(1+U-I-i),x._w=(k-L)/j,x._x=.25*j,x._y=(_+c)/j,x._z=(W+J)/j,x._isDirty=!0):I>i?(j=2*Math.sqrt(1+I-U-i),x._w=(W-J)/j,x._x=(_+c)/j,x._y=.25*j,x._z=(L+k)/j,x._isDirty=!0):(j=2*Math.sqrt(1+i-U-I),x._w=(c-_)/j,x._x=(W+J)/j,x._y=(L+k)/j,x._z=.25*j,x._isDirty=!0),x}static Dot(u,x){return u._x*x._x+u._y*x._y+u._z*x._z+u._w*x._w}static AreClose(u,x,s=.1){const U=j.Dot(u,x);return 1-U*U<=s}static SmoothToRef(u,x,s,U,_){let W=0===U?1:s/U;return W=L.OQ(W,0,1),j.SlerpToRef(u,x,W,_),_}static Zero(){return new j(0,0,0,0)}static Inverse(u){return new j(-u._x,-u._y,-u._z,u._w)}static InverseToRef(u,x){return x.set(-u._x,-u._y,-u._z,u._w),x}static Identity(){return new j(0,0,0,1)}static IsIdentity(u){return u&&0===u._x&&0===u._y&&0===u._z&&1===u._w}static RotationAxis(u,x){return j.RotationAxisToRef(u,x,new j)}static RotationAxisToRef(u,x,s){s._w=Math.cos(x/2);const U=Math.sin(x/2)/u.length();return s._x=u._x*U,s._y=u._y*U,s._z=u._z*U,s._isDirty=!0,s}static FromArray(u,x){return x||(x=0),new j(u[x],u[x+1],u[x+2],u[x+3])}static FromArrayToRef(u,x,s){return s._x=u[x],s._y=u[x+1],s._z=u[x+2],s._w=u[x+3],s._isDirty=!0,s}static FromFloatsToRef(u,x,s,U,_){return _.copyFromFloats(u,x,s,U),_}static FromEulerAngles(u,x,s){const U=new j;return j.RotationYawPitchRollToRef(x,u,s,U),U}static FromEulerAnglesToRef(u,x,s,U){return j.RotationYawPitchRollToRef(x,u,s,U),U}static FromEulerVector(u){const x=new j;return j.RotationYawPitchRollToRef(u._y,u._x,u._z,x),x}static FromEulerVectorToRef(u,x){return j.RotationYawPitchRollToRef(u._y,u._x,u._z,x),x}static FromUnitVectorsToRef(u,x,s,_=U.bH){const W=i.Dot(u,x)+1;return W<_?Math.abs(u.x)>Math.abs(u.z)?s.set(-u.y,u.x,0,0):s.set(0,-u.z,u.y,0):(i.CrossToRef(u,x,$.Vector3[0]),s.set($.Vector3[0].x,$.Vector3[0].y,$.Vector3[0].z,W)),s.normalize()}static RotationYawPitchRoll(u,x,s){const U=new j;return j.RotationYawPitchRollToRef(u,x,s,U),U}static RotationYawPitchRollToRef(u,x,s,U){const _=.5*s,W=.5*x,c=.5*u,I=Math.sin(_),L=Math.cos(_),J=Math.sin(W),k=Math.cos(W),i=Math.sin(c),d=Math.cos(c);return U._x=d*J*L+i*k*I,U._y=i*k*L-d*J*I,U._z=d*k*I-i*J*L,U._w=d*k*L+i*J*I,U._isDirty=!0,U}static RotationAlphaBetaGamma(u,x,s){const U=new j;return j.RotationAlphaBetaGammaToRef(u,x,s,U),U}static RotationAlphaBetaGammaToRef(u,x,s,U){const _=.5*(s+u),W=.5*(s-u),c=.5*x;return U._x=Math.cos(W)*Math.sin(c),U._y=Math.sin(W)*Math.sin(c),U._z=Math.sin(_)*Math.cos(c),U._w=Math.cos(_)*Math.cos(c),U._isDirty=!0,U}static RotationQuaternionFromAxis(u,x,s){const U=new j(0,0,0,0);return j.RotationQuaternionFromAxisToRef(u,x,s,U),U}static RotationQuaternionFromAxisToRef(u,x,s,U){const _=D.Matrix[0];return u=u.normalizeToRef(D.Vector3[0]),x=x.normalizeToRef(D.Vector3[1]),s=s.normalizeToRef(D.Vector3[2]),r.FromXYZAxesToRef(u,x,s,_),j.FromRotationMatrixToRef(_,U),U}static FromLookDirectionLH(u,x){const s=new j;return j.FromLookDirectionLHToRef(u,x,s),s}static FromLookDirectionLHToRef(u,x,s){const U=D.Matrix[0];return r.LookDirectionLHToRef(u,x,U),j.FromRotationMatrixToRef(U,s),s}static FromLookDirectionRH(u,x){const s=new j;return j.FromLookDirectionRHToRef(u,x,s),s}static FromLookDirectionRHToRef(u,x,s){const U=D.Matrix[0];return r.LookDirectionRHToRef(u,x,U),j.FromRotationMatrixToRef(U,s)}static Slerp(u,x,s){const U=j.Identity();return j.SlerpToRef(u,x,s,U),U}static SlerpToRef(u,x,s,U){let _,W,c=u._x*x._x+u._y*x._y+u._z*x._z+u._w*x._w,I=!1;if(c<0&&(I=!0,c=-c),c>.999999)W=1-s,_=I?-s:s;else{const u=Math.acos(c),x=1/Math.sin(u);W=Math.sin((1-s)*u)*x,_=I?-Math.sin(s*u)*x:Math.sin(s*u)*x}return U._x=W*u._x+_*x._x,U._y=W*u._y+_*x._y,U._z=W*u._z+_*x._z,U._w=W*u._w+_*x._w,U._isDirty=!0,U}static Hermite(u,x,s,U,_){const W=_*_,c=_*W,I=2*c-3*W+1,L=-2*c+3*W,J=c-2*W+_,k=c-W,i=u._x*I+s._x*L+x._x*J+U._x*k,d=u._y*I+s._y*L+x._y*J+U._y*k,r=u._z*I+s._z*L+x._z*J+U._z*k,D=u._w*I+s._w*L+x._w*J+U._w*k;return new j(i,d,r,D)}static Hermite1stDerivative(u,x,s,U,_){const W=new j;return this.Hermite1stDerivativeToRef(u,x,s,U,_,W),W}static Hermite1stDerivativeToRef(u,x,s,U,_,W){const c=_*_;return W._x=6*(c-_)*u._x+(3*c-4*_+1)*x._x+6*(-c+_)*s._x+(3*c-2*_)*U._x,W._y=6*(c-_)*u._y+(3*c-4*_+1)*x._y+6*(-c+_)*s._y+(3*c-2*_)*U._y,W._z=6*(c-_)*u._z+(3*c-4*_+1)*x._z+6*(-c+_)*s._z+(3*c-2*_)*U._z,W._w=6*(c-_)*u._w+(3*c-4*_+1)*x._w+6*(-c+_)*s._w+(3*c-2*_)*U._w,W._isDirty=!0,W}static Normalize(u){const x=j.Zero();return j.NormalizeToRef(u,x),x}static NormalizeToRef(u,x){return u.normalizeToRef(x),x}static Clamp(u,x,s){const U=new j;return j.ClampToRef(u,x,s,U),U}static ClampToRef(u,x,s,U){return U.copyFromFloats(L.OQ(u.x,x.x,s.x),L.OQ(u.y,x.y,s.y),L.OQ(u.z,x.z,s.z),L.OQ(u.w,x.w,s.w))}static Random(u=0,x=1){return new j(L.VD(u,x),L.VD(u,x),L.VD(u,x),L.VD(u,x))}static RandomToRef(u=0,x=1,s){return s.copyFromFloats(L.VD(u,x),L.VD(u,x),L.VD(u,x),L.VD(u,x))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(u,x){return Math.sqrt(j.DistanceSquared(u,x))}static DistanceSquared(u,x){const s=u.x-x.x,U=u.y-x.y,_=u.z-x.z,W=u.w-x.w;return s*s+U*U+_*_+W*W}static Center(u,x){return j.CenterToRef(u,x,j.Zero())}static CenterToRef(u,x,s){return s.copyFromFloats((u.x+x.x)/2,(u.y+x.y)/2,(u.z+x.z)/2,(u.w+x.w)/2)}}Object.defineProperties(j.prototype,{dimension:{value:[4]},rank:{value:1}});class r{static get Use64Bits(){return c.I.MatrixUse64Bits}get m(){return this._m}markAsUpdated(){this.updateFlag=r._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(u,x=!1,s=!1,U=!0){this._isIdentity=u,this._isIdentity3x2=u||s,this._isIdentityDirty=!this._isIdentity&&x,this._isIdentity3x2Dirty=!this._isIdentity3x2&&U}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,c.I.MatrixTrackPrecisionChange&&c.I.MatrixTrackedMatrices.push(this),this._m=new c.I.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const u=this._m;this._isIdentity=1===u[0]&&0===u[1]&&0===u[2]&&0===u[3]&&0===u[4]&&1===u[5]&&0===u[6]&&0===u[7]&&0===u[8]&&0===u[9]&&1===u[10]&&0===u[11]&&0===u[12]&&0===u[13]&&0===u[14]&&1===u[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const u=this._m,x=u[0],s=u[1],U=u[2],_=u[3],W=u[4],c=u[5],I=u[6],L=u[7],J=u[8],k=u[9],i=u[10],d=u[11],j=u[12],r=u[13],D=u[14],$=u[15],H=i*$-D*d,f=k*$-r*d,O=k*D-r*i,t=J*$-j*d,V=J*D-i*j,N=J*r-j*k;return x*+(c*H-I*f+L*O)+s*-(W*H-I*t+L*V)+U*+(W*f-c*t+L*N)+_*-(W*O-c*V+I*N)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(u=null,x=0){if(!u)return this._m;const s=this._m;for(let U=0;U<16;U++)u[x+U]=s[U];return this}asArray(){return this._m}fromArray(u,x=0){return r.FromArrayToRef(u,x,this)}copyFromFloats(...u){return r.FromArrayToRef(u,0,this)}set(...u){const x=this._m;for(let s=0;s<16;s++)x[s]=u[s];return this.markAsUpdated(),this}setAll(u){const x=this._m;for(let s=0;s<16;s++)x[s]=u;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return r.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(u){const x=new r;return this.addToRef(u,x),x}addToRef(u,x){const s=this._m,U=x._m,_=u.m;for(let u=0;u<16;u++)U[u]=s[u]+_[u];return x.markAsUpdated(),x}addToSelf(u){const x=this._m,s=u.m;return x[0]+=s[0],x[1]+=s[1],x[2]+=s[2],x[3]+=s[3],x[4]+=s[4],x[5]+=s[5],x[6]+=s[6],x[7]+=s[7],x[8]+=s[8],x[9]+=s[9],x[10]+=s[10],x[11]+=s[11],x[12]+=s[12],x[13]+=s[13],x[14]+=s[14],x[15]+=s[15],this.markAsUpdated(),this}addInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]+=s[u];return this.markAsUpdated(),this}addInPlaceFromFloats(...u){const x=this._m;for(let s=0;s<16;s++)x[s]+=u[s];return this.markAsUpdated(),this}subtract(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]-=s[u];return this.markAsUpdated(),this}subtractToRef(u,x){const s=this._m,U=u.m,_=x._m;for(let u=0;u<16;u++)_[u]=s[u]-U[u];return x.markAsUpdated(),x}subtractInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]-=s[u];return this.markAsUpdated(),this}subtractFromFloats(...u){return this.subtractFromFloatsToRef(...u,new r)}subtractFromFloatsToRef(...u){const x=u.pop(),s=this._m,U=x._m,_=u;for(let u=0;u<16;u++)U[u]=s[u]-_[u];return x.markAsUpdated(),x}invertToRef(u){if(!0===this._isIdentity)return r.IdentityToRef(u),u;const x=this._m,s=x[0],U=x[1],_=x[2],W=x[3],c=x[4],I=x[5],L=x[6],J=x[7],k=x[8],i=x[9],d=x[10],j=x[11],D=x[12],$=x[13],H=x[14],f=x[15],O=d*f-H*j,t=i*f-$*j,V=i*H-$*d,N=k*f-D*j,m=k*H-d*D,b=k*$-D*i,n=+(I*O-L*t+J*V),F=-(c*O-L*N+J*m),B=+(c*t-I*N+J*b),Z=-(c*V-I*m+L*b),v=s*n+U*F+_*B+W*Z;if(0===v)return u.copyFrom(this),u;const y=1/v,e=L*f-H*J,T=I*f-$*J,Q=I*H-$*L,E=c*f-D*J,l=c*H-D*L,z=c*$-D*I,S=L*j-d*J,R=I*j-i*J,X=I*d-i*L,p=c*j-k*J,G=c*d-k*L,w=c*i-k*I,h=-(U*O-_*t+W*V),P=+(s*O-_*N+W*m),o=-(s*t-U*N+W*b),C=+(s*V-U*m+_*b),K=+(U*e-_*T+W*Q),q=-(s*e-_*E+W*l),Y=+(s*T-U*E+W*z),g=-(s*Q-U*l+_*z),A=-(U*S-_*R+W*X),M=+(s*S-_*p+W*G),a=-(s*R-U*p+W*w),uu=+(s*X-U*G+_*w);return r.FromValuesToRef(n*y,h*y,K*y,A*y,F*y,P*y,q*y,M*y,B*y,o*y,Y*y,a*y,Z*y,C*y,g*y,uu*y,u),u}addAtIndex(u,x){return this._m[u]+=x,this.markAsUpdated(),this}multiplyAtIndex(u,x){return this._m[u]*=x,this.markAsUpdated(),this}setTranslationFromFloats(u,x,s){return this._m[12]=u,this._m[13]=x,this._m[14]=s,this.markAsUpdated(),this}addTranslationFromFloats(u,x,s){return this._m[12]+=u,this._m[13]+=x,this._m[14]+=s,this.markAsUpdated(),this}setTranslation(u){return this.setTranslationFromFloats(u._x,u._y,u._z)}getTranslation(){return new i(this._m[12],this._m[13],this._m[14])}getTranslationToRef(u){return u.x=this._m[12],u.y=this._m[13],u.z=this._m[14],u}removeRotationAndScaling(){const u=this.m;return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,u[12],u[13],u[14],u[15],this),this._updateIdentityStatus(0===u[12]&&0===u[13]&&0===u[14]&&1===u[15]),this}copyFrom(u){u.copyToArray(this._m);const x=u;return this.updateFlag=x.updateFlag,this._updateIdentityStatus(x._isIdentity,x._isIdentityDirty,x._isIdentity3x2,x._isIdentity3x2Dirty),this}copyToArray(u,x=0){const s=this._m;return u[x]=s[0],u[x+1]=s[1],u[x+2]=s[2],u[x+3]=s[3],u[x+4]=s[4],u[x+5]=s[5],u[x+6]=s[6],u[x+7]=s[7],u[x+8]=s[8],u[x+9]=s[9],u[x+10]=s[10],u[x+11]=s[11],u[x+12]=s[12],u[x+13]=s[13],u[x+14]=s[14],u[x+15]=s[15],this}multiply(u){const x=new r;return this.multiplyToRef(u,x),x}multiplyInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]*=s[u];return this.markAsUpdated(),this}multiplyByFloats(...u){const x=this._m;for(let s=0;s<16;s++)x[s]*=u[s];return this.markAsUpdated(),this}multiplyByFloatsToRef(...u){const x=u.pop(),s=this._m,U=x._m,_=u;for(let u=0;u<16;u++)U[u]=s[u]*_[u];return x.markAsUpdated(),x}multiplyToRef(u,x){return this._isIdentity?(x.copyFrom(u),x):u._isIdentity?(x.copyFrom(this),x):(this.multiplyToArray(u,x._m,0),x.markAsUpdated(),x)}multiplyToArray(u,x,s){const U=this._m,_=u.m,W=U[0],c=U[1],I=U[2],L=U[3],J=U[4],k=U[5],i=U[6],d=U[7],j=U[8],r=U[9],D=U[10],$=U[11],H=U[12],f=U[13],O=U[14],t=U[15],V=_[0],N=_[1],m=_[2],b=_[3],n=_[4],F=_[5],B=_[6],Z=_[7],v=_[8],y=_[9],e=_[10],T=_[11],Q=_[12],E=_[13],l=_[14],z=_[15];return x[s]=W*V+c*n+I*v+L*Q,x[s+1]=W*N+c*F+I*y+L*E,x[s+2]=W*m+c*B+I*e+L*l,x[s+3]=W*b+c*Z+I*T+L*z,x[s+4]=J*V+k*n+i*v+d*Q,x[s+5]=J*N+k*F+i*y+d*E,x[s+6]=J*m+k*B+i*e+d*l,x[s+7]=J*b+k*Z+i*T+d*z,x[s+8]=j*V+r*n+D*v+$*Q,x[s+9]=j*N+r*F+D*y+$*E,x[s+10]=j*m+r*B+D*e+$*l,x[s+11]=j*b+r*Z+D*T+$*z,x[s+12]=H*V+f*n+O*v+t*Q,x[s+13]=H*N+f*F+O*y+t*E,x[s+14]=H*m+f*B+O*e+t*l,x[s+15]=H*b+f*Z+O*T+t*z,this}divide(u){return this.divideToRef(u,new r)}divideToRef(u,x){const s=this._m,U=u.m,_=x._m;for(let u=0;u<16;u++)_[u]=s[u]/U[u];return x.markAsUpdated(),x}divideInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]/=s[u];return this.markAsUpdated(),this}minimizeInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]=Math.min(x[u],s[u]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(...u){const x=this._m;for(let s=0;s<16;s++)x[s]=Math.min(x[s],u[s]);return this.markAsUpdated(),this}maximizeInPlace(u){const x=this._m,s=u.m;for(let u=0;u<16;u++)x[u]=Math.min(x[u],s[u]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(...u){const x=this._m;for(let s=0;s<16;s++)x[s]=Math.min(x[s],u[s]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new r)}negateInPlace(){const u=this._m;for(let x=0;x<16;x++)u[x]=-u[x];return this.markAsUpdated(),this}negateToRef(u){const x=this._m,s=u._m;for(let u=0;u<16;u++)s[u]=-x[u];return u.markAsUpdated(),u}equals(u){const x=u;if(!x)return!1;if((this._isIdentity||x._isIdentity)&&!this._isIdentityDirty&&!x._isIdentityDirty)return this._isIdentity&&x._isIdentity;const s=this.m,U=x.m;return s[0]===U[0]&&s[1]===U[1]&&s[2]===U[2]&&s[3]===U[3]&&s[4]===U[4]&&s[5]===U[5]&&s[6]===U[6]&&s[7]===U[7]&&s[8]===U[8]&&s[9]===U[9]&&s[10]===U[10]&&s[11]===U[11]&&s[12]===U[12]&&s[13]===U[13]&&s[14]===U[14]&&s[15]===U[15]}equalsWithEpsilon(u,x=0){const s=this._m,U=u.m;for(let u=0;u<16;u++)if(!L.Mj(s[u],U[u],x))return!1;return!0}equalsToFloats(...u){const x=this._m;for(let s=0;s<16;s++)if(x[s]!=u[s])return!1;return!0}floor(){return this.floorToRef(new r)}floorToRef(u){const x=this._m,s=u._m;for(let u=0;u<16;u++)s[u]=Math.floor(x[u]);return u.markAsUpdated(),u}fract(){return this.fractToRef(new r)}fractToRef(u){const x=this._m,s=u._m;for(let u=0;u<16;u++)s[u]=x[u]-Math.floor(x[u]);return u.markAsUpdated(),u}clone(){const u=new r;return u.copyFrom(this),u}getClassName(){return"Matrix"}getHashCode(){let u=J(this._m[0]);for(let x=1;x<16;x++)u=397*u^J(this._m[x]);return u}decomposeToTransformNode(u){return u.rotationQuaternion=u.rotationQuaternion||new j,this.decompose(u.scaling,u.rotationQuaternion,u.position)}decompose(u,x,s,U,_=!0){if(this._isIdentity)return s&&s.setAll(0),u&&u.setAll(1),x&&x.copyFromFloats(0,0,0,1),!0;const W=this._m;if(s&&s.copyFromFloats(W[12],W[13],W[14]),(u=u||D.Vector3[0]).x=Math.sqrt(W[0]*W[0]+W[1]*W[1]+W[2]*W[2]),u.y=Math.sqrt(W[4]*W[4]+W[5]*W[5]+W[6]*W[6]),u.z=Math.sqrt(W[8]*W[8]+W[9]*W[9]+W[10]*W[10]),U){const x=(_?U.absoluteScaling.x:U.scaling.x)<0?-1:1,s=(_?U.absoluteScaling.y:U.scaling.y)<0?-1:1,W=(_?U.absoluteScaling.z:U.scaling.z)<0?-1:1;u.x*=x,u.y*=s,u.z*=W}else this.determinant()<=0&&(u.y*=-1);if(0===u._x||0===u._y||0===u._z)return x&&x.copyFromFloats(0,0,0,1),!1;if(x){const s=1/u._x,U=1/u._y,_=1/u._z;r.FromValuesToRef(W[0]*s,W[1]*s,W[2]*s,0,W[4]*U,W[5]*U,W[6]*U,0,W[8]*_,W[9]*_,W[10]*_,0,0,0,0,1,D.Matrix[0]),j.FromRotationMatrixToRef(D.Matrix[0],x)}return!0}getRow(u){if(u<0||u>3)return null;const x=4*u;return new d(this._m[x+0],this._m[x+1],this._m[x+2],this._m[x+3])}getRowToRef(u,x){if(u>=0&&u<=3){const s=4*u;x.x=this._m[s+0],x.y=this._m[s+1],x.z=this._m[s+2],x.w=this._m[s+3]}return x}setRow(u,x){return this.setRowFromFloats(u,x.x,x.y,x.z,x.w)}transpose(){const u=new r;return r.TransposeToRef(this,u),u}transposeToRef(u){return r.TransposeToRef(this,u),u}setRowFromFloats(u,x,s,U,_){if(u<0||u>3)return this;const W=4*u;return this._m[W+0]=x,this._m[W+1]=s,this._m[W+2]=U,this._m[W+3]=_,this.markAsUpdated(),this}scale(u){const x=new r;return this.scaleToRef(u,x),x}scaleToRef(u,x){for(let s=0;s<16;s++)x._m[s]=this._m[s]*u;return x.markAsUpdated(),x}scaleAndAddToRef(u,x){for(let s=0;s<16;s++)x._m[s]+=this._m[s]*u;return x.markAsUpdated(),x}scaleInPlace(u){const x=this._m;for(let s=0;s<16;s++)x[s]*=u;return this.markAsUpdated(),this}toNormalMatrix(u){const x=D.Matrix[0];this.invertToRef(x),x.transposeToRef(u);const s=u._m;return r.FromValuesToRef(s[0],s[1],s[2],0,s[4],s[5],s[6],0,s[8],s[9],s[10],0,0,0,0,1,u),u}getRotationMatrix(){const u=new r;return this.getRotationMatrixToRef(u),u}getRotationMatrixToRef(u){const x=D.Vector3[0];if(!this.decompose(x))return r.IdentityToRef(u),u;const s=this._m,U=1/x._x,_=1/x._y,W=1/x._z;return r.FromValuesToRef(s[0]*U,s[1]*U,s[2]*U,0,s[4]*_,s[5]*_,s[6]*_,0,s[8]*W,s[9]*W,s[10]*W,0,0,0,0,1,u),u}toggleModelMatrixHandInPlace(){const u=this._m;return u[2]*=-1,u[6]*=-1,u[8]*=-1,u[9]*=-1,u[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const u=this._m;return u[8]*=-1,u[9]*=-1,u[10]*=-1,u[11]*=-1,this.markAsUpdated(),this}static FromArray(u,x=0){const s=new r;return r.FromArrayToRef(u,x,s),s}static FromArrayToRef(u,x,s){for(let U=0;U<16;U++)s._m[U]=u[U+x];return s.markAsUpdated(),s}static FromFloat32ArrayToRefScaled(u,x,s,U){return U._m[0]=u[0+x]*s,U._m[1]=u[1+x]*s,U._m[2]=u[2+x]*s,U._m[3]=u[3+x]*s,U._m[4]=u[4+x]*s,U._m[5]=u[5+x]*s,U._m[6]=u[6+x]*s,U._m[7]=u[7+x]*s,U._m[8]=u[8+x]*s,U._m[9]=u[9+x]*s,U._m[10]=u[10+x]*s,U._m[11]=u[11+x]*s,U._m[12]=u[12+x]*s,U._m[13]=u[13+x]*s,U._m[14]=u[14+x]*s,U._m[15]=u[15+x]*s,U.markAsUpdated(),U}static get IdentityReadOnly(){return r._IdentityReadOnly}static FromValuesToRef(u,x,s,U,_,W,c,I,L,J,k,i,d,j,r,D,$){const H=$._m;H[0]=u,H[1]=x,H[2]=s,H[3]=U,H[4]=_,H[5]=W,H[6]=c,H[7]=I,H[8]=L,H[9]=J,H[10]=k,H[11]=i,H[12]=d,H[13]=j,H[14]=r,H[15]=D,$.markAsUpdated()}static FromValues(u,x,s,U,_,W,c,I,L,J,k,i,d,j,D,$){const H=new r,f=H._m;return f[0]=u,f[1]=x,f[2]=s,f[3]=U,f[4]=_,f[5]=W,f[6]=c,f[7]=I,f[8]=L,f[9]=J,f[10]=k,f[11]=i,f[12]=d,f[13]=j,f[14]=D,f[15]=$,H.markAsUpdated(),H}static Compose(u,x,s){const U=new r;return r.ComposeToRef(u,x,s,U),U}static ComposeToRef(u,x,s,U){const _=U._m,W=x._x,c=x._y,I=x._z,L=x._w,J=W+W,k=c+c,i=I+I,d=W*J,j=W*k,r=W*i,D=c*k,$=c*i,H=I*i,f=L*J,O=L*k,t=L*i,V=u._x,N=u._y,m=u._z;return _[0]=(1-(D+H))*V,_[1]=(j+t)*V,_[2]=(r-O)*V,_[3]=0,_[4]=(j-t)*N,_[5]=(1-(d+H))*N,_[6]=($+f)*N,_[7]=0,_[8]=(r+O)*m,_[9]=($-f)*m,_[10]=(1-(d+D))*m,_[11]=0,_[12]=s._x,_[13]=s._y,_[14]=s._z,_[15]=1,U.markAsUpdated(),U}static Identity(){const u=r.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return u._updateIdentityStatus(!0),u}static IdentityToRef(u){return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,u),u._updateIdentityStatus(!0),u}static Zero(){const u=r.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return u._updateIdentityStatus(!1),u}static RotationX(u){const x=new r;return r.RotationXToRef(u,x),x}static Invert(u){const x=new r;return u.invertToRef(x),x}static RotationXToRef(u,x){const s=Math.sin(u),U=Math.cos(u);return r.FromValuesToRef(1,0,0,0,0,U,s,0,0,-s,U,0,0,0,0,1,x),x._updateIdentityStatus(1===U&&0===s),x}static RotationY(u){const x=new r;return r.RotationYToRef(u,x),x}static RotationYToRef(u,x){const s=Math.sin(u),U=Math.cos(u);return r.FromValuesToRef(U,0,-s,0,0,1,0,0,s,0,U,0,0,0,0,1,x),x._updateIdentityStatus(1===U&&0===s),x}static RotationZ(u){const x=new r;return r.RotationZToRef(u,x),x}static RotationZToRef(u,x){const s=Math.sin(u),U=Math.cos(u);return r.FromValuesToRef(U,s,0,0,-s,U,0,0,0,0,1,0,0,0,0,1,x),x._updateIdentityStatus(1===U&&0===s),x}static RotationAxis(u,x){const s=new r;return r.RotationAxisToRef(u,x,s),s}static RotationAxisToRef(u,x,s){const U=Math.sin(-x),_=Math.cos(-x),W=1-_;u=u.normalizeToRef(D.Vector3[0]);const c=s._m;return c[0]=u._x*u._x*W+_,c[1]=u._x*u._y*W-u._z*U,c[2]=u._x*u._z*W+u._y*U,c[3]=0,c[4]=u._y*u._x*W+u._z*U,c[5]=u._y*u._y*W+_,c[6]=u._y*u._z*W-u._x*U,c[7]=0,c[8]=u._z*u._x*W-u._y*U,c[9]=u._z*u._y*W+u._x*U,c[10]=u._z*u._z*W+_,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,s.markAsUpdated(),s}static RotationAlignToRef(u,x,s,_=!1){const W=i.Dot(x,u),c=s._m;if(W<-1+U.bH)c[0]=-1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_?1:-1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=_?-1:1,c[11]=0;else{const s=i.Cross(x,u),U=1/(1+W);c[0]=s._x*s._x*U+W,c[1]=s._y*s._x*U-s._z,c[2]=s._z*s._x*U+s._y,c[3]=0,c[4]=s._x*s._y*U+s._z,c[5]=s._y*s._y*U+W,c[6]=s._z*s._y*U-s._x,c[7]=0,c[8]=s._x*s._z*U-s._y,c[9]=s._y*s._z*U+s._x,c[10]=s._z*s._z*U+W,c[11]=0}return c[12]=0,c[13]=0,c[14]=0,c[15]=1,s.markAsUpdated(),s}static RotationYawPitchRoll(u,x,s){const U=new r;return r.RotationYawPitchRollToRef(u,x,s,U),U}static RotationYawPitchRollToRef(u,x,s,U){return j.RotationYawPitchRollToRef(u,x,s,D.Quaternion[0]),D.Quaternion[0].toRotationMatrix(U),U}static Scaling(u,x,s){const U=new r;return r.ScalingToRef(u,x,s,U),U}static ScalingToRef(u,x,s,U){return r.FromValuesToRef(u,0,0,0,0,x,0,0,0,0,s,0,0,0,0,1,U),U._updateIdentityStatus(1===u&&1===x&&1===s),U}static Translation(u,x,s){const U=new r;return r.TranslationToRef(u,x,s,U),U}static TranslationToRef(u,x,s,U){return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,u,x,s,1,U),U._updateIdentityStatus(0===u&&0===x&&0===s),U}static Lerp(u,x,s){const U=new r;return r.LerpToRef(u,x,s,U),U}static LerpToRef(u,x,s,U){const _=U._m,W=u.m,c=x.m;for(let u=0;u<16;u++)_[u]=W[u]*(1-s)+c[u]*s;return U.markAsUpdated(),U}static DecomposeLerp(u,x,s){const U=new r;return r.DecomposeLerpToRef(u,x,s,U),U}static DecomposeLerpToRef(u,x,s,U){const _=D.Vector3[0],W=D.Quaternion[0],c=D.Vector3[1];u.decompose(_,W,c);const I=D.Vector3[2],L=D.Quaternion[1],J=D.Vector3[3];x.decompose(I,L,J);const k=D.Vector3[4];i.LerpToRef(_,I,s,k);const d=D.Quaternion[2];j.SlerpToRef(W,L,s,d);const $=D.Vector3[5];return i.LerpToRef(c,J,s,$),r.ComposeToRef(k,d,$,U),U}static LookAtLH(u,x,s){const U=new r;return r.LookAtLHToRef(u,x,s,U),U}static LookAtLHToRef(u,x,s,U){const _=D.Vector3[0],W=D.Vector3[1],c=D.Vector3[2];x.subtractToRef(u,c),c.normalize(),i.CrossToRef(s,c,_);const I=_.lengthSquared();0===I?_.x=1:_.normalizeFromLength(Math.sqrt(I)),i.CrossToRef(c,_,W),W.normalize();const L=-i.Dot(_,u),J=-i.Dot(W,u),k=-i.Dot(c,u);return r.FromValuesToRef(_._x,W._x,c._x,0,_._y,W._y,c._y,0,_._z,W._z,c._z,0,L,J,k,1,U),U}static LookAtRH(u,x,s){const U=new r;return r.LookAtRHToRef(u,x,s,U),U}static LookAtRHToRef(u,x,s,U){const _=D.Vector3[0],W=D.Vector3[1],c=D.Vector3[2];u.subtractToRef(x,c),c.normalize(),i.CrossToRef(s,c,_);const I=_.lengthSquared();0===I?_.x=1:_.normalizeFromLength(Math.sqrt(I)),i.CrossToRef(c,_,W),W.normalize();const L=-i.Dot(_,u),J=-i.Dot(W,u),k=-i.Dot(c,u);return r.FromValuesToRef(_._x,W._x,c._x,0,_._y,W._y,c._y,0,_._z,W._z,c._z,0,L,J,k,1,U),U}static LookDirectionLH(u,x){const s=new r;return r.LookDirectionLHToRef(u,x,s),s}static LookDirectionLHToRef(u,x,s){const U=D.Vector3[0];U.copyFrom(u),U.scaleInPlace(-1);const _=D.Vector3[1];return i.CrossToRef(x,U,_),r.FromValuesToRef(_._x,_._y,_._z,0,x._x,x._y,x._z,0,U._x,U._y,U._z,0,0,0,0,1,s),s}static LookDirectionRH(u,x){const s=new r;return r.LookDirectionRHToRef(u,x,s),s}static LookDirectionRHToRef(u,x,s){const U=D.Vector3[2];return i.CrossToRef(x,u,U),r.FromValuesToRef(U._x,U._y,U._z,0,x._x,x._y,x._z,0,u._x,u._y,u._z,0,0,0,0,1,s),s}static OrthoLH(u,x,s,U,_){const W=new r;return r.OrthoLHToRef(u,x,s,U,W,_),W}static OrthoLHToRef(u,x,s,U,_,W){const c=2/u,I=2/x,L=2/(U-s),J=-(U+s)/(U-s);return r.FromValuesToRef(c,0,0,0,0,I,0,0,0,0,L,0,0,0,J,1,_),W&&_.multiplyToRef(H,_),_._updateIdentityStatus(1===c&&1===I&&1===L&&0===J),_}static OrthoOffCenterLH(u,x,s,U,_,W,c){const I=new r;return r.OrthoOffCenterLHToRef(u,x,s,U,_,W,I,c),I}static OrthoOffCenterLHToRef(u,x,s,U,_,W,c,I){const L=2/(x-u),J=2/(U-s),k=2/(W-_),i=-(W+_)/(W-_),d=(u+x)/(u-x),j=(U+s)/(s-U);return r.FromValuesToRef(L,0,0,0,0,J,0,0,0,0,k,0,d,j,i,1,c),I&&c.multiplyToRef(H,c),c.markAsUpdated(),c}static ObliqueOffCenterLHToRef(u,x,s,U,_,W,c,I,L,J,k){const i=-c*Math.cos(I),d=-c*Math.sin(I);return r.TranslationToRef(0,0,-L,D.Matrix[1]),r.FromValuesToRef(1,0,0,0,0,1,0,0,i,d,1,0,0,0,0,1,D.Matrix[0]),D.Matrix[1].multiplyToRef(D.Matrix[0],D.Matrix[0]),r.TranslationToRef(0,0,L,D.Matrix[1]),D.Matrix[0].multiplyToRef(D.Matrix[1],D.Matrix[0]),r.OrthoOffCenterLHToRef(u,x,s,U,_,W,J,k),D.Matrix[0].multiplyToRef(J,J),J}static OrthoOffCenterRH(u,x,s,U,_,W,c){const I=new r;return r.OrthoOffCenterRHToRef(u,x,s,U,_,W,I,c),I}static OrthoOffCenterRHToRef(u,x,s,U,_,W,c,I){return r.OrthoOffCenterLHToRef(u,x,s,U,_,W,c,I),c._m[10]*=-1,c}static ObliqueOffCenterRHToRef(u,x,s,U,_,W,c,I,L,J,k){const i=c*Math.cos(I),d=c*Math.sin(I);return r.TranslationToRef(0,0,L,D.Matrix[1]),r.FromValuesToRef(1,0,0,0,0,1,0,0,i,d,1,0,0,0,0,1,D.Matrix[0]),D.Matrix[1].multiplyToRef(D.Matrix[0],D.Matrix[0]),r.TranslationToRef(0,0,-L,D.Matrix[1]),D.Matrix[0].multiplyToRef(D.Matrix[1],D.Matrix[0]),r.OrthoOffCenterRHToRef(u,x,s,U,_,W,J,k),D.Matrix[0].multiplyToRef(J,J),J}static PerspectiveLH(u,x,s,U,_,W=0){const c=new r,I=2*s/u,L=2*s/x,J=(U+s)/(U-s),k=-2*U*s/(U-s),i=Math.tan(W);return r.FromValuesToRef(I,0,0,0,0,L,0,i,0,0,J,1,0,0,k,0,c),_&&c.multiplyToRef(H,c),c._updateIdentityStatus(!1),c}static PerspectiveFovLH(u,x,s,U,_,W=0,c=!1){const I=new r;return r.PerspectiveFovLHToRef(u,x,s,U,I,!0,_,W,c),I}static PerspectiveFovLHToRef(u,x,s,U,_,W=!0,c,I=0,L=!1){const J=s,k=U,i=1/Math.tan(.5*u),d=W?i/x:i,j=W?i:i*x,D=L&&0===J?-1:0!==k?(k+J)/(k-J):1,$=L&&0===J?2*k:0!==k?-2*k*J/(k-J):-2*J,f=Math.tan(I);return r.FromValuesToRef(d,0,0,0,0,j,0,f,0,0,D,1,0,0,$,0,_),c&&_.multiplyToRef(H,_),_._updateIdentityStatus(!1),_}static PerspectiveFovReverseLHToRef(u,x,s,U,_,W=!0,c,I=0){const L=1/Math.tan(.5*u),J=W?L/x:L,k=W?L:L*x,i=Math.tan(I);return r.FromValuesToRef(J,0,0,0,0,k,0,i,0,0,-s,1,0,0,1,0,_),c&&_.multiplyToRef(H,_),_._updateIdentityStatus(!1),_}static PerspectiveFovRH(u,x,s,U,_,W=0,c=!1){const I=new r;return r.PerspectiveFovRHToRef(u,x,s,U,I,!0,_,W,c),I}static PerspectiveFovRHToRef(u,x,s,U,_,W=!0,c,I=0,L=!1){const J=s,k=U,i=1/Math.tan(.5*u),d=W?i/x:i,j=W?i:i*x,D=L&&0===J?1:0!==k?-(k+J)/(k-J):-1,$=L&&0===J?2*k:0!==k?-2*k*J/(k-J):-2*J,f=Math.tan(I);return r.FromValuesToRef(d,0,0,0,0,j,0,f,0,0,D,-1,0,0,$,0,_),c&&_.multiplyToRef(H,_),_._updateIdentityStatus(!1),_}static PerspectiveFovReverseRHToRef(u,x,s,U,_,W=!0,c,I=0){const L=1/Math.tan(.5*u),J=W?L/x:L,k=W?L:L*x,i=Math.tan(I);return r.FromValuesToRef(J,0,0,0,0,k,0,i,0,0,-s,-1,0,0,-1,0,_),c&&_.multiplyToRef(H,_),_._updateIdentityStatus(!1),_}static GetFinalMatrix(u,x,s,U,_,W){const c=u.width,I=u.height,L=u.x,J=u.y,k=r.FromValues(c/2,0,0,0,0,-I/2,0,0,0,0,W-_,0,L+c/2,I/2+J,_,1),i=new r;return x.multiplyToRef(s,i),i.multiplyToRef(U,i),i.multiplyToRef(k,i)}static GetAsMatrix2x2(u){const x=u.m,s=[x[0],x[1],x[4],x[5]];return c.I.MatrixUse64Bits?s:new Float32Array(s)}static GetAsMatrix3x3(u){const x=u.m,s=[x[0],x[1],x[2],x[4],x[5],x[6],x[8],x[9],x[10]];return c.I.MatrixUse64Bits?s:new Float32Array(s)}static Transpose(u){const x=new r;return r.TransposeToRef(u,x),x}static TransposeToRef(u,x){const s=u.m,U=s[0],_=s[4],W=s[8],c=s[12],I=s[1],L=s[5],J=s[9],k=s[13],i=s[2],d=s[6],j=s[10],r=s[14],D=s[3],$=s[7],H=s[11],f=s[15],O=x._m;return O[0]=U,O[1]=_,O[2]=W,O[3]=c,O[4]=I,O[5]=L,O[6]=J,O[7]=k,O[8]=i,O[9]=d,O[10]=j,O[11]=r,O[12]=D,O[13]=$,O[14]=H,O[15]=f,x.markAsUpdated(),x._updateIdentityStatus(u._isIdentity,u._isIdentityDirty),x}static Reflection(u){const x=new r;return r.ReflectionToRef(u,x),x}static ReflectionToRef(u,x){u.normalize();const s=u.normal.x,U=u.normal.y,_=u.normal.z,W=-2*s,c=-2*U,I=-2*_;return r.FromValuesToRef(W*s+1,c*s,I*s,0,W*U,c*U+1,I*U,0,W*_,c*_,I*_+1,0,W*u.d,c*u.d,I*u.d,1,x),x}static FromXYZAxesToRef(u,x,s,U){return r.FromValuesToRef(u._x,u._y,u._z,0,x._x,x._y,x._z,0,s._x,s._y,s._z,0,0,0,0,1,U),U}static FromQuaternionToRef(u,x){const s=u._x*u._x,U=u._y*u._y,_=u._z*u._z,W=u._x*u._y,c=u._z*u._w,I=u._z*u._x,L=u._y*u._w,J=u._y*u._z,k=u._x*u._w;return x._m[0]=1-2*(U+_),x._m[1]=2*(W+c),x._m[2]=2*(I-L),x._m[3]=0,x._m[4]=2*(W-c),x._m[5]=1-2*(_+s),x._m[6]=2*(J+k),x._m[7]=0,x._m[8]=2*(I+L),x._m[9]=2*(J-k),x._m[10]=1-2*(U+s),x._m[11]=0,x._m[12]=0,x._m[13]=0,x._m[14]=0,x._m[15]=1,x.markAsUpdated(),x}}r._UpdateFlagSeed=0,r._IdentityReadOnly=r.Identity(),Object.defineProperties(r.prototype,{dimension:{value:[4,4]},rank:{value:2}});class D{}D.Vector3=_.ln(11,i.Zero),D.Matrix=_.ln(2,r.Identity),D.Quaternion=_.ln(3,j.Zero);class ${}$.Vector2=_.ln(3,k.Zero),$.Vector3=_.ln(13,i.Zero),$.Vector4=_.ln(3,d.Zero),$.Quaternion=_.ln(3,j.Zero),$.Matrix=_.ln(8,r.Identity),W.Y5("BABYLON.Vector2",k),W.Y5("BABYLON.Vector3",i),W.Y5("BABYLON.Vector4",d),W.Y5("BABYLON.Matrix",r);const H=r.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},60071:(u,x,s)=>{s.d(x,{L:()=>U});class U{constructor(u,x,s,U){this.x=u,this.y=x,this.width=s,this.height=U}toGlobal(u,x){return new U(this.x*u,this.y*x,this.width*u,this.height*x)}toGlobalToRef(u,x,s){return s.x=this.x*u,s.y=this.y*x,s.width=this.width*u,s.height=this.height*x,this}clone(){return new U(this.x,this.y,this.width,this.height)}}},562756:(u,x,s)=>{s.d(x,{O:()=>J,Q:()=>k});var U=s(604910),_=s(948733);const W=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],c=[()=>1,u=>u.y,u=>u.z,u=>u.x,u=>u.x*u.y,u=>u.y*u.z,u=>3*u.z*u.z-1,u=>u.x*u.z,u=>u.x*u.x-u.y*u.y],I=(u,x)=>W[u]*c[u](x),L=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class J{constructor(){this.preScaled=!1,this.l00=U.Pq.Zero(),this.l1_1=U.Pq.Zero(),this.l10=U.Pq.Zero(),this.l11=U.Pq.Zero(),this.l2_2=U.Pq.Zero(),this.l2_1=U.Pq.Zero(),this.l20=U.Pq.Zero(),this.l21=U.Pq.Zero(),this.l22=U.Pq.Zero()}addLight(u,x,s){_.AA.Vector3[0].set(x.r,x.g,x.b);const U=_.AA.Vector3[0],W=_.AA.Vector3[1];U.scaleToRef(s,W),W.scaleToRef(I(0,u),_.AA.Vector3[2]),this.l00.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(1,u),_.AA.Vector3[2]),this.l1_1.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(2,u),_.AA.Vector3[2]),this.l10.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(3,u),_.AA.Vector3[2]),this.l11.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(4,u),_.AA.Vector3[2]),this.l2_2.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(5,u),_.AA.Vector3[2]),this.l2_1.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(6,u),_.AA.Vector3[2]),this.l20.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(7,u),_.AA.Vector3[2]),this.l21.addInPlace(_.AA.Vector3[2]),W.scaleToRef(I(8,u),_.AA.Vector3[2]),this.l22.addInPlace(_.AA.Vector3[2])}scaleInPlace(u){this.l00.scaleInPlace(u),this.l1_1.scaleInPlace(u),this.l10.scaleInPlace(u),this.l11.scaleInPlace(u),this.l2_2.scaleInPlace(u),this.l2_1.scaleInPlace(u),this.l20.scaleInPlace(u),this.l21.scaleInPlace(u),this.l22.scaleInPlace(u)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(L[0]),this.l1_1.scaleInPlace(L[1]),this.l10.scaleInPlace(L[2]),this.l11.scaleInPlace(L[3]),this.l2_2.scaleInPlace(L[4]),this.l2_1.scaleInPlace(L[5]),this.l20.scaleInPlace(L[6]),this.l21.scaleInPlace(L[7]),this.l22.scaleInPlace(L[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(W[0]),this.l1_1.scaleInPlace(W[1]),this.l10.scaleInPlace(W[2]),this.l11.scaleInPlace(W[3]),this.l2_2.scaleInPlace(W[4]),this.l2_1.scaleInPlace(W[5]),this.l20.scaleInPlace(W[6]),this.l21.scaleInPlace(W[7]),this.l22.scaleInPlace(W[8])}updateFromArray(u){return U.Pq.FromArrayToRef(u[0],0,this.l00),U.Pq.FromArrayToRef(u[1],0,this.l1_1),U.Pq.FromArrayToRef(u[2],0,this.l10),U.Pq.FromArrayToRef(u[3],0,this.l11),U.Pq.FromArrayToRef(u[4],0,this.l2_2),U.Pq.FromArrayToRef(u[5],0,this.l2_1),U.Pq.FromArrayToRef(u[6],0,this.l20),U.Pq.FromArrayToRef(u[7],0,this.l21),U.Pq.FromArrayToRef(u[8],0,this.l22),this}updateFromFloatsArray(u){return U.Pq.FromFloatsToRef(u[0],u[1],u[2],this.l00),U.Pq.FromFloatsToRef(u[3],u[4],u[5],this.l1_1),U.Pq.FromFloatsToRef(u[6],u[7],u[8],this.l10),U.Pq.FromFloatsToRef(u[9],u[10],u[11],this.l11),U.Pq.FromFloatsToRef(u[12],u[13],u[14],this.l2_2),U.Pq.FromFloatsToRef(u[15],u[16],u[17],this.l2_1),U.Pq.FromFloatsToRef(u[18],u[19],u[20],this.l20),U.Pq.FromFloatsToRef(u[21],u[22],u[23],this.l21),U.Pq.FromFloatsToRef(u[24],u[25],u[26],this.l22),this}static FromArray(u){return(new J).updateFromArray(u)}static FromPolynomial(u){const x=new J;return x.l00=u.xx.scale(.376127).add(u.yy.scale(.376127)).add(u.zz.scale(.376126)),x.l1_1=u.y.scale(.977204),x.l10=u.z.scale(.977204),x.l11=u.x.scale(.977204),x.l2_2=u.xy.scale(1.16538),x.l2_1=u.yz.scale(1.16538),x.l20=u.zz.scale(1.34567).subtract(u.xx.scale(.672834)).subtract(u.yy.scale(.672834)),x.l21=u.zx.scale(1.16538),x.l22=u.xx.scale(1.16538).subtract(u.yy.scale(1.16538)),x.l1_1.scaleInPlace(-1),x.l11.scaleInPlace(-1),x.l2_1.scaleInPlace(-1),x.l21.scaleInPlace(-1),x.scaleInPlace(Math.PI),x}}class k{constructor(){this.x=U.Pq.Zero(),this.y=U.Pq.Zero(),this.z=U.Pq.Zero(),this.xx=U.Pq.Zero(),this.yy=U.Pq.Zero(),this.zz=U.Pq.Zero(),this.xy=U.Pq.Zero(),this.yz=U.Pq.Zero(),this.zx=U.Pq.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=J.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(u){_.AA.Vector3[0].copyFromFloats(u.r,u.g,u.b);const x=_.AA.Vector3[0];this.xx.addInPlace(x),this.yy.addInPlace(x),this.zz.addInPlace(x)}scaleInPlace(u){this.x.scaleInPlace(u),this.y.scaleInPlace(u),this.z.scaleInPlace(u),this.xx.scaleInPlace(u),this.yy.scaleInPlace(u),this.zz.scaleInPlace(u),this.yz.scaleInPlace(u),this.zx.scaleInPlace(u),this.xy.scaleInPlace(u)}updateFromHarmonics(u){return this._harmonics=u,this.x.copyFrom(u.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(u.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(u.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(u.l00),_.AA.Vector3[0].copyFrom(u.l20).scaleInPlace(.247708),_.AA.Vector3[1].copyFrom(u.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(_.AA.Vector3[0]).addInPlace(_.AA.Vector3[1]),this.yy.copyFrom(u.l00),this.yy.scaleInPlace(.886277).subtractInPlace(_.AA.Vector3[0]).subtractInPlace(_.AA.Vector3[1]),this.zz.copyFrom(u.l00),_.AA.Vector3[0].copyFrom(u.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(_.AA.Vector3[0]),this.yz.copyFrom(u.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(u.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(u.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(u){return(new k).updateFromHarmonics(u)}static FromArray(u){const x=new k;return U.Pq.FromArrayToRef(u[0],0,x.x),U.Pq.FromArrayToRef(u[1],0,x.y),U.Pq.FromArrayToRef(u[2],0,x.z),U.Pq.FromArrayToRef(u[3],0,x.xx),U.Pq.FromArrayToRef(u[4],0,x.yy),U.Pq.FromArrayToRef(u[5],0,x.zz),U.Pq.FromArrayToRef(u[6],0,x.yz),U.Pq.FromArrayToRef(u[7],0,x.zx),U.Pq.FromArrayToRef(u[8],0,x.xy),x}}},600962:(u,x,s)=>{s.d(x,{G$:()=>k,Jo:()=>d,KA:()=>J,an:()=>i});var U=s(604910),_=s(332290),W=s(27230),c=s(818696),I=s(158548),L=s(775646);function J(u){const x=6;let s=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const W=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],L=[];let J=[];const k=u.width||u.size||1,i=u.height||u.size||1,d=u.depth||u.size||1,j=u.wrap||!1;let r=void 0===u.topBaseAt?1:u.topBaseAt,D=void 0===u.bottomBaseAt?0:u.bottomBaseAt;r=(r+4)%4,D=(D+4)%4;let $=[2,0,3,1][r],H=[2,0,1,3][D],f=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(j){s=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],f=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let u=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],x=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const U=[17,18,19,16],_=[22,23,20,21];for(;$>0;)u.unshift(u.pop()),U.unshift(U.pop()),$--;for(;H>0;)x.unshift(x.pop()),_.unshift(_.pop()),H--;u=u.flat(),x=x.flat(),f=f.concat(u).concat(x),s.push(U[0],U[2],U[3],U[0],U[1],U[2]),s.push(_[0],_[2],_[3],_[0],_[1],_[2])}const O=[k/2,i/2,d/2];J=f.reduce(((u,x,s)=>u.concat(x*O[s%3])),[]);const t=0===u.sideOrientation?0:u.sideOrientation||c.P.DEFAULTSIDE,V=u.faceUV||new Array(6),N=u.faceColors,m=[];for(let u=0;u<6;u++)void 0===V[u]&&(V[u]=new U.IU(0,0,1,1)),N&&void 0===N[u]&&(N[u]=new _.ov(1,1,1,1));for(let u=0;u<x;u++)if(L.push(V[u].z,I.rX?1-V[u].w:V[u].w),L.push(V[u].x,I.rX?1-V[u].w:V[u].w),L.push(V[u].x,I.rX?1-V[u].y:V[u].y),L.push(V[u].z,I.rX?1-V[u].y:V[u].y),N)for(let x=0;x<4;x++)m.push(N[u].r,N[u].g,N[u].b,N[u].a);c.P._ComputeSides(t,J,s,W,L,u.frontUVs,u.backUVs);const b=new c.P;if(b.indices=s,b.positions=J,b.normals=W,b.uvs=L,N){const u=t===c.P.DOUBLESIDE?m.concat(m):m;b.colors=u}return b}function k(u){const x=u.width||u.size||1,s=u.height||u.size||1,_=u.depth||u.size||1,W=0|(u.widthSegments||u.segments||1),c=0|(u.heightSegments||u.segments||1),I=0|(u.depthSegments||u.segments||1),J=new U.uq,k=new U.uq,i=new U.uq,d=L.EH({width:x,height:_,subdivisionsX:W,subdivisionsY:I});U.uq.TranslationToRef(0,-s/2,0,k),U.uq.RotationZToRef(Math.PI,J),J.multiplyToRef(k,i),d.transform(i);const j=L.EH({width:x,height:_,subdivisionsX:W,subdivisionsY:I});U.uq.TranslationToRef(0,s/2,0,i),j.transform(i);const r=L.EH({width:s,height:_,subdivisionsX:c,subdivisionsY:I});U.uq.TranslationToRef(-x/2,0,0,k),U.uq.RotationZToRef(Math.PI/2,J),J.multiplyToRef(k,i),r.transform(i);const D=L.EH({width:s,height:_,subdivisionsX:c,subdivisionsY:I});U.uq.TranslationToRef(x/2,0,0,k),U.uq.RotationZToRef(-Math.PI/2,J),J.multiplyToRef(k,i),D.transform(i);const $=L.EH({width:x,height:s,subdivisionsX:W,subdivisionsY:c});U.uq.TranslationToRef(0,0,-_/2,k),U.uq.RotationXToRef(-Math.PI/2,J),J.multiplyToRef(k,i),$.transform(i);const H=L.EH({width:x,height:s,subdivisionsX:W,subdivisionsY:c});return U.uq.TranslationToRef(0,0,_/2,k),U.uq.RotationXToRef(Math.PI/2,J),J.multiplyToRef(k,i),H.transform(i),d.merge([j,D,r,$,H],!0),d}function i(u,x={},s=null){const U=new W.e(u,s);return x.sideOrientation=W.e._GetDefaultSideOrientation(x.sideOrientation),U._originalBuilderSideOrientation=x.sideOrientation,J(x).applyToMesh(U,x.updatable),U}const d={CreateBox:i};c.P.CreateBox=J,W.e.CreateBox=(u,x,s=null,U,_)=>i(u,{size:x,sideOrientation:_,updatable:U},s)},775646:(u,x,s)=>{s.d(x,{EH:()=>d,LL:()=>f,RI:()=>H,k:()=>j,km:()=>D,ol:()=>$,r_:()=>r});var U=s(604910),_=s(332290),W=s(27230),c=s(818696),I=s(406185),L=s(898973),J=s(395726),k=s(779908),i=s(158548);function d(u){const x=[],s=[],_=[],W=[];let I,L;const J=u.width||1,k=u.height||1,d=0|(u.subdivisionsX||u.subdivisions||1),j=0|(u.subdivisionsY||u.subdivisions||1);for(I=0;I<=j;I++)for(L=0;L<=d;L++){const u=new U.Pq(L*J/d-J/2,0,(j-I)*k/j-k/2),x=new U.Pq(0,1,0);s.push(u.x,u.y,u.z),_.push(x.x,x.y,x.z),W.push(L/d,i.rX?I/j:1-I/j)}for(I=0;I<j;I++)for(L=0;L<d;L++)x.push(L+1+(I+1)*(d+1)),x.push(L+1+I*(d+1)),x.push(L+I*(d+1)),x.push(L+(I+1)*(d+1)),x.push(L+1+(I+1)*(d+1)),x.push(L+I*(d+1));const r=new c.P;return r.indices=x,r.positions=s,r.normals=_,r.uvs=W,r}function j(u){const x=void 0!==u.xmin&&null!==u.xmin?u.xmin:-1,s=void 0!==u.zmin&&null!==u.zmin?u.zmin:-1,_=void 0!==u.xmax&&null!==u.xmax?u.xmax:1,W=void 0!==u.zmax&&null!==u.zmax?u.zmax:1,I=u.subdivisions||{w:1,h:1},L=u.precision||{w:1,h:1},J=[],k=[],i=[],d=[];let j,r,D,$;I.h=I.h<1?1:I.h,I.w=I.w<1?1:I.w,L.w=L.w<1?1:L.w,L.h=L.h<1?1:L.h;const H=(_-x)/I.w,f=(W-s)/I.h;function O(u,x,s,_){const W=k.length/3,c=L.w+1;for(j=0;j<L.h;j++)for(r=0;r<L.w;r++){const u=[W+r+j*c,W+(r+1)+j*c,W+(r+1)+(j+1)*c,W+r+(j+1)*c];J.push(u[1]),J.push(u[2]),J.push(u[3]),J.push(u[0]),J.push(u[1]),J.push(u[3])}const I=U.Pq.Zero(),D=new U.Pq(0,1,0);for(j=0;j<=L.h;j++)for(I.z=j*(_-x)/L.h+x,r=0;r<=L.w;r++)I.x=r*(s-u)/L.w+u,I.y=0,k.push(I.x,I.y,I.z),i.push(D.x,D.y,D.z),d.push(r/L.w,j/L.h)}for(D=0;D<I.h;D++)for($=0;$<I.w;$++)O(x+$*H,s+D*f,x+($+1)*H,s+(D+1)*f);const t=new c.P;return t.indices=J,t.positions=k,t.normals=i,t.uvs=d,t}function r(u){const x=[],s=[],W=[],I=[];let L,J;const i=u.colorFilter||new _.v9(.3,.59,.11),d=u.alphaFilter||0;let j=!1;if(u.minHeight>u.maxHeight){j=!0;const x=u.maxHeight;u.maxHeight=u.minHeight,u.minHeight=x}for(L=0;L<=u.subdivisions;L++)for(J=0;J<=u.subdivisions;J++){const x=new U.Pq(J*u.width/u.subdivisions-u.width/2,0,(u.subdivisions-L)*u.height/u.subdivisions-u.height/2),_=4*(((x.x+u.width/2)/u.width*(u.bufferWidth-1)|0)+((1-(x.z+u.height/2)/u.height)*(u.bufferHeight-1)|0)*u.bufferWidth);let c=u.buffer[_]/255,r=u.buffer[_+1]/255,D=u.buffer[_+2]/255;const $=u.buffer[_+3]/255;j&&(c=1-c,r=1-r,D=1-D);const H=c*i.r+r*i.g+D*i.b;x.y=$>=d?u.minHeight+(u.maxHeight-u.minHeight)*H:u.minHeight-k.bH,u.heightBuffer&&(u.heightBuffer[L*(u.subdivisions+1)+J]=x.y),s.push(x.x,x.y,x.z),W.push(0,0,0),I.push(J/u.subdivisions,1-L/u.subdivisions)}for(L=0;L<u.subdivisions;L++)for(J=0;J<u.subdivisions;J++){const U=J+1+(L+1)*(u.subdivisions+1),_=J+1+L*(u.subdivisions+1),W=J+L*(u.subdivisions+1),c=J+(L+1)*(u.subdivisions+1),I=s[3*U+1]>=u.minHeight,k=s[3*_+1]>=u.minHeight,i=s[3*W+1]>=u.minHeight;I&&k&&i&&(x.push(U),x.push(_),x.push(W)),s[3*c+1]>=u.minHeight&&I&&i&&(x.push(c),x.push(U),x.push(W))}c.P.ComputeNormals(s,x,W);const r=new c.P;return r.indices=x,r.positions=s,r.normals=W,r.uvs=I,r}function D(u,x={},s){const U=new I.f(u,s);return U._setReady(!1),U._subdivisionsX=x.subdivisionsX||x.subdivisions||1,U._subdivisionsY=x.subdivisionsY||x.subdivisions||1,U._width=x.width||1,U._height=x.height||1,U._maxX=U._width/2,U._maxZ=U._height/2,U._minX=-U._maxX,U._minZ=-U._maxZ,d(x).applyToMesh(U,x.updatable),U._setReady(!0),U}function $(u,x,s=null){const U=new W.e(u,s);return j(x).applyToMesh(U,x.updatable),U}function H(u,x,s={},U=null){const W=s.width||10,c=s.height||10,k=s.subdivisions||1|0,i=s.minHeight||0,d=s.maxHeight||1,j=s.colorFilter||new _.v9(.3,.59,.11),D=s.alphaFilter||0,$=s.updatable,H=s.onReady;U=U||J.q.LastCreatedScene;const f=new I.f(u,U);let O;f._subdivisionsX=k,f._subdivisionsY=k,f._width=W,f._height=c,f._maxX=f._width/2,f._maxZ=f._height/2,f._minX=-f._maxX,f._minZ=-f._maxZ,f._setReady(!1),s.passHeightBufferInCallback&&(O=new Float32Array((k+1)*(k+1)));const t=(u,x,s)=>{r({width:W,height:c,subdivisions:k,minHeight:i,maxHeight:d,colorFilter:j,buffer:u,bufferWidth:x,bufferHeight:s,alphaFilter:D,heightBuffer:O}).applyToMesh(f,$),H&&H(f,O),f._setReady(!0)};if("string"==typeof x){const u=u=>{const x=u.width,s=u.height;if(U.isDisposed)return;const _=null==U?void 0:U.getEngine().resizeImageBitmap(u,x,s);t(_,x,s)};L.S0.LoadImage(x,u,s.onError?s.onError:()=>{},U.offlineProvider)}else t(x.data,x.width,x.height);return f}const f={CreateGround:D,CreateGroundFromHeightMap:H,CreateTiledGround:$};c.P.CreateGround=d,c.P.CreateTiledGround=j,c.P.CreateGroundFromHeightMap=r,W.e.CreateGround=(u,x,s,U,_,W)=>D(u,{width:x,height:s,subdivisions:U,updatable:W},_),W.e.CreateTiledGround=(u,x,s,U,_,W,c,I,L)=>$(u,{xmin:x,zmin:s,xmax:U,zmax:_,subdivisions:W,precision:c,updatable:L},I),W.e.CreateGroundFromHeightMap=(u,x,s,U,_,W,c,I,L,J,k)=>H(u,x,{width:s,height:U,subdivisions:_,minHeight:W,maxHeight:c,updatable:L,onReady:J,alphaFilter:k},I)},673524:(u,x,s)=>{s.d(x,{NX:()=>j,dT:()=>r,e8:()=>J,nP:()=>k,sh:()=>d,uz:()=>i});var U=s(604910),_=s(27230),W=s(818696),c=s(85489),I=s(23987),L=s(706400);function J(u){const x=[],s=[],U=u.lines,_=u.colors,c=[];let I=0;for(let u=0;u<U.length;u++){const W=U[u];for(let U=0;U<W.length;U++){const{x:L,y:J,z:k}=W[U];if(s.push(L,J,k),_){const x=_[u],{r:s,g:W,b:I,a:L}=x[U];c.push(s,W,I,L)}U>0&&(x.push(I-1),x.push(I)),I++}}const L=new W.P;return L.indices=x,L.positions=s,_&&(L.colors=c),L}function k(u){const x=u.dashSize||3,s=u.gapSize||1,_=u.dashNb||200,c=u.points,I=[],L=[],J=U.Pq.Zero();let k=0,i=0,d=0,j=0,r=0,D=0,$=0;for($=0;$<c.length-1;$++)c[$+1].subtractToRef(c[$],J),k+=J.length();for(d=k/_,j=x*d/(x+s),$=0;$<c.length-1;$++){c[$+1].subtractToRef(c[$],J),i=Math.floor(J.length()/d),J.normalize();for(let u=0;u<i;u++)r=d*u,I.push(c[$].x+r*J.x,c[$].y+r*J.y,c[$].z+r*J.z),I.push(c[$].x+(r+j)*J.x,c[$].y+(r+j)*J.y,c[$].z+(r+j)*J.z),L.push(D,D+1),D+=2}const H=new W.P;return H.positions=I,H.indices=L,H}function i(u,x,s=null){const U=x.instance,_=x.lines,W=x.colors;if(U){const u=U.getVerticesData(I.R.PositionKind);let x,s;W&&(x=U.getVerticesData(I.R.ColorKind));let c=0,L=0;for(let U=0;U<_.length;U++){const I=_[U];for(let _=0;_<I.length;_++)u[c]=I[_].x,u[c+1]=I[_].y,u[c+2]=I[_].z,W&&x&&(s=W[U],x[L]=s[_].r,x[L+1]=s[_].g,x[L+2]=s[_].b,x[L+3]=s[_].a,L+=4),c+=3}return U.updateVerticesData(I.R.PositionKind,u,!1,!1),W&&x&&U.updateVerticesData(I.R.ColorKind,x,!1,!1),U.refreshBoundingInfo(),U}const L=!!W,k=new c.l(u,s,null,void 0,void 0,L,x.useVertexAlpha,x.material);return J(x).applyToMesh(k,x.updatable),k}function d(u,x,s=null){const U=x.colors?[x.colors]:null;return i(u,{lines:[x.points],updatable:x.updatable,instance:x.instance,colors:U,useVertexAlpha:x.useVertexAlpha,material:x.material},s)}function j(u,x,s=null){const W=x.points,I=x.instance,J=x.gapSize||1,i=x.dashSize||3;if(I){const u=u=>{const x=U.Pq.Zero(),s=u.length/6;let _=0,c=0,L=0,J=0,k=0,i=0,d=0,j=0;for(d=0;d<W.length-1;d++)W[d+1].subtractToRef(W[d],x),_+=x.length();L=_/s;const r=I._creationDataStorage.dashSize;for(J=r*L/(r+I._creationDataStorage.gapSize),d=0;d<W.length-1;d++)for(W[d+1].subtractToRef(W[d],x),c=Math.floor(x.length()/L),x.normalize(),j=0;j<c&&i<u.length;)k=L*j,u[i]=W[d].x+k*x.x,u[i+1]=W[d].y+k*x.y,u[i+2]=W[d].z+k*x.z,u[i+3]=W[d].x+(k+J)*x.x,u[i+4]=W[d].y+(k+J)*x.y,u[i+5]=W[d].z+(k+J)*x.z,i+=6,j++;for(;i<u.length;)u[i]=W[d].x,u[i+1]=W[d].y,u[i+2]=W[d].z,i+=3};return(x.dashNb||x.dashSize||x.gapSize||x.useVertexAlpha||x.material)&&L.V.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),I.updateMeshPositions(u,!1),I}const d=new c.l(u,s,null,void 0,void 0,void 0,x.useVertexAlpha,x.material);return k(x).applyToMesh(d,x.updatable),d._creationDataStorage=new _.Ez,d._creationDataStorage.dashSize=i,d._creationDataStorage.gapSize=J,d}const r={CreateDashedLines:j,CreateLineSystem:i,CreateLines:d};W.P.CreateLineSystem=J,W.P.CreateDashedLines=k,_.e.CreateLines=(u,x,s=null,U=!1,_=null)=>d(u,{points:x,updatable:U,instance:_},s),_.e.CreateDashedLines=(u,x,s,U,_,W=null,c,I)=>j(u,{points:x,dashSize:s,gapSize:U,dashNb:_,updatable:c,instance:I},W)},204771:(u,x,s)=>{s.d(x,{LG:()=>c,QX:()=>L,x:()=>I});var U=s(27230),_=s(818696),W=s(158548);function c(u){const x=[],s=[],U=[],c=[],I=u.width||u.size||1,L=u.height||u.size||1,J=0===u.sideOrientation?0:u.sideOrientation||_.P.DEFAULTSIDE,k=I/2,i=L/2;s.push(-k,-i,0),U.push(0,0,-1),c.push(0,W.rX?1:0),s.push(k,-i,0),U.push(0,0,-1),c.push(1,W.rX?1:0),s.push(k,i,0),U.push(0,0,-1),c.push(1,W.rX?0:1),s.push(-k,i,0),U.push(0,0,-1),c.push(0,W.rX?0:1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),_.P._ComputeSides(J,s,x,U,c,u.frontUVs,u.backUVs);const d=new _.P;return d.indices=x,d.positions=s,d.normals=U,d.uvs=c,d}function I(u,x={},s=null){const _=new U.e(u,s);return x.sideOrientation=U.e._GetDefaultSideOrientation(x.sideOrientation),_._originalBuilderSideOrientation=x.sideOrientation,c(x).applyToMesh(_,x.updatable),x.sourcePlane&&(_.translate(x.sourcePlane.normal,-x.sourcePlane.d),_.setDirection(x.sourcePlane.normal.scale(-1))),_}const L={CreatePlane:I};_.P.CreatePlane=c,U.e.CreatePlane=(u,x,s,U,_)=>I(u,{size:x,width:x,height:x,sideOrientation:_,updatable:U},s)},233687:(u,x,s)=>{s.d(x,{Er:()=>k,X:()=>L,fv:()=>J});var U=s(604910),_=s(27230),W=s(23987),c=s(818696),I=s(158548);function L(u){let x=u.pathArray;const s=u.closeArray||!1,U=u.closePath||!1,_=u.invertUV||!1,L=Math.floor(x[0].length/2);let J=u.offset||L;J=J>L?L:Math.floor(J);const k=0===u.sideOrientation?0:u.sideOrientation||c.P.DEFAULTSIDE,i=u.uvs,d=u.colors,j=[],r=[],D=[],$=[],H=[],f=[],O=[],t=[];let V;const N=[],m=[];let b,n,F;if(x.length<2){const u=[],s=[];for(n=0;n<x[0].length-J;n++)u.push(x[0][n]),s.push(x[0][n+J]);x=[u,s]}let B=0;const Z=U?1:0,v=s?1:0;let y,e,T,Q,E,l;for(V=x[0].length,b=0;b<x.length+v;b++){for(O[b]=0,H[b]=[0],y=b===x.length?x[0]:x[b],e=y.length,V=V<e?V:e,F=0;F<e;)j.push(y[F].x,y[F].y,y[F].z),F>0&&(T=y[F].subtract(y[F-1]).length(),Q=T+O[b],H[b].push(Q),O[b]=Q),F++;U&&(F--,j.push(y[0].x,y[0].y,y[0].z),T=y[F].subtract(y[0]).length(),Q=T+O[b],H[b].push(Q),O[b]=Q),N[b]=e+Z,m[b]=B,B+=e+Z}let z,S,R=null,X=null;for(n=0;n<V+Z;n++)for(t[n]=0,f[n]=[0],b=0;b<x.length-1+v;b++)E=x[b],l=b===x.length-1?x[0]:x[b+1],n===V?(R=E[0],X=l[0]):(R=E[n],X=l[n]),T=X.subtract(R).length(),Q=T+t[n],f[n].push(Q),t[n]=Q;if(i)for(b=0;b<i.length;b++)$.push(i[b].x,I.rX?1-i[b].y:i[b].y);else for(b=0;b<x.length+v;b++)for(n=0;n<V+Z;n++)z=0!=O[b]?H[b][n]/O[b]:0,S=0!=t[n]?f[n][b]/t[n]:0,_?$.push(S,z):$.push(z,I.rX?1-S:S);b=0;let p=0,G=N[b]-1,w=N[b+1]-1,h=G<w?G:w,P=m[1]-m[0];const o=N.length-1;for(;p<=h&&b<o;)r.push(p,p+P,p+1),r.push(p+P+1,p+1,p+P),p+=1,p===h&&(b++,P=m[b+1]-m[b],G=N[b]-1,w=N[b+1]-1,p=m[b],h=G<w?G+p:w+p);if(c.P.ComputeNormals(j,r,D),U){let u=0,s=0;for(b=0;b<x.length;b++){u=3*m[b],s=b+1<x.length?3*(m[b+1]-1):D.length-3,D[u]=.5*(D[u]+D[s]),D[u+1]=.5*(D[u+1]+D[s+1]),D[u+2]=.5*(D[u+2]+D[s+2]);const U=Math.sqrt(D[u]*D[u]+D[u+1]*D[u+1]+D[u+2]*D[u+2]);D[u]/=U,D[u+1]/=U,D[u+2]/=U,D[s]=D[u],D[s+1]=D[u+1],D[s+2]=D[u+2]}}if(s){let u=3*m[0],s=3*m[x.length];for(n=0;n<V+Z;n++){D[u]=.5*(D[u]+D[s]),D[u+1]=.5*(D[u+1]+D[s+1]),D[u+2]=.5*(D[u+2]+D[s+2]);const x=Math.sqrt(D[u]*D[u]+D[u+1]*D[u+1]+D[u+2]*D[u+2]);D[u]/=x,D[u+1]/=x,D[u+2]/=x,D[s]=D[u],D[s+1]=D[u+1],D[s+2]=D[u+2],u+=3,s+=3}}c.P._ComputeSides(k,j,r,D,$,u.frontUVs,u.backUVs);let C=null;if(d){C=new Float32Array(4*d.length);for(let u=0;u<d.length;u++)C[4*u]=d[u].r,C[4*u+1]=d[u].g,C[4*u+2]=d[u].b,C[4*u+3]=d[u].a}const K=new c.P,q=new Float32Array(j),Y=new Float32Array(D),g=new Float32Array($);return K.indices=r,K.positions=q,K.normals=Y,K.uvs=g,C&&K.set(C,W.R.ColorKind),U&&(K._idx=m),K}function J(u,x,s=null){const J=x.pathArray,k=x.closeArray,i=x.closePath,d=_.e._GetDefaultSideOrientation(x.sideOrientation),j=x.instance,r=x.updatable;if(j){const u=U.AA.Vector3[0].setAll(Number.MAX_VALUE),s=U.AA.Vector3[1].setAll(-Number.MAX_VALUE),L=x=>{let U=J[0].length;const W=j;let c=0;const I=W._originalBuilderSideOrientation===_.e.DOUBLESIDE?2:1;for(let _=1;_<=I;++_)for(let _=0;_<J.length;++_){const I=J[_],L=I.length;U=U<L?U:L;for(let _=0;_<U;++_){const U=I[_];x[c]=U.x,x[c+1]=U.y,x[c+2]=U.z,u.minimizeInPlaceFromFloats(U.x,U.y,U.z),s.maximizeInPlaceFromFloats(U.x,U.y,U.z),c+=3}if(W._creationDataStorage&&W._creationDataStorage.closePath){const u=I[0];x[c]=u.x,x[c+1]=u.y,x[c+2]=u.z,c+=3}}},k=j.getVerticesData(W.R.PositionKind);if(L(k),j.hasBoundingInfo?j.getBoundingInfo().reConstruct(u,s,j._worldMatrix):j.buildBoundingInfo(u,s,j._worldMatrix),j.updateVerticesData(W.R.PositionKind,k,!1,!1),x.colors){const u=j.getVerticesData(W.R.ColorKind);for(let s=0,U=0;s<x.colors.length;s++,U+=4){const _=x.colors[s];u[U]=_.r,u[U+1]=_.g,u[U+2]=_.b,u[U+3]=_.a}j.updateVerticesData(W.R.ColorKind,u,!1,!1)}if(x.uvs){const u=j.getVerticesData(W.R.UVKind);for(let s=0;s<x.uvs.length;s++)u[2*s]=x.uvs[s].x,u[2*s+1]=I.rX?1-x.uvs[s].y:x.uvs[s].y;j.updateVerticesData(W.R.UVKind,u,!1,!1)}if(!j.areNormalsFrozen||j.isFacetDataEnabled){const u=j.getIndices(),x=j.getVerticesData(W.R.NormalKind),s=j.isFacetDataEnabled?j.getFacetDataParameters():null;if(c.P.ComputeNormals(k,u,x,s),j._creationDataStorage&&j._creationDataStorage.closePath){let u=0,s=0;for(let U=0;U<J.length;U++)u=3*j._creationDataStorage.idx[U],s=U+1<J.length?3*(j._creationDataStorage.idx[U+1]-1):x.length-3,x[u]=.5*(x[u]+x[s]),x[u+1]=.5*(x[u+1]+x[s+1]),x[u+2]=.5*(x[u+2]+x[s+2]),x[s]=x[u],x[s+1]=x[u+1],x[s+2]=x[u+2]}j.areNormalsFrozen||j.updateVerticesData(W.R.NormalKind,x,!1,!1)}return j}{const U=new _.e(u,s);U._originalBuilderSideOrientation=d,U._creationDataStorage=new _.Ez;const W=L(x);return i&&(U._creationDataStorage.idx=W._idx),U._creationDataStorage.closePath=i,U._creationDataStorage.closeArray=k,W.applyToMesh(U,r),U}}const k={CreateRibbon:J};c.P.CreateRibbon=L,_.e.CreateRibbon=(u,x,s=!1,U,_,W,c=!1,I,L)=>J(u,{pathArray:x,closeArray:s,closePath:U,offset:_,updatable:c,sideOrientation:I,instance:L},W)},374134:(u,x,s)=>{s.d(x,{Vc:()=>k,ei:()=>L,tF:()=>I});var U=s(604910),_=s(27230),W=s(233687),c=s(808966);function I(u,x,s=null){const U=x.path,W=x.shape,c=x.scale||1,I=x.rotation||0,L=0===x.cap?0:x.cap||_.e.NO_CAP,k=x.updatable,i=_.e._GetDefaultSideOrientation(x.sideOrientation),d=x.instance||null,j=x.invertUV||!1,r=x.closeShape||!1;return J(u,W,U,c,I,null,null,x.closePath||!1,r,L,!1,s,!!k,i,d,j,x.frontUVs||null,x.backUVs||null,x.firstNormal||null,!!x.adjustFrame)}function L(u,x,s=null){const U=x.path,W=x.shape,c=x.scaleFunction||(()=>1),I=x.rotationFunction||(()=>0),L=x.closePath||x.ribbonCloseArray||!1,k=x.closeShape||x.ribbonClosePath||!1,i=0===x.cap?0:x.cap||_.e.NO_CAP,d=x.updatable,j=x.firstNormal||null,r=x.adjustFrame||!1;return J(u,W,U,null,null,c,I,L,k,i,!0,s,!!d,_.e._GetDefaultSideOrientation(x.sideOrientation),x.instance||null,x.invertUV||!1,x.frontUVs||null,x.backUVs||null,j,r)}function J(u,x,s,I,L,J,k,i,d,j,r,D,$,H,f,O,t,V,N,m){const b=(u,x,s,W,c,I,L,J,k,i,d)=>{const j=s.getTangents(),r=s.getNormals(),D=s.getBinormals(),$=s.getDistances();if(d)for(let u=0;u<j.length;u++)if(0==j[u].x&&0==j[u].y&&0==j[u].z&&j[u].copyFrom(j[u-1]),0==r[u].x&&0==r[u].y&&0==r[u].z&&r[u].copyFrom(r[u-1]),0==D[u].x&&0==D[u].y&&0==D[u].z&&D[u].copyFrom(D[u-1]),u>0){let x=j[u-1];U.Pq.Dot(x,j[u])<0&&j[u].scaleInPlace(-1),x=r[u-1],U.Pq.Dot(x,r[u])<0&&r[u].scaleInPlace(-1),x=D[u-1],U.Pq.Dot(x,D[u])<0&&D[u].scaleInPlace(-1)}let H=0;const f=i&&J?J:()=>null!==I?I:0,O=i&&L?L:()=>null!==c?c:1;let t=k===_.e.NO_CAP||k===_.e.CAP_END?0:2;const V=U.AA.Matrix[0];for(let s=0;s<x.length;s++){const _=[],c=f(s,$[s]),I=O(s,$[s]);U.uq.RotationAxisToRef(j[s],H,V);for(let W=0;W<u.length;W++){const c=j[s].scale(u[W].z).add(r[s].scale(u[W].x)).add(D[s].scale(u[W].y)),L=U.Pq.Zero();U.Pq.TransformCoordinatesToRef(c,V,L),L.scaleInPlace(I).addInPlace(x[s]),_[W]=L}W[t]=_,H+=c,t++}const N=u=>{const x=Array(),s=U.Pq.Zero();let _;for(_=0;_<u.length;_++)s.addInPlace(u[_]);for(s.scaleInPlace(1/u.length),_=0;_<u.length;_++)x.push(s);return x};switch(k){case _.e.NO_CAP:break;case _.e.CAP_START:W[0]=N(W[2]),W[1]=W[2];break;case _.e.CAP_END:W[t]=W[t-1],W[t+1]=N(W[t-1]);break;case _.e.CAP_ALL:W[0]=N(W[2]),W[1]=W[2],W[t]=W[t-1],W[t+1]=N(W[t-1])}return W};let n,F;if(f){const u=f._creationDataStorage;return n=N?u.path3D.update(s,N):u.path3D.update(s),F=b(x,s,u.path3D,u.pathArray,I,L,J,k,u.cap,r,m),W.fv("",{pathArray:F,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:f},D||void 0)}n=N?new c.tO(s,N):new c.tO(s),F=b(x,s,n,new Array,I,L,J,k,j=j<0||j>3?0:j,r,m);const B=W.fv(u,{pathArray:F,closeArray:i,closePath:d,updatable:$,sideOrientation:H,invertUV:O,frontUVs:t||void 0,backUVs:V||void 0},D);return B._creationDataStorage.pathArray=F,B._creationDataStorage.path3D=n,B._creationDataStorage.cap=j,B}const k={ExtrudeShape:I,ExtrudeShapeCustom:L};_.e.ExtrudeShape=(u,x,s,U,W,c,L=null,J,k,i)=>I(u,{shape:x,path:s,scale:U,rotation:W,cap:0===c?0:c||_.e.NO_CAP,sideOrientation:k,instance:i,updatable:J},L),_.e.ExtrudeShapeCustom=(u,x,s,U,W,c,I,J,k,i,d,j)=>L(u,{shape:x,path:s,scaleFunction:U,rotationFunction:W,ribbonCloseArray:c,ribbonClosePath:I,cap:0===J?0:J||_.e.NO_CAP,sideOrientation:d,instance:j,updatable:i},k)},922002:(u,x,s)=>{s.d(x,{YA:()=>L,qq:()=>I,vt:()=>J});var U=s(604910),_=s(27230),W=s(818696),c=s(158548);function I(u){const x=[],s=[],_=[],I=[],L=u.diameter||1,J=u.thickness||.5,k=0|(u.tessellation||16),i=0===u.sideOrientation?0:u.sideOrientation||W.P.DEFAULTSIDE,d=k+1;for(let u=0;u<=k;u++){const W=u/k,i=u*Math.PI*2/k-Math.PI/2,j=U.uq.Translation(L/2,0,0).multiply(U.uq.RotationY(i));for(let L=0;L<=k;L++){const i=1-L/k,r=L*Math.PI*2/k+Math.PI,D=Math.cos(r),$=Math.sin(r);let H=new U.Pq(D,$,0),f=H.scale(J/2);const O=new U.I9(W,i);f=U.Pq.TransformCoordinates(f,j),H=U.Pq.TransformNormal(H,j),s.push(f.x,f.y,f.z),_.push(H.x,H.y,H.z),I.push(O.x,c.rX?1-O.y:O.y);const t=(u+1)%d,V=(L+1)%d;x.push(u*d+L),x.push(u*d+V),x.push(t*d+L),x.push(u*d+V),x.push(t*d+V),x.push(t*d+L)}}W.P._ComputeSides(i,s,x,_,I,u.frontUVs,u.backUVs);const j=new W.P;return j.indices=x,j.positions=s,j.normals=_,j.uvs=I,j}function L(u,x={},s){const U=new _.e(u,s);return x.sideOrientation=_.e._GetDefaultSideOrientation(x.sideOrientation),U._originalBuilderSideOrientation=x.sideOrientation,I(x).applyToMesh(U,x.updatable),U}const J={CreateTorus:L};W.P.CreateTorus=I,_.e.CreateTorus=(u,x,s,U,_,W,c)=>L(u,{diameter:x,thickness:s,tessellation:U,sideOrientation:c,updatable:W},_)},672506:(u,x,s)=>{s.d(x,{A:()=>_});var U=s(389011);class _ extends U.n{constructor(u){super(),this._buffer=u}get underlyingResource(){return this._buffer}}},938868:(u,x,s)=>{s.d(x,{u:()=>m});var U=s(297809),_=s(638113),W=s(604910),c=s(23987),I=s(818696),L=s(633727),J=s(79160),k=s(59036),i=s(384898),d=s(775316),j=s(554014),r=s(755752),D=s(332290),$=s(779908),H=s(690096),f=s(310035),O=s(760998),t=s(33321);class V{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=W.Pq.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class N{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new V,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new d.j,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class m extends L.V{static get BILLBOARDMODE_NONE(){return L.V.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return L.V.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return L.V.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return L.V.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return L.V.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return L.V.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(u){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=u}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(u){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=u}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=u}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(u){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=u}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(u){this._internalAbstractMeshDataInfo._collisionRetryCount=u}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(u){this._internalAbstractMeshDataInfo._morphTargetManager!==u&&(this._internalAbstractMeshDataInfo._morphTargetManager=u,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(u){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==u&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=u,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(u){return!!super._updateNonUniformScalingState(u)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(u){this._internalAbstractMeshDataInfo._rawBoundingInfo=u}set onCollide(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(u)}set onCollisionPositionChange(u){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(u)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(u){if(this._internalAbstractMeshDataInfo._visibility===u)return;const x=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=u,(1===x&&1!==u||1!==x&&1===u)&&this._markSubMeshesAsDirty((u=>{u.markAsMiscDirty(),u.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(u){this._internalAbstractMeshDataInfo._inheritVisibility=u}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let u=this._parentNode;for(;u;){const x=u.isVisible;if(void 0!==x)return x;u=u.parent}}return this._isVisible}set isVisible(u){this._isVisible=u}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(u){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=u}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(u){this._internalAbstractMeshDataInfo._renderingGroupId=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){this._setMaterial(u)}_setMaterial(u){this._internalAbstractMeshDataInfo._material!==u&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=u,u&&u.meshMap&&(u.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(u){var x;return null===(x=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===x?void 0:x[u]}setMaterialForRenderPass(u,x){this.resetDrawCache(u),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[u]=x}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(u){this._internalAbstractMeshDataInfo._receiveShadows!==u&&(this._internalAbstractMeshDataInfo._receiveShadows=u,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(u){this._internalAbstractMeshDataInfo._hasVertexAlpha!==u&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=u,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(u){this._internalAbstractMeshDataInfo._useVertexColors!==u&&(this._internalAbstractMeshDataInfo._useVertexColors=u,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(u){this._internalAbstractMeshDataInfo._numBoneInfluencers!==u&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=u,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(u){this._internalAbstractMeshDataInfo._applyFog!==u&&(this._internalAbstractMeshDataInfo._applyFog=u,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(u){this._internalAbstractMeshDataInfo._enableDistantPicking=u}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(u){u!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=u,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(u)?-1:u}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=u}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(u){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(u)?-1:u}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(u){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=u}get lightSources(){return this._lightSources}set skeleton(u){const x=this._internalAbstractMeshDataInfo._skeleton;x&&x.needInitialSkinMatrix&&x._unregisterMeshWithPoseMatrix(this),u&&u.needInitialSkinMatrix&&u._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=u,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(u,x=null){switch(super(u,x,!1),this._internalAbstractMeshDataInfo=new N,this._waitingMaterialId=null,this.cullingStrategy=m.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,this.onCollideObservable=new _.cP,this.onCollisionPositionChangeObservable=new _.cP,this.onMaterialChangedObservable=new _.cP,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.isPickable=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=D.v9.Red(),this.outlineWidth=.02,this.overlayColor=D.v9.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.alwaysSelectAsActiveMesh=!1,this.doNotSyncBoundingInfo=!1,this.actionManager=null,this.ellipsoid=new W.Pq(.5,1,.5),this.ellipsoidOffset=new W.Pq(0,0,0),this.edgesWidth=1,this.edgesColor=new D.ov(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,freezeWorldMatrix:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new _.cP,this._onCollisionPositionChange=(u,x,s=null)=>{x.subtractToRef(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>t.$.CollisionsEpsilon&&this.position.addInPlace(this._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),s&&this.onCollideObservable.notifyObservers(s),this.onCollisionPositionChangeObservable.notifyObservers(this.position)},(x=this.getScene()).addMesh(this),this._resyncLightSources(),this._uniformBuffer=new i.D(this.getScene().getEngine(),void 0,void 0,u,!this.getScene().getEngine().isWebGPU),this._buildUniformLayout(),x.performancePriority){case 2:this.doNotSyncBoundingInfo=!0;case 1:this.alwaysSelectAsActiveMesh=!0,this.isPickable=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(u){const x=this._uniformBuffer;x.updateMatrix("world",u),x.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),x.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(u){let x="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");x+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);const s=this._internalAbstractMeshDataInfo._skeleton;return s&&(x+=", skeleton: "+s.name),u&&(x+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],x+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),x}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==L.V.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(u,x=!0){if(this.actionManager&&(x||this.actionManager.isRecursive)){if(!u)return this.actionManager;if(this.actionManager.hasSpecificTrigger(u))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_rebuild(u=!1){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes){for(const u of this.subMeshes)u._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const u of this.getScene().lights)u.isEnabled()&&u.canAffectMesh(this)&&this._lightSources.push(u);this._markSubMeshesAsLightDirty()}_resyncLightSource(u){const x=u.isEnabled()&&u.canAffectMesh(this),s=this._lightSources.indexOf(u);let U=!1;if(-1===s){if(!x)return;this._lightSources.push(u)}else{if(x)return;U=!0,this._lightSources.splice(s,1)}this._markSubMeshesAsLightDirty(U)}_unBindEffect(){for(const u of this.subMeshes)u.setEffect(null)}_removeLightSource(u,x){const s=this._lightSources.indexOf(u);-1!==s&&(this._lightSources.splice(s,1),this._markSubMeshesAsLightDirty(x))}_markSubMeshesAsDirty(u){if(this.subMeshes)for(const x of this.subMeshes)for(let s=0;s<x._drawWrappers.length;++s){const U=x._drawWrappers[s];U&&U.defines&&U.defines.markAllAsDirty&&u(U.defines)}}_markSubMeshesAsLightDirty(u=!1){this._markSubMeshesAsDirty((x=>x.markAsLightDirty(u)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((u=>u.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((u=>u.markAsMiscDirty()))}markAsDirty(u){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}resetDrawCache(u){if(this.subMeshes)for(const x of this.subMeshes)x.resetDrawCache(u)}get isBlocked(){return!1}getLOD(u){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}getIndices(){return null}getVerticesData(u){return null}setVerticesData(u,x,s,U){return this}updateVerticesData(u,x,s,U){return this}setIndices(u,x){return this}isVerticesDataPresent(u){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)}getRawBoundingInfo(){var u;return null!==(u=this.rawBoundingInfo)&&void 0!==u?u:this.getBoundingInfo()}setBoundingInfo(u){return this._boundingInfo=u,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(u,x,s){return this._boundingInfo=new k.j(u,x,s),this._boundingInfo}normalizeToUnitCube(u=!0,x=!1,s){return super.normalizeToUnitCube(u,x,s)}get useBones(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(c.R.MatricesIndicesKind)&&this.isVerticesDataPresent(c.R.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(u){}_activate(u,x){return this._renderId=u,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===L.V.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(u,x,s){return this.position.addInPlace(this.calcMovePOV(u,x,s)),this}calcMovePOV(u,x,s){const U=new W.uq;(this.rotationQuaternion?this.rotationQuaternion:W.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(U);const _=W.Pq.Zero(),c=this.definedFacingForward?-1:1;return W.Pq.TransformCoordinatesFromFloatsToRef(u*c,x,s*c,U,_),_}rotatePOV(u,x,s){return this.rotation.addInPlace(this.calcRotatePOV(u,x,s)),this}calcRotatePOV(u,x,s){const U=this.definedFacingForward?1:-1;return new W.Pq(u*U,x,s*U)}_refreshBoundingInfo(u,x){if(u){const s=r.b(u,0,this.getTotalVertices(),x);this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new k.j(s.minimum,s.maximum)}if(this.subMeshes)for(let x=0;x<this.subMeshes.length;x++)this.subMeshes[x].refreshBoundingInfo(u);this._updateBoundingInfo()}_refreshBoundingInfoDirect(u){if(this._boundingInfo?this._boundingInfo.reConstruct(u.minimum,u.maximum):this._boundingInfo=new k.j(u.minimum,u.maximum),this.subMeshes)for(let u=0;u<this.subMeshes.length;u++)this.subMeshes[u].refreshBoundingInfo(null);this._updateBoundingInfo()}static _ApplySkeleton(u,x,s,U,_,I,L){(function(u,x,s,U,_,I,L){const J=W.AA.Vector3[0],k=W.AA.Matrix[0],i=W.AA.Matrix[1],d=x===c.R.NormalKind?W.Pq.TransformNormalFromFloatsToRef:W.Pq.TransformCoordinatesFromFloatsToRef;for(let x=0,c=0;x<u.length;x+=3,c+=4){let j,r;for(k.reset(),j=0;j<4;j++)r=_[c+j],r>0&&(W.uq.FromFloat32ArrayToRefScaled(s,Math.floor(16*U[c+j]),r,i),k.addToSelf(i));if(I&&L)for(j=0;j<4;j++)r=L[c+j],r>0&&(W.uq.FromFloat32ArrayToRefScaled(s,Math.floor(16*I[c+j]),r,i),k.addToSelf(i));d(u[x],u[x+1],u[x+2],k,J),J.toArray(u,x)}})(u,x,s,U,_,I,L)}_getData(u,x,s=c.R.PositionKind){const U=u.cache,_=u=>{if(U){const x=U._vertexData||(U._vertexData={});return x[u]||this.copyVerticesData(u,x),x[u]}return this.getVerticesData(u)};if(x||(x=_(s)),!x)return null;if(U?(U._outputData?U._outputData.set(x):U._outputData=new Float32Array(x),x=U._outputData):(u.applyMorph&&this.morphTargetManager||u.applySkeleton&&this.skeleton)&&(x=x.slice()),u.applyMorph&&this.morphTargetManager&&function(u,x,s){let U=null;switch(x){case c.R.PositionKind:U=u=>u.getPositions();break;case c.R.NormalKind:U=u=>u.getNormals();break;case c.R.TangentKind:U=u=>u.getTangents();break;case c.R.UVKind:U=u=>u.getUVs();break;default:return}for(let x=0;x<u.length;x++){let _=u[x];for(let W=0;W<s.numTargets;W++){const c=s.getTarget(W),I=c.influence;if(0!==I){const s=U(c);s&&(_+=(s[x]-u[x])*I)}}u[x]=_}}(x,s,this.morphTargetManager),u.applySkeleton&&this.skeleton){const u=_(c.R.MatricesIndicesKind),U=_(c.R.MatricesWeightsKind);if(U&&u){const W=this.numBoneInfluencers>4,I=W?_(c.R.MatricesIndicesExtraKind):null,L=W?_(c.R.MatricesWeightsExtraKind):null,J=this.skeleton.getTransformMatrices(this);m._ApplySkeleton(x,s,J,u,U,I,L)}}if(!1!==u.updatePositionsArray&&s===c.R.PositionKind){const u=this._internalAbstractMeshDataInfo._positions||[],s=u.length;if(u.length=x.length/3,s<u.length)for(let x=s;x<u.length;x++)u[x]=new W.Pq;for(let s=0,U=0;s<u.length;s++,U+=3)u[s].copyFromFloats(x[U],x[U+1],x[U+2]);this._internalAbstractMeshDataInfo._positions=u}return x}getNormalsData(u=!1,x=!1){return this._getData({applySkeleton:u,applyMorph:x,updatePositionsArray:!1},null,c.R.NormalKind)}getPositionData(u=!1,x=!1,s=null){return this._getData({applySkeleton:u,applyMorph:x,updatePositionsArray:!1},s,c.R.PositionKind)}_updateBoundingInfo(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new k.j(W.Pq.Zero(),W.Pq.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(u){if(!this.subMeshes)return this;const x=this.subMeshes.length;for(let s=0;s<x;s++){const U=this.subMeshes[s];(x>1||!U.IsGlobal)&&U.updateBoundingInfo(u)}return this}_afterComputeWorldMatrix(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)}isInFrustum(u){return this.getBoundingInfo().isInFrustum(u,this.cullingStrategy)}isCompletelyInFrustum(u){return this.getBoundingInfo().isCompletelyInFrustum(u)}intersectsMesh(u,x=!1,s){const U=this.getBoundingInfo(),_=u.getBoundingInfo();if(U.intersects(_,x))return!0;if(s)for(const s of this.getChildMeshes())if(s.intersectsMesh(u,x,!0))return!0;return!1}intersectsPoint(u){return this.getBoundingInfo().intersectsPoint(u)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(u){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=u}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(u){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const x=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=x.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,x.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,u,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(u,x,s){var U;if(this._generatePointsArray(),!this._positions)return this;if(!u._lastColliderWorldVertices||!u._lastColliderTransformMatrix.equals(x)){u._lastColliderTransformMatrix=x.clone(),u._lastColliderWorldVertices=[],u._trianglePlanes=[];const s=u.verticesStart,U=u.verticesStart+u.verticesCount;for(let _=s;_<U;_++)u._lastColliderWorldVertices.push(W.Pq.TransformCoordinates(this._positions[_],x))}return s._collide(u._trianglePlanes,u._lastColliderWorldVertices,this.getIndices(),u.indexStart,u.indexStart+u.indexCount,u.verticesStart,!!u.getMaterial(),this,this._shouldConvertRHS(),7===(null===(U=u.getMaterial())||void 0===U?void 0:U.fillMode)),this}_processCollisionsForSubMeshes(u,x){const s=this._scene.getCollidingSubMeshCandidates(this,u),U=s.length;for(let _=0;_<U;_++){const W=s.data[_];U>1&&!W._checkCollision(u)||this._collideForSubMesh(W,x,u)}return this}_shouldConvertRHS(){return!1}_checkCollision(u){if(!this.getBoundingInfo()._checkCollision(u))return this;const x=W.AA.Matrix[0],s=W.AA.Matrix[1];return W.uq.ScalingToRef(1/u._radius.x,1/u._radius.y,1/u._radius.z,x),this.worldMatrixFromCache.multiplyToRef(x,s),this._processCollisionsForSubMeshes(u,s),this}_generatePointsArray(){return!1}intersects(u,x,s,U=!1,_,c=!1){const I=new J.G,L=this.getClassName(),k="InstancedLinesMesh"===L||"LinesMesh"===L||"GreasedLineMesh"===L?this.intersectionThreshold:0,i=this.getBoundingInfo();if(!this.subMeshes)return I;if(!(c||u.intersectsSphere(i.boundingSphere,k)&&u.intersectsBox(i.boundingBox,k)))return I;if(U)return I.hit=!c,I.pickedMesh=c?null:this,I.distance=c?0:W.Pq.Distance(u.origin,i.boundingSphere.center),I.subMeshId=0,I;if(!this._generatePointsArray())return I;let d=null;const j=this._scene.getIntersectingSubMeshCandidates(this,u),r=j.length;let D=!1;for(let u=0;u<r;u++){const x=j.data[u].getMaterial();if(x&&(7==x.fillMode||0==x.fillMode||1==x.fillMode||2==x.fillMode||4==x.fillMode)){D=!0;break}}if(!D)return I.hit=!0,I.pickedMesh=this,I.distance=W.Pq.Distance(u.origin,i.boundingSphere.center),I.subMeshId=-1,I;for(let U=0;U<r;U++){const _=j.data[U];if(r>1&&!c&&!_.canIntersects(u))continue;const W=_.intersects(u,this._positions,this.getIndices(),x,s);if(W&&(x||!d||W.distance<d.distance)&&(d=W,d.subMeshId=U,x))break}if(d){const x=null!=_?_:this.getWorldMatrix(),s=W.AA.Vector3[0],U=W.AA.Vector3[1];W.Pq.TransformCoordinatesToRef(u.origin,x,s),u.direction.scaleToRef(d.distance,U);const c=W.Pq.TransformNormal(U,x).addInPlace(s);return I.hit=!0,I.distance=W.Pq.Distance(s,c),I.pickedPoint=c,I.pickedMesh=this,I.bu=d.bu||0,I.bv=d.bv||0,I.subMeshFaceId=d.faceId,I.faceId=d.faceId+j.data[d.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),I.subMeshId=d.subMeshId,I}return I}clone(u,x,s){return null}releaseSubMeshes(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=[];return this}dispose(u,x=!1){let s;const U=this.getScene();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),U.freeActiveMeshes(),U.freeRenderingGroups(),U.renderingManager.maintainStateBetweenFrames&&U.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((u=>u!==this&&u.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),s=0;s<this._intersectionsInProgress.length;s++){const u=this._intersectionsInProgress[s],x=u._intersectionsInProgress.indexOf(this);u._intersectionsInProgress.splice(x,1)}this._intersectionsInProgress.length=0,U.lights.forEach((u=>{let x=u.includedOnlyMeshes.indexOf(this);-1!==x&&u.includedOnlyMeshes.splice(x,1),x=u.excludedMeshes.indexOf(this),-1!==x&&u.excludedMeshes.splice(x,1);const s=u.getShadowGenerators();if(s){const u=s.values();for(let s=u.next();!0!==s.done;s=u.next()){const u=s.value.getShadowMap();u&&u.renderList&&(x=u.renderList.indexOf(this),-1!==x&&u.renderList.splice(x,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const _=U.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,_.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),_.wipeCaches(),U.removeMesh(this),this._parentContainer){const u=this._parentContainer.meshes.indexOf(this);u>-1&&this._parentContainer.meshes.splice(u,1),this._parentContainer=null}if(x&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!u)for(s=0;s<U.particleSystems.length;s++)U.particleSystems[s].emitter===this&&(U.particleSystems[s].dispose(),s--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(u,x)}_initFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetNormals||(u.facetNormals=[]),u.facetPositions||(u.facetPositions=[]),u.facetPartitioning||(u.facetPartitioning=new Array),u.facetNb=this.getIndices().length/3|0,u.partitioningSubdivisions=u.partitioningSubdivisions?u.partitioningSubdivisions:10,u.partitioningBBoxRatio=u.partitioningBBoxRatio?u.partitioningBBoxRatio:1.01;for(let x=0;x<u.facetNb;x++)u.facetNormals[x]=W.Pq.Zero(),u.facetPositions[x]=W.Pq.Zero();return u.facetDataEnabled=!0,this}updateFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;u.facetDataEnabled||this._initFacetData();const x=this.getVerticesData(c.R.PositionKind),s=this.getIndices(),U=this.getVerticesData(c.R.NormalKind),_=this.getBoundingInfo();if(u.facetDepthSort&&!u.facetDepthSortEnabled){if(u.facetDepthSortEnabled=!0,s instanceof Uint16Array)u.depthSortedIndices=new Uint16Array(s);else if(s instanceof Uint32Array)u.depthSortedIndices=new Uint32Array(s);else{let x=!1;for(let u=0;u<s.length;u++)if(s[u]>65535){x=!0;break}u.depthSortedIndices=x?new Uint32Array(s):new Uint16Array(s)}if(u.facetDepthSortFunction=function(u,x){return x.sqDistance-u.sqDistance},!u.facetDepthSortFrom){const x=this.getScene().activeCamera;u.facetDepthSortFrom=x?x.position:W.Pq.Zero()}u.depthSortedFacets=[];for(let x=0;x<u.facetNb;x++){const s={ind:3*x,sqDistance:0};u.depthSortedFacets.push(s)}u.invertedMatrix=W.uq.Identity(),u.facetDepthSortOrigin=W.Pq.Zero()}u.bbSize.x=_.maximum.x-_.minimum.x>$.bH?_.maximum.x-_.minimum.x:$.bH,u.bbSize.y=_.maximum.y-_.minimum.y>$.bH?_.maximum.y-_.minimum.y:$.bH,u.bbSize.z=_.maximum.z-_.minimum.z>$.bH?_.maximum.z-_.minimum.z:$.bH;let L=u.bbSize.x>u.bbSize.y?u.bbSize.x:u.bbSize.y;if(L=L>u.bbSize.z?L:u.bbSize.z,u.subDiv.max=u.partitioningSubdivisions,u.subDiv.X=Math.floor(u.subDiv.max*u.bbSize.x/L),u.subDiv.Y=Math.floor(u.subDiv.max*u.bbSize.y/L),u.subDiv.Z=Math.floor(u.subDiv.max*u.bbSize.z/L),u.subDiv.X=u.subDiv.X<1?1:u.subDiv.X,u.subDiv.Y=u.subDiv.Y<1?1:u.subDiv.Y,u.subDiv.Z=u.subDiv.Z<1?1:u.subDiv.Z,u.facetParameters.facetNormals=this.getFacetLocalNormals(),u.facetParameters.facetPositions=this.getFacetLocalPositions(),u.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),u.facetParameters.bInfo=_,u.facetParameters.bbSize=u.bbSize,u.facetParameters.subDiv=u.subDiv,u.facetParameters.ratio=this.partitioningBBoxRatio,u.facetParameters.depthSort=u.facetDepthSort,u.facetDepthSort&&u.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(u.invertedMatrix),W.Pq.TransformCoordinatesToRef(u.facetDepthSortFrom,u.invertedMatrix,u.facetDepthSortOrigin),u.facetParameters.distanceTo=u.facetDepthSortOrigin),u.facetParameters.depthSortedFacets=u.depthSortedFacets,U&&I.P.ComputeNormals(x,s,U,u.facetParameters),u.facetDepthSort&&u.facetDepthSortEnabled){u.depthSortedFacets.sort(u.facetDepthSortFunction);const x=u.depthSortedIndices.length/3|0;for(let U=0;U<x;U++){const x=u.depthSortedFacets[U].ind;u.depthSortedIndices[3*U]=s[x],u.depthSortedIndices[3*U+1]=s[x+1],u.depthSortedIndices[3*U+2]=s[x+2]}this.updateIndices(u.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetNormals||this.updateFacetData(),u.facetNormals}getFacetLocalPositions(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPositions||this.updateFacetData(),u.facetPositions}getFacetLocalPartitioning(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetPartitioning||this.updateFacetData(),u.facetPartitioning}getFacetPosition(u){const x=W.Pq.Zero();return this.getFacetPositionToRef(u,x),x}getFacetPositionToRef(u,x){const s=this.getFacetLocalPositions()[u],U=this.getWorldMatrix();return W.Pq.TransformCoordinatesToRef(s,U,x),this}getFacetNormal(u){const x=W.Pq.Zero();return this.getFacetNormalToRef(u,x),x}getFacetNormalToRef(u,x){const s=this.getFacetLocalNormals()[u];return W.Pq.TransformNormalToRef(s,this.getWorldMatrix(),x),this}getFacetsAtLocalCoordinates(u,x,s){const U=this.getBoundingInfo(),_=this._internalAbstractMeshDataInfo._facetData,W=Math.floor((u-U.minimum.x*_.partitioningBBoxRatio)*_.subDiv.X*_.partitioningBBoxRatio/_.bbSize.x),c=Math.floor((x-U.minimum.y*_.partitioningBBoxRatio)*_.subDiv.Y*_.partitioningBBoxRatio/_.bbSize.y),I=Math.floor((s-U.minimum.z*_.partitioningBBoxRatio)*_.subDiv.Z*_.partitioningBBoxRatio/_.bbSize.z);return W<0||W>_.subDiv.max||c<0||c>_.subDiv.max||I<0||I>_.subDiv.max?null:_.facetPartitioning[W+_.subDiv.max*c+_.subDiv.max*_.subDiv.max*I]}getClosestFacetAtCoordinates(u,x,s,U,_=!1,c=!0){const I=this.getWorldMatrix(),L=W.AA.Matrix[5];I.invertToRef(L);const J=W.AA.Vector3[8];W.Pq.TransformCoordinatesFromFloatsToRef(u,x,s,L,J);const k=this.getClosestFacetAtLocalCoordinates(J.x,J.y,J.z,U,_,c);return U&&W.Pq.TransformCoordinatesFromFloatsToRef(U.x,U.y,U.z,I,U),k}getClosestFacetAtLocalCoordinates(u,x,s,U,_=!1,W=!0){let c=null,I=0,L=0,J=0,k=0,i=0,d=0,j=0,r=0;const D=this.getFacetLocalPositions(),$=this.getFacetLocalNormals(),H=this.getFacetsAtLocalCoordinates(u,x,s);if(!H)return null;let f,O,t,V=Number.MAX_VALUE,N=V;for(let m=0;m<H.length;m++)f=H[m],O=$[f],t=D[f],k=(u-t.x)*O.x+(x-t.y)*O.y+(s-t.z)*O.z,(!_||_&&W&&k>=0||_&&!W&&k<=0)&&(k=O.x*t.x+O.y*t.y+O.z*t.z,i=-(O.x*u+O.y*x+O.z*s-k)/(O.x*O.x+O.y*O.y+O.z*O.z),d=u+O.x*i,j=x+O.y*i,r=s+O.z*i,I=d-u,L=j-x,J=r-s,N=I*I+L*L+J*J,N<V&&(V=N,c=f,U&&(U.x=d,U.y=j,U.z=r)));return c}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const u=this._internalAbstractMeshDataInfo._facetData;return u.facetDataEnabled&&(u.facetDataEnabled=!1,u.facetPositions=[],u.facetNormals=[],u.facetPartitioning=new Array,u.facetParameters=null,u.depthSortedIndices=new Uint32Array(0)),this}updateIndices(u,x,s=!1){return this}createNormals(u){const x=this.getVerticesData(c.R.PositionKind),s=this.getIndices();let U;return U=this.isVerticesDataPresent(c.R.NormalKind)?this.getVerticesData(c.R.NormalKind):[],I.P.ComputeNormals(x,s,U,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(c.R.NormalKind,U,u),this}alignWithNormal(u,x){x||(x=H._0.Y);const s=W.AA.Vector3[0],U=W.AA.Vector3[1];return W.Pq.CrossToRef(x,u,U),W.Pq.CrossToRef(u,U,s),this.rotationQuaternion?W.PT.RotationQuaternionFromAxisToRef(s,u,U,this.rotationQuaternion):W.Pq.RotationFromAxisToRef(s,u,U,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw j.n("EdgesRenderer")}enableEdgesRendering(u,x,s){throw j.n("EdgesRenderer")}getConnectedParticleSystems(){return this._scene.particleSystems.filter((u=>u.emitter===this))}}m.OCCLUSION_TYPE_NONE=0,m.OCCLUSION_TYPE_OPTIMISTIC=1,m.OCCLUSION_TYPE_STRICT=2,m.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,m.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,m.CULLINGSTRATEGY_STANDARD=0,m.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,m.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,U.Cg([O.Cx.filter(((...[u,x,s,U,_])=>!(Array.isArray(u)||Array.isArray(x)||Array.isArray(s)||Array.isArray(U)||Array.isArray(_))))],m,"_ApplySkeleton",null),f.Y5("BABYLON.AbstractMesh",m)},742631:(u,x,s)=>{s.d(x,{V:()=>$});var U=s(604910),_=s(332290),W=s(818696),c=s(23987),I=s(374216),L=s(396574),J=s(59036),k=s(898973),i=s(443401),d=s(755752),j=s(395726),r=s(158548),D=s(174290);class ${get boundingBias(){return this._boundingBias}set boundingBias(u){this._boundingBias?this._boundingBias.copyFrom(u):this._boundingBias=u.clone(),this._updateBoundingInfo(!0,null)}static CreateGeometryForMesh(u){const x=new $($.RandomId(),u.getScene());return x.applyToMesh(u),x}get meshes(){return this._meshes}constructor(u,x,s,U=!1,_=null){this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=x||j.q.LastCreatedScene,this._scene&&(this.id=u,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=U,s?this.setAllVerticesData(s,U):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),_&&(this.applyToMesh(_),_.computeWorldMatrix(!0)))}get extend(){return this._extend}getScene(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let u=0;u<this._meshes.length;u++)if(!this._meshes[u].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const u=new Set;for(const x in this._vertexBuffers)u.add(this._vertexBuffers[x].getWrapperBuffer());u.forEach((u=>{u._rebuild()}))}setAllVerticesData(u,x){u.applyToGeometry(this,x),this._notifyUpdate()}setVerticesData(u,x,s=!1,U){s&&Array.isArray(x)&&(x=new Float32Array(x));const _=new c.R(this._engine,x,u,{updatable:s,postponeInternalCreation:0===this._meshes.length,stride:U,label:"Geometry_"+this.id+"_"+u});this.setVerticesBuffer(_)}removeVerticesData(u){this._vertexBuffers[u]&&(this._vertexBuffers[u].dispose(),delete this._vertexBuffers[u]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(u,x=null,s=!0){const _=u.getKind();this._vertexBuffers[_]&&s&&this._vertexBuffers[_].dispose(),u._buffer&&u._buffer._increaseReferences(),this._vertexBuffers[_]=u;const W=this._meshes,I=W.length;if(_===c.R.PositionKind){this._totalVertices=null!=x?x:u._maxVerticesCount,this._updateExtend(u.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const s=this._extend&&this._extend.minimum||new U.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),_=this._extend&&this._extend.maximum||new U.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let u=0;u<I;u++){const x=W[u];x.buildBoundingInfo(s,_),x._createGlobalSubMesh(x.isUnIndexed),x.computeWorldMatrix(!0),x.synchronizeInstances()}}this._notifyUpdate(_)}updateVerticesDataDirectly(u,x,s,U=!1){const _=this.getVertexBuffer(u);_&&(_.updateDirectly(x,s,U),this._notifyUpdate(u))}updateVerticesData(u,x,s=!1){const U=this.getVertexBuffer(u);U&&(U.update(x),u===c.R.PositionKind&&this._updateBoundingInfo(s,x),this._notifyUpdate(u))}_updateBoundingInfo(u,x){if(u&&this._updateExtend(x),this._resetPointsArrayCache(),u){const u=this._meshes;for(const x of u){x.hasBoundingInfo?x.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):x.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const u=x.subMeshes;for(const x of u)x.refreshBoundingInfo()}}}_bind(u,x,s,U){if(!u)return;void 0===x&&(x=this._indexBuffer);const _=this.getVertexBuffers();if(!_)return;if(x!=this._indexBuffer||!this._vertexArrayObjects&&!U)return void this._engine.bindBuffers(_,x,u,s);const W=U||this._vertexArrayObjects,c=this._engine;W[u.key]||(W[u.key]=c.recordVertexArrayObject(_,x,u,s)),c.bindVertexArrayObject(W[u.key],x)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(u,x,s){const U=this.getVertexBuffer(u);return U?U.getFloatData(this._totalVertices,s||x&&1!==this._meshes.length):null}copyVerticesData(u,x){const s=this.getVertexBuffer(u);if(!s)return;x[u]||(x[u]=new Float32Array(this._totalVertices*s.getSize()));const U=s.getData();U&&D.g(U,s.getSize(),s.type,s.byteOffset,s.byteStride,s.normalized,this._totalVertices,x[u])}isVertexBufferUpdatable(u){const x=this._vertexBuffers[u];return!!x&&x.isUpdatable()}getVertexBuffer(u){return this.isReady()?this._vertexBuffers[u]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(u){return this._vertexBuffers?void 0!==this._vertexBuffers[u]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}getVerticesDataKinds(){const u=[];let x;if(!this._vertexBuffers&&this._delayInfo)for(x in this._delayInfo)u.push(x);else for(x in this._vertexBuffers)u.push(x);return u}updateIndices(u,x,s=!1){if(this._indexBuffer)if(this._indexBufferIsUpdatable){const U=u.length!==this._indices.length;if(s||(this._indices=u.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,u,x),U)for(const u of this._meshes)u._createGlobalSubMesh(!0)}else this.setIndices(u,null,!0)}setIndexBuffer(u,x,s){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=u,this._totalVertices=x,this._totalIndices=s,u.is32Bits||(u.is32Bits=this._totalIndices>65535);for(const u of this._meshes)u._createGlobalSubMesh(!0),u.synchronizeInstances();this._notifyUpdate()}setIndices(u,x=null,s=!1){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=u,this._indexBufferIsUpdatable=s,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,s,"Geometry_"+this.id+"_IndexBuffer")),null!=x&&(this._totalVertices=x);for(const u of this._meshes)u._createGlobalSubMesh(!0),u.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}getIndices(u,x){if(!this.isReady())return null;const s=this._indices;return x||u&&1!==this._meshes.length?s.slice():s}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(u=null){u&&this._vertexArrayObjects&&this._vertexArrayObjects[u.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[u.key]),delete this._vertexArrayObjects[u.key])}releaseForMesh(u,x){const s=this._meshes,U=s.indexOf(u);-1!==U&&(s.splice(U,1),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject(),u._geometry=null,0===s.length&&x&&this.dispose())}applyToMesh(u){if(u._geometry===this)return;const x=u._geometry;x&&x.releaseForMesh(u),this._vertexArrayObjects&&u._invalidateInstanceVertexArrayObject();const s=this._meshes;u._geometry=this,u._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),s.push(u),this.isReady()?this._applyToMesh(u):this._boundingInfo&&u.setBoundingInfo(this._boundingInfo)}_updateExtend(u=null){if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!u&&!(u=this.getVerticesData(c.R.PositionKind)))return;this._extend=d.b(u,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(u){const x=this._meshes.length;for(const s in this._vertexBuffers)1===x&&this._vertexBuffers[s].create(),s===c.R.PositionKind&&(this._extend||this._updateExtend(),u.buildBoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(u.isUnIndexed),u._updateBoundingInfo());1===x&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),u._syncGeometryWithMorphTargetManager(),u.synchronizeInstances()}_notifyUpdate(u){this.onGeometryUpdated&&this.onGeometryUpdated(this,u),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const u of this._meshes)u._markSubMeshesAsAttributesDirty()}load(u,x){2!==this.delayLoadState&&(this.isReady()?x&&x():(this.delayLoadState=2,this._queueLoad(u,x)))}_queueLoad(u,x){this.delayLoadingFile&&(u.addPendingData(this),u._loadFile(this.delayLoadingFile,(s=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(s),this),this.delayLoadState=1,this._delayInfo=[],u.removePendingData(this);const U=this._meshes,_=U.length;for(let u=0;u<_;u++)this._applyToMesh(U[u]);x&&x()}),void 0,!0))}toLeftHanded(){const u=this.getIndices(!1);if(null!=u&&u.length>0){for(let x=0;x<u.length;x+=3){const s=u[x+0];u[x+0]=u[x+2],u[x+2]=s}this.setIndices(u)}const x=this.getVerticesData(c.R.PositionKind,!1);if(null!=x&&x.length>0){for(let u=0;u<x.length;u+=3)x[u+2]=-x[u+2];this.setVerticesData(c.R.PositionKind,x,!1)}const s=this.getVerticesData(c.R.NormalKind,!1);if(null!=s&&s.length>0){for(let u=0;u<s.length;u+=3)s[u+2]=-s[u+2];this.setVerticesData(c.R.NormalKind,s,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const u=this.getVerticesData(c.R.PositionKind);if(!u||0===u.length)return!1;for(let x=3*this._positionsCache.length,s=this._positionsCache.length;x<u.length;x+=3,++s)this._positionsCache[s]=U.Pq.FromArray(u,x);for(let x=0,s=0;x<u.length;x+=3,++s)this._positionsCache[s].set(u[0+x],u[1+x],u[2+x]);return this._positionsCache.length=u.length/3,this._positions=this._positionsCache,!0}isDisposed(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const u in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[u]);this._vertexArrayObjects={};const u=this._meshes,x=u.length;for(let s=0;s<x;s++)u[s]._invalidateInstanceVertexArrayObject()}}dispose(){const u=this._meshes,x=u.length;let s;for(s=0;s<x;s++)this.releaseForMesh(u[s]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const u in this._vertexBuffers)this._vertexBuffers[u].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const u=this._parentContainer.geometries.indexOf(this);u>-1&&this._parentContainer.geometries.splice(u,1),this._parentContainer=null}this._isDisposed=!0}copy(u){const x=new W.P;x.indices=[];const s=this.getIndices();if(s)for(let u=0;u<s.length;u++)x.indices.push(s[u]);let U,_=!1,c=!1;for(U in this._vertexBuffers){const u=this.getVerticesData(U);if(u&&(u instanceof Float32Array?x.set(new Float32Array(u),U):x.set(u.slice(0),U),!c)){const u=this.getVertexBuffer(U);u&&(_=u.isUpdatable(),c=!_)}}const I=new $(u,this._scene,x,_);for(U in I.delayLoadState=this.delayLoadState,I.delayLoadingFile=this.delayLoadingFile,I._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)I._delayInfo=I._delayInfo||[],I._delayInfo.push(U);return I._boundingInfo=new J.j(this._extend.minimum,this._extend.maximum),I}serialize(){const u={};return u.id=this.id,u.uniqueId=this.uniqueId,u.updatable=this._updatable,i.Y&&i.Y.HasTags(this)&&(u.tags=i.Y.GetTags(this)),u}_toNumberArray(u){return Array.isArray(u)?u:Array.prototype.slice.call(u)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const u in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,u)&&(this._vertexBuffers[u]._buffer._data=null)}serializeVerticeData(){const u=this.serialize();return this.isVerticesDataPresent(c.R.PositionKind)&&(u.positions=this._toNumberArray(this.getVerticesData(c.R.PositionKind)),this.isVertexBufferUpdatable(c.R.PositionKind)&&(u.positions._updatable=!0)),this.isVerticesDataPresent(c.R.NormalKind)&&(u.normals=this._toNumberArray(this.getVerticesData(c.R.NormalKind)),this.isVertexBufferUpdatable(c.R.NormalKind)&&(u.normals._updatable=!0)),this.isVerticesDataPresent(c.R.TangentKind)&&(u.tangents=this._toNumberArray(this.getVerticesData(c.R.TangentKind)),this.isVertexBufferUpdatable(c.R.TangentKind)&&(u.tangents._updatable=!0)),this.isVerticesDataPresent(c.R.UVKind)&&(u.uvs=this._toNumberArray(this.getVerticesData(c.R.UVKind)),this.isVertexBufferUpdatable(c.R.UVKind)&&(u.uvs._updatable=!0)),this.isVerticesDataPresent(c.R.UV2Kind)&&(u.uvs2=this._toNumberArray(this.getVerticesData(c.R.UV2Kind)),this.isVertexBufferUpdatable(c.R.UV2Kind)&&(u.uvs2._updatable=!0)),this.isVerticesDataPresent(c.R.UV3Kind)&&(u.uvs3=this._toNumberArray(this.getVerticesData(c.R.UV3Kind)),this.isVertexBufferUpdatable(c.R.UV3Kind)&&(u.uvs3._updatable=!0)),this.isVerticesDataPresent(c.R.UV4Kind)&&(u.uvs4=this._toNumberArray(this.getVerticesData(c.R.UV4Kind)),this.isVertexBufferUpdatable(c.R.UV4Kind)&&(u.uvs4._updatable=!0)),this.isVerticesDataPresent(c.R.UV5Kind)&&(u.uvs5=this._toNumberArray(this.getVerticesData(c.R.UV5Kind)),this.isVertexBufferUpdatable(c.R.UV5Kind)&&(u.uvs5._updatable=!0)),this.isVerticesDataPresent(c.R.UV6Kind)&&(u.uvs6=this._toNumberArray(this.getVerticesData(c.R.UV6Kind)),this.isVertexBufferUpdatable(c.R.UV6Kind)&&(u.uvs6._updatable=!0)),this.isVerticesDataPresent(c.R.ColorKind)&&(u.colors=this._toNumberArray(this.getVerticesData(c.R.ColorKind)),this.isVertexBufferUpdatable(c.R.ColorKind)&&(u.colors._updatable=!0)),this.isVerticesDataPresent(c.R.MatricesIndicesKind)&&(u.matricesIndices=this._toNumberArray(this.getVerticesData(c.R.MatricesIndicesKind)),u.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(c.R.MatricesIndicesKind)&&(u.matricesIndices._updatable=!0)),this.isVerticesDataPresent(c.R.MatricesWeightsKind)&&(u.matricesWeights=this._toNumberArray(this.getVerticesData(c.R.MatricesWeightsKind)),this.isVertexBufferUpdatable(c.R.MatricesWeightsKind)&&(u.matricesWeights._updatable=!0)),u.indices=this._toNumberArray(this.getIndices()),u}static ExtractFromMesh(u,x){const s=u._geometry;return s?s.copy(x):null}static RandomId(){return k.S0.RandomId()}static _GetGeometryByLoadedUniqueId(u,x){for(let s=0;s<x.geometries.length;s++)if(x.geometries[s]._loadedUniqueId===u)return x.geometries[s];return null}static _ImportGeometry(u,x){const s=x.getScene(),U=u.geometryUniqueId,W=u.geometryId;if(U||W){const u=U?this._GetGeometryByLoadedUniqueId(U,s):s.getGeometryById(W);u&&u.applyToMesh(x)}else if(u instanceof ArrayBuffer){const s=x._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){const U=new Float32Array(u,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);x.setVerticesData(c.R.PositionKind,U,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){const U=new Float32Array(u,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);x.setVerticesData(c.R.NormalKind,U,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){const U=new Float32Array(u,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);x.setVerticesData(c.R.TangentKind,U,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){const U=new Float32Array(u,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UVKind,U,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){const U=new Float32Array(u,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UV2Kind,U,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){const U=new Float32Array(u,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UV3Kind,U,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){const U=new Float32Array(u,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UV4Kind,U,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){const U=new Float32Array(u,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UV5Kind,U,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){const U=new Float32Array(u,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);if(r.rX)for(let u=1;u<U.length;u+=2)U[u]=1-U[u];x.setVerticesData(c.R.UV6Kind,U,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){const U=new Float32Array(u,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);x.setVerticesData(c.R.ColorKind,U,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){const U=new Int32Array(u,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),_=[];for(let u=0;u<U.length;u++){const x=U[u];_.push(255&x),_.push((65280&x)>>8),_.push((16711680&x)>>16),_.push(x>>24&255)}x.setVerticesData(c.R.MatricesIndicesKind,_,!1)}if(s.matricesIndicesExtraAttrDesc&&s.matricesIndicesExtraAttrDesc.count>0){const U=new Int32Array(u,s.matricesIndicesExtraAttrDesc.offset,s.matricesIndicesExtraAttrDesc.count),_=[];for(let u=0;u<U.length;u++){const x=U[u];_.push(255&x),_.push((65280&x)>>8),_.push((16711680&x)>>16),_.push(x>>24&255)}x.setVerticesData(c.R.MatricesIndicesExtraKind,_,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){const U=new Float32Array(u,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);x.setVerticesData(c.R.MatricesWeightsKind,U,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){const U=new Int32Array(u,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);x.setIndices(U,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){const U=new Int32Array(u,s.subMeshesAttrDesc.offset,5*s.subMeshesAttrDesc.count);x.subMeshes=[];for(let u=0;u<s.subMeshesAttrDesc.count;u++){const s=U[5*u+0],_=U[5*u+1],W=U[5*u+2],c=U[5*u+3],L=U[5*u+4];I.K.AddToMesh(s,_,W,c,L,x)}}}else if(u.positions&&u.normals&&u.indices){if(x.setVerticesData(c.R.PositionKind,u.positions,u.positions._updatable),x.setVerticesData(c.R.NormalKind,u.normals,u.normals._updatable),u.tangents&&x.setVerticesData(c.R.TangentKind,u.tangents,u.tangents._updatable),u.uvs&&x.setVerticesData(c.R.UVKind,u.uvs,u.uvs._updatable),u.uvs2&&x.setVerticesData(c.R.UV2Kind,u.uvs2,u.uvs2._updatable),u.uvs3&&x.setVerticesData(c.R.UV3Kind,u.uvs3,u.uvs3._updatable),u.uvs4&&x.setVerticesData(c.R.UV4Kind,u.uvs4,u.uvs4._updatable),u.uvs5&&x.setVerticesData(c.R.UV5Kind,u.uvs5,u.uvs5._updatable),u.uvs6&&x.setVerticesData(c.R.UV6Kind,u.uvs6,u.uvs6._updatable),u.colors&&x.setVerticesData(c.R.ColorKind,_.ov.CheckColors4(u.colors,u.positions.length/3),u.colors._updatable),u.matricesIndices)if(u.matricesIndices._isExpanded)delete u.matricesIndices._isExpanded,x.setVerticesData(c.R.MatricesIndicesKind,u.matricesIndices,u.matricesIndices._updatable);else{const s=[];for(let x=0;x<u.matricesIndices.length;x++){const U=u.matricesIndices[x];s.push(255&U),s.push((65280&U)>>8),s.push((16711680&U)>>16),s.push(U>>24&255)}x.setVerticesData(c.R.MatricesIndicesKind,s,u.matricesIndices._updatable)}if(u.matricesIndicesExtra)if(u.matricesIndicesExtra._isExpanded)delete u.matricesIndices._isExpanded,x.setVerticesData(c.R.MatricesIndicesExtraKind,u.matricesIndicesExtra,u.matricesIndicesExtra._updatable);else{const s=[];for(let x=0;x<u.matricesIndicesExtra.length;x++){const U=u.matricesIndicesExtra[x];s.push(255&U),s.push((65280&U)>>8),s.push((16711680&U)>>16),s.push(U>>24&255)}x.setVerticesData(c.R.MatricesIndicesExtraKind,s,u.matricesIndicesExtra._updatable)}u.matricesWeights&&($._CleanMatricesWeights(u,x),x.setVerticesData(c.R.MatricesWeightsKind,u.matricesWeights,u.matricesWeights._updatable)),u.matricesWeightsExtra&&x.setVerticesData(c.R.MatricesWeightsExtraKind,u.matricesWeightsExtra,u.matricesWeights._updatable),x.setIndices(u.indices,null)}if(u.subMeshes){x.subMeshes=[];for(let s=0;s<u.subMeshes.length;s++){const U=u.subMeshes[s];I.K.AddToMesh(U.materialIndex,U.verticesStart,U.verticesCount,U.indexStart,U.indexCount,x)}}x._shouldGenerateFlatShading&&(x.convertToFlatShadedMesh(),x._shouldGenerateFlatShading=!1),x.computeWorldMatrix(!0),s.onMeshImportedObservable.notifyObservers(x)}static _CleanMatricesWeights(u,x){const s=.001;if(!L.B.CleanBoneMatrixWeights)return;let U=0;if(!(u.skeletonId>-1))return;{const s=x.getScene().getLastSkeletonById(u.skeletonId);if(!s)return;U=s.bones.length}const _=x.getVerticesData(c.R.MatricesIndicesKind),W=x.getVerticesData(c.R.MatricesIndicesExtraKind),I=u.matricesWeights,J=u.matricesWeightsExtra,k=u.numBoneInfluencer,i=I.length;for(let u=0;u<i;u+=4){let x=0,c=-1;for(let U=0;U<4;U++){const _=I[u+U];x+=_,_<s&&c<0&&(c=U)}if(J)for(let U=0;U<4;U++){const _=J[u+U];x+=_,_<s&&c<0&&(c=U+4)}if((c<0||c>k-1)&&(c=k-1),x>s){const s=1/x;for(let x=0;x<4;x++)I[u+x]*=s;if(J)for(let x=0;x<4;x++)J[u+x]*=s}else c>=4?(J[u+c-4]=1-x,W[u+c-4]=U):(I[u+c]=1-x,_[u+c]=U)}x.setVerticesData(c.R.MatricesIndicesKind,_),u.matricesWeightsExtra&&x.setVerticesData(c.R.MatricesIndicesExtraKind,W)}static Parse(u,x,s){const _=new $(u.id,x,void 0,u.updatable);return _._loadedUniqueId=u.uniqueId,i.Y&&i.Y.AddTagsTo(_,u.tags),u.delayLoadingFile?(_.delayLoadState=4,_.delayLoadingFile=s+u.delayLoadingFile,_._boundingInfo=new J.j(U.Pq.FromArray(u.boundingBoxMinimum),U.Pq.FromArray(u.boundingBoxMaximum)),_._delayInfo=[],u.hasUVs&&_._delayInfo.push(c.R.UVKind),u.hasUVs2&&_._delayInfo.push(c.R.UV2Kind),u.hasUVs3&&_._delayInfo.push(c.R.UV3Kind),u.hasUVs4&&_._delayInfo.push(c.R.UV4Kind),u.hasUVs5&&_._delayInfo.push(c.R.UV5Kind),u.hasUVs6&&_._delayInfo.push(c.R.UV6Kind),u.hasColors&&_._delayInfo.push(c.R.ColorKind),u.hasMatricesIndices&&_._delayInfo.push(c.R.MatricesIndicesKind),u.hasMatricesWeights&&_._delayInfo.push(c.R.MatricesWeightsKind),_._delayLoadingFunction=W.P.ImportVertexData):W.P.ImportVertexData(u,_),x.pushGeometry(_,!0),_}}},406185:(u,x,s)=>{s.d(x,{f:()=>c});var U=s(604910),_=s(23987),W=s(27230);W.e._GroundMeshParser=(u,x)=>c.Parse(u,x);class c extends W.e{constructor(u,x){super(u,x),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(u,x=32){this._subdivisionsX=u,this._subdivisionsY=u,this.subdivide(u);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(x)}getHeightAtCoordinates(u,x){const s=this.getWorldMatrix(),_=U.AA.Matrix[5];s.invertToRef(_);const W=U.AA.Vector3[8];if(U.Pq.TransformCoordinatesFromFloatsToRef(u,0,x,_,W),u=W.x,x=W.z,u<this._minX||u>=this._maxX||x<=this._minZ||x>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const c=this._getFacetAt(u,x),I=-(c.x*u+c.z*x+c.w)/c.y;return U.Pq.TransformCoordinatesFromFloatsToRef(0,I,0,s,W),W.y}getNormalAtCoordinates(u,x){const s=new U.Pq(0,1,0);return this.getNormalAtCoordinatesToRef(u,x,s),s}getNormalAtCoordinatesToRef(u,x,s){const _=this.getWorldMatrix(),W=U.AA.Matrix[5];_.invertToRef(W);const c=U.AA.Vector3[8];if(U.Pq.TransformCoordinatesFromFloatsToRef(u,0,x,W,c),u=c.x,x=c.z,u<this._minX||u>this._maxX||x<this._minZ||x>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const I=this._getFacetAt(u,x);return U.Pq.TransformNormalFromFloatsToRef(I.x,I.y,I.z,_,s),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(u,x){const s=Math.floor((u+this._maxX)*this._subdivisionsX/this._width),U=Math.floor(-(x+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),_=this._heightQuads[U*this._subdivisionsX+s];let W;return W=x<_.slope.x*u+_.slope.y?_.facet1:_.facet2,W}_initHeightQuads(){const u=this._subdivisionsX,x=this._subdivisionsY;this._heightQuads=new Array;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const _={slope:U.I9.Zero(),facet1:new U.IU(0,0,0,0),facet2:new U.IU(0,0,0,0)};this._heightQuads[s*u+x]=_}return this}_computeHeightQuads(){const u=this.getVerticesData(_.R.PositionKind);if(!u)return this;const x=U.AA.Vector3[3],s=U.AA.Vector3[2],W=U.AA.Vector3[1],c=U.AA.Vector3[0],I=U.AA.Vector3[4],L=U.AA.Vector3[5],J=U.AA.Vector3[6],k=U.AA.Vector3[7],i=U.AA.Vector3[8];let d=0,j=0,r=0,D=0,$=0,H=0,f=0;const O=this._subdivisionsX,t=this._subdivisionsY;for(let _=0;_<t;_++)for(let t=0;t<O;t++){d=3*t,j=_*(O+1)*3,r=(_+1)*(O+1)*3,x.x=u[j+d],x.y=u[j+d+1],x.z=u[j+d+2],s.x=u[j+d+3],s.y=u[j+d+4],s.z=u[j+d+5],W.x=u[r+d],W.y=u[r+d+1],W.z=u[r+d+2],c.x=u[r+d+3],c.y=u[r+d+4],c.z=u[r+d+5],D=(c.z-x.z)/(c.x-x.x),$=x.z-D*x.x,s.subtractToRef(x,I),W.subtractToRef(x,L),c.subtractToRef(x,J),U.Pq.CrossToRef(J,L,k),U.Pq.CrossToRef(I,J,i),k.normalize(),i.normalize(),H=-(k.x*x.x+k.y*x.y+k.z*x.z),f=-(i.x*s.x+i.y*s.y+i.z*s.z);const V=this._heightQuads[_*O+t];V.slope.copyFromFloats(D,$),V.facet1.copyFromFloats(k.x,k.y,k.z,H),V.facet2.copyFromFloats(i.x,i.y,i.z,f)}return this}serialize(u){super.serialize(u),u.subdivisionsX=this._subdivisionsX,u.subdivisionsY=this._subdivisionsY,u.minX=this._minX,u.maxX=this._maxX,u.minZ=this._minZ,u.maxZ=this._maxZ,u.width=this._width,u.height=this._height}static Parse(u,x){const s=new c(u.name,x);return s._subdivisionsX=u.subdivisionsX||1,s._subdivisionsY=u.subdivisionsY||1,s._minX=u.minX,s._maxX=u.maxX,s._minZ=u.minZ,s._maxZ=u.maxZ,s._width=u.width,s._height=u.height,s}}},789603:(u,x,s)=>{s.d(x,{Z:()=>d});var U=s(604910),_=s(706400),W=s(938868),c=s(27230),I=s(607552),L=s(633727),J=s(23987),k=s(898973),i=s(310035);c.e._instancedMeshFactory=(u,x)=>{const s=new d(u,x);if(x.instancedBuffers){s.instancedBuffers={};for(const u in x.instancedBuffers)s.instancedBuffers[u]=x.instancedBuffers[u]}return s};class d extends W.u{constructor(u,x){super(u,x.getScene()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,x.addInstance(this),this._sourceMesh=x,this._unIndexed=x._unIndexed,this.position.copyFrom(x.position),this.rotation.copyFrom(x.rotation),this.scaling.copyFrom(x.scaling),x.rotationQuaternion&&(this.rotationQuaternion=x.rotationQuaternion.clone()),this.animations=x.animations.slice();for(const u of x.getAnimationRanges())null!=u&&this.createAnimationRange(u.name,u.from,u.to);this.infiniteDistance=x.infiniteDistance,this.setPivotMatrix(x.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(u){var x;(null===(x=this._sourceMesh)||void 0===x?void 0:x.receiveShadows)!==u&&k.S0.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(u){var x;(null===(x=this._sourceMesh)||void 0===x?void 0:x.material)!==u&&k.S0.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(u){var x;(null===(x=this._sourceMesh)||void 0===x?void 0:x.visibility)!==u&&k.S0.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(u){var x;(null===(x=this._sourceMesh)||void 0===x?void 0:x.skeleton)!==u&&k.S0.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(u){this._sourceMesh&&u!==this._sourceMesh.renderingGroupId&&_.V.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(u){return this._sourceMesh.createInstance(u)}isReady(u=!1){return this._sourceMesh.isReady(u,!0)}getVerticesData(u,x,s){return this._sourceMesh.getVerticesData(u,x,s)}copyVerticesData(u,x){this._sourceMesh.copyVerticesData(u,x)}setVerticesData(u,x,s,U){return this.sourceMesh&&this.sourceMesh.setVerticesData(u,x,s,U),this.sourceMesh}updateVerticesData(u,x,s,U){return this.sourceMesh&&this.sourceMesh.updateVerticesData(u,x,s,U),this.sourceMesh}setIndices(u,x=null){return this.sourceMesh&&this.sourceMesh.setIndices(u,x),this.sourceMesh}isVerticesDataPresent(u){return this._sourceMesh.isVerticesDataPresent(u)}getIndices(){return this._sourceMesh.getIndices()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(u=!1,x=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let s;s="object"==typeof u?u:{applySkeleton:u,applyMorph:x};const U=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getData(s,null,J.R.PositionKind),U),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(u,x){if(super._activate(u,x),this._sourceMesh.subMeshes||_.V.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!=this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,u),x){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==L.V.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new U.uq);const u=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,U.AA.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(U.AA.Vector3[7]),this._currentLOD._masterMesh=u,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(u){if(!u)return this;const x=this.sourceMesh.getLODLevels();if(x&&0!==x.length){const x=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(u,x.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(u){return this.sourceMesh._preActivateForIntermediateRendering(u)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(let u=0;u<this._sourceMesh.subMeshes.length;u++)this._sourceMesh.subMeshes[u].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}_updateBoundingInfo(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(u,x=null,s,U){const _=(U||this._sourceMesh).createInstance(u);if(I.r.DeepCopy(this,_,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),x&&(_.parent=x),!s)for(let u=0;u<this.getScene().meshes.length;u++){const x=this.getScene().meshes[u];x.parent===this&&x.clone(x.name,_)}return _.computeWorldMatrix(!0),this.onClonedObservable.notifyObservers(_),_}dispose(u,x=!1){this._sourceMesh.removeInstance(this),super.dispose(u,x)}_serializeAsParent(u){super._serializeAsParent(u),u.parentId=this._sourceMesh.uniqueId,u.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(u=null,x,s){const U=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0,x&&x.newSourcedMesh);U&&s&&s(this,U);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(U,x,s);return U}}c.e.prototype.registerInstancedBuffer=function(u,x){var s,U;if(null===(U=null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u])||void 0===U||U.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const u of this.instances)u.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[u]=null,this._userInstancedBuffersStorage.strides[u]=x,this._userInstancedBuffersStorage.sizes[u]=32*x,this._userInstancedBuffersStorage.data[u]=new Float32Array(this._userInstancedBuffersStorage.sizes[u]),this._userInstancedBuffersStorage.vertexBuffers[u]=new J.R(this.getEngine(),this._userInstancedBuffersStorage.data[u],u,!0,!1,x,!0);for(const x of this.instances)x.instancedBuffers[u]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},c.e.prototype._processInstancedBuffers=function(u,x){const s=u?u.length:0;for(const U in this.instancedBuffers){let _=this._userInstancedBuffersStorage.sizes[U];const W=this._userInstancedBuffersStorage.strides[U],c=(s+1)*W;for(;_<c;)_*=2;this._userInstancedBuffersStorage.data[U].length!=_&&(this._userInstancedBuffersStorage.data[U]=new Float32Array(_),this._userInstancedBuffersStorage.sizes[U]=_,this._userInstancedBuffersStorage.vertexBuffers[U]&&(this._userInstancedBuffersStorage.vertexBuffers[U].dispose(),this._userInstancedBuffersStorage.vertexBuffers[U]=null));const I=this._userInstancedBuffersStorage.data[U];let L=0;if(x){const u=this.instancedBuffers[U];u.toArray?u.toArray(I,L):u.copyToArray?u.copyToArray(I,L):I[L]=u,L+=W}for(let x=0;x<s;x++){const s=u[x].instancedBuffers[U];s.toArray?s.toArray(I,L):s.copyToArray?s.copyToArray(I,L):I[L]=s,L+=W}this._userInstancedBuffersStorage.vertexBuffers[U]?this._userInstancedBuffersStorage.vertexBuffers[U].updateDirectly(I,0):(this._userInstancedBuffersStorage.vertexBuffers[U]=new J.R(this.getEngine(),this._userInstancedBuffersStorage.data[U],U,!0,!1,W,!0),this._invalidateInstanceVertexArrayObject())}},c.e.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const u in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[u]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},c.e.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const u in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[u]&&this._userInstancedBuffersStorage.vertexBuffers[u].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},i.Y5("BABYLON.InstancedMesh",d)},85489:(u,x,s)=>{s.d(x,{Q:()=>k,l:()=>J});var U=s(332290),_=s(23987),W=s(27230),c=s(789603),I=s(55973),L=s(648826);W.e._LinesMeshParser=(u,x)=>J.Parse(u,x);class J extends W.e{_isShaderMaterial(u){return"ShaderMaterial"===u.getClassName()}constructor(u,x=null,W=null,c=null,I,k,i,d){super(u,x,W,c,I),this.useVertexColor=k,this.useVertexAlpha=i,this.color=new U.v9(1,1,1),this.alpha=1,this._shaderLanguage=0,c&&(this.color=c.color.clone(),this.alpha=c.alpha,this.useVertexColor=c.useVertexColor,this.useVertexAlpha=c.useVertexAlpha),this.intersectionThreshold=.1;const j={attributes:[_.R.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};!1===i?j.needAlphaBlending=!1:j.defines.push("#define VERTEXALPHA"),k?(j.defines.push("#define VERTEXCOLOR"),j.attributes.push(_.R.ColorKind)):(j.uniforms.push("color"),this._color4=new U.ov),d?this.material=d:(this.getScene().getEngine().isWebGPU&&!J.ForceGLSL&&(this._shaderLanguage=1),j.shaderLanguage=this._shaderLanguage,j.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([s.e(28276).then(s.bind(s,28276)),s.e(56926).then(s.bind(s,556926))]):await Promise.all([s.e(29251).then(s.bind(s,129251)),s.e(26089).then(s.bind(s,626089))])},this.material=new L.B("colorShader",this.getScene(),"color",j,!1),this.material.doNotSerialize=!0)}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(u){this._lineMaterial=u,this._lineMaterial.fillMode=I.i.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(u){}_bind(u,x){if(!this._geometry)return this;const s=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(x,s):this._geometry._bind(x,s,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:u,g:x,b:s}=this.color;this._color4.set(u,x,s,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(u,x,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const U=this.getScene().getEngine();return this._unIndexed?U.drawArraysType(I.i.LineListDrawMode,u.verticesStart,u.verticesCount,s):U.drawElementsType(I.i.LineListDrawMode,u.indexStart,u.indexCount,s),this}dispose(u,x=!1,s){s||this._lineMaterial.dispose(!1,!1,!0),super.dispose(u)}clone(u,x=null,s){return new J(u,this.getScene(),x,this,s)}createInstance(u){const x=new k(u,this);if(this.instancedBuffers){x.instancedBuffers={};for(const u in this.instancedBuffers)x.instancedBuffers[u]=this.instancedBuffers[u]}return x}serialize(u){super.serialize(u),u.color=this.color.asArray(),u.alpha=this.alpha}static Parse(u,x){const s=new J(u.name,x);return s.color=U.v9.FromArray(u.color),s.alpha=u.alpha,s}}J.ForceGLSL=!1;class k extends c.Z{constructor(u,x){super(u,x),this.intersectionThreshold=x.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},27230:(u,x,s)=>{s.d(x,{Ez:()=>F,_h:()=>Z,e:()=>e});var U=s(638113),_=s(898973),W=s(607552),c=s(443401),I=s(378480),L=s(564135),J=s(604910),k=s(332290),i=s(869581),d=s(23987),j=s(818696),r=s(742631),D=s(938868),$=s(374216),H=s(55973),f=s(234412),O=s(396574),t=s(337776),V=s(706400),N=s(310035),m=s(554014),b=s(122030),n=s(314785);class F{}class B{constructor(){this.visibleInstances={},this.batchCache=new Z,this.batchCacheReplacementModeInFrozenMode=new Z,this.instancesBufferSize=32*16*4}}class Z{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class v{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=32*16,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class y{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class e extends D.u{static _GetDefaultSideOrientation(u){return u||e.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(u){this._internalMeshDataInfo._useLODScreenCoverage=u,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(u){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==u&&(u&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(d.R.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(d.R.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=u,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new U.cP),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new U.cP),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new U.cP),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new U.cP),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new U.cP),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(u){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(u)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(u){this._internalMeshDataInfo._forcedInstanceCount=u}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(u){this._internalMeshDataInfo._sideOrientation=u,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===u||!this._scene.useRightHandedSystem&&0===u}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(u){this.sideOrientation=u,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(u){this._internalMeshDataInfo._overrideRenderingFillMode=u}get material(){return this._internalAbstractMeshDataInfo._material}set material(u){u&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(u.sideOrientation=null),this._setMaterial(u)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(u){this._unIndexed!==u&&(this._unIndexed=u,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(u){this._instanceDataStorage.manualUpdate=u}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(u){this._instanceDataStorage.previousManualUpdate=u}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(u){this._instanceDataStorage.forceMatrixUpdates=u}_copySource(u,x,s=!0){const U=this.getScene();if(u._geometry&&u._geometry.applyToMesh(this),W.r.DeepCopy(u,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=u,U.useClonedMeshMap&&(u._internalMeshDataInfo.meshMap||(u._internalMeshDataInfo.meshMap={}),u._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=u._originalBuilderSideOrientation,this._creationDataStorage=u._creationDataStorage,u._ranges){const x=u._ranges;for(const u in x)Object.prototype.hasOwnProperty.call(x,u)&&x[u]&&this.createAnimationRange(u,x[u].from,x[u].to)}if(u.metadata&&u.metadata.clone?this.metadata=u.metadata.clone():this.metadata=u.metadata,this._internalMetadata=u._internalMetadata,c.Y&&c.Y.HasTags(u)&&c.Y.AddTagsTo(this,c.Y.GetTags(u,!0)),this.setEnabled(u.isEnabled(!1)),this.parent=u.parent,this.setPivotMatrix(u.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+u.id,this.material=u.material,!x){const x=u.getDescendants(!0);for(let u=0;u<x.length;u++){const s=x[u];s.clone&&s.clone(this.name+"."+s.name,this)}}if(u.morphTargetManager&&(this.morphTargetManager=u.morphTargetManager),U.getPhysicsEngine){const x=U.getPhysicsEngine();if(s&&x)if(1===x.getPluginVersion()){const s=x.getImpostorForPhysicsObject(u);s&&(this.physicsImpostor=s.clone(this))}else 2===x.getPluginVersion()&&u.physicsBody&&u.physicsBody.clone(this)}for(let x=0;x<U.particleSystems.length;x++){const s=U.particleSystems[x];s.emitter===u&&s.clone(s.name,this)}this.skeleton=u.skeleton,this.refreshBoundingInfo(!0,!0),this.computeWorldMatrix(!0)}constructor(u,x=null,s=null,_=null,W,c=!0){super(u,x),this._internalMeshDataInfo=new y,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new B,this._thinInstanceDataStorage=new v,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=e.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,x=this.getScene(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(u,x,s)=>{u&&s&&(this._uniformBuffer?this.transferToEffect(x):s.bindOnlyWorldMatrix(x))},_&&this._copySource(_,W,c),null!==s&&(this.parent=s),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=u=>{u.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new U.cP(this._internalMeshDataInfo._onMeshReadyObserverAdded),_&&_.onClonedObservable.notifyObservers(this)}instantiateHierarchy(u=null,x,s){const U=0===this.getTotalVertices()||x&&x.doNotInstantiate&&(!0===x.doNotInstantiate||x.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),u||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));U.parent=u||this.parent,U.position=this.position.clone(),U.scaling=this.scaling.clone(),this.rotationQuaternion?U.rotationQuaternion=this.rotationQuaternion.clone():U.rotation=this.rotation.clone(),s&&s(this,U);for(const u of this.getChildTransformNodes(!0))"InstancedMesh"===u.getClassName()&&"Mesh"===U.getClassName()&&u.sourceMesh===this?u.instantiateHierarchy(U,{doNotInstantiate:x&&x.doNotInstantiate||!1,newSourcedMesh:U},s):u.instantiateHierarchy(U,x,s);return U}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(u){let x=super.toString(u);if(x+=", n vertices: "+this.getTotalVertices(),x+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let s=0;s<this.animations.length;s++)x+=", animation[0]: "+this.animations[s].toString(u);if(u)if(this._geometry){const u=this.getIndices(),s=this.getVerticesData(d.R.PositionKind);s&&u&&(x+=", flat shading: "+(s.length/3===u.length?"YES":"NO"))}else x+=", flat shading: UNKNOWN";return x}_unBindEffect(){super._unBindEffect();for(const u of this.instances)u._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const u=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((x,s)=>x.distanceOrScreenCoverage<s.distanceOrScreenCoverage?u:x.distanceOrScreenCoverage>s.distanceOrScreenCoverage?-u:0))}addLODLevel(u,x){if(x&&x._masterMesh)return V.V.Warn("You cannot use a mesh as LOD level twice"),this;const s=new n.L(u,x);return this._internalMeshDataInfo._LODLevels.push(s),x&&(x._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(u){const x=this._internalMeshDataInfo;for(let s=0;s<x._LODLevels.length;s++){const U=x._LODLevels[s];if(U.distanceOrScreenCoverage===u)return U.mesh}return null}removeLODLevel(u){const x=this._internalMeshDataInfo;for(let s=0;s<x._LODLevels.length;s++)x._LODLevels[s].mesh===u&&(x._LODLevels.splice(s,1),u&&(u._masterMesh=null));return this._sortLODLevels(),this}getLOD(u,x){const s=this._internalMeshDataInfo;if(!s._LODLevels||0===s._LODLevels.length)return this;const U=x||this.getBoundingInfo().boundingSphere,_=u.mode===L.i.ORTHOGRAPHIC_CAMERA?u.minZ:U.centerWorld.subtract(u.globalPosition).length();let W=_,c=1;if(s._useLODScreenCoverage){const x=u.screenArea;let s=U.radiusWorld*u.minZ/_;s=s*s*Math.PI,W=s/x,c=-1}if(c*s._LODLevels[s._LODLevels.length-1].distanceOrScreenCoverage>c*W)return this.onLODLevelSelection&&this.onLODLevelSelection(W,this,this),this;for(let u=0;u<s._LODLevels.length;u++){const x=s._LODLevels[u];if(c*x.distanceOrScreenCoverage<c*W){if(x.mesh){if(4===x.mesh.delayLoadState)return x.mesh._checkDelayState(),this;if(2===x.mesh.delayLoadState)return this;x.mesh._preActivate(),x.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(W,this,x.mesh),x.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(W,this,this),this}get geometry(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(u,x,s,U){var _,W;if(!this._geometry)return null;let c=U||null===(W=null===(_=this._userInstancedBuffersStorage)||void 0===_?void 0:_.vertexBuffers[u])||void 0===W?void 0:W.getFloatData(this.instances.length+1,s||x&&1!==this._geometry.meshes.length);return c||(c=this._geometry.getVerticesData(u,x,s)),c}copyVerticesData(u,x){this._geometry&&this._geometry.copyVerticesData(u,x)}getVertexBuffer(u,x){var s,U;return this._geometry?null!==(U=x||null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u])&&void 0!==U?U:this._geometry.getVertexBuffer(u):null}isVerticesDataPresent(u,x){var s;return this._geometry?!x&&void 0!==(null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u])||this._geometry.isVerticesDataPresent(u):!!this._delayInfo&&-1!==this._delayInfo.indexOf(u)}isVertexBufferUpdatable(u,x){var s;if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(u);if(!x){const x=null===(s=this._userInstancedBuffersStorage)||void 0===s?void 0:s.vertexBuffers[u];if(x)return x.isUpdatable()}return this._geometry.isVertexBufferUpdatable(u)}getVerticesDataKinds(u){if(!this._geometry){const u=[];return this._delayInfo&&this._delayInfo.forEach((function(x){u.push(x)})),u}const x=this._geometry.getVerticesDataKinds();if(!u&&this._userInstancedBuffersStorage)for(const u in this._userInstancedBuffersStorage.vertexBuffers)-1===x.indexOf(u)&&x.push(u);return x}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}getIndices(u,x){return this._geometry?this._geometry.getIndices(u,x):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(u=!1,x=!1){var s,U,_,W,c,I,L;if(2===this.delayLoadState)return!1;if(!super.isReady(u))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!u)return!0;const J=this.getEngine(),k=this.getScene(),i=x||J.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();const d=this.material||k.defaultMaterial;if(d)if(d._storeEffectOnSubMeshes)for(const u of this.subMeshes){const x=u.getMaterial();if(x)if(x._storeEffectOnSubMeshes){if(!x.isReadyForSubMesh(this,u,i))return!1}else if(!x.isReady(this,i))return!1}else if(!d.isReady(this,i))return!1;const j=J.currentRenderPassId;for(const u of this.lightSources){const x=u.getShadowGenerators();if(!x)continue;const k=x.values();for(let u=k.next();!0!==u.done;u=k.next()){const x=u.value;if(x&&(!(null===(s=x.getShadowMap())||void 0===s?void 0:s.renderList)||(null===(U=x.getShadowMap())||void 0===U?void 0:U.renderList)&&-1!==(null===(W=null===(_=x.getShadowMap())||void 0===_?void 0:_.renderList)||void 0===W?void 0:W.indexOf(this)))){const u=null!==(c=x.getShadowMap().renderPassIds)&&void 0!==c?c:[J.currentRenderPassId];for(let s=0;s<u.length;++s){J.currentRenderPassId=u[s];for(const u of this.subMeshes)if(!x.isReady(u,i,null!==(L=null===(I=u.getMaterial())||void 0===I?void 0:I.needAlphaBlendingForMesh(this))&&void 0!==L&&L))return J.currentRenderPassId=j,!1}J.currentRenderPassId=j}}}for(const u of this._internalMeshDataInfo._LODLevels)if(u.mesh&&!u.mesh.isReady(i))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}freezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(u){this._instanceDataStorage.overridenInstanceCount=u}_preActivate(){const u=this._internalMeshDataInfo,x=this.getScene().getRenderId();return u._preActivateId===x||(u._preActivateId=x,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(u){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=u),this}_registerInstanceForRenderId(u,x){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:x,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[x]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=x,this._instanceDataStorage.visibleInstances[x]=new Array),this._instanceDataStorage.visibleInstances[x].push(u),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(u=!1,x=!1){if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;let s;s="object"==typeof u?u:{applySkeleton:u,applyMorph:x};const U=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getData(s,null,d.R.PositionKind),U),this}_createGlobalSubMesh(u){const x=this.getTotalVertices();if(!x||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){const s=this.getIndices();if(!s)return null;const U=s.length;let _=!1;if(u)_=!0;else for(const u of this.subMeshes){if(u.indexStart+u.indexCount>U){_=!0;break}if(u.verticesStart+u.verticesCount>x){_=!0;break}}if(!_)return this.subMeshes[0]}return this.releaseSubMeshes(),new $.K(0,0,x,0,this.getTotalIndices(),this)}subdivide(u){if(u<1)return;const x=this.getTotalIndices();let s=x/u|0,U=0;for(;s%3!=0;)s++;this.releaseSubMeshes();for(let _=0;_<u&&!(U>=x);_++)$.K.CreateFromIndices(0,U,_===u-1?x-U:s,this,void 0,!1),U+=s;this.refreshBoundingInfo(),this.synchronizeInstances()}setVerticesData(u,x,s=!1,U){if(this._geometry)this._geometry.setVerticesData(u,x,s,U);else{const U=new j.P;U.set(x,u);const _=this.getScene();new r.V(r.V.RandomId(),_,U,s,this)}return this}removeVerticesData(u){this._geometry&&this._geometry.removeVerticesData(u)}markVerticesDataAsUpdatable(u,x=!0){const s=this.getVertexBuffer(u);s&&s.isUpdatable()!==x&&this.setVerticesData(u,this.getVerticesData(u),x)}setVerticesBuffer(u,x=!0){return this._geometry||(this._geometry=r.V.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(u,null,x),this}updateVerticesData(u,x,s,U){return this._geometry?(U?(this.makeGeometryUnique(),this.updateVerticesData(u,x,s,!1)):this._geometry.updateVerticesData(u,x,s),this):this}updateMeshPositions(u,x=!0){const s=this.getVerticesData(d.R.PositionKind);if(!s)return this;if(u(s),this.updateVerticesData(d.R.PositionKind,s,!1,!1),x){const u=this.getIndices(),x=this.getVerticesData(d.R.NormalKind);if(!x)return this;j.P.ComputeNormals(s,u,x),this.updateVerticesData(d.R.NormalKind,x,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const u=this._geometry,x=this._geometry.copy(r.V.RandomId());return u.releaseForMesh(this,!0),x.applyToMesh(this),this}setIndexBuffer(u,x,s){let U=this._geometry;U||(U=new r.V(r.V.RandomId(),this.getScene(),void 0,void 0,this)),U.setIndexBuffer(u,x,s)}setIndices(u,x=null,s=!1){if(this._geometry)this._geometry.setIndices(u,x,s);else{const x=new j.P;x.indices=u;const U=this.getScene();new r.V(r.V.RandomId(),U,x,s,this)}return this}updateIndices(u,x,s=!1){return this._geometry?(this._geometry.updateIndices(u,x,s),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(u,x,s,U=!0){if(!this._geometry)return this;const _=this.getScene().getEngine();let W;if(this._unIndexed)W=null;else switch(this._getRenderingFillMode(s)){case H.i.PointFillMode:W=null;break;case H.i.WireFrameFillMode:W=u._getLinesIndexBuffer(this.getIndices(),_);break;default:case H.i.TriangleFillMode:W=this._geometry.getIndexBuffer()}return this._bindDirect(x,W,U)}_bindDirect(u,x,s=!0){return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(u),s&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(u,x,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(u,x),this):this}_draw(u,x,s){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const U=this.getScene().getEngine();return this._unIndexed||x==H.i.PointFillMode?U.drawArraysType(x,u.verticesStart,u.verticesCount,this.forcedInstanceCount||s):x==H.i.WireFrameFillMode?U.drawElementsType(x,0,u._linesIndexCount,this.forcedInstanceCount||s):U.drawElementsType(x,u.indexStart,u.indexCount,this.forcedInstanceCount||s),this}registerBeforeRender(u){return this.onBeforeRenderObservable.add(u),this}unregisterBeforeRender(u){return this.onBeforeRenderObservable.removeCallback(u),this}registerAfterRender(u){return this.onAfterRenderObservable.add(u),this}unregisterAfterRender(u){return this.onAfterRenderObservable.removeCallback(u),this}_getInstancesRenderList(u,x=!1){if(this._instanceDataStorage.isFrozen){if(x)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[u]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[u]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const s=this.getScene(),U=s._isInIntermediateRendering(),_=U?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,W=this._instanceDataStorage.batchCache;if(W.mustReturn=!1,W.renderSelf[u]=x||!_&&this.isEnabled()&&this.isVisible,W.visibleInstances[u]=null,this._instanceDataStorage.visibleInstances&&!x){const x=this._instanceDataStorage.visibleInstances,_=s.getRenderId(),c=U?x.intermediateDefaultRenderId:x.defaultRenderId;W.visibleInstances[u]=x[_],!W.visibleInstances[u]&&c&&(W.visibleInstances[u]=x[c])}return W.hardwareInstancedRendering[u]=!x&&this._instanceDataStorage.hardwareInstancedRendering&&null!==W.visibleInstances[u]&&void 0!==W.visibleInstances[u],this._instanceDataStorage.previousBatch=W,W}_renderWithInstances(u,x,s,U,_){var W;const c=s.visibleInstances[u._id],I=c?c.length:0,L=this._instanceDataStorage,k=L.instancesBufferSize;let i=L.instancesBuffer,j=L.instancesPreviousBuffer;const r=16*(I+1)*4;for(;L.instancesBufferSize<r;)L.instancesBufferSize*=2;L.instancesData&&k==L.instancesBufferSize||(L.instancesData=new Float32Array(L.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!L.instancesPreviousData||k!=L.instancesBufferSize)&&(L.instancesPreviousData=new Float32Array(L.instancesBufferSize/4));let D=0,$=0;const H=s.renderSelf[u._id],f=!i||k!==L.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!L.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||L.isFrozen&&!f)$=(H?1:0)+I;else{const x=this.getWorldMatrix();if(H&&(this._scene.needsPreviousWorldMatrices&&(L.masterMeshPreviousWorldMatrix?(L.masterMeshPreviousWorldMatrix.copyToArray(L.instancesPreviousData,D),L.masterMeshPreviousWorldMatrix.copyFrom(x)):(L.masterMeshPreviousWorldMatrix=x.clone(),L.masterMeshPreviousWorldMatrix.copyToArray(L.instancesPreviousData,D))),x.copyToArray(L.instancesData,D),D+=16,$++),c){if(e.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(W=u.getMaterial())||void 0===W?void 0:W.needAlphaBlendingForMesh(u.getRenderingMesh()))){const u=this._scene.activeCamera.globalPosition;for(let x=0;x<c.length;x++){const s=c[x];s._distanceToCamera=J.Pq.Distance(s.getBoundingInfo().boundingSphere.centerWorld,u)}c.sort(((u,x)=>u._distanceToCamera>x._distanceToCamera?-1:u._distanceToCamera<x._distanceToCamera?1:0))}for(let u=0;u<c.length;u++){const x=c[u],s=x.getWorldMatrix();s.copyToArray(L.instancesData,D),this._scene.needsPreviousWorldMatrices&&(x._previousWorldMatrix?(x._previousWorldMatrix.copyToArray(L.instancesPreviousData,D),x._previousWorldMatrix.copyFrom(s)):(x._previousWorldMatrix=s.clone(),x._previousWorldMatrix.copyToArray(L.instancesPreviousData,D))),D+=16,$++}}}return f?(i&&i.dispose(),j&&j.dispose(),i=new d.h(_,L.instancesData,!0,16,!1,!0),L.instancesBuffer=i,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers["world0"]=i.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers["world1"]=i.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers["world2"]=i.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers["world3"]=i.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(j=new d.h(_,L.instancesPreviousData,!0,16,!1,!0),L.instancesPreviousBuffer=j,this._userInstancedBuffersStorage.vertexBuffers["previousWorld0"]=j.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers["previousWorld1"]=j.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers["previousWorld2"]=j.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers["previousWorld3"]=j.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(i.updateDirectly(L.instancesData,0,$),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||j.updateDirectly(L.instancesPreviousData,0,$)),this._processInstancedBuffers(c,H),this.getScene()._activeIndices.addCount(u.indexCount*$,!1),_._currentDrawContext&&(_._currentDrawContext.useInstancing=!0),this._bind(u,U,x),this._draw(u,x,$),!this._scene.needsPreviousWorldMatrices||f||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||j.updateDirectly(L.instancesData,0,$),_.unbindInstanceAttributes(),this}_renderWithThinInstances(u,x,s,U){var _,W;const c=null!==(W=null===(_=this._thinInstanceDataStorage)||void 0===_?void 0:_.instancesCount)&&void 0!==W?W:0;this.getScene()._activeIndices.addCount(u.indexCount*c,!1),U._currentDrawContext&&(U._currentDrawContext.useInstancing=!0),this._bind(u,s,x),this._draw(u,x,c),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,c):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),U.unbindInstanceAttributes()}_processInstancedBuffers(u,x){}_processRendering(u,x,s,U,_,W,c,I){const L=this.getScene(),J=L.getEngine();if(U=this._getRenderingFillMode(U),W&&x.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(x,U,s,J),this;if(W)this._renderWithInstances(x,U,_,s,J);else{J._currentDrawContext&&(J._currentDrawContext.useInstancing=!1);let s=0;_.renderSelf[x._id]&&(c&&c(!1,u.getWorldMatrix(),I),s++,this._draw(x,U,this._instanceDataStorage.overridenInstanceCount));const W=_.visibleInstances[x._id];if(W){const u=W.length;s+=u;for(let s=0;s<u;s++){const u=W[s].getWorldMatrix();c&&c(!0,u,I),this._draw(x,U)}}L._activeIndices.addCount(x.indexCount*s,!1)}return this}_rebuild(u=!1){if(this._instanceDataStorage.instancesBuffer&&(u&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const x in this._userInstancedBuffersStorage.vertexBuffers){const s=this._userInstancedBuffersStorage.vertexBuffers[x];s&&(u&&s.dispose(),this._userInstancedBuffersStorage.vertexBuffers[x]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(u)}_freeze(){if(this.subMeshes){for(let u=0;u<this.subMeshes.length;u++)this._getInstancesRenderList(u);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(u,x,s,U,_=!0){const W=this._scene.getEngine(),c=W.currentRenderPassId;if(void 0!==u&&(W.currentRenderPassId=u),U)(!_||_&&U.isInFrustum(this._scene._frustumPlanes))&&this.render(U,!!x,s);else for(let u=0;u<this.subMeshes.length;u++){const U=this.subMeshes[u];(!_||_&&U.isInFrustum(this._scene._frustumPlanes))&&this.render(U,!!x,s)}return void 0!==u&&(W.currentRenderPassId=c),this}render(u,x,s){var U,_,W,c;const I=this.getScene();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const L=null!==(_=null===(U=I.activeCameras)||void 0===U?void 0:U.length)&&void 0!==_?_:0;if((L>1&&I.activeCamera===I.activeCameras[0]||L<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const J=this._getInstancesRenderList(u._id,!!s);if(J.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const k=I.getEngine();let i=0,d=null;this.ignoreCameraMaxZ&&I.activeCamera&&!I._isInIntermediateRendering()&&(i=I.activeCamera.maxZ,d=I.activeCamera,I.activeCamera.maxZ=0,I.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const j=u.getRenderingMesh(),r=J.hardwareInstancedRendering[u._id]||j.hasThinInstances||!!this._userInstancedBuffersStorage&&!u.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,D=this._instanceDataStorage,$=u.getMaterial();if(!$)return d&&(d.maxZ=i,I.updateTransformMatrix(!0)),this;if(D.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===$){if($._storeEffectOnSubMeshes&&!(null===(W=u._drawWrapper)||void 0===W?void 0:W._wasPreviouslyReady)||!$._storeEffectOnSubMeshes&&!$._getDrawWrapper()._wasPreviouslyReady)return d&&(d.maxZ=i,I.updateTransformMatrix(!0)),this}else{if($._storeEffectOnSubMeshes){if(!$.isReadyForSubMesh(this,u,r))return d&&(d.maxZ=i,I.updateTransformMatrix(!0)),this}else if(!$.isReady(this,r))return d&&(d.maxZ=i,I.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=$}let f;x&&k.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),f=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?u._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const O=null!==(c=null==f?void 0:f.effect)&&void 0!==c?c:null;for(const x of I._beforeRenderingMeshStage)x.action(this,u,J,O);if(!f||!O)return d&&(d.maxZ=i,I.updateTransformMatrix(!0)),this;const t=s||this;let V;if(D.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)V=D.sideOrientation;else{const u=t._getWorldMatrixDeterminant();V=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),u<0&&(V=V===H.i.ClockWiseSideOrientation?H.i.CounterClockWiseSideOrientation:H.i.ClockWiseSideOrientation),D.sideOrientation=V}const N=this._internalMeshDataInfo._effectiveMaterial._preBind(f,V);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&k.setDepthWrite(!0);const m=this._internalMeshDataInfo._effectiveMaterial,b=m.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),r||this._bind(u,O,b,!1);const n=t.getWorldMatrix();m._storeEffectOnSubMeshes?m.bindForSubMesh(n,this,u):m.bind(n,this),!m.backFaceCulling&&m.separateCullingPass&&(k.setState(!0,m.zOffset,!1,!N,m.cullBackFaces,m.stencil,m.zOffsetUnits),this._processRendering(this,u,O,b,J,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),k.setState(!0,m.zOffset,!1,N,m.cullBackFaces,m.stencil,m.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(u)),this._processRendering(this,u,O,b,J,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const x of I._afterRenderingMeshStage)x.action(this,u,J,O);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),d&&(d.maxZ=i,I.updateTransformMatrix(!0)),2!==I.performancePriority||D.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(d.R.MatricesWeightsKind)&&(this.isVerticesDataPresent(d.R.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const u=this.getVerticesData(d.R.MatricesWeightsKind),x=u.length;for(let s=0;s<x;s+=4){const x=u[s]+u[s+1]+u[s+2]+u[s+3];if(0===x)u[s]=1;else{const U=1/x;u[s]*=U,u[s+1]*=U,u[s+2]*=U,u[s+3]*=U}}this.setVerticesData(d.R.MatricesWeightsKind,u)}_normalizeSkinWeightsAndExtra(){const u=this.getVerticesData(d.R.MatricesWeightsExtraKind),x=this.getVerticesData(d.R.MatricesWeightsKind),s=x.length;for(let U=0;U<s;U+=4){let s=x[U]+x[U+1]+x[U+2]+x[U+3];if(s+=u[U]+u[U+1]+u[U+2]+u[U+3],0===s)x[U]=1;else{const _=1/s;x[U]*=_,x[U+1]*=_,x[U+2]*=_,x[U+3]*=_,u[U]*=_,u[U+1]*=_,u[U+2]*=_,u[U+3]*=_}}this.setVerticesData(d.R.MatricesWeightsKind,x),this.setVerticesData(d.R.MatricesWeightsKind,u)}validateSkinning(){const u=this.getVerticesData(d.R.MatricesWeightsExtraKind),x=this.getVerticesData(d.R.MatricesWeightsKind);if(null===x||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};const s=x.length;let U=0,_=0,W=0,c=0;const I=null===u?4:8,L=[];for(let u=0;u<=I;u++)L[u]=0;const J=.001;for(let k=0;k<s;k+=4){let s=x[k],i=s,d=0===i?0:1;for(let _=1;_<I;_++){const W=_<4?x[k+_]:u[k+_-4];W>s&&U++,0!==W&&d++,i+=W,s=W}if(L[d]++,d>W&&(W=d),0===i)_++;else{const s=1/i;let U=0;for(let _=0;_<I;_++)U+=_<4?Math.abs(x[k+_]-x[k+_]*s):Math.abs(u[k+_-4]-u[k+_-4]*s);U>J&&c++}}const k=this.skeleton.bones.length,i=this.getVerticesData(d.R.MatricesIndicesKind),j=this.getVerticesData(d.R.MatricesIndicesExtraKind);let r=0;for(let u=0;u<s;u+=4)for(let x=0;x<I;x++){const s=x<4?i[u+x]:j[u+x-4];(s>=k||s<0)&&r++}return{skinned:!0,valid:0===_&&0===c&&0===r,report:"Number of Weights = "+s/4+"\nMaximum influences = "+W+"\nMissing Weights = "+_+"\nNot Sorted = "+U+"\nNot Normalized = "+c+"\nWeightCounts = ["+L+"]"+"\nNumber of bones = "+k+"\nBad Bone Indices = "+r}}_checkDelayState(){const u=this.getScene();return this._geometry?this._geometry.load(u):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(u)),this}_queueLoad(u){u.addPendingData(this);const x=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return _.S0.LoadFile(this.delayLoadingFile,(x=>{x instanceof ArrayBuffer?this._delayLoadingFunction(x,this):this._delayLoadingFunction(JSON.parse(x),this),this.instances.forEach((u=>{u.refreshBoundingInfo(),u._syncSubMeshes()})),this.delayLoadState=1,u.removePendingData(this)}),(()=>{}),u.offlineProvider,x),this}isInFrustum(u){return 2!==this.delayLoadState&&!!super.isInFrustum(u)&&(this._checkDelayState(),!0)}setMaterialById(u){const x=this.getScene().materials;let s;for(s=x.length-1;s>-1;s--)if(x[s].id===u)return this.material=x[s],this;const U=this.getScene().multiMaterials;for(s=U.length-1;s>-1;s--)if(U[s].id===u)return this.material=U[s],this;return this}getAnimatables(){const u=[];return this.material&&u.push(this.material),this.skeleton&&u.push(this.skeleton),u}bakeTransformIntoVertices(u){if(!this.isVerticesDataPresent(d.R.PositionKind))return this;const x=this.subMeshes.splice(0);this._resetPointsArrayCache();let s=this.getVerticesData(d.R.PositionKind);const U=J.Pq.Zero();let _;for(_=0;_<s.length;_+=3)J.Pq.TransformCoordinatesFromFloatsToRef(s[_],s[_+1],s[_+2],u,U).toArray(s,_);if(this.setVerticesData(d.R.PositionKind,s,this.getVertexBuffer(d.R.PositionKind).isUpdatable()),this.isVerticesDataPresent(d.R.NormalKind)){for(s=this.getVerticesData(d.R.NormalKind),_=0;_<s.length;_+=3)J.Pq.TransformNormalFromFloatsToRef(s[_],s[_+1],s[_+2],u,U).normalize().toArray(s,_);this.setVerticesData(d.R.NormalKind,s,this.getVertexBuffer(d.R.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(d.R.TangentKind)){for(s=this.getVerticesData(d.R.TangentKind),_=0;_<s.length;_+=4)J.Pq.TransformNormalFromFloatsToRef(s[_],s[_+1],s[_+2],u,U).normalize().toArray(s,_);this.setVerticesData(d.R.TangentKind,s,this.getVertexBuffer(d.R.TangentKind).isUpdatable())}return u.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=x,this}bakeCurrentTransformIntoVertices(u=!0){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(u),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(u="",x=null,s,U=!0){return new e(u,this.getScene(),x,this,s,U)}dispose(u,x=!1){this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const s=this._internalMeshDataInfo;if(s._onBeforeDrawObservable&&s._onBeforeDrawObservable.clear(),s._onBeforeBindObservable&&s._onBeforeBindObservable.clear(),s._onBeforeRenderObservable&&s._onBeforeRenderObservable.clear(),s._onAfterRenderObservable&&s._onAfterRenderObservable.clear(),s._onBetweenPassObservable&&s._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(s.meshMap)for(const u in s.meshMap){const x=s.meshMap[u];x&&(x._internalMeshDataInfo._source=null,s.meshMap[u]=void 0)}s._source&&s._source._internalMeshDataInfo.meshMap&&(s._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const u=this.getScene().meshes;for(const x of u){const u=x;u._internalMeshDataInfo&&u._internalMeshDataInfo._source&&u._internalMeshDataInfo._source===this&&(u._internalMeshDataInfo._source=null)}}s._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(u,x)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(u,x,s,U,W,c,I=!1,L){const J=this.getScene();return _.S0.LoadImage(u,(u=>{const _=u.width,L=u.height,J=this.getEngine().createCanvas(_,L).getContext("2d");J.drawImage(u,0,0);const k=J.getImageData(0,0,_,L).data;this.applyDisplacementMapFromBuffer(k,_,L,x,s,W,c,I),U&&U(this)}),L||(()=>{}),J.offlineProvider),this}applyDisplacementMapFromBuffer(u,x,s,U,_,W,c,I=!1){if(!this.isVerticesDataPresent(d.R.PositionKind)||!this.isVerticesDataPresent(d.R.NormalKind)||!this.isVerticesDataPresent(d.R.UVKind))return V.V.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const L=this.getVerticesData(d.R.PositionKind,!0,!0),k=this.getVerticesData(d.R.NormalKind),i=this.getVerticesData(d.R.UVKind);let r=J.Pq.Zero();const D=J.Pq.Zero(),$=J.I9.Zero();W=W||J.I9.Zero(),c=c||new J.I9(1,1);for(let I=0;I<L.length;I+=3){J.Pq.FromArrayToRef(L,I,r),J.Pq.FromArrayToRef(k,I,D),J.I9.FromArrayToRef(i,I/3*2,$);const d=4*((Math.abs($.x*c.x+W.x%1)*(x-1)%x|0)+(Math.abs($.y*c.y+W.y%1)*(s-1)%s|0)*x),j=.3*(u[d]/255)+.59*(u[d+1]/255)+.11*(u[d+2]/255);D.normalize(),D.scaleInPlace(U+(_-U)*j),r=r.add(D),r.toArray(L,I)}return j.P.ComputeNormals(L,this.getIndices(),k),I?(this.setVerticesData(d.R.PositionKind,L),this.setVerticesData(d.R.NormalKind,k),this.setVerticesData(d.R.UVKind,i)):(this.updateVerticesData(d.R.PositionKind,L),this.updateVerticesData(d.R.NormalKind,k)),this}_getFlattenedNormals(u,x){const s=new Float32Array(3*u.length);let U=0;const _=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let W=0;W<u.length;W+=3){const c=J.Pq.FromArray(x,3*u[W]),I=J.Pq.FromArray(x,3*u[W+1]),L=J.Pq.FromArray(x,3*u[W+2]),k=c.subtract(I),i=L.subtract(I),d=J.Pq.Normalize(J.Pq.Cross(k,i));_&&d.scaleInPlace(-1);for(let u=0;u<3;u++)s[U++]=d.x,s[U++]=d.y,s[U++]=d.z}return s}_convertToUnIndexedMesh(u=!1){const x=this.getVerticesDataKinds().filter((u=>{var x;return!(null===(x=this.getVertexBuffer(u))||void 0===x?void 0:x.getIsInstanced())})),s=this.getIndices(),U={},_=(u,x)=>{const U=new Float32Array(s.length*x);let _=0;for(let W=0;W<s.length;W++)for(let c=0;c<x;c++)U[_++]=u[s[W]*x+c];return U},W=this.getBoundingInfo(),c=this.geometry?this.subMeshes.slice(0):[];for(const u of x)U[u]=this.getVerticesData(u);for(const W of x){const x=this.getVertexBuffer(W),c=x.getSize();if(u&&W===d.R.NormalKind){const u=this._getFlattenedNormals(s,U[d.R.PositionKind]);this.setVerticesData(d.R.NormalKind,u,x.isUpdatable(),c)}else this.setVerticesData(W,_(U[W],c),x.isUpdatable(),c)}if(this.morphTargetManager){for(let x=0;x<this.morphTargetManager.numTargets;x++){const U=this.morphTargetManager.getTarget(x),W=U.getPositions();U.setPositions(_(W,3));const c=U.getNormals();c&&U.setNormals(u?this._getFlattenedNormals(s,W):_(c,3));const I=U.getTangents();I&&U.setTangents(_(I,3));const L=U.getUVs();L&&U.setUVs(_(L,2))}this.morphTargetManager.synchronize()}for(let u=0;u<s.length;u++)s[u]=u;this.setIndices(s),this._unIndexed=!0,this.releaseSubMeshes();for(const u of c){const x=u.getBoundingInfo();$.K.AddToMesh(u.materialIndex,u.indexStart,u.indexCount,u.indexStart,u.indexCount,this).setBoundingInfo(x)}return this.setBoundingInfo(W),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(u=!1){const x=j.P.ExtractFromMesh(this);let s;if(u&&this.isVerticesDataPresent(d.R.NormalKind)&&x.normals)for(s=0;s<x.normals.length;s++)x.normals[s]*=-1;if(x.indices){let u;for(s=0;s<x.indices.length;s+=3)u=x.indices[s+1],x.indices[s+1]=x.indices[s+2],x.indices[s+2]=u}return x.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind)),this}increaseVertices(u=1){const x=j.P.ExtractFromMesh(this),s=x.indices&&!Array.isArray(x.indices)&&Array.from?Array.from(x.indices):x.indices,U=x.positions&&!Array.isArray(x.positions)&&Array.from?Array.from(x.positions):x.positions,_=x.uvs&&!Array.isArray(x.uvs)&&Array.from?Array.from(x.uvs):x.uvs,W=x.normals&&!Array.isArray(x.normals)&&Array.from?Array.from(x.normals):x.normals;if(s&&U){x.indices=s,x.positions=U,_&&(x.uvs=_),W&&(x.normals=W);const c=u+1,I=new Array;for(let u=0;u<c+1;u++)I[u]=new Array;let L,k;const i=new J.Pq(0,0,0),j=new J.Pq(0,0,0),r=new J.I9(0,0),D=new Array,$=new Array,H=new Array;let f,O,t,V=U.length;_&&(O=_.length),W&&(t=W.length);for(let u=0;u<s.length;u+=3){$[0]=s[u],$[1]=s[u+1],$[2]=s[u+2];for(let u=0;u<3;u++)if(L=$[u],k=$[(u+1)%3],void 0===H[L]&&void 0===H[k]?(H[L]=new Array,H[k]=new Array):(void 0===H[L]&&(H[L]=new Array),void 0===H[k]&&(H[k]=new Array)),void 0===H[L][k]&&void 0===H[k][L]){H[L][k]=[],i.x=(U[3*k]-U[3*L])/c,i.y=(U[3*k+1]-U[3*L+1])/c,i.z=(U[3*k+2]-U[3*L+2])/c,W&&(j.x=(W[3*k]-W[3*L])/c,j.y=(W[3*k+1]-W[3*L+1])/c,j.z=(W[3*k+2]-W[3*L+2])/c),_&&(r.x=(_[2*k]-_[2*L])/c,r.y=(_[2*k+1]-_[2*L+1])/c),H[L][k].push(L);for(let u=1;u<c;u++)H[L][k].push(U.length/3),U[V++]=U[3*L]+u*i.x,U[V++]=U[3*L+1]+u*i.y,U[V++]=U[3*L+2]+u*i.z,W&&(W[t++]=W[3*L]+u*j.x,W[t++]=W[3*L+1]+u*j.y,W[t++]=W[3*L+2]+u*j.z),_&&(_[O++]=_[2*L]+u*r.x,_[O++]=_[2*L+1]+u*r.y);H[L][k].push(k),H[k][L]=new Array,f=H[L][k].length;for(let u=0;u<f;u++)H[k][L][u]=H[L][k][f-1-u]}I[0][0]=s[u],I[1][0]=H[s[u]][s[u+1]][1],I[1][1]=H[s[u]][s[u+2]][1];for(let x=2;x<c;x++){I[x][0]=H[s[u]][s[u+1]][x],I[x][x]=H[s[u]][s[u+2]][x],i.x=(U[3*I[x][x]]-U[3*I[x][0]])/x,i.y=(U[3*I[x][x]+1]-U[3*I[x][0]+1])/x,i.z=(U[3*I[x][x]+2]-U[3*I[x][0]+2])/x,W&&(j.x=(W[3*I[x][x]]-W[3*I[x][0]])/x,j.y=(W[3*I[x][x]+1]-W[3*I[x][0]+1])/x,j.z=(W[3*I[x][x]+2]-W[3*I[x][0]+2])/x),_&&(r.x=(_[2*I[x][x]]-_[2*I[x][0]])/x,r.y=(_[2*I[x][x]+1]-_[2*I[x][0]+1])/x);for(let u=1;u<x;u++)I[x][u]=U.length/3,U[V++]=U[3*I[x][0]]+u*i.x,U[V++]=U[3*I[x][0]+1]+u*i.y,U[V++]=U[3*I[x][0]+2]+u*i.z,W&&(W[t++]=W[3*I[x][0]]+u*j.x,W[t++]=W[3*I[x][0]+1]+u*j.y,W[t++]=W[3*I[x][0]+2]+u*j.z),_&&(_[O++]=_[2*I[x][0]]+u*r.x,_[O++]=_[2*I[x][0]+1]+u*r.y)}I[c]=H[s[u+1]][s[u+2]],D.push(I[0][0],I[1][0],I[1][1]);for(let u=1;u<c;u++){let x;for(x=0;x<u;x++)D.push(I[u][x],I[u+1][x],I[u+1][x+1]),D.push(I[u][x],I[u+1][x+1],I[u][x+1]);D.push(I[u][x],I[u+1][x],I[u+1][x+1])}}x.indices=D,x.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}else V.V.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const u=j.P.ExtractFromMesh(this),x=u.uvs,s=u.indices,U=u.positions,_=u.colors,W=u.matricesIndices,c=u.matricesWeights,I=u.matricesIndicesExtra,L=u.matricesWeightsExtra;if(void 0===s||void 0===U||null===s||null===U)V.V.Warn("VertexData contains empty entries");else{const J=new Array,k=new Array,i=new Array,r=new Array,D=new Array,$=new Array,H=new Array,f=new Array;let O=new Array,t=0;const V={};let N,m;for(let u=0;u<s.length;u+=3){m=[s[u],s[u+1],s[u+2]],O=[];for(let u=0;u<3;u++){O[u]="";for(let x=0;x<3;x++)Math.abs(U[3*m[u]+x])<1e-8&&(U[3*m[u]+x]=0),O[u]+=U[3*m[u]+x]+"|"}if(O[0]!=O[1]&&O[0]!=O[2]&&O[1]!=O[2])for(let u=0;u<3;u++){if(N=V[O[u]],void 0===N){V[O[u]]=t,N=t++;for(let x=0;x<3;x++)J.push(U[3*m[u]+x]);if(null!=_)for(let x=0;x<4;x++)r.push(_[4*m[u]+x]);if(null!=x)for(let s=0;s<2;s++)i.push(x[2*m[u]+s]);if(null!=W)for(let x=0;x<4;x++)D.push(W[4*m[u]+x]);if(null!=c)for(let x=0;x<4;x++)$.push(c[4*m[u]+x]);if(null!=I)for(let x=0;x<4;x++)H.push(I[4*m[u]+x]);if(null!=L)for(let x=0;x<4;x++)f.push(L[4*m[u]+x])}k.push(N)}}const b=new Array;j.P.ComputeNormals(J,k,b),u.positions=J,u.indices=k,u.normals=b,null!=x&&(u.uvs=i),null!=_&&(u.colors=r),null!=W&&(u.matricesIndices=D),null!=c&&(u.matricesWeights=$),null!=I&&(u.matricesIndicesExtra=H),null!=c&&(u.matricesWeightsExtra=f),u.applyToMesh(this,this.isVertexBufferUpdatable(d.R.PositionKind))}}static _instancedMeshFactory(u,x){throw m.n("InstancedMesh")}static _PhysicsImpostorParser(u,x,s){throw m.n("PhysicsImpostor")}createInstance(u){return e._instancedMeshFactory(u,this)}synchronizeInstances(){for(let u=0;u<this.instances.length;u++)this.instances[u]._syncSubMeshes();return this}optimizeIndices(u){const x=this.getIndices(),s=this.getVerticesData(d.R.PositionKind);if(!s||!x)return this;const U=[];for(let u=0;u<s.length;u+=3)U.push(J.Pq.FromArray(s,u));const W=[];return _.LV.SyncAsyncForLoop(U.length,40,(u=>{const x=U.length-1-u,s=U[x];for(let u=0;u<x;++u){const _=U[u];if(s.equals(_)){W[x]=u;break}}}),(()=>{for(let u=0;u<x.length;++u)x[u]=W[x[u]]||x[u];const s=this.subMeshes.slice(0);this.setIndices(x),this.subMeshes=s,u&&u(this)})),this}serialize(u={}){u.name=this.name,u.id=this.id,u.uniqueId=this.uniqueId,u.type=this.getClassName(),c.Y&&c.Y.HasTags(this)&&(u.tags=c.Y.GetTags(this)),u.position=this.position.asArray(),this.rotationQuaternion?u.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(u.rotation=this.rotation.asArray()),u.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?u.pivotMatrix=this.getPivotMatrix().asArray():u.localMatrix=this.getPivotMatrix().asArray(),u.isEnabled=this.isEnabled(!1),u.isVisible=this.isVisible,u.infiniteDistance=this.infiniteDistance,u.pickable=this.isPickable,u.receiveShadows=this.receiveShadows,u.billboardMode=this.billboardMode,u.visibility=this.visibility,u.alwaysSelectAsActiveMesh=this.alwaysSelectAsActiveMesh,u.checkCollisions=this.checkCollisions,u.ellipsoid=this.ellipsoid.asArray(),u.ellipsoidOffset=this.ellipsoidOffset.asArray(),u.doNotSyncBoundingInfo=this.doNotSyncBoundingInfo,u.isBlocker=this.isBlocker,u.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(u),u.isUnIndexed=this.isUnIndexed;const x=this._geometry;if(x&&this.subMeshes){u.geometryUniqueId=x.uniqueId,u.geometryId=x.id,u.subMeshes=[];for(let x=0;x<this.subMeshes.length;x++){const s=this.subMeshes[x];u.subMeshes.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(u.materialUniqueId=this.material.uniqueId,u.materialId=this.material.id):(this.material=null,u.materialUniqueId=this._scene.defaultMaterial.uniqueId,u.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(u.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(u.skeletonId=this.skeleton.id,u.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(b.v.NAME_PHYSICSENGINE)){const x=this.getPhysicsImpostor();x&&(u.physicsMass=x.getParam("mass"),u.physicsFriction=x.getParam("friction"),u.physicsRestitution=x.getParam("mass"),u.physicsImpostor=x.type)}this.metadata&&(u.metadata=this.metadata),u.instances=[];for(let x=0;x<this.instances.length;x++){const s=this.instances[x];if(s.doNotSerialize)continue;const U={name:s.name,id:s.id,isEnabled:s.isEnabled(!1),isVisible:s.isVisible,isPickable:s.isPickable,checkCollisions:s.checkCollisions,position:s.position.asArray(),scaling:s.scaling.asArray()};if(s.parent&&s.parent._serializeAsParent(U),s.rotationQuaternion?U.rotationQuaternion=s.rotationQuaternion.asArray():s.rotation&&(U.rotation=s.rotation.asArray()),this.getScene()._getComponent(b.v.NAME_PHYSICSENGINE)){const u=s.getPhysicsImpostor();u&&(U.physicsMass=u.getParam("mass"),U.physicsFriction=u.getParam("friction"),U.physicsRestitution=u.getParam("mass"),U.physicsImpostor=u.type)}s.metadata&&(U.metadata=s.metadata),s.actionManager&&(U.actions=s.actionManager.serialize(s.name)),u.instances.push(U),t.p.AppendSerializedAnimations(s,U),U.ranges=s.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(u.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const x={data:{},sizes:{},strides:{}};for(const u in this._userThinInstanceBuffersStorage.data)x.data[u]=Array.from(this._userThinInstanceBuffersStorage.data[u]),x.sizes[u]=this._userThinInstanceBuffersStorage.sizes[u],x.strides[u]=this._userThinInstanceBuffersStorage.strides[u];u.thinInstances.userThinInstance=x}return t.p.AppendSerializedAnimations(this,u),u.ranges=this.serializeAnimationRanges(),u.layerMask=this.layerMask,u.alphaIndex=this.alphaIndex,u.hasVertexAlpha=this.hasVertexAlpha,u.overlayAlpha=this.overlayAlpha,u.overlayColor=this.overlayColor.asArray(),u.renderOverlay=this.renderOverlay,u.applyFog=this.applyFog,this.actionManager&&(u.actions=this.actionManager.serialize(this.name)),u}_syncGeometryWithMorphTargetManager(){if(!this.geometry)return;this._markSubMeshesAsAttributesDirty();const u=this._internalAbstractMeshDataInfo._morphTargetManager;if(u&&u.vertexCount){if(u.vertexCount!==this.getTotalVertices())return V.V.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(u.isUsingTextureForTargets)return;for(let x=0;x<u.numInfluencers;x++){const s=u.getActiveTarget(x),U=s.getPositions();if(!U)return void V.V.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(d.R.PositionKind+x,U,!1,3);const _=s.getNormals();_&&this.geometry.setVerticesData(d.R.NormalKind+x,_,!1,3);const W=s.getTangents();W&&this.geometry.setVerticesData(d.R.TangentKind+x,W,!1,3);const c=s.getUVs();c&&this.geometry.setVerticesData(d.R.UVKind+"_"+x,c,!1,2)}}else{let u=0;for(;this.geometry.isVerticesDataPresent(d.R.PositionKind+u);)this.geometry.removeVerticesData(d.R.PositionKind+u),this.geometry.isVerticesDataPresent(d.R.NormalKind+u)&&this.geometry.removeVerticesData(d.R.NormalKind+u),this.geometry.isVerticesDataPresent(d.R.TangentKind+u)&&this.geometry.removeVerticesData(d.R.TangentKind+u),this.geometry.isVerticesDataPresent(d.R.UVKind+u)&&this.geometry.removeVerticesData(d.R.UVKind+"_"+u),u++}}static Parse(u,x,s){let U;if(U=u.type&&"LinesMesh"===u.type?e._LinesMeshParser(u,x):u.type&&"GroundMesh"===u.type?e._GroundMeshParser(u,x):u.type&&"GoldbergMesh"===u.type?e._GoldbergMeshParser(u,x):u.type&&"GreasedLineMesh"===u.type?e._GreasedLineMeshParser(u,x):u.type&&"TrailMesh"===u.type?e._TrailMeshParser(u,x):new e(u.name,x),U.id=u.id,U._waitingParsedUniqueId=u.uniqueId,c.Y&&c.Y.AddTagsTo(U,u.tags),U.position=J.Pq.FromArray(u.position),void 0!==u.metadata&&(U.metadata=u.metadata),u.rotationQuaternion?U.rotationQuaternion=J.PT.FromArray(u.rotationQuaternion):u.rotation&&(U.rotation=J.Pq.FromArray(u.rotation)),U.scaling=J.Pq.FromArray(u.scaling),u.localMatrix?U.setPreTransformMatrix(J.uq.FromArray(u.localMatrix)):u.pivotMatrix&&U.setPivotMatrix(J.uq.FromArray(u.pivotMatrix)),U.setEnabled(u.isEnabled),U.isVisible=u.isVisible,U.infiniteDistance=u.infiniteDistance,U.alwaysSelectAsActiveMesh=!!u.alwaysSelectAsActiveMesh,U.showBoundingBox=u.showBoundingBox,U.showSubMeshesBoundingBox=u.showSubMeshesBoundingBox,void 0!==u.applyFog&&(U.applyFog=u.applyFog),void 0!==u.pickable&&(U.isPickable=u.pickable),void 0!==u.alphaIndex&&(U.alphaIndex=u.alphaIndex),U.receiveShadows=u.receiveShadows,void 0!==u.billboardMode&&(U.billboardMode=u.billboardMode),void 0!==u.visibility&&(U.visibility=u.visibility),U.checkCollisions=u.checkCollisions,U.doNotSyncBoundingInfo=!!u.doNotSyncBoundingInfo,u.ellipsoid&&(U.ellipsoid=J.Pq.FromArray(u.ellipsoid)),u.ellipsoidOffset&&(U.ellipsoidOffset=J.Pq.FromArray(u.ellipsoidOffset)),null!=u.overrideMaterialSideOrientation&&(U.sideOrientation=u.overrideMaterialSideOrientation),void 0!==u.sideOrientation&&(U.sideOrientation=u.sideOrientation),void 0!==u.isBlocker&&(U.isBlocker=u.isBlocker),U._shouldGenerateFlatShading=u.useFlatShading,u.freezeWorldMatrix&&(U._waitingData.freezeWorldMatrix=u.freezeWorldMatrix),void 0!==u.parentId&&(U._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(U._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.actions&&(U._waitingData.actions=u.actions),void 0!==u.overlayAlpha&&(U.overlayAlpha=u.overlayAlpha),void 0!==u.overlayColor&&(U.overlayColor=k.v9.FromArray(u.overlayColor)),void 0!==u.renderOverlay&&(U.renderOverlay=u.renderOverlay),U.isUnIndexed=!!u.isUnIndexed,U.hasVertexAlpha=u.hasVertexAlpha,u.delayLoadingFile?(U.delayLoadState=4,U.delayLoadingFile=s+u.delayLoadingFile,U.buildBoundingInfo(J.Pq.FromArray(u.boundingBoxMinimum),J.Pq.FromArray(u.boundingBoxMaximum)),u._binaryInfo&&(U._binaryInfo=u._binaryInfo),U._delayInfo=[],u.hasUVs&&U._delayInfo.push(d.R.UVKind),u.hasUVs2&&U._delayInfo.push(d.R.UV2Kind),u.hasUVs3&&U._delayInfo.push(d.R.UV3Kind),u.hasUVs4&&U._delayInfo.push(d.R.UV4Kind),u.hasUVs5&&U._delayInfo.push(d.R.UV5Kind),u.hasUVs6&&U._delayInfo.push(d.R.UV6Kind),u.hasColors&&U._delayInfo.push(d.R.ColorKind),u.hasMatricesIndices&&U._delayInfo.push(d.R.MatricesIndicesKind),u.hasMatricesWeights&&U._delayInfo.push(d.R.MatricesWeightsKind),U._delayLoadingFunction=r.V._ImportGeometry,O.B.ForceFullSceneLoadingForIncremental&&U._checkDelayState()):r.V._ImportGeometry(u,U),u.materialUniqueId?U._waitingMaterialId=u.materialUniqueId:u.materialId&&(U._waitingMaterialId=u.materialId),u.morphTargetManagerId>-1&&(U.morphTargetManager=x.getMorphTargetManagerById(u.morphTargetManagerId)),void 0!==u.skeletonId&&null!==u.skeletonId&&(U.skeleton=x.getLastSkeletonById(u.skeletonId),u.numBoneInfluencers&&(U.numBoneInfluencers=u.numBoneInfluencers)),u.animations){for(let x=0;x<u.animations.length;x++){const s=u.animations[x],_=N.n9("BABYLON.Animation");_&&U.animations.push(_.Parse(s))}i.b.ParseAnimationRanges(U,u,x)}if(u.autoAnimate&&x.beginAnimation(U,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),u.layerMask&&!isNaN(u.layerMask)?U.layerMask=Math.abs(parseInt(u.layerMask)):U.layerMask=268435455,u.physicsImpostor&&(U.physicsImpostor=e._PhysicsImpostorParser(x,U,u)),u.lodMeshIds&&(U._waitingData.lods={ids:u.lodMeshIds,distances:u.lodDistances?u.lodDistances:null,coverages:u.lodCoverages?u.lodCoverages:null}),u.instances)for(let s=0;s<u.instances.length;s++){const _=u.instances[s],W=U.createInstance(_.name);if(_.id&&(W.id=_.id),c.Y&&(_.tags?c.Y.AddTagsTo(W,_.tags):c.Y.AddTagsTo(W,u.tags)),W.position=J.Pq.FromArray(_.position),void 0!==_.metadata&&(W.metadata=_.metadata),void 0!==_.parentId&&(W._waitingParentId=_.parentId),void 0!==_.parentInstanceIndex&&(W._waitingParentInstanceIndex=_.parentInstanceIndex),void 0!==_.isEnabled&&null!==_.isEnabled&&W.setEnabled(_.isEnabled),void 0!==_.isVisible&&null!==_.isVisible&&(W.isVisible=_.isVisible),void 0!==_.isPickable&&null!==_.isPickable&&(W.isPickable=_.isPickable),_.rotationQuaternion?W.rotationQuaternion=J.PT.FromArray(_.rotationQuaternion):_.rotation&&(W.rotation=J.Pq.FromArray(_.rotation)),W.scaling=J.Pq.FromArray(_.scaling),null!=_.checkCollisions&&null!=_.checkCollisions&&(W.checkCollisions=_.checkCollisions),null!=_.pickable&&null!=_.pickable&&(W.isPickable=_.pickable),null!=_.showBoundingBox&&null!=_.showBoundingBox&&(W.showBoundingBox=_.showBoundingBox),null!=_.showSubMeshesBoundingBox&&null!=_.showSubMeshesBoundingBox&&(W.showSubMeshesBoundingBox=_.showSubMeshesBoundingBox),null!=_.alphaIndex&&null!=_.showSubMeshesBoundingBox&&(W.alphaIndex=_.alphaIndex),_.physicsImpostor&&(W.physicsImpostor=e._PhysicsImpostorParser(x,W,_)),void 0!==_.actions&&(W._waitingData.actions=_.actions),_.animations){for(let u=0;u<_.animations.length;u++){const x=_.animations[u],s=N.n9("BABYLON.Animation");s&&W.animations.push(s.Parse(x))}i.b.ParseAnimationRanges(W,_,x),_.autoAnimate&&x.beginAnimation(W,_.autoAnimateFrom,_.autoAnimateTo,_.autoAnimateLoop,_.autoAnimateSpeed||1)}}if(u.thinInstances){const x=u.thinInstances;if(U.thinInstanceEnablePicking=!!x.enablePicking,x.matrixData?(U.thinInstanceSetBuffer("matrix",new Float32Array(x.matrixData),16,!1),U._thinInstanceDataStorage.matrixBufferSize=x.matrixBufferSize,U._thinInstanceDataStorage.instancesCount=x.instancesCount):U._thinInstanceDataStorage.matrixBufferSize=x.matrixBufferSize,u.thinInstances.userThinInstance){const x=u.thinInstances.userThinInstance;for(const u in x.data)U.thinInstanceSetBuffer(u,new Float32Array(x.data[u]),x.strides[u],!1),U._userThinInstanceBuffersStorage.sizes[u]=x.sizes[u]}}return U}setPositionsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourcePositions){const x=this.getVerticesData(d.R.PositionKind);if(!x)return u._sourcePositions;u._sourcePositions=new Float32Array(x),this.isVertexBufferUpdatable(d.R.PositionKind)||this.setVerticesData(d.R.PositionKind,x,!0)}return u._sourcePositions}setNormalsForCPUSkinning(){const u=this._internalMeshDataInfo;if(!u._sourceNormals){const x=this.getVerticesData(d.R.NormalKind);if(!x)return u._sourceNormals;u._sourceNormals=new Float32Array(x),this.isVertexBufferUpdatable(d.R.NormalKind)||this.setVerticesData(d.R.NormalKind,x,!0)}return u._sourceNormals}applySkeleton(u){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(d.R.PositionKind))return this;if(!this.isVerticesDataPresent(d.R.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(d.R.MatricesWeightsKind))return this;const x=this.isVerticesDataPresent(d.R.NormalKind),s=this._internalMeshDataInfo;if(!s._sourcePositions){const u=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=u}x&&!s._sourceNormals&&this.setNormalsForCPUSkinning();let U=this.getVerticesData(d.R.PositionKind);if(!U)return this;U instanceof Float32Array||(U=new Float32Array(U));let _=this.getVerticesData(d.R.NormalKind);if(x){if(!_)return this;_ instanceof Float32Array||(_=new Float32Array(_))}const W=this.getVerticesData(d.R.MatricesIndicesKind),c=this.getVerticesData(d.R.MatricesWeightsKind);if(!c||!W)return this;const I=this.numBoneInfluencers>4,L=I?this.getVerticesData(d.R.MatricesIndicesExtraKind):null,k=I?this.getVerticesData(d.R.MatricesWeightsExtraKind):null,i=u.getTransformMatrices(this),j=J.Pq.Zero(),r=new J.uq,D=new J.uq;let $,H=0;for(let u=0;u<U.length;u+=3,H+=4){let d;for($=0;$<4;$++)d=c[H+$],d>0&&(J.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*W[H+$]),d,D),r.addToSelf(D));if(I)for($=0;$<4;$++)d=k[H+$],d>0&&(J.uq.FromFloat32ArrayToRefScaled(i,Math.floor(16*L[H+$]),d,D),r.addToSelf(D));J.Pq.TransformCoordinatesFromFloatsToRef(s._sourcePositions[u],s._sourcePositions[u+1],s._sourcePositions[u+2],r,j),j.toArray(U,u),x&&(J.Pq.TransformNormalFromFloatsToRef(s._sourceNormals[u],s._sourceNormals[u+1],s._sourceNormals[u+2],r,j),j.toArray(_,u)),r.reset()}return this.updateVerticesData(d.R.PositionKind,U),x&&this.updateVerticesData(d.R.NormalKind,_),this}static MinMax(u){let x=null,s=null;return u.forEach((function(u){const U=u.getBoundingInfo().boundingBox;x&&s?(x.minimizeInPlace(U.minimumWorld),s.maximizeInPlace(U.maximumWorld)):(x=U.minimumWorld,s=U.maximumWorld)})),x&&s?{min:x,max:s}:{min:J.Pq.Zero(),max:J.Pq.Zero()}}static Center(u){const x=u instanceof Array?e.MinMax(u):u;return J.Pq.Center(x.min,x.max)}static MergeMeshes(u,x=!0,s,U,_,W){return I.V1(e._MergeMeshesCoroutine(u,x,s,U,_,W,!1))}static MergeMeshesAsync(u,x=!0,s,U,_,W){return I.kj(e._MergeMeshesCoroutine(u,x,s,U,_,W,!0),I.VP())}static*_MergeMeshesCoroutine(u,x=!0,s,U,_,W,c){if(0===(u=u.filter(Boolean)).length)return null;let I;if(!s){let x=0;for(I=0;I<u.length;I++)if(x+=u[I].getTotalVertices(),x>=65536)return V.V.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}W&&(_=!1);const L=new Array,J=new Array,k=new Array,i=u[0].sideOrientation;for(I=0;I<u.length;I++){const x=u[I];if(x.isAnInstance)return V.V.Warn("Cannot merge instance meshes."),null;if(i!==x.sideOrientation)return V.V.Warn("Cannot merge meshes with different sideOrientation values."),null;if(_&&k.push(x.getTotalIndices()),W)if(x.material){const u=x.material;if(u instanceof f.F){for(let x=0;x<u.subMaterials.length;x++)L.indexOf(u.subMaterials[x])<0&&L.push(u.subMaterials[x]);for(let s=0;s<x.subMeshes.length;s++)J.push(L.indexOf(u.subMaterials[x.subMeshes[s].materialIndex])),k.push(x.subMeshes[s].indexCount)}else{L.indexOf(u)<0&&L.push(u);for(let s=0;s<x.subMeshes.length;s++)J.push(L.indexOf(u)),k.push(x.subMeshes[s].indexCount)}}else for(let u=0;u<x.subMeshes.length;u++)J.push(0),k.push(x.subMeshes[u].indexCount)}const d=u[0],r=u=>{const x=u.computeWorldMatrix(!0);return{vertexData:j.P.ExtractFromMesh(u,!1,!1),transform:x}},{vertexData:D,transform:H}=r(d);c&&(yield);const O=new Array(u.length-1);for(let x=1;x<u.length;x++)O[x-1]=r(u[x]),c&&(yield);const t=D._mergeCoroutine(H,O,s,c,!x);let N=t.next();for(;!N.done;)c&&(yield),N=t.next();const m=N.value;U||(U=new e(d.name+"_merged",d.getScene()));const b=m._applyToCoroutine(U,void 0,c);let n=b.next();for(;!n.done;)c&&(yield),n=b.next();if(U.checkCollisions=d.checkCollisions,U.sideOrientation=d.sideOrientation,x)for(I=0;I<u.length;I++)u[I].dispose();if(_||W){U.releaseSubMeshes(),I=0;let u=0;for(;I<k.length;)$.K.CreateFromIndices(0,u,k[I],U,void 0,!1),u+=k[I],I++;for(const u of U.subMeshes)u.refreshBoundingInfo();U.computeWorldMatrix(!0)}if(W){const u=new f.F(d.name+"_merged",d.getScene());u.subMaterials=L;for(let u=0;u<U.subMeshes.length;u++)U.subMeshes[u].materialIndex=J[u];U.material=u}else U.material=d.material;return U}addInstance(u){u._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(u)}removeInstance(u){const x=u._indexInSourceMeshInstanceArray;if(-1!=x){if(x!==this.instances.length-1){const u=this.instances[this.instances.length-1];this.instances[x]=u,u._indexInSourceMeshInstanceArray=x}u._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===H.i.CounterClockWiseSideOrientation}_getRenderingFillMode(u){var x;const s=this.getScene();return s.forcePointsCloud?H.i.PointFillMode:s.forceWireframe?H.i.WireFrameFillMode:null!==(x=this.overrideRenderingFillMode)&&void 0!==x?x:u}setMaterialByID(u){return this.setMaterialById(u)}static CreateRibbon(u,x,s,U,_,W,c,I,L){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(u,x,s,U,_,W){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(u,x,s,U,_){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(u,x,s,U,_,W){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(u,x,s,U){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(u,x,s,U,_,W,c,I,L){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(u,x,s,U,_,W,c){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(u,x,s,U,_,W,c,I,L,J){throw new Error("Import MeshBuilder to populate this function")}static CreateLines(u,x,s,U,_){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(u,x,s,U,_,W,c,I){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(u,x,s,U,_,W,c){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(u,x,s,U,_,W,c,I){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(u,x,s,U,_,W,c,I,L,J){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(u,x,s,U,_,W,c,I,L,J,k,i){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(u,x,s,U,_,W,c){throw new Error("Import MeshBuilder to populate this function")}static CreatePlane(u,x,s,U,_){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(u,x,s,U,_,W){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(u,x,s,U,_,W,c,I,L){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(u,x,s,U,_,W,c,I,L,J,k){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(u,x,s,U,_,W,c,I,L,J){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(u,x,s){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(u,x,s){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(u,x,s,U,_,W){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(u,x,s){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(u){throw new Error("Import MeshBuilder to populate this function")}}e.FRONTSIDE=j.P.FRONTSIDE,e.BACKSIDE=j.P.BACKSIDE,e.DOUBLESIDE=j.P.DOUBLESIDE,e.DEFAULTSIDE=j.P.DEFAULTSIDE,e.NO_CAP=0,e.CAP_START=1,e.CAP_END=2,e.CAP_ALL=3,e.NO_FLIP=0,e.FLIP_TILE=1,e.ROTATE_TILE=2,e.FLIP_ROW=3,e.ROTATE_ROW=4,e.FLIP_N_ROTATE_TILE=5,e.FLIP_N_ROTATE_ROW=6,e.CENTER=0,e.LEFT=1,e.RIGHT=2,e.TOP=3,e.BOTTOM=4,e.INSTANCEDMESH_SORT_TRANSPARENT=!1,e._GroundMeshParser=(u,x)=>{throw m.n("GroundMesh")},e._GoldbergMeshParser=(u,x)=>{throw m.n("GoldbergMesh")},e._LinesMeshParser=(u,x)=>{throw m.n("LinesMesh")},e._GreasedLineMeshParser=(u,x)=>{throw m.n("GreasedLineMesh")},e._GreasedLineRibbonMeshParser=(u,x)=>{throw m.n("GreasedLineRibbonMesh")},e._TrailMeshParser=(u,x)=>{throw m.n("TrailMesh")},N.Y5("BABYLON.Mesh",e)},818696:(u,x,s)=>{s.d(x,{P:()=>r,o:()=>j});var U=s(297809),_=s(604910),W=s(23987),c=s(554014),I=s(332290),L=s(706400),J=s(760998),k=s(378480),i=s(879808),d=s(374216);class j{}class r{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=k.Aj(this._applyToCoroutine.bind(this)),this.uniqueId=r._UniqueIDGenerator,r._UniqueIDGenerator++}set(u,x){switch(u.length||L.V.Warn(`Setting vertex data kind '${x}' with an empty array`),x){case W.R.PositionKind:this.positions=u;break;case W.R.NormalKind:this.normals=u;break;case W.R.TangentKind:this.tangents=u;break;case W.R.UVKind:this.uvs=u;break;case W.R.UV2Kind:this.uvs2=u;break;case W.R.UV3Kind:this.uvs3=u;break;case W.R.UV4Kind:this.uvs4=u;break;case W.R.UV5Kind:this.uvs5=u;break;case W.R.UV6Kind:this.uvs6=u;break;case W.R.ColorKind:this.colors=u;break;case W.R.MatricesIndicesKind:this.matricesIndices=u;break;case W.R.MatricesWeightsKind:this.matricesWeights=u;break;case W.R.MatricesIndicesExtraKind:this.matricesIndicesExtra=u;break;case W.R.MatricesWeightsExtraKind:this.matricesWeightsExtra=u}}applyToMesh(u,x){return this._applyTo(u,x,!1),this}applyToGeometry(u,x){return this._applyTo(u,x,!1),this}updateMesh(u){return this._update(u),this}updateGeometry(u){return this._update(u),this}*_applyToCoroutine(u,x=!1,s){if(this.positions&&(u.setVerticesData(W.R.PositionKind,this.positions,x),s&&(yield)),this.normals&&(u.setVerticesData(W.R.NormalKind,this.normals,x),s&&(yield)),this.tangents&&(u.setVerticesData(W.R.TangentKind,this.tangents,x),s&&(yield)),this.uvs&&(u.setVerticesData(W.R.UVKind,this.uvs,x),s&&(yield)),this.uvs2&&(u.setVerticesData(W.R.UV2Kind,this.uvs2,x),s&&(yield)),this.uvs3&&(u.setVerticesData(W.R.UV3Kind,this.uvs3,x),s&&(yield)),this.uvs4&&(u.setVerticesData(W.R.UV4Kind,this.uvs4,x),s&&(yield)),this.uvs5&&(u.setVerticesData(W.R.UV5Kind,this.uvs5,x),s&&(yield)),this.uvs6&&(u.setVerticesData(W.R.UV6Kind,this.uvs6,x),s&&(yield)),this.colors&&(u.setVerticesData(W.R.ColorKind,this.colors,x),this.hasVertexAlpha&&void 0!==u.hasVertexAlpha&&(u.hasVertexAlpha=!0),s&&(yield)),this.matricesIndices&&(u.setVerticesData(W.R.MatricesIndicesKind,this.matricesIndices,x),s&&(yield)),this.matricesWeights&&(u.setVerticesData(W.R.MatricesWeightsKind,this.matricesWeights,x),s&&(yield)),this.matricesIndicesExtra&&(u.setVerticesData(W.R.MatricesIndicesExtraKind,this.matricesIndicesExtra,x),s&&(yield)),this.matricesWeightsExtra&&(u.setVerticesData(W.R.MatricesWeightsExtraKind,this.matricesWeightsExtra,x),s&&(yield)),this.indices?(u.setIndices(this.indices,null,x),s&&(yield)):u.setIndices([],null),u.subMeshes&&this.materialInfos&&this.materialInfos.length>1){const x=u;x.subMeshes=[];for(const u of this.materialInfos)new d.K(u.materialIndex,u.verticesStart,u.verticesCount,u.indexStart,u.indexCount,x)}return this}_update(u,x,s){return this.positions&&u.updateVerticesData(W.R.PositionKind,this.positions,x,s),this.normals&&u.updateVerticesData(W.R.NormalKind,this.normals,x,s),this.tangents&&u.updateVerticesData(W.R.TangentKind,this.tangents,x,s),this.uvs&&u.updateVerticesData(W.R.UVKind,this.uvs,x,s),this.uvs2&&u.updateVerticesData(W.R.UV2Kind,this.uvs2,x,s),this.uvs3&&u.updateVerticesData(W.R.UV3Kind,this.uvs3,x,s),this.uvs4&&u.updateVerticesData(W.R.UV4Kind,this.uvs4,x,s),this.uvs5&&u.updateVerticesData(W.R.UV5Kind,this.uvs5,x,s),this.uvs6&&u.updateVerticesData(W.R.UV6Kind,this.uvs6,x,s),this.colors&&u.updateVerticesData(W.R.ColorKind,this.colors,x,s),this.matricesIndices&&u.updateVerticesData(W.R.MatricesIndicesKind,this.matricesIndices,x,s),this.matricesWeights&&u.updateVerticesData(W.R.MatricesWeightsKind,this.matricesWeights,x,s),this.matricesIndicesExtra&&u.updateVerticesData(W.R.MatricesIndicesExtraKind,this.matricesIndicesExtra,x,s),this.matricesWeightsExtra&&u.updateVerticesData(W.R.MatricesWeightsExtraKind,this.matricesWeightsExtra,x,s),this.indices&&u.setIndices(this.indices,null),this}static _TransformVector3Coordinates(u,x,s=0,U=u.length){const W=_.AA.Vector3[0],c=_.AA.Vector3[1];for(let I=s;I<s+U;I+=3)_.Pq.FromArrayToRef(u,I,W),_.Pq.TransformCoordinatesToRef(W,x,c),u[I]=c.x,u[I+1]=c.y,u[I+2]=c.z}static _TransformVector3Normals(u,x,s=0,U=u.length){const W=_.AA.Vector3[0],c=_.AA.Vector3[1];for(let I=s;I<s+U;I+=3)_.Pq.FromArrayToRef(u,I,W),_.Pq.TransformNormalToRef(W,x,c),u[I]=c.x,u[I+1]=c.y,u[I+2]=c.z}static _TransformVector4Normals(u,x,s=0,U=u.length){const W=_.AA.Vector4[0],c=_.AA.Vector4[1];for(let I=s;I<s+U;I+=4)_.IU.FromArrayToRef(u,I,W),_.IU.TransformNormalToRef(W,x,c),u[I]=c.x,u[I+1]=c.y,u[I+2]=c.z,u[I+3]=c.w}static _FlipFaces(u,x=0,s=u.length){for(let U=x;U<x+s;U+=3){const x=u[U+1];u[U+1]=u[U+2],u[U+2]=x}}transform(u){const x=u.determinant()<0;return this.positions&&r._TransformVector3Coordinates(this.positions,u),this.normals&&r._TransformVector3Normals(this.normals,u),this.tangents&&r._TransformVector4Normals(this.tangents,u),x&&this.indices&&r._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const u=[];for(const x of this.materialInfos){const s=new r;if(this.positions&&(s.positions=this.positions.slice(3*x.verticesStart,3*(x.verticesCount+x.verticesStart))),this.normals&&(s.normals=this.normals.slice(3*x.verticesStart,3*(x.verticesCount+x.verticesStart))),this.tangents&&(s.tangents=this.tangents.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.colors&&(s.colors=this.colors.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.uvs&&(s.uvs=this.uvs.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.uvs2&&(s.uvs2=this.uvs2.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.uvs3&&(s.uvs3=this.uvs3.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.uvs4&&(s.uvs4=this.uvs4.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.uvs5&&(s.uvs5=this.uvs5.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.uvs6&&(s.uvs6=this.uvs6.slice(2*x.verticesStart,2*(x.verticesCount+x.verticesStart))),this.matricesIndices&&(s.matricesIndices=this.matricesIndices.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.matricesIndicesExtra&&(s.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.matricesWeights&&(s.matricesWeights=this.matricesWeights.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.matricesWeightsExtra&&(s.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*x.verticesStart,4*(x.verticesCount+x.verticesStart))),this.indices){s.indices=[];for(let u=x.indexStart;u<x.indexStart+x.indexCount;u++)s.indices.push(this.indices[u]-x.verticesStart)}const U=new j;U.indexStart=0,U.indexCount=s.indices?s.indices.length:0,U.materialIndex=x.materialIndex,U.verticesStart=0,U.verticesCount=(s.positions?s.positions.length:0)/3,s.materialInfos=[U],u.push(s)}return u}merge(u,x=!1,s=!1,U=!1,_=!1){const W=Array.isArray(u)?u.map((u=>({vertexData:u}))):[{vertexData:u}];return k.V1(this._mergeCoroutine(void 0,W,x,!1,s,U,_))}*_mergeCoroutine(u,x,s=!1,U,_,c=!1,I=!1){var L,J,k,i;this._validate();let d=x.map((u=>u.vertexData)),D=this;if(I)for(const u of d)u&&(u._validate(),!this.normals&&u.normals&&(this.normals=new Float32Array(this.positions.length)),!this.tangents&&u.tangents&&(this.tangents=new Float32Array(this.positions.length/3*4)),!this.uvs&&u.uvs&&(this.uvs=new Float32Array(this.positions.length/3*2)),!this.uvs2&&u.uvs2&&(this.uvs2=new Float32Array(this.positions.length/3*2)),!this.uvs3&&u.uvs3&&(this.uvs3=new Float32Array(this.positions.length/3*2)),!this.uvs4&&u.uvs4&&(this.uvs4=new Float32Array(this.positions.length/3*2)),!this.uvs5&&u.uvs5&&(this.uvs5=new Float32Array(this.positions.length/3*2)),!this.uvs6&&u.uvs6&&(this.uvs6=new Float32Array(this.positions.length/3*2)),!this.colors&&u.colors&&(this.colors=new Float32Array(this.positions.length/3*4),this.colors.fill(1)),!this.matricesIndices&&u.matricesIndices&&(this.matricesIndices=new Float32Array(this.positions.length/3*4)),!this.matricesWeights&&u.matricesWeights&&(this.matricesWeights=new Float32Array(this.positions.length/3*4)),!this.matricesIndicesExtra&&u.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.positions.length/3*4)),!this.matricesWeightsExtra&&u.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.positions.length/3*4)));for(const u of d)if(u)if(I)this.normals&&!u.normals&&(u.normals=new Float32Array(u.positions.length)),this.tangents&&!u.tangents&&(u.tangents=new Float32Array(u.positions.length/3*4)),this.uvs&&!u.uvs&&(u.uvs=new Float32Array(u.positions.length/3*2)),this.uvs2&&!u.uvs2&&(u.uvs2=new Float32Array(u.positions.length/3*2)),this.uvs3&&!u.uvs3&&(u.uvs3=new Float32Array(u.positions.length/3*2)),this.uvs4&&!u.uvs4&&(u.uvs4=new Float32Array(u.positions.length/3*2)),this.uvs5&&!u.uvs5&&(u.uvs5=new Float32Array(u.positions.length/3*2)),this.uvs6&&!u.uvs6&&(u.uvs6=new Float32Array(u.positions.length/3*2)),this.colors&&!u.colors&&(u.colors=new Float32Array(u.positions.length/3*4),u.colors.fill(1)),this.matricesIndices&&!u.matricesIndices&&(u.matricesIndices=new Float32Array(u.positions.length/3*4)),this.matricesWeights&&!u.matricesWeights&&(u.matricesWeights=new Float32Array(u.positions.length/3*4)),this.matricesIndicesExtra&&!u.matricesIndicesExtra&&(u.matricesIndicesExtra=new Float32Array(u.positions.length/3*4)),this.matricesWeightsExtra&&!u.matricesWeightsExtra&&(u.matricesWeightsExtra=new Float32Array(u.positions.length/3*4));else if(u._validate(),!this.normals!=!u.normals||!this.tangents!=!u.tangents||!this.uvs!=!u.uvs||!this.uvs2!=!u.uvs2||!this.uvs3!=!u.uvs3||!this.uvs4!=!u.uvs4||!this.uvs5!=!u.uvs5||!this.uvs6!=!u.uvs6||!this.colors!=!u.colors||!this.matricesIndices!=!u.matricesIndices||!this.matricesWeights!=!u.matricesWeights||!this.matricesIndicesExtra!=!u.matricesIndicesExtra||!this.matricesWeightsExtra!=!u.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(c){let s=0,U=0,_=0;const W=[];let c=null;const I=[];for(const x of this.splitBasedOnMaterialID())I.push({vertexData:x,transform:u});for(const u of x)if(u.vertexData)for(const x of u.vertexData.splitBasedOnMaterialID())I.push({vertexData:x,transform:u.transform});I.sort(((u,x)=>{const s=u.vertexData.materialInfos?u.vertexData.materialInfos[0].materialIndex:0,U=x.vertexData.materialInfos?x.vertexData.materialInfos[0].materialIndex:0;return s>U?1:s===U?0:-1}));for(const u of I){const x=u.vertexData;if(s=x.materialInfos?x.materialInfos[0].materialIndex:0,c&&c.materialIndex===s)c.indexCount+=x.indices.length,c.verticesCount+=x.positions.length/3;else{const u=new j;u.materialIndex=s,u.indexStart=U,u.indexCount=x.indices.length,u.verticesStart=_,u.verticesCount=x.positions.length/3,W.push(u),c=u}U+=x.indices.length,_+=x.positions.length/3}const L=I.splice(0,1)[0];D=L.vertexData,u=L.transform,d=I.map((u=>u.vertexData)),x=I,this.materialInfos=W}const $=d.reduce(((u,x)=>{var s,U;return u+(null!==(U=null===(s=x.indices)||void 0===s?void 0:s.length)&&void 0!==U?U:0)}),null!==(J=null===(L=D.indices)||void 0===L?void 0:L.length)&&void 0!==J?J:0);let H=_||d.some((u=>u.indices===D.indices))?null===(k=D.indices)||void 0===k?void 0:k.slice():D.indices;if($>0){let _=null!==(i=null==H?void 0:H.length)&&void 0!==i?i:0;if(H||(H=new Array($)),H.length!==$){if(Array.isArray(H))H.length=$;else{const u=s||H instanceof Uint32Array?new Uint32Array($):new Uint16Array($);u.set(H),H=u}u&&u.determinant()<0&&r._FlipFaces(H,0,_)}let W=D.positions?D.positions.length/3:0;for(const{vertexData:u,transform:s}of x)if(u.indices){for(let x=0;x<u.indices.length;x++)H[_+x]=u.indices[x]+W;s&&s.determinant()<0&&r._FlipFaces(H,_,u.indices.length),W+=u.positions.length/3,_+=u.indices.length,U&&(yield)}}return this.indices=H,this.positions=r._MergeElement(W.R.PositionKind,D.positions,u,x.map((u=>[u.vertexData.positions,u.transform]))),U&&(yield),D.normals&&(this.normals=r._MergeElement(W.R.NormalKind,D.normals,u,x.map((u=>[u.vertexData.normals,u.transform]))),U&&(yield)),D.tangents&&(this.tangents=r._MergeElement(W.R.TangentKind,D.tangents,u,x.map((u=>[u.vertexData.tangents,u.transform]))),U&&(yield)),D.uvs&&(this.uvs=r._MergeElement(W.R.UVKind,D.uvs,u,x.map((u=>[u.vertexData.uvs,u.transform]))),U&&(yield)),D.uvs2&&(this.uvs2=r._MergeElement(W.R.UV2Kind,D.uvs2,u,x.map((u=>[u.vertexData.uvs2,u.transform]))),U&&(yield)),D.uvs3&&(this.uvs3=r._MergeElement(W.R.UV3Kind,D.uvs3,u,x.map((u=>[u.vertexData.uvs3,u.transform]))),U&&(yield)),D.uvs4&&(this.uvs4=r._MergeElement(W.R.UV4Kind,D.uvs4,u,x.map((u=>[u.vertexData.uvs4,u.transform]))),U&&(yield)),D.uvs5&&(this.uvs5=r._MergeElement(W.R.UV5Kind,D.uvs5,u,x.map((u=>[u.vertexData.uvs5,u.transform]))),U&&(yield)),D.uvs6&&(this.uvs6=r._MergeElement(W.R.UV6Kind,D.uvs6,u,x.map((u=>[u.vertexData.uvs6,u.transform]))),U&&(yield)),D.colors&&(this.colors=r._MergeElement(W.R.ColorKind,D.colors,u,x.map((u=>[u.vertexData.colors,u.transform]))),(void 0!==D.hasVertexAlpha||x.some((u=>void 0!==u.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=D.hasVertexAlpha||x.some((u=>u.vertexData.hasVertexAlpha))),U&&(yield)),D.matricesIndices&&(this.matricesIndices=r._MergeElement(W.R.MatricesIndicesKind,D.matricesIndices,u,x.map((u=>[u.vertexData.matricesIndices,u.transform]))),U&&(yield)),D.matricesWeights&&(this.matricesWeights=r._MergeElement(W.R.MatricesWeightsKind,D.matricesWeights,u,x.map((u=>[u.vertexData.matricesWeights,u.transform]))),U&&(yield)),D.matricesIndicesExtra&&(this.matricesIndicesExtra=r._MergeElement(W.R.MatricesIndicesExtraKind,D.matricesIndicesExtra,u,x.map((u=>[u.vertexData.matricesIndicesExtra,u.transform]))),U&&(yield)),D.matricesWeightsExtra&&(this.matricesWeightsExtra=r._MergeElement(W.R.MatricesWeightsExtraKind,D.matricesWeightsExtra,u,x.map((u=>[u.vertexData.matricesWeightsExtra,u.transform])))),this}static _MergeElement(u,x,s,U){const _=U.filter((u=>null!==u[0]&&void 0!==u[0]));if(!x&&0==_.length)return x;if(!x)return this._MergeElement(u,_[0][0],_[0][1],_.slice(1));const c=_.reduce(((u,x)=>u+x[0].length),x.length),I=u===W.R.PositionKind?r._TransformVector3Coordinates:u===W.R.NormalKind?r._TransformVector3Normals:u===W.R.TangentKind?r._TransformVector4Normals:()=>{};if(x instanceof Float32Array){const u=new Float32Array(c);u.set(x),s&&I(u,s,0,x.length);let U=x.length;for(const[x,s]of _)u.set(x,U),s&&I(u,s,U,x.length),U+=x.length;return u}{const u=new Array(c);for(let s=0;s<x.length;s++)u[s]=x[s];s&&I(u,s,0,x.length);let U=x.length;for(const[x,s]of _){for(let s=0;s<x.length;s++)u[U+s]=x[s];s&&I(u,s,U,x.length),U+=x.length}return u}}_validate(){if(!this.positions)throw new i.bu("Positions are required",i.tG.MeshInvalidPositionsError);const u=(u,x)=>{const s=W.R.DeduceStride(u);if(x.length%s!=0)throw new Error("The "+u+"s array count must be a multiple of "+s);return x.length/s},x=u(W.R.PositionKind,this.positions),s=(s,U)=>{const _=u(s,U);if(_!==x)throw new Error("The "+s+"s element count ("+_+") does not match the positions count ("+x+")")};this.normals&&s(W.R.NormalKind,this.normals),this.tangents&&s(W.R.TangentKind,this.tangents),this.uvs&&s(W.R.UVKind,this.uvs),this.uvs2&&s(W.R.UV2Kind,this.uvs2),this.uvs3&&s(W.R.UV3Kind,this.uvs3),this.uvs4&&s(W.R.UV4Kind,this.uvs4),this.uvs5&&s(W.R.UV5Kind,this.uvs5),this.uvs6&&s(W.R.UV6Kind,this.uvs6),this.colors&&s(W.R.ColorKind,this.colors),this.matricesIndices&&s(W.R.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&s(W.R.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&s(W.R.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&s(W.R.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const u=this.serialize();return r.Parse(u)}serialize(){const u={};if(this.positions&&(u.positions=Array.from(this.positions)),this.normals&&(u.normals=Array.from(this.normals)),this.tangents&&(u.tangents=Array.from(this.tangents)),this.uvs&&(u.uvs=Array.from(this.uvs)),this.uvs2&&(u.uvs2=Array.from(this.uvs2)),this.uvs3&&(u.uvs3=Array.from(this.uvs3)),this.uvs4&&(u.uvs4=Array.from(this.uvs4)),this.uvs5&&(u.uvs5=Array.from(this.uvs5)),this.uvs6&&(u.uvs6=Array.from(this.uvs6)),this.colors&&(u.colors=Array.from(this.colors),u.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(u.matricesIndices=Array.from(this.matricesIndices),u.matricesIndices._isExpanded=!0),this.matricesWeights&&(u.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(u.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),u.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(u.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),u.indices=Array.from(this.indices),this.materialInfos){u.materialInfos=[];for(const x of this.materialInfos){const s={indexStart:x.indexStart,indexCount:x.indexCount,materialIndex:x.materialIndex,verticesStart:x.verticesStart,verticesCount:x.verticesCount};u.materialInfos.push(s)}}return u}static ExtractFromMesh(u,x,s){return r._ExtractFrom(u,x,s)}static ExtractFromGeometry(u,x,s){return r._ExtractFrom(u,x,s)}static _ExtractFrom(u,x,s){const U=new r;if(u.isVerticesDataPresent(W.R.PositionKind)&&(U.positions=u.getVerticesData(W.R.PositionKind,x,s)),u.isVerticesDataPresent(W.R.NormalKind)&&(U.normals=u.getVerticesData(W.R.NormalKind,x,s)),u.isVerticesDataPresent(W.R.TangentKind)&&(U.tangents=u.getVerticesData(W.R.TangentKind,x,s)),u.isVerticesDataPresent(W.R.UVKind)&&(U.uvs=u.getVerticesData(W.R.UVKind,x,s)),u.isVerticesDataPresent(W.R.UV2Kind)&&(U.uvs2=u.getVerticesData(W.R.UV2Kind,x,s)),u.isVerticesDataPresent(W.R.UV3Kind)&&(U.uvs3=u.getVerticesData(W.R.UV3Kind,x,s)),u.isVerticesDataPresent(W.R.UV4Kind)&&(U.uvs4=u.getVerticesData(W.R.UV4Kind,x,s)),u.isVerticesDataPresent(W.R.UV5Kind)&&(U.uvs5=u.getVerticesData(W.R.UV5Kind,x,s)),u.isVerticesDataPresent(W.R.UV6Kind)&&(U.uvs6=u.getVerticesData(W.R.UV6Kind,x,s)),u.isVerticesDataPresent(W.R.ColorKind)){const _=u.geometry||u,c=_.getVertexBuffer(W.R.ColorKind),I=_.getVerticesData(W.R.ColorKind,x,s);if(3===c.getSize()){const u=new Float32Array(4*I.length/3);for(let x=0,s=0;x<I.length;x+=3,s+=4)u[s]=I[x],u[s+1]=I[x+1],u[s+2]=I[x+2],u[s+3]=1;U.colors=u}else{if(4!==c.getSize())throw new Error(`Unexpected number of color components: ${c.getSize()}`);U.colors=I}}return u.isVerticesDataPresent(W.R.MatricesIndicesKind)&&(U.matricesIndices=u.getVerticesData(W.R.MatricesIndicesKind,x,s)),u.isVerticesDataPresent(W.R.MatricesWeightsKind)&&(U.matricesWeights=u.getVerticesData(W.R.MatricesWeightsKind,x,s)),u.isVerticesDataPresent(W.R.MatricesIndicesExtraKind)&&(U.matricesIndicesExtra=u.getVerticesData(W.R.MatricesIndicesExtraKind,x,s)),u.isVerticesDataPresent(W.R.MatricesWeightsExtraKind)&&(U.matricesWeightsExtra=u.getVerticesData(W.R.MatricesWeightsExtraKind,x,s)),U.indices=u.getIndices(x,s),U}static CreateRibbon(u){throw c.n("ribbonBuilder")}static CreateBox(u){throw c.n("boxBuilder")}static CreateTiledBox(u){throw c.n("tiledBoxBuilder")}static CreateTiledPlane(u){throw c.n("tiledPlaneBuilder")}static CreateSphere(u){throw c.n("sphereBuilder")}static CreateCylinder(u){throw c.n("cylinderBuilder")}static CreateTorus(u){throw c.n("torusBuilder")}static CreateLineSystem(u){throw c.n("linesBuilder")}static CreateDashedLines(u){throw c.n("linesBuilder")}static CreateGround(u){throw c.n("groundBuilder")}static CreateTiledGround(u){throw c.n("groundBuilder")}static CreateGroundFromHeightMap(u){throw c.n("groundBuilder")}static CreatePlane(u){throw c.n("planeBuilder")}static CreateDisc(u){throw c.n("discBuilder")}static CreatePolygon(u,x,s,U,_,W,I){throw c.n("polygonBuilder")}static CreateIcoSphere(u){throw c.n("icoSphereBuilder")}static CreatePolyhedron(u){throw c.n("polyhedronBuilder")}static CreateCapsule(u={orientation:_.Pq.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}){throw c.n("capsuleBuilder")}static CreateTorusKnot(u){throw c.n("torusKnotBuilder")}static ComputeNormals(u,x,s,U){let W=0,c=0,I=0,L=0,J=0,k=0,i=0,d=0,j=0,r=0,D=0,$=0,H=0,f=0,O=0,t=0,V=0,N=0,m=0,b=0,n=!1,F=!1,B=!1,Z=!1,v=1,y=0,e=null;U&&(n=!!U.facetNormals,F=!!U.facetPositions,B=!!U.facetPartitioning,v=!0===U.useRightHandedSystem?-1:1,y=U.ratio||0,Z=!!U.depthSort,e=U.distanceTo,Z&&void 0===e&&(e=_.Pq.Zero()));let T=0,Q=0,E=0,l=0;for(B&&U&&U.bbSize&&(T=U.subDiv.X*y/U.bbSize.x,Q=U.subDiv.Y*y/U.bbSize.y,E=U.subDiv.Z*y/U.bbSize.z,l=U.subDiv.max*U.subDiv.max,U.facetPartitioning.length=0),W=0;W<u.length;W++)s[W]=0;const z=x.length/3|0;for(W=0;W<z;W++){if($=3*x[3*W],H=$+1,f=$+2,O=3*x[3*W+1],t=O+1,V=O+2,N=3*x[3*W+2],m=N+1,b=N+2,c=u[$]-u[O],I=u[H]-u[t],L=u[f]-u[V],J=u[N]-u[O],k=u[m]-u[t],i=u[b]-u[V],d=v*(I*i-L*k),j=v*(L*J-c*i),r=v*(c*k-I*J),D=Math.sqrt(d*d+j*j+r*r),D=0===D?1:D,d/=D,j/=D,r/=D,n&&U&&(U.facetNormals[W].x=d,U.facetNormals[W].y=j,U.facetNormals[W].z=r),F&&U&&(U.facetPositions[W].x=(u[$]+u[O]+u[N])/3,U.facetPositions[W].y=(u[H]+u[t]+u[m])/3,U.facetPositions[W].z=(u[f]+u[V]+u[b])/3),B&&U){const x=Math.floor((U.facetPositions[W].x-U.bInfo.minimum.x*y)*T),s=Math.floor((U.facetPositions[W].y-U.bInfo.minimum.y*y)*Q),_=Math.floor((U.facetPositions[W].z-U.bInfo.minimum.z*y)*E),c=Math.floor((u[$]-U.bInfo.minimum.x*y)*T),I=Math.floor((u[H]-U.bInfo.minimum.y*y)*Q),L=Math.floor((u[f]-U.bInfo.minimum.z*y)*E),J=Math.floor((u[O]-U.bInfo.minimum.x*y)*T),k=Math.floor((u[t]-U.bInfo.minimum.y*y)*Q),i=Math.floor((u[V]-U.bInfo.minimum.z*y)*E),d=Math.floor((u[N]-U.bInfo.minimum.x*y)*T),j=Math.floor((u[m]-U.bInfo.minimum.y*y)*Q),r=Math.floor((u[b]-U.bInfo.minimum.z*y)*E),D=c+U.subDiv.max*I+l*L,n=J+U.subDiv.max*k+l*i,F=d+U.subDiv.max*j+l*r,B=x+U.subDiv.max*s+l*_;U.facetPartitioning[B]=U.facetPartitioning[B]?U.facetPartitioning[B]:new Array,U.facetPartitioning[D]=U.facetPartitioning[D]?U.facetPartitioning[D]:new Array,U.facetPartitioning[n]=U.facetPartitioning[n]?U.facetPartitioning[n]:new Array,U.facetPartitioning[F]=U.facetPartitioning[F]?U.facetPartitioning[F]:new Array,U.facetPartitioning[D].push(W),n!=D&&U.facetPartitioning[n].push(W),F!=n&&F!=D&&U.facetPartitioning[F].push(W),B!=D&&B!=n&&B!=F&&U.facetPartitioning[B].push(W)}if(Z&&U&&U.facetPositions){const u=U.depthSortedFacets[W];u.ind=3*W,u.sqDistance=_.Pq.DistanceSquared(U.facetPositions[W],e)}s[$]+=d,s[H]+=j,s[f]+=r,s[O]+=d,s[t]+=j,s[V]+=r,s[N]+=d,s[m]+=j,s[b]+=r}for(W=0;W<s.length/3;W++)d=s[3*W],j=s[3*W+1],r=s[3*W+2],D=Math.sqrt(d*d+j*j+r*r),D=0===D?1:D,d/=D,j/=D,r/=D,s[3*W]=d,s[3*W+1]=j,s[3*W+2]=r}static _ComputeSides(u,x,s,U,W,c,I){const L=s.length,J=U.length;let k,i;switch(u=u||r.DEFAULTSIDE){case r.FRONTSIDE:break;case r.BACKSIDE:for(k=0;k<L;k+=3){const u=s[k];s[k]=s[k+2],s[k+2]=u}for(i=0;i<J;i++)U[i]=-U[i];break;case r.DOUBLESIDE:{const u=x.length,d=u/3;for(let s=0;s<u;s++)x[u+s]=x[s];for(k=0;k<L;k+=3)s[k+L]=s[k+2]+d,s[k+1+L]=s[k+1]+d,s[k+2+L]=s[k]+d;for(i=0;i<J;i++)U[J+i]=-U[i];const j=W.length;let r=0;for(r=0;r<j;r++)W[r+j]=W[r];for(c=c||new _.IU(0,0,1,1),I=I||new _.IU(0,0,1,1),r=0,k=0;k<j/2;k++)W[r]=c.x+(c.z-c.x)*W[r],W[r+1]=c.y+(c.w-c.y)*W[r+1],W[r+j]=I.x+(I.z-I.x)*W[r+j],W[r+j+1]=I.y+(I.w-I.y)*W[r+j+1],r+=2;break}}}static Parse(u){const x=new r,s=u.positions;s&&x.set(s,W.R.PositionKind);const U=u.normals;U&&x.set(U,W.R.NormalKind);const _=u.tangents;_&&x.set(_,W.R.TangentKind);const c=u.uvs;c&&x.set(c,W.R.UVKind);const L=u.uvs2;L&&x.set(L,W.R.UV2Kind);const J=u.uvs3;J&&x.set(J,W.R.UV3Kind);const k=u.uvs4;k&&x.set(k,W.R.UV4Kind);const i=u.uvs5;i&&x.set(i,W.R.UV5Kind);const d=u.uvs6;d&&x.set(d,W.R.UV6Kind);const D=u.colors;D&&(x.set(I.ov.CheckColors4(D,s.length/3),W.R.ColorKind),void 0!==u.hasVertexAlpha&&(x.hasVertexAlpha=u.hasVertexAlpha));const $=u.matricesIndices;$&&x.set($,W.R.MatricesIndicesKind);const H=u.matricesWeights;H&&x.set(H,W.R.MatricesWeightsKind);const f=u.indices;f&&(x.indices=f);const O=u.materialInfos;if(O){x.materialInfos=[];for(const u of O){const s=new j;s.indexCount=u.indexCount,s.indexStart=u.indexStart,s.verticesCount=u.verticesCount,s.verticesStart=u.verticesStart,s.materialIndex=u.materialIndex,x.materialInfos.push(s)}}return x}static ImportVertexData(u,x){const s=r.Parse(u);x.setAllVerticesData(s,u.updatable)}}r.FRONTSIDE=0,r.BACKSIDE=1,r.DOUBLESIDE=2,r.DEFAULTSIDE=0,r._UniqueIDGenerator=0,U.Cg([J.Cx.filter(((...[u])=>!Array.isArray(u)))],r,"_TransformVector3Coordinates",null),U.Cg([J.Cx.filter(((...[u])=>!Array.isArray(u)))],r,"_TransformVector3Normals",null),U.Cg([J.Cx.filter(((...[u])=>!Array.isArray(u)))],r,"_TransformVector4Normals",null),U.Cg([J.Cx.filter(((...[u])=>!Array.isArray(u)))],r,"_FlipFaces",null)},314785:(u,x,s)=>{s.d(x,{L:()=>U});class U{constructor(u,x){this.distanceOrScreenCoverage=u,this.mesh=x}}},374216:(u,x,s)=>{s.d(x,{K:()=>L});var U=s(23987),_=s(7686),W=s(59036),c=s(755752),I=s(964061);class L{get materialDefines(){var u;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(u=this._getDrawWrapper())||void 0===u?void 0:u.defines}set materialDefines(u){var x;(null!==(x=this._mainDrawWrapperOverride)&&void 0!==x?x:this._getDrawWrapper(void 0,!0)).defines=u}_getDrawWrapper(u,x=!1){u=null!=u?u:this._engine.currentRenderPassId;let s=this._drawWrappers[u];return!s&&x&&(this._drawWrappers[u]=s=new I.E(this._mesh.getScene().getEngine())),s}_removeDrawWrapper(u,x=!0){var s;x&&(null===(s=this._drawWrappers[u])||void 0===s||s.dispose()),this._drawWrappers[u]=void 0}get effect(){var u,x;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(x=null===(u=this._getDrawWrapper())||void 0===u?void 0:u.effect)&&void 0!==x?x:null}get _drawWrapper(){var u;return null!==(u=this._mainDrawWrapperOverride)&&void 0!==u?u:this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(u){this._mainDrawWrapperOverride=u}setEffect(u,x=null,s,U=!0){const _=this._drawWrapper;_.setEffect(u,x,U),void 0!==s&&(_.materialContext=s),u||(_.defines=null,_.materialContext=void 0)}resetDrawCache(u){if(this._drawWrappers){if(void 0!==u)return void this._removeDrawWrapper(u);for(const u of this._drawWrappers)null==u||u.dispose()}this._drawWrappers=[]}static AddToMesh(u,x,s,U,_,W,c,I=!0){return new L(u,x,s,U,_,W,c,I)}constructor(u,x,s,U,_,W,c,I=!0,L=!0){this.materialIndex=u,this.verticesStart=x,this.verticesCount=s,this.indexStart=U,this.indexCount=_,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=W,this._renderingMesh=c||W,L&&W.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=W.subMeshes.length-1,I&&(this.refreshBoundingInfo(),W.computeWorldMatrix(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(u){return this._boundingInfo=u,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){return(this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null)||this._renderingMesh}getMaterial(u=!0){var x;const s=null!==(x=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==x?x:this._renderingMesh.material;if(!s)return u?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(s)){const u=s.getSubMaterial(this.materialIndex);return this._currentMaterial!==u&&(this._currentMaterial=u,this.resetDrawCache()),u}return s}_isMultiMaterial(u){return void 0!==u.getSubMaterial}refreshBoundingInfo(u=null){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(u||(u=this._renderingMesh.getVerticesData(U.R.PositionKind)),!u)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const x=this._renderingMesh.getIndices();let s;if(0===this.indexStart&&this.indexCount===x.length){const u=this._renderingMesh.getBoundingInfo();s={minimum:u.minimum.clone(),maximum:u.maximum.clone()}}else s=c.c(u,x,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(s.minimum,s.maximum):this._boundingInfo=new W.j(s.minimum,s.maximum),this}_checkCollision(u){return this.getBoundingInfo()._checkCollision(u)}updateBoundingInfo(u){let x=this.getBoundingInfo();return x||(this.refreshBoundingInfo(),x=this.getBoundingInfo()),x&&x.update(u),this}isInFrustum(u){const x=this.getBoundingInfo();return!!x&&x.isInFrustum(u,this._mesh.cullingStrategy)}isCompletelyInFrustum(u){const x=this.getBoundingInfo();return!!x&&x.isCompletelyInFrustum(u)}render(u){return this._renderingMesh.render(this,u,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(u,x){if(!this._linesIndexBuffer){const s=[];for(let x=this.indexStart;x<this.indexStart+this.indexCount;x+=3)s.push(u[x],u[x+1],u[x+1],u[x+2],u[x+2],u[x]);this._linesIndexBuffer=x.createIndexBuffer(s),this._linesIndexCount=s.length}return this._linesIndexBuffer}canIntersects(u){const x=this.getBoundingInfo();return!!x&&u.intersectsBox(x.boundingBox)}intersects(u,x,s,U,_){const W=this.getMaterial();if(!W)return null;let c=3,I=!1;switch(W.fillMode){case 3:case 5:case 6:case 8:return null;case 7:c=1,I=!0}return 4===W.fillMode?s.length?this._intersectLines(u,x,s,this._mesh.intersectionThreshold,U):this._intersectUnIndexedLines(u,x,s,this._mesh.intersectionThreshold,U):!s.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(u,x,s,U,_):this._intersectTriangles(u,x,s,c,I,U,_)}_intersectLines(u,x,s,U,W){let c=null;for(let I=this.indexStart;I<this.indexStart+this.indexCount;I+=2){const L=x[s[I]],J=x[s[I+1]],k=u.intersectionSegment(L,J,U);if(!(k<0)&&(W||!c||k<c.distance)&&(c=new _.w(null,null,k),c.faceId=I/2,W))break}return c}_intersectUnIndexedLines(u,x,s,U,W){let c=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=2){const I=x[s],L=x[s+1],J=u.intersectionSegment(I,L,U);if(!(J<0)&&(W||!c||J<c.distance)&&(c=new _.w(null,null,J),c.faceId=s/2,W))break}return c}_intersectTriangles(u,x,s,U,_,W,c){let I=null,L=-1;for(let J=this.indexStart;J<this.indexStart+this.indexCount-(3-U);J+=U){L++;const U=s[J],k=s[J+1],i=s[J+2];if(_&&4294967295===i){J+=2;continue}const d=x[U],j=x[k],r=x[i];if(!d||!j||!r)continue;if(c&&!c(d,j,r,u,U,k,i))continue;const D=u.intersectsTriangle(d,j,r);if(D){if(D.distance<0)continue;if((W||!I||D.distance<I.distance)&&(I=D,I.faceId=L,W))break}}return I}_intersectUnIndexedTriangles(u,x,s,U,_){let W=null;for(let s=this.verticesStart;s<this.verticesStart+this.verticesCount;s+=3){const c=x[s],I=x[s+1],L=x[s+2];if(_&&!_(c,I,L,u,-1,-1,-1))continue;const J=u.intersectsTriangle(c,I,L);if(J){if(J.distance<0)continue;if((U||!W||J.distance<W.distance)&&(W=J,W.faceId=s/3,U))break}}return W}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(u,x){const s=new L(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,u,x,!1);if(!this.IsGlobal){const u=this.getBoundingInfo();if(!u)return s;s._boundingInfo=new W.j(u.minimum,u.maximum)}return s}dispose(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const u=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(u,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(u,x,s,U,_,W=!0){let c=Number.MAX_VALUE,I=-Number.MAX_VALUE;const J=(_||U).getIndices();for(let u=x;u<x+s;u++){const x=J[u];x<c&&(c=x),x>I&&(I=x)}return new L(u,c,I-c+1,x,s,U,_,W)}}},633727:(u,x,s)=>{s.d(x,{V:()=>i});var U=s(297809),_=s(760998),W=s(337776),c=s(638113),I=s(604910),L=s(869581),J=s(310035);const k=I.uq.Compose(I.Pq.One(),I.PT.FromEulerAngles(0,Math.PI,0),I.Pq.Zero());class i extends L.b{get billboardMode(){return this._billboardMode}set billboardMode(u){this._billboardMode!==u&&(this._billboardMode=u,this._cache.useBillboardPosition=!!(this._billboardMode&i.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(u){u!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=u,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(u){this._infiniteDistance!==u&&(this._infiniteDistance=u)}constructor(u,x=null,s=!0){super(u,x,!1),this._forward=new I.Pq(0,0,1),this._up=new I.Pq(0,1,0),this._right=new I.Pq(1,0,0),this._position=I.Pq.Zero(),this._rotation=I.Pq.Zero(),this._rotationQuaternion=null,this._scaling=I.Pq.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=i.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this._localMatrix=I.uq.Zero(),this._usePivotMatrix=!1,this._absolutePosition=I.Pq.Zero(),this._absoluteScaling=I.Pq.Zero(),this._absoluteRotationQuaternion=I.PT.Identity(),this._pivotMatrix=I.uq.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new c.cP,this._nonUniformScaling=!1,s&&this.getScene().addTransformNode(this)}getClassName(){return"TransformNode"}get position(){return this._position}set position(u){this._position=u,this._isDirty=!0}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(u){this._rotation=u,this._rotationQuaternion=null,this._isDirty=!0}get scaling(){return this._scaling}set scaling(u){this._scaling=u,this._isDirty=!0}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(u){this._rotationQuaternion=u,u&&this._rotation.setAll(0),this._isDirty=!0}get forward(){return I.Pq.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return I.Pq.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return I.Pq.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(u){return this._poseMatrix?(this._poseMatrix.copyFrom(u),this):(this._poseMatrix=u.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=I.uq.Identity()),this._poseMatrix}_isSynchronized(){const u=this._cache;return!(this._billboardMode!==u.billboardMode||this._billboardMode!==i.BILLBOARDMODE_NONE||u.pivotMatrixUpdated||this._infiniteDistance||this._position._isDirty||this._scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)}_initCache(){super._initCache();const u=this._cache;u.localMatrixUpdated=!1,u.billboardMode=-1,u.infiniteDistance=!1,u.useBillboardPosition=!1,u.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(u){return this.setPivotMatrix(u,!1)}setPivotMatrix(u,x=!0){return this._pivotMatrix.copyFrom(u),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=x,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=I.uq.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(u=null,x,s){const U=this.clone("Clone of "+(this.name||this.id),u||this.parent,!0);U&&s&&s(this,U);for(const u of this.getChildTransformNodes(!0))u.instantiateHierarchy(U,x,s);return U}freezeWorldMatrix(u=null,x=!1){return u?x?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||I.PT.Identity(),u.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=u,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this}get isWorldMatrixFrozen(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.computeWorldMatrix(),this._absolutePosition}setAbsolutePosition(u){if(!u)return this;let x,s,U;if(void 0===u.x){if(arguments.length<3)return this;x=arguments[0],s=arguments[1],U=arguments[2]}else x=u.x,s=u.y,U=u.z;if(this.parent){const u=I.AA.Matrix[0];this.parent.getWorldMatrix().invertToRef(u),I.Pq.TransformCoordinatesFromFloatsToRef(x,s,U,u,this.position)}else this.position.x=x,this.position.y=s,this.position.z=U;return this._absolutePosition.copyFrom(u),this}setPositionWithLocalVector(u){return this.computeWorldMatrix(),this.position=I.Pq.TransformNormal(u,this._localMatrix),this}getPositionExpressedInLocalSpace(){this.computeWorldMatrix();const u=I.AA.Matrix[0];return this._localMatrix.invertToRef(u),I.Pq.TransformNormal(this.position,u)}locallyTranslate(u){return this.computeWorldMatrix(!0),this.position=I.Pq.TransformCoordinates(u,this._localMatrix),this}lookAt(u,x=0,s=0,U=0,_=0){const W=i._LookAtVectorCache,c=0===_?this.position:this.getAbsolutePosition();if(u.subtractToRef(c,W),this.setDirection(W,x,s,U),1===_&&this.parent)if(this.rotationQuaternion){const u=I.AA.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);const x=I.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(x),x.invert(),u.multiplyToRef(x,u),this.rotationQuaternion.fromRotationMatrix(u)}else{const u=I.AA.Quaternion[0];I.PT.FromEulerVectorToRef(this.rotation,u);const x=I.AA.Matrix[0];u.toRotationMatrix(x);const s=I.AA.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(s),s.invert(),x.multiplyToRef(s,x),u.fromRotationMatrix(x),u.toEulerAnglesToRef(this.rotation)}return this}getDirection(u){const x=I.Pq.Zero();return this.getDirectionToRef(u,x),x}getDirectionToRef(u,x){return I.Pq.TransformNormalToRef(u,this.getWorldMatrix(),x),this}setDirection(u,x=0,s=0,U=0){const _=-Math.atan2(u.z,u.x)+Math.PI/2,W=Math.sqrt(u.x*u.x+u.z*u.z),c=-Math.atan2(u.y,W);return this.rotationQuaternion?I.PT.RotationYawPitchRollToRef(_+x,c+s,U,this.rotationQuaternion):(this.rotation.x=c+s,this.rotation.y=_+x,this.rotation.z=U),this}setPivotPoint(u,x=0){0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);const s=this.getWorldMatrix();if(1==x){const x=I.AA.Matrix[0];s.invertToRef(x),u=I.Pq.TransformCoordinates(u,x)}return this.setPivotMatrix(I.uq.Translation(-u.x,-u.y,-u.z),!0)}getPivotPoint(){const u=I.Pq.Zero();return this.getPivotPointToRef(u),u}getPivotPointToRef(u){return u.x=-this._pivotMatrix.m[12],u.y=-this._pivotMatrix.m[13],u.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const u=I.Pq.Zero();return this.getAbsolutePivotPointToRef(u),u}getAbsolutePivotPointToRef(u){return this.getPivotPointToRef(u),I.Pq.TransformCoordinatesToRef(u,this.getWorldMatrix(),u),this}markAsDirty(u){if(this._isDirty)return this;if(this._children)for(const x of this._children)x.markAsDirty(u);return super.markAsDirty(u)}setParent(u,x=!1,s=!1){if(!u&&!this.parent)return this;const U=I.AA.Quaternion[0],_=I.AA.Vector3[0],W=I.AA.Vector3[1],c=I.AA.Matrix[1];I.uq.IdentityToRef(c);const L=I.AA.Matrix[0];this.computeWorldMatrix(!0);let J=this.rotationQuaternion;return J||(J=i._TmpRotation,I.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,J)),I.uq.ComposeToRef(this.scaling,J,this.position,L),this.parent&&L.multiplyToRef(this.parent.computeWorldMatrix(!0),L),u&&(u.computeWorldMatrix(!0).invertToRef(c),L.multiplyToRef(c,L)),L.decompose(W,U,_,x?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(U):U.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(W),this.position.copyFrom(_),this.parent=u,s&&this.setPivotMatrix(I.uq.Identity()),this}addChild(u,x=!1){return u.setParent(this,x),this}removeChild(u,x=!1){return u.setParent(null,x),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(u){return this._nonUniformScaling!==u&&(this._nonUniformScaling=u,!0)}attachToBone(u,x){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=x,this.parent=u,u.getSkeleton().prepare(!0),u.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(u=!1){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=u?this._currentParentWhenAttachingToBone:null,this):(u&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(u,x,s){let U;if(u.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),s&&0!==s){if(this.parent){const s=this.parent.getWorldMatrix(),U=I.AA.Matrix[0];s.invertToRef(U),u=I.Pq.TransformNormal(u,U),s.determinant()<0&&(x*=-1)}U=I.PT.RotationAxisToRef(u,x,i._RotationAxisCache),U.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else U=I.PT.RotationAxisToRef(u,x,i._RotationAxisCache),this.rotationQuaternion.multiplyToRef(U,this.rotationQuaternion);return this}rotateAround(u,x,s){x.normalize(),this.rotationQuaternion||(this.rotationQuaternion=I.PT.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));const U=I.AA.Vector3[0],_=I.AA.Vector3[1],W=I.AA.Vector3[2],c=I.AA.Quaternion[0],L=I.AA.Matrix[0],J=I.AA.Matrix[1],k=I.AA.Matrix[2],i=I.AA.Matrix[3];return u.subtractToRef(this.position,U),I.uq.TranslationToRef(U.x,U.y,U.z,L),I.uq.TranslationToRef(-U.x,-U.y,-U.z,J),I.uq.RotationAxisToRef(x,s,k),J.multiplyToRef(k,i),i.multiplyToRef(L,i),i.decompose(_,c,W),this.position.addInPlace(W),c.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(u,x,s){const U=u.scale(x);if(s&&0!==s)this.setAbsolutePosition(this.getAbsolutePosition().add(U));else{const u=this.getPositionExpressedInLocalSpace().add(U);this.setPositionWithLocalVector(u)}return this}addRotation(u,x,s){let U;this.rotationQuaternion?U=this.rotationQuaternion:(U=I.AA.Quaternion[1],I.PT.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,U));const _=I.AA.Quaternion[0];return I.PT.RotationYawPitchRollToRef(x,u,s,_),U.multiplyInPlace(_),this.rotationQuaternion||U.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}computeWorldMatrix(u=!1,x=null){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const s=this.getScene().getRenderId();if(!this._isDirty&&!u&&(this._currentRenderId===s||this.isSynchronized()))return this._currentRenderId=s,this._worldMatrix;x=x||this.getScene().activeCamera,this._updateCache();const U=this._cache;U.pivotMatrixUpdated=!1,U.billboardMode=this.billboardMode,U.infiniteDistance=this.infiniteDistance,U.parent=this._parentNode,this._currentRenderId=s,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const _=this._getEffectiveParent(),W=i._TmpScaling;let c,L=this._position;if(this._infiniteDistance&&!this.parent&&x){const u=x.getWorldMatrix(),s=new I.Pq(u.m[12],u.m[13],u.m[14]);L=i._TmpTranslation,L.copyFromFloats(this._position.x+s.x,this._position.y+s.y,this._position.z+s.z)}if(W.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion?(this._rotationQuaternion._isDirty=!1,c=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(I.PT.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(c=i._TmpRotation,I.PT.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,c)),this._usePivotMatrix){const u=I.AA.Matrix[1];I.uq.ScalingToRef(W.x,W.y,W.z,u);const x=I.AA.Matrix[0];c.toRotationMatrix(x),this._pivotMatrix.multiplyToRef(u,I.AA.Matrix[4]),I.AA.Matrix[4].multiplyToRef(x,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(L.x,L.y,L.z)}else I.uq.ComposeToRef(W,c,L,this._localMatrix);if(_&&_.getWorldMatrix){if(u&&_.computeWorldMatrix(u),U.useBillboardPath){if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),u.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),I.AA.Matrix[7])}else I.AA.Matrix[7].copyFrom(_.getWorldMatrix());const u=I.AA.Vector3[5],x=I.AA.Vector3[6],s=I.AA.Quaternion[0];I.AA.Matrix[7].decompose(x,s,u),I.uq.ScalingToRef(x.x,x.y,x.z,I.AA.Matrix[7]),I.AA.Matrix[7].setTranslation(u),i.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(s,u),this._localMatrix.setTranslation(u)),this._localMatrix.multiplyToRef(I.AA.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const u=this.parent;u.getSkeleton().prepare(),this._localMatrix.multiplyToRef(u.getFinalMatrix(),I.AA.Matrix[6]),I.AA.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this._localMatrix.multiplyToRef(_.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(U.useBillboardPath&&x&&this.billboardMode&&!U.useBillboardPosition){const u=I.AA.Vector3[0];if(this._worldMatrix.getTranslationToRef(u),I.AA.Matrix[1].copyFrom(x.getViewMatrix()),this._scene.useRightHandedSystem&&I.AA.Matrix[1].multiplyToRef(k,I.AA.Matrix[1]),I.AA.Matrix[1].setTranslationFromFloats(0,0,0),I.AA.Matrix[1].invertToRef(I.AA.Matrix[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){I.AA.Matrix[0].decompose(void 0,I.AA.Quaternion[0],void 0);const u=I.AA.Vector3[1];I.AA.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(u.z=0),I.uq.RotationYawPitchRollToRef(u.y,u.x,u.z,I.AA.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(I.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(I.AA.Vector3[0])}else if(U.useBillboardPath&&x&&U.useBillboardPosition){const u=I.AA.Vector3[0];this._worldMatrix.getTranslationToRef(u);const s=x.globalPosition;this._worldMatrix.invertToRef(I.AA.Matrix[1]);const U=I.AA.Vector3[1];I.Pq.TransformCoordinatesToRef(s,I.AA.Matrix[1],U),U.normalize();const _=-Math.atan2(U.z,U.x)+Math.PI/2,W=Math.sqrt(U.x*U.x+U.z*U.z),c=-Math.atan2(U.y,W);if(I.PT.RotationYawPitchRollToRef(_,c,0,I.AA.Quaternion[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){const u=I.AA.Vector3[1];I.AA.Quaternion[0].toEulerAnglesToRef(u),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(u.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(u.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(u.z=0),I.uq.RotationYawPitchRollToRef(u.y,u.x,u.z,I.AA.Matrix[0])}else I.uq.FromQuaternionToRef(I.AA.Quaternion[0],I.AA.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(I.AA.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(I.AA.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):_&&_._nonUniformScaling?this._updateNonUniformScalingState(_._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=I.uq.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(u=!0){if(this.computeWorldMatrix(),u){const u=this.getChildren();for(let x=0;x<u.length;++x){const s=u[x];if(s){s.computeWorldMatrix();const u=I.AA.Matrix[0];s._localMatrix.multiplyToRef(this._localMatrix,u);const x=I.AA.Quaternion[0];u.decompose(s.scaling,x,s.position),s.rotationQuaternion?s.rotationQuaternion.copyFrom(x):x.toEulerAnglesToRef(s.rotation)}}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=I.PT.Identity()),this._worldMatrix=I.uq.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.add(u),this}unregisterAfterWorldMatrixUpdate(u){return this.onAfterWorldMatrixUpdateObservable.removeCallback(u),this}getPositionInCameraSpace(u=null){return u||(u=this.getScene().activeCamera),I.Pq.TransformCoordinates(this.getAbsolutePosition(),u.getViewMatrix())}getDistanceToCamera(u=null){return u||(u=this.getScene().activeCamera),this.getAbsolutePosition().subtract(u.globalPosition).length()}clone(u,x,s){const U=W.p.Clone((()=>new i(u,this.getScene())),this);if(U.name=u,U.id=u,x&&(U.parent=x),!s){const x=this.getDescendants(!0);for(let s=0;s<x.length;s++){const _=x[s];_.clone&&_.clone(u+"."+_.name,U)}}return U}serialize(u){const x=W.p.Serialize(this,u);return x.type=this.getClassName(),x.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(x),x.localMatrix=this.getPivotMatrix().asArray(),x.isEnabled=this.isEnabled(),W.p.AppendSerializedAnimations(this,x),x.ranges=this.serializeAnimationRanges(),x}static Parse(u,x,s){const U=W.p.Parse((()=>new i(u.name,x)),u,x,s);if(u.localMatrix?U.setPreTransformMatrix(I.uq.FromArray(u.localMatrix)):u.pivotMatrix&&U.setPivotMatrix(I.uq.FromArray(u.pivotMatrix)),U.setEnabled(u.isEnabled),U._waitingParsedUniqueId=u.uniqueId,void 0!==u.parentId&&(U._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(U._waitingParentInstanceIndex=u.parentInstanceIndex),u.animations){for(let x=0;x<u.animations.length;x++){const s=u.animations[x],_=J.n9("BABYLON.Animation");_&&U.animations.push(_.Parse(s))}L.b.ParseAnimationRanges(U,u,x)}return u.autoAnimate&&x.beginAnimation(U,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1),U}getChildTransformNodes(u,x){const s=[];return this._getDescendants(s,u,(u=>(!x||x(u))&&u instanceof i)),s}dispose(u,x=!1){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){const u=this._parentContainer.transformNodes.indexOf(this);u>-1&&this._parentContainer.transformNodes.splice(u,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),u){const u=this.getChildTransformNodes(!0);for(const x of u)x.parent=null,x.computeWorldMatrix(!0)}super.dispose(u,x)}normalizeToUnitCube(u=!0,x=!1,s){let U=null,_=null;x&&(this.rotationQuaternion?(_=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(U=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));const W=this.getHierarchyBoundingVectors(u,s),c=W.max.subtract(W.min),I=Math.max(c.x,c.y,c.z);if(0===I)return this;const L=1/I;return this.scaling.scaleInPlace(L),x&&(this.rotationQuaternion&&_?this.rotationQuaternion.copyFrom(_):this.rotation&&U&&this.rotation.copyFrom(U)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}i.BILLBOARDMODE_NONE=0,i.BILLBOARDMODE_X=1,i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_Z=4,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_USE_POSITION=128,i.BillboardUseParentOrientation=!1,i._TmpRotation=I.PT.Zero(),i._TmpScaling=I.Pq.Zero(),i._TmpTranslation=I.Pq.Zero(),i._LookAtVectorCache=new I.Pq(0,0,0),i._RotationAxisCache=new I.PT,U.Cg([_.P_("position")],i.prototype,"_position",void 0),U.Cg([_.P_("rotation")],i.prototype,"_rotation",void 0),U.Cg([_.bR("rotationQuaternion")],i.prototype,"_rotationQuaternion",void 0),U.Cg([_.P_("scaling")],i.prototype,"_scaling",void 0),U.Cg([_.lK("billboardMode")],i.prototype,"_billboardMode",void 0),U.Cg([_.lK()],i.prototype,"scalingDeterminant",void 0),U.Cg([_.lK("infiniteDistance")],i.prototype,"_infiniteDistance",void 0),U.Cg([_.lK()],i.prototype,"ignoreNonUniformScaling",void 0),U.Cg([_.lK()],i.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},906264:(u,x,s)=>{s.d(x,{d:()=>J});var U=s(604910),_=s(615473),W=s(562756),c=s(779908),I=s(332290);class L{constructor(u,x,s,U){this.name=u,this.worldAxisForNormal=x,this.worldAxisForFileX=s,this.worldAxisForFileY=U}}class J{static ConvertCubeMapTextureToSphericalPolynomial(u){var x;if(!u.isCube)return null;null===(x=u.getScene())||void 0===x||x.getEngine().flushFramebuffer();const s=u.getSize().width,U=u.readPixels(0,void 0,void 0,!1),_=u.readPixels(1,void 0,void 0,!1);let W,c;u.isRenderTarget?(W=u.readPixels(3,void 0,void 0,!1),c=u.readPixels(2,void 0,void 0,!1)):(W=u.readPixels(2,void 0,void 0,!1),c=u.readPixels(3,void 0,void 0,!1));const I=u.readPixels(4,void 0,void 0,!1),L=u.readPixels(5,void 0,void 0,!1),J=u.gammaSpace,k=5;let i=0;return 1!=u.textureType&&2!=u.textureType||(i=1),new Promise((u=>{Promise.all([_,U,W,c,I,L]).then((([x,U,_,W,c,I])=>{const L={size:s,right:U,left:x,up:_,down:W,front:c,back:I,format:k,type:i,gammaSpace:J};u(this.ConvertCubeMapToSphericalPolynomial(L))}))}))}static _AreaElement(u,x){return Math.atan2(u*x,Math.sqrt(u*u+x*x+1))}static ConvertCubeMapToSphericalPolynomial(u){const x=new W.O;let s=0;const U=2/u.size,L=U,J=.5*U,k=J-1;for(let W=0;W<6;W++){const i=this._FileFaces[W],d=u[i.name];let j=k;const r=5===u.format?4:3;for(let W=0;W<u.size;W++){let D=k;for(let L=0;L<u.size;L++){const k=i.worldAxisForFileX.scale(D).add(i.worldAxisForFileY.scale(j)).add(i.worldAxisForNormal);k.normalize();const $=this._AreaElement(D-J,j-J)-this._AreaElement(D-J,j+J)-this._AreaElement(D+J,j-J)+this._AreaElement(D+J,j+J);let H=d[W*u.size*r+L*r+0],f=d[W*u.size*r+L*r+1],O=d[W*u.size*r+L*r+2];isNaN(H)&&(H=0),isNaN(f)&&(f=0),isNaN(O)&&(O=0),0===u.type&&(H/=255,f/=255,O/=255),u.gammaSpace&&(H=Math.pow(_.X.Clamp(H),c.tk),f=Math.pow(_.X.Clamp(f),c.tk),O=Math.pow(_.X.Clamp(O),c.tk));const t=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const u=Math.max(H,f,O);if(u>t){const x=t/u;H*=x,f*=x,O*=x}}else H=_.X.Clamp(H,0,t),f=_.X.Clamp(f,0,t),O=_.X.Clamp(O,0,t);const V=new I.v9(H,f,O);x.addLight(k,V,$),s+=$,D+=U}j+=L}}const i=6*(4*Math.PI)/6/s;return x.scaleInPlace(i),x.convertIncidentRadianceToIrradiance(),x.convertIrradianceToLambertianRadiance(),W.Q.FromHarmonics(x)}}J._FileFaces=[new L("right",new U.Pq(1,0,0),new U.Pq(0,0,-1),new U.Pq(0,-1,0)),new L("left",new U.Pq(-1,0,0),new U.Pq(0,0,1),new U.Pq(0,-1,0)),new L("up",new U.Pq(0,1,0),new U.Pq(1,0,0),new U.Pq(0,0,1)),new L("down",new U.Pq(0,-1,0),new U.Pq(1,0,0),new U.Pq(0,0,-1)),new L("front",new U.Pq(0,0,1),new U.Pq(1,0,0),new U.Pq(0,-1,0)),new L("back",new U.Pq(0,0,-1),new U.Pq(-1,0,0),new U.Pq(0,-1,0))],J.MAX_HDRI_VALUE=4096,J.PRESERVE_CLAMPED_COLORS=!1},843019:(u,x,s)=>{s.d(x,{I9:()=>k,LT:()=>L,NK:()=>c,VH:()=>I});var U=s(171482);function _(u,x,s,U,_,W){_>0?(_=function(u,x){return x>1023?u*Math.pow(2,1023)*Math.pow(2,x-1023):x<-1074?u*Math.pow(2,-1074)*Math.pow(2,x+1074):u*Math.pow(2,x)}(1,_-(128+8)),u[W+0]=x*_,u[W+1]=s*_,u[W+2]=U*_):(u[W+0]=0,u[W+1]=0,u[W+2]=0)}function W(u,x){let s="",U="";for(let _=x;_<u.length-x&&(U=String.fromCharCode(u[_]),"\n"!=U);_++)s+=U;return s}function c(u){let x=0,s=0,U=W(u,0);if("#"!=U[0]||"?"!=U[1])throw"Bad HDR Format.";let _=!1,c=!1,I=0;do{I+=U.length+1,U=W(u,I),"FORMAT=32-bit_rle_rgbe"==U?c=!0:0==U.length&&(_=!0)}while(!_);if(!c)throw"HDR Bad header format, unsupported FORMAT";I+=U.length+1,U=W(u,I);const L=/^-Y (.*) \+X (.*)$/g.exec(U);if(!L||L.length<3)throw"HDR Bad header format, no size";if(s=parseInt(L[2]),x=parseInt(L[1]),s<8||s>32767)throw"HDR Bad header format, unsupported size";return I+=U.length+1,{height:x,width:s,dataPosition:I}}function I(u,x,s=!1){const _=new Uint8Array(u),W=c(_),I=L(_,W);return U.D.ConvertPanoramaToCubemap(I,W.width,W.height,x,s)}function L(u,x){return function(u,x){let s=x.height;const U=x.width;let W,c,I,L,k,i=x.dataPosition,d=0,j=0,r=0;const D=new ArrayBuffer(4*U),$=new Uint8Array(D),H=new ArrayBuffer(x.width*x.height*4*3),f=new Float32Array(H);for(;s>0;){if(W=u[i++],c=u[i++],I=u[i++],L=u[i++],2!=W||2!=c||128&I||x.width<8||x.width>32767)return J(u,x);if((I<<8|L)!=U)throw"HDR Bad header format, wrong scan line width";for(d=0,r=0;r<4;r++)for(j=(r+1)*U;d<j;)if(W=u[i++],c=u[i++],W>128){if(k=W-128,0==k||k>j-d)throw"HDR Bad Format, bad scanline data (run)";for(;k-- >0;)$[d++]=c}else{if(k=W,0==k||k>j-d)throw"HDR Bad Format, bad scanline data (non-run)";if($[d++]=c,--k>0)for(let x=0;x<k;x++)$[d++]=u[i++]}for(r=0;r<U;r++)W=$[r],c=$[r+U],I=$[r+2*U],L=$[r+3*U],_(f,W,c,I,L,(x.height-s)*U*3+3*r);s--}return f}(u,x)}function J(u,x){let s=x.height;const U=x.width;let W,c,I,L,J,k=x.dataPosition;const i=new ArrayBuffer(x.width*x.height*4*3),d=new Float32Array(i);for(;s>0;){for(J=0;J<x.width;J++)W=u[k++],c=u[k++],I=u[k++],L=u[k++],_(d,W,c,I,L,(x.height-s)*U*3+3*J);s--}return d}const k={RGBE_ReadHeader:c,GetCubeMapTextureData:I,RGBE_ReadPixels:L}},171482:(u,x,s)=>{s.d(x,{D:()=>_});var U=s(604910);class _{static ConvertPanoramaToCubemap(u,x,s,U,_=!1){if(!u)throw"ConvertPanoramaToCubemap: input cannot be null";if(u.length!=x*s*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(U,this.FACE_FRONT,u,x,s,_),back:this.CreateCubemapTexture(U,this.FACE_BACK,u,x,s,_),left:this.CreateCubemapTexture(U,this.FACE_LEFT,u,x,s,_),right:this.CreateCubemapTexture(U,this.FACE_RIGHT,u,x,s,_),up:this.CreateCubemapTexture(U,this.FACE_UP,u,x,s,_),down:this.CreateCubemapTexture(U,this.FACE_DOWN,u,x,s,_),size:U,type:1,format:4,gammaSpace:!1}}static CreateCubemapTexture(u,x,s,U,_,W=!1){const c=new ArrayBuffer(u*u*4*3),I=new Float32Array(c),L=W?Math.max(1,Math.round(U/4/u)):1,J=1/L,k=J*J,i=x[1].subtract(x[0]).scale(J/u),d=x[3].subtract(x[2]).scale(J/u),j=1/u;let r=0;for(let W=0;W<u;W++)for(let c=0;c<L;c++){let c=x[0],D=x[2];for(let x=0;x<u;x++)for(let J=0;J<L;J++){const L=D.subtract(c).scale(r).add(c);L.normalize();const J=this.CalcProjectionSpherical(L,s,U,_);I[W*u*3+3*x+0]+=J.r*k,I[W*u*3+3*x+1]+=J.g*k,I[W*u*3+3*x+2]+=J.b*k,c=c.add(i),D=D.add(d)}r+=j*J}return I}static CalcProjectionSpherical(u,x,s,U){let _=Math.atan2(u.z,u.x);const W=Math.acos(u.y);for(;_<-Math.PI;)_+=2*Math.PI;for(;_>Math.PI;)_-=2*Math.PI;let c=_/Math.PI;const I=W/Math.PI;c=.5*c+.5;let L=Math.round(c*s);L<0?L=0:L>=s&&(L=s-1);let J=Math.round(I*U);J<0?J=0:J>=U&&(J=U-1);const k=U-J-1;return{r:x[k*s*3+3*L+0],g:x[k*s*3+3*L+1],b:x[k*s*3+3*L+2]}}}_.FACE_LEFT=[new U.Pq(-1,-1,-1),new U.Pq(1,-1,-1),new U.Pq(-1,1,-1),new U.Pq(1,1,-1)],_.FACE_RIGHT=[new U.Pq(1,-1,1),new U.Pq(-1,-1,1),new U.Pq(1,1,1),new U.Pq(-1,1,1)],_.FACE_FRONT=[new U.Pq(1,-1,-1),new U.Pq(1,-1,1),new U.Pq(1,1,-1),new U.Pq(1,1,1)],_.FACE_BACK=[new U.Pq(-1,-1,1),new U.Pq(-1,-1,-1),new U.Pq(-1,1,1),new U.Pq(-1,1,-1)],_.FACE_DOWN=[new U.Pq(1,1,-1),new U.Pq(1,1,1),new U.Pq(-1,1,-1),new U.Pq(-1,1,1)],_.FACE_UP=[new U.Pq(-1,-1,-1),new U.Pq(-1,-1,1),new U.Pq(1,-1,-1),new U.Pq(1,-1,1)]},161892:(u,x,s)=>{s.d(x,{Z:()=>U});class U{static Eval(u,x){return"true"===(u=u.match(/\([^()]*\)/g)?u.replace(/\([^()]*\)/g,(u=>(u=u.slice(1,u.length-1),U._HandleParenthesisContent(u,x)))):U._HandleParenthesisContent(u,x))||"false"!==u&&U.Eval(u,x)}static _HandleParenthesisContent(u,x){let s;x=x||(u=>"true"===u);const _=u.split("||");for(const u in _)if(Object.prototype.hasOwnProperty.call(_,u)){let W=U._SimplifyNegation(_[u].trim());const c=W.split("&&");if(c.length>1)for(let u=0;u<c.length;++u){const _=U._SimplifyNegation(c[u].trim());if(s="true"!==_&&"false"!==_?"!"===_[0]?!x(_.substring(1)):x(_):"true"===_,!s){W="false";break}}if(s||"true"===W){s=!0;break}s="true"!==W&&"false"!==W?"!"===W[0]?!x(W.substring(1)):x(W):"true"===W}return s?"true":"false"}static _SimplifyNegation(u){return"!true"===(u=(u=u.replace(/^[\s!]+/,(u=>(u=u.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?u="false":"!false"===u&&(u="true"),u}}},967872:(u,x,s)=>{function U(u,x){const s=[];for(let U=0;U<u;++U)s.push(x());return s}function _(u,x){return U(u,x)}s.d(x,{lL:()=>c,ln:()=>_,mI:()=>U});const W=["push","splice","pop","shift","unshift"];function c(u,x){const s=W.map((s=>function(u,x,s){const U=u[x];if("function"!=typeof U)return null;const _=function(){const U=u.length,W=_.previous.apply(u,arguments);return s(x,U),W};return U.next=_,_.previous=U,u[x]=_,()=>{const s=_.previous;if(!s)return;const U=_.next;U?(s.next=U,U.previous=s):(s.next=void 0,u[x]=s),_.next=void 0,_.previous=void 0}}(u,s,x)));return()=>{s.forEach((u=>{null==u||u()}))}}},501650:(u,x,s)=>{s.d(x,{Et:()=>m,F6:()=>V,X5:()=>f,XN:()=>r,YJ:()=>j,aI:()=>N,ff:()=>$,gi:()=>H,hb:()=>U,nY:()=>t,pS:()=>D,re:()=>O,rw:()=>n,ss:()=>b});var U,_=s(548949),W=s(898973),c=s(638113),I=s(432050),L=s(639093),J=s(394899),k=s(679725),i=s(706400),d=s(395726);(function(u){u[u["INIT"]=0]="INIT",u[u["RUNNING"]=1]="RUNNING",u[u["DONE"]=2]="DONE",u[u["ERROR"]=3]="ERROR"})(U||(U={}));class j{constructor(u){this.name=u,this._isCompleted=!1,this._taskState=0}get isCompleted(){return this._isCompleted}get taskState(){return this._taskState}get errorObject(){return this._errorObject}_setErrorObject(u,x){this._errorObject||(this._errorObject={message:u,exception:x})}run(u,x,s){this._taskState=1,this.runTask(u,(()=>{this._onDoneCallback(x,s)}),((u,x)=>{this._onErrorCallback(s,u,x)}))}runTask(u,x,s){throw new Error("runTask is not implemented")}reset(){this._taskState=0}_onErrorCallback(u,x,s){this._taskState=3,this._errorObject={message:x,exception:s},this.onError&&this.onError(this,x,s),u()}_onDoneCallback(u,x){try{this._taskState=2,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),u()}catch(u){this._onErrorCallback(x,"Task is done, error executing success callback(s)",u)}}}class r{constructor(u,x,s){this.remainingCount=u,this.totalCount=x,this.task=s}}class D extends j{constructor(u,x,s,U,_){super(u),this.name=u,this.meshesNames=x,this.rootUrl=s,this.sceneFilename=U,this.extension=_}runTask(u,x,s){_.cn.LoadAssetContainer(this.rootUrl,this.sceneFilename,u,(u=>{this.loadedContainer=u,this.loadedMeshes=u.meshes,this.loadedTransformNodes=u.transformNodes,this.loadedParticleSystems=u.particleSystems,this.loadedSkeletons=u.skeletons,this.loadedAnimationGroups=u.animationGroups,x()}),null,((u,x,U)=>{s(x,U)}),this.extension)}}class $ extends j{constructor(u,x,s,U,_){super(u),this.name=u,this.meshesNames=x,this.rootUrl=s,this.sceneFilename=U,this.extension=_}runTask(u,x,s){_.cn.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,u,((u,s,U,_,W)=>{this.loadedMeshes=u,this.loadedTransformNodes=W,this.loadedParticleSystems=s,this.loadedSkeletons=U,this.loadedAnimationGroups=_,x()}),null,((u,x,U)=>{s(x,U)}),this.extension)}}class H extends j{constructor(u,x,s,U,_){super(u),this.name=u,this.rootUrl=x,this.filename=s,this.targetConverter=U,this.extension=_}runTask(u,x,s){const U=u.animatables.length,W=u.animationGroups.length;this.loadedAnimatables=[],this.loadedAnimationGroups=[],_.cn.ImportAnimations(this.rootUrl,this.filename,u,!1,3,this.targetConverter,(()=>{this.loadedAnimatables=u.animatables.slice(U),this.loadedAnimationGroups=u.animationGroups.slice(W),x()}),null,((u,x,U)=>{s(x,U)}),this.extension)}}class f extends j{constructor(u,x){super(u),this.name=u,this.url=x}runTask(u,x,s){u._loadFile(this.url,(u=>{this.text=u,x()}),void 0,!1,!1,((u,x)=>{u&&s(u.status+" "+u.statusText,x)}))}}class O extends j{constructor(u,x){super(u),this.name=u,this.url=x}runTask(u,x,s){u._loadFile(this.url,(u=>{this.data=u,x()}),void 0,!0,!0,((u,x)=>{u&&s(u.status+" "+u.statusText,x)}))}}class t extends j{constructor(u,x){super(u),this.name=u,this.url=x}runTask(u,x,s){const U=new Image;W.S0.SetCorsBehavior(this.url,U),U.onload=()=>{this.image=U,x()},U.onerror=u=>{s("Error loading image",u)},U.src=this.url}}class V extends j{constructor(u,x,s,U=!0,_=I.g.TRILINEAR_SAMPLINGMODE){super(u),this.name=u,this.url=x,this.noMipmap=s,this.invertY=U,this.samplingMode=_}runTask(u,x,s){this.texture=new I.g(this.url,u,this.noMipmap,this.invertY,this.samplingMode,(()=>{x()}),((u,x)=>{s(u,x)}))}}class N extends j{constructor(u,x,s,U,_,W){super(u),this.name=u,this.url=x,this.extensions=s,this.noMipmap=U,this.files=_,this.prefiltered=W}runTask(u,x,s){this.texture=new L.b(this.url,u,this.extensions,this.noMipmap,this.files,(()=>{x()}),((u,x)=>{s(u,x)}),void 0,this.prefiltered)}}class m extends j{constructor(u,x,s,U=!1,_=!0,W=!1,c=!1){super(u),this.name=u,this.url=x,this.size=s,this.noMipmap=U,this.generateHarmonics=_,this.gammaSpace=W,this.reserved=c}runTask(u,x,s){this.texture=new J.H(this.url,u,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,(()=>{x()}),((u,x)=>{s(u,x)}))}}class b extends j{constructor(u,x,s,U=!1,_=!0){super(u),this.name=u,this.url=x,this.size=s,this.noMipmap=U,this.gammaSpace=_}runTask(u,x,s){this.texture=new k.N(this.url,u,this.size,this.noMipmap,this.gammaSpace,(()=>{x()}),((u,x)=>{s(u,x)}))}}class n{constructor(u){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new c.cP,this.onTaskErrorObservable=new c.cP,this.onTasksDoneObservable=new c.cP,this.onProgressObservable=new c.cP,this.useDefaultLoadingScreen=!0,this.autoHideLoadingUI=!0,this._scene=u||d.q.LastCreatedScene}addContainerTask(u,x,s,U,_){const W=new D(u,x,s,U,_);return this._tasks.push(W),W}addMeshTask(u,x,s,U,_){const W=new $(u,x,s,U,_);return this._tasks.push(W),W}addTextFileTask(u,x){const s=new f(u,x);return this._tasks.push(s),s}addBinaryFileTask(u,x){const s=new O(u,x);return this._tasks.push(s),s}addImageTask(u,x){const s=new t(u,x);return this._tasks.push(s),s}addTextureTask(u,x,s,U,_=I.g.TRILINEAR_SAMPLINGMODE){const W=new V(u,x,s,U,_);return this._tasks.push(W),W}addCubeTextureTask(u,x,s,U,_,W){const c=new N(u,x,s,U,_,W);return this._tasks.push(c),c}addHDRCubeTextureTask(u,x,s,U=!1,_=!0,W=!1,c=!1){const I=new m(u,x,s,U,_,W,c);return this._tasks.push(I),I}addEquiRectangularCubeTextureAssetTask(u,x,s,U=!1,_=!0){const W=new b(u,x,s,U,_);return this._tasks.push(W),W}removeTask(u){const x=this._tasks.indexOf(u);x>-1&&this._tasks.splice(x,1)}_decreaseWaitingTasksCount(u){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,u),this.onProgressObservable.notifyObservers(new r(this._waitingTasksCount,this._totalTasksCount,u))}catch(u){i.V.Error("Error running progress callbacks."),i.V.Log(u)}if(0===this._waitingTasksCount){try{const u=this._tasks.slice();this.onFinish&&this.onFinish(u);for(const x of u)if(2===x.taskState){const u=this._tasks.indexOf(x);u>-1&&this._tasks.splice(u,1)}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(u){i.V.Error("Error running tasks-done callbacks."),i.V.Log(u)}this._isLoading=!1,this.autoHideLoadingUI&&this._scene.getEngine().hideLoadingUI()}}_runTask(u){const x=(x,s)=>{u._setErrorObject(x,s),this.onTaskError?this.onTaskError(u):u.onError||i.V.Error(this._formatTaskErrorMessage(u)),this.onTaskErrorObservable.notifyObservers(u),this._decreaseWaitingTasksCount(u)};u.run(this._scene,(()=>{try{this.onTaskSuccess&&this.onTaskSuccess(u),this.onTaskSuccessObservable.notifyObservers(u),this._decreaseWaitingTasksCount(u)}catch(u){x("Error executing task success callbacks",u)}}),x)}_formatTaskErrorMessage(u){let x="Unable to complete task "+u.name;return u.errorObject.message&&(x+=`: ${u.errorObject.message}`),u.errorObject.exception&&(x+=`: ${u.errorObject.exception}`),x}reset(){return this._isLoading=!1,this._tasks=new Array,this}load(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(let u=0;u<this._tasks.length;u++){const x=this._tasks[u];0===x.taskState&&this._runTask(x)}return this}loadAsync(){return new Promise(((u,x)=>{this._isLoading?u():(this.onTasksDoneObservable.addOnce((s=>{s&&s.length?x(s):u()})),this.load())}))}}},940296:(u,x,s)=>{s.d(x,{J:()=>L,X:()=>I});var U=s(432050),_=s(374603);const W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==";let c=0;const I=u=>{if(!u.environmentBRDFTexture){const x=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const s=u._blockEntityCollection;u._blockEntityCollection=!1;const I=U.g.CreateFromBase64String(W,"EnvironmentBRDFTexture"+c++,u,!0,!1,U.g.BILINEAR_SAMPLINGMODE);u._blockEntityCollection=s;const L=u.getEngine().getLoadedTexturesCache(),J=L.indexOf(I.getInternalTexture());-1!==J&&L.splice(J,1),I.isRGBD=!0,I.wrapU=U.g.CLAMP_ADDRESSMODE,I.wrapV=U.g.CLAMP_ADDRESSMODE,u.environmentBRDFTexture=I,u.useDelayedTextureLoading=x,_.G.ExpandRGBDTexture(I);const k=u.getEngine().onContextRestoredObservable.add((()=>{I.isRGBD=!0;const x=u.onBeforeRenderObservable.add((()=>{I.isReady()&&(u.onBeforeRenderObservable.remove(x),_.G.ExpandRGBDTexture(I))}))}));u.onDisposeObservable.add((()=>{u.getEngine().onContextRestoredObservable.remove(k)}))}return u.environmentBRDFTexture},L={GetEnvironmentBRDFTexture:I}},393518:(u,x,s)=>{function U(u,x,s=!1){const U=x.width,_=x.height;if(u instanceof Float32Array){let x=u.byteLength/u.BYTES_PER_ELEMENT;const s=new Uint8Array(x);for(;--x>=0;){let U=u[x];U<0?U=0:U>1&&(U=1),s[x]=255*U}u=s}const W=document.createElement("canvas");W.width=U,W.height=_;const c=W.getContext("2d");if(!c)return null;const I=c.createImageData(U,_);if(I.data.set(u),c.putImageData(I,0,0),s){const u=document.createElement("canvas");u.width=U,u.height=_;const x=u.getContext("2d");return x?(x.translate(0,_),x.scale(1,-1),x.drawImage(W,0,0),u.toDataURL("image/png")):null}return W.toDataURL("image/png")}function _(u,x=0,s=0){const _=u.getInternalTexture();if(!_)return null;const W=u._readPixelsSync(x,s);return W?U(W,u.getSize(),_.invertY):null}async function W(u,x=0,s=0){const _=u.getInternalTexture();if(!_)return null;const W=await u.readPixels(x,s);return W?U(W,u.getSize(),_.invertY):null}s.d(x,{D8:()=>c,c9:()=>U,lP:()=>_,nh:()=>W});const c={GenerateBase64StringFromPixelData:U,GenerateBase64StringFromTexture:_,GenerateBase64StringFromTextureAsync:W}},378480:(u,x,s)=>{function U(u,x,s){try{const U=u.next();U.done?x(U):U.value?U.value.then((()=>{U.value=void 0,x(U)}),s):x(U)}catch(u){s(u)}}function _(u=25){let x;return(s,_,W)=>{const c=performance.now();void 0===x||c-x>u?(x=c,setTimeout((()=>{U(s,_,W)}),0)):U(s,_,W)}}function W(u,x,s,U,_){const W=()=>{let c;const I=u=>{u.done?s(u.value):void 0===c?c=!0:W()};do{c=void 0,_&&_.aborted?U(new Error("Aborted")):x(u,I,U),void 0===c&&(c=!1)}while(c)};W()}function c(u,x){let s;return W(u,U,(u=>s=u),(u=>{throw u}),x),s}function I(u,x,s){return new Promise(((U,_)=>{W(u,x,U,_,s)}))}function L(u,x){return(...s)=>c(u(...s),x)}function J(u,x,s){return(...U)=>I(u(...U),x,s)}s.d(x,{Aj:()=>L,FE:()=>U,V1:()=>c,VP:()=>_,aw:()=>W,kj:()=>I,xu:()=>J})},684911:(u,x,s)=>{s.d(x,{D:()=>X});var U=s(615473),_=s(706400),W=s(906264),c=s(484573);s(757634),s(109050);const I=542327876,L=131072,J=512,k=4,i=64,d=131072;function j(u){return u.charCodeAt(0)+(u.charCodeAt(1)<<8)+(u.charCodeAt(2)<<16)+(u.charCodeAt(3)<<24)}const r=j("DXT1"),D=j("DXT3"),$=j("DXT5"),H=j("DX10"),f=113,O=116,t=2,V=10,N=88,m=31,b=0,n=1,F=2,B=3,Z=4,v=7,y=20,e=21,T=22,Q=23,E=24,l=25,z=26,S=28,R=32;class X{static GetDDSInfo(u){const x=new Int32Array(u.buffer,u.byteOffset,m),s=new Int32Array(u.buffer,u.byteOffset,m+4);let U=1;x[F]&L&&(U=Math.max(1,x[v]));const _=x[e],W=_===H?s[R]:0;let c=0;switch(_){case f:c=2;break;case O:c=1;break;case H:if(W===V){c=2;break}if(W===t){c=1;break}}return{width:x[Z],height:x[B],mipmapCount:U,isFourCC:(x[y]&k)===k,isRGB:(x[y]&i)===i,isLuminance:(x[y]&d)===d,isCube:(x[S]&J)===J,isCompressed:_===r||_===D||_===$,dxgiFormat:W,textureType:c}}static _GetHalfFloatAsFloatRGBAArrayBuffer(u,x,s,U,_,W){const I=new Float32Array(U),L=new Uint16Array(_,s);let J=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=4*(x+s*u);I[J]=c.SX(L[U]),I[J+1]=c.SX(L[U+1]),I[J+2]=c.SX(L[U+2]),X.StoreLODInAlphaChannel?I[J+3]=W:I[J+3]=c.SX(L[U+3]),J+=4}return I}static _GetHalfFloatRGBAArrayBuffer(u,x,s,U,_,W){if(X.StoreLODInAlphaChannel){const I=new Uint16Array(U),L=new Uint16Array(_,s);let J=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=4*(x+s*u);I[J]=L[U],I[J+1]=L[U+1],I[J+2]=L[U+2],I[J+3]=c.LZ(W),J+=4}return I}return new Uint16Array(_,s,U)}static _GetFloatRGBAArrayBuffer(u,x,s,U,_,W){if(X.StoreLODInAlphaChannel){const c=new Float32Array(U),I=new Float32Array(_,s);let L=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=4*(x+s*u);c[L]=I[U],c[L+1]=I[U+1],c[L+2]=I[U+2],c[L+3]=W,L+=4}return c}return new Float32Array(_,s,U)}static _GetFloatAsHalfFloatRGBAArrayBuffer(u,x,s,U,_,W){const I=new Uint16Array(U),L=new Float32Array(_,s);let J=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++)I[J]=c.LZ(L[J]),I[J+1]=c.LZ(L[J+1]),I[J+2]=c.LZ(L[J+2]),X.StoreLODInAlphaChannel?I[J+3]=c.LZ(W):I[J+3]=c.LZ(L[J+3]),J+=4;return I}static _GetFloatAsUIntRGBAArrayBuffer(u,x,s,_,W,c){const I=new Uint8Array(_),L=new Float32Array(W,s);let J=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const _=4*(x+s*u);I[J]=255*U.X.Clamp(L[_]),I[J+1]=255*U.X.Clamp(L[_+1]),I[J+2]=255*U.X.Clamp(L[_+2]),X.StoreLODInAlphaChannel?I[J+3]=c:I[J+3]=255*U.X.Clamp(L[_+3]),J+=4}return I}static _GetHalfFloatAsUIntRGBAArrayBuffer(u,x,s,_,W,I){const L=new Uint8Array(_),J=new Uint16Array(W,s);let k=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const _=4*(x+s*u);L[k]=255*U.X.Clamp(c.SX(J[_])),L[k+1]=255*U.X.Clamp(c.SX(J[_+1])),L[k+2]=255*U.X.Clamp(c.SX(J[_+2])),X.StoreLODInAlphaChannel?L[k+3]=I:L[k+3]=255*U.X.Clamp(c.SX(J[_+3])),k+=4}return L}static _GetRGBAArrayBuffer(u,x,s,U,_,W,c,I,L){const J=new Uint8Array(U),k=new Uint8Array(_,s);let i=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=4*(x+s*u);J[i]=k[U+W],J[i+1]=k[U+c],J[i+2]=k[U+I],J[i+3]=k[U+L],i+=4}return J}static _ExtractLongWordOrder(u){return 0===u||255===u||-16777216===u?0:1+X._ExtractLongWordOrder(u>>8)}static _GetRGBArrayBuffer(u,x,s,U,_,W,c,I){const L=new Uint8Array(U),J=new Uint8Array(_,s);let k=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=3*(x+s*u);L[k]=J[U+W],L[k+1]=J[U+c],L[k+2]=J[U+I],k+=3}return L}static _GetLuminanceArrayBuffer(u,x,s,U,_){const W=new Uint8Array(U),c=new Uint8Array(_,s);let I=0;for(let s=0;s<x;s++)for(let x=0;x<u;x++){const U=x+s*u;W[I]=c[U],I++}return W}static UploadDDSLevels(u,x,s,U,c,J,k=-1,i,d=!0){let j=null;U.sphericalPolynomial&&(j=[]);const y=!!u.getCaps().s3tc;x.generateMipMaps=c;const S=new Int32Array(s.buffer,s.byteOffset,m);let R,p,G,w,h,P,o,C=0,K=0,q=1;if(S[b]!==I)return void _.V.Error("Invalid magic number in DDS header");if(!U.isFourCC&&!U.isRGB&&!U.isLuminance)return void _.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(U.isCompressed&&!y)return void _.V.Error("Compressed textures are not supported on this platform.");let Y=S[T];w=S[n]+4;let g=!1;if(U.isFourCC)switch(R=S[e],R){case r:q=8,K=33777;break;case D:q=16,K=33778;break;case $:q=16,K=33779;break;case f:g=!0,Y=64;break;case O:g=!0,Y=128;break;case H:{w+=5*4;let u=!1;switch(U.dxgiFormat){case V:g=!0,Y=64,u=!0;break;case t:g=!0,Y=128,u=!0;break;case N:U.isRGB=!0,U.isFourCC=!1,Y=32,u=!0}if(u)break}default:return void _.V.Error(["Unsupported FourCC code:",(A=R,String.fromCharCode(255&A,A>>8&255,A>>16&255,A>>24&255))])}var A;const M=X._ExtractLongWordOrder(S[Q]),a=X._ExtractLongWordOrder(S[E]),uu=X._ExtractLongWordOrder(S[l]),xu=X._ExtractLongWordOrder(S[z]);g&&(K=u._getRGBABufferInternalSizedFormat(U.textureType)),P=1,S[F]&L&&!1!==c&&(P=Math.max(1,S[v]));const su=i||0,Uu=u.getCaps();for(let _=su;_<J;_++){for(p=S[Z],G=S[B],o=0;o<P;++o){if(-1===k||k===o){const W=-1===k?o:0;if(!U.isCompressed&&U.isFourCC){x.format=5,C=p*G*4;let U=null;if(u._badOS||u._badDesktopOS||!Uu.textureHalfFloat&&!Uu.textureFloat)128===Y?(U=X._GetFloatAsUIntRGBAArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,W),j&&0==W&&j.push(X._GetFloatRGBAArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,W))):64===Y&&(U=X._GetHalfFloatAsUIntRGBAArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,W),j&&0==W&&j.push(X._GetHalfFloatAsFloatRGBAArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,W))),x.type=0;else{const u=Uu.textureFloat&&(d&&Uu.textureFloatLinearFiltering||!d),_=Uu.textureHalfFloat&&(d&&Uu.textureHalfFloatLinearFiltering||!d),c=(128===Y||64===Y&&!_)&&u?1:(64===Y||128===Y&&!u)&&_?2:0;let I,L=null;if(128===Y)switch(c){case 1:I=X._GetFloatRGBAArrayBuffer,L=null;break;case 2:I=X._GetFloatAsHalfFloatRGBAArrayBuffer,L=X._GetFloatRGBAArrayBuffer;break;case 0:I=X._GetFloatAsUIntRGBAArrayBuffer,L=X._GetFloatRGBAArrayBuffer}else switch(c){case 1:I=X._GetHalfFloatAsFloatRGBAArrayBuffer,L=null;break;case 2:I=X._GetHalfFloatRGBAArrayBuffer,L=X._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:I=X._GetHalfFloatAsUIntRGBAArrayBuffer,L=X._GetHalfFloatAsFloatRGBAArrayBuffer}x.type=c,U=I(p,G,s.byteOffset+w,C,s.buffer,W),j&&0==W&&j.push(L?L(p,G,s.byteOffset+w,C,s.buffer,W):U)}U&&u._uploadDataToTextureDirectly(x,U,_,W)}else if(U.isRGB)x.type=0,24===Y?(x.format=4,C=p*G*3,h=X._GetRGBArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,M,a,uu),u._uploadDataToTextureDirectly(x,h,_,W)):(x.format=5,C=p*G*4,h=X._GetRGBAArrayBuffer(p,G,s.byteOffset+w,C,s.buffer,M,a,uu,xu),u._uploadDataToTextureDirectly(x,h,_,W));else if(U.isLuminance){const U=u._getUnpackAlignement(),c=p;C=Math.floor((p+U-1)/U)*U*(G-1)+c,h=X._GetLuminanceArrayBuffer(p,G,s.byteOffset+w,C,s.buffer),x.format=1,x.type=0,u._uploadDataToTextureDirectly(x,h,_,W)}else C=Math.max(4,p)/4*Math.max(4,G)/4*q,h=new Uint8Array(s.buffer,s.byteOffset+w,C),x.type=0,u._uploadCompressedDataToTextureDirectly(x,K,p,G,h,_,W)}w+=Y?p*G*(Y/8):C,p*=.5,G*=.5,p=Math.max(1,p),G=Math.max(1,G)}if(void 0!==i)break}j&&j.length>0?U.sphericalPolynomial=W.d.ConvertCubeMapToSphericalPolynomial({size:S[Z],right:j[0],left:j[1],up:j[2],down:j[3],front:j[4],back:j[5],format:5,type:1,gammaSpace:!1}):U.sphericalPolynomial=void 0}}X.StoreLODInAlphaChannel=!1},644973:(u,x,s)=>{s.d(x,{B:()=>W,K:()=>c});const U={},_={};function W(u){const x=u.getClassName();return _[x]||(_[x]={}),_[x]}function c(u){const x=u.getClassName();if(U[x])return U[x];U[x]={};const s=U[x];let W=u,c=x;for(;c;){const u=_[c];for(const x in u)s[x]=u[x];let x,U=!1;do{if(x=Object.getPrototypeOf(W),!x.getClassName){U=!0;break}if(x.getClassName()!==c)break;W=x}while(x);if(U)break;c=x.getClassName(),W=x}return s}},760998:(u,x,s)=>{s.d(x,{$z:()=>W,Cx:()=>O,GG:()=>H,P_:()=>i,WM:()=>k,Y9:()=>J,bR:()=>$,fW:()=>f,jT:()=>L,lK:()=>c,n1:()=>D,qK:()=>r,uM:()=>I,wL:()=>j,xG:()=>d});var U=s(644973);function _(u,x){return(s,_)=>{const W=U.B(s);W[_]||(W[_]={type:u,sourceName:x})}}function W(u,x=null){return function(u,x=null){return(s,U)=>{const _=x||"_"+U;Object.defineProperty(s,U,{get:function(){return this[_]},set:function(x){"function"==typeof this.equals&&this.equals(x)||this[_]!==x&&(this[_]=x,s[u].apply(this))},enumerable:!0,configurable:!0})}}(u,x)}function c(u){return _(0,u)}function I(u){return _(1,u)}function L(u){return _(2,u)}function J(u){return _(3,u)}function k(u){return _(4,u)}function i(u){return _(5,u)}function d(u){return _(6,u)}function j(u){return _(7,u)}function r(u){return _(8,u)}function D(u){return _(9,u)}function $(u){return _(10,u)}function H(u){return _(12,u)}function f(u){return _(11,u)}function O(u,x,s,U){const _=s.value;s.value=(...s)=>{let W=_;if("undefined"!=typeof _native&&_native[x]){const u=_native[x];W=U?(...x)=>U(...x)?u(...x):_(...x):u}return u[x]=W,W(...s)}}O.filter=function(u){return(x,s,U)=>O(x,s,U,u)}},337776:(u,x,s)=>{s.d(x,{p:()=>J});var U=s(554014),_=s(443401),W=s(332290),c=s(604910),I=s(644973);const L=function(u,x,s,U={}){const W=u();_.Y&&_.Y.HasTags(x)&&_.Y.AddTagsTo(W,_.Y.GetTags(x,!0));const c=I.K(W),L={};for(const u in c){const _=c[u],I=x[u],k=_.type;if(null!=I&&("uniqueId"!==u||J.AllowLoadingUniqueId))switch(k){case 0:case 6:case 11:W[u]=I;break;case 1:U.cloneTexturesOnlyOnce&&L[I.uniqueId]?W[u]=L[I.uniqueId]:(W[u]=s||I.isRenderTarget?I:I.clone(),L[I.uniqueId]=W[u]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:W[u]=s?I:I.clone()}}return W};class J{static AppendSerializedAnimations(u,x){if(u.animations){x.animations=[];for(let s=0;s<u.animations.length;s++){const U=u.animations[s];x.animations.push(U.serialize())}}}static Serialize(u,x){x||(x={}),_.Y&&(x.tags=_.Y.GetTags(u));const s=I.K(u);for(const U in s){const _=s[U],W=_.sourceName||U,c=_.type,I=u[U];if(null!=I&&("uniqueId"!==U||J.AllowLoadingUniqueId))switch(c){case 0:x[W]=I;break;case 1:case 3:case 7:case 9:x[W]=I.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:x[W]=I.asArray();break;case 6:case 11:x[W]=I.id}}return x}static ParseProperties(u,x,s,U){U||(U="");const _=I.K(x);for(const I in _){const L=_[I],k=u[L.sourceName||I],i=L.type;if(null!=k&&("uniqueId"!==I||J.AllowLoadingUniqueId)){const u=x;switch(i){case 0:u[I]=k;break;case 1:s&&(u[I]=J._TextureParser(k,s,U));break;case 2:u[I]=W.v9.FromArray(k);break;case 3:u[I]=J._FresnelParametersParser(k);break;case 4:u[I]=c.I9.FromArray(k);break;case 5:u[I]=c.Pq.FromArray(k);break;case 6:s&&(u[I]=s.getLastMeshById(k));break;case 7:u[I]=J._ColorCurvesParser(k);break;case 8:u[I]=W.ov.FromArray(k);break;case 9:u[I]=J._ImageProcessingConfigurationParser(k);break;case 10:u[I]=c.PT.FromArray(k);break;case 11:s&&(u[I]=s.getCameraById(k));break;case 12:u[I]=c.uq.FromArray(k)}}}}static Parse(u,x,s,U=null){const W=u();return _.Y&&_.Y.AddTagsTo(W,x.tags),J.ParseProperties(x,W,s,U),W}static Clone(u,x,s={}){return L(u,x,!1,s)}static Instanciate(u,x){return L(u,x,!0)}}J.AllowLoadingUniqueId=!1,J._ImageProcessingConfigurationParser=u=>{throw U.n("ImageProcessingConfiguration")},J._FresnelParametersParser=u=>{throw U.n("FresnelParameters")},J._ColorCurvesParser=u=>{throw U.n("ColorCurves")},J._TextureParser=(u,x,s)=>{throw U.n("Texture")}},607552:(u,x,s)=>{s.d(x,{r:()=>W});var U=s(706400);const _=(u,x,s)=>u?u.getClassName&&"Mesh"===u.getClassName()?null:!u.getClassName||"SubMesh"!==u.getClassName()&&"PhysicsBody"!==u.getClassName()?u.clone?u.clone():Array.isArray(u)?u.slice():s&&"object"==typeof u?{...u}:null:u.clone(x):null;class W{static DeepCopy(u,x,s,W,c=!1){const I=function(u){const x=[];do{Object.getOwnPropertyNames(u).forEach((function(u){-1===x.indexOf(u)&&x.push(u)}))}while(u=Object.getPrototypeOf(u));return x}(u);for(const L of I){if("_"===L[0]&&(!W||-1===W.indexOf(L)))continue;if(L.endsWith("Observable"))continue;if(s&&-1!==s.indexOf(L))continue;const I=u[L],J=typeof I;if("function"!==J)try{if("object"===J)if(I instanceof Uint8Array)x[L]=Uint8Array.from(I);else if(I instanceof Array){if(x[L]=[],I.length>0)if("object"==typeof I[0])for(let u=0;u<I.length;u++){const s=_(I[u],x,c);-1===x[L].indexOf(s)&&x[L].push(s)}else x[L]=I.slice(0)}else x[L]=_(I,x,c);else x[L]=I}catch(u){U.V.Warn(u.message)}}}}},472295:(u,x,s)=>{s.d(x,{k:()=>W});var U=s(636544),_=s(245710);class W extends _.R{get depthRenderer(){return this._depthRenderer}constructor(u){super(u)}setDepthRenderer(u=null,x=2,s=!0){const _=this._camera.getScene();this._depthRenderer&&(delete _._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null),null===u&&(_._depthRenderer||(_._depthRenderer={}),(u=this._depthRenderer=new U.d(_,x,this._camera,!1,1)).enabled=!1,this._depthRendererId="minmax"+this._camera.id,_._depthRenderer[this._depthRendererId]=u),super.setSourceTexture(u.getDepthMap(),!0,x,s)}setSourceTexture(u,x,s=2,U=!0){super.setSourceTexture(u,x,s,U)}activate(){this._depthRenderer&&(this._depthRenderer.enabled=!0),super.activate()}deactivate(){super.deactivate(),this._depthRenderer&&(this._depthRenderer.enabled=!1)}dispose(u=!0){if(super.dispose(u),this._depthRenderer&&u){const u=this._depthRenderer.getDepthMap().getScene();u&&delete u._depthRenderer[this._depthRendererId],this._depthRenderer.dispose(),this._depthRenderer=null}}}},554014:(u,x,s)=>{s.d(x,{n:()=>_});const U={};function _(u,x=!1){if(!x||!U[u])return U[u]=!0,`${u} needs to be imported before as it contains a side-effect required by your code.`}},394501:(u,x,s)=>{function U(){return"undefined"!=typeof window}function _(){return"undefined"!=typeof navigator}function W(){return"undefined"!=typeof document}function c(u){let x="",s=u.firstChild;for(;s;)3===s.nodeType&&(x+=s.textContent),s=s.nextSibling;return x}s.d(x,{Az:()=>I,BA:()=>U,Nf:()=>W,XD:()=>_,Zl:()=>c});const I={IsWindowObjectExist:U,IsNavigatorAvailable:_,IsDocumentAvailable:W,GetDOMTextContent:c}},827627:(u,x,s)=>{s.d(x,{RJ:()=>d,dq:()=>i,e9:()=>r,yp:()=>k});var U=s(499251),_=s(101032),W=s(898973),c=s(330153),I=s(615473),L=s(395726);let J;async function k(u,x,s,U,_="image/png",W,c){const I=await s.readPixels(0,0,u,x);d(u,x,new Uint8Array(I.buffer),U,_,W,!0,void 0,c)}function i(u,x,s,U="image/png",_,W=!1,c=!1,I){return new Promise((L=>{d(u,x,s,(u=>L(u)),U,_,W,c,I)}))}function d(u,x,s,k,i="image/png",d,r=!1,D=!1,$){const H=function(){if(!J){let u,x=null;const s={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{u=new OffscreenCanvas(100,100),x=new U.w(u,!1,s)}catch(_){u=document.createElement("canvas"),x=new U.w(u,!1,s)}L.q.Instances.pop(),L.q.OnEnginesDisposedObservable.add((u=>{x&&u!==x&&!x.isDisposed&&0===L.q.Instances.length&&j()})),x.getCaps().parallelShaderCompile=void 0;const W=new _.J(x),I=new _.$({engine:x,name:c.passPixelShader.name,fragmentShader:c.passPixelShader.shader,samplerNames:["textureSampler"]});J={canvas:u,engine:x,renderer:W,wrapper:I}}return J}();if(H.engine.setSize(u,x,!0),s instanceof Float32Array){const u=new Uint8Array(s.length);let x=s.length;for(;x--;){const U=s[x];u[x]=Math.round(255*I.X.Clamp(U))}s=u}const f=H.engine.createRawTexture(s,u,x,5,!1,!r,1);H.renderer.setViewport(),H.renderer.applyEffectWrapper(H.wrapper),H.wrapper.effect._bindTexture("textureSampler",f),H.renderer.draw(),D?W.S0.ToBlob(H.canvas,(u=>{const x=new FileReader;x.onload=u=>{const x=u.target.result;k&&k(x)},x.readAsArrayBuffer(u)}),i,$):W.S0.EncodeScreenshotCanvasData(H.canvas,k,i,d,$),f.dispose()}function j(){J&&(J.wrapper.dispose(),J.renderer.dispose(),J.engine.dispose()),J=null}const r={DumpData:d,DumpDataAsync:i,DumpFramebuffer:k,Dispose:j};W.S0.DumpData=d,W.S0.DumpDataAsync=i,W.S0.DumpFramebuffer=k},653505:(u,x,s)=>{s.d(x,{$h:()=>V,Hx:()=>O,RZ:()=>f,bv:()=>b,cU:()=>H,gW:()=>F,o5:()=>N,ow:()=>n,qY:()=>B});var U=s(898973),_=s(604910),W=s(615473),c=s(562756),I=s(182453),L=s(194373),J=s(889460),k=s(850034),i=s(706400),d=s(374603),j=(s(240396),s(269673),s(587053),s(827627));const r="image/png",D=2,$=[134,22,135,150,246,214,150,54];function H(u){const x=new DataView(u.buffer,u.byteOffset,u.byteLength);let s=0;for(let u=0;u<$.length;u++)if(x.getUint8(s++)!==$[u])return i.V.Error("Not a babylon environment map"),null;let U="",_=0;for(;_=x.getUint8(s++);)U+=String.fromCharCode(_);let W=JSON.parse(U);return W=f(W),W.specular&&(W.specular.specularDataPosition=s,W.specular.lodGenerationScale=W.specular.lodGenerationScale||.8),W}function f(u){if(u.version>D)throw new Error(`Unsupported babylon environment map version "${u.version}". Latest supported version is "${D}".`);return 2===u.version?u:u={...u,version:2,imageType:r}}async function O(u,x={}){var s,U;const _=u.getInternalTexture();if(!_)return Promise.reject("The cube texture is invalid.");const c=null!==(s=x.imageType)&&void 0!==s?s:r,I=_.getEngine();if(2!==u.textureType&&1!==u.textureType&&0!==u.textureType&&0!==u.textureType&&7!==u.textureType&&-1!==u.textureType)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");let L=1;if(!I.getCaps().textureFloatRender&&(L=2,!I.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");u.sphericalPolynomial;const k=null===(U=u.getInternalTexture())||void 0===U?void 0:U._sphericalPolynomialPromise,i=_.width,H=new J.Z(I),f={};I.flushFramebuffer();const O=W.X.ILog2(_.width);for(let s=0;s<=O;s++){const U=Math.pow(2,O-s);for(let _=0;_<6;_++){let W=await u.readPixels(_,s,void 0,!1);if(W&&W.byteLength===W.length){const u=new Float32Array(4*W.byteLength);for(let x=0;x<W.byteLength;x++)u[x]=W[x]/255,u[x]=Math.pow(u[x],2.2);W=u}else if(W&&u.gammaSpace){const u=W;for(let x=0;x<u.length;x++)u[x]=Math.pow(u[x],2.2)}const J=I.createRawTexture(W,U,U,5,!1,!0,1,null,L);await d.G.EncodeTextureToRGBD(J,H,L);const k=await I._readTexturePixels(J,U,U),i=await j.dq(U,U,k,c,void 0,!1,!0,x.imageQuality);f[6*s+_]=i,J.dispose()}}H.dispose(),k&&await k;const V={version:D,width:i,imageType:c,irradiance:t(u),specular:{mipmaps:[],lodGenerationScale:u.lodGenerationScale}};let N=0;for(let u=0;u<=O;u++)for(let x=0;x<6;x++){const s=f[6*u+x].byteLength;V.specular.mipmaps.push({length:s,position:N}),N+=s}const m=JSON.stringify(V),b=new ArrayBuffer(m.length+1),n=new Uint8Array(b);for(let u=0,x=m.length;u<x;u++)n[u]=m.charCodeAt(u);n[m.length]=0;const F=$.length+N+b.byteLength,B=new ArrayBuffer(F),Z=new Uint8Array(B),v=new DataView(B);let y=0;for(let u=0;u<$.length;u++)v.setUint8(y++,$[u]);Z.set(new Uint8Array(b),y),y+=b.byteLength;for(let u=0;u<=O;u++)for(let x=0;x<6;x++){const s=f[6*u+x];Z.set(new Uint8Array(s),y),y+=s.byteLength}return B}function t(u){const x=u.sphericalPolynomial;return null==x?null:{x:[x.x.x,x.x.y,x.x.z],y:[x.y.x,x.y.y,x.y.z],z:[x.z.x,x.z.y,x.z.z],xx:[x.xx.x,x.xx.y,x.xx.z],yy:[x.yy.x,x.yy.y,x.yy.z],zz:[x.zz.x,x.zz.y,x.zz.z],yz:[x.yz.x,x.yz.y,x.yz.z],zx:[x.zx.x,x.zx.y,x.zx.z],xy:[x.xy.x,x.xy.y,x.xy.z]}}function V(u,x){const s=(x=f(x)).specular;let U=W.X.Log2(x.width);if(U=Math.round(U)+1,s.mipmaps.length!==6*U)throw new Error(`Unsupported specular mipmaps number "${s.mipmaps.length}"`);const _=new Array(U);for(let x=0;x<U;x++){_[x]=new Array(6);for(let U=0;U<6;U++){const W=s.mipmaps[6*x+U];_[x][U]=new Uint8Array(u.buffer,u.byteOffset+s.specularDataPosition+W.position,W.length)}}return _}function N(u,x,s){const U=(s=f(s)).specular;return U?(u._lodGenerationScale=U.lodGenerationScale,b(u,V(x,s),s.imageType)):Promise.resolve()}function m(u,x,s,U,_,W,c,I,L,J,k){return new Promise(((i,d)=>{if(s){const s=x.createTexture(null,!0,!0,null,1,null,(u=>{d(u)}),u);null==U||U.onEffectCreatedObservable.addOnce((I=>{I.executeWhenCompiled((()=>{U.externalTextureSamplerBinding=!0,U.onApply=U=>{U._bindTexture("textureSampler",s),U.setFloat2("scale",1,x._features.needsInvertingBitmap&&u instanceof ImageBitmap?-1:1)},x.scenes.length&&(x.scenes[0].postProcessManager.directRender([U],J,!0,W,c),x.restoreDefaultFramebuffer(),s.dispose(),URL.revokeObjectURL(_),i())}))}))}else{if(x._uploadImageToTexture(k,u,W,c),I){const s=L[c];s&&x._uploadImageToTexture(s._texture,u,W,0)}i()}}))}async function b(u,x,_=r){if(!U.S0.IsExponentOfTwo(u.width))throw new Error("Texture size must be a power of two");const c=W.X.ILog2(u.width)+1,J=u.getEngine();let i=!1,d=!1,j=null,D=null,$=null;const H=J.getCaps();u.format=5,u.type=0,u.generateMipMaps=!0,u._cachedAnisotropicFilteringLevel=null,J.updateTextureSamplingMode(3,u),H.textureLOD?J._features.supportRenderAndCopyToLodForFloatTextures?H.textureHalfFloatRender&&H.textureHalfFloatLinearFiltering?(i=!0,u.type=2):H.textureFloatRender&&H.textureFloatLinearFiltering&&(i=!0,u.type=1):i=!1:(i=!1,d=!0,$={});let f=0;if(i)J.isWebGPU?(f=1,await s.e(57758).then(s.bind(s,857758))):await s.e(70775).then(s.bind(s,270775)),j=new k.w("rgbdDecode","rgbdDecode",null,null,1,null,3,J,!1,void 0,u.type,void 0,null,!1,void 0,f),u._isRGBD=!1,u.invertY=!1,D=J.createRenderTargetCubeTexture(u.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:u.type,format:5});else if(u._isRGBD=!0,u.invertY=!0,d){const x=3,s=u._lodGenerationScale,U=u._lodGenerationOffset;for(let _=0;_<x;_++){const W=(c-1)*s+U,k=U+(W-U)*(1-_/(x-1)),i=Math.round(Math.min(Math.max(k,0),W)),d=new I.h(J,2);d.isCube=!0,d.invertY=!0,d.generateMipMaps=!1,J.updateTextureSamplingMode(2,d);const j=new L.t(null);switch(j._isCube=!0,j._texture=d,$[i]=j,_){case 0:u._lodTextureLow=j;break;case 1:u._lodTextureMid=j;break;case 2:u._lodTextureHigh=j}}}const O=[];for(let s=0;s<x.length;s++)for(let U=0;U<6;U++){const W=x[s][U],c=new Blob([W],{type:_}),I=URL.createObjectURL(c);let L;if(J._features.forceBitmapOverHTMLImageElement)L=J.createImageBitmap(c,{premultiplyAlpha:"none"}).then((x=>m(x,J,i,j,I,U,s,d,$,D,u)));else{const x=new Image;x.src=I,L=new Promise(((_,W)=>{x.onload=()=>{m(x,J,i,j,I,U,s,d,$,D,u).then((()=>_())).catch((u=>{W(u)}))},x.onerror=u=>{W(u)}}))}O.push(L)}if(x.length<c){let s;const U=Math.pow(2,c-1-x.length),_=U*U*4;switch(u.type){case 0:s=new Uint8Array(_);break;case 2:s=new Uint16Array(_);break;case 1:s=new Float32Array(_)}for(let U=x.length;U<c;U++)for(let x=0;x<6;x++)J._uploadArrayBufferViewToTexture(u,s,x,U)}return Promise.all(O).then((()=>{D&&(J._releaseTexture(u),D._swapAndDie(u)),j&&j.dispose(),d&&(u._lodTextureHigh&&u._lodTextureHigh._texture&&(u._lodTextureHigh._texture.isReady=!0),u._lodTextureMid&&u._lodTextureMid._texture&&(u._lodTextureMid._texture.isReady=!0),u._lodTextureLow&&u._lodTextureLow._texture&&(u._lodTextureLow._texture.isReady=!0))}))}function n(u,x){const s=(x=f(x)).irradiance;if(!s)return;const U=new c.Q;_.Pq.FromArrayToRef(s.x,0,U.x),_.Pq.FromArrayToRef(s.y,0,U.y),_.Pq.FromArrayToRef(s.z,0,U.z),_.Pq.FromArrayToRef(s.xx,0,U.xx),_.Pq.FromArrayToRef(s.yy,0,U.yy),_.Pq.FromArrayToRef(s.zz,0,U.zz),_.Pq.FromArrayToRef(s.yz,0,U.yz),_.Pq.FromArrayToRef(s.zx,0,U.zx),_.Pq.FromArrayToRef(s.xy,0,U.xy),u._sphericalPolynomial=U}function F(u,x,s,U,_){const W=b(u.getEngine().createRawCubeTexture(null,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression),x).then((()=>u));return u.onRebuildCallback=u=>({proxy:W,isReady:!0,isAsync:!0}),u._source=13,u._bufferViewArrayArray=x,u._lodGenerationScale=U,u._lodGenerationOffset=_,u._sphericalPolynomial=s,b(u,x).then((()=>(u.isReady=!0,u)))}const B={GetEnvInfo:H,CreateEnvTextureAsync:O,CreateImageDataArrayBufferViews:V,UploadEnvLevelsAsync:N,UploadLevelsAsync:b,UploadEnvSpherical:n}},879808:(u,x,s)=>{s.d(x,{Cf:()=>U,bu:()=>W,tG:()=>_});class U extends Error{}U._setPrototypeOf=Object.setPrototypeOf||((u,x)=>(u.__proto__=x,u));const _={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class W extends U{constructor(u,x,s){super(u),this.errorCode=x,this.innerError=s,this.name="RuntimeError",U._setPrototypeOf(this,W.prototype)}}},435683:(u,x,s)=>{s.d(x,{M1:()=>V,Mi:()=>f,NJ:()=>b,VB:()=>O,W$:()=>m,ZP:()=>v,dy:()=>e,eC:()=>t,f2:()=>Z,hX:()=>H,my:()=>B,qc:()=>N,rh:()=>Q,rz:()=>y,sh:()=>F,wS:()=>T,zU:()=>n});var U=s(732259),_=s(394501),W=s(638113),c=s(705124),I=s(546793),L=s(879808),J=s(711210),k=s(867967),i=s(395726),d=s(706400),j=s(602187),r=s(45410),D=s(33321);const $=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class H extends L.bu{constructor(u,x){super(u,L.tG.LoadFileError),this.name="LoadFileError",L.Cf._setPrototypeOf(this,H.prototype),x instanceof U.u?this.request=x:this.file=x}}class f extends L.bu{constructor(u,x){super(u,L.tG.RequestFileError),this.request=x,this.name="RequestFileError",L.Cf._setPrototypeOf(this,f.prototype)}}class O extends L.bu{constructor(u,x){super(u,L.tG.ReadFileError),this.file=x,this.name="ReadFileError",L.Cf._setPrototypeOf(this,O.prototype)}}const t={DefaultRetryStrategy:I.a.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:u=>u,ScriptBaseUrl:"",ScriptPreprocessUrl:u=>u,CleanUrl:u=>u.replace(/#/gm,"%23")},V=(u,x)=>{if((!u||0!==u.indexOf("data:"))&&t.CorsBehavior)if("string"==typeof t.CorsBehavior||t.CorsBehavior instanceof String)x.crossOrigin=t.CorsBehavior;else{const s=t.CorsBehavior(u);s&&(x.crossOrigin=s)}},N={getRequiredSize:null},m=(u,x,s,_,W="",I)=>{const L=i.q.LastCreatedEngine;if("undefined"==typeof HTMLImageElement&&!(null==L?void 0:L._features.forceBitmapOverHTMLImageElement))return s("LoadImage is only supported in web or BabylonNative environments."),null;let k,d=!1;u instanceof ArrayBuffer||ArrayBuffer.isView(u)?"undefined"!=typeof Blob&&"undefined"!=typeof URL?(k=URL.createObjectURL(new Blob([u],{type:W})),d=!0):k=`data:${W};base64,`+J.EL(u):u instanceof Blob?(k=URL.createObjectURL(u),d=!0):(k=t.CleanUrl(u),k=t.PreprocessUrl(k));const j=x=>{if(s){const U=k||u.toString();s(`Error while trying to load image: ${0===U.indexOf("http")||U.length<=128?U:U.slice(0,128)+"..."}`,x)}};if(null==L?void 0:L._features.forceBitmapOverHTMLImageElement)return n(k,(U=>{L.createImageBitmap(new Blob([U],{type:W}),{premultiplyAlpha:"none",...I}).then((u=>{x(u),d&&URL.revokeObjectURL(k)})).catch((x=>{s&&s("Error while trying to load image: "+u,x)}))}),void 0,_||void 0,!0,((u,x)=>{j(x)})),null;const r=new Image;if(N.getRequiredSize){const x=N.getRequiredSize(u);x.width&&(r.width=x.width),x.height&&(r.height=x.height)}V(k,r);const D=[],$=()=>{D.forEach((u=>{u.target.removeEventListener(u.name,u.handler)})),D.length=0};D.push({target:r,name:"load",handler:()=>{$(),x(r),d&&r.src&&URL.revokeObjectURL(r.src)}}),D.push({target:r,name:"error",handler:u=>{$(),j(u),d&&r.src&&URL.revokeObjectURL(r.src)}}),D.push({target:document,name:"securitypolicyviolation",handler:u=>{if(u.blockedURI!==r.src||"report"===u.disposition)return;$();const x=new Error(`CSP violation of policy ${u.effectiveDirective} ${u.blockedURI}. Current policy is ${u.originalPolicy}`);i.q.UseFallbackTexture=!1,j(x),d&&r.src&&URL.revokeObjectURL(r.src),r.src=""}}),D.forEach((u=>{u.target.addEventListener(u.name,u.handler)}));const H="blob:"===k.substring(0,5),f="data:"===k.substring(0,5),O=()=>{H||f||!U.u.IsCustomRequestAvailable?r.src=k:n(k,((u,x,s)=>{const U=new Blob([u],{type:!W&&s?s:W}),_=URL.createObjectURL(U);d=!0,r.src=_}),void 0,_||void 0,!0,((u,x)=>{j(x)}))};if(!H&&!f&&_&&_.enableTexturesOffline)_.open((()=>{_&&_.loadImage(k,r)}),O);else{if(-1!==k.indexOf("file:")){const u=decodeURIComponent(k.substring(5).toLowerCase());if(c.T.FilesToLoad[u]&&"undefined"!=typeof URL){try{let x;try{x=URL.createObjectURL(c.T.FilesToLoad[u])}catch(s){x=URL.createObjectURL(c.T.FilesToLoad[u])}r.src=x,d=!0}catch(u){r.src=""}return r}}O()}return r},b=(u,x,s,U,_)=>{const c=new FileReader,I={onCompleteObservable:new W.cP,abort:()=>c.abort()};return c.onloadend=()=>I.onCompleteObservable.notifyObservers(I),_&&(c.onerror=()=>{_(new O(`Unable to read ${u.name}`,u))}),c.onload=u=>{x(u.target["result"])},s&&(c.onprogress=s),U?c.readAsArrayBuffer(u):c.readAsText(u),I},n=(u,x,s,U,_,I,L)=>{if(u.name)return b(u,x,s,_,I?u=>{I(void 0,u)}:void 0);const J=u;if(-1!==J.indexOf("file:")){let u=decodeURIComponent(J.substring(5).toLowerCase());0===u.indexOf("./")&&(u=u.substring(2));const U=c.T.FilesToLoad[u];if(U)return b(U,x,s,_,I?u=>I(void 0,new H(u.message,u.file)):void 0)}const{match:k,type:i}=v(J);if(k){const u={onCompleteObservable:new W.cP,abort:()=>()=>{}};try{const u=_?y(J):e(J);x(u,void 0,i)}catch(u){I?I(void 0,u):d.V.Error(u.message||"Failed to parse the Data URL")}return j._.SetImmediate((()=>{u.onCompleteObservable.notifyObservers(u)})),u}return F(J,((u,s)=>{x(u,null==s?void 0:s.responseURL,null==s?void 0:s.getResponseHeader("content-type"))}),s,U,_,I?u=>{I(u.request,new H(u.message,u.request))}:void 0,L)},F=(u,x,s,c,I,L,J)=>{u=t.CleanUrl(u),u=t.PreprocessUrl(u);const k=t.BaseUrl+u;let i=!1;const j={onCompleteObservable:new W.cP,abort:()=>i=!0},r=()=>{let u,W=new U.u,c=null;const r=()=>{W&&(s&&W.removeEventListener("progress",s),u&&W.removeEventListener("readystatechange",u),W.removeEventListener("loadend",D))};let D=()=>{r(),j.onCompleteObservable.notifyObservers(j),j.onCompleteObservable.clear(),s=void 0,u=null,D=null,L=void 0,J=void 0,x=void 0};j.abort=()=>{i=!0,D&&D(),W&&W.readyState!==(XMLHttpRequest.DONE||4)&&W.abort(),null!==c&&(clearTimeout(c),c=null),W=null};const $=u=>{const x=u.message||"Unknown error";L&&W?L(new f(x,W)):d.V.Error(x)},H=d=>{if(W){if(W.open("GET",k),J)try{J(W)}catch(u){return void $(u)}I&&(W.responseType="arraybuffer"),s&&W.addEventListener("progress",s),D&&W.addEventListener("loadend",D),u=()=>{if(!i&&W&&W.readyState===(XMLHttpRequest.DONE||4)){if(u&&W.removeEventListener("readystatechange",u),W.status>=200&&W.status<300||0===W.status&&(!_.BA()||B())){try{x&&x(I?W.response:W.responseText,W)}catch(u){$(u)}return}const s=t.DefaultRetryStrategy;if(s){const u=s(k,W,d);if(-1!==u)return r(),W=new U.u,void(c=setTimeout((()=>H(d+1)),u))}const J=new f("Error status: "+W.status+" "+W.statusText+" - Unable to load "+k,W);L&&L(J)}},W.addEventListener("readystatechange",u),W.send()}};H(0)};if(c&&c.enableSceneOffline){const U=u=>{u&&u.status>400?L&&L(u):r()},_=()=>{c&&c.loadFile(t.BaseUrl+u,(u=>{!i&&x&&x(u),j.onCompleteObservable.notifyObservers(j)}),s?u=>{!i&&s&&s(u)}:void 0,U,I)};c.open(_,U)}else r();return j},B=()=>"undefined"!=typeof location&&"file:"===location.protocol,Z=u=>$.test(u),v=u=>{const x=$.exec(u);return null===x||0===x.length?{match:!1,type:""}:{match:!0,type:x[0].replace("data:","").replace("base64,","")}};function y(u){return J.yS(u.split(",")[1])}const e=u=>J.AV(u.split(",")[1]);let T;D.$._FileToolsLoadImage=m,r.sg.loadFile=n,k.J.loadFile=n;const Q=(u,x,s,U,_,W,c,I,L,J)=>{T={DecodeBase64UrlToBinary:u,DecodeBase64UrlToString:x,DefaultRetryStrategy:s.DefaultRetryStrategy,BaseUrl:s.BaseUrl,CorsBehavior:s.CorsBehavior,PreprocessUrl:s.PreprocessUrl,IsBase64DataUrl:U,IsFileURL:_,LoadFile:W,LoadImage:c,ReadFile:I,RequestFile:L,SetCorsBehavior:J},Object.defineProperty(T,"DefaultRetryStrategy",{get:function(){return s.DefaultRetryStrategy},set:function(u){s.DefaultRetryStrategy=u}}),Object.defineProperty(T,"BaseUrl",{get:function(){return s.BaseUrl},set:function(u){s.BaseUrl=u}}),Object.defineProperty(T,"PreprocessUrl",{get:function(){return s.PreprocessUrl},set:function(u){s.PreprocessUrl=u}}),Object.defineProperty(T,"CorsBehavior",{get:function(){return s.CorsBehavior},set:function(u){s.CorsBehavior=u}})};Q(y,e,t,Z,B,n,m,b,F,V)},705124:(u,x,s)=>{s.d(x,{T:()=>U});class U{}U.FilesToLoad={}},977041:(u,x,s)=>{function U(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(u=>{const x=16*Math.random()|0;return("x"===u?x:3&x|8).toString(16)}))}s.d(x,{S:()=>_,z:()=>U});const _={RandomId:U}},862e3:(u,x,s)=>{s.d(x,{n:()=>W});var U=s(706400),_=s(310035);class W{static Instantiate(u){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[u])return this.RegisteredExternalClasses[u];const x=_.n9(u);if(x)return x;U.V.Warn(u+" not found, you may have missed an import.");const s=u.split(".");let W=window||this;for(let u=0,x=s.length;u<x;u++)W=W[s[u]];return"function"!=typeof W?null:W}}W.RegisteredExternalClasses={}},706400:(u,x,s)=>{s.d(x,{V:()=>U});class U{static _CheckLimit(u,x){let s=U._LogLimitOutputs[u];return s?s.current++:(s={limit:x,current:1},U._LogLimitOutputs[u]=s),s.current<=s.limit}static _GenerateLimitMessage(u,x=1){var s;const _=U._LogLimitOutputs[u];if(!_||!U.MessageLimitReached)return;const W=this._Levels[x];_.current===_.limit&&U[W.name](U.MessageLimitReached.replace(/%LIMIT%/g,""+_.limit).replace(/%TYPE%/g,null!==(s=W.name)&&void 0!==s?s:""))}static _AddLogEntry(u){U._LogCache=u+U._LogCache,U.OnNewCacheEntry&&U.OnNewCacheEntry(u)}static _FormatMessage(u){const x=u=>u<10?"0"+u:""+u,s=new Date;return"["+x(s.getHours())+":"+x(s.getMinutes())+":"+x(s.getSeconds())+"]: "+u}static _LogDisabled(u,x){}static _LogEnabled(u=1,x,s){const _=Array.isArray(x)?x[0]:x;if(void 0!==s&&!U._CheckLimit(_,s))return;const W=U._FormatMessage(_),c=this._Levels[u],I=Array.isArray(x)?x.slice(1):[];c.logFunc&&c.logFunc("BJS - "+W,...I);const L=`<div style='color:${c.color}'>${W}</div><br>`;U._AddLogEntry(L),U._GenerateLimitMessage(_,u)}static get LogCache(){return U._LogCache}static ClearLogCache(){U._LogCache="",U._LogLimitOutputs={},U.errorsCount=0}static set LogLevels(u){U.Log=U._LogDisabled,U.Warn=U._LogDisabled,U.Error=U._LogDisabled,[U.MessageLogLevel,U.WarningLogLevel,U.ErrorLogLevel].forEach((x=>{if((u&x)===x){const u=this._Levels[x];U[u.name]=U._LogEnabled.bind(U,x)}}))}}U.NoneLogLevel=0,U.MessageLogLevel=1,U.WarningLogLevel=2,U.ErrorLogLevel=4,U.AllLogLevel=7,U.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",U._LogCache="",U._LogLimitOutputs={},U._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],U.errorsCount=0,U.Log=U._LogEnabled.bind(U,U.MessageLogLevel),U.Warn=U._LogEnabled.bind(U,U.WarningLogLevel),U.Error=U._LogEnabled.bind(U,U.ErrorLogLevel)},245710:(u,x,s)=>{s.d(x,{R:()=>I});var U=s(638113),_=s(850034),W=s(848287);s(269673);const c=`varying vec2 vUV;uniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;uniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));float f1=texelFetch(sourceTexture,coord,0).r;float f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;float f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;float f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;float minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(MAIN)\nuniform vec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*(texSize-1.0));vec2 f1=texelFetch(textureSampler,coord,0).rg;vec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;vec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;vec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;float minz=min(min(min(f1.x,f2.x),f3.x),f4.x);float maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;void main(void)\n{ivec2 coord=ivec2(vUV*vec2(texSize-1));vec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;vec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;vec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;vec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;float minz=min(f1.x,f2.x);float maxz=max(f1.y,f2.y);glFragColor=vec4(minz,maxz,0.,0.);}\n#elif defined(LAST)\nvoid main(void)\n{glFragColor=vec4(0.);if (true) { \ndiscard;}}\n#endif\n`;s(395879).l.ShadersStore["minmaxReduxPixelShader"]=c;class I{constructor(u){this.onAfterReductionPerformed=new U.cP,this._forceFullscreenViewport=!0,this._activated=!1,this._camera=u,this._postProcessManager=new W.X(u.getScene()),this._onContextRestoredObserver=u.getEngine().onContextRestoredObservable.add((()=>{this._postProcessManager._rebuild()}))}get sourceTexture(){return this._sourceTexture}setSourceTexture(u,x,s=2,U=!0){if(u===this._sourceTexture)return;this.dispose(!1),this._sourceTexture=u,this._reductionSteps=[],this._forceFullscreenViewport=U;const W=this._camera.getScene(),c=new _.w("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,1,W.getEngine(),!1,"#define INITIAL"+(x?"\n#define DEPTH_REDUX":""),s,void 0,void 0,void 0,7);c.autoClear=!1,c.forceFullscreenViewport=U;let I=this._sourceTexture.getRenderWidth(),L=this._sourceTexture.getRenderHeight();c.onApply=((u,x)=>s=>{s.setTexture("sourceTexture",this._sourceTexture),s.setFloat2("texSize",u,x)})(I,L),this._reductionSteps.push(c);let J=1;for(;I>1||L>1;){I=Math.max(Math.round(I/2),1),L=Math.max(Math.round(L/2),1);const u=new _.w("Reduction phase "+J,"minmaxRedux",["texSize"],null,{width:I,height:L},null,1,W.getEngine(),!1,"#define "+(1==I&&1==L?"LAST":1==I||1==L?"ONEBEFORELAST":"MAIN"),s,void 0,void 0,void 0,7);if(u.autoClear=!1,u.forceFullscreenViewport=U,u.onApply=((u,x)=>s=>{1==u||1==x?s.setInt2("texSize",u,x):s.setFloat2("texSize",u,x)})(I,L),this._reductionSteps.push(u),J++,1==I&&1==L){const x=(u,x,s)=>{const U=new Float32Array(4*u*x),_={min:0,max:0};return()=>{W.getEngine()._readTexturePixels(s.inputTexture.texture,u,x,-1,0,U,!1),_.min=U[0],_.max=U[1],this.onAfterReductionPerformed.notifyObservers(_)}};u.onAfterRenderObservable.add(x(I,L,u))}}}get refreshRate(){return this._sourceTexture?this._sourceTexture.refreshRate:-1}set refreshRate(u){this._sourceTexture&&(this._sourceTexture.refreshRate=u)}get activated(){return this._activated}activate(){!this._onAfterUnbindObserver&&this._sourceTexture&&(this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add((()=>{var u,x;const s=this._camera.getScene().getEngine();null===(u=s._debugPushGroup)||void 0===u||u.call(s,`min max reduction`,1),this._reductionSteps[0].activate(this._camera),this._postProcessManager.directRender(this._reductionSteps,this._reductionSteps[0].inputTexture,this._forceFullscreenViewport),s.unBindFramebuffer(this._reductionSteps[0].inputTexture,!1),null===(x=s._debugPopGroup)||void 0===x||x.call(s,1)})),this._activated=!0)}deactivate(){this._onAfterUnbindObserver&&this._sourceTexture&&(this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=null,this._activated=!1)}dispose(u=!0){if(u&&(this.onAfterReductionPerformed.clear(),this._onContextRestoredObserver&&(this._camera.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)),this.deactivate(),this._reductionSteps){for(let u=0;u<this._reductionSteps.length;++u)this._reductionSteps[u].dispose();this._reductionSteps=null}this._postProcessManager&&u&&this._postProcessManager.dispose(),this._sourceTexture=null}}},638113:(u,x,s)=>{s.d(x,{cP:()=>W,nu:()=>_,qO:()=>U});class U{constructor(u,x=!1,s,U){this.initialize(u,x,s,U)}initialize(u,x=!1,s,U){return this.mask=u,this.skipNextObservers=x,this.target=s,this.currentTarget=U,this}}class _{constructor(u,x,s=null){this.callback=u,this.mask=x,this.scope=s,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class W{static FromPromise(u,x){const s=new W;return u.then((u=>{s.notifyObservers(u)})).catch((u=>{if(!x)throw u;x.notifyObservers(u)})),s}get observers(){return this._observers}constructor(u,x=!1){this.notifyIfTriggered=x,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new U(0),u&&(this._onObserverAdded=u)}add(u,x=-1,s=!1,U=null,W=!1){if(!u)return null;const c=new _(u,x,U);return c.unregisterOnNextCall=W,s?this._observers.unshift(c):this._observers.push(c),this._onObserverAdded&&this._onObserverAdded(c),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(c,this._lastNotifiedValue),c._remove=()=>{this.remove(c)},c}addOnce(u){return this.add(u,void 0,void 0,void 0,!0)}remove(u){return!!u&&(u._remove=null,-1!==this._observers.indexOf(u)&&(this._deferUnregister(u),!0))}removeCallback(u,x){for(let s=0;s<this._observers.length;s++){const U=this._observers[s];if(!(U._willBeUnregistered||U.callback!==u||x&&x!==U.scope))return this._deferUnregister(U),!0}return!1}_deferUnregister(u){u._willBeUnregistered||(this._numObserversMarkedAsDeleted++,u.unregisterOnNextCall=!1,u._willBeUnregistered=!0,setTimeout((()=>{this._remove(u)}),0))}_remove(u,x=!0){if(!u)return!1;const s=this._observers.indexOf(u);return-1!==s&&(x&&this._numObserversMarkedAsDeleted--,this._observers.splice(s,1),!0)}makeObserverTopPriority(u){this._remove(u,!1),this._observers.unshift(u)}makeObserverBottomPriority(u){this._remove(u,!1),this._observers.push(u)}notifyObservers(u,x=-1,s,U,_){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),!this._observers.length)return!0;const W=this._eventState;W.mask=x,W.target=s,W.currentTarget=U,W.skipNextObservers=!1,W.lastReturnValue=u,W.userInfo=_;for(const s of this._observers)if(!s._willBeUnregistered&&(s.mask&x&&(s.unregisterOnNextCall&&this._deferUnregister(s),s.scope?W.lastReturnValue=s.callback.apply(s.scope,[u,W]):W.lastReturnValue=s.callback(u,W)),W.skipNextObservers))return!1;return!0}notifyObserver(u,x,s=-1){if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=x),u._willBeUnregistered)return;const U=this._eventState;U.mask=s,U.skipNextObservers=!1,u.unregisterOnNextCall&&this._deferUnregister(u),u.callback(x,U)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const u=this._observers.pop();u&&(u._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const u=new W;return u._observers=this._observers.slice(0),u}hasSpecificMask(u=-1){for(const x of this._observers)if(x.mask&u||x.mask===u)return!0;return!1}}},850327:(u,x,s)=>{s.d(x,{A:()=>_});var U=s(488354);class _{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(u,x){_.Enabled&&(this._current+=u,x&&this._fetchResult())}beginMonitoring(){_.Enabled&&(this._startMonitoringTime=U.j.Now)}endMonitoring(u=!0){if(!_.Enabled)return;u&&this.fetchNewFrame();const x=U.j.Now;this._current=x-this._startMonitoringTime,u&&this._fetchResult()}endFrame(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const u=U.j.Now;u-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=u,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}_.Enabled=!0},636828:(u,x,s)=>{s.d(x,{K:()=>W,r:()=>_});var U=s(488354);class _{constructor(u=30){this._enabled=!0,this._rollingFrameTime=new W(u)}sampleFrame(u=U.j.Now){if(this._enabled){if(null!=this._lastFrameTimeMs){const x=u-this._lastFrameTimeMs;this._rollingFrameTime.add(x)}this._lastFrameTimeMs=u}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const u=this._rollingFrameTime.history(0);return 0===u?0:1e3/u}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class W{constructor(u){this._samples=new Array(u),this.reset()}add(u){let x;if(this.isSaturated()){const u=this._samples[this._pos];x=u-this.average,this.average-=x/(this._sampleCount-1),this._m2-=x*(u-this.average)}else this._sampleCount++;x=u-this.average,this.average+=x/this._sampleCount,this._m2+=x*(u-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=u,this._pos++,this._pos%=this._samples.length}history(u){if(u>=this._sampleCount||u>=this._samples.length)return 0;const x=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(x-u)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(u){const x=this._samples.length;return(u%x+x)%x}}},488354:(u,x,s)=>{s.d(x,{j:()=>_});var U=s(394501);class _{static get Now(){return U.BA()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},546793:(u,x,s)=>{s.d(x,{a:()=>U});class U{static ExponentialBackoff(u=3,x=500){return(s,U,_)=>0!==U.status||_>=u||-1!==s.indexOf("file:")?-1:Math.pow(2,_)*x}}},374603:(u,x,s)=>{s.d(x,{G:()=>W});var U=s(850034),_=(s(68561),s(484573));class W{static ExpandRGBDTexture(u){const x=u._texture;if(!x||!u.isRGBD)return;const _=x.getEngine(),W=_.getCaps(),c=x.isReady;let I=!1;W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering?(I=!0,x.type=2):W.textureFloatRender&&W.textureFloatLinearFiltering&&(I=!0,x.type=1),I&&(x.isReady=!1,x._isRGBD=!1,x.invertY=!1);const L=async()=>{const W=_.isWebGPU,c=W?1:0;x.isReady=!1,this._ShaderImported||(this._ShaderImported=!0,W?await Promise.all([s.e(57758).then(s.bind(s,857758)),s.e(18674).then(s.bind(s,918674))]):await Promise.all([s.e(70775).then(s.bind(s,270775)),s.e(57151).then(s.bind(s,757151))]));const I=new U.w("rgbdDecode","rgbdDecode",null,null,1,null,3,_,!1,void 0,x.type,void 0,null,!1,void 0,c);I.externalTextureSamplerBinding=!0;const L=_.createRenderTargetTexture(x.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:x.samplingMode,type:x.type,format:5});I.onEffectCreatedObservable.addOnce((s=>{s.executeWhenCompiled((()=>{I.onApply=u=>{u._bindTexture("textureSampler",x),u.setFloat2("scale",1,1)},u.getScene().postProcessManager.directRender([I],L,!0),_.restoreDefaultFramebuffer(),_._releaseTexture(x),I&&I.dispose(),L._swapAndDie(x),x.isReady=!0}))}))};I&&(c?L():u.onLoadObservable.addOnce(L))}static EncodeTextureToRGBD(u,x,s=0){return _.Qs("rgbdEncode",u,x,s,1,5)}}W._ShaderImported=!1},293506:(u,x,s)=>{s.d(x,{L:()=>U,b:()=>_});class U{constructor(u){this.length=0,this.data=new Array(u),this._id=U._GlobalId++}push(u){this.data[this.length++]=u,this.length>this.data.length&&(this.data.length*=2)}forEach(u){for(let x=0;x<this.length;x++)u(this.data[x])}sort(u){this.data.sort(u)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(u){if(0!==u.length){this.length+u.length>this.data.length&&(this.data.length=2*(this.length+u.length));for(let x=0;x<u.length;x++)this.data[this.length++]=(u.data||u)[x]}}indexOf(u){const x=this.data.indexOf(u);return x>=this.length?-1:x}contains(u){return-1!==this.indexOf(u)}}U._GlobalId=0;class _ extends U{constructor(){super(...arguments),this._duplicateId=0}push(u){super.push(u),u.__smartArrayFlags||(u.__smartArrayFlags={}),u.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(u){return!(u.__smartArrayFlags&&u.__smartArrayFlags[this._id]===this._duplicateId||(this.push(u),0))}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(u){if(0!==u.length){this.length+u.length>this.data.length&&(this.data.length=2*(this.length+u.length));for(let x=0;x<u.length;x++){const s=(u.data||u)[x];this.pushNoDuplicate(s)}}}}},867741:(u,x,s)=>{s.d(x,{w:()=>U});class U{constructor(){this._count=0,this._data={}}copyFrom(u){this.clear(),u.forEach(((u,x)=>this.add(u,x)))}get(u){const x=this._data[u];if(void 0!==x)return x}getOrAddWithFactory(u,x){let s=this.get(u);return void 0!==s||(s=x(u),s&&this.add(u,s)),s}getOrAdd(u,x){const s=this.get(u);return void 0!==s?s:(this.add(u,x),x)}contains(u){return void 0!==this._data[u]}add(u,x){return void 0===this._data[u]&&(this._data[u]=x,++this._count,!0)}set(u,x){return void 0!==this._data[u]&&(this._data[u]=x,!0)}getAndRemove(u){const x=this.get(u);return void 0!==x?(delete this._data[u],--this._count,x):null}remove(u){return!!this.contains(u)&&(delete this._data[u],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(u){for(const x in this._data)u(x,this._data[x])}first(u){for(const x in this._data){const s=u(x,this._data[x]);if(s)return s}return null}}},711210:(u,x,s)=>{s.d(x,{AV:()=>I,EL:()=>c,LW:()=>J,Tq:()=>W,UH:()=>_,jq:()=>U,nQ:()=>k,yS:()=>L});const U=(u,x)=>u.endsWith(x),_=(u,x)=>!!u&&u.startsWith(x),W=u=>{if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(u);let x="";for(let s=0;s<u.byteLength;s++)x+=String.fromCharCode(u[s]);return x},c=u=>{const x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s,U,_,W,c,I,L,J="",k=0;const i=ArrayBuffer.isView(u)?new Uint8Array(u.buffer,u.byteOffset,u.byteLength):new Uint8Array(u);for(;k<i.length;)s=i[k++],U=k<i.length?i[k++]:Number.NaN,_=k<i.length?i[k++]:Number.NaN,W=s>>2,c=(3&s)<<4|U>>4,I=(15&U)<<2|_>>6,L=63&_,isNaN(U)?I=L=64:isNaN(_)&&(L=64),J+=x.charAt(W)+x.charAt(c)+x.charAt(I)+x.charAt(L);return J},I=u=>atob(u),L=u=>{const x=I(u),s=x.length,U=new Uint8Array(new ArrayBuffer(s));for(let u=0;u<s;u++)U[u]=x.charCodeAt(u);return U.buffer},J=(u,x)=>{let s=String(u);for(;s.length<x;)s="0"+s;return s},k={EndsWith:U,StartsWith:_,Decode:W,EncodeArrayBufferToBase64:c,DecodeBase64ToString:I,DecodeBase64ToBinary:L,PadNumber:J}},443401:(u,x,s)=>{s.d(x,{Y:()=>_});var U=s(161892);class _{static EnableFor(u){u._tags=u._tags||{},u.hasTags=()=>_.HasTags(u),u.addTags=x=>_.AddTagsTo(u,x),u.removeTags=x=>_.RemoveTagsFrom(u,x),u.matchesTagsQuery=x=>_.MatchesQuery(u,x)}static DisableFor(u){delete u._tags,delete u.hasTags,delete u.addTags,delete u.removeTags,delete u.matchesTagsQuery}static HasTags(u){if(!u._tags)return!1;const x=u._tags;for(const u in x)if(Object.prototype.hasOwnProperty.call(x,u))return!0;return!1}static GetTags(u,x=!0){if(!u._tags)return null;if(x){const x=[];for(const s in u._tags)Object.prototype.hasOwnProperty.call(u._tags,s)&&!0===u._tags[s]&&x.push(s);return x.join(" ")}return u._tags}static AddTagsTo(u,x){x&&"string"==typeof x&&x.split(" ").forEach((function(x){_._AddTagTo(u,x)}))}static _AddTagTo(u,x){""!==(x=x.trim())&&"true"!==x&&"false"!==x&&(x.match(/[\s]/)||x.match(/^([!]|([|]|[&]){2})/)||(_.EnableFor(u),u._tags[x]=!0))}static RemoveTagsFrom(u,x){if(!_.HasTags(u))return;const s=x.split(" ");for(const x in s)_._RemoveTagFrom(u,s[x])}static _RemoveTagFrom(u,x){delete u._tags[x]}static MatchesQuery(u,x){return void 0===x||(""===x?_.HasTags(u):U.Z.Eval(x,(x=>_.HasTags(u)&&u._tags[x])))}}},484573:(u,x,s)=>{s.d(x,{Qs:()=>i,EE:()=>k,SX:()=>D,Oz:()=>H,LO:()=>f,LZ:()=>r});var U=s(432050),_=s(888413),W=s(882621),c=s(850034),I=s(395879);const L=`#extension GL_EXT_shader_texture_lod : enable\nprecision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)\n{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n`;I.l.ShadersStore["lodPixelShader"]=L;const J=`precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)\n{vec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);\n#endif\nif (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n`;function k(u,x,s,c=!0){const I=u.getScene(),L=I.getEngine(),J=new _.$("resized"+u.name,{width:x,height:s},I,!u.noMipmap,!0,u._texture.type,!1,u.samplingMode,!1);J.wrapU=u.wrapU,J.wrapV=u.wrapV,J.uOffset=u.uOffset,J.vOffset=u.vOffset,J.uScale=u.uScale,J.vScale=u.vScale,J.uAng=u.uAng,J.vAng=u.vAng,J.wAng=u.wAng,J.coordinatesIndex=u.coordinatesIndex,J.level=u.level,J.anisotropicFilteringLevel=u.anisotropicFilteringLevel,J._texture.isReady=!1,u.wrapU=U.g.CLAMP_ADDRESSMODE,u.wrapV=U.g.CLAMP_ADDRESSMODE;const k=new W.v("pass",1,null,c?U.g.BILINEAR_SAMPLINGMODE:U.g.NEAREST_SAMPLINGMODE,L,!1,0);return k.externalTextureSamplerBinding=!0,k.onEffectCreatedObservable.addOnce((x=>{x.executeWhenCompiled((()=>{k.onApply=function(x){x.setTexture("textureSampler",u)};const x=J.renderTarget;x&&(I.postProcessManager.directRender([k],x),L.unBindFramebuffer(x),J.disposeFramebufferObjects(),k.dispose(),J.getInternalTexture().isReady=!0)}))})),J}function i(u,x,s,U,_,W,I,L){const J=x.getEngine();return x.isReady=!1,_=null!=_?_:x.samplingMode,U=null!=U?U:x.type,W=null!=W?W:x.format,I=null!=I?I:x.width,L=null!=L?L:x.height,-1===U&&(U=0),new Promise((k=>{const i=new c.w("postprocess",u,null,null,1,null,_,J,!1,void 0,U,void 0,null,!1,W);i.externalTextureSamplerBinding=!0;const d=J.createRenderTargetTexture({width:I,height:L},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:_,type:U,format:W});i.onEffectCreatedObservable.addOnce((u=>{u.executeWhenCompiled((()=>{i.onApply=u=>{u._bindTexture("textureSampler",x),u.setFloat2("scale",1,1)},s.postProcessManager.directRender([i],d,!0),J.restoreDefaultFramebuffer(),J._releaseTexture(x),i&&i.dispose(),d._swapAndDie(x),x.type=U,x.format=5,x.isReady=!0,k(x)}))}))}))}let d,j;function r(u){d||(d=new Float32Array(1),j=new Int32Array(d.buffer)),d[0]=u;const x=j[0];let s=x>>16&32768,U=x>>12&2047;const _=x>>23&255;return _<103?s:_>142?(s|=31744,s|=(255==_?0:1)&&8388607&x,s):_<113?(U|=2048,s|=(U>>114-_)+(U>>113-_&1),s):(s|=_-112<<10|U>>1,s+=1&U,s)}function D(u){const x=(32768&u)>>15,s=(31744&u)>>10,U=1023&u;return 0===s?(x?-1:1)*Math.pow(2,-14)*(U/Math.pow(2,10)):31==s?U?NaN:(x?-1:1)*(1/0):(x?-1:1)*Math.pow(2,s-15)*(1+U/Math.pow(2,10))}I.l.ShadersStore["lodCubePixelShader"]=J;const $=async(u,x,s,W,I)=>{const L=u.getScene(),J=L.getEngine();let k;if(u.isCube){const u=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];k=new c.w("lodCube","lodCube",["lod","gamma"],null,1,null,U.g.NEAREST_NEAREST_MIPNEAREST,J,!1,u[W])}else k=new c.w("lod","lod",["lod","gamma"],null,1,null,U.g.NEAREST_NEAREST_MIPNEAREST,J);await new Promise((u=>{k.onEffectCreatedObservable.addOnce((x=>{x.executeWhenCompiled((()=>{u(0)}))}))}));const i=new _.$("temp",{width:x,height:s},L,!1);k.onApply=function(x){x.setTexture("textureSampler",u),x.setFloat("lod",I),x.setBool("gamma",u.gammaSpace)};const d=u.getInternalTexture();try{if(i.renderTarget&&d){const _=d.samplingMode;0!==I?u.updateSamplingMode(U.g.NEAREST_NEAREST_MIPNEAREST):u.updateSamplingMode(U.g.NEAREST_NEAREST),L.postProcessManager.directRender([k],i.renderTarget,!0),u.updateSamplingMode(_);const W=await J.readPixels(0,0,x,s),c=new Uint8Array(W.buffer,0,W.byteLength);return J.unBindFramebuffer(i.renderTarget),c}throw Error("Render to texture failed.")}finally{i.dispose(),k.dispose()}};async function H(u,x,s,U=0,_=0){return!u.isReady()&&u._texture&&await new Promise(((x,s)=>{null!==u._texture?u._texture.onLoadedObservable.addOnce((()=>{x(0)})):s(0)})),await $(u,x,s,U,_)}const f={CreateResizedCopy:k,ApplyPostProcess:i,ToHalfFloat:r,FromHalfFloat:D,GetTextureDataAsync:H}},602187:(u,x,s)=>{s.d(x,{_:()=>_});var U=s(394501);class _{static SetImmediate(u){U.BA()&&window.setImmediate?window.setImmediate(u):setTimeout(u,1)}}},104270:(u,x,s)=>{function U(u){let x=1;do{x*=2}while(x<u);return x===u}function _(u,x,s){return u*(1-s)+x*s}function W(u){const x=c(u),s=I(u);return x-u>u-s?s:x}function c(u){return u--,u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,u|=u>>16,++u}function I(u){return u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,(u|=u>>16)-(u>>1)}function L(u,x,s=2){let U;switch(s){case 1:U=I(u);break;case 2:U=W(u);break;default:U=c(u)}return Math.min(U,x)}s.d(x,{C4:()=>I,L8:()=>U,OG:()=>W,R:()=>L,zF:()=>_})},898973:(u,x,s)=>{s.d(x,{LV:()=>f,S0:()=>$,s7:()=>H});var U=s(638113),_=s(394501),W=s(706400),c=s(607552),I=s(488354),L=s(554014),J=s(732259),k=s(395726),i=s(435683),d=s(602187),j=s(862e3),r=s(977041),D=s(104270);class ${static get BaseUrl(){return i.eC.BaseUrl}static set BaseUrl(u){i.eC.BaseUrl=u}static get CleanUrl(){return i.eC.CleanUrl}static set CleanUrl(u){i.eC.CleanUrl=u}static IsAbsoluteUrl(u){return 0===u.indexOf("//")||-1!==u.indexOf("://")&&-1!==u.indexOf(".")&&-1!==u.indexOf("/")&&!(u.indexOf(":")>u.indexOf("/"))&&(u.indexOf("://")<u.indexOf(".")||0===u.indexOf("data:")||0===u.indexOf("blob:"))}static set ScriptBaseUrl(u){i.eC.ScriptBaseUrl=u}static get ScriptBaseUrl(){return i.eC.ScriptBaseUrl}static set ScriptPreprocessUrl(u){i.eC.ScriptPreprocessUrl=u}static get ScriptPreprocessUrl(){return i.eC.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return i.eC.DefaultRetryStrategy}static set DefaultRetryStrategy(u){i.eC.DefaultRetryStrategy=u}static get CorsBehavior(){return i.eC.CorsBehavior}static set CorsBehavior(u){i.eC.CorsBehavior=u}static get UseFallbackTexture(){return k.q.UseFallbackTexture}static set UseFallbackTexture(u){k.q.UseFallbackTexture=u}static get RegisteredExternalClasses(){return j.n.RegisteredExternalClasses}static set RegisteredExternalClasses(u){j.n.RegisteredExternalClasses=u}static get fallbackTexture(){return k.q.FallbackTexture}static set fallbackTexture(u){k.q.FallbackTexture=u}static FetchToRef(u,x,s,U,_,W){const c=4*((Math.abs(u)*s%s|0)+(Math.abs(x)*U%U|0)*s);W.r=_[c]/255,W.g=_[c+1]/255,W.b=_[c+2]/255,W.a=_[c+3]/255}static Mix(u,x,s){return 0}static Instantiate(u){return j.n.Instantiate(u)}static SetImmediate(u){d._.SetImmediate(u)}static IsExponentOfTwo(u){return!0}static FloatRound(u){return Math.fround(u)}static GetFilename(u){const x=u.lastIndexOf("/");return x<0?u:u.substring(x+1)}static GetFolderPath(u,x=!1){const s=u.lastIndexOf("/");return s<0?x?u:"":u.substring(0,s+1)}static ToDegrees(u){return 180*u/Math.PI}static ToRadians(u){return u*Math.PI/180}static SmoothAngleChange(u,x,s=.9){const U=this.ToRadians(u),_=this.ToRadians(x);return this.ToDegrees(Math.atan2((1-s)*Math.sin(_)+s*Math.sin(U),(1-s)*Math.cos(_)+s*Math.cos(U)))}static MakeArray(u,x){return!0===x||void 0!==u&&null!=u?Array.isArray(u)?u:[u]:null}static GetPointerPrefix(u){let x="pointer";return _.BA()&&!window.PointerEvent&&(x="mouse"),!u._badDesktopOS||u._badOS||document&&"ontouchend"in document||(x="mouse"),x}static SetCorsBehavior(u,x){i.M1(u,x)}static SetReferrerPolicyBehavior(u,x){x.referrerPolicy=u}static get PreprocessUrl(){return i.eC.PreprocessUrl}static set PreprocessUrl(u){i.eC.PreprocessUrl=u}static LoadImage(u,x,s,U,_,W){return i.W$(u,x,s,U,_,W)}static LoadFile(u,x,s,U,_,W){return i.zU(u,x,s,U,_,W)}static LoadFileAsync(u,x=!0){return new Promise(((s,U)=>{i.zU(u,(u=>{s(u)}),void 0,void 0,x,((u,x)=>{U(x)}))}))}static GetBabylonScriptURL(u,x){if(!u)return"";if($.ScriptBaseUrl&&u.startsWith($._DefaultCdnUrl)){const x="/"===$.ScriptBaseUrl[$.ScriptBaseUrl.length-1]?$.ScriptBaseUrl.substring(0,$.ScriptBaseUrl.length-1):$.ScriptBaseUrl;u=u.replace($._DefaultCdnUrl,x)}return u=$.ScriptPreprocessUrl(u),x&&(u=$.GetAbsoluteUrl(u)),u}static LoadBabylonScript(u,x,s,U){u=$.GetBabylonScriptURL(u),$.LoadScript(u,x,s)}static LoadBabylonScriptAsync(u){return u=$.GetBabylonScriptURL(u),$.LoadScriptAsync(u)}static LoadScript(u,x,s,U){if("function"==typeof importScripts){try{importScripts(u),x()}catch(x){null==s||s(`Unable to load script '${u}' in worker`,x)}return}if(!_.BA())return void(null==s||s(`Cannot load script '${u}' outside of a window or a worker`));const W=document.getElementsByTagName("head")[0],c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",u),U&&(c.id=U),c.onload=()=>{x&&x()},c.onerror=x=>{s&&s(`Unable to load script '${u}'`,x)},W.appendChild(c)}static LoadScriptAsync(u,x){return new Promise(((s,U)=>{this.LoadScript(u,(()=>{s()}),((u,x)=>{U(x||new Error(u))}),x)}))}static ReadFileAsDataURL(u,x,s){const _=new FileReader,W={onCompleteObservable:new U.cP,abort:()=>_.abort()};return _.onloadend=()=>{W.onCompleteObservable.notifyObservers(W)},_.onload=u=>{x(u.target["result"])},_.onprogress=s,_.readAsDataURL(u),W}static ReadFile(u,x,s,U,_){return i.NJ(u,x,s,U,_)}static FileAsURL(u){const x=new Blob([u]);return window.URL.createObjectURL(x)}static Format(u,x=2){return u.toFixed(x)}static DeepCopy(u,x,s,U){c.r.DeepCopy(u,x,s,U)}static IsEmpty(u){for(const x in u)if(Object.prototype.hasOwnProperty.call(u,x))return!1;return!0}static RegisterTopRootEvents(u,x){for(let s=0;s<x.length;s++){const U=x[s];u.addEventListener(U.name,U.handler,!1);try{window.parent&&window.parent.addEventListener(U.name,U.handler,!1)}catch(u){}}}static UnregisterTopRootEvents(u,x){for(let s=0;s<x.length;s++){const U=x[s];u.removeEventListener(U.name,U.handler);try{u.parent&&u.parent.removeEventListener(U.name,U.handler)}catch(u){}}}static async DumpFramebuffer(u,x,s,U,_="image/png",W,c){throw L.n("DumpTools")}static DumpData(u,x,s,U,_="image/png",W,c=!1,I=!1,J){throw L.n("DumpTools")}static DumpDataAsync(u,x,s,U="image/png",_,W=!1,c=!1,I){throw L.n("DumpTools")}static _IsOffScreenCanvas(u){return void 0!==u.convertToBlob}static ToBlob(u,x,s="image/png",U){$._IsOffScreenCanvas(u)||u.toBlob||(u.toBlob=function(u,x,s){setTimeout((()=>{const U=atob(this.toDataURL(x,s).split(",")[1]),_=U.length,W=new Uint8Array(_);for(let u=0;u<_;u++)W[u]=U.charCodeAt(u);u(new Blob([W]))}))}),$._IsOffScreenCanvas(u)?u.convertToBlob({type:s,quality:U}).then((u=>x(u))):u.toBlob((function(u){x(u)}),s,U)}static DownloadBlob(u,x){if("download"in document.createElement("a")){if(!x){const u=new Date;x="screenshot_"+(u.getFullYear()+"-"+(u.getMonth()+1)).slice(2)+"-"+u.getDate()+"_"+u.getHours()+"-"+("0"+u.getMinutes()).slice(-2)+".png"}$.Download(u,x)}else if(u&&"undefined"!=typeof URL){const x=URL.createObjectURL(u),s=window.open("");if(!s)return;const U=s.document.createElement("img");U.onload=function(){URL.revokeObjectURL(x)},U.src=x,s.document.body.appendChild(U)}}static EncodeScreenshotCanvasData(u,x,s="image/png",U,_){if("string"!=typeof U&&x){if(x){if($._IsOffScreenCanvas(u))return void u.convertToBlob({type:s,quality:_}).then((u=>{const s=new FileReader;s.readAsDataURL(u),s.onloadend=()=>{const u=s.result;x(u)}}));const U=u.toDataURL(s,_);x(U)}}else this.ToBlob(u,(function(u){u&&$.DownloadBlob(u,U),x&&x("")}),s,_)}static Download(u,x){if("undefined"==typeof URL)return;const s=window.URL.createObjectURL(u),U=document.createElement("a");document.body.appendChild(U),U.style.display="none",U.href=s,U.download=x,U.addEventListener("click",(()=>{U.parentElement&&U.parentElement.removeChild(U)})),U.click(),window.URL.revokeObjectURL(s)}static BackCompatCameraNoPreventDefault(u){return"boolean"==typeof u[0]?u[0]:"boolean"==typeof u[1]&&u[1]}static CreateScreenshot(u,x,s,U,_="image/png",W=!1,c){throw L.n("ScreenshotTools")}static CreateScreenshotAsync(u,x,s,U="image/png",_){throw L.n("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(u,x,s,U,_="image/png",W=1,c=!1,I,J=!1,k=!1,i=!0,d){throw L.n("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(u,x,s,U="image/png",_=1,W=!1,c,I=!1,J=!1,k=!0,i){throw L.n("ScreenshotTools")}static RandomId(){return r.z()}static IsBase64(u){return i.f2(u)}static DecodeBase64(u){return i.rz(u)}static get errorsCount(){return W.V.errorsCount}static Log(u){W.V.Log(u)}static Warn(u){W.V.Warn(u)}static Error(u){W.V.Error(u)}static get LogCache(){return W.V.LogCache}static ClearLogCache(){W.V.ClearLogCache()}static set LogLevels(u){W.V.LogLevels=u}static set PerformanceLogLevel(u){return(u&$.PerformanceUserMarkLogLevel)===$.PerformanceUserMarkLogLevel?($.StartPerformanceCounter=$._StartUserMark,void($.EndPerformanceCounter=$._EndUserMark)):(u&$.PerformanceConsoleLogLevel)===$.PerformanceConsoleLogLevel?($.StartPerformanceCounter=$._StartPerformanceConsole,void($.EndPerformanceCounter=$._EndPerformanceConsole)):($.StartPerformanceCounter=$._StartPerformanceCounterDisabled,void($.EndPerformanceCounter=$._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(u,x){}static _EndPerformanceCounterDisabled(u,x){}static _StartUserMark(u,x=!0){if(!$._Performance){if(!_.BA())return;$._Performance=window.performance}x&&$._Performance.mark&&$._Performance.mark(u+"-Begin")}static _EndUserMark(u,x=!0){x&&$._Performance.mark&&($._Performance.mark(u+"-End"),$._Performance.measure(u,u+"-Begin",u+"-End"))}static _StartPerformanceConsole(u,x=!0){x&&($._StartUserMark(u,x),console.time&&console.time(u))}static _EndPerformanceConsole(u,x=!0){x&&($._EndUserMark(u,x),console.timeEnd(u))}static get Now(){return I.j.Now}static GetClassName(u,x=!1){let s=null;return!x&&u.getClassName?s=u.getClassName():(u instanceof Object&&(s=(x?u:Object.getPrototypeOf(u)).constructor["__bjsclassName__"]),s||(s=typeof u)),s}static First(u,x){for(const s of u)if(x(s))return s;return null}static getFullClassName(u,x=!1){let s=null,U=null;if(!x&&u.getClassName)s=u.getClassName();else{if(u instanceof Object){const _=x?u:Object.getPrototypeOf(u);s=_.constructor["__bjsclassName__"],U=_.constructor["__bjsmoduleName__"]}s||(s=typeof u)}return s?(null!=U?U+".":"")+s:null}static DelayAsync(u){return new Promise((x=>{setTimeout((()=>{x()}),u)}))}static IsSafari(){return!!_.XD()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}function H(u,x){return s=>{s["__bjsclassName__"]=u,s["__bjsmoduleName__"]=null!=x?x:null}}$.UseCustomRequestHeaders=!1,$.CustomRequestHeaders=J.u.CustomRequestHeaders,$.GetDOMTextContent=_.Zl,$._DefaultCdnUrl="https://cdn.babylonjs.com",$.GetAbsoluteUrl="object"==typeof document?u=>{const x=document.createElement("a");return x.href=u,x.href}:"function"==typeof URL&&"object"==typeof location?u=>new URL(u,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},$.NoneLogLevel=W.V.NoneLogLevel,$.MessageLogLevel=W.V.MessageLogLevel,$.WarningLogLevel=W.V.WarningLogLevel,$.ErrorLogLevel=W.V.ErrorLogLevel,$.AllLogLevel=W.V.AllLogLevel,$.IsWindowObjectExist=_.BA,$.PerformanceNoneLogLevel=0,$.PerformanceUserMarkLogLevel=1,$.PerformanceConsoleLogLevel=2,$.StartPerformanceCounter=$._StartPerformanceCounterDisabled,$.EndPerformanceCounter=$._EndPerformanceCounterDisabled;class f{constructor(u,x,s,U=0){this.iterations=u,this.index=U-1,this._done=!1,this._fn=x,this._successCallback=s}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(u,x,s,U=0){const _=new f(u,x,s,U);return _.executeNext(),_}static SyncAsyncForLoop(u,x,s,U,_,W=0){return f.Run(Math.ceil(u/x),(U=>{_&&_()?U.breakLoop():setTimeout((()=>{for(let W=0;W<x;++W){const c=U.index*x+W;if(c>=u)break;if(s(c),_&&_()){U.breakLoop();break}}U.executeNext()}),W)}),U)}}$.Mix=D.zF,$.IsExponentOfTwo=D.L8,k.q.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},310035:(u,x,s)=>{s.d(x,{Uu:()=>c,Y5:()=>_,n9:()=>W});const U={};function _(u,x){U[u]=x}function W(u){return U[u]}function c(u){for(const x in U)if(u instanceof U[x]&&!x.includes("Abstract"))return x;return"Unknown"}},233637:(u,x,s)=>{s.d(x,{K:()=>U});class U{static get UniqueId(){const u=this._UniqueIdCounter;return this._UniqueIdCounter++,u}}U._UniqueIdCounter=1},732259:(u,x,s)=>{s.d(x,{u:()=>U});class U{constructor(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(U.CustomRequestHeaders).length>0||U.CustomRequestModifiers.length>0}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const u in U.CustomRequestHeaders){const x=U.CustomRequestHeaders[u];x&&this._xhr.setRequestHeader(u,x)}}_shouldSkipRequestModifications(u){return U.SkipRequestModificationForBabylonCDN&&(u.includes("preview.babylonjs.com")||u.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(u){this._xhr.onprogress=u}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(u){this._xhr.responseType=u}get timeout(){return this._xhr.timeout}set timeout(u){this._xhr.timeout=u}addEventListener(u,x,s){this._xhr.addEventListener(u,x,s)}removeEventListener(u,x,s){this._xhr.removeEventListener(u,x,s)}abort(){this._xhr.abort()}send(u){U.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(u)}open(u,x){for(const u of U.CustomRequestModifiers){if(this._shouldSkipRequestModifications(x))return;u(this._xhr,x)}x=(x=x.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=x,this._xhr.open(u,x,!0)}setRequestHeader(u,x){this._xhr.setRequestHeader(u,x)}getResponseHeader(u){return this._xhr.getResponseHeader(u)}}U.CustomRequestHeaders={},U.CustomRequestModifiers=new Array,U.SkipRequestModificationForBabylonCDN=!0},379383:(u,x,s)=>{s.d(x,{M:()=>k});var U=s(297809),_=s(638113),W=s(395726),c=s(23987),I=s(760998),L=s(337776),J=s(310035);class k{get influence(){return this._influence}set influence(u){if(this._influence===u)return;const x=this._influence;this._influence=u,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===x||0===u)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}constructor(u,x=0,s=null){this.name=u,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new _.cP,this._onDataLayoutChanged=new _.cP,this._animationPropertiesOverride=null,this._scene=s||W.q.LastCreatedScene,this.influence=x,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(u){const x=this.hasPositions;this._positions=u,x!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(u){const x=this.hasNormals;this._normals=u,x!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(u){const x=this.hasTangents;this._tangents=u,x!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(u){const x=this.hasUVs;this._uvs=u,x!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const u=L.p.Clone((()=>new k(this.name,this.influence,this._scene)),this);return u._positions=this._positions,u._normals=this._normals,u._tangents=this._tangents,u._uvs=this._uvs,u}serialize(){const u={};return u.name=this.name,u.influence=this.influence,u.positions=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(u.id=this.id),this.hasNormals&&(u.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(u.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(u.uvs=Array.prototype.slice.call(this.getUVs())),L.p.AppendSerializedAnimations(this,u),u}getClassName(){return"MorphTarget"}static Parse(u,x){const s=new k(u.name,u.influence);if(s.setPositions(u.positions),null!=u.id&&(s.id=u.id),u.normals&&s.setNormals(u.normals),u.tangents&&s.setTangents(u.tangents),u.uvs&&s.setUVs(u.uvs),u.animations){for(let x=0;x<u.animations.length;x++){const U=u.animations[x],_=J.n9("BABYLON.Animation");_&&s.animations.push(_.Parse(U))}u.autoAnimate&&x&&x.beginAnimation(s,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1)}return s}static FromMesh(u,x,s){x||(x=u.name);const U=new k(x,s,u.getScene());return U.setPositions(u.getVerticesData(c.R.PositionKind)),u.isVerticesDataPresent(c.R.NormalKind)&&U.setNormals(u.getVerticesData(c.R.NormalKind)),u.isVerticesDataPresent(c.R.TangentKind)&&U.setTangents(u.getVerticesData(c.R.TangentKind)),u.isVerticesDataPresent(c.R.UVKind)&&U.setUVs(u.getVerticesData(c.R.UVKind)),U}}U.Cg([I.lK()],k.prototype,"id",void 0)},776796:(u,x,s)=>{s.d(x,{j:()=>L});var U=s(293506),_=s(706400),W=s(395726),c=s(379383),I=s(517609);class L{set areUpdatesFrozen(u){u?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(u=null){if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new U.L(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,u||(u=W.q.LastCreatedScene),this._scene=u,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const u=this._scene.getEngine().getCaps();this._canUseTextureForTargets=u.canUseGLVertexID&&u.textureFloat&&u.maxVertexTextureImageUnits>0&&u.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(u){this._numMaxInfluencers!==u&&(this._numMaxInfluencers=u,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(u){this._useTextureToStoreTargets=u}get isUsingTextureForTargets(){var u;return L.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null===(u=this._scene)||void 0===u?void 0:u.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(u){return this._activeTargets.data[u]}getTarget(u){return this._targets[u]}getTargetByName(u){for(const x of this._targets)if(x.name===u)return x;return null}addTarget(u){this._targets.push(u),this._targetInfluenceChangedObservers.push(u.onInfluenceChanged.add((u=>{this._syncActiveTargets(u)}))),this._targetDataLayoutChangedObservers.push(u._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(u){const x=this._targets.indexOf(u);x>=0&&(this._targets.splice(x,1),u.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(x,1)[0]),u._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(x,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(u)}_bind(u){u.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),u.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),u.setTexture("morphTargets",this._targetStoreTexture),u.setInt("morphTargetCount",this.numInfluencers)}clone(){const u=new L(this._scene);for(const x of this._targets)u.addTarget(x.clone());return u.enableNormalMorphing=this.enableNormalMorphing,u.enableTangentMorphing=this.enableTangentMorphing,u.enableUVMorphing=this.enableUVMorphing,u}serialize(){const u={};u.id=this.uniqueId,u.targets=[];for(const x of this._targets)u.targets.push(x.serialize());return u}_syncActiveTargets(u){if(this.areUpdatesFrozen)return;let x=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let s=-1;for(const u of this._targets){if(s++,0===u.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=L.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(u),this._morphTargetTextureIndices[x]=s,this._tempInfluences[x++]=u.influence,this._supportsNormals=this._supportsNormals&&u.hasNormals,this._supportsTangents=this._supportsTangents&&u.hasTangents,this._supportsUVs=this._supportsUVs&&u.hasUVs;const U=u.getPositions();if(U){const u=U.length/3;if(0===this._vertexCount)this._vertexCount=u;else if(this._vertexCount!==u)return void _.V.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==x&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,x)),this._influences&&this._influences.length===x||(this._influences=new Float32Array(x));for(let u=0;u<x;u++)this._influences[u]=this._tempInfluences[u];u&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const u=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>u&&(this._textureHeight=Math.ceil(this._textureWidth/u),this._textureWidth=u);let x=!0;if(this._targetStoreTexture){const u=this._targetStoreTexture.getSize();u.width===this._textureWidth&&u.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(x=!1)}if(x){this._targetStoreTexture&&this._targetStoreTexture.dispose();const u=this._targets.length,x=new Float32Array(u*this._textureWidth*this._textureHeight*4);let s=0;for(let U=0;U<u;U++){const u=this._targets[U],W=u.getPositions(),c=u.getNormals(),I=u.getUVs(),L=u.getTangents();if(!W)return void(0===U&&_.V.Error("Invalid morph target. Target must have positions."));s=U*this._textureWidth*this._textureHeight*4;for(let u=0;u<this._vertexCount;u++)x[s]=W[3*u],x[s+1]=W[3*u+1],x[s+2]=W[3*u+2],s+=4,this._supportsNormals&&c&&(x[s]=c[3*u],x[s+1]=c[3*u+1],x[s+2]=c[3*u+2],s+=4),this._supportsUVs&&I&&(x[s]=I[2*u],x[s+1]=I[2*u+1],s+=4),this._supportsTangents&&L&&(x[s]=L[3*u],x[s+1]=L[3*u+1],x[s+2]=L[3*u+2],s+=4)}this._targetStoreTexture=I.L.CreateRGBATexture(x,this._textureWidth,this._textureHeight,u,this._scene,!1,!1,1,1)}}for(const u of this._scene.meshes)u.morphTargetManager===this&&u._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const u=this._parentContainer.morphTargetManagers.indexOf(this);u>-1&&this._parentContainer.morphTargetManagers.splice(u,1),this._parentContainer=null}for(const u of this._targets)this._scene.stopAnimation(u)}}static Parse(u,x){const s=new L(x);s._uniqueId=u.id;for(const U of u.targets)s.addTarget(c.M.Parse(U,x));return s}}L.EnableTextureStorage=!0,L.MaxActiveMorphTargetsInVertexAttributeMode=8},917623:(u,x,s)=>{s.d(x,{d:()=>_});var U=s(604910);class _{constructor(){this._hasHit=!1,this._hitNormal=U.Pq.Zero(),this._hitPoint=U.Pq.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(u,x,s){this._hasHit=!0,this._hitNormal.set(u.x,u.y,u.z),this._hitPoint.set(x.x,x.y,x.z),this._triangleIndex=null!=s?s:-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}},421614:(u,x,s)=>{s.d(x,{G:()=>W});var U=s(604910),_=s(917623);class W extends _.d{constructor(){super(...arguments),this._hitDistance=0,this._rayFromWorld=U.Pq.Zero(),this._rayToWorld=U.Pq.Zero()}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormal}get hitPointWorld(){return this._hitPoint}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}setHitDistance(u){this._hitDistance=u}calculateHitDistance(){this._hitDistance=U.Pq.Distance(this._rayFromWorld,this._hitPoint)}reset(u=U.Pq.Zero(),x=U.Pq.Zero()){super.reset(),this._rayFromWorld.copyFrom(u),this._rayToWorld.copyFrom(x),this._hitDistance=0}}},704830:(u,x,s)=>{s.d(x,{v:()=>r});var U=s(604910),_=s(706400),W=s(333949),c=s(200198),I=s(23987),L=s(818696),J=s(374134),k=s(673524),i=s(421614),d=s(615473),j=s(779908);class r{constructor(u=!0,x=Ammo,s=null){this._useDeltaForWorldStep=u,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new U.PT,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new U.Pq,this._tmpContactNormal=new U.Pq,this._tmpVec3=new U.Pq,this._tmpMatrix=new U.uq,"function"!=typeof x?(this.bjsAMMO=x,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=s||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=u=>{const x=(u=this.bjsAMMO.wrapPointer(u,this.bjsAMMO.btManifoldPoint)).getPositionWorldOnA(),s=u.m_normalWorldOnB;this._tmpContactPoint.x=x.x(),this._tmpContactPoint.y=x.y(),this._tmpContactPoint.z=x.z(),this._tmpContactNormal.x=s.x(),this._tmpContactNormal.y=s.y(),this._tmpContactNormal.z=s.z(),this._tmpContactImpulse=u.getAppliedImpulse(),this._tmpContactDistance=u.getDistance(),this._tmpContactCallbackResult=!0},this._raycastResult=new i.G,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):_.V.Error("AmmoJS is not available. Please make sure you included the js file.")):_.V.Error("AmmoJS is not ready. Please make sure you await Ammo() before using the plugin.")}getPluginVersion(){return 1}setGravity(u){this._tmpAmmoVectorA.setValue(u.x,u.y,u.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)}setTimeStep(u){this._timeStep=u}setFixedTimeStep(u){this._fixedTimeStep=u}setMaxSteps(u){this._maxSteps=u}getTimeStep(){return this._timeStep}_isImpostorInContact(u){return this._tmpContactCallbackResult=!1,this.world.contactTest(u.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult}_isImpostorPairInContact(u,x){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(u.physicsBody,x.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult}_stepSimulation(u=1/60,x=10,s=1/60){if(0==x)this.world.stepSimulation(u,0);else for(;x>0&&u>0;)u-s<s?(this.world.stepSimulation(u,0),u=0):(u-=s,this.world.stepSimulation(s,0)),x--}executeStep(u,x){for(const u of x)u.soft||u.beforeStep();this._stepSimulation(this._useDeltaForWorldStep?u:this._timeStep,this._maxSteps,this._fixedTimeStep);for(const u of x)if(u.soft?this._afterSoftStep(u):u.afterStep(),u._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(u))for(const x of u._onPhysicsCollideCallbacks)for(const s of x.otherImpostors)(u.physicsBody.isActive()||s.physicsBody.isActive())&&this._isImpostorPairInContact(u,s)&&(u.onCollide({body:s.physicsBody,point:this._tmpContactPoint,distance:this._tmpContactDistance,impulse:this._tmpContactImpulse,normal:this._tmpContactNormal}),s.onCollide({body:u.physicsBody,point:this._tmpContactPoint,distance:this._tmpContactDistance,impulse:this._tmpContactImpulse,normal:this._tmpContactNormal}))}_afterSoftStep(u){u.type===W.j.RopeImpostor?this._ropeStep(u):this._softbodyOrClothStep(u)}_ropeStep(u){const x=u.physicsBody.get_m_nodes(),s=x.size();let _,W,c,I,L;const i=new Array;for(let u=0;u<s;u++)_=x.at(u),W=_.get_m_x(),c=W.x(),I=W.y(),L=W.z(),i.push(new U.Pq(c,I,L));const d=u.object,j=u.getParam("shape");u._isFromLine?u.object=k.sh("lines",{points:i,instance:d}):u.object=J.tF("ext",{shape:j,path:i,instance:d})}_softbodyOrClothStep(u){const x=u.type===W.j.ClothImpostor?1:-1,s=u.object;let U=s.getVerticesData(I.R.PositionKind);U||(U=[]);let _=s.getVerticesData(I.R.NormalKind);_||(_=[]);const c=U.length/3,J=u.physicsBody.get_m_nodes();let k,i,d,j,r,D,$,H;for(let u=0;u<c;u++){k=J.at(u),i=k.get_m_x(),d=i.x(),j=i.y(),r=i.z()*x;const s=k.get_m_n();D=s.x(),$=s.y(),H=s.z()*x,U[3*u]=d,U[3*u+1]=j,U[3*u+2]=r,_[3*u]=D,_[3*u+1]=$,_[3*u+2]=H}const f=new L.P;f.positions=U,f.normals=_,f.uvs=s.getVerticesData(I.R.UVKind),f.colors=s.getVerticesData(I.R.ColorKind),s&&s.getIndices&&(f.indices=s.getIndices()),f.applyToMesh(s)}applyImpulse(u,x,s){if(u.soft)_.V.Warn("Cannot be applied to a soft body");else{u.physicsBody.activate();const U=this._tmpAmmoVectorA,_=this._tmpAmmoVectorB;u.object&&u.object.getWorldMatrix&&s.subtractInPlace(u.object.getWorldMatrix().getTranslation()),U.setValue(s.x,s.y,s.z),_.setValue(x.x,x.y,x.z),u.physicsBody.applyImpulse(_,U)}}applyForce(u,x,s){if(u.soft)_.V.Warn("Cannot be applied to a soft body");else{u.physicsBody.activate();const U=this._tmpAmmoVectorA,_=this._tmpAmmoVectorB;if(u.object&&u.object.getWorldMatrix){const x=u.object.getWorldMatrix().getTranslation();U.setValue(s.x-x.x,s.y-x.y,s.z-x.z)}else U.setValue(s.x,s.y,s.z);_.setValue(x.x,x.y,x.z),u.physicsBody.applyForce(_,U)}}generatePhysicsBody(u){if(u._pluginData.toDispose=[],u.parent)u.physicsBody&&(this.removePhysicsBody(u),u.forceUpdate());else if(u.isBodyInitRequired()){const x=this._createShape(u),s=u.getParam("mass");if(u._pluginData.mass=s,u.soft)x.get_m_cfg().set_collisions(17),x.get_m_cfg().set_kDP(u.getParam("damping")),this.bjsAMMO.castObject(x,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(u.getParam("margin")),x.setActivationState(r._DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(x,1,-1),u.physicsBody=x,u._pluginData.toDispose.push(x),this.setBodyPressure(u,0),u.type===W.j.SoftbodyImpostor&&this.setBodyPressure(u,u.getParam("pressure")),this.setBodyStiffness(u,u.getParam("stiffness")),this.setBodyVelocityIterations(u,u.getParam("velocityIterations")),this.setBodyPositionIterations(u,u.getParam("positionIterations"));else{const U=new this.bjsAMMO.btVector3(0,0,0),_=new this.bjsAMMO.btTransform;u.object.computeWorldMatrix(!0),_.setIdentity(),0!==s&&x.calculateLocalInertia(s,U),this._tmpAmmoVectorA.setValue(u.object.position.x,u.object.position.y,u.object.position.z),this._tmpAmmoQuaternion.setValue(u.object.rotationQuaternion.x,u.object.rotationQuaternion.y,u.object.rotationQuaternion.z,u.object.rotationQuaternion.w),_.setOrigin(this._tmpAmmoVectorA),_.setRotation(this._tmpAmmoQuaternion);const c=new this.bjsAMMO.btDefaultMotionState(_),I=new this.bjsAMMO.btRigidBodyConstructionInfo(s,c,x,U),L=new this.bjsAMMO.btRigidBody(I);if(0===s&&(L.setCollisionFlags(L.getCollisionFlags()|r._KINEMATIC_FLAG),L.setActivationState(r._DISABLE_DEACTIVATION_FLAG)),u.type!=W.j.NoImpostor||x.getChildShape||L.setCollisionFlags(L.getCollisionFlags()|r._DISABLE_COLLISION_FLAG),u.type!==W.j.MeshImpostor&&u.type!==W.j.NoImpostor){const x=u.object.getBoundingInfo();this._tmpVec3.copyFrom(u.object.getAbsolutePosition()),this._tmpVec3.subtractInPlace(x.boundingBox.centerWorld),this._tmpVec3.x/=u.object.scaling.x,this._tmpVec3.y/=u.object.scaling.y,this._tmpVec3.z/=u.object.scaling.z,u.setDeltaPosition(this._tmpVec3)}const J=u.getParam("group"),k=u.getParam("mask");J&&k?this.world.addRigidBody(L,J,k):this.world.addRigidBody(L),u.physicsBody=L,u._pluginData.toDispose=u._pluginData.toDispose.concat([L,I,c,_,U,x])}this.setBodyRestitution(u,u.getParam("restitution")),this.setBodyFriction(u,u.getParam("friction"))}}removePhysicsBody(u){this.world&&(u.soft?this.world.removeSoftBody(u.physicsBody):this.world.removeRigidBody(u.physicsBody),u._pluginData&&(u._pluginData.toDispose.forEach((u=>{this.bjsAMMO.destroy(u)})),u._pluginData.toDispose=[]))}generateJoint(u){const x=u.mainImpostor.physicsBody,s=u.connectedImpostor.physicsBody;if(!x||!s)return;if(u.joint.physicsJoint)return;const W=u.joint.jointData;let I;switch(W.mainPivot||(W.mainPivot=new U.Pq(0,0,0)),W.connectedPivot||(W.connectedPivot=new U.Pq(0,0,0)),u.joint.type){case c.W$.DistanceJoint:{const u=W.maxDistance;u&&(W.mainPivot=new U.Pq(0,-u/2,0),W.connectedPivot=new U.Pq(0,u/2,0));const _=this._tmpAmmoVectorA;_.setValue(W.mainPivot.x,W.mainPivot.y,W.mainPivot.z);const c=this._tmpAmmoVectorB;c.setValue(W.connectedPivot.x,W.connectedPivot.y,W.connectedPivot.z),I=new this.bjsAMMO.btPoint2PointConstraint(x,s,_,c);break}case c.W$.HingeJoint:{W.mainAxis||(W.mainAxis=new U.Pq(0,0,0)),W.connectedAxis||(W.connectedAxis=new U.Pq(0,0,0));const u=this._tmpAmmoVectorA;u.setValue(W.mainPivot.x,W.mainPivot.y,W.mainPivot.z);const _=this._tmpAmmoVectorB;_.setValue(W.connectedPivot.x,W.connectedPivot.y,W.connectedPivot.z);const c=this._tmpAmmoVectorC;c.setValue(W.mainAxis.x,W.mainAxis.y,W.mainAxis.z);const L=this._tmpAmmoVectorD;L.setValue(W.connectedAxis.x,W.connectedAxis.y,W.connectedAxis.z),I=new this.bjsAMMO.btHingeConstraint(x,s,u,_,c,L);break}case c.W$.BallAndSocketJoint:{const u=this._tmpAmmoVectorA;u.setValue(W.mainPivot.x,W.mainPivot.y,W.mainPivot.z);const U=this._tmpAmmoVectorB;U.setValue(W.connectedPivot.x,W.connectedPivot.y,W.connectedPivot.z),I=new this.bjsAMMO.btPoint2PointConstraint(x,s,u,U);break}default:{_.V.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint");const u=this._tmpAmmoVectorA;u.setValue(W.mainPivot.x,W.mainPivot.y,W.mainPivot.z);const U=this._tmpAmmoVectorB;U.setValue(W.connectedPivot.x,W.connectedPivot.y,W.connectedPivot.z),I=new this.bjsAMMO.btPoint2PointConstraint(x,s,u,U);break}}this.world.addConstraint(I,!u.joint.jointData.collision),u.joint.physicsJoint=I}removeJoint(u){this.world&&this.world.removeConstraint(u.joint.physicsJoint),this.bjsAMMO.destroy(u.joint.physicsJoint)}_addMeshVerts(u,x,s){let _=0;if(s&&s.getIndices&&s.getWorldMatrix&&s.getChildMeshes){let W=s.getIndices();W||(W=[]);let c,L=s.getVerticesData(I.R.PositionKind);if(L||(L=[]),x&&x!==s){let u;u=x.rotationQuaternion?x.rotationQuaternion:x.rotation?U.PT.FromEulerAngles(x.rotation.x,x.rotation.y,x.rotation.z):U.PT.Identity(),U.uq.Compose(U.Pq.One(),u,x.position).invertToRef(this._tmpMatrix),c=s.computeWorldMatrix(!1).multiply(this._tmpMatrix)}else U.uq.ScalingToRef(s.scaling.x,s.scaling.y,s.scaling.z,this._tmpMatrix),c=this._tmpMatrix;const J=W.length/3;for(let x=0;x<J;x++){const s=[];for(let u=0;u<3;u++){let _,I=new U.Pq(L[3*W[3*x+u]+0],L[3*W[3*x+u]+1],L[3*W[3*x+u]+2]);I=U.Pq.TransformCoordinates(I,c),_=0==u?this._tmpAmmoVectorA:1==u?this._tmpAmmoVectorB:this._tmpAmmoVectorC,_.setValue(I.x,I.y,I.z),s.push(_)}u.addTriangle(s[0],s[1],s[2]),_++}s.getChildMeshes().forEach((s=>{_+=this._addMeshVerts(u,x,s)}))}return _}_softVertexData(u){const x=u.object;if(x&&x.getIndices&&x.getWorldMatrix&&x.getChildMeshes){let u=x.getIndices();u||(u=[]);let s=x.getVerticesData(I.R.PositionKind);s||(s=[]);let _=x.getVerticesData(I.R.NormalKind);_||(_=[]),x.computeWorldMatrix(!1);const W=[],c=[];for(let u=0;u<s.length;u+=3){let I=new U.Pq(s[u],s[u+1],s[u+2]),L=new U.Pq(_[u],_[u+1],_[u+2]);I=U.Pq.TransformCoordinates(I,x.getWorldMatrix()),L=U.Pq.TransformNormal(L,x.getWorldMatrix()),W.push(I.x,I.y,I.z),c.push(L.x,L.y,L.z)}const J=new L.P;return J.positions=W,J.normals=c,J.uvs=x.getVerticesData(I.R.UVKind),J.colors=x.getVerticesData(I.R.ColorKind),x&&x.getIndices&&(J.indices=x.getIndices()),J.applyToMesh(x),x.position=U.Pq.Zero(),x.rotationQuaternion=null,x.rotation=U.Pq.Zero(),x.computeWorldMatrix(!0),J}return L.P.ExtractFromMesh(x)}_createSoftbody(u){const x=u.object;if(x&&x.getIndices){let s=x.getIndices();s||(s=[]);const _=this._softVertexData(u),W=_.positions,c=_.normals;if(null===W||null===c)return new this.bjsAMMO.btCompoundShape;{const u=[],_=[];for(let x=0;x<W.length;x+=3){const s=new U.Pq(W[x],W[x+1],W[x+2]),I=new U.Pq(c[x],c[x+1],c[x+2]);u.push(s.x,s.y,-s.z),_.push(I.x,I.y,-I.z)}const I=(new this.bjsAMMO.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),u,x.getIndices(),s.length/3,!0),L=W.length/3,J=I.get_m_nodes();let k,i;for(let u=0;u<L;u++)k=J.at(u),i=k.get_m_n(),i.setX(_[3*u]),i.setY(_[3*u+1]),i.setZ(_[3*u+2]);return I}}}_createCloth(u){const x=u.object;if(x&&x.getIndices){let s=x.getIndices();s||(s=[]);const U=this._softVertexData(u),_=U.positions,W=U.normals;if(null===_||null===W)return new this.bjsAMMO.btCompoundShape;{const x=_.length,s=Math.sqrt(x/3);u.segments=s;const U=s-1;return this._tmpAmmoVectorA.setValue(_[0],_[1],_[2]),this._tmpAmmoVectorB.setValue(_[3*U],_[3*U+1],_[3*U+2]),this._tmpAmmoVectorD.setValue(_[x-3],_[x-2],_[x-1]),this._tmpAmmoVectorC.setValue(_[x-3-3*U],_[x-2-3*U],_[x-1-3*U]),(new this.bjsAMMO.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,s,s,u.getParam("fixedPoints"),!0)}}}_createRope(u){let x,s;const U=this._softVertexData(u),W=U.positions,c=U.normals;if(null===W||null===c)return new this.bjsAMMO.btCompoundShape;if(U.applyToMesh(u.object,!0),u._isFromLine=!0,0===c.map((u=>u*u)).reduce(((u,x)=>u+x)))x=W.length,s=x/3-1,this._tmpAmmoVectorA.setValue(W[0],W[1],W[2]),this._tmpAmmoVectorB.setValue(W[x-3],W[x-2],W[x-1]);else{u._isFromLine=!1;const U=u.getParam("path");if(null===u.getParam("shape"))return _.V.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;x=U.length,s=x-1,this._tmpAmmoVectorA.setValue(U[0].x,U[0].y,U[0].z),this._tmpAmmoVectorB.setValue(U[x-1].x,U[x-1].y,U[x-1].z)}u.segments=s;let I=u.getParam("fixedPoints");I=I>3?3:I;const L=(new this.bjsAMMO.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,s-1,I);return L.get_m_cfg().set_collisions(17),L}_createCustom(u){let x=null;return this.onCreateCustomShape&&(x=this.onCreateCustomShape(u)),null==x&&(x=new this.bjsAMMO.btCompoundShape),x}_addHullVerts(u,x,s){let _=0;if(s&&s.getIndices&&s.getWorldMatrix&&s.getChildMeshes){let W=s.getIndices();W||(W=[]);let c=s.getVerticesData(I.R.PositionKind);c||(c=[]),s.computeWorldMatrix(!1);const L=W.length/3;for(let x=0;x<L;x++){const I=[];for(let u=0;u<3;u++){let _,L=new U.Pq(c[3*W[3*x+u]+0],c[3*W[3*x+u]+1],c[3*W[3*x+u]+2]);U.uq.ScalingToRef(s.scaling.x,s.scaling.y,s.scaling.z,this._tmpMatrix),L=U.Pq.TransformCoordinates(L,this._tmpMatrix),_=0==u?this._tmpAmmoVectorA:1==u?this._tmpAmmoVectorB:this._tmpAmmoVectorC,_.setValue(L.x,L.y,L.z),I.push(_)}u.addPoint(I[0],!0),u.addPoint(I[1],!0),u.addPoint(I[2],!0),_++}s.getChildMeshes().forEach((s=>{_+=this._addHullVerts(u,x,s)}))}return _}_createShape(u,x=!1){const s=u.object;let c;const I=u.getObjectExtents();if(!x){const x=u.object.getChildMeshes?u.object.getChildMeshes(!0):[];c=new this.bjsAMMO.btCompoundShape;let s=0;if(x.forEach((u=>{const x=u.getPhysicsImpostor();if(x){if(x.type==W.j.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";const _=this._createShape(x),I=u.parent.getWorldMatrix().clone(),L=new U.Pq;I.decompose(L),this._tmpAmmoTransform.getOrigin().setValue(u.position.x*L.x,u.position.y*L.y,u.position.z*L.z),this._tmpAmmoQuaternion.setValue(u.rotationQuaternion.x,u.rotationQuaternion.y,u.rotationQuaternion.z,u.rotationQuaternion.w),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),c.addChildShape(this._tmpAmmoTransform,_),x.dispose(),s++}})),s>0){if(u.type!=W.j.NoImpostor){const x=this._createShape(u,!0);x&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),c.addChildShape(this._tmpAmmoTransform,x))}return c}this.bjsAMMO.destroy(c),c=null}switch(u.type){case W.j.SphereImpostor:if(d.X.WithinEpsilon(I.x,I.y,1e-4)&&d.X.WithinEpsilon(I.x,I.z,1e-4))c=new this.bjsAMMO.btSphereShape(I.x/2);else{this._tmpAmmoVectorA.setValue(0,0,0);const u=[this._tmpAmmoVectorA],x=[1];c=new this.bjsAMMO.btMultiSphereShape(u,x,1),this._tmpAmmoVectorA.setValue(I.x/2,I.y/2,I.z/2),c.setLocalScaling(this._tmpAmmoVectorA)}break;case W.j.CapsuleImpostor:{const u=I.x/2;c=new this.bjsAMMO.btCapsuleShape(u,I.y-2*u)}break;case W.j.CylinderImpostor:this._tmpAmmoVectorA.setValue(I.x/2,I.y/2,I.z/2),c=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case W.j.PlaneImpostor:case W.j.BoxImpostor:this._tmpAmmoVectorA.setValue(I.x/2,I.y/2,I.z/2),c=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case W.j.MeshImpostor:if(0==u.getParam("mass")){if(this.onCreateCustomMeshImpostor)c=this.onCreateCustomMeshImpostor(u);else{const x=new this.bjsAMMO.btTriangleMesh;u._pluginData.toDispose.push(x);const U=this._addMeshVerts(x,s,s);c=0==U?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(x)}break}case W.j.ConvexHullImpostor:if(this.onCreateCustomConvexHullImpostor)c=this.onCreateCustomConvexHullImpostor(u);else{const x=new this.bjsAMMO.btConvexHullShape;0==this._addHullVerts(x,s,s)?(u._pluginData.toDispose.push(x),c=new this.bjsAMMO.btCompoundShape):c=x}break;case W.j.NoImpostor:c=new this.bjsAMMO.btSphereShape(I.x/2);break;case W.j.CustomImpostor:c=this._createCustom(u);break;case W.j.SoftbodyImpostor:c=this._createSoftbody(u);break;case W.j.ClothImpostor:c=this._createCloth(u);break;case W.j.RopeImpostor:c=this._createRope(u);break;default:_.V.Warn("The impostor type is not currently supported by the ammo plugin.")}return c}setTransformationFromPhysicsBody(u){u.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),u.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),u.object.rotationQuaternion?u.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):u.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(u.object.rotation))}setPhysicsBodyTransformation(u,x,s){const U=u.physicsBody.getWorldTransform();if(Math.abs(U.getOrigin().x()-x.x)>j.bH||Math.abs(U.getOrigin().y()-x.y)>j.bH||Math.abs(U.getOrigin().z()-x.z)>j.bH||Math.abs(U.getRotation().x()-s.x)>j.bH||Math.abs(U.getRotation().y()-s.y)>j.bH||Math.abs(U.getRotation().z()-s.z)>j.bH||Math.abs(U.getRotation().w()-s.w)>j.bH)if(this._tmpAmmoVectorA.setValue(x.x,x.y,x.z),U.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(s.x,s.y,s.z,s.w),U.setRotation(this._tmpAmmoQuaternion),u.physicsBody.setWorldTransform(U),0==u.mass){const x=u.physicsBody.getMotionState();x&&x.setWorldTransform(U)}else u.physicsBody.activate()}isSupported(){return void 0!==this.bjsAMMO}setLinearVelocity(u,x){this._tmpAmmoVectorA.setValue(x.x,x.y,x.z),u.soft?u.physicsBody.linearVelocity(this._tmpAmmoVectorA):u.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)}setAngularVelocity(u,x){this._tmpAmmoVectorA.setValue(x.x,x.y,x.z),u.soft?u.physicsBody.angularVelocity(this._tmpAmmoVectorA):u.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)}getLinearVelocity(u){let x;if(x=u.soft?u.physicsBody.linearVelocity():u.physicsBody.getLinearVelocity(),!x)return null;const s=new U.Pq(x.x(),x.y(),x.z());return this.bjsAMMO.destroy(x),s}getAngularVelocity(u){let x;if(x=u.soft?u.physicsBody.angularVelocity():u.physicsBody.getAngularVelocity(),!x)return null;const s=new U.Pq(x.x(),x.y(),x.z());return this.bjsAMMO.destroy(x),s}setBodyMass(u,x){u.soft?u.physicsBody.setTotalMass(x,!1):u.physicsBody.setMassProps(x),u._pluginData.mass=x}getBodyMass(u){return u._pluginData.mass||0}getBodyFriction(u){return u._pluginData.friction||0}setBodyFriction(u,x){u.soft?u.physicsBody.get_m_cfg().set_kDF(x):u.physicsBody.setFriction(x),u._pluginData.friction=x}getBodyRestitution(u){return u._pluginData.restitution||0}setBodyRestitution(u,x){u.physicsBody.setRestitution(x),u._pluginData.restitution=x}getBodyPressure(u){return u.soft?u._pluginData.pressure||0:(_.V.Warn("Pressure is not a property of a rigid body"),0)}setBodyPressure(u,x){u.soft?u.type===W.j.SoftbodyImpostor?(u.physicsBody.get_m_cfg().set_kPR(x),u._pluginData.pressure=x):(u.physicsBody.get_m_cfg().set_kPR(0),u._pluginData.pressure=0):_.V.Warn("Pressure can only be applied to a softbody")}getBodyStiffness(u){return u.soft?u._pluginData.stiffness||0:(_.V.Warn("Stiffness is not a property of a rigid body"),0)}setBodyStiffness(u,x){u.soft?(x=(x=x<0?0:x)>1?1:x,u.physicsBody.get_m_materials().at(0).set_m_kLST(x),u._pluginData.stiffness=x):_.V.Warn("Stiffness cannot be applied to a rigid body")}getBodyVelocityIterations(u){return u.soft?u._pluginData.velocityIterations||0:(_.V.Warn("Velocity iterations is not a property of a rigid body"),0)}setBodyVelocityIterations(u,x){u.soft?(x=x<0?0:x,u.physicsBody.get_m_cfg().set_viterations(x),u._pluginData.velocityIterations=x):_.V.Warn("Velocity iterations cannot be applied to a rigid body")}getBodyPositionIterations(u){return u.soft?u._pluginData.positionIterations||0:(_.V.Warn("Position iterations is not a property of a rigid body"),0)}setBodyPositionIterations(u,x){u.soft?(x=x<0?0:x,u.physicsBody.get_m_cfg().set_piterations(x),u._pluginData.positionIterations=x):_.V.Warn("Position iterations cannot be applied to a rigid body")}appendAnchor(u,x,s,U,_=1,W=!1){const c=u.segments,I=Math.round((c-1)*s)+c*(c-1-Math.round((c-1)*U));u.physicsBody.appendAnchor(I,x.physicsBody,W,_)}appendHook(u,x,s,U=1,_=!1){const W=Math.round(u.segments*s);u.physicsBody.appendAnchor(W,x.physicsBody,_,U)}sleepBody(u){u.physicsBody.forceActivationState(0)}wakeUpBody(u){u.physicsBody.activate()}updateDistanceJoint(){_.V.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")}setMotor(u,x,s){u.physicsJoint.enableAngularMotor(!0,x,s)}setLimit(){_.V.Warn("setLimit is not currently supported by the Ammo physics plugin")}syncMeshWithImpostor(u,x){x.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),u.position.x=this._tmpAmmoTransform.getOrigin().x(),u.position.y=this._tmpAmmoTransform.getOrigin().y(),u.position.z=this._tmpAmmoTransform.getOrigin().z(),u.rotationQuaternion&&(u.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),u.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),u.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),u.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())}getRadius(u){return u.getObjectExtents().x/2}getBoxSizeToRef(u,x){const s=u.getObjectExtents();x.x=s.x,x.y=s.y,x.z=s.z}dispose(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._softBodySolver),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoVectorD),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null}raycast(u,x){return this.raycastToRef(u,x,this._raycastResult),this._raycastResult}raycastToRef(u,x,s){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(u.x,u.y,u.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(x.x,x.y,x.z);const U=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,U),s.reset(u,x),U.hasHit()&&(s.setHitData({x:U.get_m_hitNormalWorld().x(),y:U.get_m_hitNormalWorld().y(),z:U.get_m_hitNormalWorld().z()},{x:U.get_m_hitPointWorld().x(),y:U.get_m_hitPointWorld().y(),z:U.get_m_hitPointWorld().z()}),s.calculateHitDistance()),this.bjsAMMO.destroy(U),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB)}}r._DISABLE_COLLISION_FLAG=4,r._KINEMATIC_FLAG=2,r._DISABLE_DEACTIVATION_FLAG=4},875137:(u,x,s)=>{s.d(x,{O:()=>i});var U=s(706400),_=s(604910),W=s(23987),c=s(333949),I=s(200198),L=s(421614),J=s(283734),k=s(779908);class i{constructor(u=!0,x=10,s=CANNON){this._useDeltaForWorldStep=u,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodiesToRemoveAfterStep=new Array,this._firstFrame=!0,this._tmpQuaternion=new _.PT,this._minus90X=new _.PT(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new _.PT(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=_.Pq.Zero(),this._tmpDeltaPosition=_.Pq.Zero(),this._tmpUnityRotation=new _.PT,this.BJSCANNON=s,this.isSupported()?(this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=x,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new L.G):U.V.Error("CannonJS is not available. Please make sure you included the js file.")}getPluginVersion(){return 1}setGravity(u){const x=u;this.world.gravity.set(x.x,x.y,x.z)}setTimeStep(u){this._fixedTimeStep=u}getTimeStep(){return this._fixedTimeStep}executeStep(u,x){if(this._firstFrame){this._firstFrame=!1;for(const u of x)u.type!=c.j.HeightmapImpostor&&u.type!==c.j.PlaneImpostor&&u.beforeStep()}this.world.step(this._useDeltaForWorldStep?u:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()}_removeMarkedPhysicsBodiesFromWorld(){this._physicsBodiesToRemoveAfterStep.length>0&&(this._physicsBodiesToRemoveAfterStep.forEach((u=>{"function"==typeof this.world.removeBody?this.world.removeBody(u):this.world.remove(u)})),this._physicsBodiesToRemoveAfterStep.length=0)}applyImpulse(u,x,s){const U=new this.BJSCANNON.Vec3(s.x,s.y,s.z),_=new this.BJSCANNON.Vec3(x.x,x.y,x.z);u.physicsBody.applyImpulse(_,U)}applyForce(u,x,s){const U=new this.BJSCANNON.Vec3(s.x,s.y,s.z),_=new this.BJSCANNON.Vec3(x.x,x.y,x.z);u.physicsBody.applyForce(_,U)}generatePhysicsBody(u){if(this._removeMarkedPhysicsBodiesFromWorld(),u.parent)u.physicsBody&&(this.removePhysicsBody(u),u.forceUpdate());else{if(u.isBodyInitRequired()){const x=this._createShape(u);if(!x)return void U.V.Warn("It was not possible to create a physics body for this object.");const s=u.physicsBody;s&&this.removePhysicsBody(u);const _=this._addMaterial("mat-"+u.uniqueId,u.getParam("friction"),u.getParam("restitution")),W={mass:u.getParam("mass"),material:_},c=u.getParam("nativeOptions");for(const u in c)Object.prototype.hasOwnProperty.call(c,u)&&(W[u]=c[u]);u.physicsBody=new this.BJSCANNON.Body(W),u.physicsBody.addEventListener("collide",u.onCollide),this.world.addEventListener("preStep",u.beforeStep),this.world.addEventListener("postStep",u.afterStep),u.physicsBody.addShape(x),"function"==typeof this.world.addBody?this.world.addBody(u.physicsBody):this.world.add(u.physicsBody),s&&["force","torque","velocity","angularVelocity"].forEach((function(x){const U=s[x];u.physicsBody[x].set(U.x,U.y,U.z)})),this._processChildMeshes(u)}this._updatePhysicsBodyTransformation(u)}}_processChildMeshes(u){const x=u.object.getChildMeshes?u.object.getChildMeshes(!0):[],s=u.object.rotationQuaternion;if(s?s.conjugateToRef(this._tmpQuaternion):this._tmpQuaternion.set(0,0,0,1),x.length){const s=x=>{if(!x.rotationQuaternion)return;const U=x.getPhysicsImpostor();if(U&&U.parent!==u&&x.parent){const s=x.getAbsolutePosition().subtract(x.parent.getAbsolutePosition()),_=x.rotationQuaternion.multiply(this._tmpQuaternion);U.physicsBody&&(this.removePhysicsBody(U),U.physicsBody=null),U.parent=u,U.resetUpdateFlags(),u.physicsBody.addShape(this._createShape(U),new this.BJSCANNON.Vec3(s.x,s.y,s.z),new this.BJSCANNON.Quaternion(_.x,_.y,_.z,_.w)),u.physicsBody.mass+=U.getParam("mass")}x.getChildMeshes(!0).filter((u=>!!u.physicsImpostor)).forEach(s)};x.filter((u=>!!u.physicsImpostor)).forEach(s)}}removePhysicsBody(u){u.physicsBody.removeEventListener("collide",u.onCollide),this.world.removeEventListener("preStep",u.beforeStep),this.world.removeEventListener("postStep",u.afterStep),-1===this._physicsBodiesToRemoveAfterStep.indexOf(u.physicsBody)&&this._physicsBodiesToRemoveAfterStep.push(u.physicsBody)}generateJoint(u){const x=u.mainImpostor.physicsBody,s=u.connectedImpostor.physicsBody;if(!x||!s)return;let U;const _=u.joint.jointData,W={pivotA:_.mainPivot?(new this.BJSCANNON.Vec3).set(_.mainPivot.x,_.mainPivot.y,_.mainPivot.z):null,pivotB:_.connectedPivot?(new this.BJSCANNON.Vec3).set(_.connectedPivot.x,_.connectedPivot.y,_.connectedPivot.z):null,axisA:_.mainAxis?(new this.BJSCANNON.Vec3).set(_.mainAxis.x,_.mainAxis.y,_.mainAxis.z):null,axisB:_.connectedAxis?(new this.BJSCANNON.Vec3).set(_.connectedAxis.x,_.connectedAxis.y,_.connectedAxis.z):null,maxForce:_.nativeParams.maxForce,collideConnected:!!_.collision};switch(u.joint.type){case I.W$.HingeJoint:case I.W$.Hinge2Joint:U=new this.BJSCANNON.HingeConstraint(x,s,W);break;case I.W$.DistanceJoint:U=new this.BJSCANNON.DistanceConstraint(x,s,_.maxDistance||2);break;case I.W$.SpringJoint:{const u=_;U=new this.BJSCANNON.Spring(x,s,{restLength:u.length,stiffness:u.stiffness,damping:u.damping,localAnchorA:W.pivotA,localAnchorB:W.pivotB});break}case I.W$.LockJoint:U=new this.BJSCANNON.LockConstraint(x,s,W);break;case I.W$.PointToPointJoint:case I.W$.BallAndSocketJoint:default:U=new this.BJSCANNON.PointToPointConstraint(x,W.pivotA,s,W.pivotB,W.maxForce)}U.collideConnected=!!_.collision,u.joint.physicsJoint=U,u.joint.type!==I.W$.SpringJoint?this.world.addConstraint(U):(u.joint.jointData.forceApplicationCallback=u.joint.jointData.forceApplicationCallback||function(){U.applyForce()},u.mainImpostor.registerAfterPhysicsStep(u.joint.jointData.forceApplicationCallback))}removeJoint(u){u.joint.type!==I.W$.SpringJoint?this.world.removeConstraint(u.joint.physicsJoint):u.mainImpostor.unregisterAfterPhysicsStep(u.joint.jointData.forceApplicationCallback)}_addMaterial(u,x,s){let U,_;for(U=0;U<this._physicsMaterials.length;U++)if(_=this._physicsMaterials[U],_.friction===x&&_.restitution===s)return _;const W=new this.BJSCANNON.Material(u);return W.friction=x,W.restitution=s,this._physicsMaterials.push(W),W}_checkWithEpsilon(u){return u<k.bH?k.bH:u}_createShape(u){const x=u.object;let s;const I=u.getObjectExtents();switch(u.type){case c.j.SphereImpostor:{const u=I.x,x=I.y,U=I.z;s=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(u),this._checkWithEpsilon(x),this._checkWithEpsilon(U))/2);break}case c.j.CylinderImpostor:{let x=u.getParam("nativeOptions");x||(x={});const U=void 0!==x.radiusTop?x.radiusTop:this._checkWithEpsilon(I.x)/2,_=void 0!==x.radiusBottom?x.radiusBottom:this._checkWithEpsilon(I.x)/2,W=void 0!==x.height?x.height:this._checkWithEpsilon(I.y),c=void 0!==x.numSegments?x.numSegments:16;s=new this.BJSCANNON.Cylinder(U,_,W,c);const L=new this.BJSCANNON.Quaternion;L.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);const J=new this.BJSCANNON.Vec3(0,0,0);s.transformAllPoints(J,L);break}case c.j.BoxImpostor:{const u=I.scale(.5);s=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(u.x),this._checkWithEpsilon(u.y),this._checkWithEpsilon(u.z)));break}case c.j.PlaneImpostor:U.V.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),s=new this.BJSCANNON.Plane;break;case c.j.MeshImpostor:{const c=x.getVerticesData?x.getVerticesData(W.R.PositionKind):[],I=x.getIndices?x.getIndices():[];if(!c)return void U.V.Warn("Tried to create a MeshImpostor for an object without vertices. This will fail.");const L=x.position.clone(),J=x.rotation&&x.rotation.clone(),k=x.rotationQuaternion&&x.rotationQuaternion.clone();x.position.copyFromFloats(0,0,0),x.rotation&&x.rotation.copyFromFloats(0,0,0),x.rotationQuaternion&&x.rotationQuaternion.copyFrom(u.getParentsRotation()),x.rotationQuaternion&&x.parent&&x.rotationQuaternion.conjugateInPlace();const i=x.computeWorldMatrix(!0),d=[];let j;for(j=0;j<c.length;j+=3)_.Pq.TransformCoordinates(_.Pq.FromArray(c,j),i).toArray(d,j);U.V.Warn("MeshImpostor only collides against spheres."),s=new this.BJSCANNON.Trimesh(d,I),x.position.copyFrom(L),J&&x.rotation&&x.rotation.copyFrom(J),k&&x.rotationQuaternion&&x.rotationQuaternion.copyFrom(k);break}case c.j.HeightmapImpostor:{const U=x.position.clone(),_=x.rotation&&x.rotation.clone(),W=x.rotationQuaternion&&x.rotationQuaternion.clone();x.position.copyFromFloats(0,0,0),x.rotation&&x.rotation.copyFromFloats(0,0,0),x.rotationQuaternion&&x.rotationQuaternion.copyFrom(u.getParentsRotation()),x.rotationQuaternion&&x.parent&&x.rotationQuaternion.conjugateInPlace(),x.rotationQuaternion&&x.rotationQuaternion.multiplyInPlace(this._minus90X),s=this._createHeightmap(x),x.position.copyFrom(U),_&&x.rotation&&x.rotation.copyFrom(_),W&&x.rotationQuaternion&&x.rotationQuaternion.copyFrom(W),x.computeWorldMatrix(!0);break}case c.j.ParticleImpostor:s=new this.BJSCANNON.Particle;break;case c.j.NoImpostor:s=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0))}return s}_createHeightmap(u,x){let s=u.getVerticesData(W.R.PositionKind);const U=u.computeWorldMatrix(!0),c=[];let I;for(I=0;I<s.length;I+=3)_.Pq.TransformCoordinates(_.Pq.FromArray(s,I),U).toArray(c,I);s=c;const L=new Array,J=x||~~(Math.sqrt(s.length/3)-1),k=u.getBoundingInfo(),i=Math.min(k.boundingBox.extendSizeWorld.x,k.boundingBox.extendSizeWorld.y),d=k.boundingBox.extendSizeWorld.z,j=2*i/J;for(let u=0;u<s.length;u+=3){const x=Math.round(s[u+0]/j+J/2),U=Math.round(-1*(s[u+1]/j-J/2)),_=-s[u+2]+d;L[x]||(L[x]=[]),L[x][U]||(L[x][U]=_),L[x][U]=Math.max(_,L[x][U])}for(let u=0;u<=J;++u){if(!L[u]){let x=1;for(;!L[(u+x)%J];)x++;L[u]=L[(u+x)%J].slice()}for(let x=0;x<=J;++x)if(!L[u][x]){let s,U=1;for(;void 0===s;)s=L[u][(x+U++)%J];L[u][x]=s}}const r=new this.BJSCANNON.Heightfield(L,{elementSize:j});return r.minY=d,r}_updatePhysicsBodyTransformation(u){const x=u.object;if(x.computeWorldMatrix&&x.computeWorldMatrix(!0),!x.getBoundingInfo())return;const s=u.getObjectCenter();this._tmpDeltaPosition.copyFrom(x.getAbsolutePivotPoint().subtract(s)),this._tmpDeltaPosition.divideInPlace(u.object.scaling),this._tmpPosition.copyFrom(s);let U=x.rotationQuaternion;if(U){if(u.type!==c.j.PlaneImpostor&&u.type!==c.j.HeightmapImpostor||(U=U.multiply(this._minus90X),u.setDeltaRotation(this._plus90X)),u.type===c.j.HeightmapImpostor){const u=x;let U=u.getBoundingInfo();const W=u.rotationQuaternion;u.rotationQuaternion=this._tmpUnityRotation,u.computeWorldMatrix(!0);const c=s.clone();let I=u.getPivotMatrix();I=I?I.clone():_.uq.Identity();const L=_.uq.Translation(U.boundingBox.extendSizeWorld.x,0,-U.boundingBox.extendSizeWorld.z);u.setPreTransformMatrix(L),u.computeWorldMatrix(!0),U=u.getBoundingInfo();const J=U.boundingBox.centerWorld.subtract(s).subtract(u.position).negate();this._tmpPosition.copyFromFloats(J.x,J.y-U.boundingBox.extendSizeWorld.y,J.z),this._tmpDeltaPosition.copyFrom(U.boundingBox.centerWorld.subtract(c)),this._tmpDeltaPosition.y+=U.boundingBox.extendSizeWorld.y,u.rotationQuaternion=W,u.setPreTransformMatrix(I),u.computeWorldMatrix(!0)}else u.type===c.j.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);u.setDeltaPosition(this._tmpDeltaPosition),u.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),u.physicsBody.quaternion.set(U.x,U.y,U.z,U.w)}}setTransformationFromPhysicsBody(u){if(u.object.position.set(u.physicsBody.position.x,u.physicsBody.position.y,u.physicsBody.position.z),u.object.rotationQuaternion){const x=u.physicsBody.quaternion;u.object.rotationQuaternion.set(x.x,x.y,x.z,x.w)}}setPhysicsBodyTransformation(u,x,s){u.physicsBody.position.set(x.x,x.y,x.z),u.physicsBody.quaternion.set(s.x,s.y,s.z,s.w)}isSupported(){return void 0!==this.BJSCANNON}setLinearVelocity(u,x){u.physicsBody.velocity.set(x.x,x.y,x.z)}setAngularVelocity(u,x){u.physicsBody.angularVelocity.set(x.x,x.y,x.z)}getLinearVelocity(u){const x=u.physicsBody.velocity;return x?new _.Pq(x.x,x.y,x.z):null}getAngularVelocity(u){const x=u.physicsBody.angularVelocity;return x?new _.Pq(x.x,x.y,x.z):null}setBodyMass(u,x){u.physicsBody.mass=x,u.physicsBody.updateMassProperties()}getBodyMass(u){return u.physicsBody.mass}getBodyFriction(u){return u.physicsBody.material.friction}setBodyFriction(u,x){u.physicsBody.material.friction=x}getBodyRestitution(u){return u.physicsBody.material.restitution}setBodyRestitution(u,x){u.physicsBody.material.restitution=x}sleepBody(u){u.physicsBody.sleep()}wakeUpBody(u){u.physicsBody.wakeUp()}updateDistanceJoint(u,x){u.physicsJoint.distance=x}setMotor(u,x,s,U){U||(u.physicsJoint.enableMotor(),u.physicsJoint.setMotorSpeed(x),s&&this.setLimit(u,s))}setLimit(u,x,s){u.physicsJoint.motorEquation.maxForce=s,u.physicsJoint.motorEquation.minForce=void 0===x?-x:x}syncMeshWithImpostor(u,x){const s=x.physicsBody;u.position.x=s.position.x,u.position.y=s.position.y,u.position.z=s.position.z,u.rotationQuaternion&&(u.rotationQuaternion.x=s.quaternion.x,u.rotationQuaternion.y=s.quaternion.y,u.rotationQuaternion.z=s.quaternion.z,u.rotationQuaternion.w=s.quaternion.w)}getRadius(u){return u.physicsBody.shapes[0].boundingSphereRadius}getBoxSizeToRef(u,x){const s=u.physicsBody.shapes[0];x.x=2*s.halfExtents.x,x.y=2*s.halfExtents.y,x.z=2*s.halfExtents.z}dispose(){}_extendNamespace(){const u=new this.BJSCANNON.Vec3,x=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(s,U,_){if(_=_||10,0===(U=U||0))this.internalStep(s),this.time+=s;else{let W=Math.floor((this.time+U)/s)-Math.floor(this.time/s);W=Math.min(W,_)||1;const c=performance.now();for(let u=0;u!==W&&(this.internalStep(s),!(performance.now()-c>1e3*s));u++);this.time+=U;const I=this.time%s/s,L=u,J=this.bodies;for(let u=0;u!==J.length;u++){const s=J[u];s.type!==x.Body.STATIC&&s.sleepState!==x.Body.SLEEPING?(s.position.vsub(s.previousPosition,L),L.scale(I,L),s.position.vadd(L,s.interpolatedPosition)):(s.interpolatedPosition.set(s.position.x,s.position.y,s.position.z),s.interpolatedQuaternion.set(s.quaternion.x,s.quaternion.y,s.quaternion.z,s.quaternion.w))}}}}raycast(u,x){return this._raycastResult.reset(u,x),this.raycastToRef(u,x,this._raycastResult),this._raycastResult}raycastToRef(u,x,s){this._cannonRaycastResult.reset(),this.world.raycastClosest(u,x,{},this._cannonRaycastResult),s.reset(u,x),this._cannonRaycastResult.hasHit&&(s.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),s.setHitDistance(this._cannonRaycastResult.distance))}}J.A.DefaultPluginFactory=()=>new i},390436:(u,x,s)=>{s.d(x,{z:()=>J});var U=s(333949),_=s(200198),W=s(604910),c=s(706400),I=s(421614),L=s(779908);class J{constructor(u=!0,x,s=OIMO){this._useDeltaForWorldStep=u,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=W.Pq.Zero(),this.BJSOIMO=s,this.world=new this.BJSOIMO.World({iterations:x}),this.world.clear(),this._raycastResult=new I.G}getPluginVersion(){return 1}setGravity(u){this.world.gravity.set(u.x,u.y,u.z)}setTimeStep(u){this.world.timeStep=u}getTimeStep(){return this.world.timeStep}executeStep(u,x){x.forEach((function(u){u.beforeStep()})),this.world.timeStep=this._useDeltaForWorldStep?u:this._fixedTimeStep,this.world.step(),x.forEach((u=>{u.afterStep(),this._tmpImpostorsArray[u.uniqueId]=u}));let s=this.world.contacts;for(;null!==s;){if(s.touching&&!s.body1.sleeping&&!s.body2.sleeping){s=s.next;continue}const u=this._tmpImpostorsArray[+s.body1.name],x=this._tmpImpostorsArray[+s.body2.name];u&&x?(u.onCollide({body:x.physicsBody,point:null,distance:0,impulse:0,normal:null}),x.onCollide({body:u.physicsBody,point:null,distance:0,impulse:0,normal:null}),s=s.next):s=s.next}}applyImpulse(u,x,s){const U=u.physicsBody.mass;u.physicsBody.applyImpulse(s.scale(this.world.invScale),x.scale(this.world.invScale*U))}applyForce(u,x,s){c.V.Warn("Oimo doesn't support applying force. Using impulse instead."),this.applyImpulse(u,x,s)}generatePhysicsBody(u){if(u.parent)u.physicsBody&&(this.removePhysicsBody(u),u.forceUpdate());else{if(u.isBodyInitRequired()){const s={name:u.uniqueId,config:[u.getParam("mass")||.001,u.getParam("friction"),u.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:0!==u.getParam("mass"),density:u.getParam("mass"),friction:u.getParam("friction"),restitution:u.getParam("restitution"),world:this.world},_=[u];(x=u.object).getChildMeshes&&x.getChildMeshes().forEach((function(u){u.physicsImpostor&&_.push(u.physicsImpostor)}));const I=u=>Math.max(u,L.bH),J=new W.PT;_.forEach((x=>{if(!x.object.rotationQuaternion)return;const _=x.object.rotationQuaternion;J.copyFrom(_),x.object.rotationQuaternion.set(0,0,0,1),x.object.computeWorldMatrix(!0);const W=J.toEulerAngles(),L=x.getObjectExtents(),k=57.29577951308232;if(x===u){const x=u.getObjectCenter();u.object.getAbsolutePivotPoint().subtractToRef(x,this._tmpPositionVector),this._tmpPositionVector.divideInPlace(u.object.scaling),s.pos.push(x.x),s.pos.push(x.y),s.pos.push(x.z),s.posShape.push(0,0,0),s.rotShape.push(0,0,0)}else{const u=x.object.position.clone();s.posShape.push(u.x),s.posShape.push(u.y),s.posShape.push(u.z),s.rotShape.push(W.x*k,W.y*k,W.z*k)}switch(x.object.rotationQuaternion.copyFrom(J),x.type){case U.j.ParticleImpostor:c.V.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case U.j.SphereImpostor:{const u=L.x,x=L.y,U=L.z,_=Math.max(I(u),I(x),I(U))/2;s.type.push("sphere"),s.size.push(_),s.size.push(_),s.size.push(_);break}case U.j.CylinderImpostor:{const u=I(L.x)/2,x=I(L.y);s.type.push("cylinder"),s.size.push(u),s.size.push(x),s.size.push(x);break}case U.j.PlaneImpostor:case U.j.BoxImpostor:default:{const u=I(L.x),x=I(L.y),U=I(L.z);s.type.push("box"),s.size.push(u),s.size.push(x),s.size.push(U);break}}x.object.rotationQuaternion=_})),u.physicsBody=this.world.add(s),u.physicsBody.resetQuaternion(J),u.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);u.setDeltaPosition(this._tmpPositionVector)}var x}removePhysicsBody(u){this.world.removeRigidBody(u.physicsBody)}generateJoint(u){const x=u.mainImpostor.physicsBody,s=u.connectedImpostor.physicsBody;if(!x||!s)return;const U=u.joint.jointData,W=U.nativeParams||{};let I;const L={body1:x,body2:s,axe1:W.axe1||(U.mainAxis?U.mainAxis.asArray():null),axe2:W.axe2||(U.connectedAxis?U.connectedAxis.asArray():null),pos1:W.pos1||(U.mainPivot?U.mainPivot.asArray():null),pos2:W.pos2||(U.connectedPivot?U.connectedPivot.asArray():null),min:W.min,max:W.max,collision:W.collision||U.collision,spring:W.spring,world:this.world};switch(u.joint.type){case _.W$.BallAndSocketJoint:I="jointBall";break;case _.W$.SpringJoint:{c.V.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");const u=U;L.min=u.length||L.min,L.max=Math.max(L.min,L.max)}case _.W$.DistanceJoint:I="jointDistance",L.max=U.maxDistance;break;case _.W$.PrismaticJoint:I="jointPrisme";break;case _.W$.SliderJoint:I="jointSlide";break;case _.W$.WheelJoint:I="jointWheel";break;case _.W$.HingeJoint:default:I="jointHinge"}L.type=I,u.joint.physicsJoint=this.world.add(L)}removeJoint(u){try{this.world.removeJoint(u.joint.physicsJoint)}catch(u){c.V.Warn(u)}}isSupported(){return void 0!==this.BJSOIMO}setTransformationFromPhysicsBody(u){if(!u.physicsBody.sleeping){if(u.physicsBody.shapes.next){let x=u.physicsBody.shapes;for(;x.next;)x=x.next;u.object.position.set(x.position.x,x.position.y,x.position.z)}else{const x=u.physicsBody.getPosition();u.object.position.set(x.x,x.y,x.z)}if(u.object.rotationQuaternion){const x=u.physicsBody.getQuaternion();u.object.rotationQuaternion.set(x.x,x.y,x.z,x.w)}}}setPhysicsBodyTransformation(u,x,s){const U=u.physicsBody;u.physicsBody.shapes.next||(U.position.set(x.x,x.y,x.z),U.orientation.set(s.x,s.y,s.z,s.w),U.syncShapes(),U.awake())}setLinearVelocity(u,x){u.physicsBody.linearVelocity.set(x.x,x.y,x.z)}setAngularVelocity(u,x){u.physicsBody.angularVelocity.set(x.x,x.y,x.z)}getLinearVelocity(u){const x=u.physicsBody.linearVelocity;return x?new W.Pq(x.x,x.y,x.z):null}getAngularVelocity(u){const x=u.physicsBody.angularVelocity;return x?new W.Pq(x.x,x.y,x.z):null}setBodyMass(u,x){const s=0===x;u.physicsBody.shapes.density=s?1:x,u.physicsBody.setupMass(s?2:1)}getBodyMass(u){return u.physicsBody.shapes.density}getBodyFriction(u){return u.physicsBody.shapes.friction}setBodyFriction(u,x){u.physicsBody.shapes.friction=x}getBodyRestitution(u){return u.physicsBody.shapes.restitution}setBodyRestitution(u,x){u.physicsBody.shapes.restitution=x}sleepBody(u){u.physicsBody.sleep()}wakeUpBody(u){u.physicsBody.awake()}updateDistanceJoint(u,x,s){u.physicsJoint.limitMotor.upperLimit=x,void 0!==s&&(u.physicsJoint.limitMotor.lowerLimit=s)}setMotor(u,x,s,U){void 0!==s?c.V.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):s=1e6,x*=-1;const _=U?u.physicsJoint.rotationalLimitMotor2:u.physicsJoint.rotationalLimitMotor1||u.physicsJoint.rotationalLimitMotor||u.physicsJoint.limitMotor;_&&_.setMotor(x,s)}setLimit(u,x,s,U){const _=U?u.physicsJoint.rotationalLimitMotor2:u.physicsJoint.rotationalLimitMotor1||u.physicsJoint.rotationalLimitMotor||u.physicsJoint.limitMotor;_&&_.setLimit(x,void 0===s?-x:s)}syncMeshWithImpostor(u,x){const s=x.physicsBody;u.position.x=s.position.x,u.position.y=s.position.y,u.position.z=s.position.z,u.rotationQuaternion&&(u.rotationQuaternion.x=s.orientation.x,u.rotationQuaternion.y=s.orientation.y,u.rotationQuaternion.z=s.orientation.z,u.rotationQuaternion.w=s.orientation.w)}getRadius(u){return u.physicsBody.shapes.radius}getBoxSizeToRef(u,x){const s=u.physicsBody.shapes;x.x=2*s.halfWidth,x.y=2*s.halfHeight,x.z=2*s.halfDepth}dispose(){this.world.clear()}raycast(u,x){return c.V.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(u,x),this._raycastResult}raycastToRef(u,x,s){c.V.Warn("raycast is not currently supported by the Oimo physics plugin"),s.reset(u,x)}}},283734:(u,x,s)=>{s.d(x,{A:()=>W});var U=s(604910),_=s(554014);class W{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw _.n("CannonJSPlugin")}constructor(u,x=W.DefaultPluginFactory()){if(this._physicsPlugin=x,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. "+"Please make sure it is included.");u=u||new U.Pq(0,-9.807,0),this.setGravity(u),this.setTimeStep()}setGravity(u){this.gravity=u,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(u=1/60){this._physicsPlugin.setTimeStep(u)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(u=0){this._subTimeStep=u}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach((function(u){u.dispose()})),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(u){this._impostors.push(u),u.uniqueId=this._uniqueIdCounter++,u.parent||this._physicsPlugin.generatePhysicsBody(u)}removeImpostor(u){const x=this._impostors.indexOf(u);x>-1&&this._impostors.splice(x,1).length&&this.getPhysicsPlugin().removePhysicsBody(u)}addJoint(u,x,s){const U={mainImpostor:u,connectedImpostor:x,joint:s};s.physicsPlugin=this._physicsPlugin,this._joints.push(U),this._physicsPlugin.generateJoint(U)}removeJoint(u,x,s){const U=this._joints.filter((function(U){return U.connectedImpostor===x&&U.joint===s&&U.mainImpostor===u}));U.length&&this._physicsPlugin.removeJoint(U[0])}_step(u){this._impostors.forEach((u=>{u.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(u)})),u>.1?u=.1:u<=0&&(u=1/60),this._physicsPlugin.executeStep(u,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(u){for(let x=0;x<this._impostors.length;++x)if(this._impostors[x].object===u)return this._impostors[x];return null}getImpostorWithPhysicsBody(u){for(let x=0;x<this._impostors.length;++x)if(this._impostors[x].physicsBody===u)return this._impostors[x];return null}raycast(u,x){return this._physicsPlugin.raycast(u,x)}raycastToRef(u,x,s){return this._physicsPlugin.raycastToRef(u,x,s)}}},333949:(u,x,s)=>{s.d(x,{j:()=>J});var U=s(706400),_=s(967872),W=s(604910),c=s(938868),I=s(27230),L=s(200198);I.e._PhysicsImpostorParser=function(u,x,s){return new J(x,s.physicsImpostor,{mass:s.physicsMass,friction:s.physicsFriction,restitution:s.physicsRestitution},u)};class J{get isDisposed(){return this._isDisposed}get mass(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0}set mass(u){this.setMass(u)}get friction(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0}set friction(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,u)}get restitution(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0}set restitution(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,u)}get pressure(){if(!this._physicsEngine)return 0;const u=this._physicsEngine.getPhysicsPlugin();return u.setBodyPressure?u.getBodyPressure(this):0}set pressure(u){if(!this._physicsEngine)return;const x=this._physicsEngine.getPhysicsPlugin();x.setBodyPressure&&x.setBodyPressure(this,u)}get stiffness(){if(!this._physicsEngine)return 0;const u=this._physicsEngine.getPhysicsPlugin();return u.getBodyStiffness?u.getBodyStiffness(this):0}set stiffness(u){if(!this._physicsEngine)return;const x=this._physicsEngine.getPhysicsPlugin();x.setBodyStiffness&&x.setBodyStiffness(this,u)}get velocityIterations(){if(!this._physicsEngine)return 0;const u=this._physicsEngine.getPhysicsPlugin();return u.getBodyVelocityIterations?u.getBodyVelocityIterations(this):0}set velocityIterations(u){if(!this._physicsEngine)return;const x=this._physicsEngine.getPhysicsPlugin();x.setBodyVelocityIterations&&x.setBodyVelocityIterations(this,u)}get positionIterations(){if(!this._physicsEngine)return 0;const u=this._physicsEngine.getPhysicsPlugin();return u.getBodyPositionIterations?u.getBodyPositionIterations(this):0}set positionIterations(u){if(!this._physicsEngine)return;const x=this._physicsEngine.getPhysicsPlugin();x.setBodyPositionIterations&&x.setBodyPositionIterations(this,u)}constructor(u,x,s={mass:0},_){this.object=u,this.type=x,this._options=s,this._scene=_,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=W.Pq.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new W.PT,this._tmpQuat2=new W.PT,this.beforeStep=()=>{this._physicsEngine&&(this.object.translate(this._deltaPosition,-1),this._deltaRotationConjugated&&this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotationConjugated,this.object.rotationQuaternion),this.object.computeWorldMatrix(!1),this.object.parent&&this.object.rotationQuaternion?(this.getParentsRotation(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this._tmpQuat)):this._tmpQuat.copyFrom(this.object.rotationQuaternion||new W.PT),this._options.disableBidirectionalTransformation||this.object.rotationQuaternion&&this._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(this,this.object.getAbsolutePosition(),this._tmpQuat),this._onBeforePhysicsStepCallbacks.forEach((u=>{u(this)})))},this.afterStep=()=>{this._physicsEngine&&(this._onAfterPhysicsStepCallbacks.forEach((u=>{u(this)})),this._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(this),this.object.parent&&this.object.rotationQuaternion&&(this.getParentsRotation(),this._tmpQuat.conjugateInPlace(),this._tmpQuat.multiplyToRef(this.object.rotationQuaternion,this.object.rotationQuaternion)),this.object.setAbsolutePosition(this.object.position),this._deltaRotation?(this.object.rotationQuaternion&&this.object.rotationQuaternion.multiplyToRef(this._deltaRotation,this.object.rotationQuaternion),this._deltaPosition.applyRotationQuaternionToRef(this._deltaRotation,J._TmpVecs[0]),this.object.translate(J._TmpVecs[0],1)):this.object.translate(this._deltaPosition,1),this.object.computeWorldMatrix(!0))},this.onCollideEvent=null,this.onCollide=u=>{if(!this._onPhysicsCollideCallbacks.length&&!this.onCollideEvent)return;if(!this._physicsEngine)return;const x=this._physicsEngine.getImpostorWithPhysicsBody(u.body);x&&(this.onCollideEvent&&this.onCollideEvent(this,x),this._onPhysicsCollideCallbacks.filter((u=>-1!==u.otherImpostors.indexOf(x))).forEach((s=>{s.callback(this,x,u.point,u.distance,u.impulse,u.normal)})))},this.object?(this.object.parent&&0!==s.mass&&U.V.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&u.getScene&&(this._scene=u.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=W.PT.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new W.PT),this._options.mass=void 0===s.mass?0:s.mass,this._options.friction=void 0===s.friction?.2:s.friction,this._options.restitution=void 0===s.restitution?.2:s.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===s.pressure?200:s.pressure,this._options.stiffness=void 0===s.stiffness?1:s.stiffness,this._options.velocityIterations=void 0===s.velocityIterations?20:s.velocityIterations,this._options.positionIterations=void 0===s.positionIterations?20:s.positionIterations,this._options.fixedPoints=void 0===s.fixedPoints?0:s.fixedPoints,this._options.margin=void 0===s.margin?0:s.margin,this._options.damping=void 0===s.damping?0:s.damping,this._options.path=void 0===s.path?null:s.path,this._options.shape=void 0===s.shape?null:s.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&U.V.Warn("You must affect impostors to children before affecting impostor to parent.")):U.V.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):U.V.Error("No object was provided. A physics object is obligatory")}_init(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))}_getPhysicsParent(){return this.object.parent instanceof c.u?this.object.parent.physicsImpostor:null}isBodyInitRequired(){return this._bodyUpdateRequired||!this._physicsBody&&(!this._parent||!!this._options.ignoreParent)}setScalingUpdated(){this.forceUpdate()}forceUpdate(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()}get physicsBody(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody}get parent(){return!this._options.ignoreParent&&this._parent?this._parent:null}set parent(u){this._parent=u}set physicsBody(u){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=u,this.resetUpdateFlags()}resetUpdateFlags(){this._bodyUpdateRequired=!1}getObjectExtents(){if(this.object.getBoundingInfo){const u=this.object.rotationQuaternion,x=this.object.scaling.clone();this.object.rotationQuaternion=J.IDENTITY_QUATERNION;const s=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);s&&s.decompose(x,void 0,void 0);const U=this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiplyInPlace(x);return U.x=Math.abs(U.x),U.y=Math.abs(U.y),U.z=Math.abs(U.z),this.object.rotationQuaternion=u,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),U}return J.DEFAULT_OBJECT_SIZE}getObjectCenter(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position}getParam(u){return this._options[u]}setParam(u,x){this._options[u]=x,this._bodyUpdateRequired=!0}setMass(u){this.getParam("mass")!==u&&this.setParam("mass",u),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,u)}getLinearVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):W.Pq.Zero()}setLinearVelocity(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,u)}getAngularVelocity(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):W.Pq.Zero()}setAngularVelocity(u){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,u)}executeNativeFunction(u){this._physicsEngine&&u(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)}registerBeforePhysicsStep(u){this._onBeforePhysicsStepCallbacks.push(u)}unregisterBeforePhysicsStep(u){const x=this._onBeforePhysicsStepCallbacks.indexOf(u);x>-1?this._onBeforePhysicsStepCallbacks.splice(x,1):U.V.Warn("Function to remove was not found")}registerAfterPhysicsStep(u){this._onAfterPhysicsStepCallbacks.push(u)}unregisterAfterPhysicsStep(u){const x=this._onAfterPhysicsStepCallbacks.indexOf(u);x>-1?this._onAfterPhysicsStepCallbacks.splice(x,1):U.V.Warn("Function to remove was not found")}registerOnPhysicsCollide(u,x){const s=u instanceof Array?u:[u];this._onPhysicsCollideCallbacks.push({callback:x,otherImpostors:s})}unregisterOnPhysicsCollide(u,x){const s=u instanceof Array?u:[u];let _=-1;this._onPhysicsCollideCallbacks.some(((u,U)=>{if(u.callback===x&&u.otherImpostors.length===s.length){const x=u.otherImpostors.every((u=>s.indexOf(u)>-1));return x&&(_=U),x}return!1}))?this._onPhysicsCollideCallbacks.splice(_,1):U.V.Warn("Function to remove was not found")}getParentsRotation(){let u=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);u;)u.rotationQuaternion?this._tmpQuat2.copyFrom(u.rotationQuaternion):W.PT.RotationYawPitchRollToRef(u.rotation.y,u.rotation.x,u.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),u=u.parent;return this._tmpQuat}applyForce(u,x){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,u,x),this}applyImpulse(u,x){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,u,x),this}createJoint(u,x,s){const U=new L.W$(x,s);return this.addJoint(u,U),this}addJoint(u,x){return this._joints.push({otherImpostor:u,joint:x}),this._physicsEngine&&this._physicsEngine.addJoint(this,u,x),this}addAnchor(u,x,s,U,_){if(!this._physicsEngine)return this;const W=this._physicsEngine.getPhysicsPlugin();return W.appendAnchor?(this._physicsEngine&&W.appendAnchor(this,u,x,s,U,_),this):this}addHook(u,x,s,U){if(!this._physicsEngine)return this;const _=this._physicsEngine.getPhysicsPlugin();return _.appendAnchor?(this._physicsEngine&&_.appendHook(this,u,x,s,U),this):this}sleep(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this}wakeUp(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this}clone(u){return u?new J(u,this.type,this._options,this._scene):null}dispose(){this._physicsEngine&&(this._joints.forEach((u=>{this._physicsEngine&&this._physicsEngine.removeJoint(this,u.otherImpostor,u.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)}setDeltaPosition(u){this._deltaPosition.copyFrom(u)}setDeltaRotation(u){this._deltaRotation||(this._deltaRotation=new W.PT),this._deltaRotation.copyFrom(u),this._deltaRotationConjugated=this._deltaRotation.conjugate()}getBoxSizeToRef(u){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,u),this}getRadius(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0}syncBoneWithImpostor(u,x,s,U,_){const W=J._TmpVecs[0],c=this.object;if(c.rotationQuaternion)if(_){const s=J._TmpQuat;c.rotationQuaternion.multiplyToRef(_,s),u.setRotationQuaternion(s,1,x)}else u.setRotationQuaternion(c.rotationQuaternion,1,x);W.x=0,W.y=0,W.z=0,s&&(W.x=s.x,W.y=s.y,W.z=s.z,u.getDirectionToRef(W,x,W),null==U&&(U=s.length()),W.x*=U,W.y*=U,W.z*=U),u.getParent()?(W.addInPlace(c.getAbsolutePosition()),u.setAbsolutePosition(W,x)):(x.setAbsolutePosition(c.getAbsolutePosition()),x.position.x-=W.x,x.position.y-=W.y,x.position.z-=W.z)}syncImpostorWithBone(u,x,s,U,_,W){const c=this.object;if(c.rotationQuaternion)if(_){const s=J._TmpQuat;u.getRotationQuaternionToRef(1,x,s),s.multiplyToRef(_,c.rotationQuaternion)}else u.getRotationQuaternionToRef(1,x,c.rotationQuaternion);const I=J._TmpVecs[0],L=J._TmpVecs[1];W||((W=J._TmpVecs[2]).x=0,W.y=1,W.z=0),u.getDirectionToRef(W,x,L),u.getAbsolutePositionToRef(x,I),null==U&&s&&(U=s.length()),null!=U&&(I.x+=L.x*U,I.y+=L.y*U,I.z+=L.z*U),c.setAbsolutePosition(I)}}J.DEFAULT_OBJECT_SIZE=new W.Pq(1,1,1),J.IDENTITY_QUATERNION=W.PT.Identity(),J._TmpVecs=_.mI(3,W.Pq.Zero),J._TmpQuat=W.PT.Identity(),J.NoImpostor=0,J.SphereImpostor=1,J.BoxImpostor=2,J.PlaneImpostor=3,J.MeshImpostor=4,J.CapsuleImpostor=6,J.CylinderImpostor=7,J.ParticleImpostor=8,J.HeightmapImpostor=9,J.ConvexHullImpostor=10,J.CustomImpostor=100,J.RopeImpostor=101,J.ClothImpostor=102,J.SoftbodyImpostor=103},200198:(u,x,s)=>{s.d(x,{EE:()=>I,G3:()=>_,W$:()=>U,bB:()=>W,m6:()=>c});class U{constructor(u,x){this.type=u,this.jointData=x,x.nativeParams=x.nativeParams||{}}get physicsJoint(){return this._physicsJoint}set physicsJoint(u){this._physicsJoint=u}set physicsPlugin(u){this._physicsPlugin=u}executeNativeFunction(u){u(this._physicsPlugin.world,this._physicsJoint)}}U.DistanceJoint=0,U.HingeJoint=1,U.BallAndSocketJoint=2,U.WheelJoint=3,U.SliderJoint=4,U.PrismaticJoint=5,U.UniversalJoint=6,U.Hinge2Joint=U.WheelJoint,U.PointToPointJoint=8,U.SpringJoint=9,U.LockJoint=10;class _ extends U{constructor(u){super(U.DistanceJoint,u)}updateDistance(u,x){this._physicsPlugin.updateDistanceJoint(this,u,x)}}class W extends U{constructor(u,x){super(u,x)}setMotor(u,x){this._physicsPlugin.setMotor(this,u||0,x)}setLimit(u,x){this._physicsPlugin.setLimit(this,u,x)}}class c extends W{constructor(u){super(U.HingeJoint,u)}setMotor(u,x){this._physicsPlugin.setMotor(this,u||0,x)}setLimit(u,x){this._physicsPlugin.setLimit(this,u,x)}}class I extends W{constructor(u){super(U.Hinge2Joint,u)}setMotor(u,x,s=0){this._physicsPlugin.setMotor(this,u||0,x,s)}setLimit(u,x,s=0){this._physicsPlugin.setLimit(this,u,x,s)}}},958413:(u,x,s)=>{s.d(x,{j:()=>J});var U=s(297809),_=s(850034),W=s(432050),c=s(310035),I=s(760998),L=s(337776);class J extends _.w{set kernel(u){this._idealKernel!==u&&(u=Math.max(u,1),this._idealKernel=u,this._kernel=this._nearestBestKernel(u),this._blockCompilation||this._updateParameters())}get kernel(){return this._idealKernel}set packedFloat(u){this._packedFloat!==u&&(this._packedFloat=u,this._blockCompilation||this._updateParameters())}get packedFloat(){return this._packedFloat}getClassName(){return"BlurPostProcess"}constructor(u,x,s,U,_,c=W.g.BILINEAR_SAMPLINGMODE,I,L,J=0,k="",i=!1,d=5){super(u,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],U,_,c,I,L,null,J,"kernelBlur",{varyingCount:0,depCount:0},!0,d),this._blockCompilation=i,this._packedFloat=!1,this._staticDefines="",this._staticDefines=k,this.direction=x,this.onApplyObservable.add((u=>{this._outputTexture?u.setFloat2("delta",1/this._outputTexture.width*this.direction.x,1/this._outputTexture.height*this.direction.y):u.setFloat2("delta",1/this.width*this.direction.x,1/this.height*this.direction.y)})),this.kernel=s}_gatherImports(u,x){u?(this._webGPUReady=!0,x.push(Promise.all([s.e(14855).then(s.bind(s,314855)),s.e(74706).then(s.bind(s,74706))]))):x.push(Promise.all([s.e(18680).then(s.bind(s,718680)),s.e(61681).then(s.bind(s,661681))])),super._gatherImports(u,x)}updateEffect(u=null,x=null,s=null,U,_,W){this._updateParameters(_,W)}_updateParameters(u,x){const s=this._kernel,U=(s-1)/2;let _=[],W=[],c=0;for(let u=0;u<s;u++){const x=u/(s-1),I=this._gaussianWeight(2*x-1);_[u]=u-U,W[u]=I,c+=I}for(let u=0;u<W.length;u++)W[u]/=c;const I=[],L=[],J=[];for(let u=0;u<=U;u+=2){const x=Math.min(u+1,Math.floor(U));if(u===x)J.push({o:_[u],w:W[u]});else{const s=x===U,c=W[u]+W[x]*(s?.5:1),I=_[u]+1/(1+W[u]/W[x]);0===I?(J.push({o:_[u],w:W[u]}),J.push({o:_[u+1],w:W[u+1]})):(J.push({o:I,w:c}),J.push({o:-I,w:c}))}}for(let u=0;u<J.length;u++)L[u]=J[u].o,I[u]=J[u].w;_=L,W=I;const k=this.getEngine().getCaps().maxVaryingVectors-(1===this.shaderLanguage?1:0),i=Math.max(k,0)-1;let d=Math.min(_.length,i),j="";j+=this._staticDefines,-1!=this._staticDefines.indexOf("DOF")&&(j+=`#define CENTER_WEIGHT ${this._glslFloat(W[d-1])}\n`,d--);for(let u=0;u<d;u++)j+=`#define KERNEL_OFFSET${u} ${this._glslFloat(_[u])}\n`,j+=`#define KERNEL_WEIGHT${u} ${this._glslFloat(W[u])}\n`;let r=0;for(let u=i;u<_.length;u++)j+=`#define KERNEL_DEP_OFFSET${r} ${this._glslFloat(_[u])}\n`,j+=`#define KERNEL_DEP_WEIGHT${r} ${this._glslFloat(W[u])}\n`,r++;this.packedFloat&&(j+=`#define PACKEDFLOAT 1`),this._blockCompilation=!1,super.updateEffect(j,null,null,{varyingCount:d,depCount:r},u,x)}_nearestBestKernel(u){const x=Math.round(u);for(const u of[x,x-1,x+1,x-2,x+2])if(u%2!=0&&Math.floor(u/2)%2==0&&u>0)return Math.max(u,3);return Math.max(x,3)}_gaussianWeight(u){const x=1/3,s=-u*u/(2*x*x);return 1/(Math.sqrt(2*Math.PI)*x)*Math.exp(s)}_glslFloat(u,x=8){return u.toFixed(x).replace(/0+$/,"")}static _Parse(u,x,s,U){return L.p.Parse((()=>new J(u.name,u.direction,u.kernel,u.options,x,u.renderTargetSamplingMode,s.getEngine(),u.reusable,u.textureType,void 0,!1)),u,s,U)}}U.Cg([I.lK("kernel")],J.prototype,"_kernel",void 0),U.Cg([I.lK("packedFloat")],J.prototype,"_packedFloat",void 0),U.Cg([I.WM()],J.prototype,"direction",void 0),c.Y5("BABYLON.BlurPostProcess",J)},882621:(u,x,s)=>{s.d(x,{s:()=>L,v:()=>I});var U=s(850034),_=s(33321),W=s(310035),c=s(337776);class I extends U.w{getClassName(){return"PassPostProcess"}constructor(u,x,s=null,U,_,W,c=0,I=!1){super(u,"pass",null,null,x,s,U,_,W,void 0,c,void 0,null,I)}_gatherImports(u,x){u?(this._webGPUReady=!0,x.push(Promise.all([s.e(49920).then(s.bind(s,649920))]))):x.push(Promise.all([Promise.resolve().then(s.bind(s,330153))])),super._gatherImports(u,x)}static _Parse(u,x,s,U){return c.p.Parse((()=>new I(u.name,u.options,x,u.renderTargetSamplingMode,u._engine,u.reusable)),u,s,U)}}W.Y5("BABYLON.PassPostProcess",I);class L extends U.w{get face(){return this._face}set face(u){if(!(u<0||u>5))switch(this._face=u,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}getClassName(){return"PassCubePostProcess"}constructor(u,x,s=null,U,_,W,c=0,I=!1){super(u,"passCube",null,null,x,s,U,_,W,"#define POSITIVEX",c,void 0,null,I),this._face=0}_gatherImports(u,x){u?(this._webGPUReady=!0,x.push(Promise.all([s.e(27171).then(s.bind(s,127171))]))):x.push(Promise.all([s.e(23998).then(s.bind(s,623998))])),super._gatherImports(u,x)}static _Parse(u,x,s,U){return c.p.Parse((()=>new L(u.name,u.options,x,u.renderTargetSamplingMode,u._engine,u.reusable)),u,s,U)}}_.$._RescalePostProcessFactory=u=>new I("rescale",1,null,2,u,!1,0)},850034:(u,x,s)=>{s.d(x,{w:()=>r});var U=s(297809),_=s(293506),W=s(638113),c=s(604910),I=s(498083),L=(s(310839),s(68561),s(760998)),J=s(337776),k=s(310035),i=s(964061),d=s(33321),j=s(104270);d.$.prototype.setTextureFromPostProcess=function(u,x,s){var U;let _=null;x&&(x._forcedOutputTexture?_=x._forcedOutputTexture:x._textures.data[x._currentRenderTextureInd]&&(_=x._textures.data[x._currentRenderTextureInd])),this._bindTexture(u,null!==(U=null==_?void 0:_.texture)&&void 0!==U?U:null,s)},d.$.prototype.setTextureFromPostProcessOutput=function(u,x,s){var U,_;this._bindTexture(u,null!==(_=null===(U=null==x?void 0:x._outputTexture)||void 0===U?void 0:U.texture)&&void 0!==_?_:null,s)},I.M.prototype.setTextureFromPostProcess=function(u,x){this._engine.setTextureFromPostProcess(this._samplers[u],x,u)},I.M.prototype.setTextureFromPostProcessOutput=function(u,x){this._engine.setTextureFromPostProcessOutput(this._samplers[u],x,u)};class r{static RegisterShaderCodeProcessing(u,x){x?r._CustomShaderCodeProcessing[null!=u?u:""]=x:delete r._CustomShaderCodeProcessing[null!=u?u:""]}static _GetShaderCodeProcessing(u){var x;return null!==(x=r._CustomShaderCodeProcessing[u])&&void 0!==x?x:r._CustomShaderCodeProcessing[""]}get samples(){return this._samples}set samples(u){this._samples=Math.min(u,this._engine.getCaps().maxMSAASamples),this._textures.forEach((u=>{u.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(u){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),u&&(this._onActivateObserver=this.onActivateObservable.add(u))}set onSizeChanged(u){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(u)}set onApply(u){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(u)}set onBeforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u)}set onAfterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(u)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(u){this._forcedOutputTexture=u}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(u,x,s,U,I,L,J=1,k,d,j=null,r=0,D="postprocess",$,H=!1,f=5,O,t){var V,N,m,b,n,F,B,Z,v,y,e,T;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=0,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new _.L(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new c.I9(1,1),this._texelSize=c.I9.Zero(),this.onEffectCreatedObservable=new W.cP(void 0,!0),this.onActivateObservable=new W.cP,this.onSizeChangedObservable=new W.cP,this.onApplyObservable=new W.cP,this.onBeforeRenderObservable=new W.cP,this.onAfterRenderObservable=new W.cP,this._importPromises=[],this.name=u;let Q=1,E=null;if(s&&!Array.isArray(s)){const u=s;s=null!==(V=u.uniforms)&&void 0!==V?V:null,U=null!==(N=u.samplers)&&void 0!==N?N:null,Q=null!==(m=u.size)&&void 0!==m?m:1,L=null!==(b=u.camera)&&void 0!==b?b:null,J=null!==(n=u.samplingMode)&&void 0!==n?n:1,k=u.engine,d=u.reusable,j=null!==(F=u.defines)&&void 0!==F?F:null,r=null!==(B=u.textureType)&&void 0!==B?B:0,D=null!==(Z=u.vertexUrl)&&void 0!==Z?Z:"postprocess",$=u.indexParameters,H=null!==(v=u.blockCompilation)&&void 0!==v&&v,f=null!==(y=u.textureFormat)&&void 0!==y?y:5,O=null!==(e=u.shaderLanguage)&&void 0!==e?e:0,E=null!==(T=u.uniformBuffers)&&void 0!==T?T:null}else I&&(Q="number"==typeof I?I:{width:I.width,height:I.height});null!=L?(this._camera=L,this._scene=L.getScene(),L.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):k&&(this._engine=k,this._engine.postProcesses.push(this)),this._options=Q,this.renderTargetSamplingMode=J||1,this._reusable=d||!1,this._textureType=r,this._textureFormat=f,this._shaderLanguage=O||0,this._samplers=U||[],this._samplers.push("textureSampler"),this._fragmentUrl=x,this._vertexUrl=D,this._parameters=s||[],this._parameters.push("scale"),this._uniformBuffers=E||[],this._indexParameters=$,this._drawWrapper=new i.E(this._engine),this._webGPUReady=1===this._shaderLanguage,this._postConstructor(H,j,t)}_gatherImports(u=!1,x){u&&this._webGPUReady?x.push(Promise.all([s.e(39920).then(s.bind(s,439920))])):x.push(Promise.all([Promise.resolve().then(s.bind(s,310839))]))}_postConstructor(u,x=null,s){const U=this.getEngine().isWebGPU&&!r.ForceGLSL;this._gatherImports(U,this._importPromises),s&&s(U,this._importPromises),U&&this._webGPUReady&&(this._shaderLanguage=1),u||this.updateEffect(x)}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._drawWrapper.effect}shareOutputWith(u){return this._disposeTextures(),this._shareOutputWithPostProcess=u,this}useOwnOutput(){0==this._textures.length&&(this._textures=new _.L(2)),this._shareOutputWithPostProcess=null}updateEffect(u=null,x=null,s=null,U,_,W,c,I){var L,J;const k=r._GetShaderCodeProcessing(this.name);if(null==k?void 0:k.defineCustomBindings){const U=null!==(L=null==x?void 0:x.slice())&&void 0!==L?L:[];U.push(...this._parameters);const _=null!==(J=null==s?void 0:s.slice())&&void 0!==J?J:[];_.push(...this._samplers),u=k.defineCustomBindings(this.name,u,U,_),x=U,s=_}this._postProcessDefines=u,this._drawWrapper.effect=this._engine.createEffect({vertex:null!=c?c:this._vertexUrl,fragment:null!=I?I:this._fragmentUrl},{attributes:["position"],uniformsNames:x||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:s||this._samplers,defines:null!==u?u:"",fallbacks:null,onCompiled:null!=_?_:null,onError:null!=W?W:null,indexParameters:U||this._indexParameters,processCodeAfterIncludes:(null==k?void 0:k.processCodeAfterIncludes)?(u,x)=>k.processCodeAfterIncludes(this.name,u,x):null,processFinalCode:(null==k?void 0:k.processFinalCode)?(u,x)=>k.processFinalCode(this.name,u,x):null,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0}},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(u,x,s=0){for(let U=0;U<this._textureCache.length;U++)if(this._textureCache[U].texture.width===u.width&&this._textureCache[U].texture.height===u.height&&this._textureCache[U].postProcessChannel===s&&this._textureCache[U].texture._generateDepthBuffer===x.generateDepthBuffer&&this._textureCache[U].texture.samples===x.samples)return this._textureCache[U].texture;const U=this._engine.createRenderTargetTexture(u,x);return this._textureCache.push({texture:U,postProcessChannel:s,lastUsedRenderId:-1}),U}_flushTextureCache(){const u=this._renderId;for(let x=this._textureCache.length-1;x>=0;x--)if(u-this._textureCache[x].lastUsedRenderId>100){let u=!1;for(let s=0;s<this._textures.length;s++)if(this._textures.data[s]===this._textureCache[x].texture){u=!0;break}u||(this._textureCache[x].texture.dispose(),this._textureCache.splice(x,1))}}resize(u,x,s=null,U=!1,_=!1){this._textures.length>0&&this._textures.reset(),this.width=u,this.height=x;let W=null;if(s)for(let u=0;u<s._postProcesses.length;u++)if(null!==s._postProcesses[u]){W=s._postProcesses[u];break}const c={width:this.width,height:this.height},I={generateMipMaps:U,generateDepthBuffer:_||W===this,generateStencilBuffer:(_||W===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(c,I,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(c,I,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let u;if(this._shareOutputWithPostProcess)u=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)u=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let x;u=this.inputTexture;for(let s=0;s<this._textureCache.length;s++)if(this._textureCache[s].texture===u){x=this._textureCache[s];break}x&&(x.lastUsedRenderId=this._renderId)}return u}activate(u,x=null,s){var U,_;const W=(u=u||this._camera).getScene(),c=W.getEngine(),I=c.getCaps().maxTextureSize,L=(x?x.width:this._engine.getRenderWidth(!0))*this._options|0,J=(x?x.height:this._engine.getRenderHeight(!0))*this._options|0;let k=this._options.width||L,i=this._options.height||J;const d=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let r=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const u=c.currentViewport;u&&(k*=u.width,i*=u.height)}(d||this.alwaysForcePOT)&&(this._options.width||(k=c.needPOTTextures?j.R(k,I,this.scaleMode):k),this._options.height||(i=c.needPOTTextures?j.R(i,I,this.scaleMode):i)),this.width===k&&this.height===i&&(r=this._getTarget())||this.resize(k,i,u,d,s),this._textures.forEach((u=>{u.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(u,this.samples)})),this._flushTextureCache(),this._renderId++}return r||(r=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(L/k,J/i),this._engine.bindFramebuffer(r,0,L,J,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(r,0,void 0,void 0,this.forceFullscreenViewport)),null===(_=(U=this._engine)._debugInsertMarker)||void 0===_||_.call(U,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(u),this.autoClear&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:W.clearColor,W._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),r}get isSupported(){return this._drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){var u,x;return null!==(x=null===(u=this._drawWrapper.effect)||void 0===u?void 0:u.isReady())&&void 0!==x&&x}apply(){var u,x,s;if(!(null===(u=this._drawWrapper.effect)||void 0===u?void 0:u.isReady()))return null;let U;return this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),U=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",null==U?void 0:U.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),null===(s=null===(x=r._GetShaderCodeProcessing(this.name))||void 0===x?void 0:x.bindCustomBindings)||void 0===s||s.call(x,this.name,this._drawWrapper.effect),this._drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let u=this._textureCache.length-1;u>=0;u--)this._textureCache[u].texture.dispose();this._textureCache.length=0}setPrePassRenderer(u){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=u.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(u){let x;if(u=u||this._camera,this._disposeTextures(),this._scene&&(x=this._scene.postProcesses.indexOf(this),-1!==x&&this._scene.postProcesses.splice(x,1)),this._parentContainer){const u=this._parentContainer.postProcesses.indexOf(this);u>-1&&this._parentContainer.postProcesses.splice(u,1),this._parentContainer=null}if(x=this._engine.postProcesses.indexOf(this),-1!==x&&this._engine.postProcesses.splice(x,1),u){if(u.detachPostProcess(this),x=u._postProcesses.indexOf(this),0===x&&u._postProcesses.length>0){const u=this._camera._getFirstPostProcess();u&&u.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const u=J.p.Serialize(this),x=this.getCamera()||this._scene&&this._scene.activeCamera;return u.customType="BABYLON."+this.getClassName(),u.cameraId=x?x.id:null,u.reusable=this._reusable,u.textureType=this._textureType,u.fragmentUrl=this._fragmentUrl,u.parameters=this._parameters,u.samplers=this._samplers,u.options=this._options,u.defines=this._postProcessDefines,u.textureFormat=this._textureFormat,u.vertexUrl=this._vertexUrl,u.indexParameters=this._indexParameters,u}clone(){const u=this.serialize();u._engine=this._engine,u.cameraId=null;const x=r.Parse(u,this._scene,"");return x?(x.onActivateObservable=this.onActivateObservable.clone(),x.onSizeChangedObservable=this.onSizeChangedObservable.clone(),x.onApplyObservable=this.onApplyObservable.clone(),x.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),x.onAfterRenderObservable=this.onAfterRenderObservable.clone(),x._prePassEffectConfiguration=this._prePassEffectConfiguration,x):null}static Parse(u,x,s){const U=k.n9(u.customType);if(!U||!U._Parse)return null;const _=x?x.getCameraById(u.cameraId):null;return U._Parse(u,_,x,s)}static _Parse(u,x,s,U){return J.p.Parse((()=>new r(u.name,u.fragmentUrl,u.parameters,u.samplers,u.options,x,u.renderTargetSamplingMode,u._engine,u.reusable,u.defines,u.textureType,u.vertexUrl,u.indexParameters,!1,u.textureFormat)),u,s,U)}}r.ForceGLSL=!1,r._CustomShaderCodeProcessing={},U.Cg([L.lK()],r.prototype,"uniqueId",void 0),U.Cg([L.lK()],r.prototype,"name",void 0),U.Cg([L.lK()],r.prototype,"width",void 0),U.Cg([L.lK()],r.prototype,"height",void 0),U.Cg([L.lK()],r.prototype,"renderTargetSamplingMode",void 0),U.Cg([L.qK()],r.prototype,"clearColor",void 0),U.Cg([L.lK()],r.prototype,"autoClear",void 0),U.Cg([L.lK()],r.prototype,"forceAutoClearInAlphaMode",void 0),U.Cg([L.lK()],r.prototype,"alphaMode",void 0),U.Cg([L.lK()],r.prototype,"alphaConstants",void 0),U.Cg([L.lK()],r.prototype,"enablePixelPerfectMode",void 0),U.Cg([L.lK()],r.prototype,"forceFullscreenViewport",void 0),U.Cg([L.lK()],r.prototype,"scaleMode",void 0),U.Cg([L.lK()],r.prototype,"alwaysForcePOT",void 0),U.Cg([L.lK("samples")],r.prototype,"_samples",void 0),U.Cg([L.lK()],r.prototype,"adaptScaleToCurrentViewport",void 0),k.Y5("BABYLON.PostProcess",r)},848287:(u,x,s)=>{s.d(x,{X:()=>W});var U=s(23987),_=s(638113);class W{constructor(u){this._vertexBuffers={},this.onBeforeRenderObservable=new _.cP,this._scene=u}_prepareBuffers(){if(this._vertexBuffers[U.R.PositionKind])return;const u=[];u.push(1,1),u.push(-1,1),u.push(-1,-1),u.push(1,-1),this._vertexBuffers[U.R.PositionKind]=new U.R(this._scene.getEngine(),u,U.R.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const u=[];u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(u)}_rebuild(){const u=this._vertexBuffers[U.R.PositionKind];u&&(u._rebuild(),this._buildIndexBuffer())}_prepareFrame(u=null,x=null){const s=this._scene.activeCamera;return!(!s||!(x=x||s._postProcesses.filter((u=>null!=u)))||0===x.length||!this._scene.postProcessesEnabled||(x[0].activate(s,u,null!=x),0))}directRender(u,x=null,s=!1,U=0,_=0,W=!1){var c;const I=this._scene.getEngine();for(let L=0;L<u.length;L++){L<u.length-1?u[L+1].activate(this._scene.activeCamera,null==x?void 0:x.texture):(x?I.bindFramebuffer(x,U,void 0,void 0,s,_):W||I.restoreDefaultFramebuffer(),null===(c=I._debugInsertMarker)||void 0===c||c.call(I,`post process ${u[L].name} output`));const J=u[L],k=J.apply();k&&(J.onBeforeRenderObservable.notifyObservers(k),this._prepareBuffers(),I.bindBuffers(this._vertexBuffers,this._indexBuffer,k),I.drawElementsType(0,0,6),J.onAfterRenderObservable.notifyObservers(k))}I.setDepthBuffer(!0),I.setDepthWrite(!0)}_finalizeFrame(u,x,s,U,_=!1){var W;const c=this._scene.activeCamera;if(!c)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(U=U||c._postProcesses.filter((u=>null!=u))).length||!this._scene.postProcessesEnabled)return;const I=this._scene.getEngine();for(let L=0,J=U.length;L<J;L++){const k=U[L];if(L<J-1?k._outputTexture=U[L+1].activate(c,null==x?void 0:x.texture):(x?(I.bindFramebuffer(x,s,void 0,void 0,_),k._outputTexture=x):(I.restoreDefaultFramebuffer(),k._outputTexture=null),null===(W=I._debugInsertMarker)||void 0===W||W.call(I,`post process ${U[L].name} output`)),u)break;const i=k.apply();i&&(k.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),I.bindBuffers(this._vertexBuffers,this._indexBuffer,i),I.drawElementsType(0,0,6),k.onAfterRenderObservable.notifyObservers(i))}I.setDepthBuffer(!0),I.setDepthWrite(!0),I.setAlphaMode(0)}dispose(){const u=this._vertexBuffers[U.R.PositionKind];u&&(u.dispose(),this._vertexBuffers[U.R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},293940:(u,x,s)=>{s.d(x,{a:()=>J});var U=s(297809),_=s(760998),W=s(337776),c=s(888413),I=s(604910),L=s(837475);L.d.prototype.removeReflectionProbe=function(u){if(!this.reflectionProbes)return-1;const x=this.reflectionProbes.indexOf(u);return-1!==x&&this.reflectionProbes.splice(x,1),x},L.d.prototype.addReflectionProbe=function(u){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(u)};class J{constructor(u,x,s,U=!0,_=!1,W=!1){if(this.name=u,this._viewMatrix=I.uq.Identity(),this._target=I.Pq.Zero(),this._add=I.Pq.Zero(),this._invertYAxis=!1,this.position=I.Pq.Zero(),this.metadata=null,this._parentContainer=null,this._scene=s,s.getEngine().supportsUniformBuffers){this._sceneUBOs=[];for(let x=0;x<6;++x)this._sceneUBOs.push(s.createSceneUniformBuffer(`Scene for Reflection Probe (name "${u}") face #${x}`))}this._scene.reflectionProbes||(this._scene.reflectionProbes=[]),this._scene.reflectionProbes.push(this);let L=0;if(_){const u=this._scene.getEngine().getCaps();u.textureHalfFloatRender?L=2:u.textureFloatRender&&(L=1)}this._renderTargetTexture=new c.$(u,x,s,U,!0,L,!0),this._renderTargetTexture.gammaSpace=!W,this._renderTargetTexture.invertZ=s.useRightHandedSystem;const J=s.getEngine().useReverseDepthBuffer;let k;this._renderTargetTexture.onBeforeRenderObservable.add((u=>{switch(this._sceneUBOs&&(s.setSceneUniformBuffer(this._sceneUBOs[u]),s.getSceneUniformBuffer().unbindEffect()),u){case 0:this._add.copyFromFloats(1,0,0);break;case 1:this._add.copyFromFloats(-1,0,0);break;case 2:this._add.copyFromFloats(0,this._invertYAxis?1:-1,0);break;case 3:this._add.copyFromFloats(0,this._invertYAxis?-1:1,0);break;case 4:this._add.copyFromFloats(0,0,s.useRightHandedSystem?-1:1);break;case 5:this._add.copyFromFloats(0,0,s.useRightHandedSystem?1:-1)}this._attachedMesh&&this.position.copyFrom(this._attachedMesh.getAbsolutePosition()),this.position.addToRef(this._add,this._target);const x=s.useRightHandedSystem?I.uq.LookAtRHToRef:I.uq.LookAtLHToRef,U=s.useRightHandedSystem?I.uq.PerspectiveFovRH:I.uq.PerspectiveFovLH;x(this.position,this._target,I.Pq.Up(),this._viewMatrix),s.activeCamera&&(this._projectionMatrix=U(Math.PI/2,1,J?s.activeCamera.maxZ:s.activeCamera.minZ,J?s.activeCamera.minZ:s.activeCamera.maxZ,this._scene.getEngine().isNDCHalfZRange),s.setTransformMatrix(this._viewMatrix,this._projectionMatrix),s.activeCamera.isRigCamera&&!this._renderTargetTexture.activeCamera&&(this._renderTargetTexture.activeCamera=s.activeCamera.rigParent||null)),s._forcedViewPosition=this.position})),this._renderTargetTexture.onBeforeBindObservable.add((()=>{var x,U;this._currentSceneUBO=s.getSceneUniformBuffer(),null===(U=(x=s.getEngine())._debugPushGroup)||void 0===U||U.call(x,`reflection probe generation for ${u}`,1),k=this._scene.imageProcessingConfiguration.applyByPostProcess,W&&(s.imageProcessingConfiguration.applyByPostProcess=!0)})),this._renderTargetTexture.onAfterUnbindObservable.add((()=>{var u,x;s.imageProcessingConfiguration.applyByPostProcess=k,s._forcedViewPosition=null,this._sceneUBOs&&s.setSceneUniformBuffer(this._currentSceneUBO),s.updateTransformMatrix(!0),null===(x=(u=s.getEngine())._debugPopGroup)||void 0===x||x.call(u,1)}))}get samples(){return this._renderTargetTexture.samples}set samples(u){this._renderTargetTexture.samples=u}get refreshRate(){return this._renderTargetTexture.refreshRate}set refreshRate(u){this._renderTargetTexture.refreshRate=u}getScene(){return this._scene}get cubeTexture(){return this._renderTargetTexture}get renderList(){return this._renderTargetTexture.renderList}set renderList(u){this._renderTargetTexture.renderList=u}attachToMesh(u){this._attachedMesh=u}setRenderingAutoClearDepthStencil(u,x){this._renderTargetTexture.setRenderingAutoClearDepthStencil(u,x)}dispose(){const u=this._scene.reflectionProbes.indexOf(this);if(-1!==u&&this._scene.reflectionProbes.splice(u,1),this._parentContainer){const u=this._parentContainer.reflectionProbes.indexOf(this);u>-1&&this._parentContainer.reflectionProbes.splice(u,1),this._parentContainer=null}if(this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null),this._sceneUBOs){for(const u of this._sceneUBOs)u.dispose();this._sceneUBOs=[]}}toString(u){let x="Name: "+this.name;return u&&(x+=", position: "+this.position.toString(),this._attachedMesh&&(x+=", attached mesh: "+this._attachedMesh.name)),x}getClassName(){return"ReflectionProbe"}serialize(){const u=W.p.Serialize(this,this._renderTargetTexture.serialize());return u.isReflectionProbe=!0,u.metadata=this.metadata,u}static Parse(u,x,s){let U=null;if(x.reflectionProbes)for(let s=0;s<x.reflectionProbes.length;s++){const _=x.reflectionProbes[s];if(_.name===u.name){U=_;break}}return U=W.p.Parse((()=>U||new J(u.name,u.renderTargetSize,x,u._generateMipMaps)),u,x,s),U.cubeTexture._waitingRenderList=u.renderList,u._attachedMesh&&U.attachToMesh(x.getMeshById(u._attachedMesh)),u.metadata&&(U.metadata=u.metadata),U}}U.Cg([_.xG()],J.prototype,"_attachedMesh",void 0),U.Cg([_.P_()],J.prototype,"position",void 0)},636544:(u,x,s)=>{s.d(x,{d:()=>d});var U=s(332290),_=s(23987),W=s(432050),c=s(888413),I=s(564135),L=(s(823143),s(506740),s(554014)),J=s(651577),k=s(855300),i=s(522208);class d{get shaderLanguage(){return this._shaderLanguage}setMaterialForRendering(u,x){this._depthMap.setMaterialForRendering(u,x)}constructor(u,x=1,s=null,_=!1,L=W.g.TRILINEAR_SAMPLINGMODE,i=!1,j){this._shaderLanguage=0,this.enabled=!0,this.forceDepthWriteTransparentMeshes=!1,this.useOnlyInActiveCamera=!1,this.reverseCulling=!1,this._shadersLoaded=!1,this._scene=u,this._storeNonLinearDepth=_,this._storeCameraSpaceZ=i,this.isPacked=0===x,this.isPacked?this.clearColor=new U.ov(1,1,1,1):this.clearColor=new U.ov(i?1e8:1,0,0,1),this._initShaderSourceAsync(),d._SceneComponentInitialization(this._scene);const r=u.getEngine();this._camera=s,L!==W.g.NEAREST_SAMPLINGMODE&&(1!==x||r._caps.textureFloatLinearFiltering||(L=W.g.NEAREST_SAMPLINGMODE),2!==x||r._caps.textureHalfFloatLinearFiltering||(L=W.g.NEAREST_SAMPLINGMODE));const D=this.isPacked||!r._features.supportExtendedTextureFormats?5:6;this._depthMap=new c.$(null!=j?j:"DepthRenderer",{width:r.getRenderWidth(),height:r.getRenderHeight()},this._scene,!1,!0,x,!1,L,void 0,void 0,void 0,D),this._depthMap.wrapU=W.g.CLAMP_ADDRESSMODE,this._depthMap.wrapV=W.g.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.noPrePassRenderer=!0,this._depthMap.activeCamera=this._camera,this._depthMap.ignoreCameraViewport=!0,this._depthMap.useCameraPostProcesses=!1,this._depthMap.onClearObservable.add((u=>{u.clear(this.clearColor,!0,!0,!0)})),this._depthMap.onBeforeBindObservable.add((()=>{var u;null===(u=r._debugPushGroup)||void 0===u||u.call(r,"depth renderer",1)})),this._depthMap.onAfterUnbindObservable.add((()=>{var u;null===(u=r._debugPopGroup)||void 0===u||u.call(r,1)})),this._depthMap.customIsReadyFunction=(u,x,s)=>{if((s||0===x)&&u.subMeshes)for(let x=0;x<u.subMeshes.length;++x){const s=u.subMeshes[x],U=s.getRenderingMesh(),_=U._getInstancesRenderList(s._id,!!s.getReplacementMesh()),W=r.getCaps().instancedArrays&&(null!==_.visibleInstances[s._id]&&void 0!==_.visibleInstances[s._id]||U.hasThinInstances);if(!this.isReady(s,W))return!1}return!0};const $=u=>{var x;const s=u.getRenderingMesh(),U=u.getEffectiveMesh(),_=this._scene,W=_.getEngine(),c=u.getMaterial();if(U._internalAbstractMeshDataInfo._isActiveIntermediate=!1,!c||U.infiniteDistance||c.disableDepthWrite||0===u.verticesCount||u._renderId===_.getRenderId())return;const L=U._getWorldMatrixDeterminant()<0;let i=c._getEffectiveOrientation(s);L&&(i=0===i?1:0);const d=0===i;W.setState(c.backFaceCulling,0,!1,d,this.reverseCulling?!c.cullBackFaces:c.cullBackFaces);const j=s._getInstancesRenderList(u._id,!!u.getReplacementMesh());if(j.mustReturn)return;const r=W.getCaps().instancedArrays&&(null!==j.visibleInstances[u._id]&&void 0!==j.visibleInstances[u._id]||s.hasThinInstances),D=this._camera||_.activeCamera;if(this.isReady(u,r)&&D){u._renderId=_.getRenderId();const L=null===(x=U._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===x?void 0:x[W.currentRenderPassId];let i=u._getDrawWrapper();!i&&L&&(i=L._getDrawWrapper());const d=D.mode===I.i.ORTHOGRAPHIC_CAMERA;if(!i)return;const $=i.effect;let H,f;if(W.enableEffect(i),r||s._bind(u,$,c.fillMode),L?L.bindForSubMesh(U.getWorldMatrix(),U,u):($.setMatrix("viewProjection",_.getTransformMatrix()),$.setMatrix("world",U.getWorldMatrix()),this._storeCameraSpaceZ&&$.setMatrix("view",_.getViewMatrix())),d?(H=!W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:1,f=W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:1):(H=W.useReverseDepthBuffer&&W.isNDCHalfZRange?D.minZ:W.isNDCHalfZRange?0:D.minZ,f=W.useReverseDepthBuffer&&W.isNDCHalfZRange?0:D.maxZ),$.setFloat2("depthValues",H,H+f),!L){if(c.needAlphaTesting()){const u=c.getAlphaTestTexture();u&&($.setTexture("diffuseSampler",u),$.setMatrix("diffuseMatrix",u.getTextureMatrix()))}k.f$(s,$),J.gS($,c,_),k.nR(s,$),s.morphTargetManager&&s.morphTargetManager.isUsingTextureForTargets&&s.morphTargetManager._bind($);const x=u.getMesh().bakedVertexAnimationManager;x&&x.isEnabled&&x.bind($,r),c.pointsCloud&&$.setFloat("pointSize",c.pointSize)}s._processRendering(U,u,$,c.fillMode,j,r,((u,x)=>$.setMatrix("world",x)))}};this._depthMap.customRenderFunction=(u,x,s,U)=>{let _;if(U.length)for(_=0;_<U.length;_++)$(U.data[_]);for(_=0;_<u.length;_++)$(u.data[_]);for(_=0;_<x.length;_++)$(x.data[_]);if(this.forceDepthWriteTransparentMeshes)for(_=0;_<s.length;_++)$(s.data[_]);else for(_=0;_<s.length;_++)s.data[_].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=!1}}async _initShaderSourceAsync(u=!1){!this._scene.getEngine().isWebGPU||u||d.ForceGLSL?await Promise.all([Promise.resolve().then(s.bind(s,506740)),Promise.resolve().then(s.bind(s,823143))]):(this._shaderLanguage=1,await Promise.all([s.e(96838).then(s.bind(s,196838)),s.e(76488).then(s.bind(s,176488))])),this._shadersLoaded=!0}isReady(u,x){var s;if(!this._shadersLoaded)return!1;const U=this._scene.getEngine(),W=u.getMesh(),c=W.getScene(),I=null===(s=W._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===s?void 0:s[U.currentRenderPassId];if(I)return I.isReadyForSubMesh(W,u,x);const L=u.getMaterial();if(!L||L.disableDepthWrite)return!1;const d=[],j=[_.R.PositionKind];L.needAlphaTesting()&&L.getAlphaTestTexture()&&(d.push("#define ALPHATEST"),W.isVerticesDataPresent(_.R.UVKind)&&(j.push(_.R.UVKind),d.push("#define UV1")),W.isVerticesDataPresent(_.R.UV2Kind)&&(j.push(_.R.UV2Kind),d.push("#define UV2")));const r=new i.J;if(W.useBones&&W.computeBonesUsingShaders&&W.skeleton){j.push(_.R.MatricesIndicesKind),j.push(_.R.MatricesWeightsKind),W.numBoneInfluencers>4&&(j.push(_.R.MatricesIndicesExtraKind),j.push(_.R.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+W.numBoneInfluencers),W.numBoneInfluencers>0&&r.addCPUSkinningFallback(0,W);const u=W.skeleton;u.isUsingTextureForMatrices?d.push("#define BONETEXTURE"):d.push("#define BonesPerMesh "+(u.bones.length+1))}else d.push("#define NUM_BONE_INFLUENCERS 0");const D=W.morphTargetManager;let $=0;D&&($=D.numMaxInfluencers||D.numInfluencers,$>0&&(d.push("#define MORPHTARGETS"),d.push("#define NUM_MORPH_INFLUENCERS "+$),D.isUsingTextureForTargets&&d.push("#define MORPHTARGETS_TEXTURE"),k.MF(j,W,$))),L.pointsCloud&&d.push("#define POINTSIZE"),x&&(d.push("#define INSTANCES"),k.te(j),u.getRenderingMesh().hasThinInstances&&d.push("#define THIN_INSTANCES"));const H=W.bakedVertexAnimationManager;H&&H.isEnabled&&(d.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),x&&j.push("bakedVertexAnimationSettingsInstanced")),this._storeNonLinearDepth&&d.push("#define NONLINEARDEPTH"),this._storeCameraSpaceZ&&d.push("#define STORE_CAMERASPACE_Z"),this.isPacked&&d.push("#define PACKED"),J.tv(L,c,d);const f=u._getDrawWrapper(void 0,!0),O=f.defines,t=d.join("\n");if(O!==t){const u=["world","mBones","boneTextureWidth","pointSize","viewProjection","view","diffuseMatrix","depthValues","morphTargetInfluences","morphTargetCount","morphTargetTextureInfo","morphTargetTextureIndices","bakedVertexAnimationSettings","bakedVertexAnimationTextureSizeInverted","bakedVertexAnimationTime","bakedVertexAnimationTexture"],x=["diffuseSampler","morphTargets","boneSampler","bakedVertexAnimationTexture"];J.TV(u),f.setEffect(U.createEffect("depth",{attributes:j,uniformsNames:u,uniformBuffersNames:[],samplers:x,defines:t,fallbacks:r,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:$},shaderLanguage:this._shaderLanguage},U))}return f.effect.isReady()}getDepthMap(){return this._depthMap}dispose(){const u=[];for(const x in this._scene._depthRenderer)this._scene._depthRenderer[x]===this&&u.push(x);if(u.length>0){this._depthMap.dispose();for(const x of u)delete this._scene._depthRenderer[x]}}}d.ForceGLSL=!1,d._SceneComponentInitialization=u=>{throw L.n("DepthRendererSceneComponent")}},267255:(u,x,s)=>{s.d(x,{U:()=>W});var U=s(293506),_=s(604910);class W{set opaqueSortCompareFn(u){this._opaqueSortCompareFn=u||W.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(u){this._alphaTestSortCompareFn=u||W.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(u){this._transparentSortCompareFn=u||W.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(u,x,s=null,_=null,W=null){this.index=u,this._opaqueSubMeshes=new U.L(256),this._transparentSubMeshes=new U.L(256),this._alphaTestSubMeshes=new U.L(256),this._depthOnlySubMeshes=new U.L(256),this._particleSystems=new U.L(256),this._spriteManagers=new U.L(256),this._empty=!0,this._edgesRenderers=new U.b(16),this._scene=x,this.opaqueSortCompareFn=s,this.alphaTestSortCompareFn=_,this.transparentSortCompareFn=W}render(u,x,s,U){if(u)return void u(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const _=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(_.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),_.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const W=_.getStencilBuffer();if(_.setStencilBuffer(!1),x&&this._renderSprites(),s&&this._renderParticles(U),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(_.setStencilBuffer(W),this._scene.useOrderIndependentTransparency){const u=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);u.length&&this._renderTransparent(u)}else this._renderTransparent(this._transparentSubMeshes);_.setAlphaMode(0)}if(_.setStencilBuffer(!1),this._edgesRenderers.length){for(let u=0;u<this._edgesRenderers.length;u++)this._edgesRenderers.data[u].render();_.setAlphaMode(0)}_.setStencilBuffer(W)}_renderOpaqueSorted(u){W._RenderSorted(u,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(u){W._RenderSorted(u,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(u){W._RenderSorted(u,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(u,x,s,U){let c,I=0;const L=s?s.globalPosition:W._ZeroVector;if(U)for(;I<u.length;I++)c=u.data[I],c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=_.Pq.Distance(c.getBoundingInfo().boundingSphere.centerWorld,L);const J=u.length===u.data.length?u.data:u.data.slice(0,u.length);x&&J.sort(x);const k=J[0].getMesh().getScene();for(I=0;I<J.length;I++)if(c=J[I],!k._activeMeshesFrozenButKeepClipping||c.isInFrustum(k._frustumPlanes)){if(U){const u=c.getMaterial();if(u&&u.needDepthPrePass){const x=u.getScene().getEngine();x.setColorWrite(!1),x.setAlphaMode(0),c.render(!1),x.setColorWrite(!0)}}c.render(U)}}static defaultTransparentSortCompare(u,x){return u._alphaIndex>x._alphaIndex?1:u._alphaIndex<x._alphaIndex?-1:W.backToFrontSortCompare(u,x)}static backToFrontSortCompare(u,x){return u._distanceToCamera<x._distanceToCamera?1:u._distanceToCamera>x._distanceToCamera?-1:0}static frontToBackSortCompare(u,x){return u._distanceToCamera<x._distanceToCamera?-1:u._distanceToCamera>x._distanceToCamera?1:0}static PainterSortCompare(u,x){const s=u.getMesh(),U=x.getMesh();return s.material&&U.material?s.material.uniqueId-U.material.uniqueId:s.uniqueId-U.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(u,x,s){void 0===x&&(x=u.getMesh()),void 0===s&&(s=u.getMaterial()),null!=s&&(s.needAlphaBlendingForMesh(x)?this._transparentSubMeshes.push(u):s.needAlphaTesting()?(s.needDepthPrePass&&this._depthOnlySubMeshes.push(u),this._alphaTestSubMeshes.push(u)):(s.needDepthPrePass&&this._depthOnlySubMeshes.push(u),this._opaqueSubMeshes.push(u)),x._renderingGroup=this,x._edgesRenderer&&x.isEnabled()&&x.isVisible&&x._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(x._edgesRenderer),this._empty=!1)}dispatchSprites(u){this._spriteManagers.push(u),this._empty=!1}dispatchParticles(u){this._particleSystems.push(u),this._empty=!1}_renderParticles(u){if(0===this._particleSystems.length)return;const x=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let s=0;s<this._particleSystems.length;s++){const U=this._particleSystems.data[s];if(0===(x&&x.layerMask&U.layerMask))continue;const _=U.emitter;_.position&&u&&-1===u.indexOf(_)||this._scene._activeParticles.addCount(U.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const u=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let x=0;x<this._spriteManagers.length;x++){const s=this._spriteManagers.data[x];0!==(u&&u.layerMask&s.layerMask)&&s.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}W._ZeroVector=_.Pq.Zero()},809319:(u,x,s)=>{s.d(x,{m:()=>W,o:()=>_});var U=s(267255);class _{}class W{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(u){u!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=u,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const u of this._scene.meshes)if(u.subMeshes)for(const x of u.subMeshes)x._wasDispatched=!1;if(this._scene.spriteManagers)for(const u of this._scene.spriteManagers)u._wasDispatched=!1;for(const u of this._scene.particleSystems)u._wasDispatched=!1}constructor(u){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new _,this._maintainStateBetweenFrames=!1,this._scene=u;for(let u=W.MIN_RENDERINGGROUPS;u<W.MAX_RENDERINGGROUPS;u++)this._autoClearDepthStencil[u]={autoClear:!0,depth:!0,stencil:!0}}getRenderingGroup(u){const x=u||0;return this._prepareRenderingGroup(x),this._renderingGroups[x]}_clearDepthStencilBuffer(u=!0,x=!0){this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,u,x),this._depthStencilBufferAlreadyCleaned=!0)}render(u,x,s,U){const _=this._renderingGroupInfo;if(_.scene=this._scene,_.camera=this._scene.activeCamera,this._scene.spriteManagers&&U)for(let u=0;u<this._scene.spriteManagers.length;u++){const x=this._scene.spriteManagers[u];this.dispatchSprites(x)}for(let c=W.MIN_RENDERINGGROUPS;c<W.MAX_RENDERINGGROUPS;c++){this._depthStencilBufferAlreadyCleaned=c===W.MIN_RENDERINGGROUPS;const I=this._renderingGroups[c];if(!I||I._empty)continue;const L=1<<c;if(_.renderingGroupId=c,this._scene.onBeforeRenderingGroupObservable.notifyObservers(_,L),W.AUTOCLEAR){const u=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(c):this._autoClearDepthStencil[c];u&&u.autoClear&&this._clearDepthStencilBuffer(u.depth,u.stencil)}for(const u of this._scene._beforeRenderingGroupDrawStage)u.action(c);I.render(u,U,s,x);for(const u of this._scene._afterRenderingGroupDrawStage)u.action(c);this._scene.onAfterRenderingGroupObservable.notifyObservers(_,L)}}reset(){if(!this.maintainStateBetweenFrames)for(let u=W.MIN_RENDERINGGROUPS;u<W.MAX_RENDERINGGROUPS;u++){const x=this._renderingGroups[u];x&&x.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let u=W.MIN_RENDERINGGROUPS;u<W.MAX_RENDERINGGROUPS;u++){const x=this._renderingGroups[u];x&&x.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let u=W.MIN_RENDERINGGROUPS;u<W.MAX_RENDERINGGROUPS;u++){const x=this._renderingGroups[u];x&&x.dispose()}}_prepareRenderingGroup(u){void 0===this._renderingGroups[u]&&(this._renderingGroups[u]=new U.U(u,this._scene,this._customOpaqueSortCompareFn[u],this._customAlphaTestSortCompareFn[u],this._customTransparentSortCompareFn[u]))}dispatchSprites(u){this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatchSprites(u))}dispatchParticles(u){this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatchParticles(u))}dispatch(u,x,s){void 0===x&&(x=u.getMesh()),this.maintainStateBetweenFrames&&u._wasDispatched||(u._wasDispatched=!0,this.getRenderingGroup(x.renderingGroupId).dispatch(u,x,s))}setRenderingOrder(u,x=null,s=null,U=null){if(this._customOpaqueSortCompareFn[u]=x,this._customAlphaTestSortCompareFn[u]=s,this._customTransparentSortCompareFn[u]=U,this._renderingGroups[u]){const x=this._renderingGroups[u];x.opaqueSortCompareFn=this._customOpaqueSortCompareFn[u],x.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[u],x.transparentSortCompareFn=this._customTransparentSortCompareFn[u]}}setRenderingAutoClearDepthStencil(u,x,s=!0,U=!0){this._autoClearDepthStencil[u]={autoClear:x,depth:s,stencil:U}}getAutoClearDepthStencilSetup(u){return this._autoClearDepthStencil[u]}}W.MAX_RENDERINGGROUPS=4,W.MIN_RENDERINGGROUPS=0,W.AUTOCLEAR=!0},243806:(u,x,s)=>{const U=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;}\n#endif\n`;s(395879).l.IncludesShadersStore["bakedVertexAnimation"]=U},191544:(u,x,s)=>{const U=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}\n#endif\n`;s(395879).l.IncludesShadersStore["bakedVertexAnimationDeclaration"]=U},17106:(u,x,s)=>{s.r(x),s.d(x,{bonesDeclaration:()=>W});const U="bonesDeclaration",_=`#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;attribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform highp sampler2D boneSampler;uniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#endif\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}\n#endif\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},132434:(u,x,s)=>{s.r(x),s.d(x,{bonesVertex:()=>W});const U="bonesVertex",_=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},215327:(u,x,s)=>{s.r(x),s.d(x,{clipPlaneFragment:()=>W});const U="clipPlaneFragment",_=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},733251:(u,x,s)=>{s.r(x),s.d(x,{clipPlaneFragmentDeclaration:()=>W});const U="clipPlaneFragmentDeclaration",_=`#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},929801:(u,x,s)=>{s.r(x),s.d(x,{clipPlaneVertex:()=>W});const U="clipPlaneVertex",_=`#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},602105:(u,x,s)=>{s.r(x),s.d(x,{clipPlaneVertexDeclaration:()=>W});const U="clipPlaneVertexDeclaration",_=`#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},512591:(u,x,s)=>{const U=`#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n`;s(395879).l.IncludesShadersStore["fogFragment"]=U},684371:(u,x,s)=>{s.r(x),s.d(x,{fogFragmentDeclaration:()=>W});const U="fogFragmentDeclaration",_=`#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},789433:(u,x,s)=>{const U=`#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n`;s(395879).l.IncludesShadersStore["fogVertex"]=U},162441:(u,x,s)=>{const U=`#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n`;s(395879).l.IncludesShadersStore["fogVertexDeclaration"]=U},489974:(u,x,s)=>{const U=`#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfloat radicalInverse_VdC(uint bits) \n{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }\nvec2 hammersley(uint i,uint N)\n{return vec2(float(i)/float(N),radicalInverse_VdC(i));}\n#else\nfloat vanDerCorpus(int n,int base)\n{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)\n{if(n>0)\n{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}\nreturn result;}\nvec2 hammersley(int i,int N)\n{return vec2(float(i)/float(N),vanDerCorpus(i,2));}\n#endif\nfloat log4(float x) {return log2(x)/2.;}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;}}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; \nif (alphaG==0.) {\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;}}\nresult=result/weight;return result;}}\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore["hdrFilteringFunctions"]=U},485914:(u,x,s)=>{s.r(x),s.d(x,{helperFunctions:()=>W});const U="helperFunctions",_=`const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},543881:(u,x,s)=>{const U=`#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n`;s(395879).l.IncludesShadersStore["imageProcessingCompatibility"]=U},368668:(u,x,s)=>{const U=`vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}`;s(395879).l.IncludesShadersStore["importanceSampling"]=U},427139:(u,x,s)=>{const U=`#ifdef INSTANCES\nattribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)\nattribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)\nuniform mat4 previousWorld;\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore["instancesDeclaration"]=U},216313:(u,x,s)=>{const U=`#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,\npreviousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore["instancesVertex"]=U},109259:(u,x,s)=>{s.r(x),s.d(x,{lightFragment:()=>W});const U="lightFragment",_=`#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\nvec4 diffuse{X}=light{X}.vLightDiffuse;\n#define CUSTOM_LIGHT{X}_COLOR \n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,diffuse{X}.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,diffuse{X}.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,diffuse{X}.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,diffuse{X}.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,diffuse{X}.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,diffuse{X}.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},textureProjectionMatrix{X},vPositionW);\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {index{X}=i;break;}}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{index{X}+=1;float nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;shadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\naggShadow+=shadow;numLights+=1.0;\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},849399:(u,x,s)=>{s.r(x),s.d(x,{lightFragmentDeclaration:()=>W});const U="lightFragmentDeclaration",_=`#ifdef LIGHT{X}\nuniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X};\n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},946159:(u,x,s)=>{s.r(x),s.d(x,{lightUboDeclaration:()=>W});const U="lightUboDeclaration",_=`#ifdef LIGHT{X}\nuniform Light{X}\n{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;vec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;vec2 depthValues;} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowTexture{X};\n#else\nuniform highp sampler2DArray shadowTexture{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);vec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowTexture{X}; \n#else\nvarying vec4 vPositionFromLight{X};varying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowTexture{X};\n#else\nuniform sampler2D shadowTexture{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},149137:(u,x,s)=>{s.r(x),s.d(x,{lightsFragmentFunctions:()=>W});const U="lightsFragmentFunctions",_=`struct lightingInfo\n{vec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 lightVectorW;float attenuation=1.0;if (lightData.w==0.)\n{vec3 direction=lightData.xyz-vPositionW;attenuation=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}\nelse\n{lightVectorW=normalize(-lightData.xyz);}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 direction=lightData.xyz-vPositionW;vec3 lightVectorW=normalize(direction);float attenuation=max(0.,1.0-length(direction)/range);float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)\n{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;float ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {lightingInfo result;float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;\n#endif\nreturn result;}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return textureColor;}`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},577766:(u,x,s)=>{const U=`#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n`;s(395879).l.IncludesShadersStore["logDepthDeclaration"]=U},302064:(u,x,s)=>{const U=`#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n`;s(395879).l.IncludesShadersStore["logDepthFragment"]=U},389886:(u,x,s)=>{const U=`#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n`;s(395879).l.IncludesShadersStore["logDepthVertex"]=U},265917:(u,x,s)=>{s.r(x),s.d(x,{morphTargetsVertex:()=>W});const U="morphTargetsVertex",_=`#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\n#if {X}==0\nfor (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];\n#endif\n}\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},419765:(u,x,s)=>{s.r(x),s.d(x,{morphTargetsVertexDeclaration:()=>W});const U="morphTargetsVertexDeclaration",_=`#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#elif {X}==0\nuniform int morphTargetCount;\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},699110:(u,x,s)=>{s.r(x),s.d(x,{morphTargetsVertexGlobal:()=>W});const U="morphTargetsVertexGlobal",_=`#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},467760:(u,x,s)=>{s.r(x),s.d(x,{morphTargetsVertexGlobalDeclaration:()=>W});const U="morphTargetsVertexGlobalDeclaration",_=`#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},728939:(u,x,s)=>{s.r(x),s.d(x,{packingFunctions:()=>W});const U="packingFunctions",_=`vec4 pack(float depth)\n{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},950544:(u,x,s)=>{const U=`#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}\nfloat getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}\nvec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}\nfloat cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)\n{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}\nreturn max(I,vec3(0.0));}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}\n#endif\n`;s(395879).l.IncludesShadersStore["pbrBRDFFunctions"]=U},875438:(u,x,s)=>{const U=`#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n`;s(395879).l.IncludesShadersStore["pointCloudVertex"]=U},368969:(u,x,s)=>{s.r(x),s.d(x,{shadowsFragmentFunctions:()=>W});const U="shadowsFragmentFunctions",_=`#ifdef SHADOWS\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}\n#define inline\nfloat computeShadowCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;float visibility=1.;vec3 poissonDisk[4];poissonDisk[0]=vec3(-1.0,1.0,-1.0);poissonDisk[1]=vec3(1.0,-1.0,-1.0);poissonDisk[2]=vec3(-1.0,-1.0,-1.0);poissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);}\n#define inline\nfloat computeShadowWithESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);vec3 uvLayer=vec3(uv.x,uv.y,layer);float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);float visibility=1.;vec2 poissonDisk[4];poissonDisk[0]=vec2(-0.94201624,-0.39906216);poissonDisk[1]=vec2(0.94558609,-0.76890725);poissonDisk[2]=vec2(-0.094184101,-0.92938870);poissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\n#else\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{return 1.0;}\nelse\n{float shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define DISABLE_UNIFORMITY_ANALYSIS\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float shadow=texture2D(shadowSampler,uvDepthLayer);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);shadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);shadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);shadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.),\nvec3(0.)\n);const vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec4 offset=vec4(poissonSamplers[i],0.);offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);if (numBlocker<1.0) {return 1.0;}\nelse\n{return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}\nelse\n{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}\nif (numBlocker<1.0) {return 1.0;}\nelse\n{float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec3 offset=poissonSamplers[i];offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);shadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);}\nshadow/=float(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},286564:(u,x,s)=>{s.r(x),s.d(x,{shadowsVertex:()=>W});const U="shadowsVertex",_=`#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n`;s(395879).l.IncludesShadersStore[U]=_;const W={name:U,shader:_}},823143:(u,x,s)=>{s.r(x),s.d(x,{depthPixelShader:()=>c});var U=s(395879);s(733251),s(728939),s(215327);const _="depthPixelShader",W=`#ifdef ALPHATEST\nvarying vec2 vUV;uniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vec4 vViewPos;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\ngl_FragColor=pack(vViewPos.z);\n#else\ngl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}`;U.l.ShadersStore[_]=W;const c={name:_,shader:W}},506740:(u,x,s)=>{s.r(x),s.d(x,{depthVertexShader:()=>I});var U=s(395879);s(17106),s(191544),s(467760),s(419765),s(602105),s(427139);const _=`#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n`;U.l.IncludesShadersStore["pointCloudVertexDeclaration"]=_,s(699110),s(265917),s(216313),s(132434),s(243806),s(929801),s(875438);const W="depthVertexShader",c=`attribute vec3 position;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;uniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;uniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform mat4 view;varying vec4 vViewPos;\n#endif\n#include<pointCloudVertexDeclaration>\nvarying float vDepthMetric;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{vec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#include<clipPlaneVertex>\ngl_Position=viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvViewPos=view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));\n#else\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<pointCloudVertex>\n}\n`;U.l.ShadersStore[W]=c;const I={name:W,shader:c}},90406:(u,x,s)=>{var U=s(395879);s(485914),s(368668),s(950544),s(489974);const _=`#include<helperFunctions>\n#include<importanceSampling>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\nuniform float alphaG;uniform samplerCube inputTexture;uniform vec2 vFilteringInfo;uniform float hdrScale;varying vec3 direction;void main() {vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);gl_FragColor=vec4(color*hdrScale,1.0);}`;U.l.ShadersStore["hdrFilteringPixelShader"]=_},346124:(u,x,s)=>{const U=`attribute vec2 position;varying vec3 direction;uniform vec3 up;uniform vec3 right;uniform vec3 front;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nmat3 view=mat3(up,right,front);direction=view*vec3(position,1.0);gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}`;s(395879).l.ShadersStore["hdrFilteringVertexShader"]=U},330153:(u,x,s)=>{s.r(x),s.d(x,{passPixelShader:()=>W});const U="passPixelShader",_=`varying vec2 vUV;uniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{gl_FragColor=texture2D(textureSampler,vUV);}`;s(395879).l.ShadersStore[U]=_;const W={name:U,shader:_}},310839:(u,x,s)=>{s.r(x),s.d(x,{postprocessVertexShader:()=>W});const U="postprocessVertexShader",_=`attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}`;s(395879).l.ShadersStore[U]=_;const W={name:U,shader:_}},615999:(u,x,s)=>{s.d(x,{k:()=>I});var U=s(604910),_=s(332290),W=s(638113),c=s(602100);class I extends c.X{get size(){return this.width}set size(u){this.width=u,this.height=u}get manager(){return this._manager}constructor(u,x){super(),this.name=u,this.animations=new Array,this.isPickable=!1,this.useAlphaForPicking=!1,this.onDisposeObservable=new W.cP,this._onAnimationEnd=null,this._endAnimation=()=>{this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()},this.color=new _.ov(1,1,1,1),this.position=U.Pq.Zero(),this._manager=x,this._manager.sprites.push(this),this.uniqueId=this._manager.scene.getUniqueId()}getClassName(){return"Sprite"}get fromIndex(){return this._fromIndex}set fromIndex(u){this.playAnimation(u,this._toIndex,this._loopAnimation,this._delay,this._onAnimationEnd)}get toIndex(){return this._toIndex}set toIndex(u){this.playAnimation(this._fromIndex,u,this._loopAnimation,this._delay,this._onAnimationEnd)}get loopAnimation(){return this._loopAnimation}set loopAnimation(u){this.playAnimation(this._fromIndex,this._toIndex,u,this._delay,this._onAnimationEnd)}get delay(){return Math.max(this._delay,1)}set delay(u){this.playAnimation(this._fromIndex,this._toIndex,this._loopAnimation,u,this._onAnimationEnd)}playAnimation(u,x,s,U,_=null){this._onAnimationEnd=_,super.playAnimation(u,x,s,U,this._endAnimation)}dispose(){for(let u=0;u<this._manager.sprites.length;u++)this._manager.sprites[u]==this&&this._manager.sprites.splice(u,1);this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}serialize(){const u={};return u.name=this.name,u.position=this.position.asArray(),u.color=this.color.asArray(),u.width=this.width,u.height=this.height,u.angle=this.angle,u.cellIndex=this.cellIndex,u.cellRef=this.cellRef,u.invertU=this.invertU,u.invertV=this.invertV,u.disposeWhenFinishedAnimating=this.disposeWhenFinishedAnimating,u.isPickable=this.isPickable,u.isVisible=this.isVisible,u.useAlphaForPicking=this.useAlphaForPicking,u.animationStarted=this.animationStarted,u.fromIndex=this.fromIndex,u.toIndex=this.toIndex,u.loopAnimation=this.loopAnimation,u.delay=this.delay,u}static Parse(u,x){const s=new I(u.name,x);return s.position=U.Pq.FromArray(u.position),s.color=_.ov.FromArray(u.color),s.width=u.width,s.height=u.height,s.angle=u.angle,s.cellIndex=u.cellIndex,s.cellRef=u.cellRef,s.invertU=u.invertU,s.invertV=u.invertV,s.disposeWhenFinishedAnimating=u.disposeWhenFinishedAnimating,s.isPickable=u.isPickable,s.isVisible=u.isVisible,s.useAlphaForPicking=u.useAlphaForPicking,s._fromIndex=u.fromIndex,s._toIndex=u.toIndex,s._loopAnimation=u.loopAnimation,s._delay=u.delay,u.animationStarted&&s.playAnimation(s.fromIndex,s.toIndex,s.loopAnimation,s.delay),s}}},133716:(u,x,s)=>{s.d(x,{x:()=>D});var U=s(638113),_=s(604910),W=s(615999),c=s(290564),I=s(79160),L=s(432050),J=s(122030),k=s(706400),i=s(898973),d=s(732259),j=s(16812),r=s(395726);class D{set onDispose(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)}get children(){return this.sprites}get scene(){return this._scene}get capacity(){return this._spriteRenderer.capacity}get texture(){return this._spriteRenderer.texture}set texture(u){u.wrapU=L.g.CLAMP_ADDRESSMODE,u.wrapV=L.g.CLAMP_ADDRESSMODE,this._spriteRenderer.texture=u,this._textureContent=null}get cellWidth(){return this._spriteRenderer.cellWidth}set cellWidth(u){this._spriteRenderer.cellWidth=u}get cellHeight(){return this._spriteRenderer.cellHeight}set cellHeight(u){this._spriteRenderer.cellHeight=u}get fogEnabled(){return this._spriteRenderer.fogEnabled}set fogEnabled(u){this._spriteRenderer.fogEnabled=u}get useLogarithmicDepth(){return this._spriteRenderer.useLogarithmicDepth}set useLogarithmicDepth(u){this._spriteRenderer.useLogarithmicDepth=u}get blendMode(){return this._spriteRenderer.blendMode}set blendMode(u){this._spriteRenderer.blendMode=u}get disableDepthWrite(){return this._disableDepthWrite}set disableDepthWrite(u){this._disableDepthWrite=u,this._spriteRenderer.disableDepthWrite=u}get pixelPerfect(){return this._spriteRenderer.pixelPerfect}set pixelPerfect(u){this._spriteRenderer.pixelPerfect=u,u&&3!==this.texture.samplingMode&&this.texture.updateSamplingMode(3)}constructor(u,x,s,_,W,I=.01,k=L.g.TRILINEAR_SAMPLINGMODE,i=!1,d=null){this.name=u,this.sprites=[],this.renderingGroupId=0,this.layerMask=268435455,this.isPickable=!1,this.metadata=null,this._wasDispatched=!1,this.onDisposeObservable=new U.cP,this._disableDepthWrite=!1,this._packedAndReady=!1,this._customUpdate=(u,x)=>{u.cellRef||(u.cellIndex=0);const s=u.cellIndex;"number"==typeof s&&isFinite(s)&&Math.floor(s)===s&&(u.cellRef=this._spriteMap[u.cellIndex]),u._xOffset=this._cellData[u.cellRef].frame.x/x.width,u._yOffset=this._cellData[u.cellRef].frame.y/x.height,u._xSize=this._cellData[u.cellRef].frame.w,u._ySize=this._cellData[u.cellRef].frame.h},W||(W=r.q.LastCreatedScene),W._getComponent(J.v.NAME_SPRITE)||W._addComponent(new c.R(W)),this._fromPacked=i,this._scene=W;const D=this._scene.getEngine();if(this._spriteRenderer=new j.j(D,s,I,W),_.width&&_.height)this.cellWidth=_.width,this.cellHeight=_.height;else{if(void 0===_)return void(this._spriteRenderer=null);this.cellWidth=_,this.cellHeight=_}this._scene.spriteManagers&&this._scene.spriteManagers.push(this),this.uniqueId=this.scene.getUniqueId(),x&&(this.texture=new L.g(x,W,!0,!1,k)),this._fromPacked&&this._makePacked(x,d)}getClassName(){return"SpriteManager"}_makePacked(u,x){if(null!==x)try{let u;if(u="string"==typeof x?JSON.parse(x):x,u.frames.length){const x={};for(let s=0;s<u.frames.length;s++){const U=u.frames[s];if("string"!=typeof Object.keys(U)[0])throw new Error("Invalid JSON Format.  Check the frame values and make sure the name is the first parameter.");x[U[Object.keys(U)[0]]]=U}u.frames=x}const s=Reflect.ownKeys(u.frames);this._spriteMap=s,this._packedAndReady=!0,this._cellData=u.frames}catch(u){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON from string. Spritesheet managed with constant cell size.")}else{const x=/\./g;let s;do{s=x.lastIndex,x.test(u)}while(x.lastIndex>0);const U=u.substring(0,s-1)+".json",_=()=>{k.V.Error("JSON ERROR: Unable to load JSON file."),this._fromPacked=!1,this._packedAndReady=!1},W=u=>{try{const x=JSON.parse(u),s=Reflect.ownKeys(x.frames);this._spriteMap=s,this._packedAndReady=!0,this._cellData=x.frames}catch(u){throw this._fromPacked=!1,this._packedAndReady=!1,new Error("Invalid JSON format. Please check documentation for format specifications.")}};i.S0.LoadFile(U,W,void 0,void 0,!1,_)}}_checkTextureAlpha(u,x,s,U,W){if(!u.useAlphaForPicking||!this.texture)return!0;const c=this.texture.getSize();this._textureContent||(this._textureContent=new Uint8Array(c.width*c.height*4),this.texture.readPixels(0,0,this._textureContent));const I=_.AA.Vector3[0];I.copyFrom(x.direction),I.normalize(),I.scaleInPlace(s),I.addInPlace(x.origin);const L=(I.x-U.x)/(W.x-U.x),J=1-(I.y-U.y)/(W.y-U.y),k=u._xOffset*c.width+L*u._xSize|0,i=u._yOffset*c.height+J*u._ySize|0;return this._textureContent[4*(k+i*c.width)+3]>.5}intersects(u,x,s,U){const W=Math.min(this.capacity,this.sprites.length),c=_.Pq.Zero(),L=_.Pq.Zero();let J=Number.MAX_VALUE,k=null;const i=_.AA.Vector3[0],d=_.AA.Vector3[1],j=x.getViewMatrix();let r=u,D=u;for(let x=0;x<W;x++){const W=this.sprites[x];if(W){if(s){if(!s(W))continue}else if(!W.isPickable)continue;if(_.Pq.TransformCoordinatesToRef(W.position,j,d),W.angle?(_.uq.TranslationToRef(-d.x,-d.y,0,_.AA.Matrix[1]),_.uq.TranslationToRef(d.x,d.y,0,_.AA.Matrix[2]),_.uq.RotationZToRef(-W.angle,_.AA.Matrix[3]),_.AA.Matrix[1].multiplyToRef(_.AA.Matrix[3],_.AA.Matrix[4]),_.AA.Matrix[4].multiplyToRef(_.AA.Matrix[2],_.AA.Matrix[0]),r=u.clone(),_.Pq.TransformCoordinatesToRef(u.origin,_.AA.Matrix[0],r.origin),_.Pq.TransformNormalToRef(u.direction,_.AA.Matrix[0],r.direction)):r=u,c.copyFromFloats(d.x-W.width/2,d.y-W.height/2,d.z),L.copyFromFloats(d.x+W.width/2,d.y+W.height/2,d.z),r.intersectsBoxMinMax(c,L)){const u=_.Pq.Distance(d,r.origin);if(J>u){if(!this._checkTextureAlpha(W,r,u,c,L))continue;if(D=r,J=u,k=W,U)break}}}}if(k){const u=new I.G;j.invertToRef(_.AA.Matrix[0]),u.hit=!0,u.pickedSprite=k,u.distance=J;const x=_.AA.Vector3[2];return x.copyFrom(D.direction),x.normalize(),x.scaleInPlace(J),D.origin.addToRef(x,i),u.pickedPoint=_.Pq.TransformCoordinates(i,_.AA.Matrix[0]),u}return null}multiIntersects(u,x,s){const U=Math.min(this.capacity,this.sprites.length),W=_.Pq.Zero(),c=_.Pq.Zero();let L;const J=[],k=_.AA.Vector3[0].copyFromFloats(0,0,0),i=_.AA.Vector3[1].copyFromFloats(0,0,0),d=x.getViewMatrix();for(let x=0;x<U;x++){const U=this.sprites[x];if(U){if(s){if(!s(U))continue}else if(!U.isPickable)continue;if(_.Pq.TransformCoordinatesToRef(U.position,d,i),W.copyFromFloats(i.x-U.width/2,i.y-U.height/2,i.z),c.copyFromFloats(i.x+U.width/2,i.y+U.height/2,i.z),u.intersectsBoxMinMax(W,c)){if(L=_.Pq.Distance(i,u.origin),!this._checkTextureAlpha(U,u,L,W,c))continue;const x=new I.G;J.push(x),d.invertToRef(_.AA.Matrix[0]),x.hit=!0,x.pickedSprite=U,x.distance=L;const s=_.AA.Vector3[2];s.copyFrom(u.direction),s.normalize(),s.scaleInPlace(L),u.origin.addToRef(s,k),x.pickedPoint=_.Pq.TransformCoordinates(k,_.AA.Matrix[0])}}}return J}render(){if(this._fromPacked&&(!this._packedAndReady||!this._spriteMap||!this._cellData))return;const u=this._scene.getEngine().getDeltaTime();this._packedAndReady?this._spriteRenderer.render(this.sprites,u,this._scene.getViewMatrix(),this._scene.getProjectionMatrix(),this._customUpdate):this._spriteRenderer.render(this.sprites,u,this._scene.getViewMatrix(),this._scene.getProjectionMatrix())}rebuild(){var u;null===(u=this._spriteRenderer)||void 0===u||u.rebuild()}dispose(){if(this._spriteRenderer&&(this._spriteRenderer.dispose(),this._spriteRenderer=null),this._textureContent=null,this._scene.spriteManagers){const u=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(u,1)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null}serialize(u=!1){const x={};x.name=this.name,x.capacity=this.capacity,x.cellWidth=this.cellWidth,x.cellHeight=this.cellHeight,x.fogEnabled=this.fogEnabled,x.blendMode=this.blendMode,x.disableDepthWrite=this.disableDepthWrite,x.pixelPerfect=this.pixelPerfect,x.useLogarithmicDepth=this.useLogarithmicDepth,this.texture&&(u?x.texture=this.texture.serialize():(x.textureUrl=this.texture.name,x.invertY=this.texture._invertY)),x.sprites=[];for(const u of this.sprites)x.sprites.push(u.serialize());return x.metadata=this.metadata,x}static Parse(u,x,s){const U=new D(u.name,"",u.capacity,{width:u.cellWidth,height:u.cellHeight},x);void 0!==u.fogEnabled&&(U.fogEnabled=u.fogEnabled),void 0!==u.blendMode&&(U.blendMode=u.blendMode),void 0!==u.disableDepthWrite&&(U.disableDepthWrite=u.disableDepthWrite),void 0!==u.pixelPerfect&&(U.pixelPerfect=u.pixelPerfect),void 0!==u.useLogarithmicDepth&&(U.useLogarithmicDepth=u.useLogarithmicDepth),void 0!==u.metadata&&(U.metadata=u.metadata),u.texture?U.texture=L.g.Parse(u.texture,x,s):u.textureName&&(U.texture=new L.g(s+u.textureUrl,x,!1,void 0===u.invertY||u.invertY));for(const x of u.sprites)W.k.Parse(x,U);return U}static ParseFromFileAsync(u,x,s,U=""){return new Promise(((_,W)=>{const c=new d.u;c.addEventListener("readystatechange",(()=>{if(4==c.readyState)if(200==c.status){const x=JSON.parse(c.responseText),W=D.Parse(x,s||r.q.LastCreatedScene,U);u&&(W.name=u),_(W)}else W("Unable to load the sprite manager")})),c.open("GET",x),c.send()}))}static ParseFromSnippetAsync(u,x,s=""){return"_BLANK"===u?Promise.resolve(new D("Default sprite manager","//playground.babylonjs.com/textures/player.png",500,64,x)):new Promise(((U,_)=>{const W=new d.u;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const _=JSON.parse(JSON.parse(W.responseText).jsonPayload),c=JSON.parse(_.spriteManager),I=D.Parse(c,x||r.q.LastCreatedScene,s);I.snippetId=u,U(I)}else _("Unable to load the snippet "+u)})),W.open("GET",this.SnippetUrl+"/"+u.replace(/#/g,"/")),W.send()}))}}D.SnippetUrl=`https://snippet.babylonjs.com`,D.CreateFromSnippetAsync=D.ParseFromSnippetAsync},16812:(u,x,s)=>{s.d(x,{j:()=>I});var U=s(23987),_=s(964061),W=(s(889630),s(80157),s(706400)),c=s(855300);class I{get fogEnabled(){return this._fogEnabled}set fogEnabled(u){this._fogEnabled!==u&&(this._fogEnabled=u,this._createEffects())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(u){var x;const s=!!(null===(x=this._scene)||void 0===x?void 0:x.getEngine().getCaps().fragmentDepthSupported);u&&!s&&W.V.Warn("Logarithmic depth has been requested for a sprite renderer on a device that doesn't support it."),this._useLogarithmicDepth=u&&s,this._createEffects()}get capacity(){return this._capacity}get pixelPerfect(){return this._pixelPerfect}set pixelPerfect(u){this._pixelPerfect!==u&&(this._pixelPerfect=u,this._createEffects())}get shaderLanguage(){return this._shaderLanguage}constructor(u,x,s=.01,_=null){this.blendMode=2,this.autoResetAlpha=!0,this.disableDepthWrite=!1,this._fogEnabled=!0,this._pixelPerfect=!1,this._shaderLanguage=0,this._useVAO=!1,this._useInstancing=!1,this._vertexBuffers={},this._isDisposed=!1,this._shadersLoaded=!1,this._capacity=x,this._epsilon=s,this._engine=u,this._useInstancing=u.getCaps().instancedArrays&&u._features.supportSpriteInstancing,this._useVAO=u.getCaps().vertexArrayObject&&!u.disableVertexArrayObjects,this._scene=_,this._useInstancing||this._buildIndexBuffer(),this._vertexBufferSize=this._useInstancing?16:18,this._vertexData=new Float32Array(x*this._vertexBufferSize*(this._useInstancing?1:4)),this._buffer=new U.h(u,this._vertexData,!0,this._vertexBufferSize);const W=this._buffer.createVertexBuffer(U.R.PositionKind,0,4,this._vertexBufferSize,this._useInstancing),c=this._buffer.createVertexBuffer("options",4,2,this._vertexBufferSize,this._useInstancing);let I,L=6;if(this._useInstancing){const x=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new U.h(u,x,!1,2),I=this._spriteBuffer.createVertexBuffer("offsets",0,2)}else I=this._buffer.createVertexBuffer("offsets",L,2,this._vertexBufferSize,this._useInstancing),L+=2;const J=this._buffer.createVertexBuffer("inverts",L,2,this._vertexBufferSize,this._useInstancing),k=this._buffer.createVertexBuffer("cellInfo",L+2,4,this._vertexBufferSize,this._useInstancing),i=this._buffer.createVertexBuffer(U.R.ColorKind,L+6,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[U.R.PositionKind]=W,this._vertexBuffers["options"]=c,this._vertexBuffers["offsets"]=I,this._vertexBuffers["inverts"]=J,this._vertexBuffers["cellInfo"]=k,this._vertexBuffers[U.R.ColorKind]=i,this._initShaderSourceAsync()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!I.ForceGLSL?(this._shaderLanguage=1,await Promise.all([s.e(66691).then(s.bind(s,866691)),s.e(72923).then(s.bind(s,972923))])):await Promise.all([s.e(98180).then(s.bind(s,398180)),s.e(35214).then(s.bind(s,135214))]),this._shadersLoaded=!0,this._createEffects()}_createEffects(){var u,x;if(this._isDisposed)return;null===(u=this._drawWrapperBase)||void 0===u||u.dispose(),null===(x=this._drawWrapperDepth)||void 0===x||x.dispose(),this._drawWrapperBase=new _.E(this._engine),this._drawWrapperDepth=new _.E(this._engine,!1),this._drawWrapperBase.drawContext&&(this._drawWrapperBase.drawContext.useInstancing=this._useInstancing),this._drawWrapperDepth.drawContext&&(this._drawWrapperDepth.drawContext.useInstancing=this._useInstancing);let s="";this._pixelPerfect&&(s+="#define PIXEL_PERFECT\n"),this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode&&this._fogEnabled&&(s+="#define FOG\n"),this._useLogarithmicDepth&&(s+="#define LOGARITHMICDEPTH\n"),this._drawWrapperBase.effect=this._engine.createEffect("sprites",[U.R.PositionKind,"options","offsets","inverts","cellInfo",U.R.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor","logarithmicDepthConstant"],["diffuseSampler"],s,void 0,void 0,void 0,void 0,this._shaderLanguage),this._drawWrapperDepth.effect=this._drawWrapperBase.effect,this._drawWrapperDepth.materialContext=this._drawWrapperBase.materialContext}render(u,x,s,U,_=null){if(!(this._shadersLoaded&&this.texture&&this.texture.isReady()&&u.length))return;const W=this._drawWrapperBase,I=this._drawWrapperDepth,L=this.fogEnabled&&this._scene&&this._scene.fogEnabled&&0!==this._scene.fogMode,J=W.effect;if(!J.isReady())return;const k=this._engine,i=!(!this._scene||!this._scene.useRightHandedSystem),d=this.texture.getBaseSize(),j=Math.min(this._capacity,u.length);let r=0,D=!0;for(let s=0;s<j;s++){const U=u[s];U&&U.isVisible&&(D=!1,U._animate(x),this._appendSpriteVertex(r++,U,0,0,d,i,_),this._useInstancing||(this._appendSpriteVertex(r++,U,1,0,d,i,_),this._appendSpriteVertex(r++,U,1,1,d,i,_),this._appendSpriteVertex(r++,U,0,1,d,i,_)))}if(D)return;this._buffer.update(this._vertexData);const $=!!k.depthCullingState.cull,H=k.depthCullingState.zOffset,f=k.depthCullingState.zOffsetUnits;if(k.setState($,H,!1,!1,void 0,void 0,f),k.enableEffect(W),J.setTexture("diffuseSampler",this.texture),J.setMatrix("view",s),J.setMatrix("projection",U),L){const u=this._scene;J.setFloat4("vFogInfos",u.fogMode,u.fogStart,u.fogEnd,u.fogDensity),J.setColor3("vFogColor",u.fogColor)}this.useLogarithmicDepth&&this._scene&&c.DL(W.defines,J,this._scene),this._useVAO?(this._vertexArrayObject||(this._vertexArrayObject=k.recordVertexArrayObject(this._vertexBuffers,this._indexBuffer,J)),k.bindVertexArrayObject(this._vertexArrayObject,this._indexBuffer)):k.bindBuffers(this._vertexBuffers,this._indexBuffer,J),k.depthCullingState.depthFunc=k.useReverseDepthBuffer?518:515,this.disableDepthWrite||(J.setBool("alphaTest",!0),k.setColorWrite(!1),k.enableEffect(I),this._useInstancing?k.drawArraysType(7,0,4,r):k.drawElementsType(0,0,r/4*6),k.enableEffect(W),k.setColorWrite(!0),J.setBool("alphaTest",!1)),k.setAlphaMode(this.blendMode),this._useInstancing?k.drawArraysType(7,0,4,r):k.drawElementsType(0,0,r/4*6),this.autoResetAlpha&&k.setAlphaMode(0),i&&this._scene.getEngine().setState($,H,!1,!0,void 0,void 0,f),k.unbindInstanceAttributes()}_appendSpriteVertex(u,x,s,U,_,W,c){let I=u*this._vertexBufferSize;if(0===s?s=this._epsilon:1===s&&(s=1-this._epsilon),0===U?U=this._epsilon:1===U&&(U=1-this._epsilon),c)c(x,_);else{x.cellIndex||(x.cellIndex=0);const u=_.width/this.cellWidth,s=x.cellIndex/u>>0;x._xOffset=(x.cellIndex-s*u)*this.cellWidth/_.width,x._yOffset=s*this.cellHeight/_.height,x._xSize=this.cellWidth,x._ySize=this.cellHeight}this._vertexData[I]=x.position.x,this._vertexData[I+1]=x.position.y,this._vertexData[I+2]=x.position.z,this._vertexData[I+3]=x.angle,this._vertexData[I+4]=x.width,this._vertexData[I+5]=x.height,this._useInstancing?I-=2:(this._vertexData[I+6]=s,this._vertexData[I+7]=U),this._vertexData[I+8]=W?x.invertU?0:1:x.invertU?1:0,this._vertexData[I+9]=x.invertV?1:0,this._vertexData[I+10]=x._xOffset,this._vertexData[I+11]=x._yOffset,this._vertexData[I+12]=x._xSize/_.width,this._vertexData[I+13]=x._ySize/_.height,this._vertexData[I+14]=x.color.r,this._vertexData[I+15]=x.color.g,this._vertexData[I+16]=x.color.b,this._vertexData[I+17]=x.color.a}_buildIndexBuffer(){const u=[];let x=0;for(let s=0;s<this._capacity;s++)u.push(x),u.push(x+1),u.push(x+2),u.push(x),u.push(x+2),u.push(x+3),x+=4;this._indexBuffer=this._engine.createIndexBuffer(u)}rebuild(){var u;this._indexBuffer&&this._buildIndexBuffer(),this._useVAO&&(this._vertexArrayObject=void 0),this._buffer._rebuild();for(const u in this._vertexBuffers)this._vertexBuffers[u]._rebuild();null===(u=this._spriteBuffer)||void 0===u||u._rebuild()}dispose(){var u,x;this._buffer&&(this._buffer.dispose(),this._buffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this.texture&&(this.texture.dispose(),this.texture=null),null===(u=this._drawWrapperBase)||void 0===u||u.dispose(),null===(x=this._drawWrapperDepth)||void 0===x||x.dispose(),this._isDisposed=!0}}I.ForceGLSL=!1},290564:(u,x,s)=>{s.d(x,{R:()=>J});var U=s(638113),_=s(889460),W=s(988514),c=s(79160),I=s(122030),L=s(35259);_.Z.prototype._internalPickSprites=function(u,x,s,U){if(!c.G)return null;let _=null;if(!U){if(!this.activeCamera)return null;U=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let W=0;W<this.spriteManagers.length;W++){const c=this.spriteManagers[W];if(!c.isPickable)continue;const I=c.intersects(u,U,x,s);if(I&&I.hit&&(s||null==_||!(I.distance>=_.distance))&&(_=I,s))break}return _||new c.G},_.Z.prototype._internalMultiPickSprites=function(u,x,s){if(!c.G)return null;let U=[];if(!s){if(!this.activeCamera)return null;s=this.activeCamera}if(this.spriteManagers&&this.spriteManagers.length>0)for(let _=0;_<this.spriteManagers.length;_++){const W=this.spriteManagers[_];if(!W.isPickable)continue;const c=W.multiIntersects(u,s,x);null!==c&&(U=U.concat(c))}return U},_.Z.prototype.pickSprite=function(u,x,s,U,_){if(!this._tempSpritePickingRay)return null;this.createPickingRayInCameraSpaceToRef(u,x,this._tempSpritePickingRay,_);const W=this._internalPickSprites(this._tempSpritePickingRay,s,U,_);return W&&(W.ray=this.createPickingRayInCameraSpace(u,x,_)),W},_.Z.prototype.pickSpriteWithRay=function(u,x,s,U){if(!this._tempSpritePickingRay)return null;if(!U){if(!this.activeCamera)return null;U=this.activeCamera}W.R.TransformToRef(u,U.getViewMatrix(),this._tempSpritePickingRay);const _=this._internalPickSprites(this._tempSpritePickingRay,x,s,U);return _&&(_.ray=u),_},_.Z.prototype.multiPickSprite=function(u,x,s,U){return this.createPickingRayInCameraSpaceToRef(u,x,this._tempSpritePickingRay,U),this._internalMultiPickSprites(this._tempSpritePickingRay,s,U)},_.Z.prototype.multiPickSpriteWithRay=function(u,x,s){if(!this._tempSpritePickingRay)return null;if(!s){if(!this.activeCamera)return null;s=this.activeCamera}return W.R.TransformToRef(u,s.getViewMatrix(),this._tempSpritePickingRay),this._internalMultiPickSprites(this._tempSpritePickingRay,x,s)},_.Z.prototype.setPointerOverSprite=function(u){this._pointerOverSprite!==u&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(10,L.X.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=u,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(9,L.X.CreateNewFromSprite(this._pointerOverSprite,this)))},_.Z.prototype.getPointerOverSprite=function(){return this._pointerOverSprite};class J{constructor(u){this.name=I.v.NAME_SPRITE,this.scene=u,this.scene.spriteManagers=[],this.scene._tempSpritePickingRay=W.R?W.R.Zero():null,this.scene.onBeforeSpritesRenderingObservable=new U.cP,this.scene.onAfterSpritesRenderingObservable=new U.cP,this._spritePredicate=u=>!!u.actionManager&&u.isPickable&&u.actionManager.hasPointerTriggers}register(){this.scene._pointerMoveStage.registerStep(I.v.STEP_POINTERMOVE_SPRITE,this,this._pointerMove),this.scene._pointerDownStage.registerStep(I.v.STEP_POINTERDOWN_SPRITE,this,this._pointerDown),this.scene._pointerUpStage.registerStep(I.v.STEP_POINTERUP_SPRITE,this,this._pointerUp)}rebuild(){}dispose(){this.scene.onBeforeSpritesRenderingObservable.clear(),this.scene.onAfterSpritesRenderingObservable.clear();const u=this.scene.spriteManagers;if(u)for(;u.length;)u[0].dispose()}_pickSpriteButKeepRay(u,x,s,U,_){const W=this.scene.pickSprite(x,s,this._spritePredicate,U,_);return W&&(W.ray=u?u.ray:null),W}_pointerMove(u,x,s,U,_){const W=this.scene;return U?W.setPointerOverSprite(null):(s=this._pickSpriteButKeepRay(s,u,x,!1,W.cameraToUseForPointers||void 0))&&s.hit&&s.pickedSprite?(W.setPointerOverSprite(s.pickedSprite),!W.doNotHandleCursors&&_&&(W._pointerOverSprite&&W._pointerOverSprite.actionManager&&W._pointerOverSprite.actionManager.hoverCursor?_.style.cursor=W._pointerOverSprite.actionManager.hoverCursor:_.style.cursor=W.hoverCursor)):W.setPointerOverSprite(null),s}_pointerDown(u,x,s,U){const _=this.scene;if(_._pickedDownSprite=null,_.spriteManagers&&_.spriteManagers.length>0&&(s=_.pickSprite(u,x,this._spritePredicate,!1,_.cameraToUseForPointers||void 0))&&s.hit&&s.pickedSprite&&s.pickedSprite.actionManager){switch(_._pickedDownSprite=s.pickedSprite,U.button){case 0:s.pickedSprite.actionManager.processTrigger(2,L.X.CreateNewFromSprite(s.pickedSprite,_,U));break;case 1:s.pickedSprite.actionManager.processTrigger(4,L.X.CreateNewFromSprite(s.pickedSprite,_,U));break;case 2:s.pickedSprite.actionManager.processTrigger(3,L.X.CreateNewFromSprite(s.pickedSprite,_,U))}s.pickedSprite.actionManager&&s.pickedSprite.actionManager.processTrigger(5,L.X.CreateNewFromSprite(s.pickedSprite,_,U))}return s}_pointerUp(u,x,s,U,_){const W=this.scene;if(W.spriteManagers&&W.spriteManagers.length>0){const s=W.pickSprite(u,x,this._spritePredicate,!1,W.cameraToUseForPointers||void 0);s&&(s.hit&&s.pickedSprite&&s.pickedSprite.actionManager&&(s.pickedSprite.actionManager.processTrigger(7,L.X.CreateNewFromSprite(s.pickedSprite,W,U)),s.pickedSprite.actionManager&&(this.scene._inputManager._isPointerSwiping()||s.pickedSprite.actionManager.processTrigger(1,L.X.CreateNewFromSprite(s.pickedSprite,W,U)),_&&s.pickedSprite.actionManager.processTrigger(6,L.X.CreateNewFromSprite(s.pickedSprite,W,U)))),W._pickedDownSprite&&W._pickedDownSprite.actionManager&&W._pickedDownSprite!==s.pickedSprite&&W._pickedDownSprite.actionManager.processTrigger(16,L.X.CreateNewFromSprite(W._pickedDownSprite,W,U)))}return s}}},602100:(u,x,s)=>{s.d(x,{X:()=>U});class U{get animationStarted(){return this._animationStarted}get fromIndex(){return this._fromIndex}get toIndex(){return this._toIndex}get loopAnimation(){return this._loopAnimation}get delay(){return Math.max(this._delay,1)}constructor(){this.width=1,this.height=1,this.angle=0,this.invertU=!1,this.invertV=!1,this.isVisible=!0,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._onBaseAnimationEnd=null,this.position={x:1,y:1,z:1},this.color={r:1,g:1,b:1,a:1}}playAnimation(u,x,s,U,_){this._fromIndex=u,this._toIndex=x,this._loopAnimation=s,this._delay=U||1,this._animationStarted=!0,this._onBaseAnimationEnd=_,u<x?this._direction=1:(this._direction=-1,this._toIndex=u,this._fromIndex=x),this.cellIndex=u,this._time=0}stopAnimation(){this._animationStarted=!1}_animate(u){this._animationStarted&&(this._time+=u,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,(this._direction>0&&this.cellIndex>this._toIndex||this._direction<0&&this.cellIndex<this._fromIndex)&&(this._loopAnimation?this.cellIndex=this._direction>0?this._fromIndex:this._toIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onBaseAnimationEnd&&this._onBaseAnimationEnd()))))}}},822133:(u,x,s)=>{s.d(x,{i:()=>U});class U{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(u){this._alphaBlend!==u&&(this._alphaBlend=u,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(u,x,s,U){this._blendConstants[0]===u&&this._blendConstants[1]===x&&this._blendConstants[2]===s&&this._blendConstants[3]===U||(this._blendConstants[0]=u,this._blendConstants[1]=x,this._blendConstants[2]=s,this._blendConstants[3]=U,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(u,x,s,U){this._blendFunctionParameters[0]===u&&this._blendFunctionParameters[1]===x&&this._blendFunctionParameters[2]===s&&this._blendFunctionParameters[3]===U||(this._blendFunctionParameters[0]=u,this._blendFunctionParameters[1]=x,this._blendFunctionParameters[2]=s,this._blendFunctionParameters[3]=U,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(u,x){this._blendEquationParameters[0]===u&&this._blendEquationParameters[1]===x||(this._blendEquationParameters[0]=u,this._blendEquationParameters[1]=x,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(u){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?u.enable(u.BLEND):u.disable(u.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(u.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(u.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(u.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}},460976:(u,x,s)=>{s.d(x,{N:()=>U});class U{constructor(u=!0){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,u&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(u){this._zOffset!==u&&(this._zOffset=u,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(u){this._zOffsetUnits!==u&&(this._zOffsetUnits=u,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(u){this._cullFace!==u&&(this._cullFace=u,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(u){this._cull!==u&&(this._cull=u,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(u){this._depthFunc!==u&&(this._depthFunc=u,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(u){this._depthMask!==u&&(this._depthMask=u,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(u){this._depthTest!==u&&(this._depthTest=u,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(u){this._frontFace!==u&&(this._frontFace=u,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(u){this.isDirty&&(this._isCullDirty&&(this.cull?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(u.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(u.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(u.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(u.enable(u.POLYGON_OFFSET_FILL),u.polygonOffset(this.zOffset,this.zOffsetUnits)):u.disable(u.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(u.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}},56291:(u,x,s)=>{s.d(x,{K:()=>U});class U{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=U.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=U.KEEP,this.opDepthFail=U.KEEP,this.opStencilDepthPass=U.REPLACE}get stencilFunc(){return this.func}set stencilFunc(u){this.func=u}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(u){this.funcRef=u}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(u){this.funcMask=u}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(u){this.opStencilFail=u}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(u){this.opDepthFail=u}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(u){this.opStencilDepthPass=u}get stencilMask(){return this.mask}set stencilMask(u){this.mask=u}get stencilTest(){return this.enabled}set stencilTest(u){this.enabled=u}}U.ALWAYS=519,U.KEEP=7680,U.REPLACE=7681},762945:(u,x,s)=>{s.d(x,{u:()=>U});class U{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(u){this._func!==u&&(this._func=u,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(u){this._funcRef!==u&&(this._funcRef=u,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(u){this._funcMask!==u&&(this._funcMask=u,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(u){this._opStencilFail!==u&&(this._opStencilFail=u,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(u){this._opDepthFail!==u&&(this._opDepthFail=u,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(u){this._opStencilDepthPass!==u&&(this._opStencilDepthPass=u,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(u){this._mask!==u&&(this._mask=u,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(u){this._enabled!==u&&(this._enabled=u,this._isStencilTestDirty=!0)}constructor(u=!0){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,u&&this.reset()}reset(){var u;this.stencilMaterial=void 0,null===(u=this.stencilGlobal)||void 0===u||u.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(u){var x;if(!u)return;const s=!this.useStencilGlobalOnly&&!!(null===(x=this.stencilMaterial)||void 0===x?void 0:x.enabled);this.enabled=s?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=s?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=s?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=s?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=s?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=s?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=s?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=s?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(u.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(u.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(u.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}},837475:(u,x,s)=>{s.d(x,{d:()=>_});var U=s(310035);class _{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.particleSystems=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[]}static AddParser(u,x){this._BabylonFileParsers[u]=x}static GetParser(u){return this._BabylonFileParsers[u]?this._BabylonFileParsers[u]:null}static AddIndividualParser(u,x){this._IndividualBabylonFileParsers[u]=x}static GetIndividualParser(u){return this._IndividualBabylonFileParsers[u]?this._IndividualBabylonFileParsers[u]:null}static Parse(u,x,s,U){for(const _ in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,_)&&this._BabylonFileParsers[_](u,x,s,U)}get environmentTexture(){return this._environmentTexture}set environmentTexture(u){this._environmentTexture=u}getNodes(){let u=[];return u=u.concat(this.meshes),u=u.concat(this.lights),u=u.concat(this.cameras),u=u.concat(this.transformNodes),this.skeletons.forEach((x=>u=u.concat(x.bones))),u}}_._BabylonFileParsers={},_._IndividualBabylonFileParsers={},U.Y5("BABYLON.AbstractScene",_)},23178:(u,x,s)=>{s.d(x,{Nx:()=>r,WZ:()=>D,hA:()=>j});var U=s(837475),_=s(27230),W=s(633727),c=s(938868),I=s(706400),L=s(395726),J=s(789603),k=s(349487),i=s(564135),d=s(898973);class j extends U.d{}class r{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((u=>{u.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((u=>{u.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((u=>{u.dispose()})),this.animationGroups.length=0}}class D extends U.d{constructor(u){super(),this._wasAddedToScene=!1,(u=u||L.q.LastCreatedScene)&&(this.scene=u,this["sounds"]=[],this["effectLayers"]=[],this["layers"]=[],this["lensFlareSystems"]=[],this["proceduralTextures"]=[],this["reflectionProbes"]=[],u.onDisposeObservable.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=u.getEngine().onContextRestoredObservable.add((()=>{for(const u of this.geometries)u._rebuild();for(const u of this.meshes)u._rebuild();for(const u of this.particleSystems)u.rebuild();for(const u of this.textures)u._rebuild()})))}_topologicalSort(u){const x=new Map;for(const s of u)x.set(s.uniqueId,s);const s={dependsOn:new Map,dependedBy:new Map};for(const x of u){const u=x.uniqueId;s.dependsOn.set(u,new Set),s.dependedBy.set(u,new Set)}for(const U of u){const u=U.uniqueId,_=s.dependsOn.get(u);if(U instanceof J.Z){const W=U.sourceMesh;x.has(W.uniqueId)&&(_.add(W.uniqueId),s.dependedBy.get(W.uniqueId).add(u))}const W=s.dependedBy.get(u);for(const _ of U.getDescendants()){const U=_.uniqueId;x.has(U)&&(W.add(U),s.dependsOn.get(U).add(u))}}const U=[],_=[];for(const U of u){const u=U.uniqueId;0===s.dependsOn.get(u).size&&(_.push(U),x.delete(u))}const W=_;for(;W.length>0;){const u=W.shift();U.push(u);const _=s.dependedBy.get(u.uniqueId);for(const U of Array.from(_.values())){const _=s.dependsOn.get(U);_.delete(u.uniqueId),0===_.size&&x.get(U)&&(W.push(x.get(U)),x.delete(U))}}return x.size>0&&(I.V.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),x.forEach((u=>I.V.Error(u.name)))),U}_addNodeAndDescendantsToList(u,x,s,U){if(s&&(!U||U(s))&&!x.has(s.uniqueId)){u.push(s),x.add(s.uniqueId);for(const _ of s.getDescendants(!0))this._addNodeAndDescendantsToList(u,x,_,U)}}_isNodeInContainer(u){return u instanceof c.u&&-1!==this.meshes.indexOf(u)||u instanceof W.V&&-1!==this.transformNodes.indexOf(u)||u instanceof k.v&&-1!==this.lights.indexOf(u)||u instanceof i.i&&-1!==this.cameras.indexOf(u)}_isValidHierarchy(){for(const u of this.meshes)if(u.parent&&!this._isNodeInContainer(u.parent))return I.V.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.transformNodes)if(u.parent&&!this._isNodeInContainer(u.parent))return I.V.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.lights)if(u.parent&&!this._isNodeInContainer(u.parent))return I.V.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;for(const u of this.cameras)if(u.parent&&!this._isNodeInContainer(u.parent))return I.V.Warn(`Node ${u.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(u,x=!1,s){this._isValidHierarchy()||d.S0.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const U={},W={},c=new r,I=[],L=[],J={doNotInstantiate:!0,...s},k=[],i=new Set;for(const u of this.transformNodes)null===u.parent&&this._addNodeAndDescendantsToList(k,i,u,J.predicate);for(const u of this.meshes)null===u.parent&&this._addNodeAndDescendantsToList(k,i,u,J.predicate);const j=this._topologicalSort(k),D=(s,I)=>{if(((x,s)=>{if(U[x.uniqueId]=s.uniqueId,W[s.uniqueId]=s,u&&(s.name=u(x.name)),s instanceof _.e){const u=s;if(u.morphTargetManager){const s=x.morphTargetManager;u.morphTargetManager=s.clone();for(let x=0;x<s.numTargets;x++){const _=s.getTarget(x),c=u.morphTargetManager.getTarget(x);U[_.uniqueId]=c.uniqueId,W[c.uniqueId]=c}}}})(s,I),s.parent){const u=U[s.parent.uniqueId],x=W[u];I.parent=x||s.parent}if(I.position&&s.position&&I.position.copyFrom(s.position),I.rotationQuaternion&&s.rotationQuaternion&&I.rotationQuaternion.copyFrom(s.rotationQuaternion),I.rotation&&s.rotation&&I.rotation.copyFrom(s.rotation),I.scaling&&s.scaling&&I.scaling.copyFrom(s.scaling),I.material){const _=I;if(_.material)if(x){const x=s.material;if(-1===L.indexOf(x)){let s=x.clone(u?u(x.name):"Clone of "+x.name);if(L.push(x),U[x.uniqueId]=s.uniqueId,W[s.uniqueId]=s,"MultiMaterial"===x.getClassName()){const _=x;for(const x of _.subMaterials)x&&(s=x.clone(u?u(x.name):"Clone of "+x.name),L.push(x),U[x.uniqueId]=s.uniqueId,W[s.uniqueId]=s);_.subMaterials=_.subMaterials.map((u=>u&&W[U[u.uniqueId]]))}}"InstancedMesh"!==_.getClassName()&&(_.material=W[U[x.uniqueId]])}else"MultiMaterial"===_.material.getClassName()?-1===this.scene.multiMaterials.indexOf(_.material)&&this.scene.addMultiMaterial(_.material):-1===this.scene.materials.indexOf(_.material)&&this.scene.addMaterial(_.material)}null===I.parent&&c.rootNodes.push(I)};return j.forEach((u=>{if("InstancedMesh"===u.getClassName()){const x=u,s=x.sourceMesh,_=U[s.uniqueId],c=("number"==typeof _?W[_]:s).createInstance(x.name);D(x,c)}else{let x=!0;"TransformNode"===u.getClassName()||"Node"===u.getClassName()||u.skeleton||!u.getTotalVertices||0===u.getTotalVertices()?x=!1:J.doNotInstantiate&&(x="function"==typeof J.doNotInstantiate?!J.doNotInstantiate(u):!J.doNotInstantiate);const s=x?u.createInstance(`instance of ${u.name}`):u.clone(`Clone of ${u.name}`,null,!0);if(!s)throw new Error(`Could not clone or instantiate node on Asset Container ${u.name}`);D(u,s)}})),this.skeletons.forEach((x=>{if(J.predicate&&!J.predicate(x))return;const s=x.clone(u?u(x.name):"Clone of "+x.name);for(const u of this.meshes)if(u.skeleton===x&&!u.isAnInstance){const x=W[U[u.uniqueId]];if(!x||x.isAnInstance)continue;if(x.skeleton=s,-1!==I.indexOf(s))continue;I.push(s);for(const u of s.bones)u._linkedTransformNode&&(u._linkedTransformNode=W[U[u._linkedTransformNode.uniqueId]])}c.skeletons.push(s)})),this.animationGroups.forEach((x=>{if(J.predicate&&!J.predicate(x))return;const s=x.clone(u?u(x.name):"Clone of "+x.name,(u=>W[U[u.uniqueId]]||u));c.animationGroups.push(s)})),c}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||d.S0.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(const u of this.scene._serializableComponents)u.addFromContainer(this);this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(u=null){const x=[];this.cameras.forEach((s=>{u&&!u(s)||(this.scene.addCamera(s),x.push(s))})),this.lights.forEach((s=>{u&&!u(s)||(this.scene.addLight(s),x.push(s))})),this.meshes.forEach((s=>{u&&!u(s)||(this.scene.addMesh(s),x.push(s))})),this.skeletons.forEach((x=>{u&&!u(x)||this.scene.addSkeleton(x)})),this.animations.forEach((x=>{u&&!u(x)||this.scene.addAnimation(x)})),this.animationGroups.forEach((x=>{u&&!u(x)||this.scene.addAnimationGroup(x)})),this.multiMaterials.forEach((x=>{u&&!u(x)||this.scene.addMultiMaterial(x)})),this.materials.forEach((x=>{u&&!u(x)||this.scene.addMaterial(x)})),this.morphTargetManagers.forEach((x=>{u&&!u(x)||this.scene.addMorphTargetManager(x)})),this.geometries.forEach((x=>{u&&!u(x)||this.scene.addGeometry(x)})),this.transformNodes.forEach((s=>{u&&!u(s)||(this.scene.addTransformNode(s),x.push(s))})),this.actionManagers.forEach((x=>{u&&!u(x)||this.scene.addActionManager(x)})),this.textures.forEach((x=>{u&&!u(x)||this.scene.addTexture(x)})),this.reflectionProbes.forEach((x=>{u&&!u(x)||this.scene.addReflectionProbe(x)}));for(const u of x)u.parent&&-1===this.scene.getNodes().indexOf(u.parent)&&(u.setParent?u.setParent(null):u.parent=null)}removeAllFromScene(){this._isValidHierarchy()||d.S0.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(const u of this.scene._serializableComponents)u.removeFromContainer(this)}removeFromScene(u=null){this.cameras.forEach((x=>{u&&!u(x)||this.scene.removeCamera(x)})),this.lights.forEach((x=>{u&&!u(x)||this.scene.removeLight(x)})),this.meshes.forEach((x=>{u&&!u(x)||this.scene.removeMesh(x,!0)})),this.skeletons.forEach((x=>{u&&!u(x)||this.scene.removeSkeleton(x)})),this.animations.forEach((x=>{u&&!u(x)||this.scene.removeAnimation(x)})),this.animationGroups.forEach((x=>{u&&!u(x)||this.scene.removeAnimationGroup(x)})),this.multiMaterials.forEach((x=>{u&&!u(x)||this.scene.removeMultiMaterial(x)})),this.materials.forEach((x=>{u&&!u(x)||this.scene.removeMaterial(x)})),this.morphTargetManagers.forEach((x=>{u&&!u(x)||this.scene.removeMorphTargetManager(x)})),this.geometries.forEach((x=>{u&&!u(x)||this.scene.removeGeometry(x)})),this.transformNodes.forEach((x=>{u&&!u(x)||this.scene.removeTransformNode(x)})),this.actionManagers.forEach((x=>{u&&!u(x)||this.scene.removeActionManager(x)})),this.textures.forEach((x=>{u&&!u(x)||this.scene.removeTexture(x)})),this.reflectionProbes.forEach((x=>{u&&!u(x)||this.scene.removeReflectionProbe(x)}))}dispose(){this.cameras.slice(0).forEach((u=>{u.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((u=>{u.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((u=>{u.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((u=>{u.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((u=>{u.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((u=>{u.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((u=>{u.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((u=>{u.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((u=>{u.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((u=>{u.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((u=>{u.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((u=>{u.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((u=>{u.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const u of this.scene._serializableComponents)u.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(u,x,s){if(u&&x)for(const U of u){let u=!0;if(s)for(const x of s)if(U===x){u=!1;break}u&&(x.push(U),U._parentContainer=this)}}moveAllFromScene(u){this._wasAddedToScene=!1,void 0===u&&(u=new j);for(const x in this)Object.prototype.hasOwnProperty.call(this,x)&&(this[x]=this[x]||("_environmentTexture"===x?null:[]),this._moveAssets(this.scene[x],this[x],u[x]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()}createRootMesh(){const u=new _.e("assetContainerRootMesh",this.scene);return this.meshes.forEach((x=>{x.parent||u.addChild(x)})),this.meshes.unshift(u),u}mergeAnimationsTo(u=L.q.LastCreatedScene,x,s=null){if(!u)return I.V.Error("No scene available to merge animations to"),[];const U=s||(x=>{let s=null;const U=x.animations.length?x.animations[0].targetProperty:"",_=x.name.split(".").join("").split("_primitive")[0];switch(U){case"position":case"rotationQuaternion":s=u.getTransformNodeByName(x.name)||u.getTransformNodeByName(_);break;case"influence":s=u.getMorphTargetByName(x.name)||u.getMorphTargetByName(_);break;default:s=u.getNodeByName(x.name)||u.getNodeByName(_)}return s});this.getNodes().forEach((u=>{const x=U(u);if(null!==x){for(const s of u.animations){const u=x.animations.filter((u=>u.targetProperty===s.targetProperty));for(const s of u){const u=x.animations.indexOf(s,0);u>-1&&x.animations.splice(u,1)}}x.animations=x.animations.concat(u.animations)}}));const _=[];return this.animationGroups.slice().forEach((u=>{_.push(u.clone(u.name,U)),u.animatables.forEach((u=>{u.stop()}))})),x.forEach((x=>{const s=U(x.target);s&&(u.beginAnimation(s,x.fromFrame,x.toFrame,x.loopAnimation,x.speedRatio,x.onAnimationEnd?x.onAnimationEnd:void 0,void 0,!0,void 0,x.onAnimationLoop?x.onAnimationLoop:void 0),u.stopAnimation(x.target))})),_}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.transformNodes.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.lights.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)})),this.cameras.forEach((u=>{u.parent||-1!==this.rootNodes.indexOf(u)||this.rootNodes.push(u)}))}addAllAssetsToContainer(u){if(!u)return;const x=[],s=new Set;for(x.push(u);x.length>0;){const u=x.pop();if(u instanceof _.e?(u.geometry&&-1===this.geometries.indexOf(u.geometry)&&this.geometries.push(u.geometry),this.meshes.push(u)):u instanceof W.V?this.transformNodes.push(u):u instanceof k.v?this.lights.push(u):u instanceof i.i&&this.cameras.push(u),u instanceof c.u){if(u.material&&-1===this.materials.indexOf(u.material)){this.materials.push(u.material);for(const x of u.material.getActiveTextures())-1===this.textures.indexOf(x)&&this.textures.push(x)}u.skeleton&&-1===this.skeletons.indexOf(u.skeleton)&&this.skeletons.push(u.skeleton),u.morphTargetManager&&-1===this.morphTargetManagers.indexOf(u.morphTargetManager)&&this.morphTargetManagers.push(u.morphTargetManager)}for(const U of u.getChildren())s.has(U)||x.push(U);s.add(u)}this.populateRootNodes()}}},869581:(u,x,s)=>{s.d(x,{b:()=>i});var U=s(297809),_=s(604910),W=s(760998),c=s(638113),I=s(395726),L=s(554014),J=s(337776);class k{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new c.cP,this._onClonedObservable=new c.cP}}class i{static AddNodeConstructor(u,x){this._NodeConstructors[u]=x}static Construct(u,x,s,U){const _=this._NodeConstructors[u];return _?_(x,s,U):null}set accessibilityTag(u){this._accessibilityTag=u,this.onAccessibilityTagChangedObservable.notifyObservers(u)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(u){this._nodeDataStorage._doNotSerialize=u}isDisposed(){return this._nodeDataStorage._isDisposed}set parent(u){if(this._parentNode===u)return;const x=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const x=this._parentNode._children.indexOf(this);-1!==x&&this._parentNode._children.splice(x,1),u||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=u,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),x||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(u){u.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const u=this._scene.rootNodes,x=u.length-1;u[this._nodeDataStorage._sceneRootNodesIndex]=u[x],u[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}getClassName(){return"Node"}set onDispose(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(u,x=null,s=!0){this._isDirty=!1,this._nodeDataStorage=new k,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new c.cP,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=_.uq.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new c.cP,this._onDisposeObserver=null,this._behaviors=new Array,this.name=u,this.id=u,this._scene=x||I.q.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),s&&this._addToSceneRootNodes()}getScene(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(u,x=!1){return-1!==this._behaviors.indexOf(u)||(u.init(),this._scene.isLoading&&!x?this._scene.onDataLoadedObservable.addOnce((()=>{u.attach(this)})):u.attach(this),this._behaviors.push(u)),this}removeBehavior(u){const x=this._behaviors.indexOf(u);return-1===x||(this._behaviors[x].detach(),this._behaviors.splice(x,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(u){for(const x of this._behaviors)if(x.name===u)return x;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(u){!u&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(u,x=!0){return this.parent?this.parent._getActionManagerForTrigger(u,!1):null}_updateCache(u){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(u=!1){return this._nodeDataStorage._isReady}markAsDirty(u){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(u=!0){return!1===u?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((u=>{u._syncParentEnabledState()}))}setEnabled(u){this._nodeDataStorage._isEnabled!==u&&(this._nodeDataStorage._isEnabled=u,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(u))}isDescendantOf(u){return!!this.parent&&(this.parent===u||this.parent.isDescendantOf(u))}_getDescendants(u,x=!1,s){if(this._children)for(let U=0;U<this._children.length;U++){const _=this._children[U];s&&!s(_)||u.push(_),x||_._getDescendants(u,!1,s)}}getDescendants(u,x){const s=[];return this._getDescendants(s,u,x),s}getChildMeshes(u,x){const s=[];return this._getDescendants(s,u,(u=>(!x||x(u))&&void 0!==u.cullingStrategy)),s}getChildren(u,x=!0){return this.getDescendants(x,u)}_setReady(u){u!==this._nodeDataStorage._isReady&&(u?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(u){for(let x=0;x<this.animations.length;x++){const s=this.animations[x];if(s.name===u)return s}return null}createAnimationRange(u,x,s){if(!this._ranges[u]){this._ranges[u]=i._AnimationRangeFactory(u,x,s);for(let U=0,_=this.animations.length;U<_;U++)this.animations[U]&&this.animations[U].createRange(u,x,s)}}deleteAnimationRange(u,x=!0){for(let s=0,U=this.animations.length;s<U;s++)this.animations[s]&&this.animations[s].deleteRange(u,x);this._ranges[u]=null}getAnimationRange(u){return this._ranges[u]||null}clone(u,x,s){const U=J.p.Clone((()=>new i(u,this.getScene())),this);if(x&&(U.parent=x),!s){const x=this.getDescendants(!0);for(let s=0;s<x.length;s++){const _=x[s];_.clone(u+"."+_.name,U)}}return U}getAnimationRanges(){const u=[];let x;for(x in this._ranges)u.push(this._ranges[x]);return u}beginAnimation(u,x,s,U){const _=this.getAnimationRange(u);return _?this._scene.beginAnimation(this,_.from,_.to,x,s,U):null}serializeAnimationRanges(){const u=[];for(const x in this._ranges){const s=this._ranges[x];if(!s)continue;const U={};U.name=x,U.from=s.from,U.to=s.to,u.push(U)}return u}computeWorldMatrix(u){return this._worldMatrix||(this._worldMatrix=_.uq.Identity()),this._worldMatrix}dispose(u,x=!1){if(this._nodeDataStorage._isDisposed=!0,!u){const s=this.getDescendants(!0);for(const U of s)U.dispose(u,x)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const u of this._behaviors)u.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(u,x,s){if(x.ranges)for(let s=0;s<x.ranges.length;s++){const U=x.ranges[s];u.createAnimationRange(U.name,U.from,U.to)}}getHierarchyBoundingVectors(u=!0,x=null){let s,U;this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);const W=this;if(W.getBoundingInfo&&W.subMeshes){const u=W.getBoundingInfo();s=u.boundingBox.minimumWorld.clone(),U=u.boundingBox.maximumWorld.clone()}else s=new _.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new _.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(u){const u=this.getDescendants(!1);for(const W of u){const u=W;if(u.computeWorldMatrix(!0),x&&!x(u))continue;if(!u.getBoundingInfo||0===u.getTotalVertices())continue;const c=u.getBoundingInfo().boundingBox,I=c.minimumWorld,L=c.maximumWorld;_.Pq.CheckExtends(I,s,U),_.Pq.CheckExtends(L,s,U)}}return{min:s,max:U}}}i._AnimationRangeFactory=(u,x,s)=>{throw L.n("AnimationRange")},i._NodeConstructors={},U.Cg([W.lK()],i.prototype,"name",void 0),U.Cg([W.lK()],i.prototype,"id",void 0),U.Cg([W.lK()],i.prototype,"uniqueId",void 0),U.Cg([W.lK()],i.prototype,"state",void 0),U.Cg([W.lK()],i.prototype,"metadata",void 0)},889460:(u,x,s)=>{s.d(x,{Z:()=>X,F:()=>z});var U=s(898973),_=s(488354),W=s(638113),c=s(293506),I=s(867741),L=s(443401),J=s(604910),k=s(837475),i=s(239590),d=s(384898),j=s(79160),r=s(35259),D=s(848287),$=s(809319),H=s(122030),f=s(394501),O=s(395726),t=s(554014),V=s(706211),N=s(806630),m=s(834255),b=s(725378),n=s(276759);class F{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(u){this._singleClick=u}set doubleClick(u){this._doubleClick=u}set hasSwiped(u){this._hasSwiped=u}set ignore(u){this._ignore=u}}class B{constructor(u){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new J.I9(0,0),this._previousStartingPointerPosition=new J.I9(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=u||O.q.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(u){return this._meshUnderPointerId[u]||null}get unTranslatedPointer(){return new J.I9(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(u){this._pointerX=u}get pointerY(){return this._pointerY}set pointerY(u){this._pointerY=u}_updatePointerPosition(u){const x=this._scene.getEngine().getInputElementClientRect();x&&(this._pointerX=u.clientX-x.left,this._pointerY=u.clientY-x.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(u,x){const s=this._scene,U=s.getEngine(),_=U.getInputElement();_&&(_.tabIndex=U.canvasTabIndex,s.doNotHandleCursors||(_.style.cursor=s.defaultCursor)),this._setCursorAndPointerOverMesh(u,x,s);for(const U of s._pointerMoveStage){const s=!!(null==(u=u||this._pickMove(x))?void 0:u.pickedMesh);u=U.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,s,_)}const W=x.inputIndex>=b.ST.MouseWheelX&&x.inputIndex<=b.ST.MouseWheelZ?V.Zp.POINTERWHEEL:V.Zp.POINTERMOVE;let c;s.onPointerMove&&(u=u||this._pickMove(x),s.onPointerMove(x,u,W)),u?(c=new V.mx(W,x,u),this._setRayOnPointerInfo(u,x)):(c=new V.mx(W,x,null,this),this._movePointerInfo=c),s.onPointerObservable.hasObservers()&&s.onPointerObservable.notifyObservers(c,W)}_setRayOnPointerInfo(u,x){const s=this._scene;u&&s._pickingAvailable&&(u.ray||(u.ray=s.createPickingRay(x.offsetX,x.offsetY,J.uq.Identity(),s.activeCamera)))}_addCameraPointerObserver(u,x){return this._cameraObserverCount++,this._scene.onPointerObservable.add(u,x)}_removeCameraPointerObserver(u){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(u)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(u,x,s){const U=this._scene,_=new V.tT(s,x,this._unTranslatedPointerX,this._unTranslatedPointerY);return u&&(_.originalPickingInfo=u,_.ray=u.ray,"xr-near"===x.pointerType&&u.originMesh&&(_.nearInteractionPickingInfo=u)),U.onPrePointerObservable.notifyObservers(_,s),!!_.skipOnPointerObservable}_pickMove(u){const x=this._scene,s=x.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,x.pointerMovePredicate,x.pointerMoveFastCheck,x.cameraToUseForPointers,x.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(s,u,x),s}_setCursorAndPointerOverMesh(u,x,s){const U=s.getEngine().getInputElement();if(null==u?void 0:u.pickedMesh){if(this.setPointerOverMesh(u.pickedMesh,x.pointerId,u,x),!s.doNotHandleCursors&&U&&this._pointerOverMesh){const u=this._pointerOverMesh._getActionManagerForTrigger();u&&u.hasPointerTriggers&&(U.style.cursor=u.hoverCursor||s.hoverCursor)}}else this.setPointerOverMesh(null,x.pointerId,u,x)}simulatePointerMove(u,x){const s=new PointerEvent("pointermove",x);s.inputIndex=b.ST.Move,this._checkPrePointerObservable(u,s,V.Zp.POINTERMOVE)||this._processPointerMove(u,s)}simulatePointerDown(u,x){const s=new PointerEvent("pointerdown",x);s.inputIndex=s.button+2,this._checkPrePointerObservable(u,s,V.Zp.POINTERDOWN)||this._processPointerDown(u,s)}_processPointerDown(u,x){const s=this._scene;if(null==u?void 0:u.pickedMesh){this._pickedDownMesh=u.pickedMesh;const U=u.pickedMesh._getActionManagerForTrigger();if(U){if(U.hasPickTriggers)switch(U.processTrigger(5,r.X.CreateNew(u.pickedMesh,x,u)),x.button){case 0:U.processTrigger(2,r.X.CreateNew(u.pickedMesh,x,u));break;case 1:U.processTrigger(4,r.X.CreateNew(u.pickedMesh,x,u));break;case 2:U.processTrigger(3,r.X.CreateNew(u.pickedMesh,x,u))}U.hasSpecificTrigger(8)&&window.setTimeout((()=>{const u=s.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,(u=>u.isPickable&&u.isVisible&&u.isReady()&&u.actionManager&&u.actionManager.hasSpecificTrigger(8)&&u===this._pickedDownMesh),!1,s.cameraToUseForPointers);(null==u?void 0:u.pickedMesh)&&U&&0!==this._totalPointersPressed&&Date.now()-this._startingPointerTime>B.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,U.processTrigger(8,r.X.CreateNew(u.pickedMesh,x)))}),B.LongPressDelay)}}else for(const U of s._pointerDownStage)u=U.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,x,!1);let U;const _=V.Zp.POINTERDOWN;u?(s.onPointerDown&&s.onPointerDown(x,u,_),U=new V.mx(_,x,u),this._setRayOnPointerInfo(u,x)):U=new V.mx(_,x,null,this),s.onPointerObservable.hasObservers()&&s.onPointerObservable.notifyObservers(U,_)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(u,x,s){const U=new PointerEvent("pointerup",x);U.inputIndex=b.ST.Move;const _=new F;s?_.doubleClick=!0:_.singleClick=!0,this._checkPrePointerObservable(u,U,V.Zp.POINTERUP)||this._processPointerUp(u,U,_)}_processPointerUp(u,x,s){const U=this._scene;if(null==u?void 0:u.pickedMesh){if(this._pickedUpMesh=u.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(U.onPointerPick&&U.onPointerPick(x,u),s.singleClick&&!s.ignore&&U.onPointerObservable.observers.length>this._cameraObserverCount)){const s=V.Zp.POINTERPICK,_=new V.mx(s,x,u);this._setRayOnPointerInfo(u,x),U.onPointerObservable.notifyObservers(_,s)}const _=u.pickedMesh._getActionManagerForTrigger();if(_&&!s.ignore){_.processTrigger(7,r.X.CreateNew(u.pickedMesh,x,u)),!s.hasSwiped&&s.singleClick&&_.processTrigger(1,r.X.CreateNew(u.pickedMesh,x,u));const U=u.pickedMesh._getActionManagerForTrigger(6);s.doubleClick&&U&&U.processTrigger(6,r.X.CreateNew(u.pickedMesh,x,u))}}else if(!s.ignore)for(const _ of U._pointerUpStage)u=_.action(this._unTranslatedPointerX,this._unTranslatedPointerY,u,x,s.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const u=this._pickedDownMesh._getActionManagerForTrigger(16);u&&u.processTrigger(16,r.X.CreateNew(this._pickedDownMesh,x))}if(!s.ignore){const _=new V.mx(V.Zp.POINTERUP,x,u);if(this._setRayOnPointerInfo(u,x),U.onPointerObservable.notifyObservers(_,V.Zp.POINTERUP),U.onPointerUp&&U.onPointerUp(x,u,V.Zp.POINTERUP),!s.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let _=0;if(s.singleClick?_=V.Zp.POINTERTAP:s.doubleClick&&(_=V.Zp.POINTERDOUBLETAP),_){const s=new V.mx(_,x,u);U.onPointerObservable.hasObservers()&&U.onPointerObservable.hasSpecificMask(_)&&U.onPointerObservable.notifyObservers(s,_)}}}}isPointerCaptured(u=0){return this._pointerCaptures[u]}attachControl(u=!0,x=!0,s=!0,U=null){const _=this._scene,W=_.getEngine();U||(U=W.getInputElement()),this._alreadyAttached&&this.detachControl(),U&&(this._alreadyAttachedTo=U),this._deviceSourceManager=new n.Z(W),this._initActionManager=u=>{if(!this._meshPickProceed){const x=_.skipPointerUpPicking||0===_._registeredActions&&!this._checkForPicking()&&!_.onPointerUp?null:_.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,_.pointerUpPredicate,_.pointerUpFastCheck,_.cameraToUseForPointers,_.pointerUpTrianglePredicate);this._currentPickResult=x,x&&(u=x.hit&&x.pickedMesh?x.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return u},this._delayedSimpleClick=(u,x,s)=>{if((Date.now()-this._previousStartingPointerTime>B.DoubleClickDelay&&!this._doubleClickOccured||u!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,x.singleClick=!0,x.ignore=!1,this._delayedClicks[u])){const x=this._delayedClicks[u].evt,s=V.Zp.POINTERTAP,U=new V.mx(s,x,this._currentPickResult);_.onPointerObservable.hasObservers()&&_.onPointerObservable.hasSpecificMask(s)&&_.onPointerObservable.notifyObservers(U,s),this._delayedClicks[u]=null}},this._initClickEvent=(u,x,s,U)=>{var _,W;const c=new F;this._currentPickResult=null;let I=null,L=u.hasSpecificMask(V.Zp.POINTERPICK)||x.hasSpecificMask(V.Zp.POINTERPICK)||u.hasSpecificMask(V.Zp.POINTERTAP)||x.hasSpecificMask(V.Zp.POINTERTAP)||u.hasSpecificMask(V.Zp.POINTERDOUBLETAP)||x.hasSpecificMask(V.Zp.POINTERDOUBLETAP);!L&&N.G&&(I=this._initActionManager(I,c),I&&(L=I.hasPickTriggers));let J=!1;if(L){const L=s.button;if(c.hasSwiped=this._isPointerSwiping(),!c.hasSwiped){let k=!B.ExclusiveDoubleClickMode;if(k||(k=!u.hasSpecificMask(V.Zp.POINTERDOUBLETAP)&&!x.hasSpecificMask(V.Zp.POINTERDOUBLETAP),k&&!N.G.HasSpecificTrigger(6)&&(I=this._initActionManager(I,c),I&&(k=!I.hasSpecificTrigger(6)))),k)(Date.now()-this._previousStartingPointerTime>B.DoubleClickDelay||L!==this._previousButtonPressed)&&(c.singleClick=!0,U(c,this._currentPickResult),J=!0);else{const u={evt:s,clickInfo:c,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,L,c,U),B.DoubleClickDelay)};this._delayedClicks[L]=u}let i=u.hasSpecificMask(V.Zp.POINTERDOUBLETAP)||x.hasSpecificMask(V.Zp.POINTERDOUBLETAP);!i&&N.G.HasSpecificTrigger(6)&&(I=this._initActionManager(I,c),I&&(i=I.hasSpecificTrigger(6))),i&&(L===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<B.DoubleClickDelay&&!this._doubleClickOccured?(c.hasSwiped||this._isPointerSwiping()?(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=L,B.ExclusiveDoubleClickMode?(this._delayedClicks[L]&&(clearTimeout(null===(W=this._delayedClicks[L])||void 0===W?void 0:W.timeoutId),this._delayedClicks[L]=null),U(c,this._previousPickResult)):U(c,this._currentPickResult)):(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,c.doubleClick=!0,c.ignore=!1,B.ExclusiveDoubleClickMode&&this._delayedClicks[L]&&(clearTimeout(null===(_=this._delayedClicks[L])||void 0===_?void 0:_.timeoutId),this._delayedClicks[L]=null),U(c,this._currentPickResult)),J=!0):(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=L))}}J||U(c,this._currentPickResult)},this._onPointerMove=u=>{if(this._updatePointerPosition(u),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>B.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>B.DragMovementThreshold),W.isPointerLock&&W._verifyPointerLock(),this._checkPrePointerObservable(null,u,u.inputIndex>=b.ST.MouseWheelX&&u.inputIndex<=b.ST.MouseWheelZ?V.Zp.POINTERWHEEL:V.Zp.POINTERMOVE))return;if(!_.cameraToUseForPointers&&!_.activeCamera)return;if(_.skipPointerMovePicking)return void this._processPointerMove(new j.G,u);_.pointerMovePredicate||(_.pointerMovePredicate=u=>u.isPickable&&u.isVisible&&u.isReady()&&u.isEnabled()&&(u.enablePointerMoveEvents||_.constantlyUpdateMeshUnderPointer||null!==u._getActionManagerForTrigger())&&(!_.cameraToUseForPointers||!!(_.cameraToUseForPointers.layerMask&u.layerMask)));const x=_._registeredActions>0||_.constantlyUpdateMeshUnderPointer?this._pickMove(u):null;this._processPointerMove(x,u)},this._onPointerDown=u=>{var x;if(this._totalPointersPressed++,this._pickedDownMesh=null,this._meshPickProceed=!1,B.ExclusiveDoubleClickMode)for(let s=0;s<this._delayedClicks.length;s++)if(this._delayedClicks[s])if(u.button===s)clearTimeout(null===(x=this._delayedClicks[s])||void 0===x?void 0:x.timeoutId);else{const u=this._delayedClicks[s].clickInfo;this._doubleClickOccured=!1,u.singleClick=!0,u.ignore=!1;const x=this._delayedClicks[s].evt,U=V.Zp.POINTERTAP,W=new V.mx(U,x,this._currentPickResult);_.onPointerObservable.hasObservers()&&_.onPointerObservable.hasSpecificMask(U)&&_.onPointerObservable.notifyObservers(W,U),this._delayedClicks[s]=null}if(this._updatePointerPosition(u),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=u.button),_.preventDefaultOnPointerDown&&U&&(u.preventDefault(),U.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,u,V.Zp.POINTERDOWN))return;if(!_.cameraToUseForPointers&&!_.activeCamera)return;let s;this._pointerCaptures[u.pointerId]=!0,_.pointerDownPredicate||(_.pointerDownPredicate=u=>u.isPickable&&u.isVisible&&u.isReady()&&u.isEnabled()&&(!_.cameraToUseForPointers||!!(_.cameraToUseForPointers.layerMask&u.layerMask))),this._pickedDownMesh=null,s=_.skipPointerDownPicking||0===_._registeredActions&&!this._checkForPicking()&&!_.onPointerDown?new j.G:_.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,_.pointerDownPredicate,_.pointerDownFastCheck,_.cameraToUseForPointers,_.pointerDownTrianglePredicate),this._processPointerDown(s,u)},this._onPointerUp=u=>{0!==this._totalPointersPressed&&(this._totalPointersPressed--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(u),_.preventDefaultOnPointerUp&&U&&(u.preventDefault(),U.focus()),this._initClickEvent(_.onPrePointerObservable,_.onPointerObservable,u,((x,s)=>{if(_.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!x.ignore)){if(this._checkPrePointerObservable(null,u,V.Zp.POINTERUP))return this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===u.buttons&&(this._pointerCaptures[u.pointerId]=!1));x.hasSwiped||(x.singleClick&&_.onPrePointerObservable.hasSpecificMask(V.Zp.POINTERTAP)&&this._checkPrePointerObservable(null,u,V.Zp.POINTERTAP)&&(this._skipPointerTap=!0),x.doubleClick&&_.onPrePointerObservable.hasSpecificMask(V.Zp.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,u,V.Zp.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[u.pointerId]?(0===u.buttons&&(this._pointerCaptures[u.pointerId]=!1),(_.cameraToUseForPointers||_.activeCamera)&&(_.pointerUpPredicate||(_.pointerUpPredicate=u=>u.isPickable&&u.isVisible&&u.isReady()&&u.isEnabled()&&(!_.cameraToUseForPointers||!!(_.cameraToUseForPointers.layerMask&u.layerMask))),!this._meshPickProceed&&(N.G&&N.G.HasTriggers||this._checkForPicking()||_.onPointerUp)&&this._initActionManager(null,x),s||(s=this._currentPickResult),this._processPointerUp(s,u,x),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===u.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=u=>{const x=m.TB.KEYDOWN;if(_.onPreKeyboardObservable.hasObservers()){const s=new m.Bu(x,u);if(_.onPreKeyboardObservable.notifyObservers(s,x),s.skipOnKeyboardObservable)return}if(_.onKeyboardObservable.hasObservers()){const s=new m.W0(x,u);_.onKeyboardObservable.notifyObservers(s,x)}_.actionManager&&_.actionManager.processTrigger(14,r.X.CreateNewFromScene(_,u))},this._onKeyUp=u=>{const x=m.TB.KEYUP;if(_.onPreKeyboardObservable.hasObservers()){const s=new m.Bu(x,u);if(_.onPreKeyboardObservable.notifyObservers(s,x),s.skipOnKeyboardObservable)return}if(_.onKeyboardObservable.hasObservers()){const s=new m.W0(x,u);_.onKeyboardObservable.notifyObservers(s,x)}_.actionManager&&_.actionManager.processTrigger(15,r.X.CreateNewFromScene(_,u))},this._deviceSourceManager.onDeviceConnectedObservable.add((U=>{U.deviceType===b.bq.Mouse?U.onInputChangedObservable.add((_=>{this._originMouseEvent=_,_.inputIndex===b.ST.LeftClick||_.inputIndex===b.ST.MiddleClick||_.inputIndex===b.ST.RightClick||_.inputIndex===b.ST.BrowserBack||_.inputIndex===b.ST.BrowserForward?x&&1===U.getInput(_.inputIndex)?this._onPointerDown(_):u&&0===U.getInput(_.inputIndex)&&this._onPointerUp(_):s&&(_.inputIndex===b.ST.Move?this._onPointerMove(_):_.inputIndex!==b.ST.MouseWheelX&&_.inputIndex!==b.ST.MouseWheelY&&_.inputIndex!==b.ST.MouseWheelZ||this._onPointerMove(_))})):U.deviceType===b.bq.Touch?U.onInputChangedObservable.add((_=>{_.inputIndex===b.ST.LeftClick&&(x&&1===U.getInput(_.inputIndex)?(this._onPointerDown(_),this._totalPointersPressed>1&&(this._isMultiTouchGesture=!0)):u&&0===U.getInput(_.inputIndex)&&(this._onPointerUp(_),0===this._totalPointersPressed&&(this._isMultiTouchGesture=!1))),s&&_.inputIndex===b.ST.Move&&this._onPointerMove(_)})):U.deviceType===b.bq.Keyboard&&U.onInputChangedObservable.add((u=>{"keydown"===u.type?this._onKeyDown(u):"keyup"===u.type&&this._onKeyUp(u)}))})),this._alreadyAttached=!0}detachControl(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(u,x=0,s,U){if(!(this._meshUnderPointerId[x]!==u||u&&u._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const _=this._meshUnderPointerId[x];let W;_&&(W=_._getActionManagerForTrigger(10),W&&W.processTrigger(10,r.X.CreateNew(_,U,{pointerId:x}))),u?(this._meshUnderPointerId[x]=u,this._pointerOverMesh=u,W=u._getActionManagerForTrigger(9),W&&W.processTrigger(9,r.X.CreateNew(u,U,{pointerId:x,pickResult:s}))):(delete this._meshUnderPointerId[x],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(u){this._pointerOverMesh===u&&(this._pointerOverMesh=null),this._pickedDownMesh===u&&(this._pickedDownMesh=null),this._pickedUpMesh===u&&(this._pickedUpMesh=null);for(const x in this._meshUnderPointerId)this._meshUnderPointerId[x]===u&&delete this._meshUnderPointerId[x]}}B.DragMovementThreshold=10,B.LongPressDelay=500,B.DoubleClickDelay=300,B.ExclusiveDoubleClickMode=!1;var Z=s(850327),v=s(332290),y=s(993739),e=s(233637),T=s(435683),Q=s(875830),E=s(967872);class l{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.skipPointerMovePicking=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var z,S=s(706400),R=s(310035);(function(u){u[u["BackwardCompatible"]=0]="BackwardCompatible",u[u["Intermediate"]=1]="Intermediate",u[u["Aggressive"]=2]="Aggressive"})(z||(z={}));class X extends k.d{static DefaultMaterialFactory(u){throw t.n("StandardMaterial")}static CollisionCoordinatorFactory(){throw t.n("DefaultCollisionCoordinator")}get environmentTexture(){return this._environmentTexture}set environmentTexture(u){this._environmentTexture!==u&&(this._environmentTexture=u,this.markAllMaterialsAsDirty(1))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(u){if(u!==this._performancePriority){switch(this._performancePriority=u,u){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!1,this.autoClear=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.skipPointerMovePicking=!0,this.autoClear=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.skipPointerMovePicking=!0,this.autoClear=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(u)}}set forceWireframe(u){this._forceWireframe!==u&&(this._forceWireframe=u,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(u){this._skipFrustumClipping!==u&&(this._skipFrustumClipping=u)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(u){this._forcePointsCloud!==u&&(this._forcePointsCloud=u,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(u){this._animationPropertiesOverride=u}set onDispose(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)}set beforeRender(u){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),u&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(u))}set afterRender(u){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),u&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(u))}set beforeCameraRender(u){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(u)}set afterCameraRender(u){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(u)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(u){this._pointerPickingConfiguration.pointerDownPredicate=u}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(u){this._pointerPickingConfiguration.pointerUpPredicate=u}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(u){this._pointerPickingConfiguration.pointerMovePredicate=u}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(u){this._pointerPickingConfiguration.pointerDownFastCheck=u}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(u){this._pointerPickingConfiguration.pointerUpFastCheck=u}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(u){this._pointerPickingConfiguration.pointerMoveFastCheck=u}get skipPointerMovePicking(){return this._pointerPickingConfiguration.skipPointerMovePicking}set skipPointerMovePicking(u){this._pointerPickingConfiguration.skipPointerMovePicking=u}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(u){this._pointerPickingConfiguration.skipPointerDownPicking=u}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(u){this._pointerPickingConfiguration.skipPointerUpPicking=u}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return B.DragMovementThreshold}static set DragMovementThreshold(u){B.DragMovementThreshold=u}static get LongPressDelay(){return B.LongPressDelay}static set LongPressDelay(u){B.LongPressDelay=u}static get DoubleClickDelay(){return B.DoubleClickDelay}static set DoubleClickDelay(u){B.DoubleClickDelay=u}static get ExclusiveDoubleClickMode(){return B.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(u){B.ExclusiveDoubleClickMode=u}bindEyePosition(u,x="vEyePosition",s=!1){const U=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,_=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return J.AA.Vector4[0].set(U.x,U.y,U.z,_?-1:1),u&&(s?u.setFloat3(x,J.AA.Vector4[0].x,J.AA.Vector4[0].y,J.AA.Vector4[0].z):u.setVector4(x,J.AA.Vector4[0])),J.AA.Vector4[0]}finalizeSceneUbo(){const u=this.getSceneUniformBuffer(),x=this.bindEyePosition(null);return u.updateFloat4("vEyePosition",x.x,x.y,x.z,x.w),u.update(),u}set useRightHandedSystem(u){this._useRightHandedSystem!==u&&(this._useRightHandedSystem=u,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(u){this._currentStepId=u}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(u){this._fogEnabled!==u&&(this._fogEnabled=u,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(u){this._fogMode!==u&&(this._fogMode=u,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(u){this._shadowsEnabled!==u&&(this._shadowsEnabled=u,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(u){this._lightsEnabled!==u&&(this._lightsEnabled=u,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(u){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),u&&(this._unObserveActiveCameras=E.lL(u,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=u}get activeCamera(){return this._activeCamera}set activeCamera(u){u!==this._activeCamera&&(this._activeCamera=u,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this._defaultMaterial||(this._defaultMaterial=X.DefaultMaterialFactory(this)),this._defaultMaterial}set defaultMaterial(u){this._defaultMaterial=u}set texturesEnabled(u){this._texturesEnabled!==u&&(this._texturesEnabled=u,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}set skeletonsEnabled(u){this._skeletonsEnabled!==u&&(this._skeletonsEnabled=u,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=X.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const u of this._transientComponents)u.register();this._transientComponents.length=0}}_addComponent(u){this._components.push(u),this._transientComponents.push(u);const x=u;x.addFromContainer&&x.serialize&&this._serializableComponents.push(x)}_getComponent(u){for(const x of this._components)if(x.name===u)return x;return null}constructor(u,x){super(),this._inputManager=new B(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new v.ov(.2,.2,.3,1),this.ambientColor=new v.v9(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new W.cP,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.onDisposeObservable=new W.cP,this._onDisposeObserver=null,this.onBeforeRenderObservable=new W.cP,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new W.cP,this.onAfterRenderCameraObservable=new W.cP,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new W.cP,this.onAfterAnimationsObservable=new W.cP,this.onBeforeDrawPhaseObservable=new W.cP,this.onAfterDrawPhaseObservable=new W.cP,this.onReadyObservable=new W.cP,this.onBeforeCameraRenderObservable=new W.cP,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new W.cP,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new W.cP,this.onAfterActiveMeshesEvaluationObservable=new W.cP,this.onBeforeParticlesRenderingObservable=new W.cP,this.onAfterParticlesRenderingObservable=new W.cP,this.onDataLoadedObservable=new W.cP,this.onNewCameraAddedObservable=new W.cP,this.onCameraRemovedObservable=new W.cP,this.onNewLightAddedObservable=new W.cP,this.onLightRemovedObservable=new W.cP,this.onNewGeometryAddedObservable=new W.cP,this.onGeometryRemovedObservable=new W.cP,this.onNewTransformNodeAddedObservable=new W.cP,this.onTransformNodeRemovedObservable=new W.cP,this.onNewMeshAddedObservable=new W.cP,this.onMeshRemovedObservable=new W.cP,this.onNewSkeletonAddedObservable=new W.cP,this.onSkeletonRemovedObservable=new W.cP,this.onNewMaterialAddedObservable=new W.cP,this.onNewMultiMaterialAddedObservable=new W.cP,this.onMaterialRemovedObservable=new W.cP,this.onMultiMaterialRemovedObservable=new W.cP,this.onNewTextureAddedObservable=new W.cP,this.onTextureRemovedObservable=new W.cP,this.onBeforeRenderTargetsRenderObservable=new W.cP,this.onAfterRenderTargetsRenderObservable=new W.cP,this.onBeforeStepObservable=new W.cP,this.onAfterStepObservable=new W.cP,this.onActiveCameraChanged=new W.cP,this.onActiveCamerasChanged=new W.cP,this.onBeforeRenderingGroupObservable=new W.cP,this.onAfterRenderingGroupObservable=new W.cP,this.onMeshImportedObservable=new W.cP,this.onAnimationFileImportedObservable=new W.cP,this._registeredForLateAnimationBindings=new c.b(256),this._pointerPickingConfiguration=new l,this.onPrePointerObservable=new W.cP,this.onPointerObservable=new W.cP,this.onPreKeyboardObservable=new W.cP,this.onKeyboardObservable=new W.cP,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=X.FOGMODE_NONE,this.fogColor=new v.v9(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new J.Pq(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new c.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new Z.A,this._activeIndices=new Z.A,this._activeParticles=new Z.A,this._activeBones=new Z.A,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new c.L(256),this._processedMaterials=new c.L(256),this._renderTargets=new c.b(256),this._materialsRenderTargets=new c.b(256),this._activeParticleSystems=new c.L(256),this._activeSkeletons=new c.b(32),this._softwareSkinnedMeshes=new c.b(32),this._activeAnimatables=new Array,this._transformMatrix=J.uq.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=H.B.Create(),this._beforeClearStage=H.B.Create(),this._beforeRenderTargetClearStage=H.B.Create(),this._gatherRenderTargetsStage=H.B.Create(),this._gatherActiveCameraRenderTargetsStage=H.B.Create(),this._isReadyForMeshStage=H.B.Create(),this._beforeEvaluateActiveMeshStage=H.B.Create(),this._evaluateSubMeshStage=H.B.Create(),this._preActiveMeshStage=H.B.Create(),this._cameraDrawRenderTargetStage=H.B.Create(),this._beforeCameraDrawStage=H.B.Create(),this._beforeRenderTargetDrawStage=H.B.Create(),this._beforeRenderingGroupDrawStage=H.B.Create(),this._beforeRenderingMeshStage=H.B.Create(),this._afterRenderingMeshStage=H.B.Create(),this._afterRenderingGroupDrawStage=H.B.Create(),this._afterCameraDrawStage=H.B.Create(),this._afterCameraPostProcessStage=H.B.Create(),this._afterRenderTargetDrawStage=H.B.Create(),this._afterRenderTargetPostProcessStage=H.B.Create(),this._afterRenderStage=H.B.Create(),this._pointerMoveStage=H.B.Create(),this._pointerDownStage=H.B.Create(),this._pointerUpStage=H.B.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const s={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...x};u=this._engine=u||O.q.LastCreatedEngine,s.virtual?u._virtualScenes.push(this):(O.q._LastCreatedScene=this,u.scenes.push(this)),this._uid=null,this._renderingManager=new $.m(this),D.X&&(this.postProcessManager=new D.X(this)),f.BA()&&this.attachControl(),this._createUbo(),i.p&&(this._imageProcessingConfiguration=new i.p),this.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=s.useMaterialMeshMap,this.useClonedMeshMap=s.useClonedMeshMap,x&&x.virtual||u.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(u){return this._defaultSubMeshCandidates.data=u.subMeshes,this._defaultSubMeshCandidates.length=u.subMeshes.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=u=>this._getDefaultSubMeshCandidates(u),this.getIntersectingSubMeshCandidates=(u,x)=>this._getDefaultSubMeshCandidates(u),this.getCollidingSubMeshCandidates=(u,x)=>this._getDefaultSubMeshCandidates(u)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(u){this._inputManager.pointerX=u}get pointerY(){return this._inputManager.pointerY}set pointerY(u){this._inputManager.pointerY=u}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(u,x,s=1){return this._cachedEffect!==x||this._cachedMaterial!==u||this._cachedVisibility!==s}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(u,x){return this._inputManager.simulatePointerMove(u,x),this}simulatePointerDown(u,x){return this._inputManager.simulatePointerDown(u,x),this}simulatePointerUp(u,x,s){return this._inputManager.simulatePointerUp(u,x,s),this}isPointerCaptured(u=0){return this._inputManager.isPointerCaptured(u)}attachControl(u=!0,x=!0,s=!0){this._inputManager.attachControl(u,x,s)}detachControl(){this._inputManager.detachControl()}isReady(u=!0){var x,s,U;if(this._isDisposed)return!1;let _;const W=this.getEngine(),c=W.currentRenderPassId;W.currentRenderPassId=null!==(s=null===(x=this.activeCamera)||void 0===x?void 0:x.renderPassId)&&void 0!==s?s:c;let I=!0;for(this._pendingData.length>0&&(I=!1),null===(U=this.prePassRenderer)||void 0===U||U.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&I&&(I=this.depthPeelingRenderer.isReady()),u&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),_=0;_<this.meshes.length;_++){const x=this.meshes[_];if(!x.subMeshes||0===x.subMeshes.length)continue;if(!x.isReady(!0)){I=!1;continue}const s=x.hasThinInstances||"InstancedMesh"===x.getClassName()||"InstancedLinesMesh"===x.getClassName()||W.getCaps().instancedArrays&&x.instances.length>0;for(const u of this._isReadyForMeshStage)u.action(x,s)||(I=!1);if(!u)continue;const U=x.material||this.defaultMaterial;if(U)if(U._storeEffectOnSubMeshes)for(const u of x.subMeshes){const x=u.getMaterial();x&&x.hasRenderTargetTextures&&null!=x.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(x)&&(this._processedMaterials.push(x),this._materialsRenderTargets.concatWithNoDuplicate(x.getRenderTargetTextures()))}else U.hasRenderTargetTextures&&null!=U.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(U)&&(this._processedMaterials.push(U),this._materialsRenderTargets.concatWithNoDuplicate(U.getRenderTargetTextures()))}if(u)for(_=0;_<this._materialsRenderTargets.length;++_)this._materialsRenderTargets.data[_].isReadyForRendering()||(I=!1);for(_=0;_<this.geometries.length;_++)2===this.geometries[_].delayLoadState&&(I=!1);if(this.activeCameras&&this.activeCameras.length>0)for(const u of this.activeCameras)u.isReady(!0)||(I=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(I=!1));for(const u of this.particleSystems)u.isReady()||(I=!1);if(this.layers)for(const u of this.layers)u.isReady()||(I=!1);return W.areAllEffectsReady()||(I=!1),W.currentRenderPassId=c,I}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(u){this.onBeforeRenderObservable.add(u)}unregisterBeforeRender(u){this.onBeforeRenderObservable.removeCallback(u)}registerAfterRender(u){this.onAfterRenderObservable.add(u)}unregisterAfterRender(u){this.onAfterRenderObservable.removeCallback(u)}_executeOnceBeforeRender(u){const x=()=>{u(),setTimeout((()=>{this.unregisterBeforeRender(x)}))};this.registerBeforeRender(x)}executeOnceBeforeRender(u,x){void 0!==x?setTimeout((()=>{this._executeOnceBeforeRender(u)}),x):this._executeOnceBeforeRender(u)}addPendingData(u){this._pendingData.push(u)}removePendingData(u){const x=this.isLoading,s=this._pendingData.indexOf(u);-1!==s&&this._pendingData.splice(s,1),x&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(u,x=!1){this.onReadyObservable.addOnce(u),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(x)}whenReadyAsync(u=!1){return new Promise((x=>{this.executeWhenReady((()=>{x()}),u)}))}_checkIsReady(u=!1){return this._registerTransientComponents(),this.isReady(u)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(u)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=_.j.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(u,x,s,U){s||U||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===u.updateFlag&&this._projectionUpdateFlag===x.updateFlag||(this._viewUpdateFlag=u.updateFlag,this._projectionUpdateFlag=x.updateFlag,this._viewMatrix=u,this._projectionMatrix=x,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?y.P.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=y.P.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(s,U):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(u){const x=new d.D(this._engine,void 0,!1,null!=u?u:"scene");return x.addUniform("viewProjection",16),x.addUniform("view",16),x.addUniform("projection",16),x.addUniform("vEyePosition",4),x}setSceneUniformBuffer(u){this._sceneUbo=u,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return e.K.UniqueId}addMesh(u,x=!1){this._blockEntityCollection||(this.meshes.push(u),u._resyncLightSources(),u.parent||u._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(u),x&&u.getChildMeshes().forEach((u=>{this.addMesh(u)})))}removeMesh(u,x=!1){const s=this.meshes.indexOf(u);return-1!==s&&(this.meshes.splice(s,1),u.parent||u._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(u),this.onMeshRemovedObservable.notifyObservers(u),x&&u.getChildMeshes().forEach((u=>{this.removeMesh(u)})),s}addTransformNode(u){this._blockEntityCollection||u.getScene()===this&&-1!==u._indexInSceneTransformNodesArray||(u._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(u),u.parent||u._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(u))}removeTransformNode(u){const x=u._indexInSceneTransformNodesArray;if(-1!==x){if(x!==this.transformNodes.length-1){const u=this.transformNodes[this.transformNodes.length-1];this.transformNodes[x]=u,u._indexInSceneTransformNodesArray=x}u._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),u.parent||u._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(u),x}removeSkeleton(u){const x=this.skeletons.indexOf(u);return-1!==x&&(this.skeletons.splice(x,1),this.onSkeletonRemovedObservable.notifyObservers(u),this._executeActiveContainerCleanup(this._activeSkeletons)),x}removeMorphTargetManager(u){const x=this.morphTargetManagers.indexOf(u);return-1!==x&&this.morphTargetManagers.splice(x,1),x}removeLight(u){const x=this.lights.indexOf(u);if(-1!==x){for(const x of this.meshes)x._removeLightSource(u,!1);this.lights.splice(x,1),this.sortLightsByPriority(),u.parent||u._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(u),x}removeCamera(u){const x=this.cameras.indexOf(u);if(-1!==x&&(this.cameras.splice(x,1),u.parent||u._removeFromSceneRootNodes()),this.activeCameras){const x=this.activeCameras.indexOf(u);-1!==x&&this.activeCameras.splice(x,1)}return this.activeCamera===u&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(u),x}removeParticleSystem(u){const x=this.particleSystems.indexOf(u);return-1!==x&&(this.particleSystems.splice(x,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),x}removeAnimation(u){const x=this.animations.indexOf(u);return-1!==x&&this.animations.splice(x,1),x}stopAnimation(u,x,s){}removeAnimationGroup(u){const x=this.animationGroups.indexOf(u);return-1!==x&&this.animationGroups.splice(x,1),x}removeMultiMaterial(u){const x=this.multiMaterials.indexOf(u);return-1!==x&&this.multiMaterials.splice(x,1),this.onMultiMaterialRemovedObservable.notifyObservers(u),x}removeMaterial(u){const x=u._indexInSceneMaterialArray;if(-1!==x&&x<this.materials.length){if(x!==this.materials.length-1){const u=this.materials[this.materials.length-1];this.materials[x]=u,u._indexInSceneMaterialArray=x}u._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(u),x}removeActionManager(u){const x=this.actionManagers.indexOf(u);return-1!==x&&this.actionManagers.splice(x,1),x}removeTexture(u){const x=this.textures.indexOf(u);return-1!==x&&this.textures.splice(x,1),this.onTextureRemovedObservable.notifyObservers(u),x}addLight(u){if(!this._blockEntityCollection){this.lights.push(u),this.sortLightsByPriority(),u.parent||u._addToSceneRootNodes();for(const x of this.meshes)-1===x.lightSources.indexOf(u)&&(x.lightSources.push(u),x._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(u)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(Q.c.CompareLightsPriority)}addCamera(u){this._blockEntityCollection||(this.cameras.push(u),this.onNewCameraAddedObservable.notifyObservers(u),u.parent||u._addToSceneRootNodes())}addSkeleton(u){this._blockEntityCollection||(this.skeletons.push(u),this.onNewSkeletonAddedObservable.notifyObservers(u))}addParticleSystem(u){this._blockEntityCollection||this.particleSystems.push(u)}addAnimation(u){this._blockEntityCollection||this.animations.push(u)}addAnimationGroup(u){this._blockEntityCollection||this.animationGroups.push(u)}addMultiMaterial(u){this._blockEntityCollection||(this.multiMaterials.push(u),this.onNewMultiMaterialAddedObservable.notifyObservers(u))}addMaterial(u){this._blockEntityCollection||u.getScene()===this&&-1!==u._indexInSceneMaterialArray||(u._indexInSceneMaterialArray=this.materials.length,this.materials.push(u),this.onNewMaterialAddedObservable.notifyObservers(u))}addMorphTargetManager(u){this._blockEntityCollection||this.morphTargetManagers.push(u)}addGeometry(u){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=this.geometries.length),this.geometries.push(u))}addActionManager(u){this.actionManagers.push(u)}addTexture(u){this._blockEntityCollection||(this.textures.push(u),this.onNewTextureAddedObservable.notifyObservers(u))}switchActiveCamera(u,x=!0){this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=u,x&&u.attachControl())}setActiveCameraById(u){const x=this.getCameraById(u);return x?(this.activeCamera=x,x):null}setActiveCameraByName(u){const x=this.getCameraByName(u);return x?(this.activeCamera=x,x):null}getAnimationGroupByName(u){for(let x=0;x<this.animationGroups.length;x++)if(this.animationGroups[x].name===u)return this.animationGroups[x];return null}_getMaterial(u,x){for(let u=0;u<this.materials.length;u++){const s=this.materials[u];if(x(s))return s}if(u)for(let u=0;u<this.multiMaterials.length;u++){const s=this.multiMaterials[u];if(x(s))return s}return null}getMaterialByUniqueID(u,x=!1){return this._getMaterial(x,(x=>x.uniqueId===u))}getMaterialById(u,x=!1){return this._getMaterial(x,(x=>x.id===u))}getMaterialByName(u,x=!1){return this._getMaterial(x,(x=>x.name===u))}getLastMaterialById(u,x=!1){for(let x=this.materials.length-1;x>=0;x--)if(this.materials[x].id===u)return this.materials[x];if(x)for(let x=this.multiMaterials.length-1;x>=0;x--)if(this.multiMaterials[x].id===u)return this.multiMaterials[x];return null}getTextureByUniqueId(u){for(let x=0;x<this.textures.length;x++)if(this.textures[x].uniqueId===u)return this.textures[x];return null}getTextureByName(u){for(let x=0;x<this.textures.length;x++)if(this.textures[x].name===u)return this.textures[x];return null}getCameraById(u){for(let x=0;x<this.cameras.length;x++)if(this.cameras[x].id===u)return this.cameras[x];return null}getCameraByUniqueId(u){for(let x=0;x<this.cameras.length;x++)if(this.cameras[x].uniqueId===u)return this.cameras[x];return null}getCameraByName(u){for(let x=0;x<this.cameras.length;x++)if(this.cameras[x].name===u)return this.cameras[x];return null}getBoneById(u){for(let x=0;x<this.skeletons.length;x++){const s=this.skeletons[x];for(let x=0;x<s.bones.length;x++)if(s.bones[x].id===u)return s.bones[x]}return null}getBoneByName(u){for(let x=0;x<this.skeletons.length;x++){const s=this.skeletons[x];for(let x=0;x<s.bones.length;x++)if(s.bones[x].name===u)return s.bones[x]}return null}getLightByName(u){for(let x=0;x<this.lights.length;x++)if(this.lights[x].name===u)return this.lights[x];return null}getLightById(u){for(let x=0;x<this.lights.length;x++)if(this.lights[x].id===u)return this.lights[x];return null}getLightByUniqueId(u){for(let x=0;x<this.lights.length;x++)if(this.lights[x].uniqueId===u)return this.lights[x];return null}getParticleSystemById(u){for(let x=0;x<this.particleSystems.length;x++)if(this.particleSystems[x].id===u)return this.particleSystems[x];return null}getGeometryById(u){for(let x=0;x<this.geometries.length;x++)if(this.geometries[x].id===u)return this.geometries[x];return null}_getGeometryByUniqueId(u){if(this._geometriesByUniqueId){const x=this._geometriesByUniqueId[u];if(void 0!==x)return this.geometries[x]}else for(let x=0;x<this.geometries.length;x++)if(this.geometries[x].uniqueId===u)return this.geometries[x];return null}pushGeometry(u,x){return!(!x&&this._getGeometryByUniqueId(u.uniqueId)||(this.addGeometry(u),this.onNewGeometryAddedObservable.notifyObservers(u),0))}removeGeometry(u){let x;if(this._geometriesByUniqueId){if(x=this._geometriesByUniqueId[u.uniqueId],void 0===x)return!1}else if(x=this.geometries.indexOf(u),x<0)return!1;if(x!==this.geometries.length-1){const u=this.geometries[this.geometries.length-1];u&&(this.geometries[x]=u,this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=x))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[u.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(u),!0}getGeometries(){return this.geometries}getMeshById(u){for(let x=0;x<this.meshes.length;x++)if(this.meshes[x].id===u)return this.meshes[x];return null}getMeshesById(u){return this.meshes.filter((function(x){return x.id===u}))}getTransformNodeById(u){for(let x=0;x<this.transformNodes.length;x++)if(this.transformNodes[x].id===u)return this.transformNodes[x];return null}getTransformNodeByUniqueId(u){for(let x=0;x<this.transformNodes.length;x++)if(this.transformNodes[x].uniqueId===u)return this.transformNodes[x];return null}getTransformNodesById(u){return this.transformNodes.filter((function(x){return x.id===u}))}getMeshByUniqueId(u){for(let x=0;x<this.meshes.length;x++)if(this.meshes[x].uniqueId===u)return this.meshes[x];return null}getLastMeshById(u){for(let x=this.meshes.length-1;x>=0;x--)if(this.meshes[x].id===u)return this.meshes[x];return null}getLastTransformNodeById(u){for(let x=this.transformNodes.length-1;x>=0;x--)if(this.transformNodes[x].id===u)return this.transformNodes[x];return null}getLastEntryById(u){let x;for(x=this.meshes.length-1;x>=0;x--)if(this.meshes[x].id===u)return this.meshes[x];for(x=this.transformNodes.length-1;x>=0;x--)if(this.transformNodes[x].id===u)return this.transformNodes[x];for(x=this.cameras.length-1;x>=0;x--)if(this.cameras[x].id===u)return this.cameras[x];for(x=this.lights.length-1;x>=0;x--)if(this.lights[x].id===u)return this.lights[x];return null}getNodeById(u){const x=this.getMeshById(u);if(x)return x;const s=this.getTransformNodeById(u);if(s)return s;const U=this.getLightById(u);if(U)return U;const _=this.getCameraById(u);if(_)return _;return this.getBoneById(u)||null}getNodeByName(u){const x=this.getMeshByName(u);if(x)return x;const s=this.getTransformNodeByName(u);if(s)return s;const U=this.getLightByName(u);if(U)return U;const _=this.getCameraByName(u);if(_)return _;return this.getBoneByName(u)||null}getMeshByName(u){for(let x=0;x<this.meshes.length;x++)if(this.meshes[x].name===u)return this.meshes[x];return null}getTransformNodeByName(u){for(let x=0;x<this.transformNodes.length;x++)if(this.transformNodes[x].name===u)return this.transformNodes[x];return null}getLastSkeletonById(u){for(let x=this.skeletons.length-1;x>=0;x--)if(this.skeletons[x].id===u)return this.skeletons[x];return null}getSkeletonByUniqueId(u){for(let x=0;x<this.skeletons.length;x++)if(this.skeletons[x].uniqueId===u)return this.skeletons[x];return null}getSkeletonById(u){for(let x=0;x<this.skeletons.length;x++)if(this.skeletons[x].id===u)return this.skeletons[x];return null}getSkeletonByName(u){for(let x=0;x<this.skeletons.length;x++)if(this.skeletons[x].name===u)return this.skeletons[x];return null}getMorphTargetManagerById(u){for(let x=0;x<this.morphTargetManagers.length;x++)if(this.morphTargetManagers[x].uniqueId===u)return this.morphTargetManagers[x];return null}getMorphTargetById(u){for(let x=0;x<this.morphTargetManagers.length;++x){const s=this.morphTargetManagers[x];for(let x=0;x<s.numTargets;++x){const U=s.getTarget(x);if(U.id===u)return U}}return null}getMorphTargetByName(u){for(let x=0;x<this.morphTargetManagers.length;++x){const s=this.morphTargetManagers[x];for(let x=0;x<s.numTargets;++x){const U=s.getTarget(x);if(U.name===u)return U}}return null}getPostProcessByName(u){for(let x=0;x<this.postProcesses.length;++x){const s=this.postProcesses[x];if(s.name===u)return s}return null}isActiveMesh(u){return-1!==this._activeMeshes.indexOf(u)}get uid(){return this._uid||(this._uid=U.S0.RandomId()),this._uid}addExternalData(u,x){return this._externalData||(this._externalData=new I.w),this._externalData.add(u,x)}getExternalData(u){return this._externalData?this._externalData.get(u):null}getOrAddExternalDataWithFactory(u,x){return this._externalData||(this._externalData=new I.w),this._externalData.getOrAddWithFactory(u,x)}removeExternalData(u){return this._externalData.remove(u)}_evaluateSubMesh(u,x,s,U){if(U||u.isInFrustum(this._frustumPlanes)){for(const s of this._evaluateSubMeshStage)s.action(x,u);const s=u.getMaterial();null!=s&&(s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(u,x,s))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(u){this._preventFreeActiveMeshesAndRenderingGroups!==u&&(u&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=u)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let u=0;u<this.activeCameras.length;u++){const x=this.activeCameras[u];x&&x._activeMeshes&&x._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let u=0;u<this.textures.length;u++){const x=this.textures[u];x&&x.renderList&&x.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(u=!1,x,s,U=!0,_=!1){return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=_,this._skipEvaluateActiveMeshesCompletely=u,U)for(let u=0;u<this._activeMeshes.length;u++)this._activeMeshes.data[u]._freeze();x&&x()}else s&&s("No active camera found")})),this}unfreezeActiveMeshes(){for(let u=0;u<this.meshes.length;u++){const x=this.meshes[u];x._internalAbstractMeshDataInfo&&(x._internalAbstractMeshDataInfo._isActive=!1)}for(let u=0;u<this._activeMeshes.length;u++)this._activeMeshes.data[u]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(u){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>u.dispose()))}_evaluateActiveMeshes(){var u;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)return void(this._activeMeshes.length>0&&(null===(u=this.activeCamera)||void 0===u||u._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset()));if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const u=this._activeMeshes.length;for(let x=0;x<u;x++)this._activeMeshes.data[x].computeWorldMatrix()}if(this._activeParticleSystems){const u=this._activeParticleSystems.length;for(let x=0;x<u;x++)this._activeParticleSystems.data[x].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const u of this._beforeEvaluateActiveMeshStage)u.action();const x=this.getActiveMeshCandidates(),s=x.length;for(let u=0;u<s;u++){const s=x.data[u];if(s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,s.isBlocked)continue;if(this._totalVertices.addCount(s.getTotalVertices(),!1),!s.isReady()||!s.isEnabled()||s.scaling.hasAZeroComponent)continue;s.computeWorldMatrix(),s.actionManager&&s.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(s);let U=this.customLODSelector?this.customLODSelector(s,this.activeCamera):s.getLOD(this.activeCamera);if(s._internalAbstractMeshDataInfo._currentLOD=U,s._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,null!=U&&(U!==s&&0!==U.billboardMode&&U.computeWorldMatrix(),s._preActivate(),s.isVisible&&s.visibility>0&&s.layerMask&this.activeCamera.layerMask&&(this._skipFrustumClipping||s.alwaysSelectAsActiveMesh||s.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(s),this.activeCamera._activeMeshes.push(s),U!==s&&U._activate(this._renderId,!1);for(const u of this._preActiveMeshStage)u.action(s);s._activate(this._renderId,!1)&&(s.isAnInstance?s._internalAbstractMeshDataInfo._actAsRegularMesh&&(U=s):U._internalAbstractMeshDataInfo._onlyForInstances=!1,U._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(s,U)),s._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let u=0;u<this.particleSystems.length;u++){const x=this.particleSystems[u];if(!x.isStarted()||!x.emitter)continue;const s=x.emitter;s.position&&!s.isEnabled()||(this._activeParticleSystems.push(x),x.animate(),this._renderingManager.dispatchParticles(x))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_activeMesh(u,x){this._skeletonsEnabled&&null!==x.skeleton&&void 0!==x.skeleton&&(this._activeSkeletons.pushNoDuplicate(x.skeleton)&&(x.skeleton.prepare(),this._activeBones.addCount(x.skeleton.bones.length,!1)),x.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(x));let s=u.hasInstances||u.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||x.alwaysSelectAsActiveMesh;if(x&&x.subMeshes&&x.subMeshes.length>0){const U=this.getActiveSubMeshCandidates(x),_=U.length;s=s||1===_;for(let W=0;W<_;W++){const _=U.data[W];this._evaluateSubMesh(_,x,u,s)}}}updateTransformMatrix(u){const x=this.activeCamera;if(x)if(x._renderingMultiview){const s=x._rigCameras[0],U=x._rigCameras[1];this.setTransformMatrix(s.getViewMatrix(),s.getProjectionMatrix(u),U.getViewMatrix(),U.getProjectionMatrix(u))}else this.setTransformMatrix(x.getViewMatrix(),x.getProjectionMatrix(u))}_bindFrameBuffer(u,x=!0){u&&u._multiviewTexture?u._multiviewTexture._bindFrameBuffer():u&&u.outputRenderTarget?u.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),x&&this._clearFrameBuffer(u)}_clearFrameBuffer(u){if(u&&u._multiviewTexture);else if(u&&u.outputRenderTarget&&!u._renderingMultiview){const x=u.outputRenderTarget;x.onClearObservable.hasObservers()?x.onClearObservable.notifyObservers(this._engine):x.skipInitialClear||u.isRightCamera||(this.autoClear&&this._engine.clear(x.clearColor||this.clearColor,!x._cleared,!0,!0),x._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(u,x,s=!0){var _,W,c;if(u&&u._skipRendering)return;const I=this._engine;if(this._activeCamera=u,!this.activeCamera)throw new Error("Active camera not set");if(I.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&s){let x=!0;u._renderingMultiview&&u.outputRenderTarget&&(x=u.outputRenderTarget.skipInitialClear,this.autoClear&&(this._defaultFrameBufferCleared=!1,u.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),u._renderingMultiview&&u.outputRenderTarget&&(u.outputRenderTarget.skipInitialClear=x)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let u=0;u<this._softwareSkinnedMeshes.length;u++){const x=this._softwareSkinnedMeshes.data[u];x.applySkeleton(x.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),u.customRenderTargets&&u.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(u.customRenderTargets),x&&x.customRenderTargets&&x.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(x.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const u of this._gatherActiveCameraRenderTargetsStage)u.action(this._renderTargets);let L=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){U.S0.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let u=0;u<this._renderTargets.length;u++){const x=this._renderTargets.data[u];if(x._shouldRender()){this._renderId++;const u=x.activeCamera&&x.activeCamera!==this.activeCamera;x.render(u,this.dumpNextRenderTargets),L=!0}}U.S0.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const u of this._cameraDrawRenderTargetStage)L=u.action(this.activeCamera)||L;this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(c=null!==(W=null===(_=u.outputRenderTarget)||void 0===_?void 0:_.renderPassId)&&void 0!==W?W:u.renderPassId)&&void 0!==c?c:0,L&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||u._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const u of this._beforeCameraDrawStage)u.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),I.snapshotRendering&&1===I.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const u of this._afterCameraDrawStage)u.action(this.activeCamera);if(this.postProcessManager&&!u._multiviewTexture){const x=u.outputRenderTarget?u.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(u.isIntermediate,x)}for(const u of this._afterCameraPostProcessStage)u.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(u,x=!0){if(0===u.cameraRigMode||u._renderingMultiview)return u._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(u,void 0,x),void this.onAfterRenderCameraObservable.notifyObservers(u);if(u._useMultiviewToSingleView)this._renderMultiviewToSingleView(u);else{this.onBeforeCameraRenderObservable.notifyObservers(u);for(let x=0;x<u._rigCameras.length;x++)this._renderForCamera(u._rigCameras[x],u)}this._activeCamera=u,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(u)}_checkIntersections(){for(let u=0;u<this._meshesForIntersections.length;u++){const x=this._meshesForIntersections.data[u];if(x.actionManager)for(let u=0;x.actionManager&&u<x.actionManager.actions.length;u++){const s=x.actionManager.actions[u];if(12===s.trigger||13===s.trigger){const u=s.getTriggerParameter(),U=u.mesh?u.mesh:u,_=U.intersectsMesh(x,u.usePreciseIntersection),W=x._intersectionsInProgress.indexOf(U);_&&-1===W?12===s.trigger?(s._executeCurrent(r.X.CreateNew(x,void 0,U)),x._intersectionsInProgress.push(U)):13===s.trigger&&x._intersectionsInProgress.push(U):!_&&W>-1&&(13===s.trigger&&s._executeCurrent(r.X.CreateNew(x,void 0,U)),x.actionManager.hasSpecificTrigger(13,(u=>{const x=u.mesh?u.mesh:u;return U===x}))&&13!==s.trigger||x._intersectionsInProgress.splice(W,1))}}}}_advancePhysicsEngineStep(u){}_animate(u){}animate(){if(this._engine.isDeterministicLockStep()){let u=Math.max(X.MinDeltaTime,Math.min(this._engine.getDeltaTime(),X.MaxDeltaTime))+this._timeAccumulator;const x=this._engine.getTimeStep(),s=1e3/x/1e3;let U=0;const _=this._engine.getLockstepMaxSteps();let W=Math.floor(u/x);for(W=Math.min(W,_);u>0&&U<W;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=x*s,this._animate(x),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(x),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,U++,u-=x;this._timeAccumulator=u<0?0:u}else{const u=this.useConstantAnimationDeltaTime?16:Math.max(X.MinDeltaTime,Math.min(this._engine.getDeltaTime(),X.MaxDeltaTime));this._animationRatio=u*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(u)}}_clear(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(u){var x;if((null==u?void 0:u.outputRenderTarget)&&!(null==u?void 0:u.isRigCamera)&&(u.outputRenderTarget._cleared=!1),null===(x=null==u?void 0:u.rigCameras)||void 0===x?void 0:x.length)for(let x=0;x<u.rigCameras.length;++x){const s=u.rigCameras[x].outputRenderTarget;s&&(s._cleared=!1)}}resetDrawCache(u){if(this.meshes)for(const x of this.meshes)x.resetDrawCache(u)}render(u=!0,x=!1){var s,_,W;if(this.isDisposed)return;this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(s=this.activeCameras)||void 0===s?void 0:s.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),x||this.animate();for(const u of this._beforeCameraUpdateStage)u.action();if(u)if(this.activeCameras&&this.activeCameras.length>0)for(let u=0;u<this.activeCameras.length;u++){const x=this.activeCameras[u];if(x.update(),0!==x.cameraRigMode)for(let u=0;u<x._rigCameras.length;u++)x._rigCameras[u].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let u=0;u<this.activeCamera._rigCameras.length;u++)this.activeCamera._rigCameras[u].update();this.onBeforeRenderObservable.notifyObservers(this);const c=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const I=(null===(_=this.activeCameras)||void 0===_?void 0:_.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){U.S0.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let u=0;u<this.customRenderTargets.length;u++){const x=this.customRenderTargets[u];if(x._shouldRender()){if(this._renderId++,this.activeCamera=x.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");c.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),x.render(I!==this.activeCamera,this.dumpNextRenderTargets)}}U.S0.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(W=null==I?void 0:I.renderPassId)&&void 0!==W?W:0,this.activeCamera=I,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const u of this._beforeClearStage)u.action();this._clearFrameBuffer(this.activeCamera);for(const u of this._gatherRenderTargetsStage)u.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let u=0;u<this.activeCameras.length;u++)this._processSubCameras(this.activeCameras[u],u>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(const u of this._afterRenderStage)u.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let u=0;u<this._toBeDisposed.length;u++){const x=this._toBeDisposed[u];x&&x.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}freezeMaterials(){for(let u=0;u<this.materials.length;u++)this.materials[u].freeze()}unfreezeMaterials(){for(let u=0;u<this.materials.length;u++)this.materials[u].unfreeze()}dispose(){if(this.isDisposed)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this.stopAllAnimations&&(this._activeAnimatables.forEach((u=>{u.onAnimationEndObservable.clear(),u.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const u=this._activeRequests.slice();for(const x of u)x.abort();this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this)}catch(u){S.V.Error("An error occurred while calling onDisposeObservable!",u)}if(this.detachControl(),this._engine.getInputElement())for(let u=0;u<this.cameras.length;u++)this.cameras[u].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(u=>u.dispose(!0))),this._disposeList(this.transformNodes,(u=>u.dispose(!0)));const x=this.cameras;this._disposeList(x),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let s=this._engine.scenes.indexOf(this);s>-1&&this._engine.scenes.splice(s,1),O.q._LastCreatedScene===this&&(this._engine.scenes.length>0?O.q._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:O.q._LastCreatedScene=null),s=this._engine._virtualScenes.indexOf(this),s>-1&&this._engine._virtualScenes.splice(s,1),this._engine.wipeCaches(!0),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this._isDisposed=!0}_disposeList(u,x){const s=u.slice(0);x=null!=x?x:u=>u.dispose();for(const u of s)x(u);u.length=0}get isDisposed(){return this._isDisposed}clearCachedVertexData(){for(let u=0;u<this.meshes.length;u++){const x=this.meshes[u].geometry;x&&x.clearCachedData()}}cleanCachedTextureBuffer(){for(const u of this.textures)u._buffer&&(u._buffer=null)}getWorldExtends(u){const x=new J.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new J.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return u=u||(()=>!0),this.meshes.filter(u).forEach((u=>{if(u.computeWorldMatrix(!0),!u.subMeshes||0===u.subMeshes.length||u.infiniteDistance)return;const U=u.getBoundingInfo(),_=U.boundingBox.minimumWorld,W=U.boundingBox.maximumWorld;J.Pq.CheckExtends(_,x,s),J.Pq.CheckExtends(W,x,s)})),{min:x,max:s}}createPickingRay(u,x,s,U,_=!1){throw t.n("Ray")}createPickingRayToRef(u,x,s,U,_,W=!1,c=!1){throw t.n("Ray")}createPickingRayInCameraSpace(u,x,s){throw t.n("Ray")}createPickingRayInCameraSpaceToRef(u,x,s,U){throw t.n("Ray")}get _pickingAvailable(){return!1}pick(u,x,s,U,_,W){const c=t.n("Ray",!0);return c&&S.V.Warn(c),new j.G}pickWithBoundingInfo(u,x,s,U,_){const W=t.n("Ray",!0);return W&&S.V.Warn(W),new j.G}pickWithRay(u,x,s,U){throw t.n("Ray")}multiPick(u,x,s,U,_){throw t.n("Ray")}multiPickWithRay(u,x,s){throw t.n("Ray")}setPointerOverMesh(u,x,s){this._inputManager.setPointerOverMesh(u,x,s)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const u of this.geometries)u._rebuild();for(const u of this.meshes)u._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const u of this._components)u.rebuild();for(const u of this.particleSystems)u.rebuild();if(this.spriteManagers)for(const u of this.spriteManagers)u.rebuild()}_rebuildTextures(){for(const u of this.textures)u._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(u,x,s){if(void 0===x)return u;const U=[];for(const _ in u){const W=u[_];L.Y&&L.Y.MatchesQuery(W,x)&&(!s||s(W))&&U.push(W)}return U}getMeshesByTags(u,x){return this._getByTags(this.meshes,u,x)}getCamerasByTags(u,x){return this._getByTags(this.cameras,u,x)}getLightsByTags(u,x){return this._getByTags(this.lights,u,x)}getMaterialByTags(u,x){return this._getByTags(this.materials,u,x).concat(this._getByTags(this.multiMaterials,u,x))}getTransformNodesByTags(u,x){return this._getByTags(this.transformNodes,u,x)}setRenderingOrder(u,x=null,s=null,U=null){this._renderingManager.setRenderingOrder(u,x,s,U)}setRenderingAutoClearDepthStencil(u,x,s=!0,U=!0){this._renderingManager.setRenderingAutoClearDepthStencil(u,x,s,U)}getAutoClearDepthStencilSetup(u){return this._renderingManager.getAutoClearDepthStencilSetup(u)}_forceBlockMaterialDirtyMechanism(u){this._blockMaterialDirtyMechanism=u}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(u){this._blockMaterialDirtyMechanism!==u&&(this._blockMaterialDirtyMechanism=u,u||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(u,x){if(!this._blockMaterialDirtyMechanism)for(const s of this.materials)x&&!x(s)||s.markAsDirty(u)}_loadFile(u,x,s,U,_,W,c){const I=T.zU(u,x,s,U?this.offlineProvider:void 0,_,W,c);return this._activeRequests.push(I),I.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),I}_loadFileAsync(u,x,s,U,_){return new Promise(((W,c)=>{this._loadFile(u,(u=>{W(u)}),x,s,U,((u,x)=>{c(x)}),_)}))}_requestFile(u,x,s,U,_,W,c){const I=T.sh(u,x,s,U?this.offlineProvider:void 0,_,W,c);return this._activeRequests.push(I),I.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),I}_requestFileAsync(u,x,s,U,_){return new Promise(((W,c)=>{this._requestFile(u,(u=>{W(u)}),x,s,U,(u=>{c(u)}),_)}))}_readFile(u,x,s,U,_){const W=T.NJ(u,x,s,U,_);return this._activeRequests.push(W),W.onCompleteObservable.add((u=>{this._activeRequests.splice(this._activeRequests.indexOf(u),1)})),W}_readFileAsync(u,x,s){return new Promise(((U,_)=>{this._readFile(u,(u=>{U(u)}),x,s,(u=>{_(u)}))}))}getPerfCollector(){throw t.n("performanceViewerSceneExtension")}setActiveCameraByID(u){return this.setActiveCameraById(u)}getMaterialByID(u){return this.getMaterialById(u)}getLastMaterialByID(u){return this.getLastMaterialById(u)}getTextureByUniqueID(u){return this.getTextureByUniqueId(u)}getCameraByID(u){return this.getCameraById(u)}getCameraByUniqueID(u){return this.getCameraByUniqueId(u)}getBoneByID(u){return this.getBoneById(u)}getLightByID(u){return this.getLightById(u)}getLightByUniqueID(u){return this.getLightByUniqueId(u)}getParticleSystemByID(u){return this.getParticleSystemById(u)}getGeometryByID(u){return this.getGeometryById(u)}getMeshByID(u){return this.getMeshById(u)}getMeshByUniqueID(u){return this.getMeshByUniqueId(u)}getLastMeshByID(u){return this.getLastMeshById(u)}getMeshesByID(u){return this.getMeshesById(u)}getTransformNodeByID(u){return this.getTransformNodeById(u)}getTransformNodeByUniqueID(u){return this.getTransformNodeByUniqueId(u)}getTransformNodesByID(u){return this.getTransformNodesById(u)}getNodeByID(u){return this.getNodeById(u)}getLastEntryByID(u){return this.getLastEntryById(u)}getLastSkeletonByID(u){return this.getLastSkeletonById(u)}}X.FOGMODE_NONE=0,X.FOGMODE_EXP=1,X.FOGMODE_EXP2=2,X.FOGMODE_LINEAR=3,X.MinDeltaTime=1,X.MaxDeltaTime=1e3,R.Y5("BABYLON.Scene",X)},122030:(u,x,s)=>{s.d(x,{B:()=>_,v:()=>U});class U{}U.NAME_EFFECTLAYER="EffectLayer",U.NAME_LAYER="Layer",U.NAME_LENSFLARESYSTEM="LensFlareSystem",U.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",U.NAME_PARTICLESYSTEM="ParticleSystem",U.NAME_GAMEPAD="Gamepad",U.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",U.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",U.NAME_PREPASSRENDERER="PrePassRenderer",U.NAME_DEPTHRENDERER="DepthRenderer",U.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",U.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",U.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",U.NAME_SPRITE="Sprite",U.NAME_SUBSURFACE="SubSurface",U.NAME_OUTLINERENDERER="Outline",U.NAME_PROCEDURALTEXTURE="ProceduralTexture",U.NAME_SHADOWGENERATOR="ShadowGenerator",U.NAME_OCTREE="Octree",U.NAME_PHYSICSENGINE="PhysicsEngine",U.NAME_AUDIO="Audio",U.NAME_FLUIDRENDERER="FluidRenderer",U.STEP_ISREADYFORMESH_EFFECTLAYER=0,U.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,U.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,U.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,U.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,U.STEP_BEFORECAMERADRAW_PREPASS=0,U.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,U.STEP_BEFORECAMERADRAW_LAYER=2,U.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,U.STEP_BEFORERENDERTARGETDRAW_LAYER=1,U.STEP_BEFORERENDERINGMESH_PREPASS=0,U.STEP_BEFORERENDERINGMESH_OUTLINE=1,U.STEP_AFTERRENDERINGMESH_PREPASS=0,U.STEP_AFTERRENDERINGMESH_OUTLINE=1,U.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,U.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,U.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,U.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,U.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,U.STEP_BEFORECLEAR_PREPASS=1,U.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,U.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,U.STEP_AFTERRENDERTARGETDRAW_LAYER=1,U.STEP_AFTERCAMERADRAW_PREPASS=0,U.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,U.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,U.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,U.STEP_AFTERCAMERADRAW_LAYER=4,U.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,U.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,U.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,U.STEP_AFTERRENDER_AUDIO=0,U.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,U.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,U.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,U.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,U.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,U.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,U.STEP_POINTERMOVE_SPRITE=0,U.STEP_POINTERDOWN_SPRITE=0,U.STEP_POINTERUP_SPRITE=0;class _ extends Array{constructor(u){super(...u)}static Create(){return Object.create(_.prototype)}registerStep(u,x,s){let U=0,_=Number.MAX_VALUE;for(;U<this.length&&(_=this[U].index,!(u<_));U++);this.splice(U,0,{index:u,component:x,action:s.bind(x)})}clear(){this.length=0}}},297809:(u,x,s)=>{function U(u,x,s,U){var _,W=arguments.length,c=W<3?x:null===U?U=Object.getOwnPropertyDescriptor(x,s):U;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(u,x,s,U);else for(var I=u.length-1;I>=0;I--)(_=u[I])&&(c=(W<3?_(c):W>3?_(x,s,c):_(x,s))||c);return W>3&&c&&Object.defineProperty(x,s,c),c}s.d(x,{Cg:()=>U}),Object.create,Object.create},631567:(u,x,s)=>{s.d(x,{w:()=>H});var U=s(337776),_=s(332290),W=s(527335),c=s(235519),I=s(23987),L=s(889460),J=s(310035),k=s(395879);s(485914),s(849399),s(946159),s(149137),s(368969),s(733251),s(577766),s(684371),s(215327),s(109259),s(302064),s(512591),s(543881);const i=`precision highp float;uniform vec4 vEyePosition;uniform float alpha;uniform vec3 shadowColor;varying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);lightingInfo info;float shadow=1.;float glossiness=0.;float aggShadow=0.;float numLights=0.;\n#include<lightFragment>[0..1]\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}`;k.l.ShadersStore["shadowOnlyPixelShader"]=i,s(17106),s(191544),s(427139),s(602105),s(162441),s(216313),s(132434),s(243806),s(929801),s(389886),s(789433),s(286564);const d=`precision highp float;attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\nuniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<logDepthDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(position,1.0);gl_Position=viewProjection*worldPos;vPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n`;k.l.ShadersStore["shadowOnlyVertexShader"]=d;var j=s(522208),r=s(651577),D=s(855300);class $ extends W.M{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.NORMAL=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class H extends c.E{constructor(u,x){super(u,x),this._needAlphaBlending=!0,this.shadowColor=_.v9.Black()}needAlphaBlending(){return this._needAlphaBlending}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}get activeLight(){return this._activeLight}set activeLight(u){this._activeLight=u}_getFirstShadowLightForMesh(u){for(const x of u.lightSources)if(x.shadowEnabled)return x;return null}isReadyForSubMesh(u,x,s){var U;const _=x._drawWrapper;if(this.isFrozen&&_.effect&&_._wasPreviouslyReady&&_._wasPreviouslyUsingInstances===s)return!0;x.materialDefines||(x.materialDefines=new $);const W=x.materialDefines,c=this.getScene();if(this._isReadyForSubMesh(x))return!0;const L=c.getEngine();if(this._activeLight)for(const x of u.lightSources)if(x.shadowEnabled){if(this._activeLight===x)break;const s=u.lightSources.indexOf(this._activeLight);-1!==s&&(u.lightSources.splice(s,1),u.lightSources.splice(0,0,this._activeLight));break}D.OR(c,L,this,W,!!s),D.fm(u,c,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(u),W),W._needNormals=D.az(c,u,W,!1,1);const J=null===(U=this._getFirstShadowLightForMesh(u))||void 0===U?void 0:U.getShadowGenerator();if(this._needAlphaBlending=!0,J&&J.getClassName&&"CascadedShadowGenerator"===J.getClassName()){const u=J;this._needAlphaBlending=!u.autoCalcDepthBounds}if(D.qB(u,W,!1,!0),W.isDirty){W.markAsProcessed(),c.resetCachedMaterial();const s=new j.J;W.FOG&&s.addFallback(1,"FOG"),D.c4(W,s,1),W.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,u),W.IMAGEPROCESSINGPOSTPROCESS=c.imageProcessingConfiguration.applyByPostProcess;const U=[I.R.PositionKind];W.NORMAL&&U.push(I.R.NormalKind),D.ni(U,u,W,s),D.ER(U,W);const _="shadowOnly",J=W.toString(),k=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","logarithmicDepthConstant"],i=[],d=[];r.TV(k),D.Bb({uniformsNames:k,uniformBuffersNames:d,samplers:i,defines:W,maxSimultaneousLights:1}),x.setEffect(c.getEngine().createEffect(_,{attributes:U,uniformsNames:k,uniformBuffersNames:d,samplers:i,defines:J,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},L),W,this._materialContext)}return!(!x.effect||!x.effect.isReady()||(W._renderId=c.getRenderId(),_._wasPreviouslyReady=!0,_._wasPreviouslyUsingInstances=!!s,0))}bindForSubMesh(u,x,s){const U=this.getScene(),_=s.materialDefines;if(!_)return;const W=s.effect;if(W){if(this._activeEffect=W,this.bindOnlyWorldMatrix(u),this._activeEffect.setMatrix("viewProjection",U.getTransformMatrix()),D.f$(x,this._activeEffect),this._mustRebind(U,W,s)&&(r.gS(W,this,U),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),this._useLogarithmicDepth&&D.DL(_,W,U),U.bindEyePosition(W)),U.lightsEnabled){D.RL(U,x,this._activeEffect,_,1);const u=this._getFirstShadowLightForMesh(x);u&&(u._renderId=-1)}(U.fogEnabled&&x.applyFog&&U.fogMode!==L.Z.FOGMODE_NONE||_["SHADOWCSM0"])&&this._activeEffect.setMatrix("view",U.getViewMatrix()),D.Yy(U,x,this._activeEffect),this._afterBind(x,this._activeEffect,s)}}clone(u){return U.p.Clone((()=>new H(u,this.getScene())),this)}serialize(){const u=super.serialize();return u.customType="BABYLON.ShadowOnlyMaterial",u}getClassName(){return"ShadowOnlyMaterial"}static Parse(u,x,s){return U.p.Parse((()=>new H(u.name,x)),u,x,s)}}J.Y5("BABYLON.ShadowOnlyMaterial",H)}}]);
//# sourceMappingURL=https://sourcemaps.egcdn.com/frontend/evo/r2/js/commons.rng.ed909f1d.js.map