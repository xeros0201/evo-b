var k9={withStackTrace:!1},_6=(Z,$,J=k9)=>{let Q=$.isOk()?{type:"Ok",value:$.value}:{type:"Err",value:$.error},K=J.withStackTrace?new Error().stack:void 0;return{data:Q,message:Z,stack:K}};function b0(Z,$,J,Q){function K(H){return H instanceof J?H:new J(function(X){X(H)})}return new(J||(J=Promise))(function(H,X){function z(G){try{W(Q.next(G))}catch(O){X(O)}}function Y(G){try{W(Q.throw(G))}catch(O){X(O)}}function W(G){G.done?H(G.value):K(G.value).then(z,Y)}W((Q=Q.apply(Z,$||[])).next())})}function h6(Z){var $=typeof Symbol==="function"&&Symbol.iterator,J=$&&Z[$],Q=0;if(J)return J.call(Z);if(Z&&typeof Z.length==="number")return{next:function(){if(Z&&Q>=Z.length)Z=void 0;return{value:Z&&Z[Q++],done:!Z}}};throw new TypeError($?"Object is not iterable.":"Symbol.iterator is not defined.")}function MZ(Z){return this instanceof MZ?(this.v=Z,this):new MZ(Z)}function S9(Z,$,J){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Q=J.apply(Z,$||[]),K,H=[];return K={},X("next"),X("throw"),X("return"),K[Symbol.asyncIterator]=function(){return this},K;function X(q){if(Q[q])K[q]=function(B){return new Promise(function(T,w){H.push([q,B,T,w])>1||z(q,B)})}}function z(q,B){try{Y(Q[q](B))}catch(T){O(H[0][3],T)}}function Y(q){q.value instanceof MZ?Promise.resolve(q.value.v).then(W,G):O(H[0][2],q)}function W(q){z("next",q)}function G(q){z("throw",q)}function O(q,B){if(q(B),H.shift(),H.length)z(H[0][0],H[0][1])}}function R9(Z){var $,J;return $={},Q("next"),Q("throw",function(K){throw K}),Q("return"),$[Symbol.iterator]=function(){return this},$;function Q(K,H){$[K]=Z[K]?function(X){return(J=!J)?{value:MZ(Z[K](X)),done:K==="return"}:H?H(X):X}:H}}function P9(Z){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $=Z[Symbol.asyncIterator],J;return $?$.call(Z):(Z=typeof h6==="function"?h6(Z):Z[Symbol.iterator](),J={},Q("next"),Q("throw"),Q("return"),J[Symbol.asyncIterator]=function(){return this},J);function Q(H){J[H]=Z[H]&&function(X){return new Promise(function(z,Y){X=Z[H](X),K(z,Y,X.done,X.value)})}}function K(H,X,z,Y){Promise.resolve(Y).then(function(W){H({value:W,done:z})},X)}}class m{constructor(Z){this._promise=Z}static fromSafePromise(Z){let $=Z.then((J)=>new jZ(J));return new m($)}static fromPromise(Z,$){let J=Z.then((Q)=>new jZ(Q)).catch((Q)=>new CZ($(Q)));return new m(J)}static combine(Z){return I9(Z)}static combineWithAllErrors(Z){return x9(Z)}map(Z){return new m(this._promise.then(($)=>b0(this,void 0,void 0,function*(){if($.isErr())return new CZ($.error);return new jZ(yield Z($.value))})))}mapErr(Z){return new m(this._promise.then(($)=>b0(this,void 0,void 0,function*(){if($.isOk())return new jZ($.value);return new CZ(yield Z($.error))})))}andThen(Z){return new m(this._promise.then(($)=>{if($.isErr())return new CZ($.error);let J=Z($.value);return J instanceof m?J._promise:J}))}orElse(Z){return new m(this._promise.then(($)=>b0(this,void 0,void 0,function*(){if($.isErr())return Z($.error);return new jZ($.value)})))}match(Z,$){return this._promise.then((J)=>J.match(Z,$))}unwrapOr(Z){return this._promise.then(($)=>$.unwrapOr(Z))}safeUnwrap(){return S9(this,arguments,function*Z(){return yield MZ(yield MZ(yield*R9(P9(yield MZ(this._promise.then(($)=>$.safeUnwrap()))))))})}then(Z,$){return this._promise.then(Z,$)}}var kZ=(Z)=>new m(Promise.resolve(new jZ(Z))),NZ=(Z)=>new m(Promise.resolve(new CZ(Z))),SZ=m.fromPromise,T4=m.fromSafePromise,E9=(Z)=>($)=>[...$,Z],y6=(Z)=>Z.reduce(($,J)=>$.isOk()?J.isErr()?j(J.error):$.map(E9(J.value)):$,F([])),I9=(Z)=>m.fromSafePromise(Promise.all(Z)).andThen(y6),b6=(Z)=>Z.reduce(($,J)=>J.isErr()?$.isErr()?j([...$.error,J.error]):j([J.error]):$.isErr()?$:F([...$.value,J.value]),F([])),x9=(Z)=>m.fromSafePromise(Promise.all(Z)).andThen(b6),f0;(function(Z){function $(K,H){return(...X)=>{try{let z=K(...X);return F(z)}catch(z){return j(H?H(z):z)}}}Z.fromThrowable=$;function J(K){return y6(K)}Z.combine=J;function Q(K){return b6(K)}Z.combineWithAllErrors=Q})(f0||(f0={}));var F=(Z)=>new jZ(Z),j=(Z)=>new CZ(Z);function L4(Z){let $=Z().next();if($ instanceof Promise)return $.then((J)=>J.value);return $.value}class jZ{constructor(Z){this.value=Z}isOk(){return!0}isErr(){return!this.isOk()}map(Z){return F(Z(this.value))}mapErr(Z){return F(this.value)}andThen(Z){return Z(this.value)}orElse(Z){return F(this.value)}asyncAndThen(Z){return Z(this.value)}asyncMap(Z){return m.fromSafePromise(Z(this.value))}unwrapOr(Z){return this.value}match(Z,$){return Z(this.value)}safeUnwrap(){let Z=this.value;return function*(){return Z}()}_unsafeUnwrap(Z){return this.value}_unsafeUnwrapErr(Z){throw _6("Called `_unsafeUnwrapErr` on an Ok",this,Z)}}class CZ{constructor(Z){this.error=Z}isOk(){return!1}isErr(){return!this.isOk()}map(Z){return j(this.error)}mapErr(Z){return j(Z(this.error))}andThen(Z){return j(this.error)}orElse(Z){return Z(this.error)}asyncAndThen(Z){return NZ(this.error)}asyncMap(Z){return NZ(this.error)}unwrapOr(Z){return Z}match(Z,$){return $(this.error)}safeUnwrap(){let Z=this.error;return function*(){throw yield j(Z),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(Z){throw _6("Called `_unsafeUnwrap` on an Err",this,Z)}_unsafeUnwrapErr(Z){return this.error}}var A4=f0.fromThrowable;function f6(Z){return[...new Set(Z)]}function v0(Z){return[...Array(Z).keys()]}var{keys:eZ,entries:pZ,fromEntries:N4}=Object;function YZ(Z,$){return Object.prototype.hasOwnProperty.call(Z,$)}function f(Z,$){return $ in Z}function D(Z,$,J){Object.defineProperty(Z,$,J)}function k4(Z){return Object.getPrototypeOf(Z)}function v6(Z,$){return Object.getOwnPropertyDescriptor(Z,$)}function g6(Z){return Object.getOwnPropertyNames(Z)}function g0(Z,$){return Object.assign(Z,$)}function P4(Z=navigator.userAgent){return Z.includes("Safari")&&!Z.includes("Chrome")}function h9(Z){if(Z===void 0){if(typeof navigator==="undefined")return!1;Z=navigator.userAgent}return Z.includes("Firefox")}var RZ=h9();function _9(Z,$){if(Z===void 0)if(typeof navigator==="undefined")return!1;else Z=navigator.userAgent;if($===void 0)if(typeof window==="undefined")return!1;else $=window;return/iPad|iPhone|iPod/.test(Z)&&!YZ($,"MSStream")}function m6(){return typeof navigator!=="undefined"&&navigator.userAgent!==void 0&&navigator.userAgent.match(/like Mac OS X/)!==null&&navigator.userAgent.match(/OS 14/)!==null}var E4=_9();function x4(Z,$){return Math.max(Z,$)}function h4(Z,$){return Math.min(Z,$)}function U(Z,$,J){return Math.min(Math.max(Z,$),J)}function _4(Z){return U(Z,0,1)}function f4(Z){try{new Z}catch($){return!1}return!0}class y9 extends Error{constructor(){super(...arguments);Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AssertionError"})}}function Z0(Z){return!b9(Z)}function b9(Z){return Z===void 0}function v4(Z){return Object.keys(Z).length===0}function f9(Z){return!d6(Z)}function g4(Z){return Z0(Z)&&f9(Z)}function d6(Z){return Z===null}function DZ(Z){return typeof Z==="object"&&!d6(Z)}function fZ(Z){return Array.isArray(Z)}function m4(Z){return Z===!0}function d4(Z){return Z===!1}function v9(Z){return Z.length===0}function c4(Z){return!v9(Z)}function p4(Z){return Array.isArray(Z)&&Z.length>0}function UZ(Z){return typeof Z==="number"&&!isNaN(Z)}function u4(Z){return typeof Z==="function"}function g9(Z){return typeof Z==="string"}function l4(Z,$){return eZ($).includes(Z)}function i4(Z){if(UZ(Z))return!0;if(g9(Z))return m9(Z);return!1}function m9(Z){return!isNaN(parseFloat(Z))}function m0(Z){if(fZ(Z))return Z.map(($)=>m0($));else if(Z instanceof Date)return new Date(Z.getTime());else if(DZ(Z))return g6(Z).reduce(($,J)=>{let Q=v6(Z,J);return D($,J,Q),$[J]=m0(Z[J]),$},Object.create(Object.getPrototypeOf(Z)));return Z}function c6(Z){return m0(Z)}var d0=0.03,a4=30,t4=10,e4=10,d="master",e="OUTPUT",c0=20,p0=0.00001,u0=-1,l0=1,p6=10,ZJ=20000,v=0.0001,$J=1,ZZ=1,JJ=10,u6=1000,l6=340282346638528860000000000000000000000,i6=-340282346638528860000000000000000000000,s6=40,r6=-40,n6=0,o6=1,a6=0,t6=40,e6=1,Z8=20,$8=1,J8=0,Q8=-100,K8=0,QJ={DEFAULT_STOP:"default_stop",POOL_STOP:"pool_stop",POOL_PLAY:"pool_play",POOL_PAUSE:"pool_pause",POOL_RESUME:"pool_resume",SOUND_START:"sound_start",SOUND_STOP:"sound_stop",SOUND_PAUSE:"sound_pause",SOUND_RESUME:"sound_resume",SOUND_COMPLETE:"sound_completed",PATTERN_PLAY:"pattern_play",PATTERN_STOP:"pattern_stop",PATTERN_RESUME:"pattern_resume",PATTERN_PAUSE:"pattern_pause",PATTERN:"pattern",STOP:"stop",MIXER_PLAY_SOUND:"mixer_playSound",ENVELOPE_SCHEDULED:"envelope_scheduled",SCHEDULED:"scheduled",SCHEDULED_REGEX:"scheduled_(.)+",DISCONNECT:"disconnect",VOLUME:"volume",CROSSFADE:"crossfade",PLAY:"play"};function C(Z){return Z instanceof Error?Z:new Error(JSON.stringify(Z))}function H8(Z){return j(C(Z))}function M(Z){return j(new Error(Z))}function i0(Z){return NZ(new Error(Z))}function XJ(Z){return NZ(C(Z))}class X8{constructor(){Object.defineProperty(this,"map",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}addEventListener(Z,$,J){var Q;let K=this.map,H=K.get(Z),X=(Q=J===null||J===void 0?void 0:J.once)!==null&&Q!==void 0?Q:!1;if(H===void 0)K.set(Z,[[$,X]]);else H.push([$,X])}removeEventListener(Z,$){let J=this.map.get(Z);if(J===void 0)return;for(let Q=0;Q<J.length;Q++)if(J[Q][0]===$){J.splice(Q,1);return}}dispatchEvent(Z){let $=Z.type,J=this.map.get($);if(J===void 0)return!0;for(let Q=0;Q<J.length;Q++){let[K,H]=J[Q];if(K(Z),H)this.removeEventListener($,K),Q--}return!0}dispose(){this.map.clear()}}class uZ extends X8{dispatch(Z,$){if(this.map.get(Z)===void 0)return!0;else return this.dispatchEvent({type:Z,detail:$})}}function PZ(){if(Promise.withResolvers!==void 0)return Promise.withResolvers();let Z,$;return{promise:new Promise((K,H)=>{Z=K,$=H}),resolve:Z,reject:$}}function qJ(Z){try{let J=window.location.hash.substring(1).split("&");for(let Q of J){let[K,H]=Q.split("=");if(K===Z&&H!==void 0)return F(H)}return j(new Error(`[ecas] failed to get fragment value key: ${Z} not found`))}catch($){return j(new Error(`[ecas] failed to get fragment value for key: ${Z} due to error: ${C($).message}`))}}function d9(Z){return{get:($)=>{let J=Z.get($);if(J===void 0)return j(new Error(`[ecas] ${String($)} not found`));return F(J)}}}function $0(Z){let{hash:$="",search:J=""}=Z!==null&&Z!==void 0?Z:typeof window==="undefined"?{hash:"",search:""}:window.location,Q=z8($),K=z8(J),H=[...Q,...K],X=Array.from(new Set(H)),z=d9(new Map(X));return{get:(Y)=>{let W=Y.toLowerCase().replaceAll("-","");return z.get(W)}}}function z8(Z){return Z.toLowerCase().replaceAll("?","").replaceAll("#","").replaceAll("-","").split("&").map(($)=>{var J;let Q=$.split("=");return[Q[0],(J=Q[1])!==null&&J!==void 0?J:"none"]}).filter(($)=>$!==void 0)}function OJ(Z,...$){if($.length===0)return Z;let J=Z.endsWith("/")?Z.slice(0,-1):Z;return J.startsWith("http")?[J,$.map((Q)=>Q.replace(/\/+/g,"")).join("/")].join("/"):[J,...$].join("/").replace(/\/+/g,"/")}function jJ(Z){return c9(Z)}function DJ(Z){return p9(Z)}function c9(Z){return Math.pow(10,0.05*Z)}function p9(Z){if(Z===0)return-1000;return 20*Math.log10(Z)}function UJ(...Z){let $=Number(0);for(let J of Z){let Q=Number(J);if(Number.isFinite(Q))$+=Q}return $}function wJ(Z,$){let J=0,Q=Number(Z),K=Number($);if(Number.isFinite(Q))J=Q;if(Number.isFinite(K))J-=K;return J}function c(){return}class s0{constructor(...Z){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.items=[...Z].sort(($,J)=>J.priority-$.priority)}enqueue(Z){let $=this.findIndex((J)=>J.priority<Z.priority);if($===void 0)this.items.push(Z);else this.items.splice($,0,Z)}dequeue(){return this.dequeueIndex(0)}dequeueLast(){return this.dequeueIndex(this.items.length-1)}dequeueIndex(Z){return this.items.splice(Z,1)[0]}dequeueOneByPredicate(Z){let $=this.findIndex(Z);return $===void 0?void 0:this.dequeueIndex($)}dequeueByPredicate(Z){let $=this.findIndexes(Z),J=0;return $.map((Q)=>this.dequeueIndex(Q-J++))}last(){return this.items[this.items.length-1]}first(){return this.items[0]}clear(){this.items.splice(0,this.items.length)}findIndex(Z){let $=this.items.findIndex(Z);return $>-1?$:void 0}findIndexes(Z){let $=[];for(let[J,Q]of this.items.entries())if(Z(Q))$.push(J);return $}removeIndex(Z){this.items.splice(Z,1)}removeByPredicate(Z){let $=this.findIndex(Z);if($!==void 0)this.removeIndex($)}get length(){return this.items.length}get highestPriority(){var Z,$;return($=(Z=this.items[0])===null||Z===void 0?void 0:Z.priority)!==null&&$!==void 0?$:-Number.MAX_SAFE_INTEGER}get lowestPriority(){var Z,$;return($=(Z=this.items[this.items.length-1])===null||Z===void 0?void 0:Z.priority)!==null&&$!==void 0?$:-Number.MAX_SAFE_INTEGER}*drain(){let Z=this.items.shift();while(Z!==void 0)yield Z,Z=this.items.shift()}*next(){for(let Z of this.items)yield Z}}class J0{constructor(...Z){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.items=[...Z]}enqueue(...Z){this.items.push(...Z)}dequeue(){return this.items.shift()}dequeueLast(){return this.items.pop()}dequeueIndex(Z){return this.items.splice(Z,1)[0]}dequeueOneByPredicate(Z){let $=this.findIndex(Z);return $===void 0?void 0:this.dequeueIndex($)}dequeueByPredicate(Z){let $=this.findIndexes(Z),J=0;return $.map((Q)=>this.dequeueIndex(Q-J++))}last(){return this.items[this.items.length-1]}first(){return this.items[0]}clear(){this.items.splice(0,this.items.length)}findIndex(Z){let $=this.items.findIndex(Z);return $>-1?$:void 0}findIndexes(Z){let $=[];for(let[J,Q]of this.items.entries())if(Z(Q))$.push(J);return $}removeIndex(Z){this.items.splice(Z,1)}removeByPredicate(Z){let $=this.findIndex(Z);if($!==void 0)this.removeIndex($)}get length(){return this.items.length}*drain(){let Z=this.items.shift();while(Z!==void 0)yield Z,Z=this.items.shift()}*next(){for(let Z of this.items)yield Z}}function MJ(Z){return async(...$)=>{try{return[null,await Z(...$)]}catch(J){return[J,null]}}}function Y8(Z){return(...$)=>{try{return[null,Z(...$)]}catch(J){return[J,null]}}}function r0(Z){return Z}function Q0(Z=$0()){let $=Z.get("ecasws").unwrapOr("none");return decodeURIComponent($.replace(/%22/g,""))}var $Z={typename:"none",debug:c,log:c,info:c,warn:c,error:c,table:c,trace:c},V=u9;function u9(){return $Z}function W8(Z){$Z=Z}function tJ(){$Z=n0()}function K0(Z){$Z=l9(Z)}function V8(Z,$){$Z=j8(Z,$)}function eJ(){$Z=B8()}function Z7(){$Z=n0()}function l9(Z){switch(Z){case"console":return B8();case"websocket":return j8();case"none":default:return n0()}}function G8(Z=window.location){var $,J;K0((J=($=q8(Z.hash))!==null&&$!==void 0?$:F8(Z.search))!==null&&J!==void 0?J:"none")}function q8(Z){let J=Z.substring(1).split("&");for(let Q of J){let[K,H]=Q.split("=");if((K==="ecas-logger"||K==="ecasLogger")&&H0(H))return H}return null}function F8(Z){var $;let J=new URLSearchParams(Z),Q=($=J.get("ecas-logger"))!==null&&$!==void 0?$:J.get("ecasLogger");return H0(Q)?Q:null}function H0(Z){return Z==="none"||Z==="console"||Z==="timestamp"||Z==="websocket"}function i9(Z){return H0(F8(Z))}function s9(Z){return H0(q8(Z))}function O8(Z=window.location){return s9(Z.hash)||i9(Z.search)}function B8(){let Z=[];return Object.assign(Object.assign({typename:"console"},console),{errors:Z,onerror:($)=>{Z.push($),console.debug($.message)}})}function j8(Z=Q0(),$){if($!==void 0)try{$=new WebSocket(Z)}catch(Q){}let J=(Q,K)=>{let H=performance.now();if(($===null||$===void 0?void 0:$.readyState)!==WebSocket.OPEN)return;$===null||$===void 0||$.send(JSON.stringify({type:"log",data:{message:JSON.stringify(Q),level:K,timestamp:H}}))};return{typename:"websocket",debug:(...Q)=>{J(Q,"debug")},log:(...Q)=>{J(Q,"log")},info:(...Q)=>{J(Q,"info")},warn:(...Q)=>{J(Q,"warn")},error:(...Q)=>{J(Q,"error")},table:(...Q)=>{J(Q,"table")},trace:(...Q)=>{J(Q,"trace")},socket:$}}function n0(){return{typename:"none",debug:c,log:c,info:c,warn:c,error:c,table:c,trace:c}}var lZ=(Z,...$)=>{var J;let Q="";for(let K=0;K<Z.raw.length;K++)Q+=Z.raw[K]+String((J=$[K])!==null&&J!==void 0?J:"");return Q},HZ=(...Z)=>{$Z.debug(lZ(...Z))},$7=(...Z)=>{$Z.log(lZ(...Z))},J7=(...Z)=>{$Z.info(lZ(...Z))},EZ=(...Z)=>{$Z.warn(lZ(...Z))},Q7=(...Z)=>{$Z.error(lZ(...Z))};class D8 extends Error{constructor(){super(...arguments);Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AutomatorError"})}}class P{constructor(Z){Object.defineProperty(this,"AutomatableParameters",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"audioParams",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"defaults",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}automate({paramId:Z,valueCurve:$,when:J,duration:Q}){let{debug:K}=V();K("[ecas] automate",{paramId:Z,when:J,duration:Q,length:$.length,firstValue:$[0],lastValue:$[$.length-1]});let H=this.audioParams.get(Z);if(H===void 0)return j(new Error(`AudioParam with id ${String(Z)} has not been added.`));try{H.cancelAndHoldAtTime(0)}catch(z){K("[ecas] automate: failed to cancel and hold at time",C(z).message)}if($.length===0)return M("valueCurve is empty");if($.length===1)try{return K("[ecas] automate: valueCurve has only one value, setting value directly"),H.linearRampToValueAtTime($[0],J+Q),F(void 0)}catch(z){return j(new Error("failed to schedule linearRampToValueAtTime."))}if(RZ)return this.firefoxHack({paramId:Z,valueCurve:$,when:J,duration:Q,audioParam:H});try{return H.setValueCurveAtTime(Float32Array.from($),J,Q),F(void 0)}catch(z){K("[ecas]: failed to schedule value curve, using a linear ramp to the end value instead: ",C(z).message)}let X=$[$.length-1];try{H.cancelAndHoldAtTime(0)}catch(z){}try{return H.linearRampToValueAtTime(X,J+Q),F(void 0)}catch(z){return K("[ecas]: failed to schedule linear ramp to value at time that was used as a fallback when the valueCurve failed: ",C(z).message),j(new Error("failed to schedule linearRampToValueAtTime."))}}firefoxHack({audioParam:Z,valueCurve:$,when:J,duration:Q}){let K=$.length,H=Q/K;Z.cancelAndHoldAtTime(0);let X=null;for(let[z,Y]of $.entries()){let W=z*H;try{Z.linearRampToValueAtTime(Y,J+W)}catch(G){X=C(G)}}return X===null?F(void 0):j(X)}add(Z,$,J){if(this.audioParams.has(Z))return j(new D8(`AudioParam with id ${String(Z)} has already been added.`));return this.set(Z,$),this.setDefault(Z,J!==null&&J!==void 0?J:$.value),F(void 0)}cancel({paramId:Z,when:$}){var J;try{return(J=this.audioParams.get(Z))===null||J===void 0||J.cancelScheduledValues($),F(void 0)}catch(Q){return j(C(Q))}}get(Z){return this.audioParams.get(Z)}set(Z,$){this.audioParams.set(Z,$)}current(Z){var $;return($=this.audioParams.get(Z))===null||$===void 0?void 0:$.value}getDefault(Z){return this.defaults.get(Z)}setDefault(Z,$){this.defaults.set(Z,$)}dispose(){this.audioParams.clear(),this.defaults.clear()}}function V7(Z){let $=0;return Z.map((J)=>{return $+=Number(J.pos),{pos:$,val:J.val}})}function G7(Z){let $=0;return Z.map((J)=>{let Q=J.pos,K=Q-$;return $=Q,{pos:K,val:J.val}})}function q7(Z,$,J,Q,K=8){let X=Math.ceil(Q*K),z=new Float32Array(X),Y=v0(X);if(Z===-1)Y.reverse();for(let W of v0(X)){let G=9*W/X+1,O=Y[W];if(O!==void 0)z[O]=Math.log10(G)}return z}function U8(Z=1,$=10,J=10){let Q=(W)=>{if(W>0)return Math.log10(W);return Math.log10(0.00001)},K=Q(Z),X=(Q($)-K)/(J-1),z=new Float32Array(J),Y=K;z[0]=Z;for(let W=1;W<J-1;W++)Y+=X,z[W]=Math.pow(10,Y);return z[J-1]=$,z}function r9(Z=1,$=10,J=10){let Q=($-Z)/(J-1),K=new Float32Array(J),H=Z;for(let X=0;X<J;X++)K[X]=H,H+=Q;return K[0]=Z,K[K.length-1]=$,K}function n9(Z=1,$=0,J=10){let Q=Math.PI/2,K=new Float32Array(J);for(let X=0;X<J;X++){let Y=Math.PI*X/(J-1)-Q;K[X]=Math.sin(Y)/2+0.5}let H=$-Z;for(let X=0;X<J;X++){let z=K[X];if(z!==void 0)K[X]=z*H+Z}return K}function w8(Z,$,J){let Q=$.reduce((z,Y)=>z+Y,0),K=new Float32Array(Q),H=Z[0],X=0;for(let z=0;z<Z.length;z++){let Y=$[z],W=Z[z];K.set(J(H,W,Y),X),X+=Y,H=W}return K}var o9={linear:r9,exponential:U8,logarithmic:U8,"s-curve":n9};function T8(Z){return o9[Z]}var L8={linear(Z){return X0("linear",Z)},logarithmic(Z){return X0("logarithmic",Z)},exponential(Z){return X0("exponential",Z)},"s-curve"(Z){return X0("s-curve",Z)}},B7=8,a9=0.008;function X0(Z,[$,J]){let Q=J.map((K)=>Math.floor(Math.max(K*a9,2)));return[w8($,Q,T8(Z)),J.reduce((K,H)=>K+H,0)/1000]}var D7=[0.001,0.0027825594022071257,0.007498942093324555,0.020833593247197593,0.0562341325190349,0.1544346900318837,0.4291934260128776,1],U7=[1,0.4291934260128776,0.1544346900318837,0.0562341325190349,0.020833593247197593,0.007498942093324555,0.0027825594022071257,0.001];var L7=["linear","exponential","logarithmic","s-curve"];function WZ({automator:Z,context:$,paramId:J,curve:Q,points:K,initialDelay:H=0,when:X=$.currentTime}){let z=t9(K),Y=({val:B})=>{var T,w;if(B==="default")return(T=Z.getDefault(J))!==null&&T!==void 0?T:0.001;if(B==="current")return(w=Z.current(J))!==null&&w!==void 0?w:0.001;return B},W=z.map(Y),G=z.map(({pos:B})=>B),[O,q]=L8[Q!==null&&Q!==void 0?Q:"linear"]([W,G]);return Z.automate({paramId:J,valueCurve:O,when:X+H,duration:q})}function t9(Z){var $;let J=[...Z];if((($=Z[0])===null||$===void 0?void 0:$.pos)!==0)J.unshift({pos:0,val:"current"});return J}function i(Z,$){var J={};for(var Q in Z)if(Object.prototype.hasOwnProperty.call(Z,Q)&&$.indexOf(Q)<0)J[Q]=Z[Q];if(Z!=null&&typeof Object.getOwnPropertySymbols==="function"){for(var K=0,Q=Object.getOwnPropertySymbols(Z);K<Q.length;K++)if($.indexOf(Q[K])<0&&Object.prototype.propertyIsEnumerable.call(Z,Q[K]))J[Q[K]]=Z[Q[K]]}return J}function wZ(Z,$){let J=Object.assign(Object.assign({},Z),$);if($.dryGain!==void 0&&$.wetGain!==void 0)return Object.assign(Object.assign(Object.assign({},Z),$),{mix:U($.wetGain,v,ZZ)});if($.mix!==void 0)return Object.assign(Object.assign(Object.assign({},Z),$),{dryGain:U(1-$.mix,v,ZZ),wetGain:U($.mix,v,ZZ)});return J}var z0="AlgorithmicReverbInsert",e9=["dry-gain","wet-gain"];class s{get id(){return this.options.id}get input(){return this.nodes.input}get output(){return this.nodes.output}constructor(Z,$={id:z0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:z0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(e9)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=wZ(s.defaultOptions,$),this.nodes={input:Z.createGain(),output:Z.createGain(),dry:Z.createGain(),wet:Z.createGain(),reverb:Z.createConvolver()},this.input.connect(this.nodes.dry),this.input.connect(this.nodes.reverb),this.nodes.reverb.connect(this.nodes.wet),this.nodes.dry.connect(this.output),this.nodes.wet.connect(this.output),this.nodes.dry.gain.value=this.options.dryGain,this.nodes.wet.gain.value=this.options.wetGain,this.buildImpulse(),this.automator.add("dry-gain",this.nodes.dry.gain,this.options.dryGain),this.automator.add("wet-gain",this.nodes.wet.gain,this.options.wetGain)}buildImpulse(){let{time:Z,decay:$,reverse:J}=this.options,Q=this.context.sampleRate*Z,K=this.context.createBuffer(2,Q,this.context.sampleRate),H=K.getChannelData(0),X=K.getChannelData(1),z,Y;for(Y=0;Y<Q;Y++)z=J?Q-Y:Y,H[Y]=(Math.random()*2-1)*Math.pow(1-z/Q,$),X[Y]=(Math.random()*2-1)*Math.pow(1-z/Q,$);this.nodes.reverb.buffer=K}}Object.defineProperty(s,"typename",{enumerable:!0,configurable:!0,writable:!0,value:z0});Object.defineProperty(s,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:z0,mix:1,dryGain:v,wetGain:ZZ,time:0.2,decay:0.2,reverse:!1}});var Z$=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"],Y0="BiquadFilterInsert",$$=["frequency","detune","Q","gain"];class p{get id(){return this.options.id}get input(){return this.node}get output(){return this.node}constructor(Z,$={id:Y0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:Y0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P($$)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=Object.assign(Object.assign({},p.defaultOptions),$),this.node=Z.createBiquadFilter(),this.updateFilterNode(),this.automator.add("Q",this.node.Q),this.automator.add("detune",this.node.detune),this.automator.add("frequency",this.node.frequency),this.automator.add("gain",this.node.gain)}updateFilterNode(){this.node.Q.value=U(this.options.Q,v,u6),this.node.detune.value=U(this.options.detune,i6,l6),this.node.frequency.value=U(this.options.frequency,p6,this.context.sampleRate/2),this.node.gain.value=U(this.options.gain,r6,s6),this.node.type=Z$.includes(this.options.type)?this.options.type:p.defaultOptions.type}}Object.defineProperty(p,"typename",{enumerable:!0,configurable:!0,writable:!0,value:Y0});Object.defineProperty(p,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:Y0,type:"lowpass",frequency:350,detune:0,Q:1,gain:0}});var W0="ReverbConvolverInsert",J$=["dry-gain","wet-gain"];class u{get id(){return this.options.id}get input(){return this.nodes.input}get output(){return this.nodes.output}constructor(Z,$={id:W0},J){if(Object.defineProperty(this,"bufferRequester",{enumerable:!0,configurable:!0,writable:!0,value:J}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:W0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(J$)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=wZ(u.defaultOptions,$),this.nodes={input:Z.createGain(),output:Z.createGain(),dry:Z.createGain(),wet:Z.createGain(),reverb:Z.createConvolver()},this.input.connect(this.nodes.dry),this.input.connect(this.nodes.reverb),this.nodes.reverb.connect(this.nodes.wet),this.nodes.dry.connect(this.output),this.nodes.wet.connect(this.output),$.impulseResponse===void 0)V().warn(`[ecas] no impulseResponse specified for insert: ${this.id}`);this.nodes.dry.gain.value=this.options.dryGain,this.nodes.wet.gain.value=this.options.wetGain,this.nodes.reverb.normalize=this.options.normalize,this.updateBuffer().catch(V().error),this.automator.add("dry-gain",this.nodes.dry.gain,this.options.dryGain),this.automator.add("wet-gain",this.nodes.wet.gain,this.options.wetGain)}async updateBuffer(){var Z;let $=(Z=this.options.reverse)!==null&&Z!==void 0?Z:u.defaultOptions.reverse;try{this.nodes.reverb.buffer=$?await this.bufferRequester.requestBufferReversedAsync(this.options.impulseResponse):await this.bufferRequester.requestBufferAsync(this.options.impulseResponse)}catch(J){V().debug("[ecas] failed to load impulse response, setting buffer to null. Make sure to preload the impulse response audio file"),V().error(J),this.nodes.reverb.buffer=null}if(this.nodes.reverb.buffer===null)V().warn(`[ecas] no impulse response buffer found for insert: ${this.id}`)}}Object.defineProperty(u,"typename",{enumerable:!0,configurable:!0,writable:!0,value:W0});Object.defineProperty(u,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:W0,normalize:!1,reverse:!1,impulseResponse:"none",mix:1,dryGain:v,wetGain:ZZ}});var V0="DelayInsert",Q$=["delayTime","feedback","dry-gain","wet-gain","cutoff"];class I{get id(){return this.options.id}get input(){return this.nodes.input}get output(){return this.nodes.output}constructor(Z,$={id:V0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:V0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(Q$)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=wZ(I.defaultOptions,$),this.nodes={input:Z.createGain(),output:Z.createGain(),dry:Z.createGain(),wet:Z.createGain(),feedback:Z.createGain(),delay:Z.createDelay(),filter:Z.createBiquadFilter()},this.updateDelayOptions($),this.nodes.dry.gain.value=this.options.dryGain,this.nodes.wet.gain.value=this.options.wetGain,this.input.connect(this.nodes.dry),this.nodes.dry.connect(this.output),this.nodes.delay.connect(this.nodes.feedback),this.nodes.feedback.connect(this.nodes.filter),this.nodes.filter.connect(this.nodes.delay),this.input.connect(this.nodes.delay),this.nodes.delay.connect(this.nodes.wet),this.nodes.wet.connect(this.output),this.automator.add("cutoff",this.nodes.filter.frequency),this.automator.add("delayTime",this.nodes.delay.delayTime),this.automator.add("feedback",this.nodes.feedback.gain),this.automator.add("dry-gain",this.nodes.dry.gain),this.automator.add("wet-gain",this.nodes.wet.gain)}updateDelayOptions({feedback:Z,delayTime:$,maxDelayTime:J,cutoff:Q}){this.options.maxDelayTime=J!==void 0?U(J,0,10):I.defaultOptions.maxDelayTime,this.options.delayTime=$!==void 0?U($,0,this.options.maxDelayTime):I.defaultOptions.delayTime,this.options.feedback=Z!==void 0?U(Z,v,1):I.defaultOptions.feedback,this.options.cutoff=Q!==void 0?U(Q,10,20000):I.defaultOptions.cutoff,this.nodes.delay.delayTime.value=this.options.delayTime,this.nodes.feedback.gain.value=this.options.feedback,this.nodes.filter.frequency.value=this.options.cutoff,this.nodes.filter.type="lowpass"}}Object.defineProperty(I,"typename",{enumerable:!0,configurable:!0,writable:!0,value:V0});Object.defineProperty(I,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:V0,mix:1,dryGain:v,wetGain:ZZ,feedback:0.1,delayTime:0.3,maxDelayTime:1,cutoff:20000}});var G0="DynamicsCompressorInsert",K$=["threshold","knee","ratio","attack","release"],H$={id:G0,threshold:-24,knee:30,ratio:12,attack:0.003,release:0.25};class r{get id(){return this.options.id}get input(){return this.node}get output(){return this.node}constructor(Z,$={id:G0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:G0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(K$)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=Object.assign(Object.assign({},r.defaultOptions),$),this.node=Z.createDynamicsCompressor(),this.updateCompressorNode(),this.automator.add("threshold",this.node.threshold),this.automator.add("ratio",this.node.ratio),this.automator.add("attack",this.node.attack),this.automator.add("release",this.node.release),this.automator.add("knee",this.node.knee)}updateCompressorNode(){this.node.attack.value=U(this.options.attack,n6,o6),this.node.knee.value=U(this.options.knee,a6,t6),this.node.ratio.value=U(this.options.ratio,e6,Z8),this.node.release.value=U(this.options.release,J8,$8),this.node.threshold.value=U(this.options.threshold,Q8,K8)}}Object.defineProperty(r,"typename",{enumerable:!0,configurable:!0,writable:!0,value:G0});Object.defineProperty(r,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:H$});var q0="GainInsert";class VZ{get id(){return this.options.id}get input(){return this.node}get output(){return this.node}constructor(Z,$={id:q0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:q0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(["gain"])}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=Object.assign(Object.assign({},VZ.defaultOptions),$),this.node=Z.createGain(),this.node.gain.value=this.options.gain,this.automator.add("gain",this.node.gain)}}Object.defineProperty(VZ,"typename",{enumerable:!0,configurable:!0,writable:!0,value:q0});Object.defineProperty(VZ,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:q0,gain:1}});class o0 extends Error{constructor(){super(...arguments);Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"InsertHandlerError"})}}class a0{constructor(Z,$){Object.defineProperty(this,"audioContext",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"bufferRequester",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"insertMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"inserts",{enumerable:!0,configurable:!0,writable:!0,value:[]})}create(Z,$){V().debug("[ecas] insert.create",Z);let J=A8(this.audioContext,this.bufferRequester,Z,$);if(J.isOk())return this.inserts.unshift(J.value),this.insertMap.set(J.value.id,J.value),F(J.value);return j(J.error)}get(Z){return this.insertMap.get(Z)}logInserts(){V().log(this.inserts)}has(Z){return this.insertMap.has(Z)}dispose(){this.insertMap.clear();while(this.inserts.length>0){let Z=this.inserts.pop();Z===null||Z===void 0||Z.input.disconnect(),Z===null||Z===void 0||Z.output.disconnect()}}}var F0="PanInsert";class GZ{get id(){return this.options.id}get input(){return this.node}get output(){return this.node}constructor(Z,$={id:F0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:F0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(["pan"])}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=Object.assign(Object.assign({},GZ.defaultOptions),$),this.node=Z.createStereoPanner(),this.node.pan.value=this.options.pan,this.automator.add("pan",this.node.pan)}}Object.defineProperty(GZ,"typename",{enumerable:!0,configurable:!0,writable:!0,value:F0});Object.defineProperty(GZ,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:{id:F0,pan:0}});var O0="PingPongDelayInsert",X$={id:O0,mix:1,dryGain:v,wetGain:ZZ,feedback:0.1,delayTimeLeft:0.3,delayTimeRight:0.3,maxDelayTime:1},z$=["dry-gain","wet-gain","delay-time-left","delay-time-right","feedback"];class x{get id(){return this.options.id}get input(){return this.nodes.input}get output(){return this.nodes.output}constructor(Z,$={id:O0}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"typename",{enumerable:!0,configurable:!0,writable:!0,value:O0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(z$)}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=wZ(x.defaultOptions,$),this.nodes={input:Z.createGain(),output:Z.createGain(),dry:Z.createGain(),wet:Z.createGain(),feedback:Z.createGain(),delayLeft:Z.createDelay(),delayRight:Z.createDelay(),channelMerger:Z.createChannelMerger()},this.nodes.input.connect(this.nodes.dry),this.nodes.dry.connect(this.nodes.output),this.nodes.delayLeft.connect(this.nodes.channelMerger,0,0),this.nodes.delayRight.connect(this.nodes.channelMerger,0,1),this.nodes.input.connect(this.nodes.delayLeft),this.nodes.delayLeft.connect(this.nodes.delayRight),this.nodes.delayRight.connect(this.nodes.feedback),this.nodes.feedback.connect(this.nodes.delayLeft),this.nodes.channelMerger.connect(this.nodes.wet),this.nodes.wet.connect(this.nodes.output),this.updateDelayOptions($),this.nodes.dry.gain.value=this.options.dryGain,this.nodes.wet.gain.value=this.options.wetGain,this.automator.add("delay-time-left",this.nodes.delayLeft.delayTime),this.automator.add("delay-time-right",this.nodes.delayRight.delayTime),this.automator.add("dry-gain",this.nodes.dry.gain),this.automator.add("wet-gain",this.nodes.wet.gain),this.automator.add("feedback",this.nodes.feedback.gain)}updateDelayOptions({maxDelayTime:Z,delayTimeLeft:$,delayTimeRight:J,feedback:Q}){this.options.maxDelayTime=Z!==void 0?U(Z,0,10):x.defaultOptions.maxDelayTime,this.options.delayTimeLeft=$!==void 0?U($,0,this.options.maxDelayTime):x.defaultOptions.delayTimeLeft,this.options.delayTimeRight=J!==void 0?U(J,0,this.options.maxDelayTime):x.defaultOptions.delayTimeRight,this.options.feedback=Q!==void 0?U(Q,v,1):x.defaultOptions.feedback,this.nodes.delayLeft.delayTime.value=this.options.delayTimeLeft,this.nodes.delayRight.delayTime.value=this.options.delayTimeRight,this.nodes.feedback.gain.value=this.options.feedback}}Object.defineProperty(x,"typename",{enumerable:!0,configurable:!0,writable:!0,value:O0});Object.defineProperty(x,"defaultOptions",{enumerable:!0,configurable:!0,writable:!0,value:X$});function A8(Z,$,J,Q){switch(V().debug("[ecas] createInsert:",J),J){case p.typename:return F(new p(Z,Q));case r.typename:return F(new r(Z,Q));case I.typename:return F(new I(Z,Q));case s.typename:return F(new s(Z,Q));case u.typename:return F(new u(Z,Q,$));case x.typename:return F(new x(Z,Q));case VZ.typename:return F(new VZ(Z,Q));case GZ.typename:return F(new GZ(Z,Q));default:{let K=new o0(`[ecas] create insert failed to create any insert for, ${J}`);return V().debug(K),j(K)}}}function C8(Z,$){let J=Z.typename===$;if(!J)V().warn("[ecas] insert",Z===null||Z===void 0?void 0:Z.typename,"is not of type",$);return J}var Y$=["gain","pan"];class t0{constructor(Z,$,J,Q){var K;Object.defineProperty(this,"audioContext",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(Y$)}),Object.defineProperty(this,"inserts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"not-setup"}),this.id=J.id;let H=Z.createGain();if(H.gain.value=U((K=J.volume)!==null&&K!==void 0?K:1,p0,c0),this.automator.add("gain",H.gain),J.pan===void 0)this.nodes={gain:H},this.input=H;else{let X=Z.createStereoPanner();X.pan.value=U(J.pan,u0,l0),X.connect(H),this.automator.add("pan",X.pan),this.input=X,this.nodes={gain:H,pan:X}}this.inserts=new a0(this.audioContext,$);for(let X of this.setupInserts(J))X.mapErr(V().debug);Q.connect(this.input)}get output(){return this.nodes.gain}get pannerNode(){return this.nodes.pan}get gainNode(){return this.nodes.gain}get gain(){return this.nodes.gain.gain}get pan(){var Z;return(Z=this.nodes.pan)===null||Z===void 0?void 0:Z.pan}setupInserts(Z){var $,J;if(this.state==="setup")return[];return this.state="setup",(J=($=Z.inserts)===null||$===void 0?void 0:$.slice().reverse().map((Q)=>{let{insertType:K}=Q,H=i(Q,["insertType"]);if(K===void 0)return j(new Error(`[ecas] cannot add insert to bus "${this.id}" with insertType undefined`));return this.inserts.create(K,H).map((X)=>{X.output.connect(this.input),this.input=X.input;return})}))!==null&&J!==void 0?J:[F(void 0)]}setGain(Z,$=0){let J=U(Z,p0,c0);if($<=0){this.nodes.gain.gain.value=J;return}this.nodes.gain.gain.cancelScheduledValues(0),this.nodes.gain.gain.linearRampToValueAtTime(J,this.audioContext.currentTime+d0+$)}setPan(Z,$=0){var J;if(this.nodes.pan===void 0)return;let Q=U(Z,u0,l0);if($<=0){this.nodes.pan.pan.value=Q;return}this.nodes.pan.pan.cancelScheduledValues(0),(J=this.nodes.pan)===null||J===void 0||J.pan.linearRampToValueAtTime(Q,this.audioContext.currentTime+d0+$)}dispose(){var Z;this.nodes.gain.disconnect(),(Z=this.nodes.pan)===null||Z===void 0||Z.disconnect(),this.inserts.dispose()}}function M8(Z){class ${constructor(z){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:z}),Object.defineProperty(this,"afters",{enumerable:!0,configurable:!0,writable:!0,value:[]})}}let J={},Q=[],K={};Z.forEach((z)=>{let Y=z[0];if(Y===void 0)return;let W=String(Y),G=J[W];if(G===void 0)G=J[W]=new $(Y);z.forEach((O)=>{if(O===Y||O===void 0||O===null)return;let q=String(O);if(J[q]==null)J[q]=new $(O);if(G!==void 0)G.afters.push(O)})});let H=Object.keys(J),X=(z,Y)=>{let W=J[z];if(W===void 0)return;let G=W.id;if(K[z]!==void 0)return;let O=Array.isArray(Y)?Y:[];O.push(G),K[z]=!0;for(let q of W.afters){if(O.includes(q))throw new Error(`Circular chain found: ${String(G)} must be before ${String(q)}
                    due to a direct order specification, but ${String(q)} must be before ${String(G)}
                    based on other specifications.`);X(String(q),O.map((B)=>B))}Q.unshift(G)};return H.forEach(X),Q.reverse()}class W$ extends Error{constructor(){super(...arguments);Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BusHandlerError"})}}class e0{constructor(Z,$,J){var Q,K;Object.defineProperty(this,"audioContext",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"bufferRequester",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"buses",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"busConnections",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"constantSourceNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"connections",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.constantSourceNode=Z.createConstantSource(),this.constantSourceNode.offset.value=0,this.constantSourceNode.start();let H=(Q=J.find((W)=>W.id===d))!==null&&Q!==void 0?Q:{id:d,destination:e},X=(K=J.find((W)=>W.id===e))!==null&&K!==void 0?K:{id:e},z=J.filter((W)=>{let G=W.id===e||W.id===d,O=W.destination===W.id;if(O)V().warn(`[ecas] bus ${W.id} is connected to itself, filtering out`);return!(G||O)}),Y=[X,H,...z];this.connections=V$(Y);for(let W of this.connections)this.setupBus(W)}setupBus(Z){var $,J;let Q=new t0(this.audioContext,this.bufferRequester,Z,this.constantSourceNode);if(Q.id===e)return Q.output.connect(this.audioContext.destination),this.buses.set(Q.id,Q),this.busConnections.set(Q.id,{inputs:[],outputs:[{index:0,node:this.audioContext.destination,nodeId:Q.id+"_0",isUsed:!0}]}),F(void 0);else{let K=Q.id===d?e:($=Z.destination)!==null&&$!==void 0?$:"master",H=(J=this.buses.get(K))===null||J===void 0?void 0:J.input;if(this.buses.set(Q.id,Q),H===void 0)return F(void 0);this.busConnections.set(Q.id,{inputs:[],outputs:[{index:0,originalDestinationNode:K,node:H,nodeId:Q.id+"_0",isUsed:!0}]}),Q.output.connect(H)}return F(void 0)}get(Z){return this.buses.get(Z)}getBusConnections(Z){var $;return($=this.busConnections.get(Z))!==null&&$!==void 0?$:{inputs:[],outputs:[]}}purgeConnections(Z,$,J,Q){let K=this.getBusConnections(Q);if(K===void 0||K.inputs.length===0)return;K.inputs=K.inputs.filter((H)=>H.soundContext.id!==Z&&H.soundContext.parentId!==$&&H.soundContext.soundSource!==J&&H.soundContext.bussId!==Q)}dispose(){for(let Z of this.buses.values())Z.dispose()}}function V$(Z){let $=Z.map((Q)=>[Q.id,Q.destination]);return M8($).map((Q)=>Z.reduce((K,H)=>K.id===Q?K:H))}function B0(Z,$){return Object.assign(Object.assign({},Z),{loadrConfig:Object.assign(Object.assign({},Z.loadrConfig),{loadPath:$})})}function Z6(Z,$){return Object.assign(Object.assign({},Z),{loadrConfig:Object.assign(Object.assign({},Z.loadrConfig),{logger:$})})}function $6(Z,$){return Object.assign(Object.assign({},Z),{loadrConfig:Object.assign(Object.assign({},Z.loadrConfig),{queue:$})})}function J6(Z,$){return Object.assign(Object.assign({},Z),{loadrConfig:Object.assign(Object.assign({},Z.loadrConfig),{pauseOnInvisible:$,resumeOnVisible:$,muteOnInvisible:$,unmuteOnVisible:$})})}function Q6(Z,$){return Object.assign(Object.assign({},Z),{stateConfig:$})}function TZ(Z,$){return Object.assign(Object.assign({},Z),{soundConfig:$})}function N8(Z,$){return TZ(Z,Object.assign(Object.assign({},Z.soundConfig),{buses:$}))}function G$(Z,$){return TZ(Z,Object.assign(Object.assign({},Z.soundConfig),{syncers:$}))}function q$(Z,$){return TZ(Z,Object.assign(Object.assign({},Z.soundConfig),{stealers:$}))}function F$(Z,$){return TZ(Z,Object.assign(Object.assign({},Z.soundConfig),{buffers:$}))}function O$(Z,$){return TZ(Z,Object.assign(Object.assign({},Z.soundConfig),{containers:$}))}function K6(Z,$){return Object.assign(Object.assign({},Z),{eventConfig:$})}function j0(Z,$){return Object.assign(Object.assign({},Z),{loadrConfig:$})}function k8(Z,$){return j0(Z,H6(Z.loadrConfig,{fileExtToUse:$}))}function D0(Z,$){return{loadrConfig:H6(Z.loadrConfig,$.loadrConfig),soundConfig:S8(Z.soundConfig,$.soundConfig),eventConfig:h8(Z.eventConfig,$.eventConfig),stateConfig:_8(Z.stateConfig,$.stateConfig)}}function H6(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function S8(Z={},$={}){return{buffers:I8(Z.buffers,$.buffers),buses:x8(Z.buses,$.buses),containers:E8(Z.containers,$.containers),stealers:R8(Z.stealers,$.stealers),syncers:P8(Z.syncers,$.syncers)}}function R8(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function P8(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function E8(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function I8(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function x8(Z=[],$=[]){return[...new Set([...Z,...$])]}function h8(Z=[],$=[]){return[...Z,...$]}function _8(Z={},$={}){return Object.assign(Object.assign({},Z),$)}function X6(Z,$){var J,Q;return B0(Z,`${$}${(Q=(J=Z===null||Z===void 0?void 0:Z.loadrConfig)===null||J===void 0?void 0:J.loadPath)!==null&&Q!==void 0?Q:""}`)}function B$(Z,$){var J,Q,K,H;if(((Q=(J=Z===null||Z===void 0?void 0:Z.soundConfig)===null||J===void 0?void 0:J.buses)===null||Q===void 0?void 0:Q.some((Y)=>Y.id===d))===!0)return Z;let z=[$,...(H=(K=Z.soundConfig)===null||K===void 0?void 0:K.buses)!==null&&H!==void 0?H:[]];return N8(Z,z)}class y8{wrapper(Z){return(...J)=>{return this._config=Z(this._config,...J),this}}constructor(Z={}){Object.defineProperty(this,"_config",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"withSoundConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(TZ)}),Object.defineProperty(this,"withBuses",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(N8)}),Object.defineProperty(this,"withMasterBus",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(B$)}),Object.defineProperty(this,"withSyncers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(G$)}),Object.defineProperty(this,"withStealers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(q$)}),Object.defineProperty(this,"withBuffers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(F$)}),Object.defineProperty(this,"withContainers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(O$)}),Object.defineProperty(this,"withEventConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(K6)}),Object.defineProperty(this,"withStateConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(Q6)}),Object.defineProperty(this,"withLoadrOptions",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(j0)}),Object.defineProperty(this,"withLoadPath",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(B0)}),Object.defineProperty(this,"withPrependLoadPath",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(X6)}),Object.defineProperty(this,"withLogger",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(Z6)}),Object.defineProperty(this,"withQueue",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper($6)}),Object.defineProperty(this,"withPause",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(J6)}),Object.defineProperty(this,"extendOptions",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(D0)}),Object.defineProperty(this,"extendSoundConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(S8)}),Object.defineProperty(this,"extendBuses",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(x8)}),Object.defineProperty(this,"extendSyncers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(P8)}),Object.defineProperty(this,"extendStealers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(R8)}),Object.defineProperty(this,"extendBuffers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(I8)}),Object.defineProperty(this,"extendContainers",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(E8)}),Object.defineProperty(this,"extendEventConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(h8)}),Object.defineProperty(this,"extendStateConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(_8)}),Object.defineProperty(this,"extendLoadrConfig",{enumerable:!0,configurable:!0,writable:!0,value:this.wrapper(H6)}),this._config=Z}get config(){return this._config}}function b8(Z={}){return new y8(Z)}var j$={Filter:p.typename,Compressor:r.typename,AlgorithmicReverb:s.typename,ConvolverReverb:u.typename,Delay:I.typename,PingPongDelay:x.typename,Insert:"Insert"};function f8(Z){var $,J,Q;let K=b8(Z),H={id:d,destination:e};K.withMasterBus(H);let{insertsToAdd:X,updatedEventConfig:z}=D$(($=K.config.eventConfig)!==null&&$!==void 0?$:[]);if(X.length===0)return K.config;let Y=U$((Q=(J=K.config.soundConfig)===null||J===void 0?void 0:J.buses)!==null&&Q!==void 0?Q:[],X);return K.withBuses(Y).withEventConfig(z).config}function D$(Z){let $=[],J=[];for(let Q of Z){let K={id:Q.id,actions:[]};for(let H of Q.actions)if(H.type.startsWith("busAdd")){let X=j$[H.type.replace("busAdd","")],z=H.args[0];$.push(Object.assign(Object.assign({},z),{insertType:X==="Insert"?z.typename:X}))}else K={id:Q.id,actions:[...K.actions,H]};J=[...J,K]}return{insertsToAdd:$,updatedEventConfig:J}}function U$(Z,$){var J;let Q=[];for(let K of Z){let H=Object.assign({},K);for(let X of $){let{busId:z}=X,Y=i(X,["busId"]),W=typeof z==="string"?[z]:z;for(let G of W)if(K.id===G)H=Object.assign(Object.assign({},H),{inserts:[...(J=H.inserts)!==null&&J!==void 0?J:[],Y]})}Q=[...Q,H]}return Q}function z6(Z){var $,J;let Q=f8(Z);for(let K of(J=($=Q.soundConfig)===null||$===void 0?void 0:$.buses)!==null&&J!==void 0?J:[])if(K.destination===void 0)K.destination=d;return Object.assign({atlas:{},soundConfig:{},eventConfig:[],loadrConfig:{},stateConfig:{}},Q)}var qZ={min:"min",max:"max",in:"in",out:"out",param:"param",fallback:"fallback"};var OQ={loadPath:"./encoded/",forcePolyfills:{},fileExtToUse:".webm",preload:!1,pauseOnInvisible:!0,muteOnInvisible:!m6(),resumeOnVisible:!0,unmuteOnVisible:!0,logger:"none",queue:!0,initialMasterVolume:1};var DQ=["reverbAlgorithmic","reverbConvolver","compressor","delay","pingPongDelay","filter"],UQ={[s.typename]:"reverbAlgorithmic",[u.typename]:"reverbConvolver",[r.typename]:"compressor",[I.typename]:"delay",[x.typename]:"pingPongDelay",[p.typename]:"filter"};var w$=[26,69,223,163,159,66,134,129,1,66,247,129,1,66,242,129,4,66,243,129,8,66,130,132,119,101,98,109,66,135,129,4,66,133,129,2,24,83,128,103,1,0,0,0,0,0,2,1,17,77,155,116,186,77,187,139,83,171,132,21,73,169,102,83,172,129,161,77,187,139,83,171,132,22,84,174,107,83,172,129,214,77,187,140,83,171,132,18,84,195,103,83,172,130,1,64,77,187,140,83,171,132,28,83,187,107,83,172,130,1,235,236,1,0,0,0,0,0,0,89,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,73,169,102,176,42,215,177,131,15,66,64,77,128,140,76,97,118,102,54,48,46,51,46,49,48,48,87,65,140,76,97,118,102,54,48,46,51,46,49,48,48,68,137,136,64,60,0,0,0,0,0,0,22,84,174,107,229,174,1,0,0,0,0,0,0,92,215,129,1,115,197,136,138,87,207,235,92,22,242,91,156,129,0,34,181,156,131,117,110,100,136,129,0,134,134,65,95,79,80,85,83,86,170,131,99,46,160,86,187,132,4,196,180,0,131,129,2,225,145,159,129,1,181,136,64,231,112,0,0,0,0,0,98,100,129,16,99,162,147,79,112,117,115,72,101,97,100,1,1,56,1,128,187,0,0,0,0,0,18,84,195,103,252,115,115,159,99,192,128,103,200,153,69,163,135,69,78,67,79,68,69,82,68,135,140,76,97,118,102,54,48,46,51,46,49,48,48,115,115,215,99,192,139,99,197,136,138,87,207,235,92,22,242,91,103,200,161,69,163,135,69,78,67,79,68,69,82,68,135,148,76,97,118,99,54,48,46,51,46,49,48,48,32,108,105,98,111,112,117,115,103,200,162,69,163,136,68,85,82,65,84,73,79,78,68,135,148,48,48,58,48,48,58,48,48,46,48,50,56,48,48,48,48,48,48,0,0,31,67,182,117,165,231,129,0,163,139,129,0,0,128,8,11,230,59,35,171,96,160,147,161,138,129,0,21,0,8,8,172,179,14,198,117,162,132,0,205,254,96,28,83,187,107,145,187,143,179,129,0,183,138,247,129,1,241,130,1,193,240,129,3];function T$(Z){return async($)=>{try{return(await Z.decodeAudioData(Uint8Array.from($).buffer)).numberOfChannels===1}catch(J){return!1}}}async function v8(Z){return await T$(Z)(w$)}var XZ={Ready:"ecas-ready",Mute:"ecas-mute",Unmute:"ecas-unmute",Pause:"ecas-pause",Resume:"ecas-resume",Timer:{Pause:"ecas-timer-pause",Resume:"ecas-timer-resume"},Context:{Pause:"ecas-context-pause",Resume:"ecas-context-resume",Suspended:"ecas-context-suspended",Running:"ecas-context-running",Closed:"ecas-context-closed",Interrupted:"ecas-context-interrupted"},Preload:{Start:"ecas-preload-start",Done:"ecas-preload-done",Progress:"ecas-preload-progress"},Sound:{LoadStart:"ecas-sound-load-start",Loading:"ecas-sound-load-loading",LoadDone:"ecas-sound-load-done",LoadError:"ecas-sound-load-error",Abort:"ecas-sound-abort",CanPlay:"ecas-sound-canplay",Play:"ecas-sound-play",Stop:"ecas-sound-stop",Ended:"ecas-sound-ended",Pause:"ecas-sound-pause",FadeOutStart:"ecas-sound-fade-out-start",FadeOutEnd:"ecas-sound-fade-out-end",PlaybackStart:"ecas-sound-playback-start",PlaybackEnd:"ecas-sound-playback-end",PlaybackError:"ecas-sound-playback-error"},Events:{LoadStart:"ecas-events-load-start",LoadDone:"ecas-events-load-done"},Envelope:{Play:"ecas-envelope-play",Start:"ecas-envelope-start",Ended:"ecas-envelope-ended"}};class Y6{constructor(){Object.defineProperty(this,"record",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}on(Z,$){let J=this.record.get(Z);if(J!==void 0)J.push($);else this.record.set(Z,[$])}off(Z,$){let J=this.record.get(Z);if(J===void 0)return V().error(`[ecas] cannot remove event: ${Z} since it does not exist`),!1;let Q=J.filter((K)=>K!==$);if(Q.length!==J.length)return this.record.set(Z,Q),!0;return!1}emit(Z,...$){let J=this.record.get(Z);if(J===void 0)return;for(let Q of J)try{Q(...$)}catch(K){V().debug(`[ecas] error in callback for event ${Z}`,K)}}dispose(){this.record.clear()}}var iZ="genesis",W6={name:iZ,parent:"",events:{}};class V6{constructor(Z,$,J,Q){var K,H;if($===void 0)$={genesis:W6};if(J===void 0)J=m8(new Map,(K=$[iZ])!==null&&K!==void 0?K:W6);if(Q===void 0)Q=(H=J.get(A$(J,Z)))!==null&&H!==void 0?H:W6;Object.defineProperty(this,"stateConfig",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"states",{enumerable:!0,configurable:!0,writable:!0,value:J}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:Q});let{table:X}=V();if(X("[ecas] states:"),X([...this.states.keys()]),typeof window!=="undefined")window.addEventListener("unload",()=>{C$(this.active.name)},{once:!0})}triggerStateChange(Z,$=[]){if(this.active.deactivatesOn!==void 0&&g8(this.active.deactivatesOn,Z,$))this.changeState(this.active.parent);if(this.active.children===void 0)return this.active;for(let[J,Q]of Object.entries(this.active.children))if(Q.activatesOn!==void 0&&g8(Q.activatesOn,Z,$))return this.changeState(`${this.active.name}::${J}`);return this.active}changeState(Z){var $;return V().debug(`[ecas] moving to state ${Z}`),this.active=($=this.states.get(Z))!==null&&$!==void 0?$:this.active}readState(){return d8().andThen((Z)=>{var $;return this.active=($=this.states.get(Z))!==null&&$!==void 0?$:this.active,F(this.active)})}}function m8(Z,$,J,Q,K=iZ){var H;let X=$.children;if(K=J!==void 0?`${K}::${J}`:K,Z=L$(Z,K,$,Q),X!==void 0)for(let[z,Y]of Object.entries(X))Z=m8(Z,Y,z,K,K);return K=K.slice(0,K.length-((H=J===null||J===void 0?void 0:J.length)!==null&&H!==void 0?H:0)-2),Z}function L$(Z,$,J,Q){var K;if(Z.has($))return V().debug("[ecas] cannot add the state since it already exist on the same level.."),Z;let H=Object.assign(Object.assign({},J),{events:(K=J.events)!==null&&K!==void 0?K:{},name:$,parent:Q!==null&&Q!==void 0?Q:"none"});if(Q===void 0)return Z.set($,H);let X=Z.get(Q);if(X===void 0)return V().debug(`[ecas] tried to set state with "${Q}" but it does not exist on name: ${$}`),Z;return Object.assign(H.events,Object.assign(Object.assign({},X.events),H.events)),Z.set($,H)}function A$(Z,$){if($!==void 0&&Z.has($))return HZ`[ecas] initial state from loader config ${$}`,$;return d8().match((J)=>Z.has(J)?J:iZ,()=>iZ)}function g8(Z,$,J=[]){return Z.some((Q)=>typeof Q==="string"?Q===$:Q.event===$&&Q.values.every((K)=>J.includes(K)))}function C$(Z){V().debug("[ecas] save state to localstorage",Z);let $="ECAS_AUDIO_STATE";try{if(typeof localStorage==="undefined")return M("[ecas] localStorage is undefined");return localStorage.setItem($,Z),F(void 0)}catch(J){return H8(J)}}function d8(){let{debug:Z}=V();Z("[ecas] read state from localstorage");try{if(typeof localStorage==="undefined")return M("[ecas] localStorage is undefined");let $=localStorage.getItem("ECAS_AUDIO_STATE");return $===null?M("[ecas] no state saved in localstorage"):F($)}catch($){return M(`[ecas] failed to read from localstorage: ${C($).message}`)}}function vZ(Z){if(UZ(Z))return Z;let $=!0,J=/^-?\d*\.?\d+,-?\d*\.?\d+$/,Q=/^-?\d*\.?\d+$/,K,H;if(!UZ(Z)&&Array.isArray(Z))if(Z.length>0){if(H=Z.map((X)=>{if(Q.test(X))return X;else if(fZ(X))return c8(parseFloat(X[0]),parseFloat(X[1]));else if(J.test(X)){let z=X.split(",");return c8(parseFloat(z[0]),parseFloat(z[1]))}else $=!1,V().warn("[ecas] invalid random value format: "+Z);return null}),$)return K=M$(H)[0],parseFloat(K)}else V().warn("[ecas] invalid random value: empty array");else return K=Z,K;throw new Error("[ecas] randomize values should not reach this line")}function M$(Z){let $=Z.map((J)=>[Math.random(),J]);return $.sort(),$.map((J)=>J[1])}function c8(Z,$){return(Math.random()*($-Z)+Z).toFixed(3)}function U0(Z){if(YZ(Z,qZ.in)&&YZ(Z,qZ.out))return UZ(Z[qZ.in])&&UZ(Z[qZ.out]);return!1}function u8(Z){if(YZ(Z,qZ.min)&&YZ(Z,qZ.max)){if(DZ(Z.min)&&DZ(Z.max))return U0(Z.min)&&U0(Z.max)}return!1}function w0(Z){if(DZ(Z)&&YZ(Z,qZ.param))return YZ(Z,qZ.param)&&(U0(Z)||u8(Z));return!1}function N$(Z,$){let J=vZ(Z.min.in),Q=vZ(Z.min.out),K=vZ(Z.max.in)-J,H=vZ(Z.max.out)-Q,X=($-J)/K;return H*X+Q}function k$(Z,$){if($===Z.in)return vZ(Z.out);throw new Error("translateBasic failed")}function S$(Z,$){if(U0(Z))return k$(Z,$);else if(u8(Z))return N$(Z,$);throw new Error("ECAS Translator.translateObject should never reach this line.")}function p8(Z,$){var J,Q;let K=(Q=(J=$[Z.param])!==null&&J!==void 0?J:Z.fallback)!==null&&Q!==void 0?Q:0;if(!UZ(K))throw new Error(`translate only works for numbers but arg is ${typeof K}, args.length: ${$.length}, eventParam: ${Z.param}, args: ${$}`);return S$(Z,K)}function l8(Z,$){let J=c6(Z),Q=[...$];for(let K=0;K<J.length;K++){let H=J[K];if(w0(H))J[K]=p8(H,Q);else if(DZ(H)){for(let[X,z]of Object.entries(H))if(w0(z)){let Y=J[K];if(Y!==void 0)Y[X]=p8(z,Q)}}}return J}function i8(Z){for(let $=0;$<Z.length;$++){let J=Z[$];if(w0(J))return!0;else if(DZ(J)){for(let[,Q]of Object.entries(J))if(w0(Q))return!0}}return!1}class G6 extends Y6{constructor(Z,$,J,Q,K=new V6(J,$),H=r8(Object.values($)),X=E$(Z),z=P$(K.states,H),Y=R$(Z)){super();Object.defineProperty(this,"api",{enumerable:!0,configurable:!0,writable:!0,value:Q}),Object.defineProperty(this,"stateMachine",{enumerable:!0,configurable:!0,writable:!0,value:K}),Object.defineProperty(this,"gameEvents",{enumerable:!0,configurable:!0,writable:!0,value:H}),Object.defineProperty(this,"audioEvents",{enumerable:!0,configurable:!0,writable:!0,value:X}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:z}),Object.defineProperty(this,"actions",{enumerable:!0,configurable:!0,writable:!0,value:Y});let{info:W}=V();W("[ecas] game events:",this.gameEvents),W("[ecas] audio events:",this.audioEvents),W("[ecas] state map:",this.events),W("[ecas] actions:",this.actions)}triggerGameEvent(Z,...$){var J,Q;let{debug:K,info:H}=V();H(`[ecas] game-event ${Z}`,...$);let X=this.api.audioContext;if(!document.hidden&&(X===null||X===void 0?void 0:X.state)!=="running")X===null||X===void 0||X.resume().catch(K);let z=this.stateMachine.triggerStateChange(Z,$),Y=(J=this.events.get(z.name))===null||J===void 0?void 0:J.get(Z);if(Y===void 0)return[];if(typeof Y==="string")return this.triggerAudioEvent(Y,...$);let W=(Q=Y[$[0]])!==null&&Q!==void 0?Q:Y.fallback;if(W===void 0)return[];return this.triggerAudioEvent(W,...$)}triggerAudioEvent(Z,...$){V().info(`[ecas] audio-event ${Z}`,...$);let J=this.actions.get(Z);if(J===void 0)return this.emit(Z,...$),[];let Q=Array.from({length:J.length});for(let K=0;K<J.length;K++){let H=J[K];Q[K]=H.hasTranslation?this.runAction({type:H.type,args:l8(H.args,$)}):this.runAction(H)}return this.emit(Z,...$),Q}triggerOnPropertyEventOrAction(Z){var $,J;if(V().debug("[ecas]: calling triggerOnPropertyEventOrAction"),typeof Z==="string")return this.triggerAudioEvent(Z,[]);if(((H)=>{return Array.isArray(H)})(Z))return Z.map((H)=>this.runAction(H));let K=[];for(let H of($=Z.audioEvents)!==null&&$!==void 0?$:[])K.push(...this.triggerAudioEvent(H,[]));for(let H of(J=Z.gameEvents)!==null&&J!==void 0?J:[])K.push(...this.triggerGameEvent(H,[]));return K}runAction(Z){return this.api[Z.type].apply(this.api,Z.args)}}function R$(Z){let $=new Map;for(let J of Z){let Q=J.actions.map((K)=>Object.assign(Object.assign({},K),{hasTranslation:i8(K.args)}));$.set(J.id,Q)}return $}function P$(Z,$){let J=(K,H)=>s8(Z,K,H),Q=new Map;for(let[K,H]of Z.entries()){let X=$.map((Y)=>J(Y,H)),z=new Map;for(let Y=0;Y<X.length;Y++)if(X[Y]!==void 0){let W=$[Y],G=X[Y];if(W!==void 0&&G!==void 0)z.set(W,G)}Q.set(K,z)}return Q}function s8(Z,$,J){if(J.events===void 0)return;let Q=J.events[$];if(Q!==void 0)return Q;let K=Z.get(J.parent);if(K===void 0)return;return s8(Z,$,K)}function E$(Z){return[...new Set(Z.map(($)=>$.id)).keys()]}function r8(Z){return f6(Z.map(($)=>{var J,Q,K,H;return[...eZ((J=$.events)!==null&&J!==void 0?J:{}),...((Q=$.activatesOn)!==null&&Q!==void 0?Q:[]).map((X)=>typeof X==="string"?X:X.event),...((K=$.deactivatesOn)!==null&&K!==void 0?K:[]).map((X)=>typeof X==="string"?X:X.event),...r8(Object.values((H=$.children)!==null&&H!==void 0?H:{}))]}).flat())}var q6=()=>{},I$=q6,x$=q6,h$=q6,_$={value:0};function T0(Z){let $=!1,J=-1,Q=()=>{},K=new Array,H=0,X=(q,B)=>{K.push(B)},z=()=>{if($)return;if($=!0,Q!==null)Q();for(let q of K!==null&&K!==void 0?K:[])q();K.length=0},Y=()=>{if(J!==-1)clearTimeout(J),J=-1},W=()=>{if(Z.state==="closed"){Y(),G();return}if(Z.state==="running")G();O(H)},G=()=>{Z.removeEventListener("statechange",W)},O=(q)=>{if(H=q!==null&&q!==void 0?q:0,$){Y(),G();return}if(Y(),Z.state==="running"){let B=(H-Z.currentTime)*1000;if(B<=0){G(),z();return}else J=window.setTimeout(()=>{G(),z()},B);Z.addEventListener("statechange",W)}};return{set onended(q){Q=q},get onended(){return Q},offset:_$,connect:I$,disconnect:x$,start:h$,stop:O,addEventListener:X}}function L0(Z,$,J,Q=()=>{}){let K=T0(Z);K.offset.value=0,K.onended=$,K.connect(Z.destination),K.start();try{K.stop(J)}catch(X){V().debug("[ecas] schedule failed to stop source",X)}return()=>{K.onended=Q;try{K.stop(),K.disconnect()}catch(X){V().debug("[ecas] schedule failed to stop source",X)}}}async function eQ({context:Z,when:$=Z.currentTime,duration:J=0}){await new Promise((Q)=>{L0(Z,()=>{Q(Z.currentTime)},$+J)})}var n8=[0.001,0.0027825594022071257,0.007498942093324555,0.020833593247197593,0.0562341325190349,0.1544346900318837,0.4291934260128776,1],y$=[1,0.4291934260128776,0.1544346900318837,0.0562341325190349,0.020833593247197593,0.007498942093324555,0.0027825594022071257,0.001,0];function b$(Z){let[$,...J]=a8(Z,y$);if(Z<=$){let Q=o8(J)?J:[0];return[Z,...Q]}return[Z,$,...J]}function o8(Z){return Z.length>0}function K1(Z){let[$,...J]=a8(Z,n8);if(Z>=$){let Q=o8(J)?J:[1];return[Z,...Q]}return[Z,$,...J]}function a8(Z,$){let J=$.reduce((K,H)=>Math.abs(H-Z)<Math.abs(K-Z)?H:K),Q=$.indexOf(J);return $.slice(Q)}var H1=["in","out"];class F6{constructor(Z){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cancelFadeIn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cancelFadeOut",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=Z.createGain(),this.output=Z.createGain(),this.input.connect(this.output),this.input.gain.value=1,this.output.gain.value=1}fadeIn({when:Z,duration:$,onFadeInEnded:J}){let Q=Math.max(Z,this.context.currentTime);try{this.input.gain.setValueCurveAtTime(Float32Array.from(n8),Q,$)}catch(K){return j(C(K))}if(J!==void 0)this.cancelFadeIn=L0(this.context,J,Q+$);return F(void 0)}fadeOut({when:Z,duration:$,onFadeOutStarted:J}){let Q=Math.max(Z,this.context.currentTime),K=this.output.gain.value;try{if(this.output.gain.setValueCurveAtTime(Float32Array.from(b$(K)),Q,$),J!==void 0)this.cancelFadeOut=L0(this.context,J,Q)}catch(H){return j(C(H))}return F(void 0)}connect(Z){return this.output.connect(Z)}disconnect(){this.output.disconnect()}dispose(){if(this.input.disconnect(),this.output.disconnect(),this.cancelFadeIn!==void 0)this.cancelFadeIn();if(this.cancelFadeOut!==void 0)this.cancelFadeOut()}}var LZ={value:0,next(){return this.value++}};var f$={strategy:"random-standard",avoidRepeatingLast:1,weights:[]};class sZ{constructor(Z={},$={}){Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.properties=Object.assign(Object.assign({},f$),Z),this.state=Object.assign({previous:[],currentIndex:-1},$)}nextIndex(Z=this.properties.weights){if(Z.length===0)return-1;if(Z.length===1)return 0;switch(this.properties.strategy){case"sequence-restart":return this.state.currentIndex=(this.state.currentIndex+1)%Z.length,this.state.currentIndex;case"sequence-repeat-last-voice":{if(this.state.currentIndex===Z.length-1)return this.state.currentIndex;return this.state.currentIndex=(this.state.currentIndex+1)%Z.length,this.state.currentIndex}case"sequence-reverse":{if(this.state.currentIndex=(this.state.currentIndex-1)%Z.length,this.state.currentIndex<0)this.state.currentIndex=Z.length-1;return this.state.currentIndex}case"random-standard":{let Q=J(Z),K=Z.length>this.properties.avoidRepeatingLast+1;if(this.properties.avoidRepeatingLast>0&&K){if(this.state.previous.slice(-this.properties.avoidRepeatingLast).includes(Q))return this.nextIndex(Z)}return this.state.previous.push(Q),Q}default:{this.state.currentIndex=(this.state.currentIndex+1)%Z.length;let Q=J(Z);if(this.state.previous.length>=Z.length)this.state.previous.splice(0);if(this.state.previous.includes(Q)){let K=Z.map((X,z)=>this.state.previous.includes(z)?0:X),H=J(K);return this.state.previous.push(H),H}return this.state.previous.push(Q),Q}}function J(Q){let K=Q.map((W)=>Math.max(0.0001,W)),H=K.reduce((W,G)=>W+G,0),z=K.map((W)=>W/H).reduce((W,G)=>[...W,W[W.length-1]+G],[0]).splice(1),Y=Math.random();return Math.min(z.findIndex((W)=>W>Y),Q.length-1)}}reset(){this.state.currentIndex=-1,this.state.previous.splice(0)}}class O6{constructor(Z){Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"randomizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"weights",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.weights=Z.voices.map(($)=>{var J;return(J=$.weight)!==null&&J!==void 0?J:50}),this.randomizer=new sZ(Z)}get nextValue(){let Z=this.randomizer.nextIndex(this.weights),$=this.properties.voices[Z];if($===void 0)throw new Error(`Voice ${Z} does not exist`);return $.value}}function B6(Z){return Array.isArray(Z)&&Z.length===2&&typeof Z[0]==="number"&&typeof Z[1]==="number"}function v$(Z){return typeof Z==="number"||B6(Z)}function g$(Z){return Array.isArray(Z)&&Z.length>=1&&Z.every(v$)}function t8(Z){return B6(Z)?m$(...Z):Z}function FZ(Z){return typeof Z==="number"?Z:e8(Z)}function e8(Z){let $=Z.map((Q)=>{return{value:Q}}),J=new O6({voices:$});return t8(J.nextValue)}function q1(Z){let $={};for(let[J,Q]of Object.entries(Z))$[J]=B6(Q)?t8(Q):Q;return $}function IZ(Z){let $={};for(let[J,Q]of Object.entries(Z))$[J]=g$(Q)?e8(Q):Q;return $}function m$(Z,$){if(Z>$){let J=Z;Z=$,$=J}return Math.random()*($-Z)+Z}function F1(Z,$){if(Z>$){let J=Z;Z=$,$=J}return Math.floor(Math.random()*($-Z+1)+Z)}var b;(function(Z){Z[Z.Success=0]="Success",Z[Z.Failure=1]="Failure",Z[Z.AlreadyPaused=2]="AlreadyPaused",Z[Z.AlreadyRunning=3]="AlreadyRunning",Z[Z.ItemUndefined=4]="ItemUndefined"})(b||(b={}));var xZ=[],Z9=8,$9=1024,d$=2147483.646;function c$(Z,$=$9-xZ.length){for(let J=0;J<$;J++){let Q=T0(Z);Q.offset.value=0,Q.connect(Z.destination);let{promise:K,resolve:H,reject:X}=PZ(),z={source:Q,promise:K,resolve:H,reject:X,isPaused:!1,isDone:!1,timeAtPause:-1,timeAtResume:-1,duration:-1,id:LZ.next(),timeAtSchedule:-1,whenToStop:-1,fn:()=>{}};z.source.onended=()=>{z.fn(),z.isDone=!0,z.resolve()},xZ.push(z)}return xZ}function j6(Z,$=64){c$(Z,$);let J=window.setTimeout(()=>{if(xZ.length>=$9)window.clearTimeout(J);else j6(Z,$)},100)}function p$(Z){if(xZ.length<Z9)j6(Z);return xZ.pop()}class D6{constructor(Z){if(Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nextId",{enumerable:!0,configurable:!0,writable:!0,value:(()=>{let $=0;return()=>$++})()}),xZ.length<Z9)j6(Z)}schedule(Z,$){let J=this.context.currentTime,Q=Math.max($-J,0.001),K=J+Q,H=p$(this.context);H.whenToStop=K,H.duration=Q,H.timeAtSchedule=J,H.fn=Z,this.items.set(H.id,H),H.source.addEventListener("ended",()=>{this.items.delete(H.id)},{once:!0}),H.source.start();try{H.source.stop(K)}catch(X){V().debug("[ecas] scheduler failed to stop source",X)}return H.id}pause(Z){V().debug("[ecas] scheduler pausing",Z);let $=(K)=>{if(K.isPaused||K.isDone)return b.AlreadyPaused;else K.isPaused=!0,K.timeAtPause=this.context.currentTime;try{K.source.stop(d$)}catch(H){V().debug("[ecas] scheduler failed to stop source",H)}return b.Success};return Z===void 0?(()=>{return[...this.items.values()].map($).every((K)=>K===b.Success)?b.Success:b.Failure})():((K)=>{let H=this.items.get(K);return H===void 0?b.ItemUndefined:$(H)})(Z)}resume(Z){let{debug:$}=V();$("[ecas] scheduler resuming",Z);let J=(H)=>{if(!H.isPaused||H.isDone)return b.AlreadyRunning;H.isPaused=!1,H.timeAtResume=this.context.currentTime,H.whenToStop=H.timeAtSchedule+H.duration+H.timeAtResume-H.timeAtPause;try{H.source.stop(H.whenToStop)}catch(X){$("[ecas] scheduler failed to stop source",X)}return b.Success};return Z===void 0?(()=>{return[...this.items.values()].map(J).every((H)=>H===b.Success)?b.Success:b.Failure})():((H)=>{let X=this.items.get(H);return X===void 0?b.ItemUndefined:J(X)})(Z)}cancel(Z){let $=(K)=>{this.items.delete(K.id),K.isDone=!0,K.source.onended=null;try{K.source.stop()}catch(H){V().debug("[ecas] scheduler failed to stop source",H)}return b.Success};return Z===void 0?(()=>{return this.items.forEach($),b.Success})():((K)=>{let H=this.items.get(K);return H===void 0?b.ItemUndefined:$(H)})(Z)}}class U6 extends uZ{constructor(Z,$){super();Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"scheduledDispatches",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"scheduler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.scheduler=$!==null&&$!==void 0?$:new D6(Z)}scheduleDispatch(Z,$,J){let Q=()=>{this.dispatch(Z,$)},K=this.scheduler.schedule(Q,J),H=this.scheduledDispatches.get(Z);return this.scheduledDispatches.set(Z,H!==void 0?[...H,K]:[K]),K}pauseScheduledDispatch(Z){this.scheduler.pause(Z)}resumeScheduledDispatch(Z){this.scheduler.resume(Z)}cancelScheduledDispatch(Z){this.scheduler.cancel(Z)}pauseScheduledDispatchesByType(Z){this.runForType(Z,($)=>{this.scheduler.pause($)})}resumeScheduledDispatchesByType(Z){this.runForType(Z,($)=>{this.scheduler.resume($)})}cancelScheduledDispatchesByType(Z){this.runForType(Z,($)=>{this.scheduler.cancel($)}),this.scheduledDispatches.set(Z,[])}async waitForDispatch(Z,$){return await new Promise((J,Q)=>{if(($===null||$===void 0?void 0:$.maxWaitTime)!==void 0){let K=()=>{Q(new Error("[ecas] waiting for event dispatch took too long"))};this.scheduler.schedule(K,this.context.currentTime+$.maxWaitTime)}this.addEventListener(Z,(K)=>{J(K)},{once:!0})})}runForType(Z,$){((Q)=>{let K=this.scheduledDispatches.get(Q);return K!==void 0?K:[]})(Z).forEach($)}dispose(){this.scheduledDispatches.forEach((Z)=>{Z.forEach(($)=>{this.scheduler.cancel($)})}),this.scheduledDispatches.clear(),this.map.clear()}}var w6=50;class T6{constructor(Z,$={}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:new s0}),Object.defineProperty(this,"updateLastStartTime",{enumerable:!0,configurable:!0,writable:!0,value:()=>{Object.assign(this.state,{lastStartTime:this.context.currentTime})}}),this.properties=Object.assign({maxVoices:Number.MAX_SAFE_INTEGER,initialDelay:0,fadeOut:0.1,strategy:"kill-oldest",minTimeBetween:0,name:"default"},$),this.state={lastStartTime:-Number.MAX_SAFE_INTEGER}}numberToKill(){return this.queue.items.length-this.properties.maxVoices}setProperties(Z){Object.assign(this.properties,Z)}add(Z,$=!1){let J=()=>{this.queue.enqueue(Object.assign(Z,{priority:Z.properties.priority}));while(this.numberToKill()>0){let H=this.properties.strategy==="kill-oldest"?this.queue.dequeue():this.queue.dequeueLast();V().debug("[ecas] stealer",this.properties.name,"stealing id:",H===null||H===void 0?void 0:H.properties.id),H.stop({initialDelay:this.properties.initialDelay,fadeOut:this.properties.fadeOut})}},Q=!1,K=()=>{if(Q)return;this.queue.removeByPredicate(({properties:H})=>H.id===Z.properties.id),Q=!0};$?J():Z.target.addEventListener("started",J,{once:!0}),Z.target.addEventListener("started",this.updateLastStartTime,{once:!0}),Z.target.addEventListener("cancelled",K,{once:!0}),Z.target.addEventListener("ended",K,{once:!0})}canPlay(Z=w6,$=this.context.currentTime){let J=$-this.state.lastStartTime<this.properties.minTimeBetween,Q=Z>this.queue.lowestPriority;if(J&&!Q||this.properties.maxVoices<=0)return!1;return Object.assign(this.state,{lastStartTime:$}),this.properties.strategy==="kill-oldest"?Z>=this.queue.lowestPriority:Z>this.queue.lowestPriority?!0:this.currentlyPlaying<this.properties.maxVoices}get currentlyPlaying(){return this.queue.items.length}}var u$={Ended:"ended"},n;(function(Z){Z[Z.Success=0]="Success",Z[Z.NoBuffer=1]="NoBuffer",Z[Z.NoDestination=2]="NoDestination",Z[Z.AlreadyPlayed=3]="AlreadyPlayed",Z[Z.UnknownError=4]="UnknownError",Z[Z.NoBeatSyncer=5]="NoBeatSyncer",Z[Z.VoiceLimitReached=6]="VoiceLimitReached"})(n||(n={}));var l$=["Success","NoBuffer","NoDestination","AlreadyPlayed","UnknownError","NoBeatSyncer","VoiceLimitReached"];function A0(Z){return l$[Z]}var AZ=0.001;function L6(Z){return new U6(Z)}var i$=["gain","pan","detune","playbackRate","lowpass","highpass"];class C0{constructor({properties:Z,state:$,context:J,assetRequester:Q,triggerOnPropertyCallback:K}){var H;Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onProperties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerOnPropertyCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"assetRequester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"automator",{enumerable:!0,configurable:!0,writable:!0,value:new P(i$)}),Object.defineProperty(this,"target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pan",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowPass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"highPass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.properties=Object.assign({id:(H=Z===null||Z===void 0?void 0:Z.id)!==null&&H!==void 0?H:LZ.next(),name:"buffer",disposeWhenEnded:!0,priority:w6},Z),this.state=Object.assign({hasStopped:!1,hasScheduled:!1,hasCanceled:!1,hasEnded:!1,hasStarted:!1,startedDispatch:0,isDisposed:!1,stopTime:0},$),this.triggerOnPropertyCallback=K,this.onProperties={},this.context=J,this.assetRequester=Q,this.target=L6(J),this.fader=new F6(this.context),this.source=this.context.createBufferSource(),this.pan=this.context.createStereoPanner(),this.gain=this.context.createGain(),this.lowPass=this.context.createBiquadFilter(),this.lowPass.type="lowpass",this.lowPass.frequency.value=this.context.sampleRate/2,this.highPass=this.context.createBiquadFilter(),this.highPass.type="highpass",this.highPass.frequency.value=30,this.fader.connect(this.gain).connect(this.lowPass).connect(this.highPass).connect(this.pan),this.automator.add("gain",this.gain.gain),this.automator.add("pan",this.pan.pan),this.automator.add("lowpass",this.lowPass.frequency),this.automator.add("highpass",this.highPass.frequency),this.automator.add("detune",this.source.detune),this.automator.add("playbackRate",this.source.playbackRate)}get output(){return this.pan}connect(Z){if(this.state.isDisposed)return Z;return this.output.connect(Z)}disconnect(){this.output.disconnect()}play(Z={}){var $;let{log:J,debug:Q}=V();if(Q("[ecas] buffer play",this.properties.name,"with options:",Z),this.state.hasScheduled||this.state.isDisposed)return n.AlreadyPlayed;try{let{envelopes:K,tempo:H,beatSync:X,lowpass:z,highpass:Y,duration:W,priority:G=this.properties.priority,detune:O=0,playbackRate:q=1,loop:B=!1,loopEnd:T=-1,loopStart:w=0,when:JZ=this.context.currentTime,offset:o=0,gain:h=1,pan:S=0,fadeIn:R=0,fadeOut:_=0,destinationName:g="master",sourceName:E="default",syncerName:QZ="default",stealerName:_Z="default",stealEvent:E0="started",initialDelay:I0=0,beatSyncOffset:x0=0,reverse:h0=!1,resync:_0=!1}=IZ(Z);if(G!==void 0)this.properties.priority=G;this.onProperties={onCancelled:Z.onCancelled,onEnded:Z.onEnded,onFadeInEnded:Z.onFadeInEnded,onFadeOutStarted:Z.onFadeOutStarted,onScheduled:Z.onScheduled,onStarted:Z.onStarted,onStopped:Z.onStopped};let tZ=J9(q),L=this.assetRequester.requestDestination(g),k=h0?this.assetRequester.requestBufferReversed(E):this.assetRequester.requestBuffer(E);if(k===null)return Q("[ecas] playback-error: no buffer for buffer:",this.properties.name),this.target.dispatch("error",this.properties),n.NoBuffer;if(L===null)return Q("[ecas] playback-error: no destination for buffer:",this.properties.name),this.target.dispatch("error",this.properties),n.NoDestination;let KZ=X!==void 0,a=KZ?this.assetRequester.requestSyncer(QZ):null;if(KZ&&a===null)return Q("[ecas] playback-error: no beatSyncer for buffer:",this.properties.name),this.target.dispatch("error",this.properties),n.NoBeatSyncer;let cZ=JZ+I0;if(_0)a===null||a===void 0||a.resync(cZ),H!==void 0&&(a===null||a===void 0||a.setTempo(H));let y=KZ?a.getSyncTime(X,cZ,x0,H):Math.max(this.context.currentTime,cZ),yZ=this.assetRequester.requestStealer(_Z);if((yZ===null||yZ===void 0?void 0:yZ.canPlay(G,y))===!1)return Q("[ecas] playback-error: voice-limit reached for buffer:",this.properties.name),this.target.dispatch("error",this.properties),n.VoiceLimitReached;let M9=y-this.context.currentTime,N9=E0==="scheduled"||M9<AZ;if(yZ===null||yZ===void 0||yZ.add(this,N9),this.connect(L),this.gain.gain.value=h,this.pan.pan.value=S,z!==void 0)this.lowPass.frequency.value=z;if(Y!==void 0)this.highPass.frequency.value=Y;if(this.source.playbackRate.value=tZ,this.source.detune.value=O,this.source.loop=B,this.source.loopStart=w,this.source.loopEnd=T,this.source.loopEnd=w!==0&&T===-1?k.duration:T,this.source.buffer=k,this.source.addEventListener(u$.Ended,()=>{var t,zZ;if(this.state.hasStarted){if(this.target.dispatch("ended",this.properties),this.onProperties.onEnded!==void 0)(t=this.triggerOnPropertyCallback)===null||t===void 0||t.call(this,this.onProperties.onEnded)}else{if(this.state.startedDispatch!==-1)this.target.cancelScheduledDispatch(this.state.startedDispatch);if(this.target.dispatch("cancelled",this.properties),Q("[ecas] buffer cancel successful for buffer",this.properties.name),this.state.hasCanceled=!0,this.onProperties.onCancelled!==void 0)(zZ=this.triggerOnPropertyCallback)===null||zZ===void 0||zZ.call(this,this.onProperties.onCancelled)}if(this.state.hasEnded=!0,this.properties.disposeWhenEnded)this.dispose()},{once:!0}),this.source.connect(this.fader.input),R>AZ){let t={duration:R,when:y},zZ=this.onProperties.onFadeInEnded;if(zZ!==void 0)t.onFadeInEnded=()=>{var bZ;(bZ=this.triggerOnPropertyCallback)===null||bZ===void 0||bZ.call(this,zZ)};this.fader.fadeIn(t)}let x6=W!==null&&W!==void 0?W:this.source.buffer.duration/tZ-o;if(_>AZ&&x6>AZ){let t=y+x6-_-AZ,zZ={duration:_,when:t},bZ=this.onProperties.onFadeOutStarted;if(bZ!==void 0)zZ.onFadeOutStarted=()=>{var y0;(y0=this.triggerOnPropertyCallback)===null||y0===void 0||y0.call(this,bZ)};this.fader.fadeOut(zZ)}if(W===void 0)this.source.start(y,o);else this.source.start(y,o,W);if(this.state.stopTime=y+(W!==null&&W!==void 0?W:Number.MAX_SAFE_INTEGER),this.state.hasScheduled=!0,this.target.dispatch("scheduled",this.properties),this.onProperties.onScheduled!==void 0)($=this.triggerOnPropertyCallback)===null||$===void 0||$.call(this,this.onProperties.onScheduled);if(this.target.addEventListener("started",()=>{var t;if(Q("[ecas] buffer started:",this.properties.name),this.state.hasStarted=!0,this.onProperties.onStarted!==void 0)(t=this.triggerOnPropertyCallback)===null||t===void 0||t.call(this,this.onProperties.onStarted)},{once:!0}),y-AZ>this.context.currentTime)this.state.startedDispatch=this.target.scheduleDispatch("started",this.properties,y-AZ);else this.target.dispatch("started",this.properties),this.state.startedDispatch=-1;if(K!==void 0)this.applyEnvelopes(Object.assign(Object.assign({},K),{when:y}))}catch(K){return J("[ecas] playback-error for buffer:",this.properties.name,K),this.target.dispatch("error",this.properties),n.UnknownError}return n.Success}applyEnvelopes(Z){var $,J,Q,K,H,X;let{debug:z}=V();if(z("[ecas] buffer applyEnvelope",this.properties.name,Z),this.state.hasEnded||this.state.isDisposed){z("[ecas] buffer already ended, returning early",this.properties.name);return}if(!this.state.hasScheduled)z("[ecas] applying envelope to buffer that has not been scheduled yet. Detune and playbackRate can not be applied.",this.properties.name);let{detune:Y,gain:W,pan:G,playbackRate:O,lowpass:q,highpass:B,when:T=this.context.currentTime,initialDelay:w=0,beatSync:JZ,syncerName:o="default",beatSyncOffset:h=0}=IZ(Z),S=JZ!==void 0,R=S?this.assetRequester.requestSyncer(o):null;if(S&&R===null)z(`[ecas] buffer-apply-envelope-error: no beatsyncer for buffer apply envelope to buffer ${this.properties.name}`),this.target.dispatch("error",this.properties);let _=T+w,g=S&&R!==null?R.getSyncTime(JZ,_,h):Math.max(this.context.currentTime,_),E={context:this.context,automator:this.automator};if(O!==void 0&&this.state.hasScheduled){let QZ=Object.assign(Object.assign({},O),{points:O.points.map(s$)});WZ(Object.assign(Object.assign(Object.assign({},E),QZ),{when:g,initialDelay:w+(($=QZ.initialDelay)!==null&&$!==void 0?$:0),paramId:"playbackRate"}))}if(Y!==void 0&&this.state.hasScheduled)WZ(Object.assign(Object.assign(Object.assign({},E),Y),{when:g,initialDelay:w+((J=Y.initialDelay)!==null&&J!==void 0?J:0),paramId:"detune"}));if(W!==void 0)WZ(Object.assign(Object.assign(Object.assign({},E),W),{when:g,initialDelay:w+((Q=W.initialDelay)!==null&&Q!==void 0?Q:0),paramId:"gain"}));if(G!==void 0)WZ(Object.assign(Object.assign(Object.assign({},E),G),{when:g,initialDelay:w+((K=G.initialDelay)!==null&&K!==void 0?K:0),paramId:"pan"}));if(q!==void 0)WZ(Object.assign(Object.assign(Object.assign({},E),q),{when:g,initialDelay:w+((H=q.initialDelay)!==null&&H!==void 0?H:0),paramId:"lowpass"}));if(B!==void 0)WZ(Object.assign(Object.assign(Object.assign({},E),B),{when:g,initialDelay:w+((X=B.initialDelay)!==null&&X!==void 0?X:0),paramId:"highpass"}))}stop(Z={}){var $;let{debug:J}=V();if(J("[ecas] buffer stop",this.properties.name,"with options",Z),this.state.hasEnded||this.state.isDisposed){J("[ecas] buffer stop called after already ended. Returning early.",this.properties.name);return}let{when:Q=this.context.currentTime,fadeOut:K=0,initialDelay:H=0,envelopes:X,beatSync:z,syncerName:Y="default",beatSyncOffset:W=0}=IZ(Z),G=z!==void 0,O=G?this.assetRequester.requestSyncer(Y):null;if(G&&O===null)J(`[ecas] buffer-stop-error: no beatsyncer for stop buffer ${this.properties.name}`),this.target.dispatch("error",this.properties);let q=Q+H,B=G&&O!==null?O.getSyncTime(z,q,W):Math.max(this.context.currentTime,q),T=B+K;if(this.state.stopTime=T,K>AZ)this.fader.fadeOut({when:B,duration:K});if(X!==void 0)this.applyEnvelopes(Object.assign(Object.assign({},X),{when:B}));try{if(this.source.stop(T),this.onProperties.onStopped!==void 0)($=this.triggerOnPropertyCallback)===null||$===void 0||$.call(this,this.onProperties.onStopped)}catch(w){return}this.state.hasStopped=!0,this.target.dispatch("stopped",this.properties)}dispose(){if(this.state.isDisposed)return;this.state.isDisposed=!0;let{debug:Z}=V();Z("[ecas] buffer dispose",this.properties.name);try{this.source.stop()}catch($){}this.target.dispatch("disposed",this.properties),this.target.dispose(),this.source.buffer=null,Object.assign(this,{triggerOnPropertyCallback:void 0}),this.onProperties={},this.fader.dispose()}}function J9(Z){if(RZ)return Math.max(0.0001,Z);else return Math.max(0,Z)}function s$(Z){return typeof Z.val==="number"?Object.assign(Object.assign({},Z),{val:J9(Z.val)}):Z}var r$={name:"container",initialDelay:0,strategy:"sequence-restart",avoidRepeatingLast:1,destinationName:"master",gain:1,pan:0,detune:0,highpass:0,lowpass:18000,voices:[]};class A6{constructor({player:Z,properties:$,state:J}){Object.defineProperty(this,"player",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"randomizer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.player=Z,this.properties=Object.assign(Object.assign({},r$),$),this.state=Object.assign({ids:[]},J),this.randomizer=new sZ({strategy:this.properties.strategy,avoidRepeatingLast:this.properties.avoidRepeatingLast,weights:this.properties.voices.map((Q)=>{var K;return(K=Q.weight)!==null&&K!==void 0?K:50})})}getNextVoice(Z={}){var $,J,Q,K,H,X,z,Y,W,G,O,q,B,T,w;let JZ=this.randomizer.nextIndex(),o=this.properties.voices[JZ];if(o===void 0)return j(new Error(`[ecas]: Container: '${this.properties.name}' could not find a voice for voiceIndex: ${JZ}`));let h=LZ.next();this.state.ids.push(h);let S=IZ(o),R=IZ(Z);return F(Object.assign(Object.assign(Object.assign({},S),R),{id:h,name:($=S.name)!==null&&$!==void 0?$:this.properties.name,destinationName:(Q=(J=R.destinationName)!==null&&J!==void 0?J:S.destinationName)!==null&&Q!==void 0?Q:this.properties.destinationName,initialDelay:((H=(K=R.initialDelay)!==null&&K!==void 0?K:S.initialDelay)!==null&&H!==void 0?H:0)+FZ(this.properties.initialDelay),gain:((z=(X=R.gain)!==null&&X!==void 0?X:S.gain)!==null&&z!==void 0?z:1)*FZ(this.properties.gain),detune:((W=(Y=R.detune)!==null&&Y!==void 0?Y:S.detune)!==null&&W!==void 0?W:0)+FZ(this.properties.detune),pan:((O=(G=R.pan)!==null&&G!==void 0?G:S.pan)!==null&&O!==void 0?O:0)+FZ(this.properties.pan),lowpass:(B=(q=R.lowpass)!==null&&q!==void 0?q:S.lowpass)!==null&&B!==void 0?B:FZ(this.properties.lowpass),highpass:(w=(T=R.highpass)!==null&&T!==void 0?T:S.highpass)!==null&&w!==void 0?w:FZ(this.properties.highpass)}))}play(Z={initialDelay:0}){let $=this.getNextVoice(Z);if($.isErr())return V().log("[ecas] trying to play container",this.properties.name,"when getting next voice returned an error:",$.error),n.UnknownError;return this.player.play($.value)}stop(Z){for(let $ of this.state.ids)this.player.stopById(Object.assign({id:$},Z))}reset(){this.randomizer.reset()}}var n$={min:8,max:128,interval:40,replenish:8},gZ;(function(Z){Z[Z.INITIAL=0]="INITIAL",Z[Z.DISPOSED=1]="DISPOSED"})(gZ||(gZ={}));class C6{constructor(Z){if(Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"triggerOnPropertyCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:new J0}),Object.defineProperty(this,"target",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flyweights",{enumerable:!0,configurable:!0,writable:!0,value:new J0}),Object.defineProperty(this,"flyweightOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flyweightTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:gZ.INITIAL}),Object.defineProperty(this,"remover",{enumerable:!0,configurable:!0,writable:!0,value:($)=>{let J=!1;return()=>{if(J)return;this.queue.removeByPredicate((Q)=>Q.properties.id===$.properties.id),J=!0}}}),this.target=L6(Z.context),this.flyweightOptions=Object.assign(Object.assign({},n$),Z.flyweightOptions),this.triggerOnPropertyCallback=Z.triggerOnPropertyCallback,!RZ)window.setTimeout(()=>{this.refillFlyweights(Math.min(this.flyweightOptions.replenish,this.flyweightOptions.max))},0)}refillFlyweights(Z=this.flyweightOptions.replenish){if(this.state===gZ.DISPOSED)return;if(this.flyweightTimeout!==void 0){HZ`[ecas] tried to refill while already in progress`;return}this.createFlyweights(Z),this.flyweightTimeout=window.setTimeout(()=>{if(window.clearTimeout(this.flyweightTimeout),this.flyweightTimeout=void 0,this.flyweights.length<this.flyweightOptions.max)this.refillFlyweights()},this.flyweightOptions.interval)}createFlyweights(Z){for(let $=0;$<Z;$++)this.flyweights.enqueue(new C0(this.options))}play(Z){var $,{name:J,id:Q=LZ.next(),priority:K=50}=Z,H=i(Z,["name","id","priority"]);let X=($=this.flyweights.dequeue())!==null&&$!==void 0?$:new C0(this.options);Object.assign(X.properties,{id:Q,name:J,priority:K});let z=this.onstarted.bind(this),Y=this.onended.bind(this);X.target.addEventListener("started",z,{once:!0}),X.target.addEventListener("ended",Y,{once:!0});let W=X.play(H);if(W!==n.Success)X.dispose();else{this.queue.enqueue(X);let G=this.remover(X);X.target.addEventListener("ended",G,{once:!0}),X.target.addEventListener("cancelled",G,{once:!0})}if(this.flyweights.length<this.flyweightOptions.min&&!RZ)setTimeout(()=>{this.refillFlyweights(4)},40);return W}onstarted({detail:Z}){this.target.dispatch("started",Z)}onended({detail:Z}){this.target.dispatch("ended",Z)}applyEnvelopeByName({name:Z,envelopes:$}){this.selectByName(Z).forEach(J);function J(Q){Q.applyEnvelopes(Object.assign({},$))}}applyEnvelopeById({id:Z,envelopes:$}){this.selectById(Z).forEach(J);function J(Q){Q.applyEnvelopes($)}}applyEnvelopeToAll({envelopes:Z}){this.queue.items.forEach($);function $(J){J.applyEnvelopes(Z)}}stopByName(Z){this.queue.dequeueByPredicate($).forEach(J);function $({properties:Q}){return Q.name===Z.name}function J(Q){Q.stop(Z)}}stopById(Z){this.queue.dequeueByPredicate($).forEach(J);function $({properties:Q}){return Q.id===Z.id}function J(Q){Q.stop(Z)}}stopAll(Z={}){for(let $ of this.queue.drain())$.stop(Z)}stopOldest(Z={}){var $;($=this.queue.dequeue())===null||$===void 0||$.stop(Z)}stopNewest(Z={}){var $;($=this.queue.dequeueLast())===null||$===void 0||$.stop(Z)}selectById(Z){return this.queue.items.filter(($)=>$.properties.id===Z)}selectByName(Z){return this.queue.items.filter(($)=>$.properties.name===Z)}dispose(){if(this.state===gZ.DISPOSED)return;this.state=gZ.DISPOSED;for(let Z of this.queue.drain())Z.dispose();for(let Z of this.flyweights.drain())Z.dispose();this.target.dispose(),window.clearTimeout(this.flyweightTimeout),this.flyweightTimeout=void 0}}class M6{constructor(Z,$={},J={}){Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"properties",{enumerable:!0,configurable:!0,writable:!0,value:{lookAhead:0.02,beatsPerBar:4,ticksPerBeat:4,tempo:120}}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{isRunning:!1,startTime:0}}),g0(this.properties,$),g0(this.state,J)}start(Z=this.context.currentTime){V().debug("[ecas] MusicalSyncer started"),this.state.startTime=Z,this.state.isRunning=!0}setTempo(Z){this.properties.tempo=Z}stop(){this.state.isRunning=!1}resync(Z=this.context.currentTime){this.start(Z)}getSyncTime(Z,$,J=0,Q=this.properties.tempo){if(!this.state.isRunning)this.start();switch(Z){case"tick":return this.getTickSyncTime($,Q)+J;case"eighth":return this.getEightSyncTime($,Q)+J;case"beat":return this.getBeatSyncTime($,Q)+J;case"bar":return this.getBarSyncTime($,Q)+J;default:return this.getSyncedTime(Z,$,Q)+J}}getTickSyncTime(Z,$=this.properties.tempo){return this.getSyncedTime(this.properties.ticksPerBeat,Z,$)}getEightSyncTime(Z,$=this.properties.tempo){return this.getSyncedTime(2,Z,$)}getBeatSyncTime(Z,$=this.properties.tempo){return this.getSyncedTime(1,Z,$)}getBarSyncTime(Z,$=this.properties.tempo){return this.getSyncedTime(1/this.properties.beatsPerBar,Z,$)}getSyncedTime(Z,$=0,J=this.properties.tempo){let Q=this.context.currentTime,H=Math.max($,Q)-this.state.startTime,X=60/J/Z,z=Math.ceil(H/X);return this.state.startTime+z*X+this.properties.lookAhead}}var o$={Thirtytwoo:8,Sixteenth1:4,Sixteenth2:2,Sixteenth3:1.3333333333,Sixteenth4:1,Sixteenth5:0.8,Sixteenth6:0.6666666667,Sixteenth7:0.5714285714,Sixteenth8:0.5,Sixteenth9:0.4444444444,Sixteenth10:0.4,Sixteenth11:0.3636363636,Sixteenth12:0.3333333333333333,Sixteenth13:0.3076923077,Sixteenth14:0.2857142857,Sixteenth15:0.2666666667,Sixteenth16:0.25,Eigth1:2,Eigth2:1,Eigth3:0.75,Eigth4:0.5,Eigth5:0.4,Eigth6:0.3333333333333333,Eigth7:0.2857142857,Eigth8:0.25,Beat1:1,Beat2:0.5,Beat3:0.3333333333333333,Beat4:0.25,Bar1:0.25,Bar2:0.125,Bar3:0.08333333333333333,Bar4:0.0625,Bar5:0.05,Bar6:0.041666666666666664,Bar7:0.03571428571428571,Bar8:0.03125,Bar9:0.03125,Bar10:0.03125,Bar11:0.03125,Bar12:0.03125,Bar13:0.03125,Bar14:0.03125,Bar15:0.03125,Bar16:0.015625,ThirtytwooTriplet:6,SixteenthTriplet:2.6666666667,EighthTriplet:1.3333333333,BeatTriplet:0.6666666667,HalfNote:0.5,HalfNoteTriplet:0.375,BarTriplet:0.1875},a$=Object.assign(Object.assign({},o$),{Bar:0.3333333333333333,BarTriple:0.25,BarTwo:0.16666666666666666,BarFour:0.08333333333333333,BarEigth:0.041666666666666664,BarSixteen:0.020833333333333332}),o1=a$,a1={ThirtytwooTriplet:5,Thirtytwoo:7.5,SixteenthTriplet:10,Sixteenth1:15,Sixteenth2:30,Sixteenth3:45,Sixteenth4:60,Sixteenth5:75,Sixteenth6:90,Sixteenth7:105,Sixteenth8:120,Sixteenth9:135,Sixteenth10:150,Sixteenth11:165,Sixteenth12:180,Sixteenth13:195,Sixteenth14:210,Sixteenth15:225,Sixteenth16:240,EightTriplet:10,Eigth1:30,Eigth2:60,Eigth3:90,Eigth4:120,Eigth5:150,Eigth6:180,Eigth7:210,Eigth8:240,BeatTriplet:40,HalfNoteTriplet:80,HalfNote:120,Beat1:60,Beat2:120,Beat3:180,Beat4:240,Beat5:300,Beat6:360,Beat7:420,Beat8:480,Bar1:240,Bar2:480,Bar3:720,Bar4:960,Bar5:1200,Bar6:1440,Bar7:1680,Bar8:1920};function M0(Z=Array){let $=!1;if(Z.prototype.flat===void 0)Z.prototype.flat=t$,$=!0;if(Z.prototype.flatMap===void 0)Z.prototype.flatMap=e$,$=!0;return $}function t$(Z=1){if(Z<1)return this;let $=[];for(let J of this)if(Array.isArray(J))$.push(...J.flat(Z-1));else $.push(J);return $}function e$(Z){return this.map(Z).flat()}function Q9(Z){var $;let J=($=Z.AudioParam)===null||$===void 0?void 0:$.prototype;if(J===void 0){V().debug("[polyfill]: (AudioParam) no AudioParam.prototype found. Skipping polyfill.");return}if(!f(J,"cancelAndHoldAtTime")&&f(J,"cancelScheduledValues"))V().debug("[polyfill]: (AudioParam) installing cancelAndHoldAtTime"),D(J,"cancelAndHoldAtTime",{value:J.cancelScheduledValues});if(!f(J,"automationRate"))V().debug("[polyfill]: (AudioParam) installing automationRate"),D(J,"automationRate",{value:"a-rate"})}function K9(){if(typeof AudioContext==="undefined")return;if(AudioContext.prototype.createConstantSource===void 0)AudioContext.prototype.createConstantSource=Z4}function Z4(){return new H9(this)}class H9{constructor(Z,$){var J;Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"oscillator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gainNode",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"offset",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let Q=(J=$===null||$===void 0?void 0:$.offset)!==null&&J!==void 0?J:1;this.oscillator=Z.createOscillator(),this.oscillator.type="sine",this.oscillator.frequency.value=0,this.gainNode=Z.createGain(),this.gainNode.gain.value=Q,this.offset=this.gainNode.gain,this.oscillator.connect(this.gainNode)}start(Z){this.oscillator.start(Z)}stop(Z){this.oscillator.stop(Z)}addEventListener(Z,$,J){this.oscillator.addEventListener(Z,$,J)}dispatchEvent(Z){return this.oscillator.dispatchEvent(Z)}removeEventListener(Z,$,J){this.oscillator.removeEventListener(Z,$,J)}get channelCount(){return this.oscillator.channelCount}set channelCount(Z){this.oscillator.channelCount=Z}get channelCountMode(){return this.oscillator.channelCountMode}set channelCountMode(Z){this.oscillator.channelCountMode=Z}get channelInterpretation(){return this.oscillator.channelInterpretation}set channelInterpretation(Z){this.oscillator.channelInterpretation=Z}connect(Z,$,J){return this.gainNode.connect(Z,$,J)}disconnect(Z,$,J){Z===void 0?this.gainNode.disconnect():this.gainNode.disconnect(Z,$,J)}get detune(){return this.oscillator.detune}get frequency(){return this.oscillator.frequency}get numberOfInputs(){return this.oscillator.numberOfInputs}get numberOfOutputs(){return this.oscillator.numberOfOutputs}get onended(){return this.oscillator.onended}set onended(Z){this.oscillator.onended=Z}}class hZ{preventDefault(){this.defaultPrevented=!0}composedPath(){return[]}stopImmediatePropagation(){}stopPropagation(){}initEvent(Z,$,J){this.type=Z,this.bubbles=$!==null&&$!==void 0?$:!1,this.cancelable=J!==null&&J!==void 0?J:!1}constructor(Z,$){var J,Q,K;Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bubbles",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cancelable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"composed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentTarget",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"eventPhase",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isTrusted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"returnValue",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"srcElement",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"target",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"timeStamp",{enumerable:!0,configurable:!0,writable:!0,value:Date.now()}),Object.defineProperty(this,"cancelBubble",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"defaultPrevented",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"NONE",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"CAPTURING_PHASE",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"AT_TARGET",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"BUBBLING_PHASE",{enumerable:!0,configurable:!0,writable:!0,value:3}),this.bubbles=(J=$===null||$===void 0?void 0:$.bubbles)!==null&&J!==void 0?J:!1,this.cancelable=(Q=$===null||$===void 0?void 0:$.cancelable)!==null&&Q!==void 0?Q:!1,this.composed=(K=$===null||$===void 0?void 0:$.composed)!==null&&K!==void 0?K:!1,this.type=Z}}Object.defineProperty(hZ,"NONE",{enumerable:!0,configurable:!0,writable:!0,value:0});Object.defineProperty(hZ,"CAPTURING_PHASE",{enumerable:!0,configurable:!0,writable:!0,value:1});Object.defineProperty(hZ,"AT_TARGET",{enumerable:!0,configurable:!0,writable:!0,value:2});Object.defineProperty(hZ,"BUBBLING_PHASE",{enumerable:!0,configurable:!0,writable:!0,value:3});class N6{constructor(Z,$={pan:0}){var J;Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pan",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelCount",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"channelCountMode",{enumerable:!0,configurable:!0,writable:!0,value:"clamped-max"}),Object.defineProperty(this,"channelInterpretation",{enumerable:!0,configurable:!0,writable:!0,value:"speakers"}),Object.defineProperty(this,"numberOfInputs",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"numberOfOutputs",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"addEventListener",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),Object.defineProperty(this,"dispatchEvent",{enumerable:!0,configurable:!0,writable:!0,value:()=>!0}),Object.defineProperty(this,"removeEventListener",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),Object.defineProperty(this,"isStereoPannerNode",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.context=Z,this._input=this.context.createGain(),this._output=this.context.createGain();let Q=(J=$.pan)!==null&&J!==void 0?J:0,K=this.context.createChannelSplitter(2),H=this.context.createGain(),X=this.context.createGain(),z=this.context.createGain(),Y=this.context.createGain(),W=this.context.createChannelMerger(2),G=this.context.createChannelMerger(2),O=this.context.createChannelMerger(2);this._input.connect(K),K.connect(H,0),K.connect(X,0),K.connect(z,1),K.connect(Y,1),H.connect(W,0,0),Y.connect(W,0,0),z.connect(G,0,1),X.connect(G,0,1),W.connect(O,0,0),G.connect(O,0,1),O.connect(this._output),this.pan={get value(){return Q},set value(q){H.gain.value=1-Math.max(q,0),Y.gain.value=-Math.min(q,0),z.gain.value=1+Math.min(q,0),X.gain.value=Math.max(q,0),Q=q},get automationRate(){return"a-rate"},get defaultValue(){return 0},get maxValue(){return 1},get minValue(){return-1},cancelAndHoldAtTime:(q)=>{return this.pan},cancelScheduledValues:(q)=>{return this.pan},exponentialRampToValueAtTime:(q,B)=>{return this.pan.value=q,this.pan},linearRampToValueAtTime:(q,B)=>{return this.pan.value=q,this.pan},setTargetAtTime:(q,B,T)=>{return this.pan.value=q,this.pan},setValueAtTime:(q,B)=>{return this.pan.value=q,this.pan},setValueCurveAtTime:(q,B,T)=>{return this.pan.value=Number(q[q.length-1]),this.pan}},this.pan.value=Q}connect(...Z){try{this._output.connect.apply(this._output,Z)}catch($){V().debug($)}}disconnect(...Z){try{this._output.disconnect.apply(this._output,Z)}catch($){V().debug($)}}toString(){return"StereoPannerNode"}}function X9(Z=window){let $=Z.AudioContext.prototype;function J(K,H){return new N6(K,H)}D($,"createStereoPanner",{value:function(K){return J(this,K)}});let Q=Z.AudioNode.prototype.connect;if(D(Z.AudioNode.prototype,"connect",{value:function(K,H,X){function z(Y){return f(Y,"isStereoPannerNode")&&Y.isStereoPannerNode===!0}if(z(K))K=K._input;return Q.call(this,K,H!==null&&H!==void 0?H:0,X!==null&&X!==void 0?X:0)}}),Z.StereoPannerNode===void 0)Z.StereoPannerNode=N6}var $4=-340282346638528860000000000000000000000,z9=340282346638528860000000000000000000000;class k6{constructor(Z){Object.defineProperty(this,"playbackRate",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"rate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_detune",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.rate=Z.value,this._detune=0}get automationRate(){return this.playbackRate.automationRate}set automationRate(Z){this.playbackRate.automationRate=Z}get maxValue(){return this.playbackRate.maxValue}get minValue(){return this.playbackRate.minValue}get defaultValue(){return this.playbackRate.defaultValue}set value(Z){let $=U(Z,this.minValue,this.maxValue);this.rate=$,this.playbackRate.value=$}get value(){return this.rate}get detune(){return this._detune}set detune(Z){this._detune=Z,this.playbackRate.value=mZ(this.rate)(Z)}cancelAndHoldAtTime(Z){return this.playbackRate.cancelAndHoldAtTime(Z),this}cancelScheduledValues(Z){return this.playbackRate.cancelScheduledValues(Z),this}exponentialRampToValueAtTime(Z,$){return this.playbackRate.exponentialRampToValueAtTime(Z,$),this}linearRampToValueAtTime(Z,$){return this.rate=Z,this.playbackRate.linearRampToValueAtTime(Z,$),this}setTargetAtTime(Z,$,J){return this.rate=Z,this.playbackRate.setTargetAtTime(Z,$,J),this}setValueAtTime(Z,$){return this.rate=Z,this.playbackRate.setValueAtTime(Z,$),this}setValueCurveAtTime(Z,$,J){var Q;return this.rate=(Q=Z[Z.length-1])!==null&&Q!==void 0?Q:this.rate,this.playbackRate.setValueCurveAtTime(Z,$,J),this}}class S6{constructor(Z){Object.defineProperty(this,"playbackRate",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"automationRate",{enumerable:!0,configurable:!0,writable:!0,value:"k-rate"}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxValue",{enumerable:!0,configurable:!0,writable:!0,value:z9}),Object.defineProperty(this,"minValue",{enumerable:!0,configurable:!0,writable:!0,value:$4}),Object.defineProperty(this,"detune",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.detune=0}cancelAndHoldAtTime(Z){return this.playbackRate.cancelAndHoldAtTime(Z),this}cancelScheduledValues(Z){return this.playbackRate.cancelScheduledValues(Z),this}exponentialRampToValueAtTime(Z,$){return this.detune=Z,this.playbackRate.exponentialRampToValueAtTime(mZ(this.playbackRate.rate)(Z),$),this}linearRampToValueAtTime(Z,$){return this.detune=Z,this.playbackRate.linearRampToValueAtTime(mZ(this.playbackRate.rate)(Z),$),this}setTargetAtTime(Z,$,J){return this.playbackRate.setTargetAtTime(mZ(this.playbackRate.rate)(Z),$,J),this}setValueAtTime(Z,$){return this.detune=Z,this.playbackRate.setValueAtTime(mZ(this.playbackRate.rate)(Z),$),this}setValueCurveAtTime(Z,$,J){var Q;this.detune=(Q=Z[Z.length-1])!==null&&Q!==void 0?Q:this.detune;let K=mZ(this.playbackRate.rate);return this.playbackRate.setValueCurveAtTime(Z.map(K),$,J),this}get value(){return this.detune}set value(Z){let $=U(Z,this.minValue,this.maxValue);this.detune=$,this.playbackRate.detune=$}}function J4(Z){return U(Math.pow(2,Z/1200),0,z9)}function mZ(Z){return($)=>J4($)*Z}function Y9(Z){if(Z.webkitAudioContext===void 0){V().log("[polyfill]: cannot install webkitAudioContext polyfill since webkitAudioContext does not exist on global.");return}function $(Q){var K;Boolean(Q)&&D(Q,"setTargetAtTime",{value:(K=Q.setTargetAtTime)!==null&&K!==void 0?K:Q.setTargetValueAtTime})}let J=Z.webkitAudioContext.prototype;if("polyfilled"in J&&J.polyfilled===!0){V().log("[polyfill]: webkitAudioContext polyfill has already been installed.");return}if(!f(J,"createScriptProcessor"))D(J,"createScriptProcessor",{value:J.createJavaScriptNode,writable:!0});if(!f(J,"createPeriodicWave"))D(J,"createPeriodicWave",{value:J.createWaveTable,writable:!0});if(!f(J,"createGain"))D(J,"createGain",{value:function(){let Q=this.createGainNode();return $(Q.gain),Q}});if(!f(J,"createDelay"))D(J,"createDelay",{value:function(Q){let K=this.createDelayNode(Q);return $(K.delayTime),K}});if(D(J,"internal_createBufferSource",{value:J.createBufferSource,writable:!0}),r0(J).createBufferSource=function(){var Q,K;let H=this.internal_createBufferSource();if(D(H,"start",{value:(Q=H.start)!==null&&Q!==void 0?Q:function(X=0,z,Y){z!==void 0||Y!==void 0?this.noteGrainOn(X,z,Y):this.noteOn(X)}}),D(H,"stop",{value:(K=H.stop)!==null&&K!==void 0?K:function(X=0){this.noteOff(X)}}),$(H.playbackRate),!f(H,"detune"))D(H,"playbackRate",{value:new k6(H.playbackRate)}),D(H,"detune",{value:new S6(H.playbackRate)});return $(H.detune),H},D(J,"internal_createDynamicsCompressor",{value:J.createDynamicsCompressor,writable:!0}),J.createDynamicsCompressor=function(){let Q=this.internal_createDynamicsCompressor();return $(Q.threshold),$(Q.knee),$(Q.ratio),$(Q.attack),$(Q.release),Q},D(J,"internal_createBiquadFilter",{value:J.createBiquadFilter,writable:!0}),J.createBiquadFilter=function(){let Q=this.internal_createBiquadFilter();return $(Q.frequency),$(Q.detune),$(Q.Q),$(Q.gain),Q},f(J,"createOscillator")&&!f(J,"internal_createOscillator"))D(J,"internal_createOscillator",{value:J.createOscillator,writeable:!0}),r0(J).createOscillator=function(){var Q,K,H;let X=this.internal_createOscillator();return D(X,"start",{value:(Q=X.start)!==null&&Q!==void 0?Q:X.noteOn}),D(X,"stop",{value:(K=X.stop)!==null&&K!==void 0?K:function(z=0){this.noteOff(z)}}),D(X,"setPeriodicWave",{value:(H=X.setPeriodicWave)!==null&&H!==void 0?H:X.setWaveTable,writable:!0}),$(X.frequency),$(X.detune),X};if(D(J,"internal_decodeAudioData",{value:J.decodeAudioData,writable:!0}),D(J,"decodeAudioData",{value:async function(Q,K,H){return await new Promise((z,Y)=>{this.internal_decodeAudioData(Q,(W)=>{K!==void 0?K(W):z(W)},(W)=>{H!==void 0?H(W):Y(W)})})}}),D(J,"polyfilled",{value:!0}),Z.AudioContext!==void 0){V().log("[polyfill]: cannot replace AudioContext with webkitAudioContext since AudioContext already exists on global.");return}D(Z,"AudioContext",{value:Z.webkitAudioContext})}function W9(Z={},$=window){M0();let J={AudioParam:"AudioParam"in $,AudioContext:"AudioContext"in $,OfflineAudioContext:"OfflineAudioContext"in $,webkitAudioContext:"webkitAudioContext"in $,webkitOfflineAudioContext:"webkitOfflineAudioContext"in $,createStereoPanner:"AudioContext"in $&&"createStereoPanner"in $.AudioContext.prototype||"webkitAudioContext"in $&&"createStereoPanner"in $.webkitAudioContext,Event:"Event"in $&&typeof $.Event==="function",EventTarget:"EventTarget"in $&&typeof $.EventTarget==="function"},Q={AudioParam:Z.AudioParam===!0||J.AudioParam,webkitAudioContext:Z.webkitAudioContext===!0||J.webkitAudioContext&&!J.AudioContext,webkitOfflineAudioContext:Z.webkitOfflineAudioContext===!0||J.webkitOfflineAudioContext&&!J.OfflineAudioContext,createStereoPanner:Z.createStereoPanner===!0||!J.createStereoPanner,Event:Z.Event===!0||!J.Event};V().debug("[polyfill] Parameters that exist on global:",J);let K=(X)=>{let[z]=Y8(X)($);if(z!==null)V().log(z);return z===null},H={AudioParam:Q.AudioParam===!0&&K(()=>{V().debug("[polyfill] installing AudioParam"),Q9($)}),webkitAudioContext:Q.webkitAudioContext===!0&&K(()=>{V().debug("[polyfill] installing webkitAudioContext"),Y9($)}),webkitOfflineAudioContext:Q.webkitOfflineAudioContext===!0&&K(()=>{V().debug("[polyfill] installing webkitOfflineAudioContext"),D($,"OfflineAudioContext",{value:$.webkitOfflineAudioContext})}),createStereoPanner:Q.createStereoPanner===!0&&K(()=>{V().debug("[polyfill] installing createStereoPanner"),X9($)}),Event:Q.Event===!0&&K(()=>{V().debug("[polyfill] installing Event"),D($,"Event",{value:hZ})})};return K9(),H}var V9="4.1.3";var Q4=()=>{return typeof navigator!=="undefined"},K4=(Z)=>{return(Z!==null&&Z!==void 0?Z:Q4())&&/chrome|firefox/i.test(navigator===null||navigator===void 0?void 0:navigator.userAgent.toLowerCase())},H4=(Z,$)=>{let J=`\uD83C\uDFB5 ECAS: v${Z} \uD83C\uDFB5`;if($){let Q=`
%c${J}%c

`,K="color: #FFFFFF; background: #ff7373; padding:10px",H="padding:0";return[Q,"color: #FFFFFF; background: #ff7373; padding:10px","padding:0"]}else{let Q=J.split("").map(()=>".").join("");return[`${Q}
${J}
${Q}`]}},G9=(Z)=>{Z(...H4(V9,K4()))};function X4(Z=48000){let $=new ArrayBuffer(10),J=new DataView($);return J.setUint32(0,Z,!0),J.setUint32(4,Z,!0),J.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array($))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}function z4(Z){return Z.currentTime>0&&!Z.paused&&!Z.ended&&Z.readyState>2}function q9(Z=new AudioContext,$=navigator.maxTouchPoints>0&&navigator.userAgent.includes("Safari")){if(!$)return!1;let J=document.createElement("audio");return J.setAttribute("x-webkit-airplay","deny"),J.preload="auto",J.loop=!0,J.load(),J.src=X4(Z.sampleRate),Z.addEventListener("statechange",Q),Q(),!0;function Q(){if(Z.state==="closed"){J.pause(),J.remove(),Z.removeEventListener("statechange",Q);return}if(!z4(J)){let K=V().debug;J.play().then(()=>{K("[ecas] html audio is playing")},(H)=>{K("[ecas] failed to play html audio",H,Z.state)})}}}function F9(Z){if(Z.state==="running")return kZ(void 0);let{debug:$,log:J}=V(),Q=new Error("Failed to resume the audio context");J("[ecas] waiting for user interaction so we can start audio context...");let{promise:K,resolve:H,reject:X}=PZ(),z=!1;if(Z.resume().then(()=>{if(z)return;z=!0,H(void 0)}).catch(()=>{$("[ecas] failed to resume the audio context directly")}),!z){let Y=()=>{if(window.removeEventListener("click",Y,{capture:!0}),window.removeEventListener("touchstart",Y,{capture:!0}),window.removeEventListener("keydown",Y,{capture:!0}),window.removeEventListener("click",Y),window.removeEventListener("touchstart",Y),window.removeEventListener("keydown",Y),z)return;let W=Z.state;if(W==="running")z=!0,H(void 0);else if(W==="closed")X(Q);else if(W==="suspended"||W==="interrupted")Z.resume().then(()=>{z=!0,H(void 0)}).catch(()=>{$("[ecas] failed to resume the audio context via user interaction")})};window.addEventListener("click",Y,{capture:!0,once:!0,passive:!0}),window.addEventListener("touchstart",Y,{capture:!0,once:!0,passive:!0}),window.addEventListener("keydown",Y,{capture:!0,once:!0,passive:!0}),window.addEventListener("click",Y,{once:!0,passive:!0}),window.addEventListener("touchstart",Y,{once:!0,passive:!0}),window.addEventListener("keydown",Y,{once:!0,passive:!0})}if(!z){let Y=setInterval(()=>{if(z){clearInterval(Y);return}Z.resume().then(()=>{if(!z)z=!0,H(void 0);clearInterval(Y)}).catch(()=>{})},200)}return SZ(K,()=>{return $("[ecas] failed to resume the audio context"),Q})}function O9(){return{buffers:new Map,promises:new Map}}async function B9({buffers:Z,promises:$},J){let Q=Z.get(J);if(Q!==void 0)return Q.slice(0);let K=$.get(J);if(K===void 0)K=fetch(J),$.set(J,K);let H=await K.catch(()=>{return});if((H===null||H===void 0?void 0:H.ok)!==!0){EZ`[ecas] bad response for ${J}`,$.delete(J);return}if(Q=await H.arrayBuffer(),Q===void 0)EZ`[ecas] undefined arraybuffer for ${J}`;return Z.set(J,Q),$.delete(J),Q.slice(0)}var Y4=4,W4=2;class N0{constructor(Z={},$=new Map,J=(Q)=>{V().debug("disposing ",Q)}){Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"history",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"disposeFile",{enumerable:!0,configurable:!0,writable:!0,value:J})}static create(Z){return new N0(Z.options,Z.history,Z.disposeFile)}limit(Z){let $=R6(this.history)+Z,J=j9(this.options.megabytes);if(!F4($,J))return!1;if(this.options.strategy==="block-new-requests")return HZ`[ecas] memory blocking new requests`,!0;if($-J<0)return!1;HZ`[ecas] memory limit ${J} reached - freeing`;let K=0;do{let H=V4(this.history,this.options.strategy);if(H===void 0){EZ`[ecas] memory no items found to steal`;break}let X=H.megabytes;HZ`[ecas] memory dispose ${H.name}`,this.disposeFile(H.name),H.isActive=!1,$-=X}while($>J&&K++<10);return!1}currentUsage(){return R6(this.history)}add(Z,$,J){let Q=this.history.get(Z),K=P6($,J),H=R6(this.history)+K;if(HZ`[ecas] memory add ${K.toPrecision(4)} - new usage: ${H.toPrecision(4)} - file: ${Z}`,Q===void 0){this.history.set(Z,{megabytes:K,timesUsed:1,name:Z,isActive:!0});return}this.history.set(Z,{megabytes:Q.megabytes,timesUsed:Q.timesUsed+1,name:Z,isActive:!0})}inactive(Z){let $=this.history.get(Z);if($===void 0)return;$.isActive=!1}use(Z,$=1){let J=this.history.get(Z);if(J===void 0){this.history.set(Z,{megabytes:0,timesUsed:$,name:Z,isActive:!1});return}this.history.set(Z,{megabytes:J.megabytes,timesUsed:J.timesUsed+$,name:Z,isActive:!0})}setMemoryLimit(Z){Object.assign(this.options,{megabytes:j9(Z)})}setStrategy(Z){Object.assign(this.options,{strategy:Z})}dispose(){this.history.clear()}}function V4(Z,$){switch($){case"unload-oldest":return G4(Z);default:return q4(Z)}}function G4(Z){for(let $ of Z.values())if($.isActive)return $;return}function q4(Z){let $,J=Number.MAX_SAFE_INTEGER;for(let Q of Z.values())if(Q.isActive&&Q.timesUsed<J)J=Q.timesUsed,$=Q;return $}function j9(Z){return Math.max(Z!==null&&Z!==void 0?Z:Number.MAX_SAFE_INTEGER,W4)}function F4(Z,$){return Z>$}function R6(Z){let $=0;for(let J of Z.values())if(J.isActive)$+=J.megabytes;return $}function O4(Z){return Z/1048576}function P6(Z,$){return O4(Z*$*Y4)}class A{static new(){return new A}static from(Z){let $=A.new();if(Z===null)$.resolve(null);else $.resolve(Z);return $}constructor(){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SoundPromise"}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"internal",{enumerable:!0,configurable:!0,writable:!0,value:PZ()}),Object.defineProperty(this,"resolve",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.unresolve()}unresolve(){this.state=A.State.UNLOADED,this.value=null,this.internal.resolve(null),this.internal=PZ(),this.resolve=(Z)=>{this.state=Z===null?A.State.REJECTED:A.State.LOADED,this.value=Z,this.internal.resolve(Z)},this.reject=(Z)=>{this.state=A.State.REJECTED,this.value=null,this.internal.reject(Z)}}async then(Z,$){if(this.state===A.State.DISPOSED)return null;return await this.internal.promise.then(Z,$)}async catch(Z){if(this.state===A.State.DISPOSED)return null;return await this.internal.promise.catch(Z)}async finally(Z){if(this.state===A.State.DISPOSED)return null;return await this.internal.promise.finally(Z)}dispose(){if(this.state!==A.State.DISPOSED)this.unresolve(),this.state=A.State.DISPOSED;return this}}Object.defineProperty(A,"StateNames",{enumerable:!0,configurable:!0,writable:!0,value:["UNLOADED","LOADING","LOADED","REJECTED","DISPOSED"]});Object.defineProperty(A,"State",{enumerable:!0,configurable:!0,writable:!0,value:{UNLOADED:0,LOADING:1,LOADED:2,REJECTED:3,DISPOSED:4,toString(Z){return A.StateNames[Z]}}});var D9="_",N=0,OZ=1,E6=0,l=1,BZ=2,dZ=3,U9;(function(Z){Z[Z.RUNNING=0]="RUNNING",Z[Z.DISPOSED=1]="DISPOSED"})(U9||(U9={}));class k0 extends uZ{constructor(Z,$={},J={megabytes:Number.MAX_VALUE,strategy:"unload-oldest"},Q="./encoded/",K=Object.keys($),H=["english",D9],X=".webm",z=[],Y=new Map,W=new Map,G=N,O=new N0(J,new Map,(w)=>{this.disposeFile(w)}),q=!1,B=!1,T=O9()){super();Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:Z}),Object.defineProperty(this,"atlas",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"memory",{enumerable:!0,configurable:!0,writable:!0,value:J}),Object.defineProperty(this,"sourcePath",{enumerable:!0,configurable:!0,writable:!0,value:Q}),Object.defineProperty(this,"activePackageNames",{enumerable:!0,configurable:!0,writable:!0,value:K}),Object.defineProperty(this,"activeLanguages",{enumerable:!0,configurable:!0,writable:!0,value:H}),Object.defineProperty(this,"fileExtension",{enumerable:!0,configurable:!0,writable:!0,value:X}),Object.defineProperty(this,"priorities",{enumerable:!0,configurable:!0,writable:!0,value:z}),Object.defineProperty(this,"forward",{enumerable:!0,configurable:!0,writable:!0,value:Y}),Object.defineProperty(this,"reversed",{enumerable:!0,configurable:!0,writable:!0,value:W}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:G}),Object.defineProperty(this,"limiter",{enumerable:!0,configurable:!0,writable:!0,value:O}),Object.defineProperty(this,"mono",{enumerable:!0,configurable:!0,writable:!0,value:q}),Object.defineProperty(this,"use16Bit",{enumerable:!0,configurable:!0,writable:!0,value:B}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:T}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SoundManager"})}async loadAtlas(Z=`${this.sourcePath}.atlas.json`){if(this.state!==N)return;let J=await(await fetch(Z)).json();this.atlas=J,this.dispatchEvent({type:"atlasloaded",detail:{}})}setAtlas(Z){if(this.state!==N)return;this.atlas=Z,this.dispatchEvent({type:"atlasloaded",detail:{}})}setLanguage(Z){if(this.state!==N)return!1;if(this.activeLanguages[0]===Z)return!1;if(!this.getLanguages().includes(Z))return!1;return this.activeLanguages.splice(0,this.activeLanguages.length),this.activeLanguages.push(Z,D9),this.dispatchEvent({type:"languagechanged",detail:Z}),!0}setPackageByName(Z){if(this.state!==N||Z===this.activePackageNames[0])return!1;if(this.atlas[Z]===void 0)return!1;let J=this.activePackageNames.indexOf(Z);if(J===-1)return!1;else this.activePackageNames.splice(J,1),this.activePackageNames.unshift(Z);return this.dispatchEvent({type:"packagechanged",detail:Z}),!0}getPackageItems(Z){var $,J;if(Z===void 0)Z=($=this.activePackageNames[0])!==null&&$!==void 0?$:"";if(this.state===OZ)return[];return(J=this.atlas[Z])!==null&&J!==void 0?J:[]}getPackages(Z){if(this.state===OZ)return[];return Z===void 0?Object.values(this.atlas):Z.filter(($)=>Z0(this.atlas[$])).map(($)=>this.getPackageItems($))}getPackageNames(Z){if(this.state===OZ)return[];if(Z!=null)return Z.filter(($)=>($ in this.atlas));return Object.keys(this.atlas)}getSourceNames(Z=this.getPackageNames(),$=this.getLanguages()){if(this.state!==N)return[];let J=[];for(let Q of this.getPackages(Z))for(let K of Q)if($.includes(K[dZ]))J.push(K[E6]);return I6(J)}getActiveSourceNames(){return this.getSourceNames(this.activePackageNames,this.activeLanguages)}getSourceUrl(Z){if(this.state!==N)return;let $=this.findItemBySourceName(Z);if($===void 0)return;return`${this.sourcePath}${$[l]}${this.fileExtension}`}getSourceNumSamples(Z){if(this.state!==N)return;let $=this.findItemBySourceName(Z);return $!=null?$[BZ]:void 0}getSourceNumChannels(Z){if(this.state!==N)return;let $=this.findItemBySourceName(Z);if($===void 0)return;return rZ($[l])}getSourceDuration(Z){if(this.state!==N)return;let $=this.findItemBySourceName(Z);if($===void 0)return;return $[BZ]/this.context.sampleRate}getLanguages(Z=this.getPackageNames()){if(this.state!==N)return[];let $=[];for(let J of this.getPackages(Z))for(let Q of J){let K=Q[dZ];if(!$.includes(K))$.push(K)}return $}getAllFilenames(){return I6(Object.values(this.atlas).flat().map((Z)=>Z[l]))}getAllUrls(){return I6(this.getAllFilenames().map((Z)=>this.getUrlByFile(Z)))}getAllDetails(){return this.getAllFilenames().map((Z)=>this.getDetailsByFile(Z))}getAllItems(){return Object.values(this.atlas).flat()}setLoadPath(Z){if(this.state!==N)return;this.sourcePath=Z.endsWith("/")?Z:`${Z}/`,this.dispatchEvent({type:"loadpathchanged",detail:Z})}setPriorityList(Z){this.priorities=[...Z]}requestBufferAsync(Z){let $=this.findItemBySourceName(Z);if($===void 0)return A.from(null);return this.loadItem($)}requestBufferReversedAsync(Z){let $=this.findItemBySourceName(Z);if($===void 0)return A.from(null);let J=$[l];if(this.reversed.has(J))return this.limiter.use(J),this.reversed.get(J);let Q=this.loadItem($);if(Q.value===null)return this.reversed.set(J,Q),Q;let K=this.context.createBuffer(Q.value.numberOfChannels,Q.value.length,this.context.sampleRate),H=A.new();return this.reversed.set(J,H),H.value=K,Q.then((X)=>{if(X===null)return null;return T9(K,X),j4(K),H.resolve(K),K}),H}requestBufferSync(Z){return this.requestBufferAsync(Z).value}requestBufferReversedSync(Z){return this.requestBufferReversedAsync(Z).value}getUrlByItem(Z){return this.getUrlByFile(Z[l])}getFileByItem(Z){return Z[l]}getFileBySource(Z){let $=this.findItemBySourceName(Z);return $!=null?$[l]:void 0}getNumSamplesByItem(Z){return Z[BZ]}getNumChannelsByItem(Z){return rZ(Z[l])}getDurationByItem(Z){return Z[BZ]/this.context.sampleRate}getNumSamplesByFile(Z){let $=this.findItemByFileName(Z);return $!=null?$[BZ]:void 0}getDurationByFile(Z){let $=this.findItemByFileName(Z);return $!=null?$[BZ]/this.context.sampleRate:void 0}getLoadStateByFile(Z){var $,J;return(J=($=this.forward.get(Z))===null||$===void 0?void 0:$.state)!==null&&J!==void 0?J:A.State.UNLOADED}getUrlByFile(Z){return`${this.sourcePath}${Z}${this.fileExtension}`}getDetailsByFile(Z){let $=this.findItemByFileName(Z);if($===void 0)return;return{state:this.getLoadStateByFile(Z),url:this.getUrlByFile(Z),duration:this.getDurationByItem($),numSamples:this.getNumSamplesByItem($),numChannels:rZ(Z),sourceName:$[E6],fileName:$[l],bitrate:w9(Z)}}getNumSamplesBySource(Z){let $=this.findItemBySourceName(Z);return $!=null?$[BZ]:void 0}getNumChannelsBySource(Z){let $=this.findItemBySourceName(Z);return $!=null?rZ($[l]):void 0}getDurationBySource(Z){let $=this.findItemBySourceName(Z);return $!=null?$[BZ]/this.context.sampleRate:void 0}getLoadStateBySource(Z){let $=this.getFileNameBySourceName(Z);if($===void 0)return;return this.getLoadStateByFile($)}getDetailsBySource(Z){let $=this.getFileNameBySourceName(Z);if($===void 0)return;return this.getDetailsByFile($)}getBitrateBySource(Z){let $=this.getFileNameBySourceName(Z);if($===void 0)return;return w9($)}getUrlBySource(Z){let $=this.getFileNameBySourceName(Z);if($===void 0)return;return this.getUrlByFile($)}findItemBySourceName(Z,$=this.activePackageNames,J=this.activeLanguages){if(this.state!==N)return;for(let Q of $){let K=this.getPackageItems(Q),H=J[0],X=new Map;for(let z of K)if(z[E6]===Z)if(z[dZ]===H)return z;else X.set(z[dZ],z);if(X.size>0)for(let z of J.slice(1)){let Y=X.get(z);if(Y!==void 0)return Y}}return}findItemByFileName(Z,$=this.activePackageNames){if(this.state!==N)return;return $.flatMap((J)=>this.getPackageItems(J)).find((J)=>J[l]===Z)}getFileNameBySourceName(Z,$=this.activePackageNames,J=this.activeLanguages){if(this.state!==N)return;let Q=this.findItemBySourceName(Z,$,J);return Q!=null?Q[l]:void 0}loadItem(Z){if(this.state!==N)return A.from(null);let $=Z[l],J=this.getUrlByFile($);if(this.forward.has($))return this.limiter.use($),this.forward.get($);let[Q,K]=B4(this.context.sampleRate,this.mono,Z),H=P6(K,Q);if(this.limiter.limit(H))return EZ`[ecas] memory limit reached: blocking new sound requests`,A.from(null);let X=this.context.createBuffer(Q,K,this.context.sampleRate);this.limiter.add($,X.length,X.numberOfChannels);let z=A.new();return z.value=X,z.state=A.State.LOADING,this.forward.set($,z),B9(this.cache,J).then(async(Y)=>{if(Y===void 0)return z.resolve(null),X;return await this.context.decodeAudioData(Y)}).then((Y)=>{T9(X,Y),z.resolve(X),this.dispatchEvent({type:"fileloaded",detail:$})}).catch(()=>{HZ`[ecas] failed to load sound file: ${$}`,z.resolve(null),this.dispatchEvent({type:"fileloaderror",detail:$})}),this.dispatchEvent({type:"fileloading",detail:$}),z}async loadItems(Z){if(this.state!==N)return[];let $=this.priorities.length>0?D4([...Z],this.priorities):Z;return await Promise.all($.map((J)=>this.loadItem(J)))}loadFile(Z){if(this.state!==N)return A.from(null);let $=this.forward.get(Z);if($!==void 0)return $;let J=this.findItemByFileName(Z);if(J===void 0)return this.dispatchEvent({type:"fileloaderror",detail:Z}),A.from(null);return this.loadItem(J)}async loadPackageName(Z=this.activePackageNames[0]){if(this.state!==N)return[];return await this.loadItems(this.getPackageItems(Z))}async loadPackageNames(Z){if(this.state!==N)return[];return await Promise.all(this.getPackageNames(Z).map(async($)=>await this.loadPackageName($))).then(($)=>$.flat())}async loadEverything(){if(this.state!==N)return[];return await this.loadPackageNames(this.getPackageNames())}async loadLanguage(Z=this.activeLanguages[0],$=this.activePackageNames){if(this.state===N)await Promise.all(this.getPackages($).map((J)=>J.filter((Q)=>Q[dZ]===Z).flatMap((Q)=>this.loadItem(Q))))}async loadLanguages(Z=this.activeLanguages,$=this.activePackageNames){if(this.state!==N)return;await Promise.all(Z.map(async(J)=>{await this.loadLanguage(J,$)}))}async loadSource(Z){if(this.state!==N)return null;let $=this.findItemBySourceName(Z);if($===void 0)return null;return await this.loadItem($)}async loadSources(Z){if(this.state!==N)return[];let $=Z.map((J)=>this.findItemBySourceName(J));return await this.loadItems($.filter(Z0))}async loadPriorityList(){return await this.loadSources(this.priorities)}disposeSource(Z){let $=this.findItemBySourceName(Z);if($===void 0)return;this.disposeItem($)}disposeFile(Z){var $,J;if(this.state===OZ)return;($=this.forward.get(Z))===null||$===void 0||$.dispose(),this.forward.delete(Z),(J=this.reversed.get(Z))===null||J===void 0||J.dispose(),this.reversed.delete(Z),this.limiter.inactive(Z)}disposeItem(Z){this.disposeFile(Z[l])}disposePackage(Z=this.activePackageNames[0]){if(this.state===OZ)return;for(let $ of this.getPackageItems(Z))this.disposeItem($)}disposePackages(Z=this.getPackageNames()){if(this.state===OZ)return;for(let $ of this.getPackages(Z))for(let J of $)this.disposeItem(J)}disposeLanguage(Z=this.activeLanguages[0],$=this.getPackageNames()){if(this.state===OZ)return;for(let J of this.getPackages($))for(let Q of J)if(Q[dZ]===Z)this.disposeItem(Q)}dispose(Z=!0){if(this.state===OZ)return;if(Z)super.dispose();this.disposePackages(),this.forward.clear(),this.reversed.clear(),this.cache.buffers.clear(),this.cache.promises.clear(),this.state=OZ}reload(Z=!1){return this.dispose(Z),this.state=N,this.dispatchEvent({type:"reloaded",detail:{}}),this}reloadWithAtlas(Z=this.atlas,$=!1){return this.reload($),this.setAtlas(Z),this}}function B4(Z,$,J){let Q=Z!==48000,K=Z/48000,H=rZ(J[l]),X=J[BZ],z=$?1:H,Y=Math.floor(Q?X*K:X);return[z,Y]}function rZ(Z){let J=Z.split(".")[1];if(J===void 0)return;let Q=J.replace("ch","");try{return Number(Q)}catch(K){return}}function w9(Z){let J=Z.split(".")[0];if(J===void 0)return;let Q=J.replace("kb","");try{return Number(Q)}catch(K){return}}function L9(Z){return new k0(Z.context,Z.atlas,Z.memory,Z.sourcePath,Z.activePackageNames,Z.activeLanguages,Z.fileExtension,Z.priorities,Z.forward,Z.reversed,Z.state,Z.limiter,Z.mono,Z.use16bit,Z.cache)}function T9(Z,$){let J=Math.min(Z.numberOfChannels,$.numberOfChannels);try{if(Z.numberOfChannels===1&&$.numberOfChannels===2){let Q=Z.getChannelData(0),K=$.getChannelData(0),H=$.getChannelData(1),X=Math.min(Z.length,$.length);for(let z=0;z<X;z++)Q[z]=(K[z]+H[z])/2}else for(let Q=0;Q<J;Q++)$.copyFromChannel(Z.getChannelData(Q),Q)}catch(Q){let K=Math.min(Z.length,$.length);for(let H=0;H<J;H++){let X=Z.getChannelData(H),z=$.getChannelData(H);X.set(z.subarray(0,K),0)}}}function j4(Z){let $=Z.numberOfChannels;for(let J=0;J<$;J++)Z.getChannelData(J).reverse()}function D4(Z,$){let J=new Map($.map((K,H)=>[K,H])),Q=$.length;return Z.sort((K,H)=>{var X,z;let Y=(X=J.get(K[0]))!==null&&X!==void 0?X:Q,W=(z=J.get(H[0]))!==null&&z!==void 0?z:Q;return Y-W})}function I6(Z){let $={};for(let J of Z)$[J]=!0;return Object.keys($)}class U4{constructor(){Object.defineProperty(this,"map",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}addEventListener(Z,$,J){var Q;let K=this.map,H=K.get(Z),X=(Q=J===null||J===void 0?void 0:J.once)!==null&&Q!==void 0?Q:!1;if(H===void 0)K.set(Z,[[$,X]]);else H.push([$,X])}removeEventListener(Z,$){let J=this.map.get(Z);if(J===void 0)return;for(let Q=0;Q<J.length;Q++)if(J[Q][0]===$){J.splice(Q,1);return}}dispatchEvent(Z){let $=Z.type,J=this.map.get($);if(J===void 0)return!0;for(let Q=0;Q<J.length;Q++){let[K,H]=J[Q];if(K(Z),H)this.removeEventListener($,K),Q--}return!0}dispose(){this.map.clear()}}var nZ={DISABLED:0,ENABLED:1};function A9(Z,$=1){let{debug:J}=V(),Q=nZ.DISABLED,K;function H(){if(Z.state==="running")Z.suspend().catch(()=>{J("[ecas] failed to suspend the audio context")});else J(`[ecas] audio context tried to pause while in ${Z.state}`)}function X(){Z.resume().then(()=>{J("[ecas] sucessfully resumed the suspended context"),window.removeEventListener("click",z,{capture:!0})}).catch(()=>{J("[ecas] failed to resume the suspended context"),window.addEventListener("click",z,{capture:!0,passive:!0})})}function z(){let B=Z.state;if(J("[ecas] resume context",B),B==="suspended")X();else if(B==="interrupted")window.addEventListener("click",X,{once:!0,capture:!0,passive:!0});else if(B==="running")J("[ecas] context is already running"),window.removeEventListener("click",z,{capture:!0})}function Y(){J("[ecas] state change:",Z.state)}function W(){if(K!==void 0)clearTimeout(K),K=void 0}function G(){J(`[ecas] visibility change ${document.hidden?"hidden":"visible"} state: ${Z.state}`);let B=Z.state;if(document.hidden){if(B==="running"){if($<=0)H();else if(K===void 0)K=window.setTimeout(()=>{H(),K=void 0},$*1000)}}else if(B==="suspended"||B==="interrupted")W(),z()}function O(){if(Q===nZ.DISABLED)document.addEventListener("visibilitychange",G,{capture:!0,passive:!0}),Z.addEventListener("statechange",Y,{capture:!0,passive:!0}),Q=nZ.ENABLED}function q(){if(Q===nZ.ENABLED)document.removeEventListener("visibilitychange",G,{capture:!0}),Z.removeEventListener("statechange",Y,{capture:!0}),W(),Q=nZ.DISABLED}return{enable:O,disable:q}}var oZ;(function(Z){Z[Z.INITIAL=0]="INITIAL",Z[Z.DISPOSED=1]="DISPOSED"})(oZ||(oZ={}));class S0{constructor(Z,$=new AudioContext,J){var Q,K,H,X,z,Y,W,G;Object.defineProperty(this,"audioContext",{enumerable:!0,configurable:!0,writable:!0,value:$}),Object.defineProperty(this,"eventHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"soundManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"assetRequester",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"busHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isMuted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:oZ.INITIAL}),Object.defineProperty(this,"syncers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stealers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"buffers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"containers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"player",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"visibility",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"muteOnInvisible",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onstatechange",{enumerable:!0,configurable:!0,writable:!0,value:()=>{let L=this.audioContext.state;switch(L){case"running":this.eventHandler.triggerAudioEvent(XZ.Context.Running);break;case"closed":this.eventHandler.triggerAudioEvent(XZ.Context.Closed);break;case"suspended":this.eventHandler.triggerAudioEvent(XZ.Context.Suspended);break;case"interrupted":this.eventHandler.triggerAudioEvent(XZ.Context.Interrupted);break;default:V().error("[ecas] AudioContext statechange event triggered with unknown state:",L);break}}}),Object.defineProperty(this,"onsoundstarted",{enumerable:!0,configurable:!0,writable:!0,value:({detail:L})=>{this.eventHandler.triggerAudioEvent(XZ.Sound.PlaybackStart,L.name)}}),Object.defineProperty(this,"onsoundended",{enumerable:!0,configurable:!0,writable:!0,value:({detail:L})=>{this.eventHandler.triggerAudioEvent(XZ.Sound.PlaybackEnd,L.name)}});let{log:O,debug:q,info:B,error:T}=V();G9(O),this.options=z6(Z);let{soundConfig:w,eventConfig:JZ,stateConfig:o,loadrConfig:h}=this.options,{buses:S}=w,{loadPath:R,fileExtToUse:_,preload:g,memoryLimit:E,initialMasterVolume:QZ}=h;if(q("[ecas] config:",Z),q("[ecas] options:",this.options),B("[ecas] file extension:",_),this.eventHandler=new G6(JZ,o,h.initState,this),this.audioContext.addEventListener("statechange",this.onstatechange),this.soundManager=J!==null&&J!==void 0?J:new k0(this.audioContext,this.options.atlas,E),J===void 0){if(this.soundManager.fileExtension=_!==null&&_!==void 0?_:".webm",this.soundManager.setLoadPath(`${(Q=R===null||R===void 0?void 0:R.split("/").slice(0,-2).join("/"))!==null&&Q!==void 0?Q:"unknown"}/`),this.soundManager.setPackageByName("base"),this.soundManager.setLanguage("en"),Array.isArray(g))this.soundManager.setPriorityList(g),this.soundManager.loadPriorityList();else if(g===!0)this.soundManager.loadEverything()}let _Z=(L)=>{try{return this.soundManager.requestBufferSync(L)}catch(k){return this.soundManager.loadSource(L).catch(T),T("[ecas] failed to get audio buffer",L),null}},E0=async(L)=>{return await this.soundManager.requestBufferAsync(L)},I0=(L)=>{return this.soundManager.requestBufferReversedSync(L)},x0=async(L)=>{return await this.soundManager.requestBufferReversedAsync(L)},h0=(L)=>{var k,KZ;return(KZ=(k=this.busHandler.get(L))===null||k===void 0?void 0:k.input)!==null&&KZ!==void 0?KZ:null},_0=(L)=>{var k;return(k=this.stealers.get(L))!==null&&k!==void 0?k:null},tZ=(L)=>{var k;return(k=this.syncers.get(L))!==null&&k!==void 0?k:null};if(this.assetRequester={requestDestination:h0,requestBuffer:_Z,requestBufferAsync:E0,requestBufferReversed:I0,requestBufferReversedAsync:x0,requestSyncer:tZ,requestStealer:_0},this.busHandler=new e0(this.audioContext,this.assetRequester,S!==null&&S!==void 0?S:[]),this.busSetGain({busId:d,gain:QZ!==null&&QZ!==void 0?QZ:1}),this.muteOnInvisible={isEnabled:!1,abortController:new AbortController},this.shouldMuteOnInvisible=(K=h===null||h===void 0?void 0:h.muteOnInvisible)!==null&&K!==void 0?K:!0,this.visibility=A9(this.audioContext),(H=h.pauseOnInvisible)!==null&&H!==void 0?H:!0)this.visibility.enable();this.player=new C6({assetRequester:this.assetRequester,context:this.audioContext,flyweightOptions:(X=h.flyweights)!==null&&X!==void 0?X:{},triggerOnPropertyCallback:this.eventHandler.triggerOnPropertyEventOrAction.bind(this.eventHandler)}),this.syncers=new Map(pZ((z=w.syncers)!==null&&z!==void 0?z:{}).map(([L,k])=>[L,new M6(this.audioContext,k)])),this.stealers=new Map(pZ((Y=w.stealers)!==null&&Y!==void 0?Y:{}).map(([L,k])=>[L,new T6(this.audioContext,k)])),this.buffers=new Map(pZ((W=w.buffers)!==null&&W!==void 0?W:{})),this.containers=new Map(pZ((G=w.containers)!==null&&G!==void 0?G:{}).map(([L,k])=>{var KZ,a;let cZ=Object.assign(Object.assign({},k),{voices:(a=(KZ=k.voices)===null||KZ===void 0?void 0:KZ.map((y)=>{return(y===null||y===void 0?void 0:y.name)===void 0?y:Object.assign(Object.assign({},this.buffers.get(y.name)),y)}))!==null&&a!==void 0?a:[]});return[L,new A6({player:this.player,properties:cZ})]})),q("[ecas] syncers:",this.syncers.keys()),q("[ecas] stealers:",this.stealers.keys()),q("[ecas] buffers:",this.buffers.keys()),q("[ecas] containers:",this.containers.keys()),this.player.target.addEventListener("started",this.onsoundstarted),this.player.target.addEventListener("ended",this.onsoundended)}set shouldMuteOnInvisible(Z){let{isEnabled:$,abortController:J}=this.muteOnInvisible;if(Z&&$||!Z&&!$)return;if(!Z&&$){this.muteOnInvisible.isEnabled=!1,J.abort();return}let Q=!this.isMuted,K=()=>{if(document.hidden)Q=!this.isMuted,this.mute();else if(Q)this.unmute()};if(this.muteOnInvisible.isEnabled=!0,J.signal.aborted)this.muteOnInvisible.abortController=new AbortController;window.addEventListener("visibilitychange",K,{capture:!0,passive:!0,signal:this.muteOnInvisible.abortController.signal})}static async create(Z,$,J){var Q,K,H,X,z,Y,W;if(J!==void 0)V8(J.url,J);else O8()?G8():K0((K=(Q=Z.loadrConfig)===null||Q===void 0?void 0:Q.logger)!==null&&K!==void 0?K:"none");let{debug:G}=V();M0();let O=z6(Z);G("[ecas] create",O);let{loadrConfig:q,atlas:B}=O,{loadPath:T,preload:w,forcePolyfills:JZ,memoryLimit:o,sampleRate:h}=q,S=W9(JZ);G("[ecas] polyfills installed",S);let R=h===void 0?void 0:{sampleRate:h},_=$!==null&&$!==void 0?$:new AudioContext(R);if(((H=Z.loadrConfig)===null||H===void 0?void 0:H.useIosRingerSwitch)===!0)G`[ecas] using ios mute button fix`,q9(_);else G`[ecas] not using ios mute button fix`;let g=(z=(X=Z.loadrConfig)===null||X===void 0?void 0:X.fileExtToUse)!==null&&z!==void 0?z:await v8(_)?".webm":".mp4";O=k8(O,g);let E=L9({context:_,atlas:B,memory:o,fileExtension:g,sourcePath:`${(Y=T===null||T===void 0?void 0:T.split("/").slice(0,-2).join("/"))!==null&&Y!==void 0?Y:""}/`,mono:(W=q.mono)!==null&&W!==void 0?W:!1});if(E.setPackageByName("base"),E.setLanguage("en"),Array.isArray(w))E.setPriorityList(w),E.loadPriorityList();else if(w===!0)E.loadEverything();if(!f(window,"soundManager"))D(window,"soundManager",{value:E});G("[ecas] creating ecas: waiting to resume audio context");let QZ=await F9(_);if(QZ.isErr())throw QZ.error;G("[ecas] creating ecas instance");let _Z=new S0(O,_,E);return _Z.eventHandler.triggerAudioEvent(XZ.Ready),_Z}setLogger(Z){return K0(Z),F(void 0)}getLogger(){return V()}setCustomLogger(Z){return W8(Z),F(void 0)}setMasterVolume(Z){let{debug:$}=V(),J=typeof Z==="number"?Z:typeof Z==="string"?Number(Z):Z.volume;if($("[ecas] setMasterVolume",J),!this.isMuted)return this.busSetGain({busId:d,gain:J});else return M("[ecas] tried to set gain while muted.")}getMasterVolume(){var Z;let $=(Z=this.busHandler.get(d))===null||Z===void 0?void 0:Z.nodes.gain.gain.value;if($===void 0)return M("[ecas] master bus gain is undefined");return F($)}muteUnmute(Z){return this.isMuted?this.unmute():this.mute()}unmute(Z){if(!this.isMuted)return F(void 0);return V().debug("[ecas] unmute"),this.isMuted=!1,this.eventHandler.triggerAudioEvent(XZ.Unmute),this.busApplyEnvelope({busId:e,paramId:"gain",points:[{pos:0,val:"current"},{pos:500,val:1}]})}mute(Z){let{debug:$}=V();if($("[ecas] mute"),this.isMuted)return $("[ecas] already muted"),F(void 0);if(this.audioContext.state!=="running")return $("[ecas] audio context is not running, cannot mute"),F(void 0);return this.isMuted=!0,this.eventHandler.triggerAudioEvent(XZ.Mute),this.busApplyEnvelope({busId:e,paramId:"gain",points:[{pos:0,val:"current"},{pos:500,val:0}]})}updateMuteBehaviour(Z){if(Z.muteOnInvisible!==void 0&&this.shouldMuteOnInvisible!==Z.muteOnInvisible)V().debug("[ecas] muteOnInvisible",Z.muteOnInvisible),this.shouldMuteOnInvisible=Z.muteOnInvisible;if(Z.pauseOnInvisible!==void 0)V().debug("[ecas] pauseOnInvisible",Z.pauseOnInvisible),Z.pauseOnInvisible?this.visibility.enable():this.visibility.disable();return F(void 0)}triggerGameEvent(Z,...$){if(Z===void 0)return j(new Error("[ecas] triggerGameEvent was triggered with undefined event"));let J=typeof Z==="string"?Z:Z.event;if(typeof Z==="string")this.eventHandler.triggerGameEvent(J,...$);else{let{event:Q,args:K}=Z;if(K===void 0)this.eventHandler.triggerGameEvent(Q);else this.eventHandler.triggerGameEvent(Q,...K)}return F(void 0)}dispose(Z){if(this.state===oZ.DISPOSED)return F(void 0);this.state=oZ.DISPOSED;let{debug:$}=V();$("[ecas] dispose");try{return this.shouldMuteOnInvisible=!1,this.soundManager.dispose(),this.audioContext.removeEventListener("statechange",this.onstatechange),this.player.target.removeEventListener("started",this.onsoundstarted),this.player.target.removeEventListener("ended",this.onsoundended),this.player.dispose(),this.audioContext.close().then(()=>{$("[ecas] audio context closed")}).catch($),this.eventHandler.dispose(),this.busHandler.dispose(),this.visibility.disable(),F(void 0)}catch(J){return M(`[ecas]: error when disposing ecas: ${C(J).message}`)}}resync(Z){let{syncerName:$,initialDelay:J=0}=Z,Q=this.syncers.get($);if(Q===void 0)return M(`[ecas] resync: no syncer found with name ${$}`);let K=this.audioContext.currentTime+J;return Q.resync(K),F(void 0)}bufferPlaySync(Z){let $=this.player.play(Z);if($===0)return F(void 0);else return M(`[ecas] buffer-playback-result: ${A0($)}`)}bufferPlayAsync(Z){let $=this.audioContext.currentTime,{maxWaitTime:J=Number.MAX_SAFE_INTEGER,sourceName:Q}=Z;if(Q===void 0)return NZ(new Error("[ecas] buffer play async: no source name specified"));let K=()=>{var H;if(this.audioContext.currentTime-$<=J)return this.bufferPlaySync(Z);return M(`[ecas] max wait time exceeded when playing ${(H=Z.name)!==null&&H!==void 0?H:""}`)};return SZ(this.soundManager.loadSource(Q),C).andThen(K)}bufferPlay(Z){var $,J,Q=i(Z,[]);let K=(J=($=Q===null||Q===void 0?void 0:Q.name)!==null&&$!==void 0?$:Q===null||Q===void 0?void 0:Q.sourceName)!==null&&J!==void 0?J:"",H=Object.assign(Object.assign({name:K},this.buffers.get(K)),Q),{sourceName:X}=H;if(X===void 0)return M("[ecas] buffer play: no source name specified");if(H.maxWaitTime===0||this.soundManager.getLoadStateBySource(X)===A.State.LOADED)return this.bufferPlaySync(H);return this.bufferPlayAsync(H)}bufferStopOldest(Z){return this.player.stopOldest(Z),F(void 0)}bufferStopById(Z){return this.player.stopById(Z),F(void 0)}bufferStopByName(Z){return this.player.stopByName(Z),F(void 0)}bufferStopAll(Z){return this.player.stopAll(Z),F(void 0)}bufferApplyEnvelopeByName(Z){return this.player.applyEnvelopeByName(Z),F(void 0)}bufferApplyEnvelopeById(Z){return this.player.applyEnvelopeById(Z),F(void 0)}bufferApplyEnvelopeToAll(Z){return this.player.applyEnvelopeToAll(Z),F(void 0)}containerPlay(Z){var{name:$,maxWaitTime:J}=Z,Q=i(Z,["name","maxWaitTime"]);let{debug:K}=V();K("[ecas] containerPlay",$);let H=this.containers.get($);if(H===void 0)return M(`[ecas] containerPlay: no container found with name ${$}`);let X=H.properties.voices.map((W)=>W.sourceName).filter((W)=>this.soundManager.getLoadStateBySource(W)!==A.State.LOADED);if(X.length===0||J===0){let W=H.play(Q);if(W===0)return F(void 0);else return M(`[ecas]: failed to play container ${$}: ${A0(W)}`)}let Y=this.audioContext.currentTime;return SZ(this.soundManager.loadSources(X),C).andThen(()=>{if(this.audioContext.currentTime-Y<(J!==null&&J!==void 0?J:Number.MAX_SAFE_INTEGER)){let G=H.play(Q);if(G===0)return kZ(void 0);return i0(A0(G))}else return i0(`[ecas] max waitTime exceeded when playing container ${$}`)})}containerStop(Z){let $=this.containers.get(Z.name);if($===void 0)return M(`[ecas] containerStop: no container found with name ${Z.name}`);return $.stop(Z),F(void 0)}containerReset(Z){let $=this.containers.get(Z.name);if($===void 0)return M(`[ecas] containerReset: no container found with name ${Z.name}`);return $.reset(),F(void 0)}loadAllSounds({onEnded:Z}={}){V().debug("[ecas] loadAllSounds");let $=Z!==void 0,J=SZ(this.soundManager.loadEverything(),C);return $?J.andThen(()=>{return this.eventHandler.triggerOnPropertyEventOrAction(Z),kZ(void 0)}):J.map(()=>{return})}loadTheseSounds(Z){let $=fZ(Z),J=$?Z:Z.ids,Q=!$&&Z.onEnded!==void 0;V().debug("[ecas] loadTheseSounds",J);let K=SZ(this.soundManager.loadSources(J),C);return Q?K.andThen(()=>{return this.eventHandler.triggerOnPropertyEventOrAction(Z.onEnded),kZ(void 0)}):K.map(()=>{return})}loadTheseEvents(Z){return kZ(void 0)}applyEnvelope({automator:Z,paramId:$,curve:J,points:Q,delay:K,syncerName:H="default",beatSync:X,beatSyncOffset:z=0}){let Y=this.audioContext,W=K!==null&&K!==void 0?K:0,G=X!==void 0,O=G?this.assetRequester.requestSyncer(H):null;if(G&&O===null)V().debug(`[ecas] apply-envelope-error: no beatsyncer for apply envelope to ${$}`);let q=G&&O!==null?O.getSyncTime(X,W,FZ(z)):this.audioContext.currentTime;return WZ({automator:Z,context:Y,paramId:$,curve:J,points:Q,initialDelay:W,when:q})}cancelEnvelope({automator:Z,paramId:$,delay:J}){let Q=this.audioContext.currentTime+(J!==null&&J!==void 0?J:0);return Z.cancel({paramId:$,when:Q}).match((K)=>F(void 0),(K)=>j(K))}busGet({busId:Z}){V().debug("[ecas] busGet",Z);let $=this.busHandler.get(Z);if($===void 0)return M(`[ecas] busGet: no bus found with id ${Z}`);return F($)}busSetGain({busId:Z,gain:$}){var J,Q;try{let K=(Q=(J=this.busHandler.get(Z))===null||J===void 0?void 0:J.automator)===null||Q===void 0?void 0:Q.get("gain");if(K===void 0)return M(`[ecas] gain param found for bus with id ${Z}`);K.value=$}catch(K){return M(`[ecas] no gain param found for bus with id ${Z}: ${C(K).message}`)}return F(void 0)}busAddInsert(Z){var $,{busId:J,typename:Q}=Z,K=i(Z,["busId","typename"]);let H=($=K.id)!==null&&$!==void 0?$:"undefined",X=new Error(`[ecas] cannot add ${Q} after ecas is initialized. Specify the insert "${H}" directly on the bus(es) "${J.toString()}"`);return V().debug(X.message),j(X)}busAddFilter(Z){return this.busAddInsert(Object.assign({typename:p.typename},Z))}busAddCompressor(Z){return this.busAddInsert(Object.assign({typename:r.typename},Z))}busAddAlgorithmicReverb(Z){return this.busAddInsert(Object.assign({typename:s.typename},Z))}busAddConvolverReverb(Z){return this.busAddInsert(Object.assign({typename:u.typename},Z))}busAddDelay(Z){return this.busAddInsert(Object.assign({typename:I.typename},Z))}busAddPingPongDelay(Z){return this.busAddInsert(Object.assign({typename:x.typename},Z))}busApplyEnvelope(Z){var $,{busId:J}=Z,Q=i(Z,["busId"]);if(typeof J==="string")J=[J];let K=[];for(let H of J){let X=($=this.busHandler.get(H))===null||$===void 0?void 0:$.automator;if(Q.paramId==="pan"&&(X===null||X===void 0?void 0:X.get(Q.paramId))===void 0){V().debug(`[ecas] failed to apply envelope to parameter "${Q.paramId}". Add "pan" to bus "${H}" to be able to automate pan.`),K.push(H);continue}if(X===void 0){K.push(H);continue}this.applyEnvelope(Object.assign({automator:X},Q)).mapErr((z)=>{K.push(H)})}if(K.length!==0)return M(`[ecas]: failed to apply envelope on buses: ${K.join(", ")}`);return F(void 0)}busCancelEnvelope(Z){var $,{busId:J}=Z,Q=i(Z,["busId"]);if(typeof J==="string")J=[J];let K=[];for(let H of J){let X=($=this.busHandler.get(H))===null||$===void 0?void 0:$.automator;if(X===void 0){K.push(H);continue}this.cancelEnvelope(Object.assign({automator:X},Q)).mapErr((z)=>{K.push(H)})}if(K.length!==0)return M(`[ecas]: No bus with id: ${K.join(", ")} found`);return F(void 0)}busCancelEnvelopeOnInsert(Z){var $,J,{busId:Q,insertId:K}=Z,H=i(Z,["busId","insertId"]);if(typeof Q==="string")Q=[Q];let X=[];for(let z of Q){let Y=(J=($=this.busHandler.get(z))===null||$===void 0?void 0:$.inserts.get(K))===null||J===void 0?void 0:J.automator;if(Y===void 0){X.push(z);continue}this.cancelEnvelope(Object.assign({automator:Y},H)).mapErr((W)=>X.push(z))}if(X.length!==0)return M(`[ecas]: failed to cancel envelope on buses ${X.join(", ")}`);return F(void 0)}busApplyEnvelopeToCompressor(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:r.typename}))}busApplyEnvelopeToAlgorithmicReverb(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:s.typename}))}busApplyEnvelopeToFilter(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:p.typename}))}busApplyEnvelopeToDelay(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:I.typename}))}busApplyEnvelopeToPingPongDelay(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:x.typename}))}busApplyEnvelopeToConvolverReverb(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:u.typename}))}busApplyEnvelopeToGainInsert(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:VZ.typename}))}busApplyEnvelopeToPanInsert(Z){return this.busApplyEnvelopeToInsert(Object.assign(Object.assign({},Z),{typename:GZ.typename}))}busApplyEnvelopeToInsert(Z){var $,{busId:J,insertId:Q,typename:K}=Z,H=i(Z,["busId","insertId","typename"]);if(typeof J==="string")J=[J];let X=[];for(let z of J){let Y=($=this.busHandler.get(z))===null||$===void 0?void 0:$.inserts.get(Q);if(Y===void 0){X.push(z);continue}if(C8(Y,K)){let W=Y.automator;this.applyEnvelope(Object.assign({automator:W},H)).mapErr((G)=>X.push(z))}else X.push(z)}if(X.length!==0)return M(`[ecas]: failed to apply envelope on ${Q} buses: ${X.join(", ")}`);return F(void 0)}setLanguage(Z){return this.soundManager.setLanguage(Z.language),F(void 0)}setMemoryLimit(Z){let{megabytes:$,strategy:J}=Z;if($!==void 0)this.soundManager.limiter.setMemoryLimit($);if(J!==void 0)this.soundManager.limiter.setStrategy(J);return F(void 0)}}class R0{constructor(){Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:[]})}add(Z,...$){return this.events.push([Z,...$]),this}at(Z){if(Z<0)return this.events[this.events.length-Math.abs(Z)];return this.events[Z]}*drain(){let Z=this.events.shift();while(Z!==void 0)yield Z,Z=this.events.shift()}length(){return this.events.length}}class C9 extends Error{constructor(Z){super(Z);this.name="EcasProviderError"}}var w4={NOT_READY:new C9("ecas is not ready")};class aZ{constructor(){Object.defineProperty(this,"ecas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerListeners",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"eventListeners",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"creator",{enumerable:!0,configurable:!0,writable:!0,value:S0.create}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:new R0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:{loadrConfig:{queue:!0}}}),Object.defineProperty(this,"onerror",{enumerable:!0,configurable:!0,writable:!0,value:(Z)=>{var $,J;(J=($=V()).onerror)===null||J===void 0||J.call($,Z)}}),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:new Promise((Z)=>{let $=setInterval(()=>{if(this.ecas!==void 0)clearInterval($),Z(this.ecas)},128)})}),Object.defineProperty(this,"disableTriggers",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maybeQueue",{enumerable:!0,configurable:!0,writable:!0,value:(Z)=>{var $;function J(Q,K){return K!==void 0&&(K===!0||K.includes(Q))}if(J(Z[0],($=this.options.loadrConfig)===null||$===void 0?void 0:$.queue))this.queue.add(...Z)}})}joinSession(Z){var $;try{($=this.socket)===null||$===void 0||$.close();let J=new WebSocket(Z);this.socket=J,J.onopen=()=>{J.send(JSON.stringify({type:"ping"}))};let Q=(...K)=>{if(J.readyState===WebSocket.OPEN){let H=JSON.stringify({type:"trigger",data:K,timestamp:performance.now()});J.send(H)}};J.onopen=()=>{this.addTriggerListener("any",Q)},J.onclose=()=>{this.removeTriggerListener("name",Q)}}catch(J){}return this}addTriggerListener(Z,$){let J=this.triggerListeners.get(Z);if(J===void 0)this.triggerListeners.set(Z,[$]);else J.push($);return this}removeTriggerListener(Z,$){var J;let Q=(J=this.triggerListeners.get(Z))!==null&&J!==void 0?J:[],K=Q.indexOf($);if(K>-1)Q.splice(K,1);return this.triggerListeners.set(Z,Q),this}emitTrigger(Z){var $;let J=($=this.triggerListeners.get(Z[0]))!==null&&$!==void 0?$:this.triggerListeners.get("any");if(J!==void 0)J.forEach((Q)=>Q.apply(Q,Z));return this}addEventListener(Z,$){let J=this.eventListeners.get(Z);if(J===void 0)this.eventListeners.set(Z,[$]);else J.push($);if(this.ecas!==void 0)this.ecas.eventHandler.on(Z,$);return this}removeEventListener(Z,$){var J;let Q=(J=this.eventListeners.get(Z))!==null&&J!==void 0?J:[],K=Q.indexOf($);if(K>-1)Q.splice(K,1);return this.eventListeners.set(Z,Q),this.ready.then((H)=>{H.eventHandler.off(Z,$)}).catch(this.onerror.bind(this)),this}emitEvent(...Z){return this.ready.then(($)=>{$.eventHandler.emit(...Z)}).catch(this.onerror.bind(this)),this}withOptions(Z){return this.options=Z,this}requeue(){return[...this.queue.drain()].forEach(this.maybeQueue.bind(this)),this}load(){this.dispose(),this.requeue();let Z=$0(),$=Q0(Z);if($!=="none")this.joinSession($);let J=Z.get("ecas-disable-triggers").unwrapOr("false");return this.disableTriggers=J==="true",this.creator(this.options,this.context,this.socket).then((Q)=>{this.ecas=Q;for(let[K,H]of this.eventListeners.entries())H.forEach((X)=>{Q.eventHandler.on(K,X)});for(let K of this.queue.drain())this.fire(...K)}).catch(this.onerror.bind(this)),this}trigger(...Z){return this.ecas===void 0?this.maybeQueue(Z):this.fire(...Z),this.emitTrigger(Z)}fire(...Z){if(this.disableTriggers)return this;try{let $=this.ecas.eventHandler;$.triggerGameEvent.apply($,Z).map((J)=>J.mapErr(this.onerror.bind(this)))}catch($){this.onerror(C($))}return this}get requiredEcas(){if(this.ecas===void 0)throw w4.NOT_READY;return this.ecas}dispose(){var Z,$,J;(Z=this.socket)===null||Z===void 0||Z.close(0,"done");try{($=this.ecas)===null||$===void 0||$.bufferStopAll({}),(J=this.ecas)===null||J===void 0||J.dispose()}catch(Q){this.onerror(new Error(`[ecas] dispose: call to bufferStopAll failed: ${C(Q).message}`))}return this.ecas=void 0,this}delete(){if(this.dispose(),window.ecas!==void 0)delete window.ecas}reset(){return this.dispose(),this.queue=new R0,this.options={loadrConfig:{queue:!0}},this}withOnerror(Z){return this.onerror=Z,this}withCreator(Z){return this.creator=Z,this}withLoadrConfig(Z){return this.options=j0(this.options,Z),this}withPrependLoadPath(Z){return this.options=X6(this.options,Z),this}withQueue(Z){return this.options=$6(this.options,Z),this}withLogger(Z){return this.options=Z6(this.options,Z),this}withLoadPath(Z){return this.options=B0(this.options,Z),this}withPauseOnInvisible(Z){return this.options=Object.assign(Object.assign({},this.options),{loadrConfig:Object.assign(Object.assign({},this.options.loadrConfig),{pauseOnInvisible:Z,resumeOnVisible:Z})}),this}withMuteOnInvisible(Z){return this.options=Object.assign(Object.assign({},this.options),{loadrConfig:Object.assign(Object.assign({},this.options.loadrConfig),{muteOnInvisible:Z,unmuteOnVisible:Z})}),this}withPause(Z){return this.options=J6(this.options,Z),this}withPreload(Z){return this.options=Object.assign(Object.assign({},this.options),{loadrConfig:Object.assign(Object.assign({},this.options.loadrConfig),{preload:Z})}),this}async fetchConfig(Z){try{return await window.fetch(Z).then(async($)=>await $.json()).then(($)=>{return typeof $==="object"&&$!==null&&($.soundConfig!==void 0||$.eventConfig!==void 0||$.stateConfig!==void 0||$.loadrConfig!==void 0)?$:void 0})}catch($){this.onerror(new Error(`[ecas] failed to fetch config from ${Z} due to error: ${C($).message}`));return}}withFetchConfigAndLoad(Z){return this.fetchConfig(Z).then(($)=>{var J,Q,K,H;if($===void 0){this.onerror(new Error(`[ecas] failed to fetch config from ${Z}`));return}this.options=Object.assign(Object.assign({},this.options),{loadrConfig:Object.assign(Object.assign({},this.options.loadrConfig),{queue:(H=(Q=(J=$.loadrConfig)===null||J===void 0?void 0:J.queue)!==null&&Q!==void 0?Q:(K=this.options.loadrConfig)===null||K===void 0?void 0:K.queue)!==null&&H!==void 0?H:!0})}),this.withOptions(D0($,this.options)).load()}).catch(this.onerror.bind(this)),this}withStateConfig(Z){return this.options=Q6(this.options,Z),this}withSoundConfig(Z){return this.options=TZ(this.options,Z),this}withEventConfig(Z){return this.options=K6(this.options,Z),this}withExtendOptions(Z){return this.options=D0(this.options,Z),this}}function X3(){if(typeof window==="undefined")return j(new Error("[ecas] window is undefined"));if(typeof window.audio!=="undefined")return j(new Error("[ecas] window.audio already exists on window"));try{return D(window,"ecas",{value:new aZ}),F(window)}catch(Z){return j(new Error(`[ecas] failed to add audio to window ${C(Z).message}`))}}var P0;if(typeof window==="undefined")P0=new aZ;else if(window.ecas!==void 0)P0=window.ecas;else P0=window.ecas=new aZ;var F3=P0;export{F3 as default};
